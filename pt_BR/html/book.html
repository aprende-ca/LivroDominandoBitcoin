<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>Ma√Ætriser Bitcoin</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article data-line-1">
<div id="header">
<h1>Ma√Ætriser Bitcoin</h1>
</div>
<div id="content">
<div class="sect1 data-line-2">
<h2 id="_pref√°cio">Pref√°cio</h2>
<div class="sectionbody">
<div class="sect2 data-line-4">
<h3 id="_escrevendo_o_livro_do_bitcoin">Escrevendo o Livro do Bitcoin</h3>
<div class="paragraph data-line-6">
<p>A primeira vez que ouvi falar em bitcoin foi em meados de 2011. Minha rea√ß√£o imediata foi mais ou menos essa "Pfft! Dinheiro de nerd!" e eu ignorei-o por mais seis meses, sem compreender a sua import√¢ncia. Esta √© uma rea√ß√£o que eu tenho observado com frequ√™ncia entre muitas das pessoas mais inteligentes que conhe√ßo, o que me d√° algum consolo. Na segunda vez que me deparei com o bitcoin, em uma lista de discuss√£o, eu decidi ler o seu "manual de instru√ß√µes" oficial, o white paper escrito por Satoshi Nakamoto, para ver do que se tratava. Ainda me lembro do momento em que eu terminei de ler aquelas nove p√°ginas, quando eu percebi que o bitcoin n√£o era simplesmente uma moeda digital, mas uma rede de confian√ßa que tamb√©m poderia servir de base para aplica√ß√µes muito mais avan√ßadas do que apenas moedas. Ap√≥s chegar √† conclus√£o de que "isso n√£o √© dinheiro, mas sim uma rede de confian√ßa descentralizada", comecei uma jornada de quatro meses em que passei devorando cada peda√ßo de informa√ß√£o que eu conseguia encontrar sobre o assunto. Eu me tornei obcecado e encantado, passando 12 ou mais horas por dia colado ao monitor, lendo, escrevendo, programando e aprendendo o m√°ximo que eu podia. Ap√≥s pular muitas refei√ß√µes, sa√≠ desse per√≠odo de obsess√£o nove quilos mais magro e determinado a dedicar-me a trabalhar com bitcoin.</p>
</div>
<div class="paragraph data-line-8">
<p>Dois anos depois, ap√≥s criar v√°rias pequenas startups para explorar servi√ßos e produtos relacionados ao bitcoin, eu decidi que estava na hora de escrever o meu primeiro livro. O bitcoin foi um t√≥pico que me levou a um frenesi de criatividade e que consumiu meus pensamentos; foi a tecnologia mais empolgante que eu encontrei desde que conheci a Internet. Estava na hora de compartilhar minha paix√£o sobre essa incr√≠vel tecnologia com uma audi√™ncia mais ampla.</p>
</div>
</div>
<div class="sect2 data-line-10">
<h3 id="_p√∫blico_alvo">P√∫blico Alvo</h3>
<div class="paragraph data-line-12">
<p>Esse livro foi escrito principalmente para programadores. Se voc√™ sabe alguma linguagem de programa√ß√£o, esse livro ir√° ensin√°-lo como as moedas criptogr√°ficas funcionam, como utiliz√°-las e como desenvolver softwares que trabalhem com elas. Os primeiros cap√≠tulos tamb√©m s√£o adequados como uma introdu√ß√£o aprofundada ao bitcoin para n√£o-programadores‚Äîpessoas que queiram entender o funcionamento interno do bitcoin e das criptomoedas.</p>
</div>
</div>
<div class="sect2 data-line-14">
<h3 id="_conven√ß√µes_usadas_neste_livro">Conven√ß√µes Usadas neste Livro</h3>
<div class="paragraph data-line-16">
<p>As seguintes conven√ß√µes tipogr√°ficas s√£o usadas neste livro:</p>
</div>
<div class="dlist data-line-18">
<dl>
<dt class="hdlist1"><em>It√°lico</em></dt>
<dd>
<p>Indica novos termos, URLs, endere√ßos de e-mail, nomes e extens√µes de arquivos.</p>
</dd>
<dt class="hdlist1">Largura constante</dt>
<dd>
<p>Usada para listagem de programas, assim como dentro de par√°grafos para se referir a elementos de programas como vari√°veis e nomes de fun√ß√µes, banco de dados, tipos de dados, vari√°veis de ambiente, declara√ß√µes e palavras-chave.</p>
</dd>
<dt class="hdlist1"><strong><code>Largura constante em negrito</code></strong></dt>
<dd>
<p>Mostra comandos ou outro texto que deveria ser digitado literalmente pelo usu√°rio.</p>
</dd>
<dt class="hdlist1"><em>Largura constante em it√°lico</em></dt>
<dd>
<p>Mostra um texto que deveria ser substitu√≠do por valores fornecidos pelo usu√°rio, ou valores determinados pelo contexto.</p>
</dd>
</dl>
</div>
<div class="admonitionblock tip data-line-28">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-29">
<p>Este √≠cone significa uma dica ou sugest√£o.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note data-line-33">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-34">
<p>Este √≠cone significa uma nota geral.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning data-line-38">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-39">
<p>Esse √≠cone indica uma mensagem de aviso ou cuidado.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2 data-line-42">
<h3 id="_exemplos_de_c√≥digos">Exemplos de C√≥digos</h3>
<div class="paragraph data-line-44">
<p>Os exemplos s√£o ilustrados em Python, C++ e usando uma linha de comando de um sistema operacional do tipo Unix, como o Linux ou o macOS. Todos os <em>snippets</em> de c√≥digos est√£o dispon√≠veis no subdiret√≥rio <em>code</em> do reposit√≥rio principal no GitHub (<a href="https://github.com/bitcoinbook/bitcoinbook" data-href="https://github.com/bitcoinbook/bitcoinbook">https://github.com/bitcoinbook/bitcoinbook</a>). Voc√™ pode fazer um fork do c√≥digo do livro, testar exemplos de c√≥digos ou enviar corre√ß√µes via GitHub.</p>
</div>
<div class="paragraph data-line-46">
<p>Todos os <em>snippets</em> de c√≥digos podem ser replicados na maioria dos sistemas operacionais com uma instala√ß√£o m√≠nima dos compiladores e interpretadores das linguagens correspondentes. Quando necess√°rio, n√≥s providenciaremos as instru√ß√µes b√°sicas de instala√ß√£o e exemplos passo-a-passo dos resultados dessas instru√ß√µes.</p>
</div>
<div class="paragraph data-line-48">
<p>Alguns dos <em>snippets</em> e <em>outputs</em> de c√≥digos foram reformatados para a impress√£o. Em todos esses casos, as linhas foram divididas por uma barra invertida (\), seguida por um caractere de nova linha. Ao transcrever os exemplos, remova estes dois caracteres e una as linhas novamente, assim voc√™ obter√° resultados id√™nticos aos mostrados no exemplo.</p>
</div>
<div class="paragraph data-line-50">
<p>Todos os <em>snippets</em> de c√≥digos, sempre que poss√≠vel, usam valores e c√°lculos reais, de maneira que voc√™ possa construir de exemplo a exemplo e observar os mesmo resultados em qualquer c√≥digo que voc√™ escrever para calcular os mesmos valores. Por exemplo, as chaves privadas e seus endere√ßos e chaves p√∫blicas correspondentes s√£o reais. As amostras de transa√ß√£o, blocos e refer√™ncias √† blockchain foram realmente introduzidas na blockchain do bitcoin e fazem parte do livro-raz√£o p√∫blico, para que voc√™ possa revis√°-las em qualquer sistema bitcoin.</p>
</div>
</div>
<div class="sect2 data-line-52">
<h3 id="_endere√ßos_e_transa√ß√µes_de_bitcoin_neste_livro">Endere√ßos e Transa√ß√µes de Bitcoin neste Livro</h3>
<div class="paragraph data-line-54">
<p>Os endere√ßos, transa√ß√µes, chaves, c√≥digos QR e dados da blockchain do bitcoin usados neste livro s√£o, em sua maior parte, verdadeiros. Isso significa que voc√™ pode navegar pela blockchain, examinar as transa√ß√µes usadas como exemplos, recuper√°-las com seus pr√≥prios scripts ou programas, etc.</p>
</div>
<div class="paragraph data-line-56">
<p>√â importante frisar que as chaves privadas usadas para construir os endere√ßos ou est√£o impressas neste livro ou foram "queimadas". Isso significa que, se voc√™ enviar dinheiro para qualquer um desses endere√ßos, o dinheiro ser√° perdido para sempre ou, em alguns casos, qualquer pessoa que puder ler o livro poder√° pegar esse dinheiro usando as chaves privadas impressas nele.</p>
</div>
<div class="admonitionblock warning data-line-59">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-60">
<p>N√ÉO ENVIE DINHEIRO A QUALQUER ENDERE√áO CONTIDO NESTE LIVRO. Seu dinheiro ser√° tomado por outro leitor ou ser√° perdido para sempre.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2 data-line-63">
<h3 id="_publica√ß√£o_pela_oreilly_media">Publica√ß√£o pela O&#8217;Reilly Media</h3>
<div class="paragraph data-line-65">
<p>Este livro √© derivado sob a licen√ßa do livro "Mastering Bitcoin 2nd Edition", publicado pela O&#8217;Reilly Media.</p>
</div>
</div>
<div class="sect2 data-line-67">
<h3 id="_copyright_e_licen√ßa_do_livro">Copyright e Licen√ßa do Livro</h3>
<div class="paragraph data-line-69">
<p>Copyright (c) 2014 Andreas M. Antonopoulos LLC</p>
</div>
<div class="paragraph data-line-71">
<p>Este trabalho est√° licenciado sob a Licen√ßa Internacional Creative Commons Atribui√ß√£o-CompartilhaIgual 4.0. Para ver uma c√≥pia desta licen√ßa, visite</p>
</div>
<div class="paragraph data-line-73">
<p><a href="http://creativecommons.org/licenses/by-sa/4.0/" class="undefined" data-href="http://creativecommons.org/licenses/by-sa/4.0/">http://creativecommons.org/licenses/by-sa/4.0/</a>.</p>
</div>
<div class="paragraph data-line-75">
<p>Para atribui√ß√£o de cr√©ditos, visite o link do reposit√≥rio do livro:</p>
</div>
<div class="paragraph data-line-77">
<p><a href="https://github.com/bitcoinbook/bitcoinbook" class="undefined" data-href="https://github.com/bitcoinbook/bitcoinbook">https://github.com/bitcoinbook/bitcoinbook</a></p>
</div>
<div class="paragraph data-line-79">
<p>e inclua esta licen√ßa ou uma licen√ßa aberta equivalente, para satisfazer os requisitos CompartilhaIgual.</p>
</div>
<div class="paragraph data-line-81">
<p>Esta licen√ßa compat√≠vel com a "Free Culture" foi aprovada pela minha editora O&#8217;Reilly Media (<a href="http://oreilly.com" class="undefined" data-href="http://oreilly.com">http://oreilly.com</a>), que entende o valor do c√≥digo aberto. A O&#8217;Reilly Media n√£o apenas √© a melhor editora de livros t√©cnicos do mundo, como tamb√©m √© uma forte defensora de uma cultura aberta e do compartilhamento de conhecimento.</p>
</div>
<div class="paragraph data-line-83">
<p>Obrigado, O&#8217;Reilly!</p>
</div>
</div>
<div class="sect2 pagebreak-before data-line-86">
<h3 id="_como_entrar_em_contato_com_o_autor">Como Entrar em Contato com o Autor</h3>
<div class="paragraph data-line-88">
<p>Entre em contato comigo, Andreas M. Antonopoulos, no meu site:
<a href="https://aantonop.com/" class="undefined" data-href="https://aantonop.com/">https://aantonop.com/</a></p>
</div>
<div class="paragraph data-line-91">
<p>Informa√ß√µes sobre o <em>Dominando o Bitcoin (Mastering Bitcoin)</em>, a Edi√ß√£o Aberta e as tradu√ß√µes est√£o dispon√≠veis em:
<a href="https://bitcoinbook.info/" class="undefined" data-href="https://bitcoinbook.info/">https://bitcoinbook.info/</a></p>
</div>
<div class="paragraph data-line-94">
<p>Siga-me no Twitter:
<a href="https://twitter.com/aantonop" class="undefined" data-href="https://twitter.com/aantonop">https://twitter.com/aantonop</a></p>
</div>
<div class="paragraph data-line-97">
<p>Veja mais de 500 v√≠deos educacionais em meu canal do YouTube:
<a href="https://youtube.com/aantonop" class="undefined" data-href="https://youtube.com/aantonop">https://youtube.com/aantonop</a></p>
</div>
<div class="paragraph data-line-100">
<p>Muito obrigado a todos os meus colaboradores que apoiam o meu trabalho atrav√©s de doa√ß√µes mensais. Siga-me no Patreon:
<a href="https://patreon.com/aantonop" class="undefined" data-href="https://patreon.com/aantonop">https://patreon.com/aantonop</a></p>
</div>
</div>
<div class="sect2 data-line-103">
<h3 id="_agradecimentos">Agradecimentos</h3>
<div class="paragraph data-line-105">
<p>Este livro representa os esfor√ßos e as contribui√ß√µes de muitas pessoas. Agrade√ßo por toda a ajuda que recebi de amigos, colegas e at√© desconhecidos, que se juntaram a mim nessa tarefa de escrever o livro t√©cnico definitivo sobre criptomoedas e bitcoin.</p>
</div>
<div class="paragraph data-line-107">
<p>√â imposs√≠vel fazer uma distin√ß√£o entre a tecnologia do bitcoin e a comunidade bitcoin‚Äîe este livro √© um produto tanto dessa comunidade quanto √© sobre a tecnologia. Meu trabalho nesse livro foi encorajado, comemorado. apoiado e recompensado por toda a comunidade bitcoin desde o seu in√≠cio at√© o fim. Mais do que tudo, esse livro me permitiu fazer parte de uma comunidade maravilhosa por dois anos e n√£o posso agradecer suficientemente por eu ter sido aceito por essa comunidade. H√° um n√∫mero imenso de pessoas para ser mencionadas pelo nome‚Äîpessoas que encontrei em confer√™ncias, eventos, semin√°rios, meetups, encontros de pizza e pequenas reuni√µes, assim como tantos que se comunicam comigo via Twitter, reddit, bitcointalk.org e pelo GitHub e que impactaram esse livro de alguma forma. Cada ideia, analogia, pergunta, resposta e explica√ß√£o que voc√™ encontrar nesse livro foi de algum modo inspirada, testada ou melhorada atrav√©s da intera√ß√£o com a comunidade. Muito obrigado a todos pelo apoio; esse livro n√£o teria acontecido sem voc√™s. Serei eternamente grato.</p>
</div>
<div class="paragraph data-line-109">
<p>A jornada para se tornar um autor come√ßa, √© claro, muito antes do primeiro livro. Minha l√≠ngua nativa (e tamb√©m na escola) era o grego, e por isso tive que fazer um curso reparador de reda√ß√£o em ingl√™s ainda no meu primeiro ano da universidade. Sou muito grato a Diana Kordas, minha professora de reda√ß√£o em ingl√™s, que muito me ajudou a construir a confian√ßa e as habilidades que precisei naquele ano. Mais para frente, j√° como profissional, desenvolvi minhas habilidades em reda√ß√£o t√©cnica sobre <em>data centers</em>, escrevendo para a revista <em>Network World</em>. Meus agradecimentos a John Dix e John Gallant, que me deram meu primeiro trabalho em reda√ß√£o como colunista na <em>Network World</em>, ao meu editor Michael Cooney e √† minha colega Johna Till Johnson, que editaram minhas colunas e as tornaram public√°veis. Escrever 500 palavras por semana durante quatro anos me deu experi√™ncia suficiente para eventualmente considerar a me tornar um autor.</p>
</div>
<div class="paragraph data-line-111">
<p>Obrigado tamb√©m √†queles que me apoiaram quando enviei √† O&#8217;Reilly minha proposta de livro, ao enviarem refer√™ncias e revisarem o esbo√ßo. Especificamente, obrigado a John Gallant, Gregory Ness, Richard Stiennon, Joel Snyder, Adam B. Levine, Sandra Gittlen, John Dix, Johna Till Johnson, Roger Ver e Jon Matonis. Um obrigado especial a Richard Kagan e Tymon Mattozko, que revisaram as primeiras vers√µes da proposta e a Matthew Owain Taylor, que fez a editora√ß√£o da proposta.</p>
</div>
<div class="paragraph data-line-113">
<p>Agrade√ßo a Cricket Liu, autor da obra da O&#8217;Reilly <em>DNS e BIND</em>, que me apresentou √† O&#8217;Reilly. Agrade√ßo tamb√©m a Michael Loukides e Allyson MacDonald da O&#8217;Reilly, que trabalharam por meses para ajudar a tornar este livro realidade. Allyson foi especialmente paciente quando os prazos foram perdidos e as entregas atrasadas, conforme a vida interferia em nosso cronograma planejado. Na segunda edi√ß√£o, agrade√ßo a Timothy McGovern por orientar o processo, Kim Cofer por editar com paci√™ncia e Rebecca Panzer por ilustrar muitos novos diagramas.</p>
</div>
<div class="paragraph data-line-115">
<p>Os primeiros rascunhos dos primeiros cap√≠tulos foram os mais dif√≠ceis, porque o bitcoin √© um assunto dif√≠cil de desvendar. Toda vez que puxei uma linha da tecnologia bitcoin, tive que puxar a coisa toda. Repetidamente, fiquei paralisado e um pouco desanimado enquanto lutava para facilitar a compreens√£o do t√≥pico e criar uma narrativa em torno de um assunto t√©cnico t√£o denso. Por fim, eu decidi contar a hist√≥ria do bitcoin atrav√©s das hist√≥rias das pessoas que usam o bitcoin e o livro inteiro ficou muito mais f√°cil de escrever. Devo agradecer ao meu amigo e mentor, Richard Kagan, que me ajudou a desenvolver as hist√≥rias e a superar os momentos de bloqueio de escritor. Agrade√ßo a Pamela Morgan, que revisou os primeiros rascunhos de cada cap√≠tulo na primeira e na segunda edi√ß√µes do livro e fez as perguntas dif√≠ceis para torn√°-los melhores. Al√©m disso, obrigado aos desenvolvedores do grupo Meetup de San Francisco Bitcoin Developers, bem como Taariq Lewis e Denise Terry por ajudarem a testar o material inicial. Agrade√ßo tamb√©m a Andrew Naugler pelo design do infogr√°fico.</p>
</div>
<div class="paragraph data-line-117">
<p>Durante o desenvolvimento do livro, eu disponibilizei os primeiros rascunhos via GitHub e convidei o p√∫blico para comentar. Mais de uma centena de coment√°rios, sugest√µes, corre√ß√µes e contribui√ß√µes me foram enviadas em resposta. Tais contribui√ß√µes foram reconhecidas e agradecidas publicamente em <a href="#github_contrib">[github_contrib]</a>. Acima de tudo, um agradecimento especial para os editores volunt√°rios do GitHub Ming T. Ngyuen (1¬™ edi√ß√£o) e Will Binns (2¬™ edi√ß√£o), que trabalharam incansavelmente para organizar, gerenciar e resolver solicita√ß√µes de pull e relatos de problemas, assim como realizar corre√ß√µes de bugs no GitHub.</p>
</div>
<div class="paragraph data-line-119">
<p>Ap√≥s finalizado o rascunho do livro, ele passou por diversas rodadas de revis√£o t√©cnica. Obrigado a Cricket Liu e Lorne Lantz pelas extensas revis√µes, coment√°rios e apoio.</p>
</div>
<div class="paragraph data-line-121">
<p>V√°rios desenvolvedores de bitcoin contribu√≠ram com amostras de c√≥digo, an√°lises, coment√°rios e incentivo. Obrigado a Amir Taaki e Eric Voskuil, por exemplo de trechos de c√≥digo e muitos √≥timos coment√°rios; a Chris Kleeschulte, por contribuir com o ap√™ndice sobre o Bitcore; a Vitalik Buterin e Richard Kiss, pela ajuda na matem√°tica da curva el√≠ptica e nas contribui√ß√µes de c√≥digo; a Gavin Andresen, pelas corre√ß√µes, coment√°rios e incentivo; a Michalis Kargakis, por coment√°rios, contribui√ß√µes e reda√ß√£o do btcd; e a Robin Inge, por enviar erratas melhorando a segunda impress√£o. Na segunda edi√ß√£o, recebi novamente muita ajuda de muitos desenvolvedores do Bitcoin Core, incluindo Eric Lombrozo, que desmistificou a Segregated Witness, Luke Dashjr, que ajudou a melhorar o cap√≠tulo sobre transa√ß√µes, Johnson Lau, que revisou a Segregated Witness e outros cap√≠tulos, e muitos outros. Devo agradecimentos a Joseph Poon, Tadge Dryja e Olaoluwa Osuntokun, que explicaram a Lightning Network, revisaram meu texto e responderam minhas d√∫vidas quando tive dificuldades.</p>
</div>
<div class="paragraph data-line-123">
<p>Eu devo o meu amor pelas palavras e livros √† minha m√£e, Theresa, que me criou em uma casa repleta de livros em cada parede. Minha m√£e tamb√©m me deu meu primeiro computador em 1982, mesmo ela sendo uma tecn√≥foba assumida. Meu pai, Menelaos, um engenheiro civil que rec√©m publicou seu primeiro livro aos 80 anos de idade, foi quem me ensinou o pensamento l√≥gico e anal√≠tico, bem como o amor pela ci√™ncia e pela engenharia.</p>
</div>
<div class="paragraph data-line-125">
<p>Obrigado a todos voc√™s por me apoiarem durante esta jornada.</p>
</div>
<div class="paragraph data-line-3">
<p>Unresolved directive in for_use_mastering-bitcoin_preface-open_pt_BR.adoc - include::github_contrib.adoc[]</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="_gloss√°rio_r√°pido">Gloss√°rio R√°pido</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>Este gloss√°rio r√°pido cont√©m muitos dos termos relacionados ao bitcoin que s√£o usados nesse livro. Recomendamos que marque essa p√°gina para us√°-la como uma refer√™ncia r√°pida.</p>
</div>
<div class="dlist data-line-6">
<dl>
<dt class="hdlist1">endere√ßo (address)</dt>
<dd>
<p>A Bitcoin address looks like 1DSrfJdB2AnWaFNgSbv3MZC2m74996JafV. It consists of a string of letters and numbers. It&#8217;s really an encoded base58check version of a public key 160-bit hash. Just as you ask others to send an email to your email address, you would ask others to send you bitcoin to one of your Bitcoin addresses.</p>
</dd>
<dt class="hdlist1">bip</dt>
<dd>
<p><em>Bitcoin Improvement Proposals</em> (em portugu√™s, Propostas de Melhoria ao Bitcoin). Um conjunto de propostas que membros da comunidade bitcoin enviaram para melhorar o bitcoin. Por exemplo, a BIP-21 √© uma proposta para melhorar a estrutura do Identificador Uniforme de Recursos (URI) do bitcoin.</p>
</dd>
<dt class="hdlist1">bitcoin</dt>
<dd>
<p>O nome da unidade monet√°ria (da moeda), da rede e do software.</p>
</dd>
<dt class="hdlist1">bloco (block)</dt>
<dd>
<p>Um agrupamento de transa√ß√µes, marcado com um carimbo de data e hora (um <em>timestamp</em>) e uma impress√£o digital do bloco anterior. O cabe√ßalho do bloco √© submetido a <em>hashing</em> para produzir uma prova de trabalho, assim validando as transa√ß√µes. Os blocos v√°lidos s√£o adicionados √† blockchain principal atrav√©s do consenso da rede.</p>
</dd>
<dt class="hdlist1">blockchain (cadeia de blocos)</dt>
<dd>
<p>Uma lista de blocos validados, cada um ligado ao seu antecessor at√© chegar ao bloco g√™nese.</p>
</dd>
<dt class="hdlist1">recompensa do bloco/coinbase (block reward ou coinbase reward)</dt>
<dd>
<p>Uma quantidade de moedas inclu√≠da em cada novo bloco, que serve como uma recompensa da rede ao minerador que encontrou a solu√ß√£o da Prova-de-Trabalho. Aproximadamente a cada quatro anos, ou exatamente a cada 210.000 blocos, a recompensa do bloco √© reduzida pela metade (halving). Atualmente a recompensa √© de 6,25 BTC por bloco.</p>
</dd>
<dt class="hdlist1">Problema dos Generais Bizantinos</dt>
<dd>
<p>Um sistema de computador confi√°vel deve ser capaz de lidar com a falha de um ou mais de seus componentes. Um componente com falha pode exibir um tipo de comportamento que frequentemente pode passar despercebido‚Äîcomo enviar informa√ß√µes conflitantes para diferentes partes do sistema. O problema de lidar com esse tipo de falha √© expresso de maneira abstrata como o Problema dos Generais Bizantinos.</p>
</dd>
<dt class="hdlist1">bloco candidato (candidate block)</dt>
<dd>
<p>Um bloco que um minerador ainda est√° tentando minerar. Ainda n√£o √© considerado um bloco v√°lido, pois n√£o cont√©m uma Prova-de-Trabalho v√°lida.</p>
</dd>
<dt class="hdlist1">coinbase/dados coinbase (coinbase/coinbase data)</dt>
<dd>
<p>Um campo especial usado como entrada √∫nica para as transa√ß√µes coinbase. O campo de dados coinbase permite reivindicar a recompensa do bloco e fornece at√© 100 bytes para dados arbitr√°rios.
N√£o deve ser confundido com transa√ß√£o coinbase ou recompensa coinbase.</p>
</dd>
<dt class="hdlist1">transa√ß√£o coinbase</dt>
<dd>
<p>A primeira transa√ß√£o em um bloco. Sempre criada por um minerador, ela inclui uma √∫nica coinbase.
N√£o deve ser confundida com coinbase (dados coinbase) ou recompensa coinbase.</p>
</dd>
<dt class="hdlist1">armazenamento frio (<em>cold storage</em>)</dt>
<dd>
<p>Refere-se a manter uma reserva de bitcoin offline. O armazenamento frio √© obtido quando as chaves privadas s√£o criadas e armazenadas em um ambiente offline seguro. O armazenamento frio √© importante para qualquer pessoa que tenha economias em bitcoin. Os computadores online s√£o vulner√°veis a hackers e n√£o devem ser usados para armazenar uma quantidade significativa de bitcoin.</p>
</dd>
<dt class="hdlist1">confirma√ß√µes (confirmations)</dt>
<dd>
<p>Assim que uma transa√ß√£o √© inclu√≠da em um bloco, dizemos que ela tem uma confirma√ß√£o. Assim que <em>outro</em> bloco √© minerado na mesma blockchain, a transa√ß√£o passa a ter duas confirma√ß√µes, e assim por diante. Seis ou mais confirma√ß√µes s√£o consideradas como prova suficiente de que uma transa√ß√£o n√£o pode mais ser revertida.</p>
</dd>
<dt class="hdlist1">consenso (consensus)</dt>
<dd>
<p>Quando v√°rios n√≥s, geralmente a maioria dos n√≥s na rede, t√™m todos os mesmos blocos em sua melhor cadeia de blocos validada localmente.
N√£o deve ser confundido com regras de consenso.</p>
</dd>
<dt class="hdlist1">regras de consenso (consensus rules)</dt>
<dd>
<p>As regras de valida√ß√£o de bloco que os n√≥s completos seguem para permanecer em consenso com outros n√≥s.
N√£o deve ser confundido com consenso.</p>
</dd>
<dt class="hdlist1">dificuldade (difficulty)</dt>
<dd>
<p>Uma configura√ß√£o que √© definida em toda a rede e controla quanto esfor√ßo computacional √© necess√°rio para produzir uma prova de trabalho.</p>
</dd>
<dt class="hdlist1">reajuste do alvo de dificuldade (difficulty retargeting)</dt>
<dd>
<p>Um rec√°lculo da dificuldade que ocorre em toda a rede a cada 2.016 blocos, levando em considera√ß√£o o poder de <em>hashing</em> dos 2.016 blocos anteriores.</p>
</dd>
<dt class="hdlist1">alvo da dificuldade (difficulty target)</dt>
<dd>
<p>Uma dificuldade na qual todo o poder computacional da rede encontrar√° blocos aproximadamente a cada 10 minutos.</p>
</dd>
<dt class="hdlist1">gasto duplo (double-spend)</dt>
<dd>
<p>O gasto duplo ocorre quando algu√©m gasta com sucesso uma quantia de dinheiro mais de uma vez. O bitcoin protege contra gastos duplos ao verificar cada transa√ß√£o que √© adicionada √† cadeia de blocos, certificando-se de que as entradas da transa√ß√£o ainda n√£o tenham sido gastas.</p>
</dd>
<dt class="hdlist1">ECDSA</dt>
<dd>
<p>O Algoritmo de Assinatura Digital de Curva El√≠ptica (em ingl√™s <em>Elliptic Curve Digital Signature Algorithm</em> ou ECDSA) √© um algoritmo criptogr√°fico usado pelo bitcoin para garantir que os fundos s√≥ possam ser gastos pelos seus leg√≠timos propriet√°rios.</p>
</dd>
<dt class="hdlist1">nonce extra</dt>
<dd>
<p>√Ä medida que a dificuldade de minera√ß√£o aumentou, os mineradores frequentemente percorriam todos os 4 bilh√µes de valores do nonce sem encontrar um bloco. Como o script coinbase pode armazenar entre 2 e 100 bytes de dados, os mineradores come√ßaram a usar esse espa√ßo como espa√ßo de nonce extra, permitindo-lhes explorar um intervalo muito maior de valores de cabe√ßalho de bloco para encontrar blocos v√°lidos.</p>
</dd>
<dt class="hdlist1">taxas (fees)</dt>
<dd>
<p>O remetente de uma transa√ß√£o geralmente inclui uma taxa para a rede pelo processamento da transa√ß√£o solicitada. A maioria das transa√ß√µes exige uma taxa m√≠nima de 0,5 mBTC.</p>
</dd>
<dt class="hdlist1">fork (bifurca√ß√£o)</dt>
<dd>
<p>O fork, tamb√©m conhecido como fork acidental, ocorre quando dois ou mais blocos t√™m a mesma altura de bloco, bifurcando a cadeia de blocos (blockchain). Normalmente ocorre quando dois ou mais mineradores encontram blocos quase ao mesmo tempo. Tamb√©m pode acontecer como parte de um ataque.</p>
</dd>
<dt class="hdlist1">bloco g√™nese (genesis block)</dt>
<dd>
<p>O primeiro bloco na blockchain, usado para inicializar a criptomoeda.</p>
</dd>
<dt class="hdlist1">halving</dt>
<dd>
<p>Um evento de <em>halving</em> (redu√ß√£o pela metade) ocorre quando a recompensa do bloco √© cortada pela metade, o que acontece aproximadamente a cada quatro anos (ou precisamente a cada 210.000 blocos). O bitcoin j√° teve tr√™s eventos de <em>halving</em>: em 2012 (de 50 para 25 BTC), em 2016 (de 25 para 12,5 BTC) e em 2020 (de 12,5 para 6,25 BTC).</p>
</dd>
<dt class="hdlist1">hard fork</dt>
<dd>
<p>O hard fork, tamb√©m conhecido como "mudan√ßa causadora de hard fork", √© uma diverg√™ncia permanente na blockchain, que geralmente ocorre quando n√≥s n√£o atualizados n√£o conseguem validar os blocos criados pelo n√≥s atualizados que seguem novas regras de consenso.
N√£o deve ser confundido com fork, soft fork, fork do software ou fork do Git.</p>
</dd>
<dt class="hdlist1">carteira de hardware</dt>
<dd>
<p>Uma carteira de hardware √© um tipo especial de carteira de bitcoin que armazena as chaves privadas do usu√°rio em um dispositivo de hardware seguro.</p>
</dd>
<dt class="hdlist1">hash</dt>
<dd>
<p>Uma impress√£o digital de alguma entrada bin√°ria.</p>
</dd>
<dt class="hdlist1">hashlocks</dt>
<dd>
<p>Um hashlock √© um tipo de trava que restringe o gasto de uma sa√≠da at√© que um dado espec√≠fico seja revelado publicamente. Os hashlocks t√™m a propriedade √∫til de que, uma vez que qualquer hashlock seja aberto publicamente, qualquer outro hashlock protegido usando a mesma chave tamb√©m pode ser aberto. Isso torna poss√≠vel criar v√°rias sa√≠das que s√£o todas travadas pelo mesmo hashlock e que se tornam todas gast√°veis ao mesmo tempo.</p>
</dd>
<dt class="hdlist1">protocolo HD (HD protocol)</dt>
<dd>
<p>O protocolo de transfer√™ncia e cria√ß√£o de chave Determin√≠stica Hier√°rquica (HD) (BIP-32), que permite criar chaves filhas a partir de chaves pais em uma hierarquia.</p>
</dd>
<dt class="hdlist1">carteira HD (HD wallet)</dt>
<dd>
<p>Carteiras usando o protocolo de cria√ß√£o de chave e de transfer√™ncia Determin√≠stica Hier√°rquica (Protocolo HD) (BIP-32).</p>
</dd>
<dt class="hdlist1">semente (seed) da carteira HD</dt>
<dd>
<p>A semente da carteira HD ou semente raiz √© um valor potencialmente curto usado como uma semente para gerar a chave privada mestra e o c√≥digo de cadeia mestre para uma carteira HD.</p>
</dd>
<dt class="hdlist1">HTLC</dt>
<dd>
<p>Um Contrato de Hash TimeLock ou HTLC √© uma classe de pagamentos que usa travas de hash e de tempo (hashlocks e timelocks) para exigir que o receptor de um pagamento ou reconhe√ßa o recebimento do pagamento antes de um prazo ao gerar prova criptogr√°fica de pagamento, ou perca a capacidade de reivindicar o pagamento, devolvendo-o para o pagador.</p>
</dd>
<dt class="hdlist1">KYC</dt>
<dd>
<p><em>Conhe√ßa seu cliente</em> (em ingl√™s, <em>Know your customer</em> ou KYC) √© o processo no qual uma empresa identifica e verifica a identidade de seus clientes. O termo tamb√©m √© usado para se referir ao regulamento banc√°rio que rege essas atividades.</p>
</dd>
<dt class="hdlist1">LevelDB</dt>
<dd>
<p>A LevelDB √© uma biblioteca de armazenamento de c√≥digo aberto baseada em pares de chave-valor com armazento em disco. A LevelDB √© uma biblioteca para persist√™ncia, leve e de prop√≥sito √∫nico, com liga√ß√µes para muitas plataformas.</p>
</dd>
<dt class="hdlist1">Lightning Networks (Redes Lightning)</dt>
<dd>
<p>A Lightning Network √© uma implementa√ß√£o de Contratos Hash Timelock (HTLCs) com canais de pagamento bidirecionais que permitem que os pagamentos sejam roteados com seguran√ßa em v√°rios canais de pagamento par-a-par. Isso permite a forma√ß√£o de uma rede onde qualquer par da rede possa pagar a qualquer outro par, mesmo que eles n√£o tenham um canal aberto diretamente entre si.</p>
</dd>
<dt class="hdlist1">Locktime</dt>
<dd>
<p>O Locktime, ou mais tecnicamente o nLockTime, √© a parte de uma transa√ß√£o que indica o primeiro momento no tempo ou o primeiro bloco em que essa transa√ß√£o pode ser adicionada √† cadeia de blocos.</p>
</dd>
<dt class="hdlist1">mempool</dt>
<dd>
<p>The bitcoin Mempool (memory pool) is a collection of all transaction data in a block that have been verified by Bitcoin nodes, but are not yet confirmed.</p>
</dd>
<dt class="hdlist1">raiz de merkle (merkle root)</dt>
<dd>
<p>O n√≥ raiz de uma √°rvore de merkle, um descendente de todos os pares de hash na √°rvore. Os cabe√ßalhos de bloco devem incluir uma raiz de merkle v√°lida que seja descendente de todas as transa√ß√µes inclu√≠das naquele bloco.</p>
</dd>
<dt class="hdlist1">√°rvore de merkle (merkle tree)</dt>
<dd>
<p>Uma √°rvore que √© constru√≠da ao se fazer <em>hashing</em> de dados dispostos em pares (as folhas), cujos resultados s√£o dispostos em pares e novamente s√£o submetidos a <em>hashing</em>, at√© permanecer um √∫nico hash, que √© a raiz de merkle. No bitcoin, as folhas quase sempre s√£o transa√ß√µes de um √∫nico bloco.</p>
</dd>
<dt class="hdlist1">minerador (miner)</dt>
<dd>
<p>Um n√≥ da rede que encontra uma prova de trabalho v√°lida para novos blocos, ao fazer repetidos <em>hashings</em>.</p>
</dd>
<dt class="hdlist1">recompensa da minera√ß√£o (mining reward)</dt>
<dd>
<p>A recompensa que os mineradores recebem em troca da seguran√ßa fornecida pela minera√ß√£o. Inclui as novas moedas criadas em cada novo bloco, tamb√©m conhecido como recompensa de bloco ou recompensa coinbase, e as taxas de transa√ß√£o de todas as transa√ß√µes inclu√≠das no bloco.</p>
</dd>
<dt class="hdlist1">multiassinatura (multisignature ou multisig)</dt>
<dd>
<p>Multiassinatura refere-se √† exig√™ncia de um n√∫mero m√≠nimo (M) de chaves (N) para autorizar uma transa√ß√£o M-de-N.</p>
</dd>
<dt class="hdlist1">rede (network)</dt>
<dd>
<p>A peer-to-peer network that propagates transactions and blocks to every Bitcoin node on the network.</p>
</dd>
<dt class="hdlist1">nonce</dt>
<dd>
<p>O "nonce" em um bloco de bitcoin √© um campo de 32 bits (4 bytes) cujo valor √© definido de forma que o hash do bloco contenha uma sequ√™ncia de zeros iniciais. Os demais campos n√£o podem ser alterados, pois eles possuem um significado definido.</p>
</dd>
<dt class="hdlist1">transa√ß√µes off-chain/fora da cadeia</dt>
<dd>
<p>Uma transa√ß√£o <em>off-chain</em> √© a movimenta√ß√£o de valor fora da cadeia de blocos (da blockchain). Enquanto uma transa√ß√£o <em>on-chain</em>&#x2014;geralmente chamada simplesmente de <em>uma transa√ß√£o</em>&#x2014;modifica a blockchain e depende da blockchain para determinar sua validade, uma transa√ß√£o <em>off-chain</em> depende de outros m√©todos para registrar e validar a transa√ß√£o.</p>
</dd>
<dt class="hdlist1">c√≥digo operacional (opcode)</dt>
<dd>
<p>C√≥digos de opera√ß√£o da linguagem Script do bitcoin que adicionam dados ou executam fun√ß√µes em um script pubkey ou um script de assinatura.</p>
</dd>
<dt class="hdlist1">protocolo de Ativos Abertos (Open Assets protocol)</dt>
<dd>
<p>The Open Assets Protocol is a simple and powerful protocol built on top of the Bitcoin blockchain. It allows issuance and transfer of user-created assets.</p>
</dd>
<dt class="hdlist1">OP_RETURN</dt>
<dd>
<p>Um c√≥digo operacional usado em uma das sa√≠das em uma transa√ß√£o OP_RETURN. N√£o deve ser confundido com uma transa√ß√£o OP_RETURN.</p>
</dd>
<dt class="hdlist1">transa√ß√£o OP_RETURN</dt>
<dd>
<p>Um tipo de transa√ß√£o que adiciona dados arbitr√°rios a um script pubkey comprovadamente imposs√≠vel de ser gasto, que os n√≥s completos n√£o precisam armazenar em seu banco de dados de UTXOs. N√£o deve ser confundida com um c√≥digo operacional OP_RETURN.</p>
</dd>
<dt class="hdlist1">bloco √≥rf√£o (orphan block)</dt>
<dd>
<p>Blocos cujo bloco pai n√£o foi processado pelo n√≥ local, portanto, ainda n√£o podem ser totalmente validados. N√£o devem ser confundido com bloco obsoleto.</p>
</dd>
<dt class="hdlist1">transa√ß√µes √≥rf√£s</dt>
<dd>
<p>Transa√ß√µes que n√£o podem entrar na <em>pool</em> devido a uma ou mais transa√ß√µes de entrada ausentes.</p>
</dd>
<dt class="hdlist1">sa√≠da de transa√ß√£o (output)</dt>
<dd>
<p>Uma sa√≠da (em ingl√™s, <em>output</em>), sa√≠da de transa√ß√£o ou TxOut √© uma sa√≠da em uma transa√ß√£o que cont√©m dois campos: um campo de valor para transferir zero ou mais satoshis e um script pubkey para indicar quais condi√ß√µes devem ser cumpridas para que esses satoshis possam sejam gastos posteriormente.</p>
</dd>
<dt class="hdlist1">P2PKH</dt>
<dd>
<p>Transactions that pay a Bitcoin address contain P2PKH or Pay To PubKey Hash scripts. An output locked by a P2PKH script can be unlocked (spent) by presenting a public key and a digital signature created by the corresponding private key.</p>
</dd>
<dt class="hdlist1">P2SH</dt>
<dd>
<p>P2SH ou Pay-to-Script-Hash (em portugu√™s, Paga-para-Hash-de-Script) √© um novo tipo poderoso de transa√ß√£o que simplifica muito o uso de scripts de transa√ß√£o complexos. Com o P2SH, o script complexo que detalha as condi√ß√µes para se gastar a sa√≠da (o script de resgate) n√£o √© apresentado no script de travamento. Em vez disso, inclui-se apenas um hash do script de resgate no script de travamento.</p>
</dd>
<dt class="hdlist1">P2SH, endere√ßo</dt>
<dd>
<p>Os endere√ßos P2SH s√£o codifica√ß√µes Base58Check do hash de 20 bytes de um script. Eles usam o prefixo de vers√£o "5", o que resulta em endere√ßos codificados por Base58Check que come√ßam com "3". Os endere√ßos P2SH escondem toda a complexidade, para que a pessoa que faz o pagamento n√£o veja o script.</p>
</dd>
<dt class="hdlist1">P2WPKH</dt>
<dd>
<p>A assinatura de um P2WPKH (Pay-to-Witness-Public-Key-Hash ou Paga-para-Testemunha-de-Hash-de-Chave-P√∫blica) cont√©m as mesmas informa√ß√µes que um pagamento P2PKH, mas est√° localizada no campo testemunha ao inv√©s do campo scriptSig. O scriptPubKey tamb√©m √© modificado.</p>
</dd>
<dt class="hdlist1">P2WSH</dt>
<dd>
<p>A diferen√ßa existente entre o P2SH e o P2WSH (Pay-to-Witness-Script-Hash ou Paga-para-Testemunha-de-Hash-de-Script) √© a mudan√ßa do local da prova criptogr√°fica do campo scriptSig para o campo testemunha, assim como o scriptPubKey, que tamb√©m √© modificado.</p>
</dd>
<dt class="hdlist1">carteira de papel (paper wallet)</dt>
<dd>
<p>No sentido mais espec√≠fico, uma carteira de papel √© um documento que cont√©m todos os dados necess√°rios para gerar qualquer quantidade de chaves privadas de bitcoin, formando uma carteira de chaves. No entanto, as pessoas costumam usar o termo para se referir a qualquer maneira de armazenar bitcoin offline como um documento f√≠sico. Esta segunda defini√ß√£o tamb√©m inclui chaves de papel e c√≥digos resgat√°veis.</p>
</dd>
<dt class="hdlist1">frase de senha (passphrase)</dt>
<dd>
<p>Uma frase de senha (em ingl√™s, <em>passphrase</em>) √© uma <em>string</em> opcional criada pelo usu√°rio que serve como um fator de seguran√ßa adicional protegendo a semente, mesmo quando a semente for comprometida por furto ou roubo. Ela tamb√©m pode ser usada como uma forma de nega√ß√£o plaus√≠vel, quando se usa uma frase de senha para abrir uma carteira com uma quantidade menor de fundos, a qual √© usada para distrair um criminoso da carteira "verdadeira", que cont√©m a maioria dos fundos.</p>
</dd>
<dt class="hdlist1">canais de pagamento (payment channels)</dt>
<dd>
<p>A micropayment channel or payment channel is a class of techniques designed to allow users to make multiple bitcoin transactions without committing all of the transactions to the Bitcoin blockchain. In a typical payment channel, only two transactions are added to the block chain but an unlimited or nearly unlimited number of payments can be made between the participants.</p>
</dd>
<dt class="hdlist1">pool, minera√ß√£o em (pooled mining)</dt>
<dd>
<p>A minera√ß√£o em pool √© uma modalidade de minera√ß√£o na qual v√°rios clientes geradores contribuem para a gera√ß√£o de um bloco e, em seguida, dividem a recompensa do bloco de acordo com o poder de processamento contribu√≠do.</p>
</dd>
<dt class="hdlist1">Proof-of-Stake</dt>
<dd>
<p>O Proof-of-Stake (PoS) (em portugu√™s, Prova de Participa√ß√£o, Prova de Montante ou Prova de Aposta) √© um m√©todo atrav√©s do qual a rede de blockchain de uma criptomoeda visa alcan√ßar um consenso distribu√≠do. O Proof-of-Stake pede aos usu√°rios que comprovem a posse de uma certa quantidade de moeda (que √© o seu "stake" na moeda).</p>
</dd>
<dt class="hdlist1">Prova-de-Trabalho (Proof-of-Work)</dt>
<dd>
<p>Um dado que requer computa√ß√£o significativa para ser encontrado. No bitcoin, os mineradores precisam encontrar uma solu√ß√£o num√©rica para o algoritmo SHA256 que atenda a um alvo que √© definido em toda a rede, o alvo de dificuldade.</p>
</dd>
<dt class="hdlist1">RIPEMD-160</dt>
<dd>
<p>A RIPEMD-160 √© uma fun√ß√£o de hash criptogr√°fica de 160 bits. A RIPEMD-160 √© uma vers√£o refor√ßada da RIPEMD que tem como resultado um hash de 160 bits, e espera-se que seja segura nos pr√≥ximos dez anos ou mais.</p>
</dd>
<dt class="hdlist1">satoshi</dt>
<dd>
<p>Um satoshi √© a menor denomina√ß√£o de bitcoin que pode ser registrada na <em>blockchain</em>. √â o equivalente a 0,00000001 bitcoin e recebe o nome em homenagem ao criador do bitcoin, Satoshi Nakamoto. </p>
</dd>
<dt class="hdlist1">Satoshi Nakamoto</dt>
<dd>
<p>Satoshi Nakamoto √© o nome usado pela pessoa ou pelo grupo de pessoas que projetou o bitcoin e criou sua implementa√ß√£o de refer√™ncia original, o Bitcoin Core. Como parte da implementa√ß√£o, eles tamb√©m criaram o primeiro banco de dados de blockchain. No processo, eles foram os primeiros a resolver o problema do gasto duplo em moedas digitais. Sua verdadeira identidade permanece desconhecida.</p>
</dd>
<dt class="hdlist1">Script</dt>
<dd>
<p>O bitcoin usa um sistema de script para transa√ß√µes. Semelhante ao Forth, o Script √© simples, baseado em pilha e √© processado da esquerda para a direita. Ele √© propositalmente n√£o Turing completo, sem loops.</p>
</dd>
<dt class="hdlist1">ScriptPubKey (script pubkey) </dt>
<dd>
<p>Um ScriptPubKey, ou script pubkey, √© um script inclu√≠do nas sa√≠das que define as condi√ß√µes que devem ser cumpridas para que esses satoshis sejam gastos. Os dados para o cumprimento das condi√ß√µes podem ser fornecidos em um script de assinatura.</p>
</dd>
<dt class="hdlist1">ScriptSig (script de assinatura)</dt>
<dd>
<p>Um ScriptSig, ou script de assinatura, s√£o os dados gerados por um pagador que quase sempre s√£o usados como vari√°veis para satisfazer um script pubkey.</p>
</dd>
<dt class="hdlist1">chave secreta/chave privada (secret key/private key)</dt>
<dd>
<p>O n√∫mero secreto que destrava os bitcoins enviados para o endere√ßo correspondente. Uma chave <span class="keep-together">secreta</span> tem a seguinte apar√™ncia:</p>
<div class="listingblock data-line-221">
<div class="content">
<pre>5J76sF8L5jTtzE96r66Sf8cka9y44wdpJjMwCxR3tzLh3ibVPxh</pre>
</div>
</div>
</dd>
<dt class="hdlist1">Segregated Witness</dt>
<dd>
<p>Segregated Witness (em portugu√™s, Testemunha Segregada) √© uma atualiza√ß√£o do protocolo Bitcoin no qual os dados de assinatura (a "testemunha") s√£o separados dos dados do remetente/destinat√°rio para otimizar ainda mais a estrutura das transa√ß√µes. A Segregated Witness foi implementada como um soft fork; uma mudan√ßa que tecnicamente torna mais restritivas as regras do protocolo do bitcoin.</p>
</dd>
<dt class="hdlist1">SHA</dt>
<dd>
<p>O Algoritmo de Hash Seguro (em ingl√™s, <em>Secure Hash Algorithm</em> ou SHA) √© uma fam√≠lia de fun√ß√µes de hash criptogr√°ficas publicadas pelo Instituto Nacional de Padr√µes e Tecnologia (<em>National Institute of Standards and Technology</em> ou NIST).</p>
</dd>
<dt class="hdlist1">SPV (Verifica√ß√£o de Pagamento Simplificada)</dt>
<dd>
<p>SPV ou verifica√ß√£o de pagamento simplificada (em ingl√™s, <em>simplified payment verification</em>) √© um m√©todo para verificar se determinadas transa√ß√µes foram inclu√≠das em um bloco, sem precisar fazer o download do bloco inteiro. Este m√©todo de verifica√ß√£o √© frequentemente usado por clientes leves de bitcoin.</p>
</dd>
<dt class="hdlist1">soft fork</dt>
<dd>
<p>Um soft fork ou "mudan√ßa causadora de soft fork" √© uma bifurca√ß√£o tempor√°ria na blockchain que normalmente ocorre quando os mineradores que usam n√≥s n√£o atualizados n√£o seguem uma nova regra de consenso, pois seus n√≥s n√£o conhecem essa nova regra.
N√£o deve ser confundido com fork, hard fork, fork de software ou fork do Git.</p>
</dd>
<dt class="hdlist1">bloco obsoleto (<em>stale block</em>)</dt>
<dd>
<p>Um bloco v√°lido que foi minerado com sucesso, mas que n√£o est√° inclu√≠do no ramo principal atual (com a maior Prova-de-Trabalho acumulada), pois algum outro bloco v√°lido foi minerado na mesma altura e teve sua cadeia estendida primeiro. O minerador de um bloco obsoleto n√£o fica com a recompensa do bloco ou as taxas das transa√ß√µes desse bloco.
N√£o deve ser confundido com bloco √≥rf√£o ou bloco candidato.</p>
</dd>
<dt class="hdlist1">timelocks</dt>
<dd>
<p>Um timelock √© um tipo de trava que restringe o gasto de alguns bitcoins at√© um determinado per√≠odo/data no futuro ou uma altura de bloco. Os timelocks s√£o muito usados em contratos de bitcoin, incluindo canais de pagamento e contratos hash time lock (HTLC).</p>
</dd>
<dt class="hdlist1">transa√ß√£o (transaction)</dt>
<dd>
<p>In simple terms, a transfer of bitcoin from one address to another. More precisely, a transaction is a signed data structure expressing a transfer of value. Transactions are transmitted over the Bitcoin network, collected by miners, and included into blocks, made permanent on the blockchain.</p>
</dd>
<dt class="hdlist1">pool de transa√ß√µes (transaction pool)</dt>
<dd>
<p>Uma cole√ß√£o n√£o ordenada de transa√ß√µes que n√£o est√£o em blocos na cadeia principal, mas para as quais temos transa√ß√µes de entrada.</p>
</dd>
<dt class="hdlist1">completude de Turing (Turing completeness)</dt>
<dd>
<p>Uma linguagem de programa√ß√£o √© chamada de "Turing completa" se ela puder executar qualquer programa que uma m√°quina de Turing possa executar, dado tempo e mem√≥ria suficientes.</p>
</dd>
<dt class="hdlist1">sa√≠da de transa√ß√£o n√£o gasta (unspent transaction output ou UTXO)</dt>
<dd>
<p>Uma UTXO √© uma sa√≠da de transa√ß√£o n√£o gasta que pode ser gasta como uma entrada em uma nova transa√ß√£o.</p>
</dd>
<dt class="hdlist1">carteira (wallet)</dt>
<dd>
<p>Software that holds all your Bitcoin addresses and secret keys. Use it to send, receive, and store your bitcoin.</p>
</dd>
<dt class="hdlist1">WIF - Wallet Import Format (Formato de Importa√ß√£o de Carteira)</dt>
<dd>
<p>O WIF ou Wallet Import Format √© um formato de interc√¢mbio de dados projetado para permitir a exporta√ß√£o e a importa√ß√£o de uma chave privada com um sinalizador indicando se ela usa ou n√£o uma chave p√∫blica comprimida.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-5">
<p>Algumas defini√ß√µes contribu√≠das foram obtidas sob uma licen√ßa CC-BY a partir da <a href="https://en.bitcoin.it/wiki/Main_Page" data-href="https://en.bitcoin.it/wiki/Main_Page">Wiki do bitcoin</a> ou de outras fontes de documenta√ß√£o de c√≥digo aberto.</p>
</div>
</div>
</div>
<div class="sect1 pagenumrestart data-line-3">
<h2 id="ch01_intro_what_is_bitcoin">Introdu√ß√£o</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1 data-line-5">
<h2 id="_o_que_√©_o_bitcoin">O que √© o Bitcoin?</h2>
<div class="sectionbody">
<div class="paragraph data-line-7">
<p>Bitcoin √© um conjunto de conceitos e tecnologias que formam as bases de um ecossistema de dinheiro digital. Unidades de moeda chamadas de bitcoin s√£o utilizadas para armazenar e transmitir valor entre participantes na rede Bitcoin. Usu√°rios da Bitcoin comunicam-se entre si utilizando o protocolo Bitcoin primariamente por meio da internet, embora outras redes de transporte tamb√©m possam ser utilizadas. A pilha de protocolos Bitcoin, dispon√≠vel como um software de c√≥digo aberto, pode ser executada numa ampla gama de dispositivos computacionais, incluindo notebooks e smartphones, tornando a tecnologia de f√°cil acesso.</p>
</div>
<div class="admonitionblock tip data-line-10">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-11">
<p>Note como a unidade de conta √© chamada de "bitcoin" com <em>b</em> min√∫sculo, e o sistema √© chamado de "Bitcoin", como <em>B</em> mai√∫sculo.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-14">
<p>Os usu√°rios podem transferir bitcoins atrav√©s da rede para fazer as mesmas atividades que as moedas convencionais podem fazer, incluindo comprar e vender bens, enviar dinheiro a pessoas e organiza√ß√µes ou mesmo conceder cr√©dito. Os bitcoins podem ser comprados, vendidos ou trocados por outras moedas em casas de c√¢mbio especializadas, conhecidas como <em>exchanges</em> ou corretoras. De certo modo, o bitcoin √© o dinheiro perfeito para a Internet, pois √© r√°pido, seguro e sem fronteiras.</p>
</div>
<div class="paragraph data-line-16">
<p>Ao contr√°rio das moedas tradicionais, o bitcoin √© totalmente virtual. N√£o existem moedas f√≠sicas ou mesmo moedas digitais em si. As moedas est√£o impl√≠citas em transa√ß√µes que transferem valor do remetente para o destinat√°rio. Os usu√°rios de Bitcoin possuem chaves que lhes permitem provar serem donos de bitcoin na rede Bitcoin. Com essas chaves, eles podem assinar transa√ß√µes para desbloquear o valor e gast√°-lo, transferindo-o para um novo propriet√°rio. As chaves geralmente s√£o armazenadas em uma carteira digital no computador ou smartphone de cada usu√°rio. A posse da chave que pode assinar uma transa√ß√£o √© o √∫nico pr√©-requisito para gastar bitcoin, colocando o controle inteiramente nas m√£os de cada usu√°rio.</p>
</div>
<div class="paragraph data-line-18">
<p>Bitcoin √© um sistema distribu√≠do ponto a ponto (P2P). Como tal, n√£o existe um servidor central ou ponto de controle. Bitcoins, ou seja, unidades de bitcoin, s√£o criadas atrav√©s de um processo chamado minera√ß√£o, que envolve competir para encontrar solu√ß√µes para um problema matem√°tico durante o processamento de transa√ß√µes de Bitcoin. Qualquer participante da rede Bitcoin (ou seja, qualquer pessoa que use um dispositivo executando a pilha completa do protocolo Bitcoin) pode operar como um minerador, usando o poder de processamento de seu computador para verificar e registrar transa√ß√µes. A cada 10 minutos, em m√©dia, um minerador de Bitcoin pode validar as transa√ß√µes dos √∫ltimos 10 minutos e √© recompensado com um novo bitcoin. Essencialmente, a minera√ß√£o de Bitcoin descentraliza as fun√ß√µes de emiss√£o de moeda e compensa√ß√£o de um banco central, e substitui a necessidade de qualquer banco central.</p>
</div>
<div class="paragraph data-line-20">
<p>O protocolo Bitcoin inclui algoritmos integrados que regulam a fun√ß√£o de minera√ß√£o em toda a rede. A dificuldade da tarefa de processamento que os mineradores devem realizar √© ajustada dinamicamente para que, em m√©dia, algu√©m tenha sucesso a cada 10 minutos, independentemente de quantos mineradores (e quanto processamento) estejam competindo a qualquer momento. O protocolo tamb√©m reduz pela metade a taxa na qual novos bitcoins s√£o criados a cada 4 anos, e limita o n√∫mero total de bitcoins que ser√£o criados a um total fixo logo abaixo de 21 milh√µes de moedas. O resultado √© que o n√∫mero de bitcoin em circula√ß√£o segue de perto uma curva facilmente previs√≠vel que se aproxima de 21 milh√µes no ano de 2140. Devido √† diminui√ß√£o da taxa de emiss√£o do bitcoin, a longo prazo, a moeda Bitcoin √© deflacion√°ria. Al√©m disso, o bitcoin n√£o pode ser inflado ‚Äúimprimindo‚Äù dinheiro novo acima e al√©m da taxa de emiss√£o esperada.</p>
</div>
<div class="paragraph data-line-22">
<p>Nos bastidores, Bitcoin tamb√©m √© o nome do protocolo, uma rede peer-to-peer e uma inova√ß√£o na computa√ß√£o distribu√≠da. A moeda bitcoin √© realmente apenas a primeira aplica√ß√£o desta inven√ß√£o. Bitcoin representa o culminar de d√©cadas de pesquisa em criptografia e sistemas distribu√≠dos, e inclui quatro inova√ß√µes principais reunidas em uma combina√ß√£o √∫nica e poderosa. Bitcoin consiste em:</p>
</div>
<div class="ulist data-line-24">
<ul>
<li class="data-line-24">
<p>Uma rede peer to peer descentralizada (o protocolo Bitcoin)</p>
</li>
<li class="data-line-25">
<p>Um registro p√∫blico de transa√ß√µes (a <em>blockchain</em> ou cadeia de blocos)</p>
</li>
<li class="data-line-26">
<p>Um conjunto de regras para valida√ß√£o independente de transa√ß√µes e emiss√£o de moedas (regras de consenso)</p>
</li>
<li class="data-line-27">
<p>Um mecanismo para alcan√ßar um consenso descentralizado global sobre qual √© a <em>blockchain</em> v√°lida (algoritmo de Prova-de-Trabalho)</p>
</li>
</ul>
</div>
<div class="paragraph data-line-29">
<p>Como desenvolvedor, vejo o Bitcoin como semelhante √† internet do dinheiro, uma rede para propagar valor e garantir a propriedade de ativos digitais por meio de computa√ß√£o distribu√≠da. H√° muito mais no Bitcoin do que parece √† primeira vista.</p>
</div>
<div class="paragraph data-line-31">
<p>Neste cap√≠tulo, come√ßaremos explicando alguns dos principais conceitos e termos, obtendo o software necess√°rio e usando o Bitcoin para transa√ß√µes simples. Nos cap√≠tulos seguintes, vamos come√ßar a desembrulhar as camadas de tecnologia que tornam o Bitcoin poss√≠vel e examinar o funcionamento interno da rede e do protocolo Bitcoin.</p>
</div>
<div class="paragraph pagebreak-before less_space data-line-34">
<p>Moedas Digitais Antes do Bitcoin</p>
</div>
<div class="sidebarblock data-line-35">
<div class="content">
<div class="paragraph data-line-37">
<p>O surgimento de uma moeda digital vi√°vel est√° intimamente relacionado √† evolu√ß√£o da criptografia. Isso n√£o √© algo surpreendente quando se leva em considera√ß√£o os desafios fundamentais que existem em se usar bits para representar um valor que pode ser trocado por bens e servi√ßos. Tr√™s perguntas b√°sicas que s√£o feitas por qualquer pessoa que aceita um dinheiro digital s√£o:</p>
</div>
<div class="olist arabic data-line-39">
<ol class="arabic">
<li class="data-line-39">
<p>Posso confiar que o dinheiro √© aut√™ntico e n√£o √© falsificado?</p>
</li>
<li class="data-line-40">
<p>Posso confiar que o dinheiro digital s√≥ pode ser gasto uma √∫nica vez (conhecido como o problema do "gasto duplo")?</p>
</li>
<li class="data-line-41">
<p>Posso estar seguro de que ningu√©m vai alegar que esse dinheiro lhe pertence, e n√£o pertence a mim?</p>
</li>
</ol>
</div>
<div class="paragraph data-line-43">
<p>Os emissores de c√©dulas de dinheiro est√£o constantemente enfrentando o problema da falsifica√ß√£o atrav√©s do uso de pap√©is e tecnologias de impress√£o cada vez mais sofisticados. O dinheiro f√≠sico resolve facilmente o problema do gasto duplo, pois a mesma nota de papel n√£o pode estar em dois lugares ao mesmo tempo. Mas o dinheiro convencional tamb√©m √© frequentemente armazenado e transmitido de forma digital. Nestes casos, os problemas de falsifica√ß√£o e de gasto duplo s√£o resolvidos atrav√©s da compensa√ß√£o de todas as transa√ß√µes eletr√¥nicas por autoridades centrais que det√™m uma vis√£o global da moeda em circula√ß√£o. No caso do dinheiro digital, que n√£o pode se beneficiar de tintas especiais ou marcas hologr√°ficas, a criptografia proporciona a base para se confiar na legitimidade de um valor que um usu√°rio afirma possuir. Especificamente, as assinaturas digitais criptogr√°ficas permitem que um usu√°rio assine um ativo digital ou uma transa√ß√£o que comprove a posse do ativo. Com a arquitetura apropriada, as assinaturas digitais tamb√©m podem ser usadas para resolver o problema do gasto duplo.</p>
</div>
<div class="paragraph data-line-45">
<p>No final dos anos 1980, quando a criptografia come√ßou a se tornar mais acess√≠vel e entendida, muitos pesquisadores come√ßaram a tentar us√°-la para construir moedas digitais. Estes projetos pioneiros emitiram diferentes formas de dinheiro digital, normalmente lastreadas por uma moeda nacional ou um metal precioso - como o ouro.</p>
</div>
<div class="paragraph data-line-47">
<p>Apesar de essas moedas digitais pioneiras terem funcionado, elas eram centralizadas e, como resultado, eram f√°ceis de serem atacadas tanto por governos como por hackers. As primeiras moedas digitais usavam uma c√¢mara de compensa√ß√£o central para liquidar todas as transa√ß√µes em intervalos regulares, da mesma forma que um sistema banc√°rio tradicional. Infelizmente, na maior parte dos casos, essas moedas digitais precursoras se tornaram alvo de governos preocupados e acabaram sendo aniquiladas judicialmente. Algumas fracassaram em quebras espetaculares quando a companhia respons√°vel foi liquidada repentinamente. Para se ter robustez contra a interven√ß√£o de opositores, sejam eles governos leg√≠timos ou agentes criminosos, era necess√°ria a cria√ß√£o de uma moeda digital <em>descentralizada</em>, que n√£o tivesse um √∫nico ponto de ataque. O bitcoin √© um sistema desse tipo, projetado para ser descentralizado e livre de qualquer autoridade central ou ponto de controle centralizado que possa ser atacado ou corrompido.</p>
</div>
</div>
</div>
<div class="sect2 data-line-51">
<h3 id="_a_hist√≥ria_do_bitcoin">A Hist√≥ria do Bitcoin</h3>
<div class="paragraph data-line-53">
<p>O bitcoin foi inventado em 2008 com a publica√ß√£o de um artigo intitulado "Bitcoin: Um Sistema de Dinheiro em Esp√©cie Eletr√¥nico Par-a-Par,"<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup> escrito por um autor sob o pseud√¥nimo de Satoshi Nakamoto (ver <a href="#satoshi_whitepaper">[satoshi_whitepaper]</a>). Nakamoto combinou v√°rias inven√ß√µes anteriores como o b-money e o HashCash para criar um sistema de dinheiro em esp√©cie eletr√¥nico completamente descentralizado que n√£o depende de uma autoridade central para a emiss√£o ou liquida√ß√£o da moeda e para a valida√ß√£o de transa√ß√µes. A inova√ß√£o-chave foi usar um sistema de computa√ß√£o distribu√≠da (chamado de algoritmo de "Prova-de-Trabalho" ou <em>"Proof-of-Work"</em>) para conduzir uma "elei√ß√£o" global a cada 10 minutos, permitindo que a rede descentralizada chegue a um <em>consenso</em> sobre o estado das transa√ß√µes. Isto resolve de maneira elegante o problema do gasto duplo, que ocorre quando uma mesma unidade da moeda √© gasta duas vezes. Antes do bitcoin, o problema do gasto duplo era uma fraqueza do dinheiro digital, e sua solu√ß√£o envolvia a compensa√ß√£o de todas as transa√ß√µes atrav√©s de uma c√¢mara de compensa√ß√£o central.</p>
</div>
<div class="paragraph data-line-55">
<p>A rede Bitcoin come√ßou em 2009, com base em uma implementa√ß√£o de refer√™ncia publicada por Nakamoto e desde ent√£o revisada por muitos outros programadores. A implementa√ß√£o do algoritmo Proof-of-Work (minera√ß√£o) que fornece seguran√ßa e resili√™ncia para Bitcoin aumentou exponencialmente em poder, e agora excede o poder de processamento combinado dos principais supercomputadores do mundo. O valor total de mercado do Bitcoin por vezes ultrapassou US$ 1 trilh√£o de d√≥lares, dependendo da taxa de c√¢mbio de bitcoin para d√≥lar. A maior transa√ß√£o processada at√© agora pela rede foi de US$ 1,1 bilh√£o, transmitida instantaneamente e processada por uma taxa de apenas US$ 0,68.</p>
</div>
<div class="paragraph data-line-57">
<p>Satoshi Nakamoto withdrew from the public in April 2011, leaving the responsibility of developing the code and network to a thriving group of volunteers. The identity of the person or people behind Bitcoin is still unknown. However, neither Satoshi Nakamoto nor anyone else exerts individual control over the Bitcoin system, which operates based on fully transparent mathematical principles, open source code, and consensus among participants. The invention itself is groundbreaking and has already spawned new science in the fields of distributed computing, economics, and econometrics.</p>
</div>
<div class="sidebarblock data-line-61">
<div class="content">
<div class="title">Uma Solu√ß√£o para um Problema de Computa√ß√£o Distribu√≠da</div>
<div class="paragraph data-line-62">
<p>A inven√ß√£o de Satoshi Nakamoto tamb√©m √© uma solu√ß√£o pr√°tica e inovadora para um problema da computa√ß√£o distribu√≠da conhecido como o "Problema dos Generais Bizantinos". Resumidamente, o problema consiste em se tentar chegar a um acordo sobre um curso de a√ß√£o ou o estado de um sistema enquanto se troca informa√ß√µes em uma rede n√£o confi√°vel e potencialmente comprometida. A solu√ß√£o de Satoshi Nakamoto, que usa o conceito de Prova-de-Trabalho para obter consenso <em>sem uma autoridade central de confian√ßa</em>, representa um importante avan√ßo na computa√ß√£o distribu√≠da e tem ampla aplicabilidade al√©m do seu uso em moedas. Ela pode ser usada para obter consenso em redes descentralizadas para provar a legitimidade de elei√ß√µes, loterias, registros de ativos, notariza√ß√£o digital e muito mais.</p>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-67">
<h3 id="user-stories">Usos do Bitcoin, Usu√°rios e Suas Hist√≥rias</h3>
<div class="paragraph data-line-69">
<p>Bitcoin is an innovation in the ancient technology of money. At its core, money simply facilitates the exchange of value between people. Therefore, in order to fully understand Bitcoin and its uses, we&#8217;ll examine it from the perspective of people using it. Each of the people and their stories, as listed here, illustrates one or more specific use cases. We&#8217;ll be seeing them throughout the book:</p>
</div>
<div class="dlist data-line-71">
<dl>
<dt class="hdlist1">Varejo de produtos de baixo valor nos Estados Unidos</dt>
<dd>
<p>Alice lives in Northern California&#8217;s Bay Area. She has heard about Bitcoin from her techie friends and wants to start using it. We will follow her story as she learns about Bitcoin, acquires some, and then spends some of her bitcoin to buy a cup of coffee at Bob&#8217;s Cafe in Palo Alto. This story will introduce us to the software, the exchanges, and basic transactions from the perspective of a retail consumer.</p>
</dd>
<dt class="hdlist1">Varejo de produtos de alto valor nos Estados Unidos</dt>
<dd>
<p>Carol is an art gallery owner in San Francisco. She sells expensive paintings for Bitcoin. This story will introduce the risks of a "51%" consensus attack for retailers of high-value items.</p>
</dd>
<dt class="hdlist1">Servi√ßos de contrato offshore</dt>
<dd>
<p>Bob, the cafe owner in Palo Alto, is building a new website. He has contracted with an Indian web developer, Gopesh, who lives in Bangalore, India. Gopesh has agreed to be paid in bitcoin. This story will examine the use of Bitcoin for outsourcing, contract services, and international wire transfers.</p>
</dd>
<dt class="hdlist1">Loja virtual</dt>
<dd>
<p>Gabriel is an enterprising young teenager in Rio de Janeiro, running a small web store that sells Bitcoin-branded t-shirts, coffee mugs, and stickers. Gabriel is too young to have a bank account, but his parents are encouraging his entrepreneurial spirit.</p>
</dd>
<dt class="hdlist1">Doa√ß√µes beneficentes</dt>
<dd>
<p>Eugenia is the director of a children&#8217;s charity in the Philippines. Recently she has discovered Bitcoin and wants to use it to reach a whole new group of foreign and domestic donors to fundraise for her charity. She&#8217;s also investigating ways to use Bitcoin to distribute funds quickly to areas of need. This story will show the use of Bitcoin for global fundraising across currencies and borders and the use of an open ledger for transparency in charitable organizations.</p>
</dd>
<dt class="hdlist1">Importa√ß√£o/exporta√ß√£o</dt>
<dd>
<p>Mohammed is an electronics importer in Dubai. He&#8217;s trying to use Bitcoin to buy electronics from the United States and China for import into the UAE to accelerate the process of payments for imports. This story will show how Bitcoin can be used for large business-to-business international payments tied to physical goods.</p>
</dd>
<dt class="hdlist1">Minera√ß√£o de bitcoins</dt>
<dd>
<p>Jing is a computer engineering student in Shanghai. He has built a "mining" rig to mine for bitcoin using his engineering skills to supplement his income. This story will examine the "industrial" base of Bitcoin: the specialized equipment used to secure the Bitcoin network and issue new currency.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-92">
<p>Each of these stories is based on the real people and real industries currently using Bitcoin to create new markets, new industries, and innovative solutions to global economic issues.</p>
</div>
</div>
<div class="sect2 data-line-94">
<h3 id="_como_come√ßar">Como Come√ßar</h3>
<div class="paragraph data-line-96">
<p>Bitcoin is a protocol that can be accessed using a client application that speaks the protocol. A "Bitcoin wallet" is the most common user interface to the Bitcoin system, just like a web browser is the most common user interface for the HTTP protocol. There are many implementations and brands of Bitcoin wallets, just like there are many brands of web browsers (e.g., Chrome, Safari, Firefox, and Internet Explorer). And just like we all have our favorite browsers (Mozilla Firefox, Yay!) and our villains (Internet Explorer, Yuck!), Bitcoin wallets vary in quality, performance, security, privacy, and reliability. There is also a reference implementation of the Bitcoin protocol that includes a wallet, known as the "Satoshi Client" or "Bitcoin Core," which is derived from the original implementation written by Satoshi Nakamoto.</p>
</div>
<div class="sect3 data-line-98">
<h4 id="_escolhendo_uma_carteira_de_bitcoin">Escolhendo uma Carteira de Bitcoin</h4>
<div class="paragraph data-line-100">
<p>Bitcoin wallets are one of the most actively developed applications in the Bitcoin ecosystem. There is intense competition, and while a new wallet is probably being developed right now, several wallets from last year are no longer actively maintained. Many wallets focus on specific platforms or specific uses and some are more suitable for beginners while others are filled with features for advanced users. Choosing a wallet is highly subjective and depends on the use and user expertise. Therefore it would be pointless to recommend a specific brand or wallet. However, we can categorize Bitcoin wallets according to their platform and function and provide some clarity about all the different types of wallets that exist. Better yet, moving keys or seeds between Bitcoin wallets is relatively easy, so it is worth trying out several different wallets until you find one that fits your needs.</p>
</div>
<div class="paragraph pagebreak-before data-line-103">
<p>As carteiras de bitcoin podem ser categorizadas da seguinte forma, de acordo com a plataforma:</p>
</div>
<div class="dlist data-line-105">
<dl>
<dt class="hdlist1">Desktop wallet</dt>
<dd>
<p>A desktop wallet was the first type of Bitcoin wallet created as a reference implementation and many users run desktop wallets for the features, autonomy, and control they offer. Running on general-use operating systems such as Windows and Mac OS has certain security disadvantages, however, as these platforms are often insecure and poorly configured.</p>
</dd>
<dt class="hdlist1">Mobile wallet</dt>
<dd>
<p>A mobile wallet is the most common type of Bitcoin wallet. Running on smart-phone operating systems such as Apple iOS and Android, these wallets are often a great choice for new users. Many are designed for simplicity and ease-of-use, but there are also fully featured mobile wallets for power users.</p>
</dd>
<dt class="hdlist1">Web wallet</dt>
<dd>
<p>Web wallets are accessed through a web browser and store the user&#8217;s wallet on a server owned by a third party. This is similar to webmail in that it relies entirely on a third-party server. Some of these services operate using client-side code running in the user&#8217;s browser, which keeps control of the Bitcoin keys in the hands of the user. Most, however, present a compromise by taking control of the Bitcoin keys from users in exchange for ease-of-use. It is inadvisable to store large amounts of bitcoin on third-party systems.</p>
</dd>
<dt class="hdlist1">Hardware wallet</dt>
<dd>
<p>Hardware wallets are devices that operate a secure self-contained Bitcoin wallet on special-purpose hardware. They usually connect to a desktop or mobile device via USB cable or near-field-communication (NFC), and are operated with a web browser or accompanying software. By handling all Bitcoin-related operations on the specialized hardware, these wallets are considered very secure and suitable for storing large amounts of bitcoin.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-113">
<p>Another way to categorize bitcoin wallets is by their degree of autonomy and how they interact with the Bitcoin network:</p>
</div>
<div class="dlist data-line-115">
<dl>
<dt class="hdlist1">Full-node client</dt>
<dd>
<p>A full client, or "full node," is a client that stores the entire history of Bitcoin transactions (every transaction by every user, ever), manages users' wallets, and can initiate transactions directly on the Bitcoin network. A full node handles all aspects of the protocol and can independently validate the entire blockchain and any transaction. A full-node client consumes substantial computer resources (e.g., more than 125 GB of disk, 2 GB of RAM) but offers complete autonomy and independent transaction verification.</p>
</dd>
<dt class="hdlist1">Lightweight client</dt>
<dd>
<p>A lightweight client, also known as a simplified-payment-verification (SPV) client, connects to Bitcoin full nodes (mentioned previously) for access to the Bitcoin transaction information, but stores the user wallet locally and independently creates, validates, and transmits transactions. Lightweight clients interact directly with the Bitcoin network, without an intermediary.</p>
</dd>
<dt class="hdlist1">Third-party API client</dt>
<dd>
<p>A third-party API client is one that interacts with Bitcoin through a third-party system of application programming interfaces (APIs), rather than by connecting to the Bitcoin network directly. The wallet may be stored by the user or by third-party servers, but all transactions go through a third party.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-121">
<p>Combining these categorizations, many Bitcoin wallets fall into a few groups, with the three most common being desktop full client, mobile lightweight wallet, and web third-party wallet. The lines between different categories are often blurry, as many wallets run on multiple platforms and can interact with the network in different ways.</p>
</div>
<div class="paragraph data-line-123">
<p>For the purposes of this book, we will be demonstrating the use of a variety of downloadable Bitcoin clients, from the reference implementation (Bitcoin Core) to mobile and web wallets. Some of the examples will require the use of Bitcoin Core, which, in addition to being a full client, also exposes APIs to the wallet, network, and transaction services. If you are planning to explore the programmatic interfaces into the Bitcoin system, you will need to run Bitcoin Core, or one of the alternative clients.</p>
</div>
</div>
<div class="sect3 data-line-125">
<h4 id="_in√≠cio_r√°pido">In√≠cio R√°pido</h4>
<div class="paragraph data-line-127">
<p>Alice, who we introduced in <a href="#user-stories">Usos do Bitcoin, Usu√°rios e Suas Hist√≥rias</a>, is not a technical user and only recently heard about Bitcoin from her friend Joe. While at a party, Joe is once again enthusiastically explaining Bitcoin to all around him and is offering a demonstration. Intrigued, Alice asks how she can get started with Bitcoin. Joe says that a mobile wallet is best for new users and he recommends a few of his favorite wallets. Alice downloads "Bluewallet" (available for iOS and Android) and installs it on her phone.</p>
</div>
<div class="paragraph data-line-129">
<p>When Alice runs her wallet application for the first time, she chooses the option to create a new Bitcoin wallet, and takes a moment <strong>away from Joe and all other parties</strong> to write down a secret mnemonic phrase <em>in order</em> on a piece of paper. As explained by the mobile wallet and by Joe earlier, the mnemonic phrase allows Alice to restore her wallet in case she loses her mobile device and grants her access to her funds on another device. After creating her wallet and securing her mnemonic phrase, Alice can tap on her wallet to see her bitcoin amount, transaction history, as well as two buttons that allow her to either <em>receive</em> or <em>send</em> bitcoin, shown in <a href="#bluewallet-welcome">Alice uses the Receive screen on her Bluewallet mobile Bitcoin wallet, and displays her address to Bob in a QR code format</a>.</p>
</div>
</div>
<div class="sect3 data-line-131">
<h4 id="_palavras_mnem√¥nicas">Palavras Mnem√¥nicas</h4>
<div class="paragraph data-line-133">
<p>A modern Bitcoin wallet will provide a <em>mnemonic phrase</em> (also sometimes called a "seed" or "seed phrase") for Alice to back up. The mnemonic phrase consists of 12-24 English words, selected randomly by the software, and used as the basis for the keys that are generated by the wallet. The mnemonic phrase can be used by Alice to restore all the transactions and funds in her wallet in the case of an event such as a lost mobile device, a software bug, or memory corruption.</p>
</div>
<div class="admonitionblock tip data-line-136">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-137">
<p>O termo correto para essas palavras de backup √© "frase mnem√¥nica". Evitamos o uso do termo "semente" para se referir a uma frase mnem√¥nica, pois embora seu uso seja comum, ele √© incorreto.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-141">
<h4 id="mnemonic-storage">Armazenando o Mnem√¥nico com Seguran√ßa</h4>
<div class="paragraph data-line-143">
<p>A Alice precisa ter o cuidado de armazenar a frase mnem√¥nica de uma forma que equilibre a necessidade de evitar roubos com a necessidade de evitar a perda acidental. Se ela n√£o a proteger o suficiente, sua frase mnem√¥nica corre o risco de ser roubada. Se ela a proteger demais, sua frase mnem√¥nica correr√° o risco de ser perdida para sempre. A maneira recomendada de equilibrar adequadamente esses riscos √© anotar com caneta e papel duas c√≥pias da frase mnem√¥nica, em dois pap√©is diferentes, com cada uma das palavras sendo numerada, pois a ordem das palavras importa.</p>
</div>
<div class="paragraph data-line-145">
<p>Depois de a Alice anotar a sua frase mnem√¥nica, ela deve escolher um lugar seguro separado para armazenar cada uma das duas c√≥pias, como uma gaveta trancada ou um cofre √† prova de inc√™ndios.</p>
</div>
<div class="admonitionblock warning data-line-148">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-149">
<p>Nunca tente inventar um esquema de seguran√ßa "por conta pr√≥pria" que desvie de alguma forma das recomenda√ß√µes de melhores pr√°ticas descritas anteriormente. N√£o corte o papel do seu mnem√¥nico pela metade, n√£o fa√ßa capturas de tela, n√£o armazene seu mnem√¥nico em pendrives/drives de USB, em um e-mail ou na nuvem,  n√£o criptografe-o e n√£o tente fazer qualquer outro m√©todo que n√£o seja o padr√£o. Voc√™ perder√° o equil√≠brio entre os riscos de perda permanente ou roubo. Muitas pessoas j√° perderam fundos, n√£o por roubo, mas porque tentaram uma solu√ß√£o fora do padr√£o sem ter a experi√™ncia para equilibrar os riscos envolvidos. As recomenda√ß√µes de melhores pr√°ticas s√£o cuidadosamente equilibradas por especialistas e s√£o adequadas para a grande maioria dos usu√°rios.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sidebarblock data-line-151">
<div class="content">
<div id="bluewallet-welcome" class="imageblock data-line-154">
<div class="content">
<img src="images/mbc2_0101.png" alt="BluewalletWelcome">
</div>
<div class="title">Figure 1. Alice uses the Receive screen on her Bluewallet mobile Bitcoin wallet, and displays her address to Bob in a QR code format</div>
</div>
<div class="paragraph data-line-156">
<p>A p√°gina principal da carteira exibe o saldo de bitcoins, o hist√≥rico de transa√ß√µes e os bot√µes <em>Receber</em> e <em>Enviar</em>. Al√©m disso, muitas carteiras apresentam uma funcionalidade que permite comprar bitcoin diretamente por meio de uma corretora ou um servi√ßo semelhante, onde voc√™ pode usar a sua moeda fiduci√°ria para trocar por criptomoedas, pagando o pre√ßo atual do bitcoin. O bot√£o <em>Comprar Bitcoin</em> permitiria a Alice comprar bitcoin dessa maneira.</p>
</div>
<div class="paragraph data-line-158">
<p>Alice is now ready to start using her new bitcoin wallet.  Her wallet application randomly generated a private key (described in more detail in <a href="#private_keys">[private_keys]</a>) which will be used to derive Bitcoin addresses that direct to her wallet. At this point, her Bitcoin addresses are not known to the Bitcoin network or "registered" with any part of the Bitcoin system. Her Bitcoin addresses are simply random numbers that correspond to her private key that she can use to control access to the funds. The addresses are generated independently by her wallet without reference or registration with any service. In fact, in most wallets, there is no association between a Bitcoin address and any externally identifiable information including the user&#8217;s identity. Until the moment an address is referenced as the recipient of value in a transaction posted on the bitcoin ledger, the Bitcoin address is simply part of the vast number of possible addresses that are valid in bitcoin. Only once an address has been associated with a transaction does it become part of the known addresses in the network.</p>
</div>
<div class="paragraph data-line-160">
<p>Alice uses the <em>Receive</em> button, which displays a QR code along with a Bitcoin address. The QR code is the square with a pattern of black and white dots, serving as a form of barcode that contains the same information in a format that can be scanned by Joe&#8217;s smartphone camera. Next to the wallet&#8217;s QR code is the Bitcoin address it encodes, and Alice may choose to manually send her address to Joe by copying it onto her clipboard with a tap. Of note, when receiving funds to a new mobile wallet for the first time, many wallets will often re-verify that you have indeed secured your mnemonic phrase. This can range from a simple prompt to requiring the user to manually re-enter the phrase.</p>
</div>
<div class="admonitionblock tip data-line-163">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-164">
<p>Bitcoin addresses start with 1, 3, or bc1. Like email addresses, they can be shared with other bitcoin users who can use them to send bitcoin directly to your wallet. There is nothing sensitive, from a security perspective, about the Bitcoin address. It can be posted anywhere without risking the security of the account. Unlike email addresses, you can create new addresses as often as you like, all of which will direct funds to your wallet. In fact, many modern wallets automatically create a new address for every transaction to maximize privacy. A wallet is simply a collection of addresses and the keys that unlock the funds within.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="getting_first_bitcoin" class="paragraph data-line-169">
<p>==== Obtendo o seu Primeiro Bitcoin</p>
</div>
<div class="paragraph data-line-171">
<p>A Alice pode adquirir bitcoin de v√°rias maneiras:</p>
</div>
<div class="ulist data-line-173">
<ul>
<li class="data-line-173">
<p>Ela pode trocar um pouco de sua moeda nacional (por exemplo, BRL) em uma corretora (exchange) de criptomoedas</p>
</li>
<li class="data-line-174">
<p>Ela pode comprar de um amigo, ou de um conhecido em um encontro de usu√°rios de bitcoin (Meetup de Bitcoin), em troca de dinheiro em esp√©cie</p>
</li>
<li class="data-line-175">
<p>Ela pode encontrar um caixa eletr√¥nico (ATM) de bitcoin na cidade onde ela mora, que funciona como uma m√°quina de vendas autom√°tica, vendendo bitcoin por dinheiro em esp√©cie</p>
</li>
<li class="data-line-176">
<p>Ela pode oferecer suas habilidades ou um produto que ela vende e aceitar o pagamento em bitcoin</p>
</li>
<li class="data-line-177">
<p>Ela pode pedir a seu empregador ou clientes que paguem em bitcoin</p>
</li>
</ul>
</div>
<div class="paragraph data-line-179">
<p>Todos esses m√©todos t√™m diferentes graus de dificuldade e muitos envolvem o pagamento de uma taxa. Algumas institui√ß√µes financeiras tamb√©m exigir√£o que a Alice forne√ßa documentos de identifica√ß√£o para cumprir os regulamentos banc√°rios locais/pr√°ticas de preven√ß√£o √† lavagem de dinheiro (PLD) (em ingl√™s, anti-money laundering ou AML), um processo que √© conhecido como KYC (do ingl√™s, <em>Know Your Customer</em>, ou Conhe√ßa o seu Cliente). Contudo, com todos esses m√©todos √† disposi√ß√£o, a Alice conseguir√° receber seus primeiros bitcoins.</p>
</div>
<div class="admonitionblock tip data-line-182">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-183">
<p>One of the advantages of bitcoin over other payment systems is that, when used correctly, it affords users much more privacy. Acquiring, holding, and spending bitcoin does not require you to divulge sensitive and personally identifiable information to third parties. However, where bitcoin touches traditional systems, such as currency exchanges, national and international regulations often apply. In order to exchange bitcoin for your national currency, you will often be required to provide proof of identity and banking information. Users should be aware that once a Bitcoin address is attached to an identity, all associated bitcoin transactions are also easy to identify and track. This is one reason many users choose to maintain dedicated exchange accounts unlinked to their wallets.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-186">
<p>A Alice foi apresentada ao bitcoin por um amigo, ent√£o ela tem uma maneira f√°cil de adquirir o seu primeiro bitcoin. A seguir, veremos como ela faz para comprar bitcoin de seu amigo Joe e como o Joe faz para enviar o bitcoin para a carteira dela.</p>
</div>
<div id="bitcoin_price" class="paragraph data-line-189">
<p>==== Encontrando o Pre√ßo Atual do Bitcoin</p>
</div>
<div class="paragraph data-line-191">
<p>Antes que a Alice possa comprar bitcoin do Joe, eles precisam concordar com a <em>taxa de c√¢mbio</em> entre o bitcoin e o d√≥lar americano. Isso levanta uma pergunta comum para aqueles que s√£o novatos no bitcoin: "Quem define o pre√ßo do bitcoin?" A resposta curta √© que o pre√ßo √© definido pelos mercados.</p>
</div>
<div class="paragraph data-line-193">
<p>O bitcoin, assim como a maioria das outras moedas, tem uma <em>taxa de c√¢mbio flutuante</em>. Isso significa que o valor do bitcoin em rela√ß√£o a qualquer outra moeda flutua de acordo com a oferta e a demanda nos v√°rios mercados onde √© negociado. Por exemplo, o "pre√ßo" do bitcoin em d√≥lares americanos √© calculado em cada mercado com base na negocia√ß√£o mais recente que envolveu a troca de bitcoins por d√≥lares americanos ou vice-versa. Como tal, o pre√ßo tende a flutuar v√°rias vezes por segundo. Um servi√ßo de pre√ßos agregar√° os pre√ßos de v√°rios mercados e calcular√° uma m√©dia ponderada por volume de transa√ß√µes, que representa a taxa de c√¢mbio do mercado amplo de um par de moedas (por exemplo, BTC/USD).</p>
</div>
<div class="paragraph data-line-195">
<p>Existem centenas de aplicativos e sites que fornecem o pre√ßo atual do mercado. Aqui est√£o alguns dos mais populares:</p>
</div>
<div class="dlist data-line-197">
<dl>
<dt class="hdlist1"><a href="https://bitcoinaverage.com/" data-href="https://bitcoinaverage.com/">Bitcoin Average</a></dt>
<dd>
<p>Um site que fornece uma vis√£o simples da m√©dia ponderada por volume de cada moeda.</p>
</dd>
<dt class="hdlist1"><a href="https://coincap.io/" data-href="https://coincap.io/">CoinCap</a></dt>
<dd>
<p>Um servi√ßo listando a capitaliza√ß√£o de mercado e as taxas de c√¢mbio de centenas de criptomoedas, incluindo o bitcoin.</p>
</dd>
<dt class="hdlist1"><a href="https://bit.ly/cmebrr" data-href="https://bit.ly/cmebrr">Taxa de Refer√™ncia do Bitcoin da Bolsa de Mercadorias de Chicago</a></dt>
<dd>
<p>Uma taxa de refer√™ncia que pode ser usada para refer√™ncia institucional e contratual, fornecida como parte dos feeds de dados de investimento da Bolsa de Mercadorias de Chicago (CME).</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-201">
<p>Al√©m desses diversos sites e aplicativos, a maioria das carteiras de bitcoin converter√° automaticamente valores entre bitcoin e outras moedas. O Joe usar√° sua carteira para converter o pre√ßo automaticamente antes de enviar bitcoins para a Alice.</p>
</div>
<div id="sending_receiving" class="paragraph data-line-204">
<p>==== Enviando e Recebendo Bitcoin</p>
</div>
<div class="paragraph data-line-206">
<p>Alice has decided to exchange $10 US dollars for bitcoin, so as not to risk too much money on this new technology. She gives Joe $10 in cash, opens her Bluewallet mobile wallet application, and selects Receive. This displays a QR code with Alice&#8217;s first Bitcoin address.</p>
</div>
<div class="paragraph data-line-208">
<p>O Joe ent√£o seleciona Enviar na carteira Bluewallet do seu smartphone, que passa a exibir uma tela contendo os seguintes campos:</p>
</div>
<div class="ulist data-line-210">
<ul>
<li class="data-line-210">
<p>A quantia a ser enviada, em bitcoin (BTC) ou em sua moeda local (USD)</p>
</li>
<li class="data-line-211">
<p>A destination Bitcoin address</p>
</li>
<li class="data-line-212">
<p>Uma nota (descri√ß√£o) para a transa√ß√£o</p>
</li>
<li class="data-line-213">
<p>Uma taxa de transa√ß√£o</p>
</li>
</ul>
</div>
<div class="paragraph data-line-215">
<p>In the input field for the Bitcoin address, there is a small <em>Scan</em> button. This allows Joe to scan the QR code with his smartphone camera so that he doesn&#8217;t have to type in Alice&#8217;s Bitcoin address, which is quite long and difficult to type. Joe taps the <em>Scan</em> button and it activates the smartphone camera, scanning the QR code displayed on Alice&#8217;s smartphone.</p>
</div>
<div class="paragraph data-line-217">
<p>Joe now has Alice&#8217;s Bitcoin address set as the recipient. Joe enters the amount as $10 US dollars and his wallet converts it by accessing the most recent exchange rate from an online service. The exchange rate at the time is $100 US dollars per bitcoin, so $10 US dollars is worth 0.10 bitcoin (BTC), or 100 millibitcoin (mBTC) as shown in the screenshot from Joe&#8217;s wallet (see <a href="#bluewallet-mobile-send">Tela de envio da carteira de bitcoin m√≥vel Bluewallet</a>).</p>
</div>
<div class="paragraph data-line-219">
<p>No campo nota/descri√ß√£o da transa√ß√£o, Joe digita "Alice". Ele pode usar este campo para adicionar algumas informa√ß√µes sobre sua transa√ß√£o, que possam ser consultadas no futuro. Esta fun√ß√£o serve apenas para que Joe possa manter um controle de suas transa√ß√µes j√° realizadas. A nota/descri√ß√£o da transa√ß√£o ser√° armazenada na carteira de seu celular e apenas Joe poder√° v√™-la. Ela n√£o ser√° enviada para Alice, nem armazenada na blockchain.</p>
</div>
<div class="paragraph data-line-221">
<p>Ele tamb√©m seleciona uma taxa de transa√ß√£o para sua transa√ß√£o. Quanto maior a taxa de transa√ß√£o, mais r√°pido sua transa√ß√£o ser√° confirmada (inclu√≠da em um bloco por um minerador). Ele seleciona a taxa de transa√ß√£o m√≠nima poss√≠vel naquele momento (0 satoshis / byte).</p>
</div>
<div class="admonitionblock tip data-line-224">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-225">
<p>O pre√ßo do bitcoin mudou muito nos √∫ltimos anos, sofrendo uma incr√≠vel valoriza√ß√£o desde que a primeira edi√ß√£o deste livro foi escrita. Em mar√ßo de 2021, uma pessoa precisaria de aproximadamente 54 mil d√≥lares para comprar um bitcoin inteiro. Muitos exemplos neste livro fazem refer√™ncia a transa√ß√µes que realmente ocorreram no passado, quando o pre√ßo do bitcoin era muito mais baixo e ainda era poss√≠vel realizar transa√ß√µes com taxa zero. Imagine que amigo generoso Joe seria, caso ele tivesse feito o mesmo acordo com a Alice hoje!</p>
</div>
</td>
</tr>
</table>
</div>
<div id="bluewallet-mobile-send" class="imageblock smallereighty data-line-231">
<div class="content">
<img src="images/mbc2_0102.png" alt="bluewallet mobile send screen">
</div>
<div class="title">Figure 2. Tela de envio da carteira de bitcoin m√≥vel Bluewallet</div>
</div>
<div class="paragraph data-line-233">
<p>Using Bluewallet, Joe carefully checks to make sure he has entered the correct amount, because he is about to transmit money and mistakes are irreversible. For simplicity sake, we will assume that Joe does not pay any transaction fees. The purpose and setting of transaction fees are covered in subsequent chapters.  After double-checking the address and amount, he presses <em>Send</em> to transmit the transaction. Joe&#8217;s mobile bitcoin wallet constructs a transaction that assigns 0.10 BTC to the address provided by Alice, sourcing the funds from Joe&#8217;s wallet and signing the transaction with Joe&#8217;s private keys. This tells the Bitcoin network that Joe has authorized a transfer of value to Alice&#8217;s new address. As the transaction is transmitted via the peer-to-peer protocol, it quickly propagates across the Bitcoin network. In less than a second, most of the well-connected nodes in the network receive the transaction and see Alice&#8217;s address for the first time.</p>
</div>
<div class="paragraph data-line-235">
<p>Meanwhile, Alice&#8217;s wallet is constantly "listening" to published transactions on the Bitcoin network, looking for any that match the addresses it contains. A few seconds after Joe&#8217;s wallet transmits the transaction, Alice&#8217;s wallet will indicate that it is receiving 0.10 BTC.</p>
</div>
<div class="admonitionblock tip data-line-238">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-239">
<p>Cada bitcoin pode ser subdividido em 100 milh√µes de unidades, cada uma chamada de "satoshi" (no singular) ou "satoshis" (no plural). Batizado em homenagem ao criador do bitcoin, o Satoshi √© a menor unidade de bitcoin, equivalente a 0,00000001 BTC.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="confirma√ß√µes" class="paragraph data-line-244">
<div class="title">Confirma√ß√µes</div>
<p>  ("confirma√ß√µes", consulte = "tamb√©m minera√ß√£o e consenso; transa√ß√µes" )  A princ√≠pio, a carteira de Alice mostrar√° a transa√ß√£o de Joe como "N√£o confirmada". Isso significa que a transa√ß√£o foi propagada para a rede, mas ainda n√£o foi registrada no livro de transa√ß√µes bitcoin, conhecido como blockchain. Para ser confirmada, uma transa√ß√£o deve ser inclu√≠da em um bloco e adicionada ao blockchain, o que acontece a cada 10 minutos, em m√©dia. Em termos financeiros tradicionais, isso √© conhecido como <em>clearing</em>. Este livro cobrir√° em detalhes a propaga√ß√£o, valida√ß√£o e compensa√ß√£o (ou confirma√ß√£o) de transa√ß√µes bitcoin.</p>
</div>
<div class="paragraph data-line-246">
<p>A Alice agora √© a orgulhosa dona de 0,10 BTC que ela pode gastar. No pr√≥ximo cap√≠tulo, observaremos sua primeira compra com bitcoin e examinaremos em maiores detalhes as tecnologias de transa√ß√£o e propaga√ß√£o envolvidas.</p>
</div>
<div id="ch02_bitcoin_overview" class="paragraph data-line-249">
<p>== Como Funciona o Bitcoin</p>
</div>
<div class="paragraph data-line-251">
<p>=== Transa√ß√µes, Blocos, Minera√ß√£o e a Blockchain</p>
</div>
<div class="paragraph data-line-253">
<p>The Bitcoin system, unlike traditional banking and payment systems, is based on decentralized trust. Instead of a central trusted authority, in bitcoin, trust is achieved as an emergent property from the interactions of different participants in the Bitcoin system. In this chapter, we will examine bitcoin from a high level by tracking a single transaction through the Bitcoin system and watch as it becomes "trusted" and accepted by the bitcoin mechanism of distributed consensus and is finally recorded on the blockchain, the distributed ledger of all transactions. Subsequent chapters will delve into the technology behind transactions, the network, and mining.</p>
</div>
<div class="paragraph data-line-255">
<p>==== Vis√£o Geral do Bitcoin</p>
</div>
<div class="paragraph data-line-257">
<p>In the overview diagram shown in <a href="#bitcoin-overview">Vis√£o Geral do Bitcoin</a>, we see that the Bitcoin system consists of users with wallets containing keys, transactions that are propagated across the network, and miners who produce (through competitive computation) the consensus blockchain, which is the authoritative ledger of all transactions.</p>
</div>
<div class="paragraph data-line-260">
<p>Each example in this chapter is based on an actual transaction made on the Bitcoin network, simulating the interactions between the users (Joe, Alice, Bob, and Gopesh) by sending funds from one wallet to another. While tracking a transaction through the Bitcoin network to the blockchain, we will use a <em>blockchain explorer</em> site to visualize each step. A blockchain explorer is a web application that operates as a bitcoin search engine, in that it allows you to search for addresses, transactions, and blocks and see the relationships and flows between them.</p>
</div>
<div id="bitcoin-overview" class="imageblock data-line-264">
<div class="content">
<img src="images/mbc2_0201.png" alt="Bitcoin Overview">
</div>
<div class="title">Figure 3. Vis√£o Geral do Bitcoin</div>
</div>
<div class="paragraph data-line-266">
<p>    Exploradores de blockchain populares incluem:</p>
</div>
<div class="ulist data-line-268">
<ul>
<li class="data-line-268">
<p><a href="https://live.blockcypher.com" data-href="https://live.blockcypher.com">BlockCypher Explorer</a></p>
</li>
<li class="data-line-269">
<p><a href="https://blockchain.com" data-href="https://blockchain.com">Blockchain.com</a></p>
</li>
<li class="data-line-270">
<p><a href="https://insight.bitpay.com" data-href="https://insight.bitpay.com">BitPay Insight</a></p>
</li>
<li class="data-line-271">
<p><a href="https://blockstream.info" data-href="https://blockstream.info">Blockstream Explorer</a></p>
</li>
</ul>
</div>
<div class="paragraph data-line-273">
<p>Each of these has a search function that can take a Bitcoin address, transaction hash, block number, or block hash and retrieve corresponding information from the Bitcoin network. With each transaction or block example, we will provide a URL so you can look it up yourself and study it in detail.</p>
</div>
<div id="cup_of_coffee" class="paragraph data-line-277">
<p>==== Comprando uma X√≠cara de Caf√©</p>
</div>
<div class="paragraph data-line-279">
<p>A Alice, apresentada no cap√≠tulo anterior, √© uma nova usu√°ria que acabou de adquirir seu primeiro bitcoin. Em <a href="#getting_first_bitcoin">[getting_first_bitcoin]</a>, Alice se encontrou com seu amigo Joe para trocar dinheiro em esp√©cie por bitcoin. A transa√ß√£o criada pelo Joe transferiu 0,10 BTC para a carteira da Alice. Agora a Alice far√° sua primeira transa√ß√£o em uma loja, comprando uma x√≠cara de caf√© na cafeteria do Bob em Palo Alto, na Calif√≥rnia.</p>
</div>
<div class="paragraph data-line-281">
<p>A Cafeteria do Bob recentemente come√ßou a aceitar pagamentos em bitcoin adicionando uma op√ß√£o de bitcoin em seu sistema de ponto de venda. Os pre√ßos na Cafeteria do Bob s√£o listados na moeda local (d√≥lares americanos), mas, no caixa, os clientes t√™m a op√ß√£o de pagar em d√≥lares ou bitcoin. A Alice faz o pedido de uma x√≠cara de caf√© e o Bob o registra no caixa, como faz para todas as transa√ß√µes. O sistema do ponto de venda converte automaticamente o pre√ßo total de d√≥lares americanos para bitcoin de acordo com a cota√ß√£o atual no mercado e, a seguir, exibe o pre√ßo em ambas as moedas:</p>
</div>
<div class="listingblock data-line-283">
<div class="content">
<pre>Total:
$1,50 USD
0,015 BTC</pre>
</div>
</div>
<div class="paragraph data-line-290">
<p>Bob diz: "A conta deu 1,50 d√≥lares, ou 15 milibits."</p>
</div>
<div class="paragraph data-line-292">
<p>O sistema de ponto de venda do Bob tamb√©m criar√° automaticamente um c√≥digo QR contendo uma <em>solicita√ß√£o de pagamento</em> (ver a <a href="#payment-request-QR">C√≥digo QR da solicita√ß√£o de pagamento</a>).</p>
</div>
<div class="paragraph data-line-294">
<p>Unlike a QR code that simply contains a destination Bitcoin address, a payment request is a QR-encoded URL that contains a destination address, a payment amount, and a generic description such as "Bob&#8217;s Cafe." This allows a bitcoin wallet application to prefill the information used to send the payment while showing a human-readable description to the user. You can scan the QR code with a bitcoin wallet application to see what Alice would see.</p>
</div>
<div id="payment-request-QR" class="imageblock data-line-299">
<div class="content">
<img src="images/mbc2_0202.png" alt="payment-request">
</div>
<div class="title">Figure 4. C√≥digo QR da solicita√ß√£o de pagamento</div>
</div>
<div class="admonitionblock tip data-line-302">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-303">
<p>Tente escanear esse c√≥digo QR com a sua carteira para ver o endere√ßo e a quantia, mas N√ÉO ENVIE DINHEIRO para esse endere√ßo.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="payment-request-URL" class="listingblock data-line-307">
<div class="title">O c√≥digo QR da solicita√ß√£o de pagamento codifica a seguinte URL, definida na BIP-21:</div>
<div class="content">
<pre>bitcoin:1GdK9UzpHBzqzX2A9JFP3Di4weBwqgmoQA?
amount=0.015&amp;
label=Bob%27s%20Cafe&amp;
message=Purchase%20at%20Bob%27s%20Cafe

Componentes da URL

A Bitcoin address: "1GdK9UzpHBzqzX2A9JFP3Di4weBwqgmoQA"
Valor do pagamento (amount): "0.015" (‚Äú0,015 BTC‚Äù)
Um r√≥tulo para o endere√ßo do destinat√°rio (label): "Bob's Cafe" (‚ÄúCafeteria do Bob‚Äù)
Uma descri√ß√£o para o pagamento (message): "Purchase at Bob's Cafe" (‚ÄúCompra na Cafeteria do Bob‚Äù)</pre>
</div>
</div>
<div class="paragraph data-line-321">
<p>A Alice ent√£o usa o smartphone dela para escanear o c√≥digo de barras sendo exibido na tela do Bob. Seu smartphone mostra um pagamento de 0,0150 BTC para a Cafeteria do Bob e ela toca no bot√£o Enviar para autorizar o pagamento. Ap√≥s alguns segundos (aproximadamente o mesmo tempo necess√°rio para uma autoriza√ß√£o de cart√£o de cr√©dito), Bob v√™ a transa√ß√£o no caixa, completando a transa√ß√£o.</p>
</div>
<div class="paragraph data-line-323">
<p>Nas se√ß√µes a seguir, examinaremos essa transa√ß√£o em maiores detalhes. Veremos como a carteira da Alice a construiu, como ela foi propagada pela rede, como foi verificada e, finalmente, como o Bob pode gastar essa quantia recebida em transa√ß√µes futuras.</p>
</div>
<div class="admonitionblock note data-line-326">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-327">
<p>The Bitcoin network can transact in fractional values, e.g., from millibitcoin (1/1000th of a bitcoin) down to 1/100,000,000th of a bitcoin, which is known as a satoshi.  Throughout this book, we‚Äôll use the term ‚Äúbitcoin‚Äù to refer to any quantity of bitcoin currency, from the smallest unit (1 satoshi) to the total number (21,000,000) of all bitcoin that will ever be mined.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-330">
<p>Voc√™ pode examinar a transa√ß√£o da Alice para o Cafeteria do Bob na blockchain usando um site explorador de blocos (ver <a href="#view_alice_transaction">Veja a transa√ß√£o de Alice em https://www.blockchain.com/btc/tx/0627052b6f28912f2703066a912ea577f2ce4da4caa5a5f thirtya57286c345c2f2[blockchain.com]</a>):</p>
</div>
<div id="view_alice_transaction" class="exampleblock data-line-334">
<div class="title">Example 1. Veja a transa√ß√£o de Alice em <a href="https://www.blockchain.com/btc/tx/0627052b6f28912f2703066a912ea577f2ce4da4caa5a5f" class="undefined" data-href="https://www.blockchain.com/btc/tx/0627052b6f28912f2703066a912ea577f2ce4da4caa5a5f">https://www.blockchain.com/btc/tx/0627052b6f28912f2703066a912ea577f2ce4da4caa5a5f</a> thirtya57286c345c2f2[blockchain.com]</div>
<div class="content">
<div class="listingblock data-line-335">
<div class="content">
<pre>https://www.blockchain.com/btc/tx/0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2</pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-340">
<p>=== Transa√ß√µes de Bitcoin</p>
</div>
<div class="paragraph data-line-342">
<p>Em termos simples, uma transa√ß√£o informa para a rede que o dono de uma quantidade de bitcoins autorizou a transfer√™ncia de alguns destes bitcoins para outro dono. O novo dono agora pode gastar esses bitcoins ao criar uma nova transa√ß√£o que autoriza a transfer√™ncia para um outro dono, e assim por diante, em uma cadeia de posse de bitcoins.</p>
</div>
<div class="paragraph data-line-344">
<p>==== Entradas e Sa√≠das de Transa√ß√£o</p>
</div>
<div class="paragraph data-line-346">
<p>As transa√ß√µes s√£o como linhas em um livro de contabilidade de dupla entrada. Cada transa√ß√£o cont√©m uma ou mais "entradas" (em ingl√™s, <em>inputs</em>), que s√£o como d√©bitos em uma conta de bitcoin. Do outro lado da transa√ß√£o, h√° uma ou mais "sa√≠das" (em ingl√™s, <em>outputs</em>), que s√£o como cr√©ditos adicionados a uma conta de bitcoin. As entradas e as sa√≠das (os d√©bitos e os cr√©ditos) n√£o necessariamente somam o mesmo valor. Na verdade, as sa√≠das somam um pouco menos do que as entradas, e essa diferen√ßa representa uma <em>taxa de transa√ß√£o</em> impl√≠cita, que √© um pequeno pagamento cobrado pelo minerador que inclui a transa√ß√£o no registro cont√°bil do bitcoin. Uma transa√ß√£o de bitcoin √© mostrada como uma entrada em um livro de contabilidade em <a href="#transaction-double-entry">Transa√ß√£o como uma contabilidade de dupla entrada</a>.</p>
</div>
<div class="paragraph data-line-348">
<p>The transaction also contains proof of ownership for each amount of bitcoin (inputs) whose value is being spent, in the form of a digital signature from the owner, which can be independently validated by anyone. In bitcoin terms, "spending" is signing a transaction that transfers value from a previous transaction over to a new owner identified by a Bitcoin address.</p>
</div>
<div id="transaction-double-entry" class="imageblock data-line-352">
<div class="content">
<img src="images/mbc2_0203.png" alt="Transaction Double-Entry">
</div>
<div class="title">Figure 5. Transa√ß√£o como uma contabilidade de dupla entrada</div>
</div>
<div class="paragraph data-line-354">
<p>==== Cadeias de Transa√ß√µes</p>
</div>
<div class="paragraph data-line-356">
<p>Alice&#8217;s payment to Bob&#8217;s Cafe uses a previous transaction&#8217;s output as its input. In the previous chapter, Alice received bitcoin from her friend Joe in return for cash. That transaction created a bitcoin value locked by Alice&#8217;s key. Her new transaction to Bob&#8217;s Cafe references the previous transaction as an input and creates new outputs to pay for the cup of coffee and receive change. The transactions form a chain, where the inputs from the latest transaction correspond to outputs from previous transactions. Alice&#8217;s key provides the signature that unlocks those previous transaction outputs, thereby proving to the Bitcoin network that she owns the funds. She attaches the payment for coffee to Bob&#8217;s address, thereby "encumbering" that output with the requirement that Bob produces a signature in order to spend that amount. This represents a transfer of value between Alice and Bob. This chain of transactions, from Joe to Alice to Bob, is illustrated in <a href="#blockchain-mnemonic">Uma cadeia de transa√ß√µes, onde a sa√≠da de uma transa√ß√£o √© a entrada da pr√≥xima transa√ß√£o</a>.</p>
</div>
<div id="blockchain-mnemonic" class="imageblock data-line-360">
<div class="content">
<img src="images/mbc2_0204.png" alt="Transaction chain">
</div>
<div class="title">Figure 6. Uma cadeia de transa√ß√µes, onde a sa√≠da de uma transa√ß√£o √© a entrada da pr√≥xima transa√ß√£o</div>
</div>
<div class="paragraph data-line-362">
<p>==== Criando o Troco</p>
</div>
<div class="paragraph data-line-364">
<p>Muitas transa√ß√µes de bitcoin incluir√£o sa√≠das que fazem refer√™ncia a um endere√ßo do novo propriet√°rio (quem recebe) e um endere√ßo do propriet√°rio atual (quem paga), chamado de endere√ßo de <em>troco</em>. Isso ocorre porque as entradas de transa√ß√£o, assim como c√©dulas de uma moeda, n√£o podem ser divididas. Se voc√™ compra um item de $5 d√≥lares em uma loja, mas paga com uma nota de $20 d√≥lares, voc√™ espera receber $15 d√≥lares em troco. O mesmo conceito se aplica √†s entradas das transa√ß√µes do bitcoin. Se voc√™ comprasse um item que custa 5 bitcoins, mas s√≥ tivesse uma entrada de 20 bitcoins para usar, a sua carteira criaria uma transa√ß√£o √∫nica que enviaria duas sa√≠das, uma sa√≠da de 5 bitcoins para o dono da loja e uma sa√≠da de 15 bitcoins de volta para voc√™ mesmo como troco (menos a taxa da transa√ß√£o). √â importante ressaltar que o endere√ßo de troco n√£o precisa ser o mesmo endere√ßo da entrada e, por motivos de privacidade, costuma ser um novo endere√ßo da carteira do propriet√°rio.</p>
</div>
<div class="paragraph data-line-366">
<p>Carteiras diferentes podem usar estrat√©gias diferentes ao agregar entradas para fazer um pagamento solicitado pelo usu√°rio. Elas podem usar diversas entradas pequenas juntas ou usar uma √∫nica entrada que seja maior ou igual ao valor de pagamento desejado. A menos que a carteira consiga agregar algumas entradas de forma que a soma delas corresponda exatamente ao valor de pagamento desejado somado √† taxa da transa√ß√£o, a carteira precisar√° gerar um troco. Isso √© muito semelhante ao modo como as pessoas lidam com o dinheiro em esp√©cie. Se voc√™ sempre usar a nota de maior valor na sua carteira, a sua carteira ficar√° sempre cheia de moedas. Se voc√™ usar apenas as moedas que recebeu como troco, a sua carteira ter√° apenas notas de maior valor. As pessoas inconscientemente encontram um equil√≠brio entre esses dois extremos, e os desenvolvedores de carteiras de bitcoin se esfor√ßam para programar esse equil√≠brio.</p>
</div>
<div class="paragraph data-line-368">
<p>In summary, <em>transactions</em> move value from <em>transaction inputs</em> to <em>transaction outputs</em>. An input is a reference to a previous transaction&#8217;s output, showing where the value is coming from. A transaction usually includes an output that directs a specific value to a new owner&#8217;s Bitcoin address and a change output back to the original owner. Outputs from one transaction can be used as inputs in a new transaction, thus creating a chain of ownership as the value is moved from owner to owner (see <a href="#blockchain-mnemonic">Uma cadeia de transa√ß√µes, onde a sa√≠da de uma transa√ß√£o √© a entrada da pr√≥xima transa√ß√£o</a>).</p>
</div>
<div class="paragraph data-line-370">
<p>==== Formas Comuns de Transa√ß√£o</p>
</div>
<div class="paragraph data-line-372">
<p>A forma mais comum de transa√ß√£o √© um pagamento simples de um endere√ßo para outro, que geralmente inclui algum "troco" devolvido ao propriet√°rio original. Este tipo de transa√ß√£o tem uma entrada e duas sa√≠das, e √© mostrado na <a href="#transaction-common">A forma mais comum de transa√ß√£o</a>.</p>
</div>
<div id="transaction-common" class="imageblock data-line-376">
<div class="content">
<img src="images/mbc2_0205.png" alt="Common Transaction">
</div>
<div class="title">Figure 7. A forma mais comum de transa√ß√£o</div>
</div>
<div class="paragraph data-line-378">
<p>Outra forma comum de transa√ß√£o √© uma que agrega m√∫ltiplas entradas em uma √∫nica sa√≠da (ver <a href="#transaction-aggregating">Transa√ß√£o agregadora de fundos</a>). Isso seria o equivalente, na vida real, a trocar uma pilha de moedas e notas por uma nota de valor maior. As transa√ß√µes deste tipo √†s vezes s√£o geradas pelos aplicativos de carteira com o objetivo de limpar v√°rios valores pequenos que foram recebidos como troco em pagamentos anteriores.</p>
</div>
<div id="transaction-aggregating" class="imageblock data-line-382">
<div class="content">
<img src="images/mbc2_0206.png" alt="Aggregating Transaction">
</div>
<div class="title">Figure 8. Transa√ß√£o agregadora de fundos</div>
</div>
<div class="paragraph data-line-384">
<p>Finalmente, outra forma de transa√ß√£o frequentemente observada no livro-raz√£o do bitcoin √© uma transa√ß√£o em lote, que distribui uma √∫nica entrada para v√°rias sa√≠das, que representam v√°rios destinat√°rios, uma t√©cnica conhecida como "agrupamento de transa√ß√µes", em ingl√™s, "<em>transaction batching</em>" (ver <a href="#transaction-distributing">Transa√ß√£o distribuidora de fundos</a>). Como este tipo de transa√ß√£o √© √∫til para economizar com taxas de transa√ß√£o, ele √© comumente usado por entidades comerciais para distribuir fundos, como, por exemplo, quando uma empresa processa as folhas de pagamento para m√∫ltiplos funcion√°rios, ou quando uma exchange de bitcoin processa os saques de m√∫ltiplos clientes em uma √∫nica transa√ß√£o.</p>
</div>
<div id="transaction-distributing" class="imageblock data-line-388">
<div class="content">
<img src="images/mbc2_0207.png" alt="Distributing Transaction">
</div>
<div class="title">Figure 9. Transa√ß√£o distribuidora de fundos</div>
</div>
<div class="paragraph data-line-390">
<p>=== Construindo uma Transa√ß√£o</p>
</div>
<div class="paragraph data-line-392">
<p>Alice&#8217;s wallet application contains all the logic for selecting appropriate inputs and outputs to build a transaction to Alice&#8217;s specification. Alice only needs to specify a destination and an amount, and the rest happens in the wallet application without her seeing the details. Importantly, a wallet application can construct transactions even if it is completely offline. Like writing a check at home and later sending it to the bank in an envelope, the transaction does not need to be constructed and signed while connected to the Bitcoin network.</p>
</div>
<div class="paragraph data-line-394">
<p>==== Obtendo as Entradas Certas</p>
</div>
<div class="paragraph data-line-396">
<p>O aplicativo de carteira da Alice ter√° primeiro que encontrar entradas que somem um valor suficiente para pagar a quantia que ela deseja enviar ao Bob. A maioria das carteiras mant√©m um registro de todas as sa√≠das dispon√≠veis pertencentes aos endere√ßos na carteira. Portanto, a carteira da Alice cont√©m uma c√≥pia da sa√≠da da transa√ß√£o do Joe, que foi criada em troca pelo dinheiro em esp√©cie (ver "&lt;getting_first_bitcoin&gt;"). Um aplicativo de carteira de bitcoin que √© executado como um cliente de n√≥ completo cont√©m uma c√≥pia de todas as sa√≠das n√£o gastas de todas as transa√ß√µes registradas na blockchain. Isso permite que uma carteira construa entradas de transa√ß√£o, bem como verifique rapidamente as transa√ß√µes que ela recebe, verificando se elas t√™m entradas corretas. No entanto, como um cliente de n√≥ completo ocupa muito espa√ßo em disco, a maioria das carteiras de usu√°rios executa clientes "leves", que mant√™m um registro apenas das sa√≠das n√£o gastas do pr√≥prio usu√°rio.</p>
</div>
<div class="paragraph data-line-398">
<p>If the wallet application does not maintain a copy of unspent transaction outputs, it can query the Bitcoin network to retrieve this information using a variety of APIs available by different providers or by asking a full-node using an application programming interface (API) call. <a href="#example_2-2">Look up all the unspent outputs for Alice&#8217;s Bitcoin address</a> shows an API request, constructed as an HTTP GET command to a specific URL. This URL will return all the unspent transaction outputs for an address, giving any application the information it needs to construct transaction inputs for spending. We use the simple command-line HTTP client <em>cURL</em> to retrieve the response.</p>
</div>
<div id="example_2-2" class="exampleblock data-line-402">
<div class="title">Example 2. Look up all the unspent outputs for Alice&#8217;s Bitcoin address</div>
<div class="content">
<div class="listingblock data-line-404">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ curl https://blockchain.info/unspent?active=1Cdid9KFAaatwczBwBttQcwXYCpvK8h7FK</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock data-line-410">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{

	"unspent_outputs":[

		{
			"tx_hash":"186f9f998a5...2836dd734d2804fe65fa35779",
			"tx_index":104810202,
			"tx_output_n": 0,
			"script":"76a9147f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a888ac",
			"value": 10000000,
			"value_hex": "00989680",
			"confirmations":0
		}

	]
}</code></pre>
</div>
</div>
<div class="paragraph data-line-430">
<p>A resposta no <a href="#example_2-2">Look up all the unspent outputs for Alice&#8217;s Bitcoin address</a> mostra uma sa√≠da n√£o gasta (uma que ainda n√£o foi resgatada) sob a posse do endere√ßo 1Cdid9KFAaatwczBwBttQcwXYCpvK8h7FK da Alice. A resposta inclui uma refer√™ncia √† transa√ß√£o na qual esse valor n√£o gasto est√° contido (o pagamento do Joe) e seu valor em satoshis, 10 milh√µes, equivalente a 0,10 bitcoin. Com essa informa√ß√£o, o aplicativo de carteira da Alice pode construir uma transa√ß√£o para transferir esse valor para endere√ßos de novos propriet√°rios.</p>
</div>
<div class="admonitionblock tip data-line-433">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-434">
<p>Veja a <a href="https://www.blockchain.com/btc/tx/7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18" data-href="https://www.blockchain.com/btc/tx/7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18">transa√ß√£o do Joe para a Alice</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-437">
<p>Como voc√™ pode ver, a carteira da Alice cont√©m em uma √∫nica sa√≠da n√£o gasta uma quantidade de bitcoins suficiente para pagar a x√≠cara de caf√©. Caso n√£o contivesse, o aplicativo de carteira da Alice teria que "vasculhar" v√°rias outras sa√≠das n√£o gastas de menor valor, como se estivesse procurando moedas em uma carteira at√© encontrar a quantia suficiente para pagar o caf√©. Em ambos os casos, quando o aplicativo de carteira cria as sa√≠das da transa√ß√£o (os pagamentos), pode haver a necessidade de se receber algum troco de volta, conforme veremos na pr√≥xima sess√£o.</p>
</div>
<div class="paragraph data-line-440">
<p>==== Criando as Sa√≠das</p>
</div>
<div class="paragraph data-line-442">
<p>Uma sa√≠da de transa√ß√£o √© criada na forma de um script que coloca uma trava no valor, o qual s√≥ pode ser resgatado se uma solu√ß√£o for apresentada ao script. Em termos mais simples, a sa√≠da da transa√ß√£o da Alice conter√° um script que diz algo como: "Esta sa√≠da √© resgat√°vel por qualquer pessoa que puder apresentar uma assinatura que tenha sido gerada a partir da chave correspondente ao endere√ßo do Bob". Como apenas o Bob possui a carteira com as chaves correspondentes a esse endere√ßo, apenas a carteira do Bob ser√° capaz de apresentar a assinatura que √© necess√°ria para resgatar essa sa√≠da. Portanto, ao exigir uma assinatura do Bob, a Alice est√° "travando" o valor da sa√≠da para que ele s√≥ possa ser gasto pelo Bob.</p>
</div>
<div class="paragraph data-line-444">
<p>Essa transa√ß√£o tamb√©m incluir√° uma segunda sa√≠da, pois os fundos da Alice est√£o contidos em uma √∫nica sa√≠da de 0,10 BTC, que √© dinheiro demais para uma simples x√≠cara de caf√© de 0,015 BTC. A Alice precisar√° de 0,085 BTC de troco. Para receber o troco, a carteira da Alice cria uma sa√≠da de troco na mesma transa√ß√£o que far√° o pagamento para o Bob. Essencialmente, a carteira da Alice divide seus fundos em dois pagamentos: um para o Bob e outro de volta para ela mesma. Dessa maneira a Alice pode ent√£o usar (gastar) a sa√≠da do troco em uma transa√ß√£o no futuro.</p>
</div>
<div class="paragraph data-line-446">
<p>Finalmente, para que a transa√ß√£o seja processada pela rede em tempo h√°bil, o aplicativo de carteira da Alice adicionar√° uma pequena taxa. Esta taxa n√£o est√° expl√≠cita na transa√ß√£o, ela est√° impl√≠cita na diferen√ßa de valor existente entre as entradas e as sa√≠das. Se, ao inv√©s de criar uma sa√≠da de troco de 0,085 BTC, a Alice criar uma sa√≠da com apenas 0,0845 BTC, sobrar√° 0,0005 BTC (meio milibitcoin). A entrada de 0,10 BTC n√£o ser√° totalmente gasta pelas duas sa√≠das, pois elas somam menos de 0,10 BTC. A diferen√ßa resultante √© a <em>taxa da transa√ß√£o</em>, que √© coletada pelo minerador como um pagamento por validar e incluir a transa√ß√£o em um bloco a ser registrado na blockchain.</p>
</div>
<div class="paragraph data-line-448">
<p>A transa√ß√£o resultante pode ser vista usando um aplicativo web explorador de blockchain, como visto na <a href="#transaction-alice">Transa√ß√£o da Alice para a Cafeteria do Bob</a>.</p>
</div>
<div id="transaction-alice" class="imageblock smallerseventyfive data-line-453">
<div class="content">
<img src="images/mbc2_0208.png" alt="Alice Coffee Transaction">
</div>
<div class="title">Figure 10. Transa√ß√£o da Alice para a Cafeteria do Bob</div>
</div>
<div id="transaction-alice-url" class="admonitionblock tip data-line-457">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-458">
<p>Veja a <a href="https://www.blockchain.com/btc/tx/0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2" data-href="https://www.blockchain.com/btc/tx/0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2">transa√ß√£o da Alice para a Cafeteria do Bob</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-461">
<p>==== Adicionando uma Transa√ß√£o ao Registro</p>
</div>
<div class="paragraph data-line-463">
<p>The transaction created by Alice&#8217;s wallet application is 258 bytes long and contains everything necessary to confirm ownership of the funds and assign new owners. Now, the transaction must be transmitted to the Bitcoin network where it will become part of the blockchain. In the next section we will see how a transaction becomes part of a new block and how the block is "mined." Finally, we will see how the new block, once added to the blockchain, is increasingly trusted by the network as more blocks are added.</p>
</div>
<div class="paragraph data-line-465">
<p>===== Transmitindo a transa√ß√£o</p>
</div>
<div class="paragraph data-line-467">
<p>Because the transaction contains all the information necessary to process, it does not matter how or where it is transmitted to the Bitcoin network. The Bitcoin network is a peer-to-peer network, with each Bitcoin client participating by connecting to several other Bitcoin clients. The purpose of the Bitcoin network is to propagate transactions and blocks to all participants.</p>
</div>
<div class="paragraph data-line-469">
<p>===== Como ela se propaga</p>
</div>
<div class="paragraph data-line-471">
<p>Any system, such as a server, desktop application, or wallet, that participates in the Bitcoin network by "speaking" the Bitcoin protocol is called a <em>Bitcoin node</em>. Alice&#8217;s wallet application can send the new transaction to any Bitcoin node it is connected to over any type of connection: wired, WiFi, mobile, etc.  Her bitcoin wallet does not have to be connected to Bob&#8217;s bitcoin wallet directly and she does not have to use the internet connection offered by the cafe, though both those options are possible, too. Any Bitcoin node that receives a valid transaction it has not seen before will immediately forward it to all other nodes to which it is connected, a propagation technique known as <em>flooding</em>. Thus, the transaction rapidly propagates out across the peer-to-peer network, reaching a large percentage of the nodes within a few seconds.</p>
</div>
<div class="paragraph data-line-473">
<p>===== A vis√£o do Bob</p>
</div>
<div class="paragraph data-line-475">
<p>Se o aplicativo de carteira do Bob estiver diretamente conectado ao aplicativo de carteira da Alice, ele pode ser o primeiro n√≥ a receber a transa√ß√£o. Entretanto, mesmo que a carteira da Alice envie a transa√ß√£o atrav√©s de outros n√≥s, a transa√ß√£o chegar√° √† carteira do Bob dentro de pouco segundos. A carteira do Bob identificar√° imediatamente a transa√ß√£o da Alice como um pagamento, pois ela cont√©m sa√≠das que s√£o resgat√°veis pelas chaves do Bob. A carteira do Bob tamb√©m pode verificar independentemente que a transa√ß√£o √© bem formada, utiliza sa√≠das que ainda n√£o foram gastas e cont√©m uma taxa de transa√ß√£o suficiente para ser inclu√≠da no pr√≥ximo bloco. Neste momento o Bob pode presumir, com um alto grau de probabilidade, que a transa√ß√£o em breve ser√° inclu√≠da em um bloco (ser√° confirmada).</p>
</div>
<div class="admonitionblock tip data-line-478">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-479">
<p>Uma ideia erroneamente difundida √© a de que para serem "confirmadas", as transa√ß√µes de bitcoin exigem uma espera de 10 minutos por um novo bloco, ou de at√© 60 minutos por seis confirma√ß√µes. Embora essas confirma√ß√µes realmente sejam uma garantia de que a transa√ß√£o foi aceita por toda a rede, n√£o √© necess√°rio esperar todo esse tempo para transa√ß√µes envolvendo itens de pequeno valor, como uma x√≠cara de caf√©. Um comerciante pode aceitar uma transa√ß√£o de pequeno valor ainda sem confirma√ß√µes, correndo um risco semelhante ao que correria ao receber um pagamento com cart√£o de cr√©dito sem assinatura ou identifica√ß√£o do cliente, algo que √© rotineiramente feito pelos comerciantes hoje em dia.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-482">
<p>=== Minera√ß√£o do Bitcoin</p>
</div>
<div class="paragraph data-line-484">
<p>Alice&#8217;s transaction is now propagated on the Bitcoin network. It does not become part of the <em>blockchain</em> until it is verified and included in a block by a process called <em>mining</em>. See <a href="#mining">[mining]</a> for a detailed explanation.</p>
</div>
<div class="paragraph data-line-486">
<p>The Bitcoin system of trust is based on computation. Transactions are bundled into <em>blocks</em>, which require an enormous amount of computation to prove, but only a small amount of computation to verify as proven. The mining process serves two purposes in bitcoin:</p>
</div>
<div class="ulist data-line-488">
<ul>
<li class="data-line-488">
<p>Os n√≥s de minera√ß√£o validam todas as transa√ß√µes de acordo com as <em>regras de consenso</em> do bitcoin. Portanto, ao rejeitar transa√ß√µes inv√°lidas ou malformadas, a minera√ß√£o fornece seguran√ßa para as transa√ß√µes do bitcoin.</p>
</li>
<li class="data-line-489">
<p>A minera√ß√£o cria novos bitcoins em cada bloco, quase como se fosse um banco central imprimindo dinheiro novo. A quantidade de bitcoins criados por bloco √© limitada e diminui com o tempo, seguindo um cronograma de emiss√£o fixo.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-492">
<p>A minera√ß√£o atinge um equil√≠brio preciso entre o custo e a recompensa. A minera√ß√£o usa a eletricidade para resolver um problema matem√°tico. Um minerador bem-sucedido receber√° uma <em>recompensa</em> na forma de novos bitcoins e taxas de transa√ß√£o. No entanto, a recompensa s√≥ ser√° recolhida se o minerador tiver validado corretamente todas as transa√ß√µes, de acordo com as regras do <em>consenso</em>. Este delicado equil√≠brio fornece seguran√ßa para o bitcoin, dispensando a necessidade de uma autoridade central.</p>
</div>
<div class="paragraph data-line-494">
<p>Uma boa maneira de descrever a minera√ß√£o √© como um jogo de sudoku gigantesco e competitivo, que reinicia cada vez que algu√©m encontra uma solu√ß√£o e cuja dificuldade se ajusta automaticamente, de maneira que leve cerca de 10 minutos para que uma solu√ß√£o seja encontrada. Imagine um sudoku gigantesco, com milhares de colunas e linhas. Se eu mostrar para voc√™ um sudoku completamente preenchido, voc√™ pode verificar rapidamente que ele est√° corretamente preenchido. No entanto, se o sudoku tiver apenas alguns quadrados preenchidos e o resto estiver vazio, isso exigir√° muito trabalho para resolv√™-lo! A dificuldade do sudoku pode ser ajustada ao mudar o seu tamanho (mais ou menos linhas ou colunas), mas o sudoku ainda pode ser verificado de maneira r√°pida, mesmo que ele seja muito grande. O "quebra-cabe√ßas" usado no bitcoin √© baseado em um hash criptogr√°fico, que exibe caracter√≠sticas semelhantes: ele √© assimetricamente dif√≠cil de resolver, mas f√°cil de verificar, e sua dificuldade pode ser ajustada.</p>
</div>
<div class="paragraph data-line-496">
<p>In <a href="#user-stories">Usos do Bitcoin, Usu√°rios e Suas Hist√≥rias</a>, we introduced Jing, an entrepreneur in Shanghai. Jing runs a <em>mining farm</em>, which is a business that runs thousands of specialized mining computers, competing for the reward. Every 10 minutes or so, Jing&#8217;s mining computers compete against thousands of similar systems in a global race to find a solution to a block of transactions. Finding such a solution, the so-called <em>Proof-of-Work</em> (PoW), requires quadrillions of hashing operations per second across the entire Bitcoin network. The algorithm for Proof-of-Work involves repeatedly hashing the header of the block and a random number with the SHA256 cryptographic algorithm until a solution matching a predetermined pattern emerges. The first miner to find such a solution wins the round of competition and publishes that block into the blockchain.</p>
</div>
<div class="paragraph data-line-498">
<p>Jing started mining in 2010 using a very fast desktop computer to find a suitable Proof-of-Work for new blocks. As more miners started joining the Bitcoin network, the difficulty of the problem increased rapidly. Soon, Jing and other miners upgraded to more specialized hardware, with high-end dedicated graphical processing units (GPUs), often used in gaming desktops or consoles. At the time of this writing, the difficulty is so high that it is profitable only to mine with application-specific integrated circuits (ASIC), essentially hundreds of mining algorithms printed in hardware, running in parallel on a single silicon chip. Jing&#8217;s company also participates in a <em>mining pool</em>, which much like a lottery pool allows several participants to share their efforts and rewards. Jing&#8217;s company now runs a warehouse containing thousands of  ASIC miners to mine for bitcoin 24 hours a day. The company pays its electricity costs by selling the bitcoin it is able to generate from mining, creating some income from the profits.</p>
</div>
<div class="paragraph data-line-500">
<p>=== Minerando Transa√ß√µes em Blocos</p>
</div>
<div class="paragraph data-line-502">
<p>New transactions are constantly flowing into the network from user wallets and other applications. As these are seen by the Bitcoin network nodes, they get added to a temporary pool of unverified transactions maintained by each node. As miners construct a new block, they add unverified transactions from this pool to the new block and then attempt to prove the validity of that new block, with the mining algorithm (Proof-of-Work). The process of mining is explained in detail in <a href="#mining">[mining]</a>.</p>
</div>
<div class="paragraph data-line-504">
<p>Transactions are added to the new block, prioritized by the highest-fee transactions first and a few other criteria. Each miner starts the process of mining a new block of transactions as soon as they receive the previous block from the network, knowing they have lost that previous round of competition. They immediately create a new block, fill it with transactions and the fingerprint of the previous block, and start calculating the Proof-of-Work for the new block. Each miner includes a special transaction in their block, one that pays their own Bitcoin address the block reward (currently 6.25 newly created bitcoin) plus the sum of transaction fees from all the transactions included in the block. If they find a solution that makes that block valid, they "win" this reward because their successful block is added to the global blockchain and the reward transaction they included becomes spendable. Jing, who participates in a mining pool, has set up his software to create new blocks that assign the reward to a pool address. From there, a share of the reward is distributed to Jing and other miners in proportion to the amount of work they contributed in the last round.</p>
</div>
<div class="paragraph data-line-506">
<p>A transa√ß√£o da Alice foi captada pela rede e inclu√≠da na <em>pool</em> de transa√ß√µes n√£o verificadas. Depois de validada pelo software de minera√ß√£o, ela foi inclu√≠da em um novo bloco, denominado <em>bloco candidato</em>, gerado pela <em>pool</em> de minera√ß√£o do Jing. Todos os mineradores que participam dessa <em>pool</em> de minera√ß√£o come√ßam imediatamente a calcular a Prova-de-Trabalho para o bloco candidato. Aproximadamente cinco minutos depois que a transa√ß√£o foi transmitida pela primeira vez pela carteira da Alice, um dos equipamentos de minera√ß√£o ASIC do Jing encontrou uma solu√ß√£o para o bloco candidato e a anunciou para a rede. Assim que outros mineradores validaram o bloco vencedor, eles come√ßaram a corrida para gerar o pr√≥ximo bloco.</p>
</div>
<div class="paragraph data-line-508">
<p>O bloco vencedor do Jing tornou-se parte da <em>blockchain</em> como bloco n¬∫277316, contendo 419 transa√ß√µes, incluindo a transa√ß√£o da Alice. O bloco que cont√©m a transa√ß√£o da Alice √© contado como sendo uma "confirma√ß√£o" dessa transa√ß√£o.</p>
</div>
<div class="admonitionblock tip data-line-511">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-512">
<p>Voc√™ pode ver o bloco que inclui <a href="https://www.blockchain.com/btc/block/277316" data-href="https://www.blockchain.com/btc/block/277316">Alice&#39;s transaction</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-515">
<p>Aproximadamente 20 minutos mais tarde, um novo bloco, n¬∫277317, √© minerado por outro minerador. Como esse novo bloco foi constru√≠do sobre o bloco n¬∫277316 que continha a transa√ß√£o da Alice, ele adicionou ainda mais computa√ß√£o √† blockchain, fortalecendo assim a confian√ßa nessas transa√ß√µes. Cada bloco minerado acima do bloco contendo a transa√ß√£o da Alice conta como uma confirma√ß√£o adicional para a transa√ß√£o da Alice. √Ä medida que os blocos se empilham uns sobre os outros, torna-se exponencialmente mais dif√≠cil de se reverter a transa√ß√£o, tornando-a cada vez mais confi√°vel para a rede.</p>
</div>
<div class="paragraph data-line-517">
<p>No diagrama da <a href="#block-alice1">Transa√ß√£o da Alice inclu√≠da no bloco n¬∫277316</a>, podemos ver o bloco n¬∫277316, que cont√©m a transa√ß√£o da Alice. Abaixo dele est√£o 277.316 blocos (incluindo o bloco n¬∫0), ligados uns aos outros em uma cadeia de blocos (<em>blockchain</em>) at√© chegar ao bloco n¬∫0, tamb√©m conhecido como <em>bloco g√™nese</em>. Ao longo do tempo, √† medida que a "altura" da pilha de blocos aumenta, tamb√©m aumenta a dificuldade computacional de cada bloco e da cadeia como um todo. Os blocos minerados ap√≥s aquele que cont√©m a transa√ß√£o da Alice atuam como garantia adicional, pois acumulam mais computa√ß√£o em uma cadeia cada vez mais longa. Por conven√ß√£o, qualquer bloco com mais de seis confirma√ß√µes √© considerado irrevog√°vel, pois seria necess√°ria uma quantidade imensa de computa√ß√£o para recalcular seis blocos, e, com isso, invalid√°-los. No <a href="#mining">[mining]</a>, examinaremos em maiores detalhes o processo de minera√ß√£o e a maneira como ele constr√≥i confian√ßa.</p>
</div>
<div id="block-alice1" class="imageblock data-line-521">
<div class="content">
<img src="images/mbc2_0209.png" alt="Alice&#8217;s transaction included in a block">
</div>
<div class="title">Figure 11. Transa√ß√£o da Alice inclu√≠da no bloco n¬∫277316</div>
</div>
<div class="paragraph data-line-523">
<p>=== Gastando a Transa√ß√£o</p>
</div>
<div class="paragraph data-line-525">
<p>Now that Alice&#8217;s transaction has been embedded in the blockchain as part of a block, it is part of the distributed ledger of bitcoin and visible to all bitcoin applications. Each Bitcoin client can independently verify the transaction as valid and spendable. Full-node clients can track the source of the funds from the moment the bitcoin were first generated in a block, incrementally from transaction to transaction, until they reach Bob&#8217;s address. Lightweight clients can do what is called a simplified payment verification (see <a href="#spv_nodes">[spv_nodes]</a>) by confirming that the transaction is in the blockchain and has several blocks mined after it, thus providing assurance that the miners accepted it as valid.</p>
</div>
<div class="paragraph data-line-527">
<p>Agora o Bob pode gastar a sa√≠da dessa e de outras transa√ß√µes. Por exemplo, o Bob pode pagar um contratante ou fornecedor transferindo o valor do pagamento da x√≠cara de caf√© da Alice. Mais provavelmente, o software de bitcoin do Bob agregar√° v√°rios pequenos pagamentos em um pagamento maior, talvez concentrando em uma √∫nica transa√ß√£o todos os pagamentos em bitcoin que a loja recebeu em um dia. Isso agregaria os v√°rios pagamentos em uma √∫nica sa√≠da (e um √∫nico endere√ßo). Na <a href="#transaction-aggregating">Transa√ß√£o agregadora de fundos</a>, voc√™ pode ver um diagrama de uma transa√ß√£o de agrega√ß√£o.</p>
</div>
<div class="paragraph data-line-529">
<p>√Ä medida que o Bob gasta os pagamentos que recebeu da Alice e de outros clientes, ele estende a cadeia de transa√ß√µes. Vamos supor que o Bob tenha feito um pagamento para que seu webdesigner Gopesh em Bangalore desenvolva um novo site. Agora, a cadeia de transa√ß√µes ficar√° parecida com a exibida na <a href="#block-alice2">A transa√ß√£o da Alice como parte de uma cadeia de transa√ß√µes partindo do Joe at√© chegar ao Gopesh, onde a sa√≠da de uma transa√ß√£o √© gasta como a entrada da pr√≥xima transa√ß√£o</a>.</p>
</div>
<div id="block-alice2" class="imageblock data-line-533">
<div class="content">
<img src="images/mbc2_0210.png" alt="Alice&#8217;s transaction as part of a transaction chain">
</div>
<div class="title">Figure 12. A transa√ß√£o da Alice como parte de uma cadeia de transa√ß√µes partindo do Joe at√© chegar ao Gopesh, onde a sa√≠da de uma transa√ß√£o √© gasta como a entrada da pr√≥xima transa√ß√£o</div>
</div>
<div class="paragraph data-line-535">
<p>In this chapter, we saw how transactions build a chain that moves value from owner to owner. We also tracked Alice&#8217;s transaction, from the moment it was created in her wallet, through the Bitcoin network and to the miners who recorded it on the blockchain. In the rest of this book, we will examine the specific technologies behind wallets, addresses, signatures, transactions, the network, and finally mining. </p>
</div>
<div id="ch03_bitcoin_client" class="paragraph data-line-538">
<p>== Bitcoin Core: A Implementa√ß√£o de Refer√™ncia</p>
</div>
<div class="paragraph data-line-540">
<p>O bitcoin √© um projeto de <em>c√≥digo aberto</em> e o seu c√≥digo-fonte est√° dispon√≠vel sob uma licen√ßa aberta (MIT), de download gratuito e que pode ser usada para qualquer finalidade. Ter c√≥digo aberto significa mais do que simplesmente ser livre para usar. Isso tamb√©m significa que o bitcoin √© desenvolvido por uma comunidade aberta de volunt√°rios. No in√≠cio, essa comunidade era apenas o Satoshi Nakamoto. Em 2016, o c√≥digo-fonte do bitcoin j√° tinha mais de 400 colaboradores, com cerca de uma d√∫zia de desenvolvedores trabalhando no c√≥digo quase em tempo integral e dezenas de outros desenvolvedores trabalhando em tempo parcial. Qualquer pessoa pode contribuir com o c√≥digo&#x2014;incluindo voc√™!</p>
</div>
<div class="paragraph data-line-543">
<p>When bitcoin was created by Satoshi Nakamoto, the software was actually completed before the whitepaper reproduced in <a href="#satoshi_whitepaper">[satoshi_whitepaper]</a> was written. Satoshi wanted to make sure it worked before writing about it. That first implementation, then simply known as "Bitcoin" or "Satoshi client," has been heavily modified and improved. It has evolved into what is known as <em>Bitcoin Core</em>, to differentiate it from other compatible implementations. Bitcoin Core is the <em>reference implementation</em> of the Bitcoin system, meaning that it is the authoritative reference on how each part of the technology should be implemented. Bitcoin Core implements all aspects of bitcoin, including wallets, a transaction and block validation engine, and a full network node in the peer-to-peer Bitcoin network.</p>
</div>
<div class="admonitionblock warning data-line-546">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-547">
<p>Apesar de o Bitcoin Core incluir uma implementa√ß√£o de refer√™ncia de uma carteira, ela n√£o deve ser usada como uma carteira de produ√ß√£o para usu√°rios ou aplicativos. Os desenvolvedores de aplicativos s√£o aconselhados a construir carteiras usando padr√µes modernos, como os padr√µes BIP-39 e BIP-32 (ver <a href="#mnemonic_code_words">[mnemonic_code_words]</a> e <a href="#hd_wallets">[hd_wallets]</a>). BIP significa <em>Proposta de Melhoria ao Bitcoin</em> (em ingl√™s, <em>Bitcoin Improvement Proposal</em>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-550">
<p>A <a href="#bitcoin_core_architecture">Arquitetura do Bitcoin Core (Fonte: Eric Lombrozo)</a> mostra a arquitetura do Bitcoin Core.</p>
</div>
<div id="bitcoin_core_architecture" class="imageblock data-line-554">
<div class="content">
<img src="images/mbc2_0301.png" alt="Bitcoin Core Architecture">
</div>
<div class="title">Figure 13. Arquitetura do Bitcoin Core (Fonte: Eric Lombrozo)</div>
</div>
<div class="paragraph data-line-557">
<p>=== Ambiente de Desenvolvimento do Bitcoin</p>
</div>
<div class="paragraph data-line-559">
<p>Se voc√™ for um desenvolvedor, voc√™ precisar√° configurar um ambiente de desenvolvimento com todas as ferramentas, bibliotecas e softwares de suporte para programar as aplica√ß√µes do bitcoin. Neste cap√≠tulo altamente t√©cnico, vamos percorrer esse processo passo a passo. Se o material ficar muito denso (e voc√™ n√£o estiver realmente instalando um ambiente de desenvolvimento), fique √† vontade para pular para o pr√≥ximo cap√≠tulo, que √© menos t√©cnico.</p>
</div>
<div id="compiling_core" class="paragraph data-line-562">
<p>=== Compilando o Bitcoin Core a partir do C√≥digo-Fonte</p>
</div>
<div class="paragraph data-line-564">
<p>O c√≥digo-fonte do Bitcoin Core pode ser baixado como um arquivo ou clonando-se o reposit√≥rio oficial do GitHub. Na <a href="https://bitcoincore.org/bin/" data-href="https://bitcoincore.org/bin/">p√°gina de download do Bitcoin Core</a>, selecione a vers√£o mais recente e baixe o arquivo compactado do c√≥digo-fonte, por exemplo, bitcoin- 0.15.0.2.tar.gz. Como alternativa, use a linha de comando do git para criar uma c√≥pia local do c√≥digo-fonte do <a href="https://github.com/bitcoin/bitcoin" data-href="https://github.com/bitcoin/bitcoin">reposit√≥rio do bitcoin no GitHub</a>.</p>
</div>
<div class="admonitionblock tip data-line-567">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-568">
<p>Em muitos dos exemplos neste cap√≠tulo, estaremos usando a interface de linha de comando do sistema operacional (tamb√©m conhecida como "shell"), acessada por meio de um aplicativo de "terminal". O shell exibir√° um prompt; voc√™ digita um comando; e o shell responde com algum texto e um novo prompt para seu pr√≥ximo comando. O prompt pode ter uma apar√™ncia diferente em seu sistema, mas nos exemplos a seguir ele √© denotado por um s√≠mbolo $. Nos exemplos do livro, ao ver um texto ap√≥s um s√≠mbolo $, n√£o digite o s√≠mbolo $, mas digite o comando imediatamente ap√≥s ele e pressione Enter para executar o comando. Nos exemplos, as linhas abaixo de cada comando s√£o as respostas do sistema operacional a esse comando. Ao ver o pr√≥ximo prefixo $, voc√™ saber√° que isso √© um novo comando e que voc√™ dever√° repetir o processo.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-571">
<p>Neste exemplo, estamos usando o comando git para criar uma c√≥pia local (um "clone") do c√≥digo-fonte:</p>
</div>
<div class="listingblock data-line-573">
<div class="content">
<pre>$ git clone https://github.com/bitcoin/bitcoin.git
Clonando para 'bitcoin'...
remoto: Contando objetos: 102071, pronto.
remoto: Comprimindo objetos: 100% (10/10), pronto.
Recebendo objetos: 100% (102071/102071), 86.38 MiB | 730.00 KiB/s, pronto.
remoto: Total 102071 (delta 4), reusados 5 (delta 1), pack-reusados 102060
Resolvendo deltas: 100% (76168/76168), pronto.
Verificando conectividade... pronto.
$</pre>
</div>
</div>
<div class="admonitionblock tip data-line-586">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-587">
<p>O git √© o sistema de controle de vers√£o distribu√≠do mais amplamente usado, uma parte essencial do kit de ferramentas de qualuer desenvolvedor de software. Voc√™ pode precisar instalar em seu sistema operacional o comando git ou uma interface gr√°fica de usu√°rio para git, caso o seu sistema operacional ainda n√£o tenha.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-590">
<p>Quando a opera√ß√£o de clonagem do git for conclu√≠da, voc√™ ter√° no diret√≥rio <em>bitcoin</em> uma c√≥pia local completa do reposit√≥rio do c√≥digo-fonte. Mude para este diret√≥rio digitando **cd bitcoin** no prompt:</p>
</div>
<div class="listingblock data-line-592">
<div class="content">
<pre>$ cd bitcoin</pre>
</div>
</div>
<div class="paragraph data-line-596">
<p>==== Escolhendo uma Vers√£o do Bitcoin Core
Por padr√£o, a c√≥pia local ser√° sincronizada com o c√≥digo mais recente, que pode ser uma vers√£o inst√°vel ou beta do bitcoin. Antes de compilar o c√≥digo, selecione a vers√£o espec√≠fica ao fazer um checkout de uma <em>tag</em> de lan√ßamento. Isso sincronizar√° a c√≥pia local com um instant√¢neo espec√≠fico do reposit√≥rio do c√≥digo, o qual √© identificado por uma tag. As tags s√£o usadas pelos desenvolvedores para marcar lan√ßamentos espec√≠ficos do c√≥digo atrav√©s de um n√∫mero de vers√£o. Primeiro, para encontrar as tags dispon√≠veis, usaremos o comando git tag:</p>
</div>
<div class="listingblock data-line-599">
<div class="content">
<pre>$ git tag
v0.1.5
v0.1.6test1
v0.10.0
...
v0.11.2
v0.11.2rc1
v0.12.0rc1
v0.12.0rc2
...</pre>
</div>
</div>
<div class="paragraph data-line-612">
<p>A lista de tags exibe todas as vers√µes do bitcoin j√° lan√ßadas. Por conven√ß√£o, os <em>release candidates</em> (candidatos a lan√ßamento), que s√£o feitos para testes, t√™m o sufixo "rc". As vers√µes est√°veis, que podem ser executadas em sistemas de produ√ß√£o, n√£o possuem sufixo. Nesta lista que foi exibida, selecione a vers√£o mais recente, que at√© o momento em que esse livro foi escrito era a v0.15.0. Para sincronizar o c√≥digo local com esta vers√£o, use o comando git checkout.</p>
</div>
<div class="listingblock data-line-614">
<div class="content">
<pre>$ git checkout v0.15.0
HEAD est√° agora em 3751912... Merge #11295: doc: Old fee_estimates.dat are discarded by 0.15.0</pre>
</div>
</div>
<div class="paragraph data-line-619">
<p>Voc√™ pode confirmar que fez o "check out" da vers√£o desejada ao executar o comando git status:</p>
</div>
<div class="listingblock data-line-621">
<div class="content">
<pre>$ git status
HEAD desanexado na v0.15.0
nada para fazer commit, diret√≥rio de trabalho limpo</pre>
</div>
</div>
<div class="paragraph data-line-627">
<p>==== Configurando a Compila√ß√£o do Bitcoin Core</p>
</div>
<div class="paragraph data-line-629">
<p>The source code includes documentation, which can be found in a number of files. Review the main documentation located in <em>README.md</em> in the <em>bitcoin</em> directory by typing **more README.md** at the prompt and using the spacebar to progress to the next page. In this chapter, we will build the command-line Bitcoin client, also known as bitcoind on Linux. Review the instructions for compiling the bitcoind command-line client on your platform by typing **more doc/build-unix.md**. Alternative instructions for macOS and Windows can be found in the <em>doc</em> directory, as <em>build-osx.md</em> or <em>build-windows.md</em>, respectively.</p>
</div>
<div class="paragraph data-line-631">
<p>Analise cuidadosamente os pr√©-requisitos da vers√£o, presentes na primeira parte da documenta√ß√£o do mesmo. Estas s√£o as bibliotecas que devem estar presentes em seu sistema antes que voc√™ possa iniciar a compila√ß√£o do bitcoin. Se estes pr√©-requisitos estiverem ausentes, o processo de compila√ß√£o falhar√°. Se isso acontecer, voc√™ pode instal√°-los e ent√£o continuar o processo de compila√ß√£o de onde voc√™ parou. Assumindo que os pr√©-requisitos est√£o instalados, voc√™ inicia o processo de compila√ß√£o gerando um conjunto de scripts de compila√ß√£o que utilizam o script <em>autogen.sh</em>.</p>
</div>
<div class="listingblock data-line-633">
<div class="content">
<pre>$ ./autogen.sh
...
glibtoolize: copiando o arquivo 'build-aux/m4/libtool.m4'
glibtoolize: copiando o arquivo 'build-aux/m4/ltoptions.m4'
glibtoolize: copiando o arquivo 'build-aux/m4/ltsugar.m4'
glibtoolize: copiando o arquivo 'build-aux/m4/ltversion.m4'
...
configure.ac:10: instalando 'build-aux/compile'
configure.ac:5: instalando 'build-aux/config.guess'
configure.ac:5: instalando 'build-aux/config.sub'
configure.ac:9: instalando 'build-aux/install-sh'
configure.ac:9: instalando 'build-aux/missing'
Makefile.am: instalando 'build-aux/depcomp'
...</pre>
</div>
</div>
<div class="paragraph data-line-650">
<p>O script <em>autogen.sh</em> cria um conjunto de scripts de configura√ß√£o autom√°tica que analisar√£o o seu sistema para descobrir as configura√ß√µes corretas e garantir que voc√™ tenha todas as bibliotecas necess√°rias para compilar o c√≥digo. O mais importante desses scripts √© o script configure, que oferece v√°rias op√ß√µes diferentes para customizar o processo de compila√ß√£o. Digite **./configure --help** para ver as v√°rias op√ß√µes:</p>
</div>
<div class="listingblock data-line-652">
<div class="content">
<pre>$ ./configure --help
`configure' configura o Bitcoin Core 0.15.0 para se adaptar a muitos tipos de sistemas.

Uso: ./configure [OP√á√ÉO]... [VAR=VALOR]...

...
Fun√ß√µes opcionais:
  --disable-option-checking  ignore unrecognized --enable/--with options
  --disable-FEATURE n√£o incluir FEATURE (mesmo que --enable-FEATURE=no)
  --enable-FEATURE[=ARG]  incluir FEATURE [ARG=yes]

  --enable-wallet         ativa a carteira (o padr√£o √© yes)

  --with-gui[=no|qt4|qt5|auto]
...</pre>
</div>
</div>
<div class="paragraph data-line-670">
<p>O script configure permite que voc√™ habilite ou desabilite certas fun√ß√µes do bitcoind atrav√©s do uso das flags --enable-FEATURE e --disable-FEATURE, onde <span class="keep-together"><code>FEATURE</code></span> √© substitu√≠da pelo nome da funcionalidade, como listada no output do help. Nesse cap√≠tulo, compilaremos o cliente bitcoind com todas as fun√ß√µes padr√£o. N√£o usaremos as flags de configura√ß√£o, mas voc√™ deveria revis√°-las para conhecer quais s√£o as funcionalidades opcionais que fazem parte do cliente. Se voc√™ estiver em um ambiente acad√™mico, as restri√ß√µes do laborat√≥rio de inform√°tica podem exigir que voc√™ instale os aplicativos em seu diret√≥rio <em>home</em> (por exemplo, usando --prefix=$HOME).</p>
</div>
<div class="paragraph data-line-672">
<p>A seguir est√£o algumas op√ß√µes √∫teis que substituem o comportamento padr√£o do script de configura√ß√£o:</p>
</div>
<dl>
<dt><code>--prefix=$HOME</code></dt>
<dd><p>Essa op√ß√£o substitui o local de instala√ß√£o padr√£o (que √© <em>/usr/local/</em>) do execut√°vel que ser√° compilado. Use <code>$HOME</code> para instalar tudo em seu diret√≥rio _home_, ou use um caminho diferente.</p></dd>

<dt><code>--disable-wallet</code></dt>
<dd><p>Essa op√ß√£o √© usada para desativar a implementa√ß√£o de carteira de refer√™ncia.</p></dd>

<dt><code>--with-incompatible-bdb</code></dt>
<dd><p>Se voc√™ estiver compilando uma carteira, essa op√ß√£o permite o uso de uma vers√£o incompat√≠vel da biblioteca Berkeley DB.</p></dd>

<dt><code>--with-gui=no</code></dt>
<dd><p>Essa op√ß√£o faz com que a interface gr√°fica do usu√°rio n√£o seja compilada, o que requer a biblioteca Qt. Apenas o servidor e a linha de comando do bitcoin ser√£o compilados.</p></dd>
</dl>
<div class="paragraph data-line-690">
<p>A seguir, execute o script configure para descobrir automaticamente todas as bibliotecas necess√°rias e crie um script de compila√ß√£o personalizado para o seu sistema:</p>
</div>
<div class="listingblock data-line-692">
<div class="content">
<pre>$ ./configure
verificando o tipo de sistema de compila√ß√£o... x86_64-unknown-linux-gnu
verificando o tipo de sistema host... x86_64-unknown-linux-gnu
verificando se h√° uma instala√ß√£o compat√≠vel com BSD... /usr/bin/install -c
verificando se o ambiente de compila√ß√£o √© l√≥gico... sim
verificando se h√° um mkdir -p thread-seguro... /bin/mkdir -p
verificando o gawk... gawk
verificando se o make define $(MAKE)... sim
...
[muitas p√°ginas de configura√ß√£o a seguir]
...
$</pre>
</div>
</div>
<div class="paragraph data-line-708">
<p>Se tudo der certo, o comando configure terminar√° criando os scripts de compila√ß√£o customizados que nos permitir√£o compilar o bitcoind. Se houver bibliotecas faltando ou erros, o comando configure terminar√° com um erro ao inv√©s de criar os script de compila√ß√£o. Se um erro ocorrer, mais provavelmente ser√° devido a uma biblioteca faltando ou incompat√≠vel. Revise a documenta√ß√£o da compila√ß√£o novamente e certifique-se de que voc√™ instalou os pr√©-requisitos que est√£o em falta. Ent√£o execute o configure novamente e veja se isso corrige o erro.</p>
</div>
<div class="paragraph data-line-710">
<p>==== Compilando os Execut√°veis do Bitcoin Core</p>
</div>
<div class="paragraph data-line-712">
<p>Em seguida, voc√™ compilar√° o c√≥digo-fonte, um processo que pode levar at√© uma hora para ser completado, dependendo da velocidade do seu processador e da mem√≥ria dispon√≠vel. Durante o processo de compila√ß√£o, voc√™ dever√° ver um output a cada poucos segundos ou minutos, ou um erro se algo der errado. Se ocorrer algum erro, ou o processo de compila√ß√£o for interrompido, ele pode ser reiniciado digitando-se novamente make. Digite **make** para iniciar a compila√ß√£o do aplicativo execut√°vel:</p>
</div>
<div class="listingblock data-line-714">
<div class="content">
<pre>$ make
Making all in src
  CXX      crypto/libbitcoinconsensus_la-hmac_sha512.lo
  CXX      crypto/libbitcoinconsensus_la-ripemd160.lo
  CXX      crypto/libbitcoinconsensus_la-sha1.lo
  CXX      crypto/libbitcoinconsensus_la-sha256.lo
  CXX      crypto/libbitcoinconsensus_la-sha512.lo
  CXX      libbitcoinconsensus_la-hash.lo
  CXX      primitives/libbitcoinconsensus_la-transaction.lo
  CXX      libbitcoinconsensus_la-pubkey.lo
  CXX      script/libbitcoinconsensus_la-bitcoinconsensus.lo
  CXX      script/libbitcoinconsensus_la-interpreter.lo

[... muitas outras mensagens de compila√ß√£o ...]

$</pre>
</div>
</div>
<div class="paragraph data-line-733">
<p>Em um sistema r√°pido com mais de uma CPU, voc√™ pode querer definir o n√∫mero de trabalhos de compila√ß√£o paralela. Por exemplo, make -j 2 usar√° dois n√∫cleos se estiverem dispon√≠veis. Se tudo correr bem, o Bitcoin Core agora est√° compilado. Voc√™ deve executar o conjunto de testes de unidade com make check para garantir que as bibliotecas vinculadas n√£o est√£o quebradas de maneiras √≥bvias. A etapa final √© instalar os v√°rios execut√°veis em seu sistema usando o comando make install. A sua senha de usu√°rio pode ser solicitada, pois esta etapa requer privil√©gios administrativos:</p>
</div>
<div class="listingblock data-line-735">
<div class="content">
<pre>$ make check &amp;&amp; sudo make install
Senha:
Making install in src
 ../build-aux/install-sh -c -d '/usr/local/lib'
libtool: install: /usr/bin/install -c bitcoind /usr/local/bin/bitcoind
libtool: install: /usr/bin/install -c bitcoin-cli /usr/local/bin/bitcoin-cli
libtool: install: /usr/bin/install -c bitcoin-tx /usr/local/bin/bitcoin-tx
...
$</pre>
</div>
</div>
<div class="paragraph data-line-747">
<p>A instala√ß√£o padr√£o do bitcoind o coloca em <em>/usr/local/bin</em>. Voc√™ pode confirmar que o Bitcoin Core est√° instalado corretamente solicitando ao sistema o caminho dos execut√°veis, da seguinte maneira:</p>
</div>
<div class="listingblock data-line-749">
<div class="content">
<pre>$ which bitcoind
/usr/local/bin/bitcoind

$ which bitcoin-cli
/usr/local/bin/bitcoin-cli</pre>
</div>
</div>
<div class="paragraph data-line-757">
<p>=== Executando um N√≥ do Bitcoin Core</p>
</div>
<div class="paragraph data-line-759">
<p>Bitcoin&#8217;s peer-to-peer network is composed of network "nodes," run mostly by volunteers and some of the businesses that build bitcoin applications. Those running Bitcoin nodes have a direct and authoritative view of the Bitcoin blockchain, with a local copy of all the transactions, independently validated by their own system. By running a node, you don&#8217;t have to rely on any third party to validate a transaction. Moreover, by running a Bitcoin node you contribute to the Bitcoin network by making it more robust.</p>
</div>
<div class="paragraph data-line-761">
<p>Running a node, however, requires a permanently connected system with enough resources to process all bitcoin transactions. Depending on whether you choose to index all transactions and keep a full copy of the blockchain, you may also need a lot of disk space and RAM. As of early 2021, a full-index node needs 2 GB of RAM and a minimum of 360 GB of disk space (see <a href="https://www.blockchain.com/charts/blocks-size" class="undefined" data-href="https://www.blockchain.com/charts/blocks-size">https://www.blockchain.com/charts/blocks-size</a>). Bitcoin nodes also transmit and receive bitcoin transactions and blocks, consuming internet bandwidth. If your internet connection is limited, has a low data cap, or is metered (charged by the gigabit), you should probably not run a Bitcoin node on it, or run it in a way that constrains its bandwidth (see <a href="#constrained_resources">Configura√ß√£o de amostra de um sistema com recursos limitados</a>).</p>
</div>
<div class="admonitionblock tip data-line-764">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-765">
<p>Bitcoin Core keeps a full copy of the blockchain by default, with every transaction that has ever occurred on the Bitcoin network since its inception in 2009. This dataset is dozens of gigabytes in size and is downloaded incrementally over several days or weeks, depending on the speed of your CPU and internet connection. Bitcoin Core will not be able to process transactions or update account balances until the full blockchain dataset is downloaded. Make sure you have enough disk space, bandwidth, and time to complete the initial synchronization. You can configure Bitcoin Core to reduce the size of the blockchain by discarding old blocks (see <a href="#constrained_resources">Configura√ß√£o de amostra de um sistema com recursos limitados</a>), but it will still download the entire dataset before discarding data.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-768">
<p>Despite these resource requirements, thousands of volunteers run Bitcoin nodes. Some are running on systems as simple as a Raspberry Pi (a $35 USD computer the size of a pack of cards). Many volunteers also run Bitcoin nodes on rented servers, usually some variant of Linux. A <em>Virtual Private Server</em> (VPS) or <em>Cloud Computing Server</em> instance can be used to run a Bitcoin node. Such servers can be rented for $25 to $50 USD per month from a variety of providers.</p>
</div>
<div class="paragraph data-line-770">
<p>Por que voc√™ desejaria executar um n√≥? Aqui est√£o alguns dos motivos mais comuns:</p>
</div>
<div class="ulist data-line-772">
<ul>
<li class="data-line-772">
<p>If you are developing bitcoin software and need to rely on a Bitcoin node for programmable (API) access to the network and blockchain.</p>
</li>
<li class="data-line-774">
<p>Se voc√™ estiver construindo aplicativos que devem validar as transa√ß√µes de acordo com as regras de consenso do bitcoin. Normalmente, as empresas de software de bitcoin executam v√°rios n√≥s.</p>
</li>
<li class="data-line-776">
<p>Se voc√™ deseja apoiar o bitcoin. Executar um n√≥ torna a rede mais robusta e capaz de atender mais carteiras, mais usu√°rios e mais transa√ß√µes.</p>
</li>
<li class="data-line-778">
<p>Se voc√™ n√£o quiser depender de terceiros para processar ou validar suas transa√ß√µes.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-780">
<p>Se voc√™ est√° lendo este livro e est√° interessado em desenvolver um software de bitcoin, voc√™ deve executar o seu pr√≥prio n√≥.</p>
</div>
<div class="paragraph data-line-782">
<p>==== Configurando o N√≥ do Bitcoin Core</p>
</div>
<div class="paragraph data-line-784">
<p>O Bitcoin Core procurar√° um arquivo de configura√ß√£o em seu diret√≥rio de dados a cada inicializa√ß√£o. Nesta se√ß√£o, examinaremos as v√°rias op√ß√µes de configura√ß√£o e definiremos um arquivo de configura√ß√£o. Para localizar o arquivo de configura√ß√£o, execute bitcoind -printtoconsole em seu terminal e observe as primeiras linhas.</p>
</div>
<div class="listingblock data-line-786">
<div class="content">
<pre>$ bitcoind -printtoconsole
Bitcoin vers√£o v0.15.0
Usando a implementa√ß√£o SHA256 'padr√£o'
Usando o diret√≥rio de dados /home/ubuntu/.bitcoin/
Usando o arquivo de configura√ß√£o /home/ubuntu/.bitcoin/bitcoin.conf
...
[muitos outros outputs de depura√ß√£o]
...</pre>
</div>
</div>
<div class="paragraph data-line-797">
<p>Voc√™ pode pressionar Ctrl+C para desligar o n√≥ depois de definir a localiza√ß√£o do arquivo de configura√ß√£o. Normalmente, o arquivo de configura√ß√£o est√° dentro do diret√≥rio de dados <em>.bitcoin</em> no diret√≥rio <em>home</em> do usu√°rio. Ele n√£o √© criado automaticamente, mas voc√™ pode criar um arquivo de configura√ß√£o inicial copiando e colando do <a href="#full_index_node">Configura√ß√£o de amostra de um n√≥ de √≠ndice completo</a> abaixo. Voc√™ pode criar ou modificar o arquivo de configura√ß√£o em seu editor preferido.</p>
</div>
<div class="paragraph data-line-799">
<p>O Bitcoin Core oferece mais de 100 op√ß√µes de configura√ß√£o que modificam o comportamento do n√≥ da rede, o armazenamento da blockchain e muitos outros aspectos de sua opera√ß√£o. Para ver uma lista dessas op√ß√µes, execute bitcoind  --help:</p>
</div>
<div class="listingblock data-line-801">
<div class="content">
<pre>$ bitcoind --help
Daemon do Bitcoin Core vers√£o v0.15.0

Uso:
  bitcoind [op√ß√µes]                     Inicia o Daemon do Bitcoin Core

Op√ß√µes:

  -?
       Exibe essa mensagem de ajuda e sai

  -version
       Exibe a vers√£o e sai

  -alertnotify=&lt;cmd&gt;
       Executa o comando quando um alerta relevante for recebido ou quando vemos um
       fork longo (%s no cmd √© substitu√≠do pela mensagem)
...
[diversas outras op√ß√µes]
...

  -rpcthreads=&lt;n&gt;
       Define o n√∫mero de threads para atender chamadas RPC (padr√£o: 4)</pre>
</div>
</div>
<div class="paragraph data-line-827">
<p>Aqui est√£o algumas das op√ß√µes mais importantes que voc√™ pode definir no arquivo de configura√ß√£o, ou como par√¢metros de linha de comando para o bitcoind:</p>
</div>
<div class="dlist data-line-829">
<dl>
<dt class="hdlist1">alertnotify</dt>
<dd>
<p>Executa um comando ou script especificado para enviar alertas de emerg√™ncia ao propriet√°rio deste n√≥, geralmente por e-mail.</p>
</dd>
<dt class="hdlist1">conf</dt>
<dd>
<p>Um local alternativo para o arquivo de configura√ß√£o. Essa op√ß√£o deve ser apenas utilizada como um par√¢metro de linha de comando para o bitcoind, pois ela n√£o pode estar dentro do arquivo de configura√ß√£o ao qual se refere.</p>
</dd>
<dt class="hdlist1">datadir</dt>
<dd>
<p>Seleciona o diret√≥rio e o sistema de arquivos nos quais devem ser colocados todos os dados da blockchain. Por padr√£o, este √© o subdiret√≥rio <em>.bitcoin</em> do seu diret√≥rio <em>home</em>. Certifique-se de que o sistema de arquivos tenha v√°rios gigabytes de espa√ßo livre.</p>
</dd>
<dt class="hdlist1">prune</dt>
<dd>
<p>Reduz os requisitos de espa√ßo em disco para muitos megabytes, ao excluir blocos antigos. Use essa op√ß√£o em um n√≥ com recursos limitados, sem espa√ßo para armazenar toda a blockchain.</p>
</dd>
<dt class="hdlist1">txindex</dt>
<dd>
<p>Manter um √≠ndice de todas as transa√ß√µes. Isso significa uma c√≥pia completa da blockchain que permite recuperar programaticamente qualquer transa√ß√£o atrav√©s do ID.</p>
</dd>
<dt class="hdlist1">dbcache</dt>
<dd>
<p>O tamanho do cache de UTXOs. O padr√£o √© 450 MiB. Aumente-o, caso esteja usando um hardware de ponta. Reduza-o, caso esteja usando um hardware de baixo custo, para economizar mem√≥ria, √† custa de uma lentid√£o nas opera√ß√µes de entrada e sa√≠da (IO) do disco.</p>
</dd>
<dt class="hdlist1">maxconnections</dt>
<dd>
<p>Define o n√∫mero m√°ximo de n√≥s dos quais se deve aceitar conex√µes. Reduzir esse valor reduzir√° o consumo de dados da sua Internet. Use se voc√™ tiver um limite de dados ou pagar por gigabyte.</p>
</dd>
<dt class="hdlist1">maxmempool</dt>
<dd>
<p>Limita a <em>pool</em> de mem√≥ria de transa√ß√µes a uma quantidade de megabytes. Use essa op√ß√£o para reduzir o uso de mem√≥ria em n√≥s com restri√ß√£o de mem√≥ria.</p>
</dd>
<dt class="hdlist1">maxreceivebuffer/maxsendbuffer</dt>
<dd>
<p>Limita o buffer de mem√≥ria por conex√£o para uma determinada quantidade de m√∫ltiplos de 1.000 bytes. Use essa op√ß√£o em n√≥s com restri√ß√£o de mem√≥ria.</p>
</dd>
<dt class="hdlist1">minrelaytxfee</dt>
<dd>
<p>Define a taxa m√≠nima para que voc√™ retransmita uma transa√ß√£o. Abaixo desse valor, a transa√ß√£o √© tratada como fora de padr√£o, sendo rejeitada pela pool de transa√ß√µes e n√£o sendo retransmitida.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="paragraph data-line-317">
<p>Por padr√£o, o Bitcoin Core constr√≥i um banco de dados contendo <em>apenas</em> as transa√ß√µes relacionadas √† carteira do usu√°rio. Se voc√™ deseja ser capaz de acessar <em>qualquer</em> transa√ß√£o com comandos como getrawtransaction (ver <a href="#exploring_and_decoding_transanctions">[exploring_and_decoding_transanctions]</a>), voc√™ precisar√° configurar o Bitcoin Core para construir um √≠ndice de transa√ß√µes completo, que pode ser feito com a op√ß√£o txindex. Defina txindex=1 no arquivo de configura√ß√£o do Bitcoin Core. Se voc√™ n√£o definir esta op√ß√£o inicialmente e depois quiser defini-la para ter uma indexa√ß√£o completa, voc√™ precisar√° reiniciar o bitcoind com a op√ß√£o -reindex e esperar que ele reconstrua o √≠ndice.</p>
</div>
<div class="sidebarblock data-line-318">
<div class="content">
<div class="paragraph data-line-320">
<p>O <a href="#full_index_node">Configura√ß√£o de amostra de um n√≥ de √≠ndice completo</a> mostra como voc√™ pode combinar as op√ß√µes anteriores, com um n√≥ de √≠ndice completo, executando como um back-end de API para um aplicativo de bitcoin.</p>
</div>
<div id="full_index_node" class="exampleblock data-line-324">
<div class="title">Example 3. Configura√ß√£o de amostra de um n√≥ de √≠ndice completo</div>
<div class="content">
<div class="listingblock data-line-325">
<div class="content">
<pre>alertnotify=myemailscript.sh "Alerta: %s"
datadir=/diretoriocombastanteespaco/bitcoin
txindex=1</pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-332">
<p>O <a href="#constrained_resources">Configura√ß√£o de amostra de um sistema com recursos limitados</a> mostra um n√≥ com restri√ß√£o de recursos em execu√ß√£o em um servidor menor.</p>
</div>
<div id="constrained_resources" class="exampleblock data-line-336">
<div class="title">Example 4. Configura√ß√£o de amostra de um sistema com recursos limitados</div>
<div class="content">
<div class="listingblock data-line-337">
<div class="content">
<pre>alertnotify=myemailscript.sh "Alerta: %s"
maxconnections=15
prune=5000
dbcache=150
maxmempool=150
maxreceivebuffer=2500
maxsendbuffer=500</pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-348">
<p>Depois de editar o arquivo de configura√ß√£o e definir as op√ß√µes que melhor representam suas necessidades, voc√™ pode testar o bitcoind com esta configura√ß√£o. Execute o Bitcoin Core com a op√ß√£o printtoconsole para execut√°-lo em primeiro plano e com sa√≠da para o console:</p>
</div>
<div class="listingblock data-line-350">
<div class="content">
<pre>$ bitcoind -printtoconsole

Bitcoin vers√£o v0.15.0
InitParameterInteraction: parameter interaction: -whitelistforcerelay=1 -&gt; setting -whitelistrelay=1
Assumindo que os ancestrais do bloco 0000000000000000003b9ce759c2a087d52abc4266f8f4ebd6d768b89defa50a possuem assinaturas v√°lidas.
Usando a implementa√ß√£o SHA256 'padr√£o'
Diret√≥rio de dados padr√£o /home/ubuntu/.bitcoin
Usando o diret√≥rio de dados /lotsofspace/.bitcoin
Usando o arquivo de configura√ß√£o /home/ubuntu/.bitcoin/bitcoin.conf
Usando no m√°ximo 125 conex√µes autom√°ticas (1048576 descritores de arquivo dispon√≠veis)
Usando 16 MiB de 32/2 solicitados para o cache de assinatura, capaz de armazenar 524.288 elementos
Usando 16 MiB de 32/2 solicitados para o cache de execu√ß√£o de script, capaz de armazenar 524.288 elementos
Usando 2 threads para verifica√ß√£o de script
HTTP: criando fila de trabalho de profundidade 16
Nenhuma rpcpassword definida - usando autentica√ß√£o de cookie aleat√≥rio
Cookie de autentica√ß√£o RPC gerado /lotsofspace/.bitcoin/.cookie
HTTP: iniciando 4 threads de trabalho
mensagem init: Verificando carteira(s)...
Usando BerkeleyDB vers√£o Berkeley DB 4.8.30: (9 de abril, 2010)
Usando a carteira wallet.dat
CDBEnv::Open: LogDir=/lotsofspace/.bitcoin/database ErrorFile=/lotsofspace/.bitcoin/db.log
scheduler thread start
Configura√ß√£o do cache:
* Usando 250,0 MiB para banco de dados de √≠ndice de bloco
* Usando 8,0 MiB para banco de dados de estado da cadeia
* Usando 1742,0 MiB para o conjunto UTXO em mem√≥ria (mais at√© 286,1 MiB de espa√ßo de mempool n√£o utilizado)
mensagem init: Carregando √≠ndice de blocos...
Abrindo LevelDB em /lotsofspace/.bitcoin/blocks/index
LevelDB aberto com sucesso

[... mais mensagens de inicializa√ß√£o ...]</pre>
</div>
</div>
<div class="paragraph data-line-384">
<p>Voc√™ pode pressionar Ctrl+C para interromper o processo assim que voc√™ estiver satisfeito que ele est√° carregando as configura√ß√µes corretas e que est√° rodando conforme o esperado.</p>
</div>
<div class="paragraph data-line-386">
<p>Para executar o Bitcoin Core em segundo plano como um processo, inicie-o com a op√ß√£o daemon, como bitcoind -daemon.</p>
</div>
<div class="paragraph data-line-388">
<p>To monitor the progress and runtime status of your Bitcoin node, use the command bitcoin-cli getblockchaininfo:</p>
</div>
<div class="listingblock data-line-390">
<div class="content">
<pre>$ bitcoin-cli getblockchaininfo</pre>
</div>
</div>
<div class="listingblock data-line-395">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "chain": "main",
  "blocks": 0,
  "headers": 83999,
  "bestblockhash": "000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f",
  "difficulty": 1,
  "mediantime": 1231006505,
  "verificationprogress": 3.783041623201835e-09,
  "chainwork": "0000000000000000000000000000000000000000000000000000000100010001",
  "pruned": false,
  [...]
}</code></pre>
</div>
</div>
<div class="paragraph data-line-410">
<p>O resultado do comando nos mostra um n√≥ com uma altura de blockchain de 0 blocos e 83.999 cabe√ßalhos. Atualmente o n√≥ primeiro busca todos os cabe√ßalhos de bloco da melhor cadeia e, depois disso, come√ßa a baixar os blocos completos.</p>
</div>
<div class="paragraph data-line-412">
<p>Quando estiver satisfeito com as op√ß√µes de configura√ß√£o selecionadas, voc√™ deve adicionar o bitcoin aos scripts de inicializa√ß√£o do seu sistema operacional, para que seja executado continuamente e para que seja reinicializado quando o sistema operacional for reiniciado. Voc√™ encontrar√° v√°rios exemplos de scripts de inicializa√ß√£o para v√°rios sistemas operacionais no diret√≥rio do bitcoin em <em>contrib/init</em> e um arquivo <em>README.md</em> mostrando qual sistema usa cada script.</p>
</div>
<div class="paragraph data-line-414">
<p>=== A Interface de Programa√ß√£o de Aplicativo (API) do Bitcoin Core</p>
</div>
<div class="paragraph data-line-416">
<p>O cliente Bitcoin Core implementa uma interface JSON-RPC que tamb√©m pode ser acessada ao se utilizar a ajuda da linha de comando do bitcoin-cli. A linha de comando nos permite experimentar interativamente com as capacidades que tamb√©m est√£o dispon√≠veis programaticamente atrav√©s da API. Para iniciar, execute o comando help para ver uma lista dos comandos RPC dispon√≠veis no bitcoin:</p>
</div>
<div id="bitcoind_commands" class="listingblock data-line-420">
<div class="content">
<pre>$ bitcoin-cli help
addmultisigaddress nrequired ["key",...] ( "account" )
addnode "node" "add|remove|onetry"
backupwallet "destination"
createmultisig nrequired ["key",...]
createrawtransaction [{"txid":"id","vout":n},...] {"address":amount,...}
decoderawtransaction "hexstring"
...
...
verifymessage "bitcoinaddress" "signature" "message"
walletlock
walletpassphrase "passphrase" timeout
walletpassphrasechange "oldpassphrase" "newpassphrase"</pre>
</div>
</div>
<div class="paragraph data-line-436">
<p>Cada um desses comandos pode ter v√°rios par√¢metros. Para obter ajuda adicional, uma descri√ß√£o detalhada e informa√ß√µes sobre os par√¢metros, adicione o nome do comando ap√≥s help. Por exemplo, para ver ajuda sobre o comando RPC getblockhash:</p>
</div>
<div class="listingblock data-line-438">
<div class="content">
<pre>$ bitcoin-cli help getblockhash
getblockhash altura

Retorna o hash do bloco na melhor cadeia de blocos para a altura fornecida.

Argumentos:
1. altura         (num√©rico, obrigat√≥rio) O √≠ndice da altura

Resultado:
"hash"         (string) O hash do bloco

Exemplos:
&gt; bitcoin-cli getblockhash 1000
&gt; curl --user myusername --data-binary '{"jsonrpc": "1.0", "id":"curltest", "method": "getblockhash", "params": [1000] }' -H 'content-type: text/plain;' http://127.0.0.1:8332/</pre>
</div>
</div>
<div class="paragraph data-line-455">
<p>No final das informa√ß√µes de ajuda, voc√™ ver√° dois exemplos do comando RPC, usando a ajuda do bitcoin-cli ou o cliente HTTP curl. Esses exemplos demonstram como voc√™ pode chamar o comando. Copie o primeiro exemplo e veja o resultado:</p>
</div>
<div class="listingblock data-line-457">
<div class="content">
<pre>$ bitcoin-cli getblockhash 1000
00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09</pre>
</div>
</div>
<div class="paragraph data-line-462">
<p>O resultado √© um hash de bloco, que ser√° descrito em maiores detalhes nos pr√≥ximos cap√≠tulos. Mas, por enquanto, este comando deve retornar o mesmo resultado em seu sistema, demonstrando que seu n√≥ do Bitcoin Core est√° em execu√ß√£o, est√° aceitando comandos e tem informa√ß√µes sobre o bloco 1000 para retornar para voc√™.</p>
</div>
<div class="paragraph data-line-464">
<p>Nas pr√≥ximas se√ß√µes, demonstraremos alguns comandos RPC muito √∫teis e a sua sa√≠da esperada.</p>
</div>
<div class="paragraph data-line-466">
<p>==== Obtendo Informa√ß√µes sobre o Status do Cliente Bitcoin Core</p>
</div>
<div class="paragraph data-line-468">
<p>O Bitcoin Core fornece relat√≥rios sobre o status de diferentes m√≥dulos por meio da interface JSON-RPC. Os comandos mais importantes incluem getblockchaininfo, getmempoolinfo, getnetworkinfo e getwalletinfo.</p>
</div>
<div class="paragraph data-line-470">
<p>Bitcoin&#8217;s getblockchaininfo RPC command was introduced earlier. The getnetworkinfo command displays basic information about the status of the Bitcoin network node. Use bitcoin-cli to run it:</p>
</div>
<div class="listingblock data-line-472">
<div class="content">
<pre>$ bitcoin-cli getnetworkinfo</pre>
</div>
</div>
<div class="listingblock data-line-476">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "version": 150000,
  "subversion": "/Satoshi:0.15.0/",
  "protocolversion": 70015,
  "localservices": "000000000000000d",
  "localrelay": true,
  "timeoffset": 0,
  "networkactive": true,
  "connections": 8,
  "networks": [
    ...
    informa√ß√µes detalhadas sobre todas as redes (ipv4, ipv6 ou onion)
    ...
  ],
  "relayfee": 0.00001000,
  "incrementalfee": 0.00001000,
  "localaddresses": [
  ],
  "warnings": ""
}</code></pre>
</div>
</div>
<div class="paragraph data-line-500">
<p>The data is returned in JavaScript Object Notation (JSON), a format that can easily be "consumed" by all programming languages but is also quite human-readable. Among this data we see the version numbers for the bitcoin software client (150000) and Bitcoin protocol (70015).  We see the current number of connections (8) and various information about the Bitcoin network and the settings related to this client.</p>
</div>
<div class="admonitionblock tip data-line-503">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-504">
<p>It will take some time, perhaps more than a day, for the bitcoind client to "catch up" to the current blockchain height as it downloads blocks from other Bitcoin clients. You can check its progress using getblockchaininfo to see the number of known blocks.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="exploring_and_decoding_transanctions" class="paragraph data-line-508">
<p>==== Explorando e Decodificando as Transa√ß√µes</p>
</div>
<div class="paragraph data-line-510">
<p>Comandos: getrawtransaction, decoderawtransaction</p>
</div>
<div class="paragraph data-line-514">
<p>Em <a href="#cup_of_coffee">[cup_of_coffee]</a>, a Alice comprou uma x√≠cara de caf√© da Cafeteria do Bob. A sua transa√ß√£o foi registrada na blockchain com o ID de transa√ß√£o (txid) 0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2. Vamos usar a API para recuperar e examinar essa transa√ß√£o passando o ID da transa√ß√£o como um par√¢metro:</p>
</div>
<pre data-type="programlisting">
$ bitcoin-cli getrawtransaction 0627052b6f28912f2703066a912ea577f2ce4da4caa5a&#x21b5;
5fbd8a57286c345c2f2

0100000001186f9f998a5aa6f048e51dd8419a14d8a0f1a8a2836dd734d2804fe65fa35779000&#x21b5;
000008b483045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4&#x21b5;
ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813014&#x21b5;
10484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc54123363767&#x21b5;
89d172787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adfffffffff0260e3160000000&#x21b5;
0001976a914ab68025513c3dbd2f7b92a94e0581f5d50f654e788acd0ef8000000000001976a9&#x21b5;
147f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a888ac00000000
</pre>
<div class="admonitionblock tip data-line-533">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-534">
<p>Um ID de transa√ß√£o n√£o √© "oficial" at√© que a transa√ß√£o tenha sido confirmada. A aus√™ncia de um hash de transa√ß√£o na blockchain n√£o significa que a transa√ß√£o n√£o foi processada. Isso √© conhecido como "maleabilidade da transa√ß√£o", e refere-se ao fato de que os hashes de transa√ß√£o podem ser modificados antes de serem confirmados em um bloco. Ap√≥s a confirma√ß√£o, o txid √© imut√°vel e oficial.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-537">
<p>O comando getrawtransaction retorna uma transa√ß√£o serializada em nota√ß√£o hexadecimal. Para decodific√°-la, usamos o comando decoderawtransaction, passando os dados hexadecimais como par√¢metro. Voc√™ pode copiar o hexadecimal retornado pelo comando getrawtransaction e col√°-lo como um par√¢metro para o comando decoderawtransaction:</p>
</div>
<pre data-type="programlisting">
$ bitcoin-cli decoderawtransaction 0100000001186f9f998a5aa6f048e51dd8419a14d8&#x21b5;
a0f1a8a2836dd734d2804fe65fa35779000000008b483045022100884d142d86652a3f47ba474&#x21b5;
6ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298&#x21b5;
cad530a863ea8f53982c09db8f6e381301410484ecc0d46f1918b30928fa0e4ed99f16a0fb4fd&#x21b5;
e0735e7ade8416ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc17b4a10fa&#x21b5;
336a8d752adfffffffff0260e31600000000001976a914ab68025513c3dbd2f7b92a94e0581f5&#x21b5;
d50f654e788acd0ef8000000000001976a9147f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a8&#x21b5;
88ac00000000

</pre>
<pre data-type="programlisting" data-code-language="json">
{
  "txid": "0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2",
  "size": 258,
  "version": 1,
  "locktime": 0,
  "vin": [
    {
      "txid": "7957a35fe64f80d234d76d83a2...8149a41d81de548f0a65a8a999f6f18",
      "vout": 0,
      "scriptSig": {
        "asm":"3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1decc...",
        "hex":"483045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1de..."
      },
      "sequence": 4294967295
    }
  ],
  "vout": [
    {
      "value": 0.01500000,
      "n": 0,
      "scriptPubKey": {
        "asm": "OP_DUP OP_HASH160 ab68...5f654e7 OP_EQUALVERIFY OP_CHECKSIG",
        "hex": "76a914ab68025513c3dbd2f7b92a94e0581f5d50f654e788ac",
        "reqSigs": 1,
        "type": "pubkeyhash",
        "addresses": [
          "1GdK9UzpHBzqzX2A9JFP3Di4weBwqgmoQA"
        ]
      }
    },
    {
      "value": 0.08450000,
      "n": 1,
      "scriptPubKey": {
        "asm": "OP_DUP OP_HASH160 7f9b1a...025a8 OP_EQUALVERIFY OP_CHECKSIG",
        "hex": "76a9147f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a888ac",
        "reqSigs": 1,
        "type": "pubkeyhash",
        "addresses": [
          "1Cdid9KFAaatwczBwBttQcwXYCpvK8h7FK"
        ]
      }
    }
  ]
}

</pre>
<div class="paragraph data-line-604">
<p>A decodifica√ß√£o da transa√ß√£o mostra todos os componentes desta transa√ß√£o, incluindo as entradas e as sa√≠das de transa√ß√£o. Nesse caso, vemos que a transa√ß√£o que creditou nosso novo endere√ßo com 15 milibits usou uma entrada e gerou duas sa√≠das. A entrada para essa transa√ß√£o foi a sa√≠da de uma transa√ß√£o previamente confirmada (exibida com o txid 7957a35fe... em vin). As duas sa√≠das (exibidas em vout) correspondem a uma sa√≠da com o cr√©dito de 15 milibit e a uma sa√≠da com o troco de volta ao remetente.</p>
</div>
<div class="paragraph data-line-606">
<p>Podemos explorar mais a fundo a blockchain ao examinarmos a transa√ß√£o anterior referenciada pelo seu txid nesta transa√ß√£o usando os mesmos comandos (ex: getrawtransaction). Saltando de transa√ß√£o em transa√ß√£o, podemos seguir uma cadeia de transa√ß√µes de tr√°s para frente, conforme as moedas s√£o transmitidas entre os endere√ßos de seus donos.</p>
</div>
<div class="paragraph data-line-610">
<p>==== Explorando os Blocos</p>
</div>
<div class="paragraph data-line-612">
<p>Comandos: getblock, getblockhash</p>
</div>
<div class="paragraph data-line-614">
<p>Explorar blocos √© semelhante a explorar transa√ß√µes. No entanto, os blocos podem ser referenciados pela <em>altura</em> do bloco ou pelo <em>hash</em> do bloco. Primeiro, vamos encontrar um bloco pela sua altura. Em <a href="#cup_of_coffee">[cup_of_coffee]</a>, vimos que a transa√ß√£o da Alice foi inclu√≠da no bloco 277316.</p>
</div>
<div class="paragraph data-line-616">
<p>Usaremos o comando getblockhash, que recebe a altura do bloco como par√¢metro e retorna o hash do bloco para aquele bloco:</p>
</div>
<pre data-type="programlisting">
$ bitcoin-cli getblockhash 277316
0000000000000001b6b9a13b095e96db41c4a928b97ef2d944a9b31b2cc7bdc4
</pre>
<div class="paragraph data-line-625">
<p>Agora que sabemos em qual bloco a transa√ß√£o da Alice foi inclu√≠da, podemos consultar esse bloco. Usaremos o comando getblock com o hash do bloco como par√¢metro:</p>
</div>
<pre data-type="programlisting">
$ bitcoin-cli getblock 0000000000000001b6b9a13b095e96db41c4a928b97ef2d944a9b3&#x21b5;
1b2cc7bdc4
</pre>
<pre data-type="programlisting" data-code-language="json">
{
  "hash": "0000000000000001b6b9a13b095e96db41c4a928b97ef2d944a9b31b2cc7bdc4",
  "confirmations": 37371,
  "size": 218629,
  "height": 277316,
  "version": 2,
  "merkleroot": "c91c008c26e50763e9f548bb8b2fc323735f73577effbc55502c51eb4cc7cf2e",
  "tx": [
    "d5ada064c6417ca25c4308bd158c34b77e1c0eca2a73cda16c737e7424afba2f",
    "b268b45c59b39d759614757718b9918caf0ba9d97c56f3b91956ff877c503fbe",
    "04905ff987ddd4cfe603b03cfb7ca50ee81d89d1f8f5f265c38f763eea4a21fd",
    "32467aab5d04f51940075055c2f20bbd1195727c961431bf0aff8443f9710f81",
    "561c5216944e21fa29dd12aaa1a45e3397f9c0d888359cb05e1f79fe73da37bd",
[... centenas de transa√ß√µes ...]
    "78b300b2a1d2d9449b58db7bc71c3884d6e0579617e0da4991b9734cef7ab23a",
    "6c87130ec283ab4c2c493b190c20de4b28ff3caf72d16ffa1ce3e96f2069aca9",
    "6f423dbc3636ef193fd8898dfdf7621dcade1bbe509e963ffbff91f696d81a62",
    "802ba8b2adabc5796a9471f25b02ae6aeee2439c679a5c33c4bbcee97e081196",
    "eaaf6a048588d9ad4d1c092539bd571dd8af30635c152a3b0e8b611e67d1a1af",
    "e67abc6bd5e2cac169821afc51b207127f42b92a841e976f9b752157879ba8bd",
    "d38985a6a1bfd35037cb7776b2dc86797abbb7a06630f5d03df2785d50d5a2ac",
    "45ea0a3f6016d2bb90ab92c34a7aac9767671a8a84b9bcce6c019e60197c134b",
    "c098445d748ced5f178ef2ff96f2758cbec9eb32cb0fc65db313bcac1d3bc98f"
  ],
  "time": 1388185914,
  "mediantime": 1388183675,
  "nonce": 924591752,
  "bits": "1903a30c",
  "difficulty": 1180923195.258026,
  "chainwork": "000000000000000000000000000000000000000000000934695e92aaf53afa1a",
  "previousblockhash": "0000000000000002a7bbd25a417c0374cc55261021e8a9ca74442b01284f0569",
  "nextblockhash": "000000000000000010236c269dd6ed714dd5db39d36b33959079d78dfd431ba7"
}
</pre>
<div class="paragraph data-line-672">
<p>O bloco cont√©m 419 transa√ß√µes e a 64¬™ transa√ß√£o listada (0627052b...) √© o pagamento da x√≠cara de caf√© da Alice. A entrada height nos diz que este √© o 277.316¬∫ bloco na blockchain.</p>
</div>
<div class="paragraph data-line-674">
<p>==== Usando a Interface Program√°tica do Bitcoin Core</p>
</div>
<div class="paragraph data-line-676">
<p>A ajuda do bitcoin-cli √© muito √∫til para explorar a API do Bitcoin Core e testar fun√ß√µes. Mas uma interface de programa√ß√£o de aplicativo √© feita para que as fun√ß√µes sejam acessadas programaticamente. Nesta se√ß√£o, demonstraremos como acessar o Bitcoin Core a partir de outro programa.</p>
</div>
<div class="paragraph data-line-678">
<p>A API do Bitcoin Core √© uma interface JSON-RPC. JSON significa Nota√ß√£o de Objetos JavaScript (em ingl√™s, <em>JavaScript Object Notation</em>) e √© uma maneira muito conveniente de apresentar dados que tanto humanos quanto programas podem ler facilmente. RPC significa Chamada de Procedimento Remoto (em ingl√™s, <em>Remote Procedure Call</em>), o que significa que estamos chamando procedimentos (fun√ß√µes) que s√£o remotos (est√£o no n√≥ do Bitcoin Core) atrav√©s de um protocolo de rede. Nesse caso, o protocolo de rede √© o HTTP ou o HTTPS (para conex√µes criptografadas).</p>
</div>
<div class="paragraph data-line-680">
<p>Quando usamos o comando bitcoin-cli para obter ajuda em um comando, ele nos mostrou um exemplo usando o curl, o vers√°til cliente HTTP de linha de comando, para construir uma dessas chamadas JSON-RPC:</p>
</div>
<div class="listingblock data-line-682">
<div class="content">
<pre>$ curl --user myusername --data-binary '{"jsonrpc": "1.0", "id":"curltest", "method": "getblockchaininfo", "params": [] }' -H 'content-type: text/plain;' http://127.0.0.1:8332/</pre>
</div>
</div>
<div class="paragraph data-line-686">
<p>Este comando mostra que o curl submete uma solicita√ß√£o HTTP ao host local (127.0.0.1), conectando-se √† porta bitcoin padr√£o (8332) e enviando uma solicita√ß√£o jsonrpc para o m√©todo getblockchaininfo usando a codifica√ß√£o text/plain.</p>
</div>
<div class="paragraph data-line-688">
<p>Voc√™ pode notar que o curl solicitar√° que as credenciais sejam enviadas junto com a solicita√ß√£o. O Bitcoin Core criar√° uma senha aleat√≥ria em cada inicializa√ß√£o e a colocar√° no diret√≥rio de dados com o nome .cookie. O helper do bitcoin-cli pode ler este arquivo de senha no diret√≥rio de dados. Da mesma forma, voc√™ pode copiar a senha e pass√°-la para o curl (ou qualquer wrapper de RPC do Bitcoin Core de n√≠vel superior). Como alternativa, voc√™ pode criar uma senha est√°tica com o script auxiliar fornecido no arquivo <em>./share/rpcauth/rpcauth.py</em> localizado no diret√≥rio do Bitcoin Core.</p>
</div>
<div class="paragraph data-line-690">
<p>Se voc√™ estiver implementando uma chamada JSON-RPC em seu pr√≥prio programa, voc√™ pode usar uma biblioteca HTTP gen√©rica para construir a chamada, de maneira semelhante ao que √© mostrado no exemplo anterior do curl.</p>
</div>
<div class="paragraph data-line-692">
<p>No entanto, existem bibliotecas em quase todas as linguagens de programa√ß√£o que "envolvem" a API do Bitcoin Core, simplificando muito o processo. Usaremos a biblioteca python-bitcoinlib para simplificar o acesso √† API. Lembre-se de que isso requer uma inst√¢ncia do Bitcoin Core em execu√ß√£o, que ser√° usada para fazer chamadas JSON-RPC.</p>
</div>
<div class="paragraph data-line-694">
<p>O script Python no <a href="#rpc_example">Executando o getblockchaininfo via API JSON-RPC do Bitcoin Core</a> faz uma chamada simples getblockchaininfo e imprime o par√¢metro blocks dos dados retornados pelo Bitcoin Core (este exemplo requer um n√≥ completo).</p>
</div>
<div id="rpc_example" class="exampleblock data-line-698">
<div class="title">Example 5. Executando o getblockchaininfo via API JSON-RPC do Bitcoin Core</div>
<div class="content">
<div class="listingblock data-line-700">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">Unresolved directive in for_use_mastering-bitcoin_chapter-3_pt_BR.adoc - include::code/rpc_example.py[]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-705">
<p>Ao execut√°-lo obtemos o seguinte resultado:</p>
</div>
<div class="listingblock data-line-707">
<div class="content">
<pre>$ python rpc_example.py
394075</pre>
</div>
</div>
<div class="paragraph data-line-712">
<p>Isso nos diz que nosso n√≥ local do Bitcoin Core tem 394.075 blocos em sua blockchain. N√£o √© um resultado espetacular, mas demonstra o uso b√°sico da biblioteca como uma interface simplificada para a API JSON-RPC do Bitcoin Core.</p>
</div>
<div class="paragraph data-line-714">
<p>A seguir, vamos usar as chamadas getrawtransaction e decodetransaction para recuperar os detalhes do pagamento da x√≠cara de caf√© da Alice. No <a href="#rpc_transaction">Recuperando uma transa√ß√£o e iterando suas sa√≠das</a>, recuperamos a transa√ß√£o da Alice e listamos as sa√≠das da transa√ß√£o. Para cada sa√≠da, mostramos o endere√ßo e o valor do destinat√°rio. Como lembramos, a transa√ß√£o da Alice teve uma sa√≠da pagando a Cafeteria do Bob e uma sa√≠da de troco de volta para a Alice.</p>
</div>
<div id="rpc_transaction" class="exampleblock data-line-718">
<div class="title">Example 6. Recuperando uma transa√ß√£o e iterando suas sa√≠das</div>
<div class="content">
<div class="listingblock data-line-720">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">Unresolved directive in for_use_mastering-bitcoin_chapter-3_pt_BR.adoc - include::code/rpc_transaction.py[]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-725">
<p>Executando este c√≥digo, obtemos:</p>
</div>
<div class="listingblock data-line-727">
<div class="content">
<pre>$ python rpc_transaction.py
([u'1GdK9UzpHBzqzX2A9JFP3Di4weBwqgmoQA'], Decimal('0.01500000'))
([u'1Cdid9KFAaatwczBwBttQcwXYCpvK8h7FK'], Decimal('0.08450000'))</pre>
</div>
</div>
<div class="paragraph data-line-733">
<p>Ambos os exemplos anteriores s√£o bastante simples. Voc√™ realmente n√£o precisa de um programa para execut√°-los; voc√™ poderia facilmente usar a ajuda do bitcoin-cli. O pr√≥ximo exemplo, entretanto, requer v√°rias centenas de chamadas RPC e demonstra mais claramente o uso de uma interface program√°tica.</p>
</div>
<div class="paragraph data-line-735">
<p>No <a href="#rpc_block">Recuperando um bloco e somando todas as sa√≠das de transa√ß√£o</a>, primeiro recuperamos o bloco 277316, em seguida, recuperamos cada uma das 419 transa√ß√µes por refer√™ncia a cada ID de transa√ß√£o. Em seguida, iteramos por meio de cada uma das sa√≠das de transa√ß√£o e somamos o valor.</p>
</div>
<div id="rpc_block" class="exampleblock data-line-739">
<div class="title">Example 7. Recuperando um bloco e somando todas as sa√≠das de transa√ß√£o</div>
<div class="content">
<div class="listingblock data-line-741">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">Unresolved directive in for_use_mastering-bitcoin_chapter-3_pt_BR.adoc - include::code/rpc_block.py[]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-746">
<p>Executando este c√≥digo, obtemos:</p>
</div>
<div class="listingblock data-line-748">
<div class="content">
<pre>$ python rpc_block.py

('Valor total no bloco: ', Decimal('10322.07722534'))</pre>
</div>
</div>
<div class="paragraph data-line-754">
<p>Nosso c√≥digo de exemplo calcula que o valor total transacionado neste bloco √© 10.322,07722534 BTC (incluindo 25 BTC de recompensa e 0,0909 BTC em taxas). Compare isso com o valor relatado em um site explorador de blocos, procurando pelo hash ou pela altura do bloco. Alguns exploradores de blocos relatam o valor total excluindo a recompensa e as taxas. Veja se voc√™ consegue notar a diferen√ßa.</p>
</div>
<div id="alt_libraries" class="paragraph data-line-757">
<p>=== Clientes, Bibliotecas e Kits de Ferramentas Alternativos</p>
</div>
<div class="paragraph data-line-759">
<p>Existem diversos clientes, bibliotecas, kits de ferramentas e at√© implementa√ß√µes de n√≥ completo alternativos no ecossistema do bitcoin. Eles s√£o implementados em uma variedade de linguagens de programa√ß√£o, oferecendo aos programadores interfaces nativas em sua linguagem preferida.</p>
</div>
<div class="paragraph data-line-761">
<p>As se√ß√µes a seguir listam algumas das melhores bibliotecas, clientes e kits de ferramentas, organizados por linguagens de programa√ß√£o.</p>
</div>
<div class="paragraph data-line-763">
<p>==== C/C
https://github.com/bitcoin/bitcoin[Bitcoin Core]:: A implementa√ß√£o de refer√™ncia do bitcoin
https://github.com/libbitcoin/libbitcoin-system[libbitcoin]:: Kit de ferramentas de desenvolvimento, n√≥ e biblioteca de consenso em C para m√∫ltiplas plataformas
<a href="https://github.com/libbitcoin/libbitcoin-explorer" data-href="https://github.com/libbitcoin/libbitcoin-explorer">bitcoin explorer</a>:: Ferramenta de linha de comando do Libbitcoin
<a href="https://github.com/jgarzik/picocoin" data-href="https://github.com/jgarzik/picocoin">picocoin</a>:: Biblioteca de linguagem C de cliente leve para o bitcoin, feita por Jeff Garzik</p>
</div>
<div class="paragraph data-line-769">
<p>==== JavaScript
<a href="https://bcoin.io/" data-href="https://bcoin.io/">bcoin</a>:: Uma implementa√ß√£o modular e escalon√°vel de n√≥ completo com API
<a href="https://bitcore.io/" data-href="https://bitcore.io/">Bitcore</a>:: N√≥ completo, API e biblioteca do Bitpay
<a href="https://github.com/bitcoinjs/bitcoinjs-lib" data-href="https://github.com/bitcoinjs/bitcoinjs-lib">BitcoinJS</a>:: Uma biblioteca de JavaScript puro para node.js e navegadores</p>
</div>
<div class="paragraph data-line-774">
<p>==== Java
<a href="https://bitcoinj.github.io" class="undefined" data-href="https://bitcoinj.github.io">https://bitcoinj.github.io</a> [bitcoinj]:: Uma biblioteca Java de cliente de n√≥ completo</p>
</div>
<div class="paragraph data-line-777">
<p>==== PHP
<a href="https://github.com/bit-wasp/bitcoin-php" data-href="https://github.com/bit-wasp/bitcoin-php">bitwasp/bitcoin</a>:: Uma biblioteca PHP de bitcoin e projetos relacionados</p>
</div>
<div class="paragraph data-line-780">
<p>==== Python
<a href="https://github.com/petertodd/python-bitcoinlib" data-href="https://github.com/petertodd/python-bitcoinlib">python-bitcoinlib</a>:: Uma biblioteca de bitcoin, uma biblioteca de consenso e um n√≥ em Python, feitos por Peter Todd
<a href="https://github.com/richardkiss/pycoin" data-href="https://github.com/richardkiss/pycoin">pycoin</a>:: Uma biblioteca Python de bitcoin feita por Richard Kiss
<a href="https://github.com/primal100/pybitcointools" data-href="https://github.com/primal100/pybitcointools">pybitcointools</a>:: Um fork arquivado de uma biblioteca Python mantido por Vitalik Buterin</p>
</div>
<div class="paragraph data-line-785">
<p>==== Ruby
<a href="https://github.com/sinisterchipmunk/bitcoin-client" data-href="https://github.com/sinisterchipmunk/bitcoin-client">bitcoin-client</a>:: Um wrapper de biblioteca em Ruby para a API JSON-RPC</p>
</div>
<div class="paragraph data-line-788">
<p>==== Go
<a href="https://github.com/btcsuite/btcd" data-href="https://github.com/btcsuite/btcd">btcd</a>:: A Go language full-node Bitcoin client</p>
</div>
<div class="paragraph data-line-791">
<p>==== Rust
<a href="https://github.com/rust-bitcoin/rust-bitcoin" data-href="https://github.com/rust-bitcoin/rust-bitcoin">rust-bitcoin</a>:: Biblioteca Rust de bitcoin para serializa√ß√£o, an√°lise sint√°tica e chamadas de API</p>
</div>
<div class="paragraph data-line-794">
<p>==== C#
<a href="https://github.com/MetacoSA/NBitcoin" data-href="https://github.com/MetacoSA/NBitcoin">NBitcoin</a>:: Biblioteca de bitcoin abrangente para a framework .NET</p>
</div>
<div class="paragraph data-line-797">
<p>==== Objective-C
<a href="https://github.com/oleganza/CoreBitcoin" data-href="https://github.com/oleganza/CoreBitcoin">CoreBitcoin</a>:: Kit de ferramentas Bitcoin para ObjC e Swift</p>
</div>
<div class="paragraph data-line-800">
<p>Muitas outras bibliotecas existem em v√°rias outras linguagens de programa√ß√£o e novas bibliotecas est√£o constantemente sendo criadas.</p>
</div>
<div id="ch04_keys_addresses" class="paragraph data-line-803">
<p>== Chaves, Endere√ßos</p>
</div>
<div class="paragraph data-line-805">
<p>Voc√™ j√° deve ter ouvido falar que o bitcoin √© baseado em <em>criptografia</em>, um ramo da matem√°tica usado extensivamente na seguran√ßa de computadores. A palavra criptografia significa "escrita secreta" em grego, mas a ci√™ncia da criptografia abrange mais do que apenas a escrita secreta, conhecida como encripta√ß√£o. A criptografia tamb√©m pode ser usada para provar o conhecimento de um segredo sem revelar esse segredo (assinatura digital) ou para provar a autenticidade de dados (impress√£o digital eletr√¥nica). Esses tipos de provas criptogr√°ficas s√£o ferramentas matem√°ticas essenciais para o bitcoin, sendo amplamente utilizadas em aplica√ß√µes de bitcoin. Ironicamente, a encripta√ß√£o n√£o √© uma parte importante do bitcoin, pois suas comunica√ß√µes e dados de transa√ß√£o n√£o s√£o encriptados e n√£o precisam ser encriptados para proteger os fundos. Neste cap√≠tulo, apresentaremos algumas das criptografias usadas no bitcoin para controlar a propriedade de fundos, na forma de chaves, endere√ßos e carteiras.</p>
</div>
<div class="paragraph data-line-807">
<p>=== Introdu√ß√£o</p>
</div>
<div class="paragraph data-line-809">
<p>Ownership of bitcoin is established through <em>digital keys</em>, <em>Bitcoin addresses</em>, and <em>digital signatures</em>. The digital keys are not actually stored in the network, but are instead created and stored by users in a file, or simple database, called a <em>wallet</em>. The digital keys in a user&#8217;s wallet are completely independent of the Bitcoin protocol and can be generated and managed by the user&#8217;s wallet software without reference to the blockchain or access to the internet. Keys enable many of the interesting properties of bitcoin, including decentralized trust and control, ownership attestation, and the cryptographic-proof security model.</p>
</div>
<div class="paragraph data-line-811">
<p>A maioria das transa√ß√µes de bitcoin necessita de uma assinatura digital v√°lida para ser inclu√≠da na <em>blockchain</em> (na cadeia de blocos), que s√≥ pode ser gerada com uma chave secreta; portanto, qualquer um com um c√≥pia dessa chave tem o controle dos bitcoins. A assinatura digital usada para gastar os fundos tamb√©m √© chamada de <em>testemunha</em>, um termo utilizado na criptografia. Os dados de testemunha em uma transa√ß√£o de bitcoin atestam a verdadeira posse dos fundos que est√£o sendo gastos.</p>
</div>
<div class="paragraph data-line-813">
<p> As chaves v√™m em pares que consistem em uma chave privada (secreta) e uma chave p√∫blica. Imagine que a chave p√∫blica √© similar ao n√∫mero de uma conta banc√°ria e que a chave privada √© similar a um PIN secreto ou uma assinatura em um cheque, que fornece controle sobre a conta. Estas chaves digitais s√£o raramente vistas pelos usu√°rios do bitcoin. Para a maioria dos usu√°rios, elas ficam armazenadas dentro do arquivo de carteira e s√£o gerenciadas por um software de carteira de bitcoin.</p>
</div>
<div class="paragraph data-line-815">
<p>In the payment portion of a bitcoin transaction, the recipient&#8217;s public key is represented by its digital fingerprint, called a <em>Bitcoin address</em>, which is used in the same way as the beneficiary name on a check (i.e., "Pay to the order of"). In most cases, a Bitcoin address is generated from and corresponds to a public key. However, not all Bitcoin addresses represent public keys; they can also represent other beneficiaries such as scripts, as we will see later in this chapter. This way, Bitcoin addresses abstract the recipient of funds, making transaction destinations flexible, similar to paper checks: a single payment instrument that can be used to pay into people&#8217;s accounts, pay into company accounts, pay for bills, or pay to cash. The Bitcoin address is the only representation of the keys that users will routinely see, because this is the part they need to share with the world.</p>
</div>
<div class="paragraph data-line-817">
<p>Primeiro, apresentaremos a criptografia e explicaremos a matem√°tica usada no bitcoin. A seguir, veremos como as chaves s√£o geradas, armazenadas e gerenciadas. Analisaremos os v√°rios formatos de codifica√ß√£o usados para representar chaves privadas e p√∫blicas, endere√ßos e endere√ßos de script. Por fim, veremos o uso avan√ßado de chaves e endere√ßos: endere√ßos personalizados, endere√ßos multiassinatura, endere√ßos de script e carteiras de papel.</p>
</div>
<div class="paragraph data-line-819">
<p>==== Criptografia de Chave P√∫blica e Criptomoeda</p>
</div>
<div class="paragraph data-line-821">
<p>A criptografia de chave p√∫blica foi inventada nos anos 1970s e √© uma base matem√°tica fundamental para a seguran√ßa da computa√ß√£o e para a seguran√ßa da informa√ß√£o.</p>
</div>
<div class="paragraph data-line-823">
<p>Desde a inven√ß√£o da criptografia de chave p√∫blica, muitas fun√ß√µes matem√°ticas √∫teis foram descobertas, como a exponencia√ß√£o de n√∫meros primos e a multiplica√ß√£o de curva el√≠ptica. Essas fun√ß√µes matem√°ticas s√£o praticamente irrevers√≠veis, o que significa que elas s√£o f√°ceis de serem calculadas em uma dire√ß√£o e invi√°veis de serem calculadas na dire√ß√£o oposta. Baseando-se nessas fun√ß√µes matem√°ticas, a criptografia permite a cria√ß√£o de segredos digitais e assinaturas digitais que n√£o podem ser falsificadas. O bitcoin usa a multiplica√ß√£o de curva el√≠ptica como a base para sua criptografia.</p>
</div>
<div class="paragraph data-line-825">
<p>No bitcoin, usamos a criptografia de chave p√∫blica para criar um par de chaves que controla o acesso aos bitcoins. O par de chaves consiste em uma chave privada e uma chave p√∫blica √∫nica, que √© derivada da chave privada. A chave p√∫blica √© usada para receber os fundos, e a chave privada √© usada para assinar transa√ß√µes que gastam os fundos.</p>
</div>
<div class="paragraph data-line-827">
<p>Existe uma rela√ß√£o matem√°tica entre as chaves p√∫blica e privada que permite que a chave privada seja usada para gerar assinaturas em mensagens. Essas assinaturas podem ser validadas em rela√ß√£o √† chave p√∫blica, sem a necessidade de se revelar a chave privada.</p>
</div>
<div class="paragraph data-line-829">
<p>When spending bitcoin, the current bitcoin owner presents her public key and a signature (different each time, but created from the same private key) in a transaction to spend those bitcoin. Through the presentation of the public key and signature, everyone in the Bitcoin network can verify and accept the transaction as valid, confirming that the person transferring the bitcoin owned them at the time of the transfer.</p>
</div>
<div class="admonitionblock tip data-line-832">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-833">
<p>Na maioria das implementa√ß√µes de carteira, as chaves privada e p√∫blica s√£o armazenadas juntas, por conveni√™ncia, como um <em>par de chaves</em>. No entanto, a chave p√∫blica pode ser calculada a partir da chave privada, ent√£o tamb√©m √© poss√≠vel se armazenar apenas a chave privada.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="private_public_keys" class="paragraph data-line-837">
<p>==== Chaves Privada e P√∫blica</p>
</div>
<div class="paragraph data-line-839">
<p>A bitcoin wallet contains a collection of key pairs, each consisting of a private key and a public key. The private key (k) is a number, usually picked at random. From the private key, we use elliptic curve multiplication, a one-way cryptographic function, to generate a public key (K). From the public key (K), we use a one-way cryptographic hash function to generate a Bitcoin address (A). In this section, we will start with generating the private key, look at the elliptic curve math that is used to turn that into a public key, and finally, generate a Bitcoin address from the public key. The relationship between private key, public key, and Bitcoin address is shown in <a href="#k_to_K_to_A">Private key, public key, and Bitcoin address</a>.</p>
</div>
<div id="k_to_K_to_A" class="imageblock data-line-843">
<div class="content">
<img src="images/mbc2_0401.png" alt="privk_to_pubK_to_addressA">
</div>
<div class="title">Figure 14. Private key, public key, and Bitcoin address</div>
</div>
</div>
</div>
<div class="paragraph data-line-46">
<p>Por que a criptografia assim√©trica √© usada no bitcoin? Ela n√£o √© usada para "encriptar" (tornar secretas) as transa√ß√µes. Em vez disso, a utilidade da criptografia assim√©trica √© a capacidade de gerar <em>assinaturas digitais</em>. Uma chave privada pode ser aplicada √† impress√£o digital de uma transa√ß√£o para produzir uma assinatura num√©rica. Essa assinatura s√≥ pode ser produzida por algu√©m que saiba a chave privada. No entanto, qualquer pessoa com acesso √† chave p√∫blica e √† impress√£o digital da transa√ß√£o pode us√°-las para <em>verificar</em> a assinatura. Esta propriedade √∫til da criptografia assim√©trica permite que qualquer pessoa possa verificar a assinatura de qualquer transa√ß√£o, enquanto garante que apenas os donos das chaves privadas possam produzir assinaturas v√°lidas.</p>
</div>
<div class="sidebarblock data-line-47">
<div class="content">
<div id="private_keys" class="paragraph data-line-50">
<p>==== Chaves Privadas</p>
</div>
<div class="paragraph data-line-52">
<p>A private key is simply a number, picked at random. Ownership and control over the private key is the root of user control over all funds associated with the corresponding Bitcoin address. The private key is used to create signatures that are required to spend bitcoin by proving ownership of funds used in a transaction. The private key must remain secret at all times, because revealing it to third parties is equivalent to giving them control over the bitcoin secured by that key. The private key must also be backed up and protected from accidental loss, because if it&#8217;s lost it cannot be recovered and the funds secured by it are forever lost, too.</p>
</div>
<div class="admonitionblock tip data-line-55">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-56">
<p>A chave privada do bitcoin √© apenas um n√∫mero. Voc√™ pode escolher suas chaves privadas aleatoriamente usando apenas uma moeda, um l√°pis e um papel: jogue a moeda 256 vezes e voc√™ ter√° os d√≠gitos bin√°rios de uma chave privada aleat√≥ria que voc√™ pode usar em uma carteira de bitcoin. Em seguida, a chave p√∫blica pode ser gerada a partir dessa chave privada.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-59">
<p>===== Gerando uma chave privada a partir de um n√∫mero aleat√≥rio</p>
</div>
<div class="paragraph data-line-61">
<p>O primeiro e mais importante passo na gera√ß√£o de chaves √© encontrar uma fonte segura de entropia, ou aleatoriedade. Criar uma chave de bitcoin √© essencialmente a mesma coisa que pedir para que algu√©m "Escolha um n√∫mero entre 1 e 2<sup>256</sup>". O m√©todo exato que voc√™ usa para escolher esse n√∫mero n√£o importa, contanto que n√£o seja previs√≠vel ou repet√≠vel. O software do bitcoin baseia-se em geradores de n√∫mero aleat√≥rio do sistema operacional para produzir 256 bits de entropia (aleatoriedade). Normalmente, o gerador de n√∫mero aleat√≥rio do sistema operacional √© inicializado por uma fonte humana de aleatoriedade, raz√£o pela qual voc√™ pode ser solicitado a mexer o ponteiro do mouse aleatoriamente por alguns segundos.</p>
</div>
<div class="paragraph data-line-63">
<p>Mais precisamente, a chave privada pode ser qualquer n√∫mero entre 0 e n - 1, onde n √© uma constante (n = 1,158 * 10<sup>77</sup>, ligeiramente menor do que 2<sup>256</sup>) definida como a ordem da curva el√≠ptica usada no bitcoin (ver <a href="#elliptic_curve">[elliptic_curve]</a>). Para criar tal chave, escolhemos aleatoriamente um n√∫mero de 256 bits e verificamos se ele √© menor do que n. Em termos de programa√ß√£o, isto √© geralmente obtido fornecendo-se uma <em>string</em> maior de bits aleat√≥rios, coletados a partir de uma fonte de aleatoriedade criptograficamente segura, ao algoritmo de hash SHA256, o qual produzir√° convenientemente um n√∫mero de 256 bits. Se o resultado for menor do que n, temos uma chave privada satisfat√≥ria. Caso contr√°rio, simplesmente tentamos novamente com outro n√∫mero aleat√≥rio.</p>
</div>
<div class="admonitionblock warning data-line-66">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-67">
<p>N√£o escreva o seu pr√≥prio c√≥digo para criar um n√∫mero aleat√≥rio, nem utilize um gerador de n√∫mero aleat√≥rio "simples" oferecido pela sua linguagem de programa√ß√£o. Use um gerador de n√∫mero pseudo-aleat√≥rio criptograficamente seguro (CSPRNG, na sigla em ingl√™s) com uma semente derivada de uma fonte com entropia suficiente. Estude a documenta√ß√£o da biblioteca geradora de n√∫mero aleat√≥rio que voc√™ escolher para se certificar de que ela √© criptograficamente segura. A correta implementa√ß√£o do CSPRNG √© crucial para a seguran√ßa das chaves.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-70">
<p>Abaixo vemos uma chave privada (k) gerada aleatoriamente, exibida em formato hexadecimal (256 bits exibidos como 64 d√≠gitos hexadecimais, cada um com 4 bits):</p>
</div>
<div class="listingblock data-line-72">
<div class="content">
<pre>1E99423A4ED27608A15A2616A2B0E9E52CED330AC530EDCC32C8FFC6A526AEDD</pre>
</div>
</div>
<div class="admonitionblock tip data-line-78">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-79">
<p>O tamanho do n√∫mero de chaves privadas que podem existir no bitcoin √© t√£o grande (2^256), que chega a ser incompreens√≠vel. Isso √© aproximadamente 10^77 na escala decimal. Para fins comparativos, estima-se que o universo vis√≠vel contenha 10^80 √°tomos.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-82">
<p> Para gerar uma nova chave com o cliente Bitcoin Core (veja <a href="#ch03_bitcoin_client">[ch03_bitcoin_client]</a>), use o comando getnewaddress. Por motivos de seguran√ßa, ele exibe apenas o endere√ßo, e n√£o a chave privada. Para pedir ao bitcoind para expor a chave privada, use o comando dumpprivkey. O comando dumpprivkey mostra a chave privada em um formato codificado por checksum Base58 chamado <em>Wallet Import Format</em> (WIF), que examinaremos com mais detalhes em <a href="#priv_formats">[priv_formats]</a>. Aqui est√° um exemplo de gera√ß√£o e exibi√ß√£o de uma chave privada usando estes dois comandos:</p>
</div>
<div class="listingblock data-line-84">
<div class="content">
<pre>$ bitcoin-cli getnewaddress
1J7mdg5rbQyUHENYdx39WVWK7fsLpEoXZy
$ bitcoin-cli dumpprivkey 1J7mdg5rbQyUHENYdx39WVWK7fsLpEoXZy
KxFC1jmwwCoACiCAWZ3eXa96mBM6tb3TYzGmf6YwgdGWZgawvrtJ</pre>
</div>
</div>
<div class="paragraph data-line-91">
<p>O comando dumpprivkey abre a carteira e extrai a chave privada que foi gerada pelo comando getnewaddress. N√£o √© poss√≠vel para o bitcoind saber a chave privada a partir do endere√ßo, a menos que ambos estejam armazenados na carteira.</p>
</div>
<div class="admonitionblock tip data-line-94">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-95">
<p>O comando dumpprivkey n√£o gera uma chave privada a partir de um endere√ßo, pois isso √© imposs√≠vel. O comando simplesmente revela a chave privada que j√° √© conhecida pela carteira e que foi gerada pelo comando getnewaddress.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph pagebreak-before data-line-99">
<p>Voc√™ tamb√©m pode usar a ferramenta de linha de comando Bitcoin Explorer (ver o <a href="#appdx_bx">[appdx_bx]</a>) para gerar e exibir chaves privadas com os comandos seed, ec-new e ec-to-wif:</p>
</div>
<div class="listingblock data-line-101">
<div class="content">
<pre>$ bx seed | bx ec-new | bx ec-to-wif
5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn</pre>
</div>
</div>
<div id="pubkey" class="paragraph data-line-107">
<p>==== Chaves P√∫blicas</p>
</div>
<div class="paragraph data-line-109">
<p>A chave p√∫blica √© calculada a partir da chave privada usando multiplica√ß√£o de curva el√≠ptica, que √© irrevers√≠vel: <em>K</em> = <em>k</em> * <em>G</em>, onde <em>k</em> √© a chave privada, <em>G</em> √© um ponto constante chamado de <em>ponto gerador</em> e <em>K</em> √© a chave p√∫blica resultante. A opera√ß√£o inversa, tamb√©m conhecida como "encontrar o logaritmo discreto"‚Äîcalcular a chave privada <em>k</em>, se voc√™ conhece a chave p√∫blica <em>K</em>‚Äî√© t√£o dif√≠cil quanto tentar todos os poss√≠veis valores de <em>k</em>, ou seja, √© uma busca de for√ßa bruta. Antes de demonstrarmos como gerar uma chave p√∫blica a partir de uma chave privada, vamos analisar a criptografia de curva el√≠ptica em um pouco mais de detalhes.</p>
</div>
<div class="admonitionblock tip data-line-112">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-113">
<p>A multiplica√ß√£o de curva el√≠ptica √© um tipo de fun√ß√£o que os profissionais de criptografia chamam de fun√ß√£o de "sentido √∫nico": ela √© f√°cil de ser feita em uma dire√ß√£o (multiplica√ß√£o) e imposs√≠vel de ser feita na dire√ß√£o inversa ("divis√£o" ou encontrar o logaritmo discreto). O propriet√°rio da chave privada pode facilmente criar a chave p√∫blica e depois compartilh√°-la com outras pessoas, sabendo que ningu√©m conseguir√° inverter a fun√ß√£o e calcular a chave privada a partir da chave p√∫blica. Esse truque matem√°tico √© a base para as assinaturas digitais infalsific√°veis e seguras que comprovam a posse de fundos no bitcoin.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="elliptic_curve" class="paragraph data-line-117">
<p>==== Explicando a Criptografia de Curva El√≠ptica</p>
</div>
<div class="paragraph data-line-119">
<p>A criptografia de curva el√≠ptica √© um tipo de criptografia assim√©trica ou criptografia de chave p√∫blica baseada em um problema logar√≠tmico discreto que √© expressado por adi√ß√£o e multiplica√ß√£o nos pontos de uma curva el√≠ptica.</p>
</div>
<div class="paragraph data-line-121">
<p>A <a href="#ecc-curve">Uma curva el√≠ptica</a> √© um exemplo de uma curva el√≠ptica, similar √† utilizada pelo bitcoin.</p>
</div>
<div id="ecc-curve" class="imageblock smallerthirty data-line-126">
<div class="content">
<img src="images/mbc2_0402.png" alt="ecc-curve">
</div>
<div class="title">Figure 15. Uma curva el√≠ptica</div>
</div>
<div class="paragraph data-line-128">
<p>O bitcoin usa uma curva el√≠ptica espec√≠fica e um conjunto espec√≠fico de constantes matem√°ticas, conforme definidos em um padr√£o chamado secp256k1, estabelecido pelo Instituto Nacional de Padroniza√ß√£o e Tecnologia (<em>Institute of Standards and Technology</em> ou NIST). A curva secp256k1 √© definida pela seguinte fun√ß√£o, que produz uma curva el√≠ptica:</p>
</div>
<div class="stemblock data-line-131">
<div class="content">
\[\begin{equation}
{y^2 = (x^3 + 7)}~\text{over}~(\mathbb{F}_p)
\end{equation}\]
</div>
</div>
<div class="paragraph data-line-137">
<p>ou</p>
</div>
<div class="stemblock data-line-140">
<div class="content">
\[\begin{equation}
{y^2 \mod p = (x^3 + 7) \mod p}
\end{equation}\]
</div>
</div>
<div class="paragraph data-line-146">
<p>O <em>mod p</em> (m√≥dulo de n√∫mero primo p) indica que essa curva est√° sobre um corpo finito de ordem prima <em>p</em>, tamb√©m escrito como \(\( \mathbb{F}_p \)\), onde p = 2<sup>256</sup> ‚Äì 2<sup>32</sup> ‚Äì 2<sup>9</sup> ‚Äì 2<sup>8</sup> ‚Äì 2<sup>7</sup> ‚Äì 2<sup>6</sup> ‚Äì 2<sup>4</sup> ‚Äì 1, um n√∫mero primo muito grande.</p>
</div>
<div class="paragraph data-line-148">
<p>Como a curva √© definida sobre um corpo finito de ordem prima ao inv√©s de n√∫meros reais, ela parece um padr√£o de pontos espalhados em duas dimens√µes, o que a torna dif√≠cil de ser visualizada. Contudo, a matem√°tica √© id√™ntica √† matem√°tica de uma curva el√≠ptica sobre n√∫meros reais. Como um exemplo, a <a href="#ecc-over-F17-math">Criptografia de curva el√≠ptica: visualizando uma curva el√≠ptica sobre F(p), com p=17</a> mostra a mesma curva el√≠ptica sobre um corpo finito muito menor, de ordem prima 17, mostrando um padr√£o de pontos em uma grade. A curva el√≠ptica secp256k1 do bitcoin pode ser imaginada como um padr√£o muito mais complexo de pontos em uma grade absurdamente grande.</p>
</div>
<div id="ecc-over-F17-math" class="imageblock smallersixty data-line-153">
<div class="content">
<img src="images/mbc2_0403.png" alt="ecc-over-F17-math">
</div>
<div class="title">Figure 16. Criptografia de curva el√≠ptica: visualizando uma curva el√≠ptica sobre F(p), com p=17</div>
</div>
<div class="paragraph data-line-155">
<p>Ent√£o, por exemplo, a seguir est√° um ponto P com coordenadas (x,y) que √© um ponto na curva secp256k1:</p>
</div>
<div class="listingblock data-line-157">
<div class="content">
<pre>P = (55066263022277343669578718895168534326250603453777594175500187360389116729240, 32670510020758816978083085130507043184471273380659243275938904335757337482424)</pre>
</div>
</div>
<div class="paragraph data-line-161">
<p>O <a href="#example_4_1">Usando Python para confirmar que este ponto est√° na curva el√≠ptica</a> mostra como voc√™ pode verificar isso por conta pr√≥pria usando Python:</p>
</div>
<div id="example_4_1" class="exampleblock data-line-165">
<div class="title">Example 8. Usando Python para confirmar que este ponto est√° na curva el√≠ptica</div>
<div class="content">
<div class="listingblock data-line-167">
<div class="content">
<pre class="highlight"><code class="language-pycon" data-lang="pycon">Python 3.4.0 (padr√£o, Mar 30 2014, 19:23:13)
[GCC 4.2.1 Compat√≠vel com Apple LLVM 5.1 (clang-503.0.38)] no darwin
Digite "help", "copyright", "credits" ou "license" para maiores informa√ß√µes.
&gt;&gt;&gt; p = 115792089237316195423570985008687907853269984665640564039457584007908834671663
&gt;&gt;&gt; x = 55066263022277343669578718895168534326250603453777594175500187360389116729240
&gt;&gt;&gt; y = 32670510020758816978083085130507043184471273380659243275938904335757337482424
&gt;&gt;&gt; (x ** 3 + 7 - y**2) % p
0</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-179">
<p>Na matem√°tica de curva el√≠ptica, existe um ponto chamado "ponto no infinito", que de certo modo corresponde ao papel do zero em uma adi√ß√£o. Em computadores, ele √†s vezes √© representado por x = y = 0 (o que n√£o satisfaz a equa√ß√£o da curva el√≠ptica, mas √© um caso isolado f√°cil, que pode ser verificado).</p>
</div>
<div class="paragraph data-line-181">
<p>H√° tamb√©m um operador +, chamado de "adi√ß√£o", que possui algumas propriedades similares √† adi√ß√£o tradicional dos n√∫meros reais que as crian√ßas aprendem no ensino fundamental. Dados dois pontos P<sub>1</sub> e P<sub>2</sub> na curva el√≠ptica, h√° um terceiro ponto P<sub>3</sub>= P<sub>1</sub> + P<sub>2</sub>, tamb√©m na curva el√≠ptica.</p>
</div>
<div class="paragraph data-line-183">
<p>Geometricamente, esse terceiro ponto P<sub>3</sub> √© calculado ao desenhar-se uma linha entre os pontos P<sub>1</sub> e P<sub>2</sub>. Essa linha far√° a intersec√ß√£o com a curva el√≠ptica exatamente em um lugar adicional. Chamaremos esse ponto de P<sub>3</sub>' = (x,y). Em seguida, faz-se uma reflex√£o no eixo x para obter-se o P<sub>3</sub> = (x, -y).</p>
</div>
<div class="paragraph data-line-185">
<p>Existem alguns casos especiais que explicam a necessidade de se ter um "ponto no infinito."</p>
</div>
<div class="paragraph data-line-187">
<p>Se P<sub>1</sub> e P<sub>2</sub> s√£o o mesmo ponto, a linha "entre" P<sub>1</sub> e P<sub>2</sub> deveria estender para ser a tangente na curva no ponto P<sub>1</sub>. Essa tangente far√° a intersec√ß√£o com a curva em um novo ponto exato. Voc√™ pode usar t√©cnicas de c√°lculo para determinar a inclina√ß√£o da linha tangente. Essas t√©cnicas curiosamente funcionam, mesmo que agora estejamos restringindo nosso interesse para pontos na curva com duas coordenadas de n√∫meros inteiros!</p>
</div>
<div class="paragraph data-line-189">
<p>Em alguns casos (por exemplo, se P<sub>1</sub> e P<sub>2</sub> t√™m os mesmos valores x, mas diferentes valores y), a linha entre P<sub>1</sub> e P<sub>2</sub> ser√° exatamente vertical, o que, neste caso, significa que P<sub>3</sub> = "ponto no infinito".</p>
</div>
<div class="paragraph data-line-191">
<p>Se P<sub>1</sub> √© o "ponto no infinito", ent√£o P<sub>1</sub> + P<sub>2</sub> = P<sub>2</sub>. De modo similar, se P<sub>2</sub> √© o ponto no infinito, ent√£o P<sub>1</sub> + P<sub>2</sub> = P<sub>1</sub>. Isso mostra como o ponto no infinito faz o papel do zero.</p>
</div>
<div class="paragraph data-line-193">
<p>Al√©m disso, o operador + √© associativo, o que significa que (A + B) + C = A + (B + C). Portanto, podemos escrever A + B + C sem par√™nteses e sem ambiguidade.</p>
</div>
<div class="paragraph data-line-195">
<p>Agora que definimos a adi√ß√£o, podemos definir a multiplica√ß√£o no modo padr√£o que estende a adi√ß√£o. Para um ponto P na curva el√≠ptica, se k √© um n√∫mero inteiro, ent√£o kP = P + P + P + &#8230;&#8203; + P (k vezes). Note que o k √†s vezes √© confundido como um "expoente" nesse caso.</p>
</div>
<div id="public_key_derivation" class="paragraph data-line-198">
<p>==== Gerando uma Chave P√∫blica</p>
</div>
<div class="paragraph data-line-200">
<p>Come√ßando com uma chave privada na forma de um n√∫mero <em>k</em> gerado aleatoriamente, o multiplicamos por um ponto predeterminado na curva, chamado de <em>ponto gerador</em> <em>G</em>, para produzir outro ponto em outro lugar na curva, que ser√° a chave p√∫blica <em>K</em> correspondente. O ponto gerador √© especificado como parte do padr√£o secp256k1 e √© sempre o mesmo para todas as chaves no bitcoin:</p>
</div>
<div class="stemblock data-line-203">
<div class="content">
\[\begin{equation}
{K = k * G}
\end{equation}\]
</div>
</div>
<div class="paragraph data-line-209">
<p>where <em>k</em> is the private key, <em>G</em> is the generator point, and <em>K</em> is the resulting public key, a point on the curve. Because the generator point is always the same for all bitcoin users, a private key <em>k</em> multiplied with <em>G</em> will always result in the same public key <em>K</em>. The relationship between <em>k</em> and <em>K</em> is fixed, but can only be calculated in one direction, from <em>k</em> to <em>K</em>. That&#8217;s why a Bitcoin address (derived from <em>K</em>) can be shared with anyone and does not reveal the user&#8217;s private key (<em>k</em>).</p>
</div>
<div class="admonitionblock tip data-line-212">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-213">
<p>Uma chave privada pode ser convertida em uma chave p√∫blica, mas uma chave p√∫blica n√£o pode ser convertida de volta em uma chave privada, pois a matem√°tica s√≥ funciona em um √∫nico sentido.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-216">
<p>Implementando a multiplica√ß√£o de curva el√≠ptica, podemos usar a chave privada <em>k</em> que foi gerada anteriormente e multiplic√°-la pelo ponto gerador G para encontrarmos a chave p√∫blica <em>K</em>:</p>
</div>
<div class="listingblock data-line-218">
<div class="content">
<pre>K = 1E99423A4ED27608A15A2616A2B0E9E52CED330AC530EDCC32C8FFC6A526AEDD * G</pre>
</div>
</div>
<div class="paragraph data-line-222">
<p>A chave p√∫blica <em>K</em> √© definida como um ponto K = (x,y):</p>
</div>
<div class="listingblock data-line-224">
<div class="content">
<pre>K = (x, y)

onde,

x = F028892BAD7ED57D2FB57BF33081D5CFCF6F9ED3D3D7F159C2E2FFF579DC341A
y = 07CF33DA18BD734C600B96A72BBC4749D5141C90EC8AC328AE52DDFE2E505BDB</pre>
</div>
</div>
<div class="paragraph data-line-233">
<p>Para visualizar a multiplica√ß√£o de um ponto por um n√∫mero inteiro, usaremos uma curva el√≠ptica mais simples sobre n√∫meros reais&#x2014;lembre-se, a matem√°tica √© a mesma. Nosso objetivo √© encontrar o m√∫ltiplo <em>kG</em> de um ponto gerador <em>G</em>. Isso √© o mesmo que adicionar <em>G</em> a si mesmo, <em>k</em> vezes seguidas. Nas curvas el√≠pticas, adicionar um ponto a si mesmo √© o equivalente a desenhar uma linha tangente no ponto, encontrar onde ela intersecciona novamente a curva, e, em seguida, refletir o ponto no eixo x.</p>
</div>
<div class="paragraph data-line-235">
<p>A <a href="#ecc_illustrated">Criptografia de curva el√≠ptica: visualizando a multiplica√ß√£o de um ponto G por um n√∫mero inteiro k em uma curva el√≠ptica</a> mostra o processo usado para se derivar <em>G</em>, <em>2G</em>, <em>4G</em> e <em>8G</em> como uma opera√ß√£o geom√©trica na curva.</p>
</div>
<div class="admonitionblock tip data-line-238">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-239">
<p>O bitcoin usa a <a href="https://github.com/bitcoin-core/secp256k1" data-href="https://github.com/bitcoin-core/secp256k1">biblioteca C otimizada do secp256k1</a> para fazer a matem√°tica de curva el√≠ptica.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="ecc_illustrated" class="imageblock data-line-244">
<div class="content">
<img src="images/mbc2_0404.png" alt="ecc_illustrated">
</div>
<div class="title">Figure 17. Criptografia de curva el√≠ptica: visualizando a multiplica√ß√£o de um ponto G por um n√∫mero inteiro k em uma curva el√≠ptica</div>
</div>
<div class="paragraph data-line-246">
<p>=== Endere√ßos de Bitcoin</p>
</div>
<div class="paragraph data-line-248">
<p>A Bitcoin address is a string of digits and characters that can be shared with anyone who wants to send you money. Addresses produced from public keys consist of a string of numbers and letters, beginning with the digit "1". Here&#8217;s an example of a Bitcoin address:</p>
</div>
<div class="listingblock data-line-250">
<div class="content">
<pre>1J7mdg5rbQyUHENYdx39WVWK7fsLpEoXZy</pre>
</div>
</div>
<div class="paragraph data-line-255">
<p>The Bitcoin address is what appears most commonly in a transaction as the "recipient" of the funds. If we compare a bitcoin transaction to a paper check, the Bitcoin address is the beneficiary, which is what we write on the line after "Pay to the order of." On a paper check, that beneficiary can sometimes be the name of a bank account holder, but can also include corporations, institutions, or even cash. Because paper checks do not need to specify an account, but rather use an abstract name as the recipient of funds, they are very flexible payment instruments. Bitcoin transactions use a similar abstraction, the Bitcoin address, to make them very flexible. A Bitcoin address can represent the owner of a private/public key pair, or it can represent something else, such as a payment script, as we will see in <a href="#p2sh">[p2sh]</a>. For now, let&#8217;s examine the simple case, a Bitcoin address that represents, and is derived from, a public key.</p>
</div>
<div class="paragraph data-line-257">
<p>The Bitcoin address is derived from the public key through the use of one-way cryptographic hashing. A "hashing algorithm" or simply "hash algorithm" is a one-way function that produces a fingerprint or "hash" of an arbitrary-sized input. Cryptographic hash functions are used extensively in bitcoin: in Bitcoin addresses, in script addresses, and in the mining Proof-of-Work algorithm. The algorithms used to make a Bitcoin address from a public key are the Secure Hash Algorithm (SHA) and the RACE Integrity Primitives Evaluation Message Digest (RIPEMD), specifically SHA256 and RIPEMD160.</p>
</div>
<div class="paragraph data-line-259">
<p>Iniciando com a chave p√∫blica <em>K</em>, computamos o hash SHA256, e depois computamos o hash RIPEMD160 do resultado, produzindo um n√∫mero de 160 bits (20 bytes):</p>
</div>
<div class="stemblock data-line-262">
<div class="content">
\[\begin{equation}
{A = RIPEMD160(SHA256(K))}
\end{equation}\]
</div>
</div>
<div class="paragraph data-line-268">
<p>where <em>K</em> is the public key and <em>A</em> is the resulting Bitcoin address.</p>
</div>
<div class="admonitionblock tip data-line-272">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-273">
<p>A Bitcoin address is <em>not</em> the same as a public key. Bitcoin addresses are derived from a public key using a one-way function.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-276">
<p>Bitcoin addresses are almost always encoded as "Base58Check" (see <a href="#base58">[base58]</a>), which uses 58 characters (a Base58 number system) and a checksum to help human readability, avoid ambiguity, and protect against errors in address transcription and entry. Base58Check is also used in many other ways in bitcoin, whenever there is a need for a user to read and correctly transcribe a number, such as a Bitcoin address, a private key, an encrypted key, or a script hash. In the next section we will examine the mechanics of Base58Check encoding and decoding and the resulting representations. <a href="#pubkey_to_address">Public key to Bitcoin address: conversion of a public key into a Bitcoin address</a> illustrates the conversion of a public key into a Bitcoin address.</p>
</div>
<div id="pubkey_to_address" class="imageblock data-line-280">
<div class="content">
<img src="images/mbc2_0405.png" alt="pubkey_to_address">
</div>
<div class="title">Figure 18. Public key to Bitcoin address: conversion of a public key into a Bitcoin address</div>
</div>
<div id="base58" class="paragraph data-line-283">
<p>==== Codifica√ß√£o Base58 e Base58Check</p>
</div>
<div class="paragraph data-line-285">
<p>In order to represent long numbers in a compact way, using fewer symbols, many computer systems use mixed-alphanumeric representations with a base (or radix) higher than 10. For example, whereas the traditional decimal system uses the 10 numerals 0 through 9, the hexadecimal system uses 16, with the letters A through F as the six additional symbols. A number represented in hexadecimal format is shorter than the equivalent decimal representation. Even more compact, Base64 representation uses 26 lowercase letters, 26 capital letters, 10 numerals, and 2 more characters such as &#x201c;``&amp;#x201d; and "/" to transmit binary data over text-based media such as email. Base64 is most commonly used to add binary attachments to email. Base58 is a text-based binary-encoding format developed for use in bitcoin and used in many other cryptocurrencies. It offers a balance between compact representation, readability, and error detection and prevention. Base58 is a subset of Base64, using upper- and lowercase letters and numbers, but omitting some characters that are frequently mistaken for one another and can appear identical when displayed in certain fonts. Specifically, Base58 is Base64 without the 0 (number zero), O (capital o), l (lower L), I (capital i), and the symbols &amp;#x201c;``&#x201d; and "/". Or, more simply, it is a set of lowercase and capital letters and numbers without the four (0, O, l, I) just mentioned. <a href="#base58alphabet">Alfabeto Base58 do Bitcoin</a> shows the full Base58 alphabet.</p>
</div>
<div id="base58alphabet" class="exampleblock data-line-289">
<div class="title">Example 9. Alfabeto Base58 do Bitcoin</div>
<div class="content">
<div class="listingblock data-line-290">
<div class="content">
<pre>123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz</pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-296">
<p>To add extra security against typos or transcription errors, Base58Check is a Base58 encoding format, frequently used in bitcoin, which has a built-in error-checking code. The checksum is an additional four bytes added to the end of the data that is being encoded. The checksum is derived from the hash of the encoded data and can therefore be used to detect and prevent transcription and typing errors. When presented with Base58Check code, the decoding software will calculate the checksum of the data and compare it to the checksum included in the code. If the two do not match, an error has been introduced and the Base58Check data is invalid. This prevents a mistyped Bitcoin address from being accepted by the wallet software as a valid destination, an error that would otherwise result in loss of funds.</p>
</div>
<div class="paragraph data-line-298">
<p>To convert data (a number) into a Base58Check format, we first add a prefix to the data, called the "version byte," which serves to easily identify the type of data that is encoded. For example, in the case of a Bitcoin address the prefix is zero (0x00 in hex), whereas the prefix used when encoding a private key is 128 (0x80 in hex). A list of common version prefixes is shown in <a href="#base58check_versions">Prefixos de vers√£o da Base58Check e exemplos de resultados codificados</a>.</p>
</div>
<div class="paragraph data-line-300">
<p>A seguir, computamos o <em>checksum</em> do "duplo-SHA", o que significa que aplicamos o algoritmo de hash SHA256 duas vezes no resultado anterior (prefixo e dados):</p>
</div>
<div class="listingblock data-line-302">
<div class="content">
<pre>checksum = SHA256(SHA256(prefixo+dados))</pre>
</div>
</div>
<div class="paragraph data-line-306">
<p>Pegamos apenas os primeiros quatro bytes do hash de 32 bytes resultante (hash do hash). Esses quatro bytes iniciais servem como c√≥digo de verifica√ß√£o de erro, ou <em>checksum</em>. O <em>checksum</em> √© concatenado (acrescentado) ao final.</p>
</div>
<div class="paragraph data-line-308">
<p>O resultado √© composto de tr√™s itens: um prefixo, os dados e um <em>checksum</em>. Esse resultado √© codificado usando o alfabeto Base58 descrito previamente. A <a href="#base58check_encoding">Codifica√ß√£o em Base58Check: um formato para codificar dados do bitcoin de maneira inequ√≠voca, versionada e verificada.</a> ilustra o processo de codifica√ß√£o em Base58Check.</p>
</div>
<div id="base58check_encoding" class="imageblock data-line-312">
<div class="content">
<img src="images/mbc2_0406.png" alt="Base58CheckEncoding">
</div>
<div class="title">Figure 19. Codifica√ß√£o em Base58Check: um formato para codificar dados do bitcoin de maneira inequ√≠voca, versionada e verificada.</div>
</div>
<div class="paragraph data-line-314">
<p>In bitcoin, most of the data presented to the user is Base58Check-encoded to make it compact, easy to read, and easy to detect errors. The version prefix in Base58Check encoding is used to create easily distinguishable formats, which when encoded in Base58 contain specific characters at the beginning of the Base58Check-encoded payload. These characters make it easy for humans to identify the type of data that is encoded and how to use it. This is what differentiates, for example, a Base58Check-encoded Bitcoin address that starts with a 1 from a Base58Check-encoded private key WIF that starts with a 5. Some example version prefixes and the resulting Base58 characters are shown in <a href="#base58check_versions">Prefixos de vers√£o da Base58Check e exemplos de resultados codificados</a>.</p>
</div>
<table id="base58check_versions" class="tableblock frame-all grid-all stretch data-line-319">
<caption class="title">Table 1. Prefixos de vers√£o da Base58Check e exemplos de resultados codificados</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tipo</th>
<th class="tableblock halign-left valign-top">Prefixo de vers√£o (hex)</th>
<th class="tableblock halign-left valign-top">Prefixo em Base58 (resultado)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endere√ßo de Bitcoin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endere√ßo Pay-to-Script-Hash</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x05</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endere√ßo da Testnet do Bitcoin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x6F</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">m ou n</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Chave Privada WIF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5, K ou L</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Chave Privada Criptografada da BIP-38</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0142</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6P</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Chave P√∫blica Estendida da BIP-32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0488B21E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xpub</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-329">
<p>==== Formatos de Chave</p>
</div>
<div class="paragraph data-line-331">
<p>Both private and public keys can be represented in a number of different formats. These representations all encode the same number, even though they look different. These formats are primarily used to make it easy for people to read and transcribe keys without introducing errors.</p>
</div>
<div id="priv_formats" class="paragraph data-line-334">
<p>===== Formatos de chave privada</p>
</div>
<div class="paragraph data-line-336">
<p>A chave privada pode ser representada em v√°rios formatos diferentes, todos correspondendo ao mesmo n√∫mero de 256 bits. A <a href="#table_4-2">Representa√ß√µes de chave privada (formatos de codifica√ß√£o)</a> mostra tr√™s formatos comumente usados para representar chaves privadas. Diferentes formatos s√£o usados em diferentes circunst√¢ncias. Os formatos hexadecimal e bin√°rio bruto s√£o usados internamente no software e raramente s√£o exibidos aos usu√°rios. O formato WIF √© usado para importar/exportar chaves entre carteiras e √© frequentemente usado em representa√ß√µes de chaves privadas em c√≥digo QR (c√≥digo de barras).</p>
</div>
<table id="table_4-2" class="tableblock frame-all grid-all stretch data-line-341">
<caption class="title">Table 2. Representa√ß√µes de chave privada (formatos de codifica√ß√£o)</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tipo</th>
<th class="tableblock halign-left valign-top">Prefixo</th>
<th class="tableblock halign-left valign-top">Descri√ß√£o</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bruto (<em>raw</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nenhum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nenhum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 d√≠gitos hexadecimais</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WIF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Codifica√ß√£o em Base58Check: Base58 com prefixo de vers√£o 0x80 e <em>checksum</em> de 4 bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WIF-comprimida</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">K ou L</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Como acima, com a adi√ß√£o do sufixo 0x01 antes da codifica√ß√£o</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-349">
<p>A <a href="#table_4-3">Exemplo: A mesma chave, em diferentes formatos de codifica√ß√£o</a> demonstra a chave privada gerada nesses tr√™s formatos de codifica√ß√£o.</p>
</div>
<table id="table_4-3" class="tableblock frame-all grid-all stretch data-line-354">
<caption class="title">Table 3. Exemplo: A mesma chave, em diferentes formatos de codifica√ß√£o</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Formato</th>
<th class="tableblock halign-left valign-top">Chave privada</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WIF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WIF-comprimida</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KxFC1jmwwCoACiCAWZ3eXa96mBM6tb3TYzGmf6YwgdGWZgawvrtJ</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-361">
<p>Todas essas representa√ß√µes s√£o diferentes maneiras de se exibir o mesmo n√∫mero, a mesma chave privada. Elas aparentam ser diferentes, mas qualquer um desses formatos pode ser facilmente convertido para qualquer outro formato. Observe que o "bin√°rio bruto" n√£o √© mostrado na <a href="#table_4-3">Exemplo: A mesma chave, em diferentes formatos de codifica√ß√£o</a>, pois qualquer codifica√ß√£o para exibi√ß√£o aqui n√£o seria considerada, por defini√ß√£o, um dado bin√°rio bruto.</p>
</div>
<div class="paragraph data-line-363">
<p>Usamos o comando wif-to-ec do Bitcoin Explorer (ver o <a href="#appdx_bx">[appdx_bx]</a>) para demonstrar que ambas as chaves WIF representam a mesma chave privada:</p>
</div>
<div class="listingblock data-line-365">
<div class="content">
<pre>$ bx wif-to-ec 5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn
1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd

$ bx wif-to-ec KxFC1jmwwCoACiCAWZ3eXa96mBM6tb3TYzGmf6YwgdGWZgawvrtJ
1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd</pre>
</div>
</div>
<div class="paragraph data-line-373">
<p>===== Decodificando do Base58Check</p>
</div>
<div class="paragraph data-line-375">
<p>Os comandos do Bitcoin Explorer (ver o <a href="#appdx_bx">[appdx_bx]</a>) tornam f√°cil a escrita de scripts em shell e <em>pipes</em> de linha de comando que manipulam chaves, endere√ßos e transa√ß√µes de bitcoin. Voc√™ pode usar o Bitcoin Explorer para decodificar o formato Base58Check na linha de comando.</p>
</div>
<div class="paragraph data-line-377">
<p>Usamos o comando base58check-decode para decodificar a chave n√£o comprimida:</p>
</div>
<div class="listingblock data-line-379">
<div class="content">
<pre>$ bx base58check-decode 5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn
wrapper
{
    checksum 4286807748
    payload 1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd
    version 128
}</pre>
</div>
</div>
<div class="paragraph data-line-389">
<p>O resultado cont√©m a chave como corpo de dados (<em>payload</em>), o prefixo de vers√£o 128 da WIF e um <em>checksum</em>.</p>
</div>
<div class="paragraph data-line-391">
<p>Note que o corpo de dados (<em>payload</em>) da chave privada comprimida √© acrescido com o sufixo 01, sinalizando que a chave p√∫blica derivada deve ser comprimida:</p>
</div>
<div class="listingblock data-line-393">
<div class="content">
<pre>$ bx base58check-decode KxFC1jmwwCoACiCAWZ3eXa96mBM6tb3TYzGmf6YwgdGWZgawvrtJ
wrapper
{
    checksum 2339607926
    payload 1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd01
    version 128
}</pre>
</div>
</div>
<div class="paragraph data-line-403">
<p>====== Codificando de hex para Base58Check</p>
</div>
<div class="paragraph data-line-405">
<p>Para codificar em Base58Check (o oposto do comando anterior), usamos o comando base58check-encode do Bitcoin Explorer (ver <a href="#appdx_bx">[appdx_bx]</a>) e fornecemos a chave privada em hexadecimal, seguida pelo prefixo de vers√£o 128 do WIF:</p>
</div>
<div class="listingblock data-line-407">
<div class="content">
<pre>bx base58check-encode 1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd --version 128
5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn</pre>
</div>
</div>
<div class="paragraph data-line-412">
<p>===== Codificando de hex (chave comprimida) para Base58Check</p>
</div>
<div class="paragraph data-line-414">
<p>Para codificar em Base58Check como uma chave privada "comprimida" (ver <a href="#comp_priv">[comp_priv]</a>), concatenamos o sufixo 01 √† chave hexadecimal e em seguida codificamos conforme descrito na se√ß√£o anterior:</p>
</div>
<div class="listingblock data-line-416">
<div class="content">
<pre>$ bx base58check-encode 1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd01 --version 128
KxFC1jmwwCoACiCAWZ3eXa96mBM6tb3TYzGmf6YwgdGWZgawvrtJ</pre>
</div>
</div>
<div class="paragraph data-line-421">
<p>O formato WIF-comprimida resultante come√ßa com um "K". Isso denota que a chave privada contida tem um sufixo "01" e ser√° usada para produzir apenas chaves p√∫blicas comprimidas (ver <a href="#comp_pub">[comp_pub]</a>).</p>
</div>
<div class="paragraph data-line-423">
<p>===== Formatos de chave p√∫blica</p>
</div>
<div class="paragraph data-line-425">
<p>As chaves p√∫blicas tamb√©m s√£o apresentadas de diferentes maneiras, geralmente como chaves p√∫blicas <em>comprimidas</em> ou <em>n√£o comprimidas</em>.</p>
</div>
<div class="paragraph data-line-427">
<p>Conforme vimos anteriormente, a chave p√∫blica √© um ponto na curva el√≠ptica que consiste em um par de coordenadas (x,y). Ela geralmente √© apresentada com o prefixo 04 seguido por dois n√∫meros de 256 bits, um para a coordenada <em>x</em> do ponto, e o outro para a coordenada <em>y</em>. O prefixo 04 √© usado para distinguir as chaves p√∫blicas n√£o comprimidas das chaves p√∫blicas comprimidas que come√ßam com 02 ou 03.</p>
</div>
<div class="paragraph data-line-429">
<p>Aqui est√° a chave p√∫blica gerada pela chave privada que criamos anteriormente, mostrada como as coordenadas x e y:</p>
</div>
<div class="listingblock data-line-431">
<div class="content">
<pre>x = F028892BAD7ED57D2FB57BF33081D5CFCF6F9ED3D3D7F159C2E2FFF579DC341A
y = 07CF33DA18BD734C600B96A72BBC4749D5141C90EC8AC328AE52DDFE2E505BDB</pre>
</div>
</div>
<div class="paragraph data-line-436">
<p>Aqui est√° a mesma chave p√∫blica mostrada como um n√∫mero de 520 bits (130 d√≠gitos hexadecimais) com o prefixo 04 seguido pelas coordenadas x e y, como 04 x y:</p>
</div>
<pre data-type="programlisting">
K = 04F028892BAD7ED57D2FB57BF33081D5CFCF6F9ED3D3D7F159C2E2FFF579DC341A&#x21b5;
07CF33DA18BD734C600B96A72BBC4749D5141C90EC8AC328AE52DDFE2E505BDB
</pre>
<div id="comp_pub" class="paragraph data-line-446">
<p>===== Chaves p√∫blicas comprimidas</p>
</div>
<div class="paragraph data-line-448">
<p>Compressed public keys were introduced to bitcoin to reduce the size of transactions and conserve disk space on nodes that store the Bitcoin blockchain database. Most transactions include the public key, which is required to validate the owner&#8217;s credentials and spend the bitcoin. Each public key requires 520 bits (prefix + x + y), which when multiplied by several hundred transactions per block, or tens of thousands of transactions per day, adds a significant amount of data to the blockchain.</p>
</div>
<div class="paragraph data-line-450">
<p>Conforme vimos na se√ß√£o <a href="#pubkey">[pubkey]</a>, uma chave p√∫blica √© um ponto (x,y) em uma curva el√≠ptica. Como a curva expressa uma fun√ß√£o matem√°tica, um ponto na curva representa uma solu√ß√£o para a equa√ß√£o e, portanto, se soubermos a coordenada <em>x</em>, podemos calcular a coordenada <em>y</em> ao resolver a equa√ß√£o y<sup>2</sup> mod p = (x<sup>3</sup> + 7) mod p. Isso nos permite armazenar somente a coordenada <em>x</em> do ponto da chave p√∫blica, omitindo a coordenada <em>y</em> e reduzindo o tamanho da chave e o espa√ßo necess√°rio para armazen√°-la em 256 bits. Uma redu√ß√£o de quase 50% no tamanho de cada transa√ß√£o economiza a utiliza√ß√£o de muito espa√ßo ao longo do tempo!</p>
</div>
<div class="paragraph data-line-452">
<p>Enquanto as chaves p√∫blicas n√£o comprimidas tem o prefixo 04, as chaves p√∫blicas comprimidas come√ßam com os prefixos 02 ou 03. Existe um motivo pelo qual s√≥ existem dois prefixos poss√≠veis: como o lado esquerdo da equa√ß√£o √© <em>y</em><sup>2</sup>, a solu√ß√£o para <em>y</em> √© uma raiz quadrada, que pode ter um valor positivo ou negativo. Visualmente, isso significa que a coordenada <em>y</em> resultante pode estar acima ou abaixo do eixo x. Como voc√™ pode ver no gr√°fico da curva el√≠ptica na <a href="#ecc-curve">Uma curva el√≠ptica</a>, a curva √© sim√©trica, sendo refletida pelo eixo x, como se fosse um espelho. Ent√£o, embora podemos omitir a coordenada <em>y</em>, temos que armazenar o <em>sinal</em> do <em>y</em> (positivo ou negativo); ou, em outras palavras, temos que nos lembrar se ela estava acima ou abaixo do eixo x, pois cada uma dessas op√ß√µes representa um ponto diferente e uma chave p√∫blica diferente. Quando se calcula a curva el√≠ptica em aritm√©tica bin√°ria no corpo finito de ordem prima p, a coordenada <em>y</em> ou √© par ou √© √≠mpar, o que corresponde ao sinal positivo/negativo como explicado anteriormente. Portanto, para distinguir entre os dois valores poss√≠veis de <em>y</em>, armazenamos a chave p√∫blica comprimida com o prefixo 02 se o <em>y</em> for par, e 03 se ele for √≠mpar, permitindo que o software deduza corretamente a coordenada <em>y</em> a partir da coordenada <em>x</em> e descomprima a chave p√∫blica para as coordenadas completas do ponto. A compress√£o de chave p√∫blica √© ilustrada na <a href="#pubkey_compression">Compress√£o de chave p√∫blica</a>.</p>
</div>
<div class="paragraph data-line-454">
<p>Aqui est√° a mesma chave p√∫blica gerada anteriormente, exibida como uma chave p√∫blica comprimida armazenada em 264 bits (66 d√≠gitos hexadecimais) com o prefixo 03 indicando que a coordenada <em>y</em> √© √≠mpar:</p>
</div>
<div class="listingblock data-line-456">
<div class="content">
<pre>K = 03F028892BAD7ED57D2FB57BF33081D5CFCF6F9ED3D3D7F159C2E2FFF579DC341A</pre>
</div>
</div>
<div class="paragraph data-line-460">
<p>This compressed public key corresponds to the same private key, meaning it is generated from the same private key. However, it looks different from the uncompressed public key. More importantly, if we convert this compressed public key to a Bitcoin address using the double-hash function (RIPEMD160(SHA256(K))) it will produce a <em>different</em> Bitcoin address. This can be confusing, because it means that a single private key can produce a public key expressed in two different formats (compressed and uncompressed) that produce two different Bitcoin addresses. However, the private key is identical for both Bitcoin addresses.</p>
</div>
<div id="pubkey_compression" class="imageblock smallerseventy data-line-465">
<div class="content">
<img src="images/mbc2_0407.png" alt="pubkey_compression">
</div>
<div class="title">Figure 20. Compress√£o de chave p√∫blica</div>
</div>
<div class="paragraph data-line-467">
<p>Compressed public keys are gradually becoming the default across Bitcoin clients, which is having a significant impact on reducing the size of transactions and therefore the blockchain. However, not all clients support compressed public keys yet. Newer clients that support compressed public keys have to account for transactions from older clients that do not support compressed public keys. This is especially important when a wallet application is importing private keys from another bitcoin wallet application, because the new wallet needs to scan the blockchain to find transactions corresponding to these imported keys. Which Bitcoin addresses should the bitcoin wallet scan for? The Bitcoin addresses produced by uncompressed public keys, or the Bitcoin addresses produced by compressed public keys? Both are valid Bitcoin addresses, and can be signed for by the private key, but they are different addresses!</p>
</div>
<div class="paragraph data-line-469">
<p>To resolve this issue, when private keys are exported from a wallet, the WIF that is used to represent them is implemented differently in newer bitcoin wallets, to indicate that these private keys have been used to produce <em>compressed</em> public keys and therefore <em>compressed</em> Bitcoin addresses. This allows the importing wallet to distinguish between private keys originating from older or newer wallets and search the blockchain for transactions with Bitcoin addresses corresponding to the uncompressed, or the compressed, public keys, respectively. Let&#8217;s look at how this works in more detail, in the next section.</p>
</div>
<div id="comp_priv" class="paragraph data-line-472">
<p>===== Chaves privadas comprimidas</p>
</div>
<div class="paragraph data-line-474">
<p>Ironicamente, o termo "chave privada comprimida" n√£o √© um nome muito preciso, pois quando uma chave privada √© exportada como WIF-comprimida, ela √© na verdade um byte <em>maior</em> do que uma chave privada "n√£o comprimida". Isso acontece porque a chave privada tem um sufixo adicional de um byte (mostrado como 01 no hexadecimal na <a href="#table_4-4">Exemplo: A mesma chave, em diferentes formatos de codifica√ß√£o</a>), o que significa que a chave privada √© de uma carteira moderna e s√≥ deve ser usada para produzir chaves p√∫blicas comprimidas. As chaves privadas em si n√£o s√£o comprimidas e n√£o h√° como comprimi-las. O que o termo "chave privada comprimida" realmente significa √© "chave privada a partir da qual somente chaves p√∫blicas comprimidas devem ser derivadas", enquanto o que o termo "chave privada n√£o comprimida" realmente significa √© "chave privada a partir da qual somente chaves p√∫blicas n√£o comprimidas devem ser derivadas". √â recomendado que voc√™ se refira ao formato de exporta√ß√£o apenas como "WIF-comprimida" ou "WIF" e, para evitar maiores confus√µes, que voc√™ evite se referir √† chave privada em si como "comprimida".</p>
</div>
<div class="paragraph data-line-476">
<p>A <a href="#table_4-4">Exemplo: A mesma chave, em diferentes formatos de codifica√ß√£o</a> mostra a mesma chave, codificada nos formatos WIF e WIF-comprimida.</p>
</div>
<table id="table_4-4" class="tableblock frame-all grid-all stretch data-line-481">
<caption class="title">Table 4. Exemplo: A mesma chave, em diferentes formatos de codifica√ß√£o</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Formato</th>
<th class="tableblock halign-left valign-top">Chave privada</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1E99423A4ED27608A15A2616A2B0E9E52CED330AC530EDCC32C8FFC6A526AEDD</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WIF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hex-comprimida</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1E99423A4ED27608A15A2616A2B0E9E52CED330AC530EDCC32C8FFC6A526AEDD01</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WIF-comprimida</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KxFC1jmwwCoACiCAWZ3eXa96mBM6tb3TYzGmf6YwgdGWZgawvrtJ</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-489">
<p>Observe que a chave privada hex-comprimida tem um byte extra no final (01 em hexadecimal). Embora o prefixo de vers√£o da Base58Check seja o mesmo (0x80) para os formatos WIF e WIF-comprimida, a adi√ß√£o de um byte no final do n√∫mero faz com que o primeiro caractere da codifica√ß√£o Base58 mude de 5 para <em>K</em> ou <em>L</em>. Pense nisso como sendo o equivalente Base58 da diferen√ßa de codifica√ß√£o decimal entre o n√∫mero 100 e o n√∫mero 99. Embora 100 seja um d√≠gito mais longo que 99, ele tamb√©m tem um prefixo 1 ao inv√©s de um prefixo 9. √Ä medida que o comprimento muda, isso afeta o prefixo. Na Base58, o prefixo 5 muda para <em>K</em> ou <em>L</em> conforme o comprimento do n√∫mero aumenta em um byte.</p>
</div>
<div class="paragraph data-line-491">
<p>Lembre-se de que esses formatos <em>n√£o s√£o</em> intercambi√°veis. Em uma carteira moderna que implementa chaves p√∫blicas comprimidas, as chaves privadas s√≥ ser√£o exportadas como WIF-comprimidas (com um prefixo <em>K</em> ou <em>L</em>). Se a carteira tiver uma implementa√ß√£o mais antiga e n√£o usar chaves p√∫blicas comprimidas, as chaves privadas s√≥ ser√£o exportadas como WIF (com um prefixo 5). O objetivo disso √© sinalizar para a carteira que est√° importando essas chaves privadas se ela precisa pesquisar na blockchain por chaves p√∫blicas e endere√ßos comprimidos ou n√£o comprimidos.</p>
</div>
<div class="paragraph data-line-493">
<p>If a bitcoin wallet is able to implement compressed public keys, it will use those in all transactions. The private keys in the wallet will be used to derive the public key points on the curve, which will be compressed. The compressed public keys will be used to produce Bitcoin addresses and those will be used in transactions. When exporting private keys from a new wallet that implements compressed public keys, the WIF is modified, with the addition of a one-byte suffix 01 to the private key. The resulting Base58Check-encoded private key is called a "compressed WIF" and starts with the letter <em>K</em> or <em>L</em>, instead of starting with "5" as is the case with WIF-encoded (noncompressed) keys from older wallets.</p>
</div>
<div class="admonitionblock tip data-line-497">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-498">
<p>"Compressed private keys" is a misnomer! They are not compressed; rather, WIF-compressed signifies that the keys should only be used to derive compressed public keys and their corresponding Bitcoin addresses. Ironically, a "WIF-compressed" encoded private key is one byte longer because it has the added 01 suffix to distinguish it from an "uncompressed" one.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-501">
<p>=== Implementando Chaves e Endere√ßos em C++</p>
</div>
<div class="paragraph data-line-503">
<p>Let&#8217;s look at the complete process of creating a Bitcoin address, from a private key, to a public key (a point on the elliptic curve), to a double-hashed address, and finally, the Base58Check encoding. The C++ code in <a href="#addr_example">Creating a Base58Check-encoded Bitcoin address from a private key</a> shows the complete step-by-step process, from private key to Base58Check-encoded Bitcoin address. The code example uses the libbitcoin library introduced in <a href="#alt_libraries">[alt_libraries]</a> for some helper functions.</p>
</div>
<div id="addr_example" class="exampleblock data-line-507">
<div class="title">Example 10. Creating a Base58Check-encoded Bitcoin address from a private key</div>
<div class="content">
<div class="listingblock c_less_space data-line-510">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">Unresolved directive in for_use_mastering-bitcoin_chapter-4_pt_BR.adoc - include::code/addr.cpp[]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-515">
<p>The code uses a predefined private key to produce the same Bitcoin address every time it is run, as shown in <a href="#addr_example_run">Compilando e executando o c√≥digo addr.cpp</a>.</p>
</div>
<div id="addr_example_run" class="exampleblock data-line-519">
<div class="title">Example 11. Compilando e executando o c√≥digo addr.cpp</div>
<div class="content">
<div class="listingblock data-line-521">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># Compila o c√≥digo addr.cpp
$ g++ -o addr addr.cpp -std=c++11 $(pkg-config --cflags --libs libbitcoin)
# Roda o execut√°vel addr
$ ./addr
Chave p√∫blica: 0202a406624211f2abbdc68da3df929f938c3399dd79fac1b51b0e4ad1d26a47aa
Endere√ßo: 1PRTTaJesdNovgne6Ehcdu1fpEdX7913CK</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip data-line-532">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-533">
<p>The code in <a href="#addr_example_run">Compilando e executando o c√≥digo addr.cpp</a> produces a Bitcoin address (1PRTT...) from a <em>compressed</em> public key (see <a href="#comp_pub">[comp_pub]</a>). If you used the uncompressed public key instead, it would produce a different Bitcoin address (14K1y...).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-536">
<p>=== Implementando Chaves e Endere√ßos em Python</p>
</div>
<div class="paragraph data-line-538">
<p>A biblioteca de bitcoin mais completa em Python √© a <a href="https://github.com/vbuterin/pybitcointools" data-href="https://github.com/vbuterin/pybitcointools">pybitcointools</a> feita por Vitalik Buterin. No <a href="#key-to-address_script">Gera√ß√£o e formata√ß√£o de chaves e endere√ßos com a biblioteca pybitcointools</a>, usamos a biblioteca pybitcointools (importada como "bitcoin") para gerar e exibir chaves e endere√ßos em v√°rios formatos.</p>
</div>
<div id="key-to-address_script" class="exampleblock data-line-542">
<div class="title">Example 12. Gera√ß√£o e formata√ß√£o de chaves e endere√ßos com a biblioteca pybitcointools</div>
<div class="content">
<div class="listingblock data-line-544">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">Unresolved directive in for_use_mastering-bitcoin_chapter-4_pt_BR.adoc - include::code/key-to-address-ecc-example.py[]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-549">
<p>O <a href="#key-to-address_script_run">Executando key-to-address-ecc-example.py</a> mostra o output ap√≥s executar esse c√≥digo.</p>
</div>
<div id="key-to-address_script_run" class="exampleblock data-line-553">
<div class="title">Example 13. Executando key-to-address-ecc-example.py</div>
<div class="content">
<pre data-type="programlisting">
$ python key-to-address-ecc-example.py
A Chave Privada (hex) √©:
 3aba4162c7251c891207b747840551a71939b0de081f85c4e44cf7c13e41daa6
A Chave Privada (decimal) √©:
 26563230048437957592232553826663696440606756685920117476832299673293013768870
A Chave Privada (WIF) √©:
 5JG9hT3beGTJuUAmCQEmNaxAuMacCTfXuw1R3FCXig23RQHMr4K
A Chave Privada Comprimida (hex) √©:
 3aba4162c7251c891207b747840551a71939b0de081f85c4e44cf7c13e41daa601
A Chave Privada (WIF-Comprimida) √©:
 KyBsPXxTuVD82av65KZkrGrWi5qLMah5SdNq6uftawDbgKa2wv6S
A Chave P√∫blica em coordenadas (x,y) √©:
 (41637322786646325214887832269588396900663353932545912953362782457239403430124L,
 16388935128781238405526710466724741593761085120864331449066658622400339362166L)
A Chave P√∫blica (hex) √©:
 045c0de3b9c8ab18dd04e3511243ec2952002dbfadc864b9628910169d9b9b00ec&#x21b5;
243bcefdd4347074d44bd7356d6a53c495737dd96295e2a9374bf5f02ebfc176
A Chave P√∫blica Comprimida (hex) √©:
 025c0de3b9c8ab18dd04e3511243ec2952002dbfadc864b9628910169d9b9b00ec
O Endere√ßo de Bitcoin (b58check) √©:
 1thMirt546nngXqyPEz532S8fLwbozud8
O Endere√ßo de Bitcoin Comprimido (b58check) √©:
 14cxpo3MBCYYWCgF74SWTdcmxipnGUsPw3
</pre>
</div>
</div>
<div class="paragraph data-line-584">
<p>O <a href="#ec_math">Um script demonstrado a matem√°tica de curva el√≠ptica usada para as chaves do bitcoin</a> √© outro exemplo, que usa a biblioteca Python de ECDSA para a matem√°tica de curva el√≠ptica e n√£o usa nenhuma biblioteca especializada de bitcoin.</p>
</div>
<div id="ec_math" class="exampleblock data-line-588">
<div class="title">Example 14. Um script demonstrado a matem√°tica de curva el√≠ptica usada para as chaves do bitcoin</div>
<div class="content">
<div class="listingblock data-line-590">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">Unresolved directive in for_use_mastering-bitcoin_chapter-4_pt_BR.adoc - include::code/ec-math.py[]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-595">
<p>O <a href="#ec_math_run">Instalando a biblioteca Python de ECDSA e executando o script ec_math.py</a> mostra a sa√≠da produzida ao executar-se esse script.</p>
</div>
<div class="admonitionblock warning data-line-598">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-599">
<p>O <a href="#ec_math">Um script demonstrado a matem√°tica de curva el√≠ptica usada para as chaves do bitcoin</a> usa o os.urandom, que reflete um gerador de n√∫mero aleat√≥rio criptograficamente seguro (CSRNG) fornecido pelo sistema operacional subjacente. Cuidado: dependendo do sistema operacional, √© poss√≠vel que o os.urandom <em>n√£o</em> seja implementado com seguran√ßa suficiente ou que ele n√£o use uma semente aleat√≥ria adequada e, em fun√ß√£o disso, pode ser que ele <em>n√£o</em> seja apropriado para gerar chaves de bitcoin com qualidade suficiente para serem usadas em produ√ß√£o.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="ec_math_run" class="exampleblock data-line-604">
<div class="title">Example 15. Instalando a biblioteca Python de ECDSA e executando o script ec_math.py</div>
<div class="content">
<div class="listingblock data-line-605">
<div class="content">
<pre># Instala o administrador de pacotes Python PIP
$ sudo apt-get install python-pip
# Instala a biblioteca Python de ECDSA
$ sudo pip install ecdsa
# Executa o script
$ python ec-math.py
Segredo: 38090835015954358862481132628887443905906204995912378278060168703580660294000
Ponto na CE: (70048853531867179489857750497606966272382583471322935454624595540007269312627, 105262206478686743191060800263479589329920209527285803935736021686045542353380)
Chave p√∫blica do BTC: 029ade3effb0a67d5c8609850d797366af428f4a0d5194cb221d807770a1522873</pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-618">
<p>=== Chaves e Endere√ßos Avan√ßados</p>
</div>
<div class="paragraph data-line-620">
<p>Nas pr√≥ximas se√ß√µes, veremos as formas avan√ßadas de chaves e endere√ßos, como chaves privadas criptografadas, scripts e endere√ßos multiassinatura, endere√ßos personalizados e carteiras de papel.</p>
</div>
<div id="p2sh_addresses" class="paragraph data-line-623">
<p>==== Endere√ßos Pay-to-Script Hash (P2SH) e Multiassinatura</p>
</div>
<div class="paragraph data-line-625">
<p>As we know, traditional Bitcoin addresses begin with the number ‚Äú1‚Äù and are derived from the public key, which is derived from the private key.  Although anyone can send bitcoin to a ‚Äú1‚Äù address, that bitcoin can only be spent by presenting the corresponding private key signature and public key.</p>
</div>
<div class="paragraph data-line-627">
<p>Bitcoin addresses that begin with the number ‚Äú3‚Äù are pay-to-script hash (P2SH) addresses, sometimes erroneously called multisignature or multisig addresses. They designate the beneficiary of a bitcoin transaction as the hash of a script, instead of the owner of a public key. The feature was introduced in January 2012 with BIP-16 (see <a href="#appdxbitcoinimpproposals">[appdxbitcoinimpproposals]</a>), and is being widely adopted because it provides the opportunity to add functionality to the address itself. Unlike transactions that "send" funds to traditional ‚Äú1‚Äù Bitcoin addresses, also known as a pay-to-public-key-hash (P2PKH), funds sent to ‚Äú3‚Äù addresses require something more than the presentation of one public key and one private key signature as proof of ownership. The requirements are designated at the time the address is created, within the script, and all inputs to this address will be encumbered with the same requirements.</p>
</div>
<div class="paragraph data-line-629">
<p>A P2SH address is created from a transaction script, which defines who can spend a transaction output (for more details, see <a href="#p2sh">[p2sh]</a>). Encoding a P2SH address involves using the same double-hash function as used during creation of a Bitcoin address, only applied on the script instead of the public key:</p>
</div>
<div class="listingblock data-line-631">
<div class="content">
<pre>hash do script = RIPEMD160(SHA256(script))</pre>
</div>
</div>
<div class="paragraph data-line-635">
<p>O "hash de script" resultante √© codificado em Base58Check com um prefixo de vers√£o 5, que resulta em um endere√ßo codificado que inicia com um 3. Um exemplo de endere√ßo P2SH √© 3F6i6kwkevjR7AsAd4te2YB2zZyASEm1HM, que pode ser derivado usando-se os comandos script-encode, sha256, ripemd160 e base58check-encode do Bitcoin Explorer (ver o <a href="#appdx_bx">[appdx_bx]</a>), como demonstrado a seguir:</p>
</div>
<div class="listingblock data-line-637">
<div class="content">
<pre>$ echo \
'DUP HASH160 [89abcdefabbaabbaabbaabbaabbaabbaabbaabba] EQUALVERIFY CHECKSIG' &gt; script
$ bx script-encode &lt; script | bx sha256 | bx ripemd160 \
| bx base58check-encode --version 5
3F6i6kwkevjR7AsAd4te2YB2zZyASEm1HM</pre>
</div>
</div>
<div class="admonitionblock tip data-line-646">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-647">
<p>P2SH n√£o necessariamente √© o mesmo que uma transa√ß√£o multiassinatura padr√£o. Um endere√ßo P2SH <em>geralmente</em> representa um script multiassinatura, mas ele tamb√©m pode representar um script codificando outros tipos de transa√ß√µes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-650">
<p>===== Endere√ßos multiassinatura e P2SH</p>
</div>
<div class="paragraph data-line-652">
<p>Atualmente, a implementa√ß√£o mais comum da fun√ß√£o P2SH √© o script de endere√ßo multiassinatura. Como o nome sugere, o script subjacente exige um n√∫mero m√≠nimo de assinaturas para provar a posse e, portanto, gastar os fundos. A funcionalidade de multiassinatura do bitcoin √© projetada para exigir M assinaturas (tamb√©m conhecidas como o "limiar", em ingl√™s, <em>threshold</em>) de um total de N chaves, o que √© conhecido como uma multiassinatura M-de-N, onde M √© igual ou menor do que N. Por exemplo, Bob, o dono da cafeteria do <a href="#ch01_intro_what_is_bitcoin">Introdu√ß√£o</a> poderia usar um endere√ßo multiassinatura exigindo 1-de-2 assinaturas geradas a partir da chave que o pertence e de uma chave que pertence √† sua esposa, garantindo que qualquer um deles poderia fazer uma assinatura para gastar uma sa√≠da de transa√ß√£o travada nesse endere√ßo. Isso seria semelhante a uma "conta conjunta" em um banco tradicional, onde qualquer um dos c√¥njuges pode gastar sozinho com a sua pr√≥pria assinatura. Ou o Gopesh, o web designer que o Bob contratou para criar um site, poderia ter um endere√ßo multiassinatura 2-de-3 para o seu neg√≥cio, para garantir que nenhum fundo possa ser gasto a menos que dois de seus s√≥cios assinem uma transa√ß√£o.</p>
</div>
<div class="paragraph data-line-654">
<p>Exploraremos como criar transa√ß√µes que gastam fundos de endere√ßos P2SH (e multiassinatura) no <a href="#transactions">[transactions]</a>.</p>
</div>
<div class="paragraph data-line-656">
<p>==== Endere√ßos Personalizados</p>
</div>
<div class="paragraph data-line-658">
<p>Vanity addresses are valid Bitcoin addresses that contain human-readable messages. For example, 1LoveBPzzD72PUXLzCkYAtGFYmK5vYNR33 is a valid address that contains the letters forming the word "Love" as the first four Base58 letters. Vanity addresses require generating and testing billions of candidate private keys, until a Bitcoin address with the desired pattern is found. Although there are some optimizations in the vanity generation algorithm, the process essentially involves picking a private key at random, deriving the public key, deriving the Bitcoin address, and checking to see if it matches the desired vanity pattern, repeating billions of times until a match is found.</p>
</div>
<div class="paragraph data-line-660">
<p>Assim que um endere√ßo personalizado correspondendo ao padr√£o desejado for encontrado, a chave privada da qual ele foi derivado pode ser usada pelo dono para gastar os bitcoins da mesma maneira como se fosse qualquer outro endere√ßo. Os endere√ßos personalizados n√£o s√£o mais ou menos seguros do que qualquer outro endere√ßo. Eles dependem da mesma Criptografia de Curva El√≠ptica (ECC) e do mesmo Algoritmo de Hash Seguro (SHA) como qualquer outro endere√ßo. N√£o √© mais f√°cil descobrir a chave privada de um endere√ßo que come√ßa com um padr√£o personalizado, em compara√ß√£o com qualquer outro endere√ßo.</p>
</div>
<div class="paragraph data-line-662">
<p>In <a href="#ch01_intro_what_is_bitcoin">Introdu√ß√£o</a>, we introduced Eugenia, a children&#8217;s charity director operating in the Philippines. Let&#8217;s say that Eugenia is organizing a bitcoin fundraising drive and wants to use a vanity Bitcoin address to publicize the fundraising. Eugenia will create a vanity address that starts with "1Kids" to promote the children&#8217;s charity fundraiser. Let&#8217;s see how this vanity address will be created and what it means for the security of Eugenia&#8217;s charity.</p>
</div>
<div class="paragraph data-line-664">
<p>===== Gerando endere√ßos personalizados</p>
</div>
<div class="paragraph data-line-666">
<p>It&#8217;s important to realize that a Bitcoin address is simply a number represented by symbols in the Base58 alphabet. The search for a pattern like "1Kids" can be seen as searching for an address in the range from 1Kids11111111111111111111111111111 to 1Kidszzzzzzzzzzzzzzzzzzzzzzzzzzzzz. There are approximately 58<sup>29</sup> (approximately 1.4 * 10<sup>51</sup>) addresses in that range, all starting with "1Kids." <a href="#table_4-11">O intervalo de endere√ßos personalizados iniciando com "1Kids"</a> shows the range of addresses that have the prefix 1Kids.</p>
</div>
<table id="table_4-11" class="tableblock frame-all grid-all stretch data-line-670">
<caption class="title">Table 5. O intervalo de endere√ßos personalizados iniciando com "1Kids"</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>De</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1Kids11111111111111111111111111111</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1Kids11111111111111111111111111112</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1Kids11111111111111111111111111113</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">...</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>At√©</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1Kidszzzzzzzzzzzzzzzzzzzzzzzzzzzzz</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-678">
<p>Let&#8217;s look at the pattern "1Kids" as a number and see how frequently we might find this pattern in a Bitcoin address (see <a href="#table_4-12">A frequ√™ncia de um padr√£o personalizado (1KidsCharity) e o tempo m√©dio de busca em um computador desktop</a>). An average desktop computer PC, without any specialized hardware, can search approximately 100,000 keys per second.</p>
</div>
<table id="table_4-12" class="tableblock frame-all grid-all stretch data-line-683">
<caption class="title">Table 6. A frequ√™ncia de um padr√£o personalizado (1KidsCharity) e o tempo m√©dio de busca em um computador desktop</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Comprimento</th>
<th class="tableblock halign-left valign-top">Padr√£o</th>
<th class="tableblock halign-left valign-top">Frequ√™ncia</th>
<th class="tableblock halign-left valign-top">Tempo m√©dio de busca</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1K</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 em 58 chaves</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt; 1 milissegundo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1Ki</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 em 3.364</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">50 milissegundos</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1Kid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 em 195.000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt; 2 segundos</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1Kids</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 em 11 milh√µes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 minuto</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1KidsC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 em 656 milh√µes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 hora</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1KidsCh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 em 38 bilh√µes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 dias</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1KidsCha</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 em 2,2 trilh√µes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3‚Äì4 meses</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1KidsChar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 em 128 trilh√µes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13‚Äì18 anos</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1KidsChari</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 em 7 quadrilh√µes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">800 anos</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1KidsCharit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 em 400 quadrilh√µes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">46.000 anos</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1KidsCharity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 em 23 quintilh√µes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2,5 milh√µes de anos</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-699">
<p>Como voc√™ pode ver, a Eug√™nia n√£o conseguir√° criar o endere√ßo personalizado "1KidsCharity" t√£o cedo, mesmo que ela tivesse acesso a milhares de computadores. Cada caractere adicional aumenta a dificuldade em um fator de 58. Os padr√µes de sete ou mais caracteres geralmente s√£o encontrados utilizando-se hardware especializado, como desktops montados de maneira customizada com m√∫ltiplas placas de v√≠deo (GPUs). Esses hardwares frequentemente s√£o equipamentos antigos que j√° foram usados para a minera√ß√£o do bitcoin e que n√£o s√£o mais lucrativos para esse prop√≥sito, mas que ainda podem ser usados para buscar endere√ßos personalizados. As buscas por endere√ßos personalizados em sistemas usando placas de v√≠deo (GPUs) s√£o v√°rias ordens de magnitude mais r√°pidas do que as realizadas em sistemas usando processadores de prop√≥sito geral (CPUs).</p>
</div>
<div class="paragraph data-line-701">
<p>Outra maneira de encontrar um endere√ßo personalizado √© terceirizar o trabalho para uma pool vanity de mineradores, como a <a href="https://vanitypool.appspot.com" data-href="https://vanitypool.appspot.com">Vanity Pool</a>. Uma pool desse tipo √© um servi√ßo que permite que aqueles com hardware de GPU ganhem bitcoin procurando endere√ßos personalizados para os outros. Por um pequeno pagamento (0,01 bitcoin ou aproximadamente USD $5 no momento da reda√ß√£o deste artigo), a Eugenia pode terceirizar a pesquisa por um endere√ßo personalizado com padr√£o de sete caracteres e obter resultados em algumas horas, em vez que executar uma pesquisa usando uma CPU levaria meses.</p>
</div>
<div class="paragraph data-line-703">
<p>A gera√ß√£o de um endere√ßo personalizado √© um exerc√≠cio de for√ßa bruta: crie uma chave aleat√≥ria, verifique se o endere√ßo resultante corresponde ao padr√£o desejado e repita o processo at√© encontrar um endere√ßo que corresponda. O <a href="#vanity_miner_code">Minerador de endere√ßo personalizado</a> mostra um exemplo de um "minerador de endere√ßo personalizado" (em ingl√™s, <em>vanity miner</em>), um programa projetado para buscar endere√ßos personalizados, escrito em C++. O exemplo usa a biblioteca libbitcoin, que apresentamos em <a href="#alt_libraries">[alt_libraries]</a>.</p>
</div>
<div id="vanity_miner_code" class="exampleblock data-line-707">
<div class="title">Example 16. Minerador de endere√ßo personalizado</div>
<div class="content">
<div class="listingblock data-line-709">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">Unresolved directive in for_use_mastering-bitcoin_chapter-4_pt_BR.adoc - include::code/vanity-miner.cpp[]</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note data-line-715">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-716">
<p>O <a href="#vanity_miner_code">Minerador de endere√ßo personalizado</a> usa o std::random_device. Dependendo da implementa√ß√£o, ele pode refletir um gerador de n√∫mero aleat√≥rio criptograficamente seguro fornecido pelo sistema operacional subjacente. No caso de um sistema operacional do tipo Unix, como o Linux, ele √© obtido a partir do /dev/urandom. O gerador de n√∫mero aleat√≥rio utilizado aqui √© usado apenas para fins de demonstra√ß√£o e <em>n√£o</em> √© apropriado para gerar chaves de bitcoin com qualidade para serem usadas em produ√ß√£o, pois ele n√£o √© implementado com seguran√ßa suficiente.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-719">
<p>O c√≥digo de exemplo deve ser compilado usando um compilador C++ e vinculado √† biblioteca libbitcoin (que deve ser previamente instalada no sistema). Para executar o exemplo, rode o execut√°vel vanity-miner sem nenhum par√¢metro (ver o <a href="#vanity_miner_run">Compilando e executando o exemplo <em>vanity-miner</em></a>) e ele tentar√° encontrar um endere√ßo personalizado que inicie com "1kid".</p>
</div>
<div id="vanity_miner_run" class="exampleblock data-line-723">
<div class="title">Example 17. Compilando e executando o exemplo <em>vanity-miner</em></div>
<div class="content">
<div class="listingblock data-line-725">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># Compila o c√≥digo com g++
$ g++ -o vanity-miner vanity-miner.cpp $(pkg-config --cflags --libs libbitcoin)
# Executa o exemplo
$ ./vanity-miner
Endere√ßo personalizado encontrado! 1KiDzkG4MxmovZryZRj8tK81oQRhbZ46YT
Segredo: 57cc268a05f83a23ac9d930bc8565bac4e277055f4794cbd1a39e5e71c038f3f
# Executa o exemplo novamente para se obter um resultado diferente
$ ./vanity-miner
Endere√ßo personalizado encontrado! 1Kidxr3wsmMzzouwXibKfwTYs5Pau8TUFn
Segredo: 7f65bbbbe6d8caae74a0c6a0d2d7b5c6663d71b60337299a1a2cf34c04b2a623
# Usa "time" para ver quanto tempo demora para se encontrar um resultado
$ time ./vanity-miner
Endere√ßo personalizado encontrado! 1KidPWhKgGRQWD5PP5TAnGfDyfWp5yceXM
Segredo: 2a802e7a53d8aa237cd059377b616d2bfcfa4b0140bc85fa008f2d3d4b225349

real	0m8.868s
user	0m8.828s
sys	0m0.035s</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-747">
<p>O c√≥digo de exemplo levar√° alguns segundos para encontrar uma correspond√™ncia ao padr√£o de tr√™s caracteres "kid", como podemos ver quando usamos o comando time do Unix para medir o tempo de execu√ß√£o. Mude o padr√£o desejado alterando a <em>string</em> search no c√≥digo-fonte e veja o qu√£o demorado √© para se conseguir encontrar padr√µes de quatro ou cinco caracteres!</p>
</div>
<div class="paragraph data-line-749">
<p>===== Seguran√ßa do endere√ßo personalizado</p>
</div>
<div class="paragraph data-line-751">
<p>Os endere√ßos personalizados podem ser usados tanto para melhorar <em>quanto</em> para burlar medidas de seguran√ßa; eles s√£o uma verdadeira faca de dois gumes. Quando usado para melhorar a seguran√ßa, um endere√ßo diferenciado torna mais dif√≠cil para que hackers substituam o seu endere√ßo pelo endere√ßo deles, o que faria com que seus clientes pagassem para os hackers, ao inv√©s de pagarem para voc√™. Infelizmente, os endere√ßos personalizados tamb√©m permitem que qualquer pessoa crie um endere√ßo que se <em>pare√ßa</em> com qualquer endere√ßo aleat√≥rio, ou mesmo outro endere√ßo personalizado, e com isso enganando seus clientes.</p>
</div>
<div class="paragraph data-line-753">
<p>A Eug√™nia poderia divulgar um endere√ßo gerado aleatoriamente (por exemplo, 1J7mdg5rbQyUHENYdx39WVWK7fsLpEoXZy) para que as pessoas enviem suas doa√ß√µes. Ou ela poderia gerar um endere√ßo personalizado que come√ßa com 1Kids, para torn√°-lo mais atraente.</p>
</div>
<div class="paragraph data-line-755">
<p>Em ambos os casos, um dos riscos de se usar um endere√ßo fixo √∫nico (em vez de usar um endere√ßo din√¢mico separado para cada doador) √© que um ladr√£o pode conseguir invadir o seu site e substituir o seu endere√ßo pelo endere√ßo dele, desviando as doa√ß√µes que voc√™ receberia. Se voc√™ divulgou seu endere√ßo de doa√ß√£o em v√°rios lugares diferentes, seus usu√°rios podem inspecionar visualmente o endere√ßo antes de fazer um pagamento, para se assegurarem que ele √© o mesmo que eles viram em seu site, e-mail ou flyer. No caso de um endere√ßo aleat√≥rio como 1J7mdg5rbQyUHENYdx39WVWK7fsLpEoXZy, o usu√°rio comum talvez inspecionar√° apenas os primeiros caracteres "1J7mdg" e ficar√° satisfeito se eles forem iguais. Usando um gerador de endere√ßos personalizados, uma pessoa mal-intencionada pode criar rapidamente endere√ßos que se pare√ßam com o verdadeiro, com apenas os primeiros caracteres iguais, como demonstrado na <a href="#table_4-13">Gerando endere√ßos personalizados para corresponder a um endere√ßo aleat√≥rio</a>.</p>
</div>
<table id="table_4-13" class="tableblock frame-all grid-all stretch data-line-759">
<caption class="title">Table 7. Gerando endere√ßos personalizados para corresponder a um endere√ßo aleat√≥rio</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Endere√ßo Aleat√≥rio Original</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1J7mdg5rbQyUHENYdx39WVWK7fsLpEoXZy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Endere√ßo Personalizado (4 caracteres)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1J7md1QqU4LpctBetHS2ZoyLV5d6dShhEy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Endere√ßo Personalizado (5 caracteres)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1J7mdgYqyNd4ya3UEcq31Q7sqRMXw2XZ6n</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Endere√ßo Personalizado (6 caracteres)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1J7mdg5WxGENmwyJP9xuGhG5KRzu99BBCX</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-766">
<p>Ent√£o um endere√ßo personalizado aumenta a seguran√ßa? Se a Eug√™nia gerar o endere√ßo personalizado 1Kids33q44erFfpeXrmDSz7zEqG2FesZEN, os usu√°rios provavelmente olhar√£o para a palavra com o padr√£o personalizado <em>e alguns caracteres al√©m</em>, por exemplo, percebendo a parte "1Kids33" do endere√ßo. Isso for√ßaria um hacker a gerar um endere√ßo personalizado que tenha pelo menos seis caracteres iguais (dois a mais), tendo que se esfor√ßar 3.364 vezes mais (58 &#x00D7; 58) do que a Eug√™nia teve que se esfor√ßar para conseguir gerar o seu endere√ßo personalizado de quatro caracteres. Essencialmente, o esfor√ßo que a Eug√™nia teve que fazer (ou pagar para uma pool de minera√ß√£o fazer) acaba exigindo que o hacker produza um padr√£o personalizado mais longo. Se a Eug√™nia pagar para uma pool gerar um endere√ßo personalizado de 8 caracteres, o hacker teria que fazer um esfor√ßo para produzir um endere√ßo de 10 caracteres, algo que √© invi√°vel de ser feito em um computador pessoal e muito caro para ser obtido, at√© mesmo em equipamentos de minera√ß√£o de endere√ßos personalizados ou em uma pool de minera√ß√£o. O que tem um pre√ßo acess√≠vel para a Eug√™nia acaba se tornando muito caro para o hacker, especialmente se a recompensa potencial pela fraude n√£o √© alta o suficiente para cobrir o custo da gera√ß√£o do endere√ßo personalizado.</p>
</div>
<div id="paper_wallets" class="paragraph data-line-769">
<p>==== Carteiras de Papel</p>
</div>
<div class="paragraph data-line-771">
<p>Paper wallets are bitcoin private keys printed on paper. Often the paper wallet also includes the corresponding Bitcoin address for convenience, but this is not necessary because it can be derived from the private key.</p>
</div>
<div class="admonitionblock warning data-line-774">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-775">
<p>As carteiras de papel s√£o uma tecnologia OBSOLETA e, portanto, s√£o consideradas perigosas para a maioria dos usu√°rios. Existem muitas armadilhas sutis que podem ser exploradas durante o processo de gera√ß√£o das carteiras, incluindo a possibilidade de que o c√≥digo gerador seja comprometido por um "<em>back door</em>". Centenas de bitcoins j√° foram roubados dessa forma. As carteiras de papel s√£o mostradas nesta se√ß√£o apenas para fins informativos e n√£o devem ser usadas para armazenar bitcoins. Use uma frase mnem√¥nica do padr√£o BIP-39 para fazer backup de suas chaves. Use uma carteira de hardware para armazenar chaves e assinar transa√ß√µes. N√ÉO USE CARTEIRAS DE PAPEL.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-778">
<p>As carteiras de papel possuem muitos formatos, tamanhos e designs, mas basicamente elas s√£o apenas uma chave privada e um endere√ßo impressos em um papel. A <a href="#table_4-14">Simplest form of a paper wallet‚Äîa printout of the Bitcoin address and private key</a> mostra a forma mais simples de uma carteira de papel.</p>
</div>
<table id="table_4-14" class="tableblock frame-all grid-all stretch data-line-783">
<caption class="title">Table 8. Simplest form of a paper wallet‚Äîa printout of the Bitcoin address and private key</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Endere√ßo p√∫blico</th>
<th class="tableblock halign-left valign-top">Chave privada (WIF)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1424C2F4bC9JidNjjTUZCbUxv6Sa1Mt62x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-788">
<p>As carteiras de papel possuem muitos designs e tamanhos, com muitos recursos diferentes. A &lt;paper_wallet_simple&gt; mostra um exemplo de uma carteira de papel.</p>
</div>
<div id="paper_wallet_simple" class="imageblock data-line-792">
<div class="content">
<img src="images/mbc2_0408.png" alt="mbc2 0408">
</div>
<div class="title">Figure 21. Um exemplo de uma carteira de papel simples</div>
</div>
<div class="paragraph data-line-795">
<p>Algumas s√£o feitas para serem dadas de presente e tem temas sazonais, como as de Natal e Ano Novo. Outras s√£o projetadas para serem armazenadas em um cofre de banco com a chave privada escondida de alguma maneira, seja atrav√©s de adesivos opacos com raspadinhas, ou dobradas e seladas com um lacre de fita adesiva inviol√°vel.</p>
</div>
<div class="paragraph data-line-797">
<p>Outros designs apresentam c√≥pias adicionais das chaves e dos endere√ßos, na forma de canhotos destac√°veis semelhantes a canhotos de ingressos, permitindo que voc√™ armazene m√∫ltiplas c√≥pias para proteg√™-las de inc√™ndios, enchentes e outros desastres naturais.</p>
</div>
<div id="paper_wallet_spw" class="imageblock data-line-801">
<div class="content">
<img src="images/mbc2_0412.png" alt="mbc2 0412">
</div>
<div class="title">Figure 22. Um exemplo de uma carteira de papel com um canhoto de backup contendo c√≥pias adicionais das chaves</div>
</div>
<div id="ch05_wallets" class="paragraph data-line-804">
<p>== Carteiras</p>
</div>
<div class="paragraph data-line-806">
<p>A palavra "carteira" √© usada para descrever diferentes coisas no bitcoin.</p>
</div>
<div class="paragraph data-line-808">
<p>De maneira geral, uma carteira √© um aplicativo que serve como a interface de usu√°rio principal. A carteira controla o acesso ao dinheiro do usu√°rio ao gerenciar chaves e endere√ßos, controlar o saldo, criar transa√ß√µes e assinar transa√ß√µes.</p>
</div>
<div class="paragraph data-line-810">
<p>Mais precisamente, do ponto de vista de um programador, a palavra "carteira" refere-se √† estrutura de dados usada para armazenar e gerenciar as chaves de um usu√°rio.</p>
</div>
<div class="paragraph data-line-812">
<p>Neste cap√≠tulo, veremos o segundo significado, em que as carteiras s√£o lugares para armazenar chaves privadas, geralmente implementados como arquivos estruturados ou bancos de dados simples.</p>
</div>
<div class="paragraph data-line-814">
<p>=== Vis√£o Geral da Tecnologia de Carteira</p>
</div>
<div class="paragraph data-line-816">
<p>Nesta se√ß√£o, resumimos as v√°rias tecnologias usadas para construir carteiras de bitcoin f√°ceis de usar, seguras e vers√°teis.</p>
</div>
<div class="paragraph data-line-818">
<p>A common misconception about bitcoin is that bitcoin wallets contain bitcoin. In fact, the wallet contains only keys. The "coins" are recorded in the blockchain on the Bitcoin network. Users control the coins on the network by signing transactions with the keys in their wallets. In a sense, a bitcoin wallet is a <em>keychain</em>.</p>
</div>
<div class="admonitionblock tip data-line-821">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-822">
<p>As carteiras de bitcoin cont√™m chaves, e n√£o moedas. Cada usu√°rio tem uma carteira que cont√©m chaves. As carteiras, na verdade, s√£o chaveiros que cont√™m pares de chaves privadas/p√∫blicas (veja <a href="#private_public_keys">[private_public_keys]</a>). Os usu√°rios assinam transa√ß√µes com as suas chaves, provando que possuem as sa√≠das de transa√ß√£o (provando que s√£o donos de suas moedas). As moedas s√£o armazenadas na blockchain na forma de sa√≠das de transa√ß√£o (frequentemente denominadas como vout ou txout).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-825">
<p>Existem dois tipos principais de carteiras, que s√£o distinguidas pelo fato de suas chaves estarem relacionadas entre si ou n√£o.</p>
</div>
<div class="paragraph data-line-827">
<p>O primeiro tipo √© uma <em>carteira n√£o determin√≠stica</em>, em que cada chave √© gerada independentemente a partir de um n√∫mero aleat√≥rio. As chaves n√£o est√£o relacionadas entre si. Este tipo de carteira tamb√©m √© conhecido como uma carteira JBOK, da frase em ingl√™s "<em>Just a Bunch of Keys</em>" ("Apenas um Monte de Chaves").</p>
</div>
<div class="paragraph data-line-829">
<p>O segundo tipo de carteira √© uma <em>carteira determin√≠stica</em>, em que todas as chaves s√£o derivadas de uma √∫nica chave mestra, conhecida como a <em>semente</em>. Todas as chaves neste tipo de carteira est√£o relacionadas umas com as outras e podem ser geradas novamente por algu√©m que tiver a semente original. Existem v√°rios m√©todos diferentes de <em>deriva√ß√£o de chaves</em> usados ‚Äã‚Äãem carteiras determin√≠sticas. O m√©todo de deriva√ß√£o mais comumente usado utiliza uma estrutura semelhante a uma √°rvore e √© conhecido como <em>carteira determin√≠stica hier√°rquica</em> ou carteira <em>HD</em>.</p>
</div>
<div class="paragraph data-line-831">
<p>As carteiras determin√≠sticas s√£o inicializadas a partir de uma sequ√™ncia aleat√≥ria (uma entropia). Para facilitar o uso, as sequ√™ncias aleat√≥rias s√£o codificadas como palavras em ingl√™s, tamb√©m conhecidas como <em>palavras de c√≥digo mnem√¥nico</em>.</p>
</div>
<div class="paragraph data-line-833">
<p>As pr√≥ximas se√ß√µes apresentar√£o uma vis√£o geral de cada uma dessas tecnologias.</p>
</div>
<div id="random_wallet" class="paragraph data-line-836">
<p>==== Carteiras N√£o Determin√≠sticas (Aleat√≥rias)</p>
</div>
<div class="paragraph data-line-838">
<p>In the first bitcoin wallet (now called Bitcoin Core), wallets were collections of randomly generated private keys. For example, the original Bitcoin Core client pregenerates 100 random private keys when first started and generates more keys as needed, using each key only once.  Such wallets are being replaced with deterministic wallets because they are cumbersome to manage, back up, and import. The disadvantage of random keys is that if you generate many of them you must keep copies of all of them, meaning that the wallet must be backed up frequently. Each key must be backed up, or the funds it controls are irrevocably lost if the wallet becomes inaccessible. This conflicts directly with the principle of avoiding address reuse, by using each Bitcoin address for only one transaction. Address reuse reduces privacy by associating multiple transactions and addresses with each other. A Type-0 nondeterministic wallet is a poor choice of wallet, especially if you want to avoid address reuse because it means managing many keys, which creates the need for frequent backups. Although the Bitcoin Core client includes a Type-0 wallet, using this wallet is discouraged by developers of Bitcoin Core. <a href="#Type0_wallet">Carteira n√£o determin√≠stica (aleat√≥ria) do tipo 0: uma cole√ß√£o de chaves geradas aleatoriamente</a> shows a nondeterministic wallet, containing a loose collection of random keys.</p>
</div>
<div class="admonitionblock tip data-line-841">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-842">
<p>O uso de carteiras n√£o determin√≠sticas √© desencorajado para qualquer uso que n√£o seja para se fazer testes simples. Elas s√£o simplesmente inc√¥modas demais para fazer backup e para serem usadas. Em vez disso, use uma <em>carteira HD</em> baseada no padr√£o da ind√∫stria com uma sequ√™ncia aleat√≥ria <em>mnem√¥nica</em> (uma entropia ou "semente inicial") para backup.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="Type0_wallet" class="imageblock smallersixty data-line-848">
<div class="content">
<img src="images/mbc2_0501.png" alt="Non-Deterministic Wallet">
</div>
<div class="title">Figure 23. Carteira n√£o determin√≠stica (aleat√≥ria) do tipo 0: uma cole√ß√£o de chaves geradas aleatoriamente</div>
</div>
<div class="paragraph data-line-850">
<p>==== Carteiras Determin√≠sticas (com Semente)</p>
</div>
<div class="paragraph data-line-852">
<p>As carteiras determin√≠sticas, ou "carteiras com semente", s√£o carteiras que cont√™m chaves privadas que s√£o todas derivadas de uma semente comum, atrav√©s do uso de uma fun√ß√£o de hash de sentido √∫nico. A semente √© um n√∫mero gerado aleatoriamente que √© combinado com outros dados, como um n√∫mero √≠ndice ou "c√≥digo de cadeia" (veja <a href="#hd_wallets">[hd_wallets]</a>), para derivar as chaves privadas. Em uma carteira determin√≠stica, a semente √© a √∫nica informa√ß√£o necess√°ria para se recuperar todas as chaves derivadas e, portanto, um √∫nico backup no momento da cria√ß√£o da carteira √© suficiente. A semente tamb√©m √© a √∫nica informa√ß√£o necess√°ria para se exportar ou importar a carteira, permitindo a f√°cil migra√ß√£o de todas as chaves do usu√°rio entre diferentes implementa√ß√µes de carteira. A <a href="#Type1_wallet">Carteira determin√≠stica tipo 1 (com semente): uma sequ√™ncia determin√≠stica de chaves derivadas a partir de uma semente</a> mostra um diagrama l√≥gico de uma carteira determin√≠stica.</p>
</div>
<div id="Type1_wallet" class="imageblock smallersixty data-line-857">
<div class="content">
<img src="images/mbc2_0502.png" alt="Deterministic Wallet">
</div>
<div class="title">Figure 24. Carteira determin√≠stica tipo 1 (com semente): uma sequ√™ncia determin√≠stica de chaves derivadas a partir de uma semente</div>
</div>
<div id="hd_wallets" class="paragraph data-line-860">
<p>==== Carteiras HD (BIP-32/BIP-44)</p>
</div>
<div class="paragraph data-line-862">
<p>As carteiras determin√≠sticas foram desenvolvidas para facilitar a deriva√ß√£o de v√°rias chaves a partir de uma √∫nica "semente". A forma mais avan√ßada de carteira determin√≠stica √© a carteira HD definida pelo padr√£o BIP-32. As carteiras HD cont√™m chaves derivadas em uma estrutura em forma de √°rvore, de tal forma que uma chave pai pode derivar uma sequ√™ncia de chaves filhas, e cada uma das quais pode derivar uma sequ√™ncia de chaves netas, e assim por diante, at√© uma profundidade infinita. Essa estrutura em forma de √°rvore √© ilustrada na <a href="#Type2_wallet">Carteira HD tipo 2: uma √°rvore de chaves geradas a partir de uma √∫nica semente</a>.</p>
</div>
<div id="Type2_wallet" class="imageblock data-line-866">
<div class="content">
<img src="images/mbc2_0503.png" alt="HD wallet">
</div>
<div class="title">Figure 25. Carteira HD tipo 2: uma √°rvore de chaves geradas a partir de uma √∫nica semente</div>
</div>
<div class="paragraph data-line-868">
<p>As carteiras HD oferecem duas grandes vantagens em rela√ß√£o √†s chaves aleat√≥rias (n√£o determin√≠sticas). Primeiro, a estrutura em forma de √°rvore pode ser usada para expressar significado organizacional adicional, por exemplo, quando um ramo espec√≠fico de subchaves √© usado para receber pagamentos e um ramo diferente √© usado para receber trocos de pagamentos efetuados. Os ramos de chaves tamb√©m podem ser usados em cen√°rios corporativos, alocando diferentes ramos a diferentes departamentos, subsidi√°rias, fun√ß√µes espec√≠ficas ou categorias cont√°beis.</p>
</div>
<div class="paragraph data-line-870">
<p>A segunda vantagem das carteiras HD √© que os usu√°rios podem criar uma sequ√™ncia de chaves p√∫blicas sem precisar ter acesso √†s chaves privadas correspondentes. Isso permite que carteiras HD sejam utilizadas em um servidor inseguro, ou em uma aplica√ß√£o que somente recebe pagamentos, emitindo uma chave p√∫blica diferente para cada transa√ß√£o. As chaves p√∫blicas n√£o precisam ser previamente carregadas ou derivadas, apesar de o servidor n√£o deter as chaves privadas que podem gastar os fundos.</p>
</div>
<div class="paragraph data-line-872">
<p>==== Sementes e C√≥digos Mnem√¥nicos (BIP-39)</p>
</div>
<div class="paragraph data-line-874">
<p>As carteiras HD s√£o um mecanismo muito poderoso para gerenciar v√°rias chaves e endere√ßos. Elas s√£o ainda mais √∫teis se forem combinadas com uma maneira padronizada de se criar sementes a partir de uma sequ√™ncia de palavras em ingl√™s que sejam f√°ceis de transcrever, exportar e importar entre carteiras. Essa sequ√™ncia de palavras √© conhecida como <em>mnem√¥nico</em>, e o padr√£o √© definido pela BIP-39. Hoje, a maioria das carteiras de bitcoin (e das carteiras de outras criptomoedas) usa esse padr√£o, que permite a importa√ß√£o e a exporta√ß√£o de sementes para backup e recupera√ß√£o usando mnem√¥nicos interoper√°veis.</p>
</div>
<div class="paragraph data-line-876">
<p>Vamos analisar isso sob um ponto de vista pr√°tico. Qual das seguintes sementes √© mais f√°cil de ser transcrita, anotada em um papel, lida sem erros, exportada e importada para uma outra carteira?</p>
</div>
<div class="listingblock data-line-879">
<div class="title">Uma semente para uma carteira determin√≠stica, exibida no formato hexadecimal</div>
<div class="content">
<pre>0C1E24E5917779D297E14D45F14E1A1A</pre>
</div>
</div>
<div class="listingblock data-line-884">
<div class="title">Uma semente para uma carteira determin√≠stica, codificada em um mnem√¥nico de 12 palavras</div>
<div class="content">
<pre>army van defense carry jealous true
garbage claim echo media make crunch</pre>
</div>
</div>
<div class="paragraph data-line-889">
<p>==== Melhores Pr√°ticas de Carteira</p>
</div>
<div class="paragraph data-line-891">
<p>Conforme a tecnologia das carteiras de bitcoin amadureceu, alguns padr√µes comuns da ind√∫stria foram surgindo, tornando as carteiras de bitcoin amplamente interoper√°veis, f√°ceis de usar, seguras e flex√≠veis. Esses padr√µes comuns s√£o:</p>
</div>
<div class="ulist data-line-893">
<ul>
<li class="data-line-893">
<p>Palavras de c√≥digo mnem√¥nico, com base na BIP-39</p>
</li>
<li class="data-line-894">
<p>Carteiras HD, com base na BIP-32</p>
</li>
<li class="data-line-895">
<p>Estrutura de carteira HD multifuncional, com base na BIP-43</p>
</li>
<li class="data-line-896">
<p>Carteiras multimoedas e multicontas, com base na BIP-44</p>
</li>
</ul>
</div>
<div class="paragraph data-line-898">
<p>Esses padr√µes podem mudar ou tornarem-se obsoletos por desenvolvimentos futuros, mas, por enquanto, eles formam um conjunto de tecnologias interligadas que se tornaram o padr√£o amplamente reconhecido de carteira para bitcoin.</p>
</div>
<div class="paragraph data-line-900">
<p>Os padr√µes foram adotados por uma ampla variedade de carteiras de bitcoin de software e hardware, tornando todas essas carteiras interoper√°veis. Um usu√°rio pode exportar um mnem√¥nico gerado em uma dessas carteiras e import√°-lo em outra carteira, recuperando todas as transa√ß√µes, chaves e endere√ßos.</p>
</div>
<div class="paragraph data-line-902">
<p>Alguns exemplos de carteiras de software que suportam esses padr√µes incluem (listadas em ordem alfab√©tica) a Breadwallet, a Copay e a Multibit HD. Exemplos de carteiras de hardware que suportam esses padr√µes incluem (listadas em ordem alfab√©tica) a KeepKey, a Ledger e a Trezor.</p>
</div>
<div class="paragraph data-line-904">
<p>Nas se√ß√µes a seguir examinaremos cada uma dessas tecnologias em maiores detalhes.</p>
</div>
<div class="admonitionblock tip data-line-907">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-908">
<p>Se voc√™ estiver implementando uma carteira de bitcoin, ela deve ser constru√≠da como uma carteira HD, com uma semente derivada de, e codificada como, um c√≥digo mnem√¥nico para backup, seguindo os padr√µes BIP-32, BIP-39, BIP-43 e BIP-44, conforme descrito nas pr√≥ximas se√ß√µes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-911">
<p>==== Usando uma Carteira de Bitcoin</p>
</div>
<div class="paragraph data-line-913">
<p>Em <a href="#user-stories">Usos do Bitcoin, Usu√°rios e Suas Hist√≥rias</a> apresentamos o Gabriel, um adolescente empreendedor do Rio de Janeiro, que gerencia uma pequena loja virtual que vende camisetas, canecas e adesivos com a marca bitcoin.</p>
</div>
<div class="paragraph data-line-915">
<p>Gabriel usa uma carteira de hardware da marca Trezor (<a href="#a_trezor_device">Um dispositivo Trezor: uma carteira HD de bitcoin em hardware</a>)  para gerenciar seus bitcoins com seguran√ßa. A Trezor √© um dispositivo USB simples com dois bot√µes que armazena chaves (na forma de uma carteira HD) e assina transa√ß√µes. As carteiras Trezor implementam todos os padr√µes da ind√∫stria discutidos neste cap√≠tulo, ent√£o o Gabriel n√£o depende de nenhuma tecnologia propriet√°ria ou solu√ß√£o de um √∫nico fornecedor.</p>
</div>
<div id="a_trezor_device" class="imageblock data-line-919">
<div class="content">
<img src="images/mbc2_0504.png" alt="alt">
</div>
<div class="title">Figure 26. Um dispositivo Trezor: uma carteira HD de bitcoin em hardware</div>
</div>
<div class="paragraph data-line-921">
<p>Quando o Gabriel usou a Trezor pela primeira vez, o dispositivo gerou uma sequ√™ncia aleat√≥ria (uma entropia), o mnem√¥nico associado e derivou uma semente a partir de um gerador de n√∫mero aleat√≥rio embutido no pr√≥prio hardware. Durante esta fase de inicializa√ß√£o, a carteira exibiu na tela uma sequ√™ncia de palavras numeradas, uma de cada vez (ver a <a href="#trezor_mnemonic_display">Trezor exibindo uma das palavras mnem√¥nicas</a>).</p>
</div>
<div id="trezor_mnemonic_display" class="imageblock data-line-925">
<div class="content">
<img src="images/mbc2_0505.png" alt="Trezor wallet display of mnemonic word">
</div>
<div class="title">Figure 27. Trezor exibindo uma das palavras mnem√¥nicas</div>
</div>
<div class="paragraph data-line-927">
<p>Ao anotar este mnem√¥nico em um papel, Gabriel criou um backup (ver a <a href="#mnemonic_paper_backup">O backup em papel do mnem√¥nico de Gabriel</a>) que pode ser usado para recupera√ß√£o em caso de perda ou dano ao dispositivo Trezor. Este mnem√¥nico pode ser usado para recupera√ß√£o em uma nova Trezor ou em qualquer uma entre v√°rias carteiras de software ou hardware compat√≠veis. Note que a ordem das palavras √© importante, e por causa disso os pap√©is para backup de mnem√¥nico t√™m lacunas numeradas que s√£o reservadas para cada palavra. Gabriel teve que anotar cuidadosamente cada palavra na lacuna numerada, a fim de preservar a ordem correta das palavras.</p>
</div>
<table id="mnemonic_paper_backup" class="tableblock frame-all grid-all data-line-932" style="width: 80%;">
<caption class="title">Table 9. O backup em papel do mnem√¥nico de Gabriel</caption>
<colgroup>
<col style="width: 0.9803%;">
<col style="width: 49.0196%;">
<col style="width: 0.9803%;">
<col style="width: 49.0198%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>1.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>army</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>7.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>garbage</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>2.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>van</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>8.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>claim</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>3.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>defense</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>9.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>echo</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>4.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>carry</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>10.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>media</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>5.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>jealous</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>11.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>make</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>6.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>true</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>12.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>crunch</em></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note data-line-942">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-943">
<p>Um mnem√¥nico de 12 palavras √© mostrado na <a href="#mnemonic_paper_backup">O backup em papel do mnem√¥nico de Gabriel</a>, para simplificar. Na verdade, a maioria das carteiras de hardware gera um mnem√¥nico de 24 palavras, que √© mais seguro. O mnem√¥nico √© usado exatamente da mesma maneira, independentemente da quantidade de palavras que ele possui.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-946">
<p>For the first implementation of his web store, Gabriel uses a single Bitcoin address, generated on his Trezor device. This single address is used by all customers for all orders. As we will see, this approach has some drawbacks and can be improved upon with an HD wallet.</p>
</div>
<div class="paragraph data-line-948">
<p>=== Detalhes da Tecnologia de Carteira</p>
</div>
<div class="paragraph data-line-950">
<p>Vamos agora examinar detalhadamente cada um dos importantes padr√µes da ind√∫stria usados por muitas carteiras de bitcoin.</p>
</div>
<div id="mnemonic_code_words" class="paragraph data-line-953">
<p>==== Palavras de C√≥digo Mnem√¥nico (BIP-39)</p>
</div>
<div class="paragraph data-line-955">
<p>As palavras de c√≥digo mnem√¥nico s√£o sequ√™ncias de palavras que representam (codificam) um n√∫mero aleat√≥rio que √© usado como uma semente para se derivar uma carteira determin√≠stica. A sequ√™ncia de palavras √© a √∫nica informa√ß√£o necess√°ria para se recriar a semente e, a partir dela, recriar a carteira e todas as suas chaves derivadas. Um aplicativo de carteira que usa carteiras determin√≠sticas com palavras mnem√¥nicas exibir√° ao usu√°rio uma sequ√™ncia de 12 a 24 palavras quando a carteira for criada pela primeira vez. Essa sequ√™ncia de palavras √© o backup da carteira e pode ser usada para recuperar e recriar todas as chaves no mesmo aplicativo ou em qualquer aplicativo de carteira compat√≠vel. As palavras mnem√¥nicas facilitam a cria√ß√£o de backups de carteiras pelos usu√°rios, pois elas s√£o f√°ceis de serem lidas e de serem corretamente transcritas, quando comparadas a uma sequ√™ncia de n√∫meros aleat√≥rios.</p>
</div>
<div class="admonitionblock tip data-line-958">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-959">
<p>As palavras mnem√¥nicas costumam ser confundidas com as "carteiras cerebrais" (em ingl√™s, <em>brainwallets</em>). Elas n√£o s√£o a mesma coisa. A principal diferen√ßa √© que uma carteira cerebral consiste em palavras que s√£o escolhidas pelo pr√≥prio usu√°rio, enquanto as palavras mnem√¥nicas s√£o criadas aleatoriamente pela carteira e depois s√£o apresentadas ao usu√°rio. Essa importante diferen√ßa torna as palavras mnem√¥nicas muito mais seguras, pois os humanos s√£o fontes muito pobres de aleatoriedade.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-962">
<p>Os c√≥digos mnem√¥nicos s√£o definidos na BIP-39 (consulte o <a href="#appdxbitcoinimpproposals">[appdxbitcoinimpproposals]</a>). Observe que a BIP-39 √© uma implementa√ß√£o de um padr√£o de c√≥digo mnem√¥nico. Existe tamb√©m um padr√£o diferente, com um conjunto diferente de palavras, usado pela carteira Electrum, mais antigo do que a BIP-39. O padr√£o BIP-39 foi proposto pela empresa respons√°vel pela carteira de hardware Trezor e n√£o √© compat√≠vel com a implementa√ß√£o da Electrum. No entanto, o padr√£o BIP-39 j√° obteve amplo suporte da ind√∫stria em dezenas de implementa√ß√µes interoper√°veis e, atualmente, deve ser considerado o padr√£o "oficial" da ind√∫stria.</p>
</div>
<div class="paragraph data-line-964">
<p>A BIP-39 define a cria√ß√£o de um c√≥digo mnem√¥nico e de uma semente, que descrevemos aqui em nove etapas. Para maior clareza, o processo √© dividido em duas partes: as etapas de 1 a 6 s√£o mostradas em <a href="#generating_mnemonic_words">[generating_mnemonic_words]</a> e as etapas de 7 a 9 s√£o mostradas em <a href="#mnemonic_to_seed">[mnemonic_to_seed]</a>.</p>
</div>
<div id="generating_mnemonic_words" class="paragraph data-line-967">
<p>===== Gerando palavras mnem√¥nicas</p>
</div>
<div class="paragraph data-line-969">
<p>As palavras mnem√¥nicas s√£o geradas automaticamente pela carteira usando o processo padronizado definido na BIP-39. A carteira come√ßa a partir de uma fonte de entropia, adiciona uma soma de verifica√ß√£o (um <em>checksum</em>) e ent√£o mapeia a entropia para uma lista de palavras:</p>
</div>
<div class="olist arabic data-line-971">
<ol class="arabic">
<li class="data-line-971">
<p>Cria uma sequ√™ncia aleat√≥ria (entropia) de 128 a 256 bits.</p>
</li>
<li class="data-line-972">
<p>Cria uma soma de verifica√ß√£o (<em>checksum</em>) da sequ√™ncia aleat√≥ria tomando os primeiros (comprimento da entropia/32) bits de seu hash SHA256.</p>
</li>
<li class="data-line-973">
<p>Adiciona a soma de verifica√ß√£o (<em>checksum</em>) no final da sequ√™ncia aleat√≥ria.</p>
</li>
<li class="data-line-974">
<p>Divide o resultado em segmentos com 11 bits de comprimento.</p>
</li>
<li class="data-line-975">
<p>Mapeia cada valor de 11 bits para uma palavra do dicion√°rio predefinido de 2.048 palavras.</p>
</li>
<li class="data-line-976">
<p>O c√≥digo mnem√¥nico √© a sequ√™ncia de palavras.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-978">
<p>A <a href="#generating_entropy_and_encoding">Gerando entropia e codificando como palavras mnem√¥nicas</a> mostra como a entropia √© usada para gerar palavras mnem√¥nicas.</p>
</div>
<div id="generating_entropy_and_encoding" class="imageblock smallerseventy data-line-983">
<div class="content">
<img src="images/mbc2_0506.png" alt="Generating entropy and encoding as mnemonic words">
</div>
<div class="title">Figure 28. Gerando entropia e codificando como palavras mnem√¥nicas</div>
</div>
<div class="paragraph data-line-985">
<p>A <a href="#table_4-5">C√≥digos mnem√¥nicos: entropia e comprimento da palavra</a> mostra a rela√ß√£o entre o tamanho dos dados de entropia e o comprimento em palavras dos c√≥digos mnem√¥nicos.</p>
</div>
<table id="table_4-5" class="tableblock frame-all grid-all stretch data-line-990">
<caption class="title">Table 10. C√≥digos mnem√¥nicos: entropia e comprimento da palavra</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Entropia (bits)</th>
<th class="tableblock halign-left valign-top"><em>Checksum</em> (bits)</th>
<th class="tableblock halign-left valign-top">Entropia <strong>+</strong> <em>checksum</em> (bits)</th>
<th class="tableblock halign-left valign-top">Comprimento do mnem√¥nico (palavras)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">132</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">160</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">165</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">192</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">198</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">18</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">224</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">231</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">21</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">264</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24</p></td>
</tr>
</tbody>
</table>
<div id="mnemonic_to_seed" class="paragraph data-line-1000">
<p>===== Do mnem√¥nico √† semente</p>
</div>
<div class="paragraph data-line-1002">
<p>As palavras mnem√¥nicas representam uma entropia com um comprimento de 128 a 256 bits. A entropia √© ent√£o usada para derivar uma semente mais longa (de 512 bits) atrav√©s do uso da fun√ß√£o de alongamento de chaves PBKDF2. A semente produzida √© ent√£o usada para construir uma carteira determin√≠stica e derivar suas chaves.</p>
</div>
<div class="paragraph data-line-1004">
<p>A fun√ß√£o de alongamento de chaves usa dois par√¢metros: o mnem√¥nico e um <em>sal</em> (em ingl√™s, <em>salt</em>). O prop√≥sito de um sal em uma fun√ß√£o de alongamento de chaves √© dificultar a constru√ß√£o de uma tabela de pesquisa (em ingl√™s, <em>lookup table</em>) que permita um ataque de for√ßa bruta. No padr√£o BIP-39, o sal tem outra finalidade&#x2014;ele permite a utiliza√ß√£o de uma frase de senha (em ingl√™s, <em>passphrase</em>) que serve como um fator de seguran√ßa adicional protegendo a semente, como descreveremos em mais detalhes em <a href="#mnemonic_passphrase">[mnemonic_passphrase]</a>.</p>
</div>
<div class="paragraph data-line-1006">
<p>O processo descrito nas etapas 7 a 9 √© a continua√ß√£o do processo descrito anteriormente em <a href="#generating_mnemonic_words">[generating_mnemonic_words]</a>:</p>
</div>
<ol start="7">
	<li>O primeiro par√¢metro para a fun√ß√£o de alongamento de chaves PBKDF2 √© o <em>mnem√¥nico</em> produzido na etapa 6.</li>
	<li>O segundo par√¢metro para a fun√ß√£o de alongamento de chaves PBKDF2 √© um <em>sal</em>. O sal √© composto pela _string_ constante "<code>mnemonic</code>" concatenada com uma _string_ opcional da frase de senha fornecida pelo usu√°rio.</li>
	<li>A PBKDF2 estende os par√¢metros mnem√¥nico e sal usando 2.048 rodadas de hash com o algoritmo HMAC-SHA512, produzindo um valor de 512 bits como sua sa√≠da final. Esse valor de 512 bits √© a semente.</li>
</ol>
<div class="paragraph data-line-1016">
<p>A <a href="#fig_5_7">Do mnem√¥nico √† semente</a> mostra como um mnem√¥nico √© usado para gerar uma semente.</p>
</div>
<div id="fig_5_7" class="imageblock data-line-1020">
<div class="content">
<img src="images/mbc2_0507.png" alt="From mnemonic to seed">
</div>
<div class="title">Figure 29. Do mnem√¥nico √† semente</div>
</div>
<div class="admonitionblock tip data-line-1023">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1024">
<p>A fun√ß√£o de alongamento de chaves, com suas 2.048 rodadas de <em>hashing</em>, √© uma prote√ß√£o muito eficaz contra ataques de for√ßa bruta contra o mnem√¥nico ou a frase de senha. Torna-se extremamente custoso (em termos de esfor√ßo computacional) tentar mais do que algumas milhares de frases de senha e combina√ß√µes mnem√¥nicas, visto que o n√∫mero poss√≠vel de sementes derivadas √© imenso (2<sup>512</sup>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1027">
<p>As Tabelas <a data-type="xref" href="#mnemonic_128_no_pass" data-xrefstyle="select: labelnumber">#mnemonic_128_no_pass</a>, <a data-type="xref" href="#mnemonic_128_w_pass" data-xrefstyle="select: labelnumber">#mnemonic_128_w_pass</a> e <a data-type="xref" href="#mnemonic_256_no_pass" data-xrefstyle="select: labelnumber">#mnemonic_256_no_pass</a> demonstram alguns exemplos de c√≥digos mnem√¥nicos e as sementes que eles produzem (com ou sem uma frase de senha).</p>
</div>
<table id="mnemonic_128_no_pass" class="tableblock frame-all grid-all stretch data-line-1032">
<caption class="title">Table 11. C√≥digo mnem√¥nico com entropia de 128 bits, sem frase de senha, e a semente resultante</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Input de entropia (128 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">0c1e24e5917779d297e14d45f14e1a1a</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Mnem√¥nico (12 palavras)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">army van defense carry jealous true garbage claim echo media make crunch</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Frase de senha</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">(nenhuma)</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Semente (512 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">5b56c417303faa3fcba7e57400e120a0ca83ec5a4fc9ffba757fbe63fbd77a89a1a3be4c67196f57c39
a88b76373733891bfaba16ed27a813ceed498804c0570</p></td>
</tr>
</tbody>
</table>
<table id="mnemonic_128_w_pass" class="tableblock frame-all grid-all stretch data-line-1043">
<caption class="title">Table 12. C√≥digo mnem√¥nico com entropia de 128 bits, com frase de senha, e a semente resultante</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Input de entropia (128 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">0c1e24e5917779d297e14d45f14e1a1a</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Mnem√¥nico (12 palavras)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">army van defense carry jealous true garbage claim echo media make crunch</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Frase de senha</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">SuperDuperSecret</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Semente (512 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">3b5df16df2157104cfdd22830162a5e170c0161653e3afe6c88defeefb0818c793dbb28ab3ab091897d0
715861dc8a18358f80b79d49acf64142ae57037d1d54</p></td>
</tr>
</tbody>
</table>
<table id="mnemonic_256_no_pass" class="tableblock frame-all grid-all stretch data-line-1055">
<caption class="title">Table 13. C√≥digo mnem√¥nico com entropia de 256 bits, sem frase de senha, e a semente resultante</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Input de entropia (256 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">2041546864449caff939d32d574753fe684d3c947c3346713dd8423e74abcf8c</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Mnem√¥nico (24 palavras)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">cake apple borrow silk endorse fitness top denial coil riot stay wolf
luggage oxygen faint major edit measure invite love trap field dilemma oblige</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Frase de senha</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">(nenhuma)</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Semente (512 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">3269bce2674acbd188d4f120072b13b088a0ecf87c6e4cae41657a0bb78f5315b33b3a04356e53d062e5
5f1e0deaa082df8d487381379df848a6ad7e98798404</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip data-line-1065">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1066">
<p>Many wallets do not allow for the creation of wallets with more than a 12 word mnemonic phrase. You will notice from the tables above that despite the unique lengths of entropy input, the seed size remains the same (512 bits). From a security perspective, the amount of entropy actually used for the production of HD wallets is roughly 128 bits, which equals 12 words.  Providing more than 12 words produces additional entropy which is unnecessary, and this <em>unused</em> entropy is not used for the derivation of the seed in the way that one might initially suspect. From a usability perspective, 12 words is also easier to write down, back up, and store.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="mnemonic_passphrase" class="paragraph data-line-1070">
<p>===== Frase de senha (<em>passphrase</em>) opcional no padr√£o BIP-39</p>
</div>
<div class="paragraph data-line-1072">
<p>O padr√£o BIP-39 permite o uso de uma frase de senha (<em>passphrase</em>) opcional na deriva√ß√£o da semente. Se nenhuma frase de senha for usada, o mnem√¥nico √© alongado com um sal que consiste na <em>string</em> constante "mnemonic", produzindo uma semente espec√≠fica de 512 bits a partir de qualquer mnem√¥nico fornecido. Se uma frase de senha for usada, a fun√ß√£o de alongamento produz uma semente <em>diferente</em> a partir desse mesmo mnem√¥nico. Ou seja, dado um √∫nico mnem√¥nico, cada frase de senha poss√≠vel gera uma semente diferente. Em outras palavras, n√£o existe uma frase de senha "errada". Todas as frases de senha s√£o v√°lidas e todas elas geram sementes diferentes, formando um imenso conjunto de poss√≠veis carteiras n√£o inicializadas. O n√∫mero de carteiras poss√≠veis √© t√£o grande (2<sup>512</sup>) que n√£o h√° a possibilidade pr√°tica de se utilizar for√ßa bruta ou de se adivinhar acidentalmente alguma semente que j√° esteja em uso.</p>
</div>
<div class="admonitionblock tip data-line-1075">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1076">
<p>N√£o h√° frases de senha "erradas" no padr√£o BIP-39. Cada frase de senha gera uma carteira, que, a menos que ela j√° tenha sido usada anteriormente, estar√° vazia.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1079">
<p>A frase de senha opcional cria dois recursos importantes:</p>
</div>
<div class="ulist data-line-1081">
<ul>
<li class="data-line-1081">
<p>Um segundo fator (algo memorizado) que torna um mnem√¥nico in√∫til quando obtido isoladamente, protegendo os backups de mnem√¥nicos de serem comprometidos por um ladr√£o.</p>
</li>
<li class="data-line-1083">
<p>Uma forma de nega√ß√£o plaus√≠vel ou "carteira de coa√ß√£o", quando se usa uma frase de senha para abrir uma carteira com uma pequena quantidade de fundos, a qual √© usada para distrair um criminoso da carteira "verdadeira", que cont√©m a maioria dos fundos.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1085">
<p>No entanto, √© importante observar que o uso de uma frase de senha tamb√©m introduz o risco de perda:</p>
</div>
<div class="ulist data-line-1087">
<ul>
<li class="data-line-1087">
<p>Se o dono da carteira ficar incapacitado ou vier a √≥bito e ningu√©m mais souber a frase de senha, o c√≥digo mnem√¥nico ser√° in√∫til, e todos os fundos armazenados na carteira ser√£o perdidos para sempre.</p>
</li>
<li class="data-line-1089">
<p>Al√©m disso, se o propriet√°rio fizer o backup da frase de senha no mesmo lugar que o backup do c√≥digo mnem√¥nico, isso anular√° o prop√≥sito de servir como um segundo fator.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1091">
<p>Embora as frases de senha sejam muito √∫teis, elas s√≥ devem ser usadas em combina√ß√£o com um processo cuidadosamente planejado para backup e recupera√ß√£o, que leve em considera√ß√£o a possibilidade de que o propriet√°rio venha a √≥bito no futuro, permitindo que sua fam√≠lia recupere as criptomoedas de heran√ßa.</p>
</div>
<div class="paragraph data-line-1093">
<p>===== Trabalhando com c√≥digos mnem√¥nicos</p>
</div>
<div class="paragraph data-line-1095">
<p>O padr√£o BIP-39 √© implementado como uma biblioteca em muitas linguagens de programa√ß√£o diferentes:</p>
</div>
<div class="dlist data-line-1097">
<dl>
<dt class="hdlist1"><a href="https://github.com/trezor/python-mnemonic" data-href="https://github.com/trezor/python-mnemonic">python-mnemonic</a></dt>
<dd>
<p>A implementa√ß√£o de refer√™ncia do padr√£o feita pela equipe da SatoshiLabs, que prop√¥s o padr√£o BIP-39, em Python</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/bitcoinjs/bip39" data-href="https://github.com/bitcoinjs/bip39">bitcoinjs/bip39</a></dt>
<dd>
<p>Uma implementa√ß√£o do padr√£o BIP-39, como parte do popular framework bitcoinJS, em JavaScript</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/libbitcoin/libbitcoin/blob/master/src/wallet/mnemonic.cpp" data-href="https://github.com/libbitcoin/libbitcoin/blob/master/src/wallet/mnemonic.cpp">libbitcoin/mnemonic</a></dt>
<dd>
<p>Uma implementa√ß√£o do padr√£o BIP-39, como parte do popular framework Libbitcoin, em <span class="keep-together">C++</span></p>
</dd>
</dl>
</div>
<div class="paragraph data-line-1103">
<p>==== Criando uma Carteira HD a partir da Semente</p>
</div>
<div class="paragraph data-line-1105">
<p>As carteiras HD s√£o criadas a partir de uma √∫nica <em>semente raiz</em>, que √© um n√∫mero aleat√≥rio de 128, 256 ou 512 bits. Mais comumente, essa semente √© gerada a partir de um <em>mnem√¥nico</em>, conforme detalhado na se√ß√£o anterior.</p>
</div>
<div class="paragraph data-line-1107">
<p>Cada chave na carteira HD √© derivada deterministicamente a partir dessa semente raiz, o que torna poss√≠vel recriar toda a carteira HD a partir dessa semente em qualquer carteira HD compat√≠vel. Isso torna mais f√°cil fazer backup, restaurar, exportar e importar carteiras HD contendo milhares ou at√© mesmo milh√µes de chaves, simplesmente transferindo apenas o mnem√¥nico a partir do qual a semente raiz √© derivada.</p>
</div>
<div class="paragraph data-line-1109">
<p>O processo de cria√ß√£o das chaves mestras e do c√≥digo de cadeia mestre para uma carteira HD √© demonstrado na <a href="#HDWalletFromSeed">Criando as chaves mestras e o c√≥digo de cadeia mestre a partir da semente raiz</a>.</p>
</div>
<div id="HDWalletFromSeed" class="imageblock data-line-1113">
<div class="content">
<img src="images/mbc2_0509.png" alt="HDWalletFromRootSeed">
</div>
<div class="title">Figure 30. Criando as chaves mestras e o c√≥digo de cadeia mestre a partir da semente raiz</div>
</div>
<div class="paragraph data-line-1115">
<p>A semente raiz √© usada como <em>input</em> no algoritmo HMAC-SHA512 e o hash resultante √© usado para criar uma <em>chave privada mestra</em> (m) e um <em>c√≥digo de cadeia mestre</em> (c).</p>
</div>
<div class="paragraph data-line-1117">
<p>A chave privada mestra (m) ent√£o gera uma chave p√∫blica mestra (M) correspondente usando o processo normal de multiplica√ß√£o de curva el√≠ptica m * G que vimos em <a href="#pubkey">[pubkey]</a>.</p>
</div>
<div class="paragraph data-line-1119">
<p>O c√≥digo de cadeia (c) √© usado para introduzir entropia na fun√ß√£o que cria chaves filhas a partir de chaves pais, como veremos na pr√≥xima se√ß√£o.</p>
</div>
<div class="paragraph data-line-1121">
<p>===== Deriva√ß√£o de chave privada filha</p>
</div>
<div class="paragraph data-line-1123">
<p>As carteiras HD usam uma fun√ß√£o de <em>deriva√ß√£o de chaves filhas</em> (em ingl√™s, <em>child key derivation</em> ou CKD) para derivar as chaves filhas a partir das chaves pais.</p>
</div>
<div class="paragraph data-line-1125">
<p>As fun√ß√µes de deriva√ß√£o de chaves filhas s√£o baseadas em uma fun√ß√£o de hash de sentido √∫nico, que combina:</p>
</div>
<div class="ulist data-line-1127">
<ul>
<li class="data-line-1127">
<p>Uma chave pai privada ou p√∫blica (chave ECDSA comprimida)</p>
</li>
<li class="data-line-1128">
<p>Uma semente chamada de c√≥digo de cadeia (256 bits)</p>
</li>
<li class="data-line-1129">
<p>Um n√∫mero √≠ndice (32 bits)</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1131">
<p>O c√≥digo de cadeia √© usado para introduzir dados aleat√≥rios determin√≠sticos ao processo, de forma que saber o √≠ndice e uma chave filha n√£o √© suficiente para se derivar outras chaves filhas. Saber uma chave filha n√£o torna algu√©m capaz de descobrir suas chaves irm√£s, a menos que a pessoa tamb√©m tenha o c√≥digo de cadeia. A semente inicial do c√≥digo de cadeia (na raiz da √°rvore) √© feita a partir da semente, enquanto os c√≥digos de cadeia filhos subsequentes s√£o derivados de cada c√≥digo de cadeia pai.</p>
</div>
<div class="paragraph data-line-1133">
<p>Esses tr√™s itens (a chave pai, o c√≥digo de cadeia e o √≠ndice) s√£o combinados e depois submetidos a uma fun√ß√£o de hash para gerar as chaves filhas, conforme abaixo descrito.</p>
</div>
<div class="paragraph data-line-1135">
<p>A chave p√∫blica pai, o c√≥digo de cadeia pai e o n√∫mero √≠ndice s√£o combinados e s√£o submetidos a uma fun√ß√£o de hash com o algoritmo HMAC-SHA512 para produzir um hash de 512 bits. Esse hash de 512 bits √© dividido em duas metades de 256 bits. Os 256 bits da metade direita do hash resultante tornam-se o c√≥digo de cadeia filho. Os 256 bits da metade esquerda do hash s√£o adicionados √† chave pai para produzir a chave privada filha. Na <a href="#CKDpriv">Estendendo uma chave privada pai para criar uma chave privada filha</a>, vemos isso ilustrado com o √≠ndice definido como 0 para produzir a chave privada filha "zero" (a primeira chave privada filha) da chave privada pai.</p>
</div>
<div id="CKDpriv" class="imageblock data-line-1139">
<div class="content">
<img src="images/mbc2_0510.png" alt="ChildPrivateDerivation">
</div>
<div class="title">Figure 31. Estendendo uma chave privada pai para criar uma chave privada filha</div>
</div>
<div class="paragraph data-line-1141">
<p>Mudar o √≠ndice nos permite estender a chave pai e criar as outras chaves filhas na sequ√™ncia, por exemplo, Filha 0, Filha 1, Filha 2, etc. Cada chave pai pode ter 2.147.483.647 (2<sup>31</sup>) chaves filhas (2<sup>31</sup> √© metade de todo o intervalo de 2<sup>32</sup> chaves que est√° dispon√≠vel, pois a outra metade √© reservada para um tipo especial de deriva√ß√£o, sobre a qual falaremos mais adiante neste cap√≠tulo).</p>
</div>
<div class="paragraph data-line-1143">
<p>Repetindo o processo em um n√≠vel abaixo da √°rvore, cada chave filha pode virar uma chave pai e criar suas pr√≥prias filhas, em um n√∫mero infinito de gera√ß√µes.</p>
</div>
<div class="paragraph data-line-1145">
<p>===== Usando as chaves filhas derivadas</p>
</div>
<div class="paragraph data-line-1147">
<p>As chaves privadas filhas s√£o indistingu√≠veis das chaves n√£o determin√≠sticas (aleat√≥rias). Como a fun√ß√£o de deriva√ß√£o √© uma fun√ß√£o de sentido √∫nico, a chave filha n√£o pode ser usada para se encontrar a chave pai. A chave filha tamb√©m n√£o pode ser usada para se encontrar chaves irm√£s. Se voc√™ tiver a n¬™ (en√©sima) filha, voc√™ n√£o ser√° capaz de encontrar as suas irm√£s, como a filha n&#x2013;1 ou a filha n + 1, ou quaisquer outras filhas que fa√ßam parte da sequ√™ncia. Apenas a chave pai e o c√≥digo de cadeia s√£o capazes de derivar todas as chaves filhas. Sem o c√≥digo de cadeia filho, a chave filha tamb√©m n√£o pode ser usada para derivar nenhuma chave neta. Voc√™ precisa ter ambos, tanto a chave privada filha quanto o c√≥digo de cadeia filho, para poder iniciar um novo ramo e derivar as chaves netas.</p>
</div>
<div class="paragraph data-line-1149">
<p>So what can the child private key be used for on its own? It can be used to make a public key and a Bitcoin address. Then, it can be used to sign transactions to spend anything paid to that address.</p>
</div>
<div class="admonitionblock tip data-line-1152">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1153">
<p>A child private key, the corresponding public key, and the Bitcoin address are all indistinguishable from keys and addresses created randomly. The fact that they are part of a sequence is not visible outside of the HD wallet function that created them. Once created, they operate exactly as "normal" keys.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1156">
<p>===== Chaves estendidas</p>
</div>
<div class="paragraph data-line-1158">
<p>Conforme vimos anteriormente, a fun√ß√£o de deriva√ß√£o de chaves pode ser usada para criar chaves filhas em qualquer n√≠vel da √°rvore, baseando-se em tr√™s entradas (inputs): uma chave, um c√≥digo de cadeia e o √≠ndice da filha desejada. Os dois ingredientes essenciais s√£o a chave e o c√≥digo de cadeia, que combinados s√£o chamados de <em>chave estendida</em>. O termo "chave estendida" tamb√©m poderia ser considerado como "chave extens√≠vel", pois esse tipo de chave pode ser usado para derivar chaves filhas.</p>
</div>
<div class="paragraph data-line-1160">
<p>As chaves estendidas s√£o armazenadas e representadas como uma simples concatena√ß√£o da chave de 256 bits e do c√≥digo de cadeia de 256 bits em uma sequ√™ncia de 512 bits. Existem dois tipos de chaves estendidas. Uma chave privada estendida √© a combina√ß√£o de uma chave privada com um c√≥digo de cadeia, e pode ser usada para derivar chaves privadas filhas (e, a partir delas, chaves p√∫blicas filhas). Uma chave p√∫blica estendida √© a combina√ß√£o de uma chave p√∫blica com um c√≥digo de cadeia, e pode ser usada para criar chaves p√∫blicas filhas (<em>somente chaves p√∫blicas</em>), conforme descrito em <a href="#public_key_derivation">[public_key_derivation]</a>.</p>
</div>
<div class="paragraph data-line-1162">
<p>Imagine uma chave estendida como se fosse a raiz de um ramo na estrutura em forma de √°rvore da carteira HD. Tendo a raiz do ramo, voc√™ pode derivar o resto do ramo. A chave privada estendida pode criar um ramo completo, ao passo que a chave p√∫blica estendida pode criar um ramo que tenha <em>apenas</em> chaves p√∫blicas.</p>
</div>
<div class="admonitionblock tip data-line-1165">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1166">
<p>Uma chave estendida consiste em uma chave privada ou p√∫blica e um c√≥digo de cadeia. Uma chave estendida pode criar chaves filhas, gerando o seu pr√≥prio ramo na estrutura em forma de √°rvore. Compartilhar uma chave estendida d√° acesso a todo o ramo.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1169">
<p>As chaves estendidas s√£o codificadas usando Base58Check, para facilitar a exporta√ß√£o e a importa√ß√£o entre diferentes carteiras compat√≠veis com a BIP-32. A codifica√ß√£o Base58Check para as chaves estendidas usa um n√∫mero de vers√£o especial que resulta nos prefixos "xprv" e "xpub" quando codificado em caracteres Base58, fazendo com que as chaves sejam mais facilmente reconhec√≠veis. Como a chave estendida tem 512 ou 513 bits, ela √© muito mais longa do que qualquer uma das <em>strings</em> codificadas em Base58Check que vimos anteriormente.</p>
</div>
<div class="paragraph data-line-1171">
<p>Esse √© um exemplo de uma chave <em>privada</em> estendida, codificada em Base58Check:</p>
</div>
<div class="listingblock data-line-1173">
<div class="content">
<pre>xprv9tyUQV64JT5qs3RSTJkXCWKMyUgoQp7F3hA1xzG6ZGu6u6Q9VMNjGr67Lctvy5P8oyaYAL9CAWrUE9i6GoNMKUga5biW6Hx4tws2six3b9c</pre>
</div>
</div>
<div class="paragraph data-line-1177">
<p>Essa √© a chave <em>p√∫blica</em> estendida correspondente, codificada em Base58Check:</p>
</div>
<div class="listingblock data-line-1179">
<div class="content">
<pre>xpub67xpozcx8pe95XVuZLHXZeG6XWXHpGq6Qv5cmNfi7cS5mtjJ2tgypeQbBs2UAR6KECeeMVKZBPLrtJunSDMstweyLXhRgPxdp14sk9tJPW9</pre>
</div>
</div>
<div id="public__child_key_derivation" class="paragraph data-line-1184">
<p>===== Deriva√ß√£o de chave p√∫blica filha</p>
</div>
<div class="paragraph data-line-1186">
<p>Como mencionado anteriormente, uma caracter√≠stica muito √∫til das carteiras HD √© a capacidade de derivar chaves p√∫blicas filhas a partir de chaves p√∫blicas pais, <em>sem</em> a necessidade das chaves privadas. Isso nos fornece duas maneiras de derivar uma chave p√∫blica filha: a partir da chave privada filha, ou diretamente a partir da chave p√∫blica pai.</p>
</div>
<div class="paragraph data-line-1188">
<p>Portanto, uma chave p√∫blica estendida pode ser usada para derivar todas as chaves <em>p√∫blicas</em> (e somente as chaves p√∫blicas) naquele ramo da estrutura da carteira HD.</p>
</div>
<div class="paragraph data-line-1190">
<p>This shortcut can be used to create very secure public key&#x2013;only deployments where a server or application has a copy of an extended public key and no private keys whatsoever. That kind of deployment can produce an infinite number of public keys and Bitcoin addresses, but cannot spend any of the money sent to those addresses. Meanwhile, on another, more secure server, the extended private key can derive all the corresponding private keys to sign transactions and spend the money.</p>
</div>
<div class="paragraph data-line-1192">
<p>One common application of this solution is to install an extended public key on a web server that serves an ecommerce application. The web server can use the public key derivation function to create a new Bitcoin address for every transaction (e.g., for a customer shopping cart). The web server will not have any private keys that would be vulnerable to theft. Without HD wallets, the only way to do this is to generate thousands of Bitcoin addresses on a separate secure server and then preload them on the ecommerce server. That approach is cumbersome and requires constant maintenance to ensure that the ecommerce server doesn&#8217;t "run out" of addresses.</p>
</div>
<div class="paragraph data-line-1194">
<p>Another common application of this solution is for cold-storage or hardware wallets. In that scenario, the extended private key can be stored on a paper wallet or hardware device (such as a Trezor hardware wallet), while the extended public key can be kept online. The user can create "receive" addresses at will, while the private keys are safely stored offline. To spend the funds, the user can use the extended private key on an offline signing Bitcoin client or sign transactions on the hardware wallet device (e.g., Trezor). <a href="#CKDpub">Estendendo uma chave p√∫blica pai para criar uma chave p√∫blica filha</a> illustrates the mechanism for extending a parent public key to derive child public keys.</p>
</div>
<div id="CKDpub" class="imageblock data-line-1198">
<div class="content">
<img src="images/mbc2_0511.png" alt="ChildPublicDerivation">
</div>
<div class="title">Figure 32. Estendendo uma chave p√∫blica pai para criar uma chave p√∫blica filha</div>
</div>
<div class="paragraph data-line-1200">
<p>===== Deriva√ß√£o endurecida da chave filha</p>
</div>
<div class="paragraph data-line-1202">
<p>A habilidade de derivar um ramo de chaves p√∫blicas a partir de uma xpub √© muito √∫til, mas isso traz um risco em potencial. Ter acesso a uma xpub n√£o d√° acesso √†s chaves privadas filhas. No entanto, como a xpub cont√©m o c√≥digo de cadeia, se uma chave privada filha for descoberta ou vazar de alguma maneira, ela pode ser usada com o c√≥digo de cadeia para derivar todas as outras chaves privadas filhas. Ou seja, basta que uma √∫nica chave privada filha vaze junto com um c√≥digo de cadeia pai, para que todas chaves privadas de todas as chaves filhas sejam reveladas. Ou, pior ainda, a chave privada filha pode ser usada junto com um c√≥digo de cadeia pai para deduzir a chave privada pai.</p>
</div>
<div class="paragraph data-line-1204">
<p>Para evitar esse risco, as carteiras HD usam uma fun√ß√£o de deriva√ß√£o alternativa chamada <em>deriva√ß√£o endurecida</em> (em ingl√™s, <em>hardened derivation</em>), que "desfaz" a rela√ß√£o entre a chave p√∫blica pai e o c√≥digo de cadeia filho. A fun√ß√£o de deriva√ß√£o endurecida usa a chave privada pai para derivar o c√≥digo de cadeia filho, em vez de usar a chave p√∫blica pai. Isso cria um "firewall" na sequ√™ncia pai/filho, com um c√≥digo de cadeia que n√£o pode ser usado para comprometer uma chave privada pai ou irm√£. A fun√ß√£o de deriva√ß√£o endurecida parece quase id√™ntica √† deriva√ß√£o normal de chave privada filha, com a exce√ß√£o de que a chave privada pai √© usada como input da fun√ß√£o de hash, ao inv√©s da chave p√∫blica pai, como demonstrado no diagrama da <a href="#CKDprime">Deriva√ß√£o endurecida de uma chave filha; a chave p√∫blica pai √© omitida</a>.</p>
</div>
<div id="CKDprime" class="imageblock data-line-1208">
<div class="content">
<img src="images/mbc2_0513.png" alt="ChildHardPrivateDerivation">
</div>
<div class="title">Figure 33. Deriva√ß√£o endurecida de uma chave filha; a chave p√∫blica pai √© omitida</div>
</div>
<div class="paragraph pagebreak-before data-line-1211">
<p>Quando a fun√ß√£o de deriva√ß√£o endurecida √© utilizada, a chave privada filha e o c√≥digo de cadeia filho resultantes s√£o completamente diferentes do que resultariam a partir de uma fun√ß√£o de deriva√ß√£o normal. O "ramo" de chaves resultante pode ser usado para produzir chaves p√∫blicas estendidas que n√£o s√£o vulner√°veis, pois o c√≥digo de cadeia que elas cont√™m, mesmo se for descoberto, n√£o ser√° capaz de revelar nenhuma das chaves privadas. A deriva√ß√£o endurecida √© portanto usada para criar uma lacuna na √°rvore, localizada acima do n√≠vel onde as chaves p√∫blicas estendidas s√£o usadas.</p>
</div>
<div class="paragraph data-line-1213">
<p>Em termos simples, se voc√™ quer usar a conveni√™ncia de uma xpub para derivar ramos de chaves p√∫blicas, sem se expor ao risco de vazar um c√≥digo de cadeia, voc√™ deveria derivar o ramo a partir de uma chave pai endurecida, ao inv√©s de uma chave pai normal (n√£o endurecida). Como pr√°tica recomendada, as chaves filhas do n√≠vel 1 das chaves mestras s√£o sempre derivadas por meio da deriva√ß√£o endurecida, para evitar o comprometimento das chaves mestras.</p>
</div>
<div class="paragraph data-line-1215">
<p>===== N√∫meros √≠ndice para a deriva√ß√£o normal e a endurecida</p>
</div>
<div class="paragraph data-line-1217">
<p>O n√∫mero √≠ndice usado na fun√ß√£o de deriva√ß√£o √© um n√∫mero inteiro de 32 bits. Para facilitar a diferencia√ß√£o entre as chaves derivadas pela fun√ß√£o de deriva√ß√£o normal e as chaves derivadas pela fun√ß√£o de deriva√ß√£o endurecida, esse n√∫mero √≠ndice √© dividido em dois intervalos. Os n√∫meros √≠ndice entre 0 e 2<sup>31</sup>&#x2013;1 (0x0 a 0x7FFFFFFF) s√£o usados <em>apenas</em> para a deriva√ß√£o normal. Os n√∫meros √≠ndice entre 2<sup>31</sup> e 2<sup>32</sup>&#x2013;1 (0x80000000 a 0xFFFFFFFF) s√£o usados <em>apenas</em> para a deriva√ß√£o endurecida. Portanto, se o n√∫mero √≠ndice for menor do que 2<sup>31</sup>, isso significa que a chave filha √© normal, enquanto se o n√∫mero √≠ndice for maior ou igual a 2<sup>31</sup>, isso significa que a chave filha √© endurecida.</p>
</div>
<div class="paragraph data-line-1219">
<p>Para tornar o n√∫mero √≠ndice mais f√°cil de ser lido e exibido, o n√∫mero √≠ndice para as chaves filhas endurecidas √© exibido iniciando do zero, mas com um ap√≥strofo. A primeira chave filha normal √© portanto exibida como 0, enquanto a primeira chave filha endurecida (√≠ndice 0x80000000) √© exibida como 0&amp;#x27;. Na sequ√™ncia, a segunda chave endurecida teria o √≠ndice 0x80000001 e seria exibida como 1&amp;#x27;, e assim por diante. Quando voc√™ se deparar com um √≠ndice de carteira HD i&amp;#x27;, isso significa 2<sup>31</sup>+i.</p>
</div>
<div class="paragraph data-line-1221">
<p>===== Identificador (caminho) de chave de carteira HD</p>
</div>
<div class="paragraph data-line-1223">
<p>As chaves em uma carteira HD s√£o identificadas a partir de uma conven√ß√£o de nomenclatura de "caminho", com cada n√≠vel da √°rvore sendo separado por uma barra (/) (ver a <a href="#table_4-8">Exemplos de caminhos de carteira HD</a>). As chaves privadas derivadas a partir da chave privada mestra iniciam com "m". As chaves p√∫blicas derivadas a partir da chave p√∫blica mestra iniciam com "M". Portanto, a primeira chave privada filha da chave privada mestra √© m/0. A primeira chave p√∫blica filha √© M/0. A segunda neta da primeira filha √© m/0/1, e assim por diante.</p>
</div>
<div class="paragraph data-line-1225">
<p>Os "antepassados" de uma chave s√£o lidos da direita para a esquerda, at√© voc√™ chegar na chave mestra a partir da qual eles foram derivados. Por exemplo, o identificador m/x/y/z descreve a chave privada que √© a z¬™ filha da chave privada pai m/x/y, que √© a y¬™ filha da chave privada pai m/x, que √© a x¬™ filha da chave privada pai mestra m.</p>
</div>
<table id="table_4-8" class="tableblock frame-all grid-all stretch data-line-1230">
<caption class="title">Table 14. Exemplos de caminhos de carteira HD</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Caminho HD</th>
<th class="tableblock halign-left valign-top">Chave descrita</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A primeira (0) chave privada filha da chave privada mestra (m)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m/0/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A primeira (0) chave privada filha da primeira filha (m/0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m/0'/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A primeira (0) filha normal da primeira filha <em>endurecida</em> (m/0')</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m/1/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A primeira (0) chave privada filha da segunda filha (m/1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M/23/17/0/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A primeira (0) chave p√∫blica filha da primeira filha (M/23/17/0) da 18¬™ filha (M/23/17) da 24¬™ filha (M/23)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-1239">
<p>===== Navegando a estrutura em forma de √°rvore da carteira HD</p>
</div>
<div class="paragraph data-line-1241">
<p>A estrutura em forma de √°rvore da carteira HD oferece uma enorme flexibilidade. Cada chave estendida pai pode ter quatro bilh√µes de chaves filhas: dois bilh√µes de chaves filhas normais e dois bilh√µes de chaves filhas endurecidas. Cada uma dessas chaves filhas pode ter outras quatro bilh√µes de chaves filhas, e assim por diante. A √°rvore pode ter a profundidade que for necess√°ria, com um n√∫mero infinito de gera√ß√µes. No entanto, com toda essa flexibilidade, torna-se bastante dif√≠cil navegar nessa √°rvore infinita. √â especialmente dif√≠cil transferir carteiras HD entre diferentes implementa√ß√µes, pois as possibilidades de organiza√ß√£o interna em ramos e subramos s√£o infinitas.</p>
</div>
<div class="paragraph data-line-1243">
<p>Duas BIPs oferecem uma solu√ß√£o para essa complexidade, ao criar alguns padr√µes propostos para a estrutura das √°rvores das carteiras HD. A BIP-43 prop√µe o uso do √≠ndice da primeira filha endurecida como um identificador especial que representa o "prop√≥sito" da estrutura em forma de √°rvore. Baseando-se na BIP-43, uma carteira HD deveria usar apenas um ramo de n√≠vel 1 da √°rvore, com o n√∫mero √≠ndice identificando a estrutura e o espa√ßo de nomes do resto da √°rvore ao definir o seu prop√≥sito. Por exemplo, uma carteira HD usando apenas o ramo m/i&amp;#x27;/ se destina a um prop√≥sito espec√≠fico, e esse prop√≥sito √© identificado pelo n√∫mero √≠ndice "i".</p>
</div>
<div class="paragraph data-line-1245">
<p>Estendendo essa especifica√ß√£o, a BIP-44 prop√µe uma estrutura multiconta como n√∫mero de "prop√≥sito" 44' sob a BIP-43. Todas as carteiras HD que seguem a estrutura BIP-44 s√£o identificadas pelo fato de usarem apenas um ramo da √°rvore: m/44'/.</p>
</div>
<div class="paragraph data-line-1247">
<p>A BIP-44 especifica a estrutura como consistindo em cinco n√≠veis de √°rvore predefinidos:</p>
</div>
<div class="listingblock data-line-1249">
<div class="content">
<pre>m / purpose' / coin_type' / account' / change / address_index</pre>
</div>
</div>
<div class="paragraph data-line-1253">
<p>O primeiro n√≠vel, "purpose" (prop√≥sito) √© sempre definido como 44'. O segundo n√≠vel, "coin_type" especifica o tipo da criptomoeda, permitindo a exist√™ncia de carteiras HD com suporte a m√∫ltiplas moedas, onde cada moeda possui a sua pr√≥pria sub√°rvore sob o segundo n√≠vel. Existem tr√™s moedas definidas at√© o momento: o Bitcoin √© m/44'/0', a Testnet do Bitcoin √© m/44&amp;#x27;/1&amp;#x27; e a Litecoin √© m/44&amp;#x27;/2&amp;#x27;.</p>
</div>
<div class="paragraph data-line-1255">
<p>O terceiro n√≠vel da √°rvore √© o "account" (conta), que permite que os usu√°rios subdividam suas carteiras em subcontas separadas de maneira l√≥gica, para fins de contabilidade e organiza√ß√£o. Por exemplo, uma carteira HD pode conter duas "contas" de bitcoin: m/44&amp;#x27;/0&amp;#x27;/0&amp;#x27; e m/44&amp;#x27;/0&amp;#x27;/1&amp;#x27;. Cada conta √© a raiz de sua pr√≥pria sub√°rvore.</p>
</div>
<div class="paragraph data-line-1257">
<p>No quarto n√≠vel, "change" (troco), uma carteira HD tem duas sub√°rvores, uma para criar endere√ßos de recebimento e outra para criar endere√ßos de troco. Note que enquanto os n√≠veis anteriores usavam deriva√ß√£o endurecida, este n√≠vel usa deriva√ß√£o normal. Isso permite que este n√≠vel da √°rvore exporte chaves p√∫blicas estendidas para uso em um ambiente n√£o seguro. Os endere√ßos utiliz√°veis s√£o derivados pela carteira HD como filhos do quarto n√≠vel, e o quinto n√≠vel da √°rvore, o "address_index", √© usado para o √≠ndice do endere√ßo. Por exemplo, o terceiro endere√ßo de recebimento para pagamentos de bitcoin na conta principal seria M/44&amp;#x27;/0&amp;#x27;/0&amp;#x27;/0/2. A <a href="#table_4-9">Exemplos de estrutura de carteira HD da BIP-44</a> mostra mais alguns exemplos.</p>
</div>
<table id="table_4-9" class="tableblock frame-all grid-all stretch data-line-1262">
<caption class="title">Table 15. Exemplos de estrutura de carteira HD da BIP-44</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Caminho HD</th>
<th class="tableblock halign-left valign-top">Chave descrita</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M/44&amp;#x27;/0&amp;#x27;/0&amp;#x27;/0/2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A terceira chave p√∫blica para endere√ßo de recebimento da primeira conta de bitcoin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M/44&amp;#x27;/0&amp;#x27;/3&amp;#x27;/1/14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A d√©cima quinta chave p√∫blica para endere√ßo de troco da quarta conta de bitcoin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m/44&amp;#x27;/2&amp;#x27;/0&amp;#x27;/0/1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A segunda chave privada na conta principal de Litecoin, usada para assinar transa√ß√µes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-1269">
<p>==== Usando uma Chave P√∫blica Estendida em uma Loja Virtual</p>
</div>
<div class="paragraph data-line-1271">
<p>Para vermos como as carteiras HD s√£o usadas, vamos continuar a nossa hist√≥ria da loja virtual do Gabriel.</p>
</div>
<div class="paragraph data-line-1273">
<p>Gabriel first set up his web store as a hobby, based on a simple hosted Wordpress page. His store was quite basic with only a few pages and an order form with a single Bitcoin address.</p>
</div>
<div class="paragraph data-line-1275">
<p>Gabriel used the first Bitcoin address generated by his Trezor device as the main Bitcoin address for his store. This way, all incoming payments would be paid to an address controlled by his Trezor hardware wallet.</p>
</div>
<div class="paragraph data-line-1277">
<p>Customers would submit an order using the form and send payment to Gabriel&#8217;s published Bitcoin address, triggering an email with the order details for Gabriel to process. With just a few orders each week, this system worked well enough.</p>
</div>
<div class="paragraph data-line-1279">
<p>No entanto, a pequena loja virtual fez muito sucesso e acabou recebendo muitos pedidos da comunidade local. Em pouco tempo, Gabriel ficou sobrecarregado. Com todos os pedidos pagando no mesmo endere√ßo, tornou-se dif√≠cil combinar corretamente os pedidos e as transa√ß√µes, especialmente quando v√°rios pedidos de mesmo valor eram realizados em um curto intervalo de tempo.</p>
</div>
<div class="paragraph data-line-1281">
<p>A carteira HD do Gabriel oferece uma solu√ß√£o muito melhor, pois ela √© capaz de derivar chaves p√∫blicas filhas sem conhecer as chaves privadas. Gabriel pode colocar uma chave p√∫blica estendida (xpub) em seu site, que pode ser usada para derivar um endere√ßo √∫nico para cada pedido de cliente. Gabriel pode gastar o dinheiro de sua Trezor, mas a xpub carregada no site s√≥ √© capaz de gerar endere√ßos e receber fundos. Este recurso das carteiras HD √© um √≥timo recurso de seguran√ßa. Por n√£o conter nenhuma chave privada, o site do Gabriel n√£o precisa de altos n√≠veis de seguran√ßa.</p>
</div>
<div class="paragraph data-line-1283">
<p>To export the xpub, Gabriel uses the Trezor Suite desktop app in conjunction with the Trezor hardware wallet. The Trezor device must be plugged in for the public keys to be exported. Note that hardware wallets will never export private keys&#x2014;those always remain on the device. <a href="#export_xpub">Exportando uma xpub de uma carteira de hardware Trezor</a> shows what Gabriel sees in Trezor Suite when exporting the xpub.</p>
</div>
<div id="export_xpub" class="imageblock data-line-1287">
<div class="content">
<img src="images/mbc2_0512.png" alt="Exporting the xpub from the Trezor">
</div>
<div class="title">Figure 34. Exportando uma xpub de uma carteira de hardware Trezor</div>
</div>
<div class="paragraph data-line-1289">
<p>Gabriel copia a xpub para o software de pagamento de bitcoin de sua loja online. Ele usa o <em>BTCPay Server</em>, que √© uma plataforma de loja virtual de c√≥digo aberto dispon√≠vel para v√°rios tipos de hospedagem e plataformas de conte√∫do. O <em>BTCPay Server</em> usa a xpub para gerar um endere√ßo √∫nico para cada compra. </p>
</div>
<div class="paragraph data-line-1291">
<p>===== Importa√ß√£o e Gerenciamento de Contas</p>
</div>
<div class="paragraph data-line-1293">
<p>Gabriel&#8217;s business is flourishing. He has provided his extended public key (xpub) to <em>BTCPay Server</em>, which is generating unique addresses for customers to his website. Every time a customer to Gabriel&#8217;s website clicks on the "Checkout" button with a specified payment modality (in this case, bitcoin), <em>BTCPay Server</em> generates a new address for that customer.  More specifically, <em>BTCPay Server</em> iterates on the <em>address_index</em> tree to create a new address to display to the customer, as defined by BIP-44. If the customer decides to switch payment methods or abandon the transaction entirely, this Bitcoin address goes unused and will not be used for another customer right away.</p>
</div>
<div class="paragraph data-line-1295">
<p>Em um determinado momento, o site de Gabriel pode ter um grande volume de endere√ßos pendentes para clientes que estejam fazendo compras, alguns dos quais podem ficar inutilizados e, eventualmente, expirar. Assim que esses endere√ßos expirarem, o <em>BTCPay Server</em> voltar√° a reutilizar esses endere√ßos para preencher a lacuna na <em>address_index</em>, mas nosso exemplo demonstra como podem surgir lacunas entre as folhas da √°rvore determin√≠stica hier√°rquica, que √© onde o dinheiro realmente est√° localizado.</p>
</div>
<div class="paragraph data-line-1297">
<p>Digamos que o Gabriel esteja interessado em ver a sua quantia total de bitcoins recebidos em uma carteira somente-leitura (uma carteira que permite que voc√™ visualize o hist√≥rico de transa√ß√µes, mas n√£o permite que voc√™ gaste os fundos) separada do servidor <em>BTCPay</em>, mas que tamb√©m est√° em conformidade com o padr√£o BIP-44. Como essa carteira separada deve proceder para procurar fundos nesta vasta √°rvore hier√°rquica, e quando ela deve parar de procurar? A maioria das carteiras seguir√° um processo iterativo que utiliza um limite predefinido, o <em>limite de lacuna</em> (em ingl√™s, <em>gap limit</em>). Se, enquanto estiver procurando por endere√ßos usados, a carteira n√£o encontrar endere√ßos usados consecutivamente al√©m desse n√∫mero limite, ela parar√° de pesquisar a cadeia de endere√ßos. O limite de lacuna padr√£o √© normalmente definido como 20. Esse processo √© detalhado na <a id="bip-44"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki">BIP-44</a>.</p>
</div>
<div class="admonitionblock tip data-line-1300">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1301">
<p>Os limites de gap explicam o fen√¥meno pelo qual a importa√ß√£o de uma carteira pode apresentar um saldo incorreto ou zero. Os fundos n√£o s√£o perdidos, mas, a fun√ß√£o de importa√ß√£o de carteira, neste caso, n√£o percorreu o suficiente para detectar totalmente os fundos. Muitas carteiras permitem que esse limite de lacuna padr√£o seja alterado, e Gabriel pode precisar aumentar esse limite para permitir que sua carteira importe totalmente seu hist√≥rico de transa√ß√µes.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="transactions" class="paragraph data-line-1306">
<p>== Transa√ß√µes</p>
</div>
<div id="ch06_intro" class="paragraph data-line-1309">
<p>=== Introdu√ß√£o</p>
</div>
<div class="paragraph data-line-1311">
<p>Transactions are the most important part of the Bitcoin system. Everything else in bitcoin is designed to ensure that transactions can be created, propagated on the network, validated, and finally added to the global ledger of transactions (the blockchain). Transactions are data structures that encode the transfer of value between participants in the Bitcoin system. Each transaction is a public entry in bitcoin&#8217;s blockchain, the global double-entry bookkeeping ledger.</p>
</div>
<div class="paragraph data-line-1313">
<p>Neste cap√≠tulo, examinaremos as v√°rias formas de transa√ß√µes, o que elas cont√™m, como cri√°-las, como elas s√£o verificadas e como elas se tornam parte do registro permanente de todas as transa√ß√µes. Quando usamos o termo "carteira" neste cap√≠tulo, estamos nos referindo ao software que constr√≥i transa√ß√µes, e n√£o apenas ao banco de dados de chaves.</p>
</div>
<div id="tx_structure" class="paragraph data-line-1316">
<p>=== Transa√ß√µes em Detalhe</p>
</div>
<div class="paragraph data-line-1318">
<p>No <a href="#ch02_bitcoin_overview">[ch02_bitcoin_overview]</a>, analisamos a transa√ß√£o que a Alice usou para pagar pelo caf√© na cafeteria do Bob usando um explorador de blocos (<a href="#alices_transactions_to_bobs_cafe">Transa√ß√£o da Alice para a Cafeteria do Bob</a>).</p>
</div>
<div class="paragraph data-line-1320">
<p>O explorador de blocos mostra uma transa√ß√£o do "endere√ßo" da Alice para o "endere√ßo" do Bob. Esta √© uma vis√£o muito simplificada do que est√° contido em uma transa√ß√£o. Na verdade, como veremos neste cap√≠tulo, muitas das informa√ß√µes mostradas s√£o constru√≠das pelo explorador de blocos e n√£o est√£o realmente na transa√ß√£o.</p>
</div>
<div id="alices_transactions_to_bobs_cafe" class="imageblock data-line-1324">
<div class="content">
<img src="images/mbc2_0208.png" alt="Alice Coffee Transaction">
</div>
<div class="title">Figure 35. Transa√ß√£o da Alice para a Cafeteria do Bob</div>
</div>
<div id="transactions_behind_the_scenes" class="paragraph data-line-1327">
<p>==== Transa√ß√µes&#x2014;Nos Bastidores</p>
</div>
<div class="paragraph data-line-1329">
<p>Behind the scenes, an actual transaction looks very different from a transaction provided by a typical block explorer. In fact, most of the high-level constructs we see in the various bitcoin application user interfaces <em>do not actually exist</em> in the Bitcoin system.</p>
</div>
<div class="paragraph data-line-1331">
<p>Podemos usar a interface de linha de comando do Bitcoin Core (getrawtransaction e decoderawtransaction) para recuperar a transa√ß√£o "bruta" da Alice, decodific√°-la e ver o que ela cont√©m. O resultado √© o seguinte:</p>
</div>
<div id="alice_tx" class="listingblock data-line-1336">
<div class="title">Transa√ß√£o da Alice decodificada</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "version": 1,
  "locktime": 0,
  "vin": [
    {
      "txid": "7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18",
      "vout": 0,
      "scriptSig" : "3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813[ALL] 0484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adf",
      "sequence": 4294967295
    }
  ],
  "vout": [
    {
      "value": 0.01500000,
      "scriptPubKey": "OP_DUP OP_HASH160 ab68025513c3dbd2f7b92a94e0581f5d50f654e7 OP_EQUALVERIFY OP_CHECKSIG"
    },
    {
      "value": 0.08450000,
      "scriptPubKey": "OP_DUP OP_HASH160 7f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a8 OP_EQUALVERIFY OP_CHECKSIG",
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph data-line-1361">
<p>Voc√™ pode notar algumas coisas sobre esta transa√ß√£o, principalmente as coisas que est√£o faltando! Onde est√° o endere√ßo da Alice? Onde est√° o endere√ßo do Bob? Onde est√° a entrada de 0.1 "enviada" pela Alice? No bitcoin n√£o h√° moedas, nem remetentes, nem destinat√°rios, nem saldos, nem contas, nem endere√ßos. Todas essas coisas s√£o constru√≠das em um n√≠vel superior para o benef√≠cio do usu√°rio, para tornar as coisas mais f√°ceis de serem entendidas.</p>
</div>
<div class="paragraph data-line-1363">
<p>Voc√™ tamb√©m pode notar muitos campos estranhos e indecifr√°veis, assim como <em>strings</em> hexadecimais. N√£o se preocupe, explicaremos cada campo mostrado aqui em detalhes neste cap√≠tulo.</p>
</div>
<div id="tx_inputs_outputs" class="paragraph data-line-1366">
<p>=== Sa√≠das e Entradas de Transa√ß√£o</p>
</div>
<div class="paragraph data-line-1368">
<p>O que d√° origem a uma transa√ß√£o de bitcoin √© uma <em>sa√≠da de transa√ß√£o</em>. As sa√≠das de transa√ß√£o (em ingl√™s, <em>transaction outputs</em>) s√£o partes indivis√≠veis da moeda bitcoin, registradas na blockchain e reconhecidas como v√°lidas por toda a rede. Os n√≥s completos do bitcoin rastreiam todas as sa√≠das que est√£o dispon√≠veis e podem ser gastas, conhecidas como <em>sa√≠das de transa√ß√£o n√£o gastas</em> (em ingl√™s,  <em>unspent transaction outputs</em> ou UTXOs). A cole√ß√£o de todas as UTXOs √© conhecida como o <em>conjunto UTXO</em> e atualmente est√° na casa das milh√µes de UTXOs. O conjunto UTXO cresce quando uma nova UTXO √© criada e diminui quando uma UTXO √© consumida. Cada transa√ß√£o representa uma mudan√ßa (transi√ß√£o de estado) no conjunto UTXO.</p>
</div>
<div class="paragraph data-line-1370">
<p>Quando dizemos que a carteira de um usu√°rio "recebeu" bitcoin, o que queremos dizer √© que a carteira detectou na blockchain um UTXO que pode ser gasto com uma das chaves controladas por essa carteira. Assim, o "saldo" de bitcoin de um usu√°rio √© a soma de todo o UTXO que a carteira do usu√°rio pode gastar e que pode estar espalhado entre centenas de transa√ß√µes e em centenas de blocos. O conceito de saldo √© criado pela aplica√ß√£o da carteira. A carteira calcula o saldo do usu√°rio escaneando a blockchain e agregando o valor de qualquer UTXO que a carteira possa gastar com as chaves que ela controla. A maioria das carteiras mant√©m um banco de dados ou usa um servi√ßo de banco de dados para armazenar um conjunto de refer√™ncia r√°pida de todo o UTXO que podem gastar com as chaves que controlam.</p>
</div>
<div class="paragraph data-line-1372">
<p><a href="#utxo-stxo">Cadeia de transa√ß√µes entre Joe e Gopesh sendo constru√≠da na blockchain</a>exibe a blockchain em tr√™s momentos diferentes, conforme a cadeia de transa√ß√µes entre Joe e Gopesh que est√° sendo constru√≠da. Observe como cada transa√ß√£o gasta um UTXO que foi criado em uma transa√ß√£o anterior, transformando-o em uma <em>sa√≠da de transa√ß√£o gasta</em> ou <em>STXO</em>. Como a transa√ß√£o n¬∫ 1 (de Joe para Alice) gasta um √∫nico UTXO (de Joe) e cria um √∫nico UTXO (para Alice), ela n√£o modifica o tamanho do conjunto do UTXO. Por outro lado, as transa√ß√µes 2 e 3 criam sa√≠das de troco para o remetente, gastando um √∫nico UTXO e criando dois UTXO (o pagamento e a sa√≠da de troco). Portanto, cada um deles aumenta o tamanho do conjunto UTXO em 1.</p>
</div>
<div id="utxo-stxo" class="imageblock data-line-1376">
<div class="content">
<img src="images/mbc2_0609.png" alt="Cadeia de transa√ß√£o entre Joe e Gopesh sendo constru√≠da na blockchain">
</div>
<div class="title">Figure 36. Cadeia de transa√ß√µes entre Joe e Gopesh sendo constru√≠da na blockchain</div>
</div>
<div class="paragraph data-line-1378">
<p>A sa√≠da de uma transa√ß√£o pode ter um valor arbitr√°rio (inteiro) denominado como um m√∫ltiplo de satoshis. Assim como os d√≥lares podem ser divididos em at√© duas casas decimais como centavos, o bitcoin pode ser dividido em at√© oito casas decimais como satoshis. Embora uma sa√≠da possa ter qualquer valor arbitr√°rio, uma vez criada, ela √© indivis√≠vel. Esta √© uma caracter√≠stica importante das sa√≠das que precisa ser enfatizada: as sa√≠das s√£o unidades de valor <em>discretas</em> e <em>indivis√≠veis</em>, denominadas em satoshis inteiros. Uma sa√≠da n√£o gasta s√≥ pode ser consumida em sua totalidade por uma transa√ß√£o.</p>
</div>
<div class="paragraph data-line-1380">
<p>Se uma UTXO √© maior do que o valor desejado de uma transa√ß√£o, ela precisa ser totalmente consumida e um troco deve ser gerado na transa√ß√£o. Em outras palavras, se voc√™ possui uma UTXO que vale 20 bitcoins, e voc√™ quer pagar apenas 1 bitcoin, a sua transa√ß√£o precisa consumir toda a UTXO de 20 bitcoins e produzir duas sa√≠das: uma que paga 1 bitcoin para o destinat√°rio desejado e outra que paga 19 bitcoins em troco de volta para a sua carteira. Devido √† natureza indivis√≠vel das sa√≠das de transa√ß√£o, a maioria das transa√ß√µes de bitcoin precisa gerar troco.</p>
</div>
<div class="paragraph data-line-1382">
<p>Imagine uma cliente comprando uma bebida de $1,50, pegando sua carteira e tentando achar uma combina√ß√£o de moedas e notas para atingir o valor de $1,50. A cliente poder√° escolher pagar a quantia exata, se dispon√≠vel, com uma nota de um d√≥lar e duas moedas de 25 centavos, ou com uma combina√ß√£o de pequenas denomina√ß√µes (6 moedas de 25 centavos), ou, se necess√°rio, com uma unidade maior, como uma nota de 5 d√≥lares. Se ela der dinheiro em excesso ao dono da loja, digamos $5, ela esperar√° um troco de $3,50, o qual ela guardar√° em sua carteira, onde ficar√° dispon√≠vel para transa√ß√µes futuras.</p>
</div>
<div class="paragraph data-line-1384">
<p>De maneira semelhante, uma transa√ß√£o de bitcoin precisa ser criada a partir de uma UTXO do usu√°rio em quaisquer denomina√ß√µes que o usu√°rio tiver dispon√≠vel. Os usu√°rios n√£o podem dividir uma UTXO pela metade, da mesma maneira que eles n√£o podem cortar uma nota de um d√≥lar pela metade e us√°-la para fazer pagamentos. O aplicativo de carteira do usu√°rio geralmente selecionar√° algumas UTXOs entre as UTXOs dispon√≠veis do usu√°rio, com o objetivo de juntar uma quantia maior ou igual ao valor desejado da transa√ß√£o.</p>
</div>
<div class="paragraph data-line-1386">
<p>Assim como na vida real, a aplica√ß√£o de bitcoin possui v√°rias estrat√©gias para satisfazer a quantia de compra: combinar v√°rias unidades menores, procurar pelo troco exato ou usar uma unidade √∫nica maior que o valor da transa√ß√£o e receber o troco. Toda essa complexa administra√ß√£o das UTXOs gast√°veis √© feita de maneira autom√°tica pela carteira do usu√°rio, e os usu√°rios sequer tomam conhecimento dela. A administra√ß√£o das UTXOs s√≥ √© relevante se voc√™ for um programador e estiver construindo transa√ß√µes brutas a partir de UTXOs.</p>
</div>
<div class="paragraph data-line-1388">
<p>Uma transa√ß√£o consome sa√≠das de transa√ß√£o n√£o gastas registradas anteriormente e cria novas sa√≠das de transa√ß√£o que podem ser consumidas por uma transa√ß√£o futura. Dessa forma, peda√ßos de valor de bitcoin passam de propriet√°rio a propriet√°rio em uma cadeia de transa√ß√µes que consome e cria UTXOs.</p>
</div>
<div class="paragraph data-line-1390">
<p>A exce√ß√£o para a cadeia de entradas e sa√≠das √© um tipo especial de transa√ß√£o chamada de transa√ß√£o <em>coinbase</em>, que √© a primeira transa√ß√£o em cada bloco. Essa transa√ß√£o √© inserida no bloco pelo minerador "vencedor" e cria bitcoins novos, rec√©m-criados, que ser√£o pagos para o minerador como uma recompensa por ter conseguido minerar o bloco. Esta transa√ß√£o especial n√£o consome UTXOs; em vez disso, ela tem um tipo especial de entrada chamada "coinbase". √â assim que a oferta monet√°ria do bitcoin √© criada durante o processo de minera√ß√£o, como veremos no <a href="#mining">[mining]</a>.</p>
</div>
<div class="admonitionblock tip data-line-1393">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1394">
<p>E o que vem primeiro? As entradas ou as sa√≠das, a galinha ou o ovo? Falando estritamente, as sa√≠das vem primeiro, pois as transa√ß√µes coinbase, que geram os novos bitcoins, n√£o tem entradas e criam sa√≠das a partir do nada.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="tx_outs" class="paragraph data-line-1398">
<p>==== Sa√≠das de Transa√ß√£o</p>
</div>
<div class="paragraph data-line-1400">
<p>Toda transa√ß√£o de bitcoin cria sa√≠das (em ingl√™s, <em>outputs</em>), que s√£o gravadas no livro-raz√£o do bitcoin (a cadeia de blocos). Quase todas essas sa√≠das, com uma exce√ß√£o (ver <a href="#op_return">[op_return]</a>), criam partes de bitcoin gast√°veis chamadas <em>sa√≠das de transa√ß√£o n√£o gastas</em> ou UTXO (em ingl√™s, <em>Unspent Transaction Output</em>), que s√£o ent√£o reconhecidas por toda a rede e se tornam dispon√≠veis para que o dono gaste em uma transa√ß√£o futura.</p>
</div>
<div class="paragraph data-line-1402">
<p>UTXO are tracked by every full-node Bitcoin client in the UTXO set. New transactions consume (spend) one or more of these outputs from the UTXO set.</p>
</div>
<div class="paragraph data-line-1404">
<p>As sa√≠das de transa√ß√£o consistem em duas partes:</p>
</div>
<div class="ulist data-line-1406">
<ul>
<li class="data-line-1406">
<p>Uma quantidade de bitcoin, denominada em <em>satoshis</em>, a menor unidade do bitcoin</p>
</li>
<li class="data-line-1407">
<p>Um quebra-cabe√ßa criptogr√°fico que determina as condi√ß√µes necess√°rias para se gastar a sa√≠da</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1409">
<p>O quebra-cabe√ßa criptogr√°fico tamb√©m √© conhecido como um <em>script de travamento</em> (em ingl√™s, <em>locking script</em>), um <em>script de testemunha</em> (em ingl√™s, <em>witness script</em>) ou um scriptPubKey.</p>
</div>
<div class="paragraph data-line-1411">
<p>A linguagem de script da transa√ß√£o, usada no script de travamento mencionado anteriormente, √© discutida em detalhes em <a href="#tx_script">[tx_script]</a>.</p>
</div>
<div class="paragraph data-line-1413">
<p>Agora, vamos dar uma olhada na transa√ß√£o da Alice (mostrada anteriormente em <a href="#transactions_behind_the_scenes">[transactions_behind_the_scenes]</a>) e ver se conseguimos identificar as sa√≠das. Na codifica√ß√£o JSON, as sa√≠das est√£o em um array (uma lista) chamado vout:</p>
</div>
<div class="listingblock data-line-1416">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">"vout": [
  {
    "value": 0.01500000,
    "scriptPubKey": "OP_DUP OP_HASH160 ab68025513c3dbd2f7b92a94e0581f5d50f654e7 OP_EQUALVERIFY
    OP_CHECKSIG"
  },
  {
    "value": 0.08450000,
    "scriptPubKey": "OP_DUP OP_HASH160 7f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a8 OP_EQUALVERIFY OP_CHECKSIG",
  }
]</code></pre>
</div>
</div>
<div class="paragraph data-line-1430">
<p>Como voc√™ pode ver, a transa√ß√£o cont√©m duas sa√≠das. Cada sa√≠da √© definida por um valor e um quebra-cabe√ßa criptogr√°fico. Na codifica√ß√£o mostrada pelo Bitcoin Core, o valor (em ingl√™s, value) √© mostrado em bitcoin, mas na transa√ß√£o em si ele √© registrado como um n√∫mero inteiro denominado em satoshis. A segunda parte de cada sa√≠da √© o quebra-cabe√ßa criptogr√°fico que define as condi√ß√µes de gasto. O Bitcoin Core exibe-o como scriptPubKey e nos mostra uma representa√ß√£o leg√≠vel do script.</p>
</div>
<div class="paragraph data-line-1432">
<p>O t√≥pico sobre o travamento e o destravamento de UTXOs ser√° discutido mais tarde, em <a href="#tx_lock_unlock">[tx_lock_unlock]</a>. A linguagem de script que √© usada para o script em scriptPubKey √© discutida em <a href="#tx_script">[tx_script]</a>. Mas antes de nos aprofundarmos nesses t√≥picos, precisamos entender a estrutura geral das entradas e sa√≠das de transa√ß√£o.</p>
</div>
<div class="paragraph data-line-1434">
<p>===== Serializa√ß√£o da Transa√ß√£o&#x2014;sa√≠das</p>
</div>
<div class="paragraph data-line-1436">
<p>Quando as transa√ß√µes s√£o transmitidas pela rede ou trocadas entre aplicativos, elas s√£o <em>serializadas</em>. Serializa√ß√£o √© o processo de converter a representa√ß√£o interna de uma estrutura de dados em um formato que pode ser transmitido um byte por vez, tamb√©m conhecido como um fluxo de bytes. A serializa√ß√£o √© mais comumente usada para codificar estruturas de dados para transmiss√£o em uma rede ou para armazenamento em um arquivo. O formato de serializa√ß√£o de uma sa√≠da de transa√ß√£o √© mostrado na <a href="#tx_out_structure">Serializa√ß√£o da sa√≠da de transa√ß√£o</a>.</p>
</div>
<table id="tx_out_structure" class="tableblock frame-all grid-all stretch data-line-1441">
<caption class="title">Table 16. Serializa√ß√£o da sa√≠da de transa√ß√£o</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tamanho</th>
<th class="tableblock halign-left valign-top">Campo</th>
<th class="tableblock halign-left valign-top">Descri√ß√£o</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 bytes (little-endian)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Quantia</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valor de bitcoin em satoshis (10<sup>-8</sup> bitcoin)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1&#x2013;9 bytes (VarInt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tamanho do Script de Travamento</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comprimento em bytes do Script de Travamento</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vari√°vel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Script de Travamento</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Um script definindo as condi√ß√µes necess√°rias para se gastar a sa√≠da</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-1448">
<p>A maioria das bibliotecas e frameworks de bitcoin n√£o armazena transa√ß√µes internamente como fluxos de bytes, pois isso exigiria uma an√°lise sint√°tica complexa toda vez que voc√™ precisasse acessar um √∫nico campo. Por conveni√™ncia e legibilidade, as bibliotecas de bitcoin armazenam as transa√ß√µes internamente em estruturas de dados (geralmente estruturas orientadas a objetos).</p>
</div>
<div class="paragraph data-line-1450">
<p>O processo de convers√£o da representa√ß√£o em fluxo de bytes de uma transa√ß√£o em uma estrutura de dados da representa√ß√£o interna de uma biblioteca √© chamada de <em>deserializa√ß√£o</em> ou <em>an√°lise sint√°tica da transa√ß√£o</em> (em ingl√™s, <em>transaction parsing</em>). O processo de convers√£o de volta para um fluxo de bytes, a fim de ser transmitido pela rede, submetido a uma fun√ß√£o de hash ou armazenado em disco, √© chamado de <em>serializa√ß√£o</em>. A maioria das bibliotecas do bitcoin possui fun√ß√µes para fazer a serializa√ß√£o e a desserializa√ß√£o de transa√ß√µes.</p>
</div>
<div class="paragraph data-line-1452">
<p>Veja se voc√™ consegue decodificar manualmente a transa√ß√£o da Alice a partir da forma hexadecimal serializada, encontrando alguns dos elementos que vimos anteriormente. Para ajud√°-lo, a se√ß√£o que cont√©m as duas sa√≠das est√° destacada no <a href="#example_6_1">Transa√ß√£o da Alice, serializada e apresentada em nota√ß√£o hexadecimal</a>:</p>
</div>
<div id="example_6_1" class="exampleblock data-line-1456">
<div class="title">Example 18. Transa√ß√£o da Alice, serializada e apresentada em nota√ß√£o hexadecimal</div>
<div class="content">
<div class="paragraph data-line-1457">
<p>0100000001186f9f998a5aa6f048e51dd8419a14d8a0f1a8a2836dd73
4d2804fe65fa35779000000008b483045022100884d142d86652a3f47
ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039
ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813
01410484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade84
16ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc1
7b4a10fa336a8d752adfffffffff02<strong>60e31600000000001976a914ab6</strong>
<strong>8025513c3dbd2f7b92a94e0581f5d50f654e788acd0ef800000000000</strong>
<strong>1976a9147f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a888ac</strong>
00000000</p>
</div>
</div>
</div>
<div class="paragraph data-line-1469">
<p>Aqui est√£o algumas dicas:</p>
</div>
<div class="ulist data-line-1471">
<ul>
<li class="data-line-1471">
<p>Existem duas sa√≠das na se√ß√£o destacada, cada uma serializada conforme mostrado na <a href="#tx_out_structure">Serializa√ß√£o da sa√≠da de transa√ß√£o</a>.</p>
</li>
<li class="data-line-1472">
<p>O valor de 0,015 bitcoin equivale a 1.500.000 satoshis, que √© 16 e3 60 em hexadecimal.</p>
</li>
<li class="data-line-1473">
<p>Na transa√ß√£o serializada, o valor 16 e3 60 √© codificado na ordem de bytes <em>little-endian</em> (byte menos significativo primeiro), resultando em 60 e3 16.</p>
</li>
<li class="data-line-1474">
<p>O comprimento do scriptPubKey √© 25 bytes, que √© 19 em hexadecimal.</p>
</li>
</ul>
</div>
<div id="tx_inputs" class="paragraph data-line-1477">
<p>==== Entradas de Transa√ß√£o</p>
</div>
<div class="paragraph data-line-1479">
<p>As entradas de transa√ß√£o identificam (por refer√™ncia) qual UTXO ser√° consumida e fornecem uma prova de posse atrav√©s de um script de destravamento.</p>
</div>
<div class="paragraph data-line-1481">
<p>Para construir uma transa√ß√£o, uma carteira seleciona, das UTXOs que ela controla, UTXOs com valor suficiente para fazer o pagamento solicitado. √Äs vezes, uma UTXO √© suficiente, outras vezes, mais de uma √© necess√°ria. Para cada UTXO que ser√° consumida para fazer este pagamento, a carteira cria uma entrada apontando para a UTXO e a destrava com um script de destravamento.</p>
</div>
<div class="paragraph data-line-1483">
<p>Vamos analisar os componentes de uma entrada em maiores detalhes. A primeira parte de uma entrada √© um apontador para uma UTXO por refer√™ncia ao hash da transa√ß√£o e um √≠ndice de sa√≠da, que identifica a UTXO espec√≠fica naquela transa√ß√£o. A segunda parte √© um script de destravamento, que a carteira constr√≥i para atender √†s condi√ß√µes de gasto definidas na UTXO. Na maioria das vezes, o script de destravamento √© uma assinatura digital e uma chave p√∫blica que provam a posse do bitcoin. No entanto, nem todos os scripts de destravamento cont√™m assinaturas. A terceira parte √© um n√∫mero de sequ√™ncia, que ser√° discutido posteriormente.</p>
</div>
<div class="paragraph data-line-1485">
<p>Considere nosso exemplo em <a href="#transactions_behind_the_scenes">[transactions_behind_the_scenes]</a>. As entradas da transa√ß√£o s√£o um array (lista) chamado vin:</p>
</div>
<div id="vin" class="listingblock data-line-1490">
<div class="title">As entradas de transa√ß√£o na transa√ß√£o da Alice</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">"vin": [
  {
    "txid": "7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18",
    "vout": 0,
    "scriptSig" : "3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813[ALL] 0484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adf",
    "sequence": 4294967295
  }
]</code></pre>
</div>
</div>
<div class="paragraph data-line-1501">
<p>Como voc√™ pode ver, s√≥ existe uma entrada na lista (porque uma UTXO continha valor suficiente para fazer este pagamento). A entrada cont√©m quatro elementos:</p>
</div>
<div class="ulist data-line-1503">
<ul>
<li class="data-line-1503">
<p>Um ID de transa√ß√£o, referenciando a transa√ß√£o que cont√©m a UTXO sendo gasta</p>
</li>
<li class="data-line-1504">
<p>Um √≠ndice de sa√≠da (vout), identificando qual UTXO daquela transa√ß√£o √© referenciada (a primeira tem √≠ndice igual a zero)</p>
</li>
<li class="data-line-1505">
<p>Um scriptSig, que satisfaz as condi√ß√µes colocadas na UTXO, destravando-a para ser gasta</p>
</li>
<li class="data-line-1506">
<p>Um n√∫mero de sequ√™ncia (que ser√° discutido mais tarde)</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1508">
<p>Na transa√ß√£o da Alice, a entrada aponta para o ID de transa√ß√£o:</p>
</div>
<div class="listingblock data-line-1510">
<div class="content">
<pre>7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18</pre>
</div>
</div>
<div class="paragraph data-line-1514">
<p>e o √≠ndice de sa√≠da 0 (ou seja, a primeira UTXO criada por aquela transa√ß√£o). O script de destravamento √© constru√≠do pela carteira de Alice primeiro recuperando a UTXO referenciada, depois examinando seu script de travamento e, em seguida, usando-o para construir o script de destravamento necess√°rio para satisfaz√™-lo.</p>
</div>
<div class="paragraph data-line-1516">
<p>Olhando apenas para a entrada, voc√™ deve ter notado que n√£o sabemos nada sobre esta UTXO, exceto uma refer√™ncia √† transa√ß√£o pai que a cont√©m. N√£o sabemos seu valor (quantia em satoshis) e n√£o conhecemos o script de travamento que define as condi√ß√µes para gast√°-la. Para encontrar essas informa√ß√µes, devemos recuperar a UTXO referenciada recuperando a transa√ß√£o pai que a cont√©m. Observe que, como o valor da entrada n√£o √© declarado explicitamente, tamb√©m devemos usar a UTXO referenciada para calcular as taxas que ser√£o pagas nesta transa√ß√£o (ver <a href="#tx_fees">[tx_fees]</a>).</p>
</div>
<div class="paragraph data-line-1518">
<p>N√£o √© apenas a carteira da Alice que precisa recuperar as UTXOs referenciadas nas entradas. Uma vez que essa transa√ß√£o √© transmitida para a rede, todos os n√≥s validadores tamb√©m precisar√£o recuperar as UTXOs referenciadas nas entradas da transa√ß√£o para poder validar a transa√ß√£o.</p>
</div>
<div class="paragraph data-line-1520">
<p>As transa√ß√µes por si s√≥s parecem incompletas, pois elas n√£o t√™m contexto. Elas fazem refer√™ncia √†s UTXOs em suas entradas, mas, sem recuperar essas UTXOs, n√£o podemos saber o valor das entradas ou suas condi√ß√µes de travamento. Ao escrever um software de bitcoin, sempre que voc√™ decodificar uma transa√ß√£o com a inten√ß√£o de valid√°-la, ou para contar as taxas, ou para verificar o script de destravamento, seu c√≥digo ter√° primeiro de recuperar a UTXO referenciada da blockchain para construir o contexto que est√° impl√≠cito, mas que n√£o est√° presente nas refer√™ncias de UTXO das entradas. Por exemplo, para calcular o valor pago em taxas, √© necess√°rio saber a soma dos valores das entradas e sa√≠das. Mas sem recuperar as UTXOs referenciadas nas entradas, voc√™ n√£o sabe o valor delas. Portanto, uma opera√ß√£o aparentemente simples, como calcular as taxas de uma √∫nica transa√ß√£o, na verdade envolve v√°rias etapas e dados de m√∫ltiplas transa√ß√µes.</p>
</div>
<div class="paragraph data-line-1522">
<p>Podemos usar a mesma sequ√™ncia de comandos do Bitcoin Core que usamos ao recuperar a transa√ß√£o da Alice (getrawtransaction e decoderawtransaction). Com isso, conseguimos obter a UTXO referenciada na entrada da transa√ß√£o da Alice e dar uma olhada:</p>
</div>
<div id="alice_input_tx" class="listingblock data-line-1527">
<div class="title">A UTXO da transa√ß√£o anterior, referenciada na entrada da transa√ß√£o da Alice</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">"vout": [
   {
     "value": 0.10000000,
     "scriptPubKey": "OP_DUP OP_HASH160 7f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a8 OP_EQUALVERIFY OP_CHECKSIG"
   }
 ]</code></pre>
</div>
</div>
<div class="paragraph data-line-1536">
<p>Vemos que esta UTXO tem um valor de 0,1 BTC e que ela possui um script de travamento (scriptPubKey) que cont√©m "OP_DUP OP_HASH160&#8230;&#8203;".</p>
</div>
<div class="admonitionblock tip data-line-1539">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1540">
<p>Para entender completamente a transa√ß√£o da Alice, tivemos que recuperar a transa√ß√£o anterior referenciada como entrada. Uma fun√ß√£o que recupera transa√ß√µes anteriores e sa√≠das de transa√ß√£o n√£o gastas √© muito comum e existe em quase todas as bibliotecas e APIs do bitcoin.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1543">
<p>===== Serializa√ß√£o da Transa√ß√£o&#x2014;entradas</p>
</div>
<div class="paragraph data-line-1545">
<p>Quando as transa√ß√µes s√£o serializadas para transmiss√£o na rede, suas entradas s√£o codificadas em um fluxo de bytes, conforme mostrado na <a href="#tx_in_structure">Serializa√ß√£o da entrada de transa√ß√£o</a>.</p>
</div>
<table id="tx_in_structure" class="tableblock frame-all grid-all stretch data-line-1550">
<caption class="title">Table 17. Serializa√ß√£o da entrada de transa√ß√£o</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tamanho</th>
<th class="tableblock halign-left valign-top">Campo</th>
<th class="tableblock halign-left valign-top">Descri√ß√£o</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hash da Transa√ß√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apontador para a transa√ß√£o contendo a UTXO a ser gasta</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">√çndice da Sa√≠da</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O n√∫mero √≠ndice da UTXO a ser gasta; o primeiro √© 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1&#x2013;9 bytes (VarInt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tamanho do Script de Destravamento</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comprimento em bytes do Script de Destravamento</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vari√°vel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Script de Destravamento</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Um script que preenche as condi√ß√µes necess√°rias para o script de travamento da UTXO</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N√∫mero de Sequ√™ncia</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Usado para o locktime ou desabilitado (0xFFFFFFFF)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-1559">
<p>Assim como fizemos com as sa√≠das, vamos ver se conseguimos encontrar as entradas da transa√ß√£o da Alice no formato serializado. Primeiro, as entradas decodificadas:</p>
</div>
<div class="listingblock data-line-1562">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">"vin": [
  {
    "txid": "7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18",
    "vout": 0,
    "scriptSig" : "3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813[ALL] 0484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adf",
    "sequence": 4294967295
  }
],</code></pre>
</div>
</div>
<div class="paragraph data-line-1573">
<p>Agora, vamos ver se conseguimos identificar esses campos na codifica√ß√£o hexadecimal serializada no <a href="#example_6_2">Transa√ß√£o da Alice, serializada e apresentada em nota√ß√£o hexadecimal</a>:</p>
</div>
<div id="example_6_2" class="exampleblock data-line-1577">
<div class="title">Example 19. Transa√ß√£o da Alice, serializada e apresentada em nota√ß√£o hexadecimal</div>
<div class="content">
<div class="paragraph data-line-1578">
<p>0100000001<strong>186f9f998a5aa6f048e51dd8419a14d8a0f1a8a2836dd73</strong>
<strong>4d2804fe65fa35779000000008b483045022100884d142d86652a3f47</strong>
<strong>ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039</strong>
<strong>ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813</strong>
<strong>01410484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade84</strong>
<strong>16ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc1</strong>
<strong>7b4a10fa336a8d752adfffffffff</strong>0260e31600000000001976a914ab6
8025513c3dbd2f7b92a94e0581f5d50f654e788acd0ef800000000000
1976a9147f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a888ac00000
000</p>
</div>
</div>
</div>
<div class="paragraph data-line-1590">
<p>Dicas:</p>
</div>
<div class="ulist data-line-1592">
<ul>
<li class="data-line-1592">
<p>O ID de transa√ß√£o √© serializado em ordem de byte reversa, ent√£o come√ßa com (hex) 18 e termina com 79</p>
</li>
<li class="data-line-1593">
<p>O √≠ndice da sa√≠da √© um grupo de zeros de 4 bytes, que √© f√°cil de identificar</p>
</li>
<li class="data-line-1594">
<p>O comprimento do scriptSig √© 139 bytes, ou 8b em hexadecimal</p>
</li>
<li class="data-line-1595">
<p>O n√∫mero de sequ√™ncia √© definido como FFFFFFFF, tamb√©m f√°cil de ser identificado</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1597">
<p>O ScriptSig √© um tipo espec√≠fico de script de destravamento que, quando serializado para transmiss√£o na rede, as entradas s√£o codificadas em um fluxo de bytes, conforme mostrado na <a href="#scriptsig_in_structure">Serializa√ß√£o de entrada ScriptSig</a>. A serializa√ß√£o do campo de assinatura √© detalhada em <a href="#seralization_of_signatures_der">[seralization_of_signatures_der]</a>. O campo de assinatura tamb√©m inclui um tipo de hash de assinatura (SIGHASH), que √© detalhado em <a href="#sighash_types">[sighash_types]</a>.</p>
</div>
<table id="scriptsig_in_structure" class="tableblock frame-all grid-all stretch data-line-1602">
<caption class="title">Table 18. Serializa√ß√£o de entrada ScriptSig</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tamanho</th>
<th class="tableblock halign-left valign-top">Campo</th>
<th class="tableblock halign-left valign-top">Descri√ß√£o</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1&#x2013;9 bytes (VarInt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tamanho da Assinatura</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comprimento da assinatura em bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vari√°vel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assinatura</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uma assinatura que √© produzida pela carteira do usu√°rio a partir de sua chave privada, que inclui um SIGHASH</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1&#x2013;9 bytes (VarInt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tamanho da Chave P√∫blica</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comprimento da chave p√∫blica em bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vari√°vel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Chave P√∫blica</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A chave p√∫blica, n√£o transformada em hash</p></td>
</tr>
</tbody>
</table>
<div id="tx_fees" class="paragraph data-line-1611">
<p>==== Taxas de Transa√ß√£o</p>
</div>
<div class="paragraph data-line-1613">
<p>A maioria das transa√ß√µes inclui taxas de transa√ß√£o, que compensam os mineradores de bitcoin por protegerem a rede. As taxas por si s√≥s tamb√©m servem como um mecanismo de seguran√ßa, tornando economicamente invi√°vel para que atacantes inundem a rede com transa√ß√µes. A minera√ß√£o, as taxas e as recompensas coletadas pelos mineradores s√£o discutidas em maiores detalhes no <a href="#mining">[mining]</a>.</p>
</div>
<div class="paragraph data-line-1615">
<p>Esta se√ß√£o examina como as taxas de transa√ß√£o s√£o inclu√≠das em uma transa√ß√£o t√≠pica. A maioria das carteiras calcula e inclui automaticamente as taxas de transa√ß√£o. No entanto, se voc√™ estiver criando transa√ß√µes atrav√©s de programa√ß√£o ou usando uma interface de linha de comando, voc√™ deve contabilizar e incluir manualmente essas taxas.</p>
</div>
<div class="paragraph data-line-1617">
<p>As taxas de transa√ß√£o servem como um incentivo para incluir (minerar) uma transa√ß√£o no pr√≥ximo bloco e tamb√©m como um desincentivo ao abuso do sistema, ao imporem um pequeno custo em cada transa√ß√£o. As taxas de transa√ß√£o s√£o coletadas pelo minerador que minera o bloco que registra a transa√ß√£o na blockchain.</p>
</div>
<div class="paragraph data-line-1619">
<p>Transaction fees are calculated based on the size of the transaction in kilobytes, not the value of the transaction in bitcoin. Overall, transaction fees are set based on market forces within the Bitcoin network. Miners prioritize transactions based on many different criteria, including fees, and might even process transactions for free under certain circumstances. Transaction fees affect the processing priority, meaning that a transaction with sufficient fees is likely to be included in the next block mined, whereas a transaction with insufficient or no fees might be delayed, processed on a best-effort basis after a few blocks, or not processed at all. Transaction fees are not mandatory, and transactions without fees might be processed eventually; however, including transaction fees encourages priority processing.</p>
</div>
<div class="paragraph data-line-1621">
<p>Ao longo do tempo, a forma como as taxas s√£o calculadas e o efeito que elas tem na prioridade das transa√ß√µes evoluiu. Inicialmente, as taxas de transa√ß√£o eram fixas e constantes em toda a rede. Gradualmente, a estrutura de taxas foi flexibilizada, e agora as taxas podem ser influenciadas por for√ßas do mercado, com base na capacidade da rede e no volume de transa√ß√µes. Desde, pelo menos, o in√≠cio de 2016, os limites de capacidade no bitcoin criaram concorr√™ncia entre as transa√ß√µes, resultando em taxas mais altas e efetivamente tornando as transa√ß√µes gratuitas uma coisa do passado. Transa√ß√µes com taxa zero ou com taxa muito baixa raramente s√£o mineradas e, √†s vezes, nem mesmo s√£o propagadas pela rede.</p>
</div>
<div class="paragraph data-line-1623">
<p>No Bitcoin Core, as pol√≠ticas de taxa para retransmiss√£o s√£o definidas pela op√ß√£o minrelaytxfee. O valor padr√£o atual da minrelaytxfee √© 0,00001 bitcoin ou um cent√©simo de milibitcoin por kilobyte. Portanto, por padr√£o, as transa√ß√µes com uma taxa inferior a 0,00001 bitcoin s√£o tratadas como gratuitas e s√≥ ser√£o retransmitidas se houver espa√ßo na mempool; caso contr√°rio, elas ser√£o descartadas. Os n√≥s de bitcoin podem substituir a pol√≠tica de taxa para retransmiss√£o padr√£o ajustando o valor da minrelaytxfee.</p>
</div>
<div class="paragraph data-line-1625">
<p>Qualquer servi√ßo de bitcoin que cria transa√ß√µes, incluindo carteiras, corretoras, aplicativos de varejo, etc., <em>deve</em> implementar taxas din√¢micas. As taxas din√¢micas podem ser implementadas por meio de um servi√ßo de estimativa de taxa de terceiros ou com um algoritmo de estimativa de taxa integrado. Se voc√™ n√£o tiver certeza, comece com um servi√ßo de terceiros e, √† medida que ganhar experi√™ncia, projete e implemente seu pr√≥prio algoritmo, caso voc√™ n√£o queira mais ficar dependente de terceiros.</p>
</div>
<div class="paragraph data-line-1627">
<p>Os algoritmos de estimativa de taxa calculam a taxa apropriada, com base na capacidade e nas taxas oferecidas pelas transa√ß√µes que est√£o "competindo". Esses algoritmos variam dos mais simples (taxa m√©dia ou mediana no √∫ltimo bloco) aos mais sofisticados (an√°lise estat√≠stica). Eles estimam a taxa necess√°ria (em satoshis por byte) que dar√° a uma transa√ß√£o uma alta probabilidade de ser selecionada e inclu√≠da em um determinado n√∫mero de blocos. A maioria dos servi√ßos oferece aos usu√°rios a op√ß√£o de escolher taxas de prioridade alta, m√©dia ou baixa. Alta prioridade significa que os usu√°rios pagam taxas mais altas, mas a transa√ß√£o provavelmente ser√° inclu√≠da no pr√≥ximo bloco. Prioridades m√©dia e baixa significam que os usu√°rios pagam taxas de transa√ß√£o mais baixas, mas a confirma√ß√£o das transa√ß√µes pode demorar muito mais.</p>
</div>
<div class="paragraph data-line-1629">
<p>Muitos aplicativos de carteira usam servi√ßos de terceiros para c√°lculos de taxas. Um servi√ßo popular √© o <a href="https://bitcoinfees.earn.com/" data-href="https://bitcoinfees.earn.com/"><em>https://bitcoinfees.earn.com/</em></a>, que fornece uma API e um gr√°fico mostrando a taxa em satoshis/byte para diferentes prioridades.</p>
</div>
<div class="admonitionblock tip data-line-1632">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1633">
<p>Static fees are no longer viable on the Bitcoin network. Wallets that set static fees will produce a poor user experience as transactions will often get "stuck" and remain unconfirmed. Users who don&#8217;t understand bitcoin transactions and fees are dismayed by "stuck" transactions because they think they&#8217;ve lost their money.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1636">
<p>O gr√°fico na <a href="#bitcoinfeesearncom">Servi√ßo de estimativa de taxa bitcoinfees.earn.com</a> mostra a estimativa em tempo real das taxas em incrementos de 10 satoshis/byte e o tempo de confirma√ß√£o esperado (em minutos e n√∫mero de blocos) para transa√ß√µes com taxas em cada faixa. Para cada faixa de taxa (por exemplo, 61&#x2013;70 satoshis/byte), duas barras horizontais mostram o n√∫mero de transa√ß√µes n√£o confirmadas (1.405) e o n√∫mero total de transa√ß√µes com taxas nessa faixa nas √∫ltimas 24 horas (102.975). Com base no gr√°fico, a taxa de alta prioridade recomendada naquele momento era de 80 satoshis/byte, uma taxa que provavelmente faria com que a transa√ß√£o fosse minerada no bloco seguinte (com atraso de bloco zero). Para se ter uma id√©ia, o tamanho mediano de uma transa√ß√£o √© de 226 bytes, ent√£o a taxa recomendada para esse tamanho de transa√ß√£o seria 18.080 satoshis (0,00018080 BTC).</p>
</div>
<div class="paragraph data-line-1638">
<p>Os dados de estimativa de taxa podem ser recuperados por meio de uma API HTTP REST simples, em <a href="https://bitcoinfees.earn.com/api/v1/fees/recommended" data-href="https://bitcoinfees.earn.com/api/v1/fees/recommended">https://bitcoinfees.earn.com/api/v1/fees/recommended</a>. Por exemplo, usando-se o comando curl na linha de comando:</p>
</div>
<div class="listingblock data-line-1641">
<div class="title">Usando a API de estimativa de taxa</div>
<div class="content">
<pre>$ curl https://bitcoinfees.earn.com/api/v1/fees/recommended

{"fastestFee":80,"halfHourFee":80,"hourFee":60}</pre>
</div>
</div>
<div class="paragraph data-line-1647">
<p>A API retorna um objeto JSON com a estimativa de taxa atual para a confirma√ß√£o mais r√°pida (fastFee), para uma confirma√ß√£o dentro de tr√™s blocos (halfHourFee) e para uma confirma√ß√£o dentro de seis blocos (hourFee), em satoshis por byte.</p>
</div>
<div id="bitcoinfeesearncom" class="imageblock data-line-1651">
<div class="content">
<img src="images/mbc2_0602.png" alt="Fee Estimation Service bitcoinfees.earn.com">
</div>
<div class="title">Figure 37. Servi√ßo de estimativa de taxa bitcoinfees.earn.com</div>
</div>
<div class="paragraph data-line-1653">
<p>==== Adicionando Taxas √†s Transa√ß√µes</p>
</div>
<div class="paragraph data-line-1655">
<p>A estrutura de dados das transa√ß√µes n√£o tem um campo para as taxas. Em vez disso, infere-se que as taxas s√£o a diferen√ßa entre a soma das entradas e a soma das sa√≠das. Qualquer valor em excesso que permanece ap√≥s todas as sa√≠das terem sido deduzidas de todas as entradas √© a taxa que √© coletada pelos mineradores.</p>
</div>
<div id="tx_fee_equation" class="listingblock data-line-1659">
<div class="title">As taxas de transa√ß√£o s√£o implicitamente consideradas como o resto da subtra√ß√£o das entradas pela sa√≠das:</div>
<div class="content">
<pre>Taxas = Soma(Entradas) ‚Äì Soma(Sa√≠das)</pre>
</div>
</div>
<div class="paragraph data-line-1663">
<p>Isso √© um elemento relativamente confuso das transa√ß√µes, e √© um ponto importante para se compreender, pois se voc√™ est√° construindo as suas pr√≥prias transa√ß√µes, voc√™ deve se certificar de que voc√™ n√£o incluiu uma taxa muito grande ao subutilizar as entradas. Isso significa que voc√™ deve contabilizar todas as entradas, e, se necess√°rio, criar troco, caso contr√°rio, voc√™ acabar√° dando uma gorjeta grande demais para os mineradores!</p>
</div>
<div class="paragraph data-line-1665">
<p>Por exemplo, se voc√™ consumir uma UTXO de 20 bitcoins para fazer um pagamento de 1 bitcoin, voc√™ precisa incluir uma sa√≠da de troco de 19 bitcoins de volta para a sua carteira. Caso contr√°rio, os 19 bitcoins que sobrarem ser√£o contados como uma taxa de transa√ß√£o e ser√£o coletados pelo minerador que minerar a sua transa√ß√£o em um bloco. A sua transa√ß√£o vai receber alta prioridade e o minerador vai ficar muito feliz, mas provavelmente n√£o era isso que voc√™ queria fazer.</p>
</div>
<div class="admonitionblock warning data-line-1668">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-1669">
<p>Se voc√™ se esquecer de adicionar uma sa√≠da de troco em uma transa√ß√£o constru√≠da manualmente, o seu troco ser√° usado para pagar a taxa da transa√ß√£o. Provavelmente a sua real inten√ß√£o n√£o era dizer ao minerador "Pode ficar com troco!"</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1672">
<p>Vamos ver como isso funciona na pr√°tica, ao analisar novamente a compra da x√≠cara de caf√© da Alice. A Alice quer gastar 0,015 BTC para pagar pelo caf√©. Para ter a certeza de que essa transa√ß√£o ser√° processada prontamente, ela ter√° que incluir uma taxa de transa√ß√£o, que digamos que seja de 0,0005 BTC. Isso significa que o custo total da transa√ß√£o ser√° de 0,0155 BTC. A carteira dela, portanto, precisar√° usar um conjunto de UTXOs cuja soma resulte em 0,0155 BTC ou mais e, se necess√°rio, ter√° que criar o troco. Digamos que a carteira dela tem uma UTXO de 0,1 BTC dispon√≠vel. Portanto ela precisar√° consumir essa UTXO, criando uma sa√≠da de 0,015 BTC para a Cafeteria do Bob e uma segunda sa√≠da de 0,0845 BTC de troco de volta para a pr√≥pria carteira dela, deixando 0,0005 BTC n√£o alocado, que √© uma taxa impl√≠cita pela transa√ß√£o.</p>
</div>
<div class="paragraph data-line-1674">
<p>Agora vamos ver um cen√°rio diferente. A Eug√™nia, nossa diretora da institui√ß√£o de caridade para crian√ßas nas Filipinas, completou uma campanha para arrecada√ß√£o de fundos para comprar livros escolares para as crian√ßas. Ela recebeu milhares de pequenas doa√ß√µes de pessoas de todos os lugares do mundo, totalizando 50 bitcoins, ent√£o sua carteira est√° cheia de pagamentos muito pequenos (UTXOs). Agora ela que comprar centenas de livros escolares da editora local, pagando em bitcoin.</p>
</div>
<div class="paragraph data-line-1676">
<p>Ao tentar construir uma √∫nica transa√ß√£o de pagamento com uma quantia maior, o aplicativo de carteira da Eug√™nia deve utilizar o conjunto UTXO dispon√≠vel, que √© composto por v√°rias quantias menores. Isso significa que a transa√ß√£o resultante utilizar√° mais de uma centena de UTXOs de pequeno valor como entradas, e ter√° apenas uma √∫nica sa√≠da, que ser√° o pagamento √† editora do livro. Uma transa√ß√£o com tantas entradas ter√° mais do que um kilobyte, talvez v√°rios kilobytes. Como resultado, ela exigir√° uma taxa muito maior do que a transa√ß√£o de tamanho mediano.</p>
</div>
<div class="paragraph data-line-1678">
<p>O aplicativo de carteira da Eug√™nia calcular√° a taxa apropriada ao medir o tamanho da transa√ß√£o e multiplic√°-lo pela taxa por kilobyte. Muitas carteiras pagar√£o taxas extras para transa√ß√µes de maior tamanho, a fim de garantir que a transa√ß√£o seja processada prontamente. A taxa n√£o √© maior pelo fato de a Eug√™nia estar gastando mais dinheiro, mas pelo fato de a transa√ß√£o dela ser mais complexa e ter um tamanho maior‚Äîa taxa √© independente do valor da transa√ß√£o em bitcoins.</p>
</div>
<div id="tx_script" class="paragraph pagebreak-before less_space_h1 data-line-1682">
<p>=== Scripts de Transa√ß√£o e Linguagem de Script</p>
</div>
<div class="paragraph data-line-1684">
<p>A linguagem de script da transa√ß√£o do bitcoin, chamada <em>Script</em>, √© uma linguagem de execu√ß√£o baseada em pilha de nota√ß√£o polonesa reversa, semelhante √† linguagem Forth. Se isso soa como um jarg√£o, voc√™ provavelmente n√£o estudou as linguagens de programa√ß√£o dos anos 1960, mas tudo bem&#x2014;explicaremos tudo o que voc√™ precisa saber neste cap√≠tulo. Tanto o script de travamento colocado em uma UTXO quanto o script de destravamento s√£o escritos nesta linguagem de script. Quando uma transa√ß√£o √© validada, o script de destravamento em cada entrada √© executado junto com o script de travamento correspondente para ver se ele satisfaz a condi√ß√£o de gasto.</p>
</div>
<div class="paragraph data-line-1686">
<p>A Script √© uma linguagem muito simples que foi projetada para ser limitada em escopo e execut√°vel em uma variedade de hardwares, talvez t√£o simples quanto um dispositivo embutido. Ela requer processamento m√≠nimo e n√£o consegue fazer muitas das coisas extravagantes que as linguagens de programa√ß√£o modernas conseguem fazer. Para seu uso na valida√ß√£o de dinheiro program√°vel, este √© um recurso de seguran√ßa deliberado.</p>
</div>
<div class="paragraph data-line-1688">
<p>Today, most transactions processed through the Bitcoin network have the form "Payment to Bob&#8217;s Bitcoin address" and are based on a script called a Pay-to-Public-Key-Hash script.  However, bitcoin transactions are not limited to the "Payment to Bob&#8217;s Bitcoin address" script. In fact, locking scripts can be written to express a vast variety of complex conditions. In order to understand these more complex scripts, we must first understand the basics of transaction scripts and script language.</p>
</div>
<div class="paragraph data-line-1690">
<p>Nesta se√ß√£o, demonstraremos os componentes b√°sicos da linguagem de script da transa√ß√£o de bitcoin e mostraremos como ela pode ser usada para expressar condi√ß√µes simples para que o dinheiro seja gasto e como essas condi√ß√µes podem ser satisfeitas atrav√©s de scripts de destravamento.</p>
</div>
<div class="admonitionblock tip data-line-1693">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1694">
<p>A valida√ß√£o da transa√ß√£o de bitcoin n√£o √© baseada em um padr√£o est√°tico, em vez disso, ela √© obtida atrav√©s da execu√ß√£o de uma linguagem de script. Essa linguagem permite que uma variedade quase infinita de condi√ß√µes seja expressa. √â dessa maneira que o bitcoin recebe o poder de ser um "dinheiro program√°vel".</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1698">
<p>==== Incompletude de Turing</p>
</div>
<div class="paragraph data-line-1700">
<p>The bitcoin transaction script language contains many operators, but is deliberately limited in one important way&#8212;&#8203;there are no loops or complex flow control capabilities other than conditional flow control. This ensures that the language is not <em>Turing Complete</em>, meaning that scripts have limited complexity and predictable execution times. Script is not a general-purpose language. These limitations ensure that the language cannot be used to create an infinite loop or other form of "logic bomb" that could be embedded in a transaction in a way that causes a denial-of-service attack against the Bitcoin network. Remember, every transaction is validated by every full node on the Bitcoin network. A limited language prevents the transaction validation mechanism from being used as a vulnerability.</p>
</div>
<div class="paragraph data-line-1702">
<p>==== Verifica√ß√£o sem Estado</p>
</div>
<div class="paragraph data-line-1704">
<p>The bitcoin transaction script language is stateless, in that there is no state prior to execution of the script, or state saved after execution of the script. Therefore, all the information needed to execute a script is contained within the script. A script will predictably execute the same way on any system. If your system verifies a script, you can be sure that every other system in the Bitcoin network will also verify the script, meaning that a valid transaction is valid for everyone and everyone knows this. This predictability of outcomes is an essential benefit of the Bitcoin system.</p>
</div>
<div id="tx_lock_unlock" class="paragraph data-line-1707">
<p>==== Constru√ß√£o do Script (Travamento + Destravamento)</p>
</div>
<div class="paragraph data-line-1709">
<p>O mecanismo de valida√ß√£o de transa√ß√µes do bitcoin conta com dois tipos de scripts para validar transa√ß√µes: um script de travamento e um script de destravamento.</p>
</div>
<div class="paragraph data-line-1711">
<p>A locking script is a spending condition placed on an output: it specifies the conditions that must be met to spend the output in the future. Historically, the locking script was called a <em>scriptPubKey</em>, because it usually contained a public key or Bitcoin address (public key hash). In this book we refer to it as a "locking script" to acknowledge the much broader range of possibilities of this scripting technology. In most bitcoin applications, what we refer to as a locking script will appear in the source code as scriptPubKey. You will also see the locking script referred to as a <em>witness script</em> (see <a href="#segwit">[segwit]</a>) or more generally as a <em>cryptographic puzzle</em>. These terms all mean the same thing, at different levels of abstraction.</p>
</div>
<div class="paragraph data-line-1713">
<p>Um script de destravamento √© um script que "resolve", ou satisfaz, as condi√ß√µes que foram colocadas em uma sa√≠da por um script de travamento, permitindo que a sa√≠da seja gasta. Os scripts de destravamento fazem parte de todas as entradas de transa√ß√£o. Na maioria das vezes, eles cont√™m uma assinatura digital produzida pela carteira do usu√°rio a partir de sua chave privada. Historicamente, o script de destravamento era chamado de <em>scriptSig</em>, porque ele geralmente continha uma assinatura digital. Na maioria das aplica√ß√µes de bitcoin, o c√≥digo-fonte refere-se ao script de destravamento como scriptSig. Voc√™ tamb√©m ver√° o script de destravamento sendo referido como uma <em>testemunha</em> (em ingl√™s, <em>witness</em>) (ver <a href="#segwit">[segwit]</a>). Neste livro, nos referimos a ele como um "script de destravamento", para reconhecer a gama muito maior de exig√™ncias dos scripts de travamento, pois nem todos os scripts de destravamento precisam conter assinaturas.</p>
</div>
<div class="paragraph data-line-1715">
<p>Cada n√≥ validador do bitcoin validar√° transa√ß√µes ao executar os scripts de travamento e destravamento juntos. Cada entrada cont√©m um script de destravamento e refere-se a uma UTXO previamente existente. O software de valida√ß√£o copiar√° o script de destravamento, recuperar√° a UTXO referenciada pela entrada e copiar√° o script de travamento dessa UTXO. A seguir, os scripts de destravamento e travamento s√£o executados em sequ√™ncia. A entrada √© considerada v√°lida se o script de destravamento satisfizer as condi√ß√µes do script de travamento (ver <a href="#script_exec">[script_exec]</a>). Todas as entradas s√£o validadas de forma independente, como parte da valida√ß√£o geral da transa√ß√£o.</p>
</div>
<div class="paragraph data-line-1717">
<p>Como a UTXO √© armazenada permanentemente na blockchain, ela √© invari√°vel, n√£o sendo afetada por tentativas fracassadas de gast√°-la atrav√©s de uma refer√™ncia em uma nova transa√ß√£o. Somente uma transa√ß√£o v√°lida, que satisfa√ßa corretamente as condi√ß√µes da sa√≠da, far√° com que uma sa√≠da seja considerada "gasta" e seja removida do conjunto de sa√≠das de transa√ß√£o n√£o gastas (conjunto UTXO).</p>
</div>
<div class="paragraph data-line-1719">
<p>A <a href="#scriptSig_and_scriptPubKey">Combinando o scriptSig e o scriptPubKey para avaliar um script de transa√ß√£o</a> √© um exemplo de scripts de destravamento e travamento para o tipo mais comum de transa√ß√£o de bitcoin (um pagamento para um hash de endere√ßo p√∫blico), demonstrando o script combinado resultante da concatena√ß√£o dos scripts de destravamento e travamento antes da valida√ß√£o do script.</p>
</div>
<div id="scriptSig_and_scriptPubKey" class="imageblock data-line-1723">
<div class="content">
<img src="images/mbc2_0603.png" alt="scriptSig_and_scriptPubKey">
</div>
<div class="title">Figure 38. Combinando o scriptSig e o scriptPubKey para avaliar um script de transa√ß√£o</div>
</div>
<div class="paragraph data-line-1725">
<p>===== O stack de execu√ß√£o do script</p>
</div>
<div class="paragraph data-line-1727">
<p>A linguagem de script do bitcoin √© considerada uma linguagem baseada em stack, pois ela usa uma estrutura de dados chamada de <em>stack</em> (em portugu√™s, <em>pilha</em>). Um stack √© uma estrutura de dados muito simples, que pode ser imaginada como uma pilha de cartas de baralho. Um stack permite duas opera√ß√µes: adicionar ("push") e remover ("pop"). "Adicionar" ("push") adiciona um item no topo da pilha. "Remover" ("pop") retira o item que est√° no topo da pilha. As opera√ß√µes em uma pilha s√≥ podem agir no item que est√° no topo da pilha. Uma estrutura de dados em pilha tamb√©m √© chamada de Last-In-First-Out (o √∫ltimo a entrar √© o primeiro a sair) ou fila "LIFO".</p>
</div>
<div class="paragraph data-line-1729">
<p>A linguagem de script executa o script ao processar cada item da esquerda para a direita. Os n√∫meros (constantes de dados) s√£o adicionados no stack. Os operadores adicionam (push) ou removem (pop) um ou mais par√¢metros do stack, atuam neles e podem adicionar um resultado no stack. Por exemplo, o operador OP_ADD ir√° remover dois itens do stack, som√°-los e adicionar o resultado da soma no stack.</p>
</div>
<div class="paragraph data-line-1731">
<p>Os operadores condicionais avaliam uma condi√ß√£o, produzindo um resultado booleano TRUE (VERDADEIRO) ou FALSE (FALSO). Por exemplo, OP_EQUAL remove (pop) dois itens do stack e adiciona TRUE (TRUE representado pelo n√∫mero 1) se eles forem iguais ou FALSE (representado por zero) se eles n√£o forem iguais. Os scripts de transa√ß√£o do bitcoin geralmente cont√™m um operador condicional, de maneira que eles possam produzir o resultado TRUE que significa uma transa√ß√£o v√°lida.</p>
</div>
<div class="paragraph data-line-1733">
<p>===== Um script simples</p>
</div>
<div class="paragraph data-line-1735">
<p>Agora vamos aplicar o que aprendemos sobre scripts e stacks a alguns exemplos simples.</p>
</div>
<div class="paragraph data-line-1737">
<p>Na <a href="#simplemath_script">Script de valida√ß√£o do bitcoin fazendo uma conta matem√°tica simples</a>, o script 2 3 OP_ADD 5 OP_EQUAL demonstra o operador de adi√ß√£o aritm√©tica OP_ADD somando dois n√∫meros e colocando o resultado no stack, seguido pelo operador condicional OP_EQUAL, que verifica se a soma resultante √© igual a 5. Para simplificar, o prefixo OP_ √© omitido no exemplo passo-a-passo. Para obter mais detalhes sobre os operadores de script e as fun√ß√µes dispon√≠veis, consulte o <a href="#tx_script_ops">[tx_script_ops]</a>.</p>
</div>
<div class="paragraph data-line-1739">
<p>Although most locking scripts refer to a public key hash (essentially, a Bitcoin address), thereby requiring proof of ownership to spend the funds, the script does not have to be that complex. Any combination of locking and unlocking scripts that results in a TRUE value is valid. The simple arithmetic we used as an example of the scripting language is also a valid locking script that can be used to lock a transaction output.</p>
</div>
<div class="paragraph data-line-1741">
<p>Use parte do script de exemplo aritm√©tico como sendo o script de travamento:</p>
</div>
<div class="listingblock data-line-1743">
<div class="content">
<pre>3 OP_ADD 5 OP_EQUAL</pre>
</div>
</div>
<div class="paragraph data-line-1747">
<p>que pode ser satisfeito atrav√©s de uma transa√ß√£o contendo uma entrada com o script de destravamento:</p>
</div>
<div class="listingblock data-line-1749">
<div class="content">
<pre>2</pre>
</div>
</div>
<div class="paragraph data-line-1753">
<p>O software de valida√ß√£o combina os scripts de travamento e de destravamento e o script resultante √©:</p>
</div>
<div class="listingblock data-line-1755">
<div class="content">
<pre>2 3 OP_ADD 5 OP_EQUAL</pre>
</div>
</div>
<div class="paragraph data-line-1759">
<p>Conforme vimos no exemplo passo-a-passo da <a href="#simplemath_script">Script de valida√ß√£o do bitcoin fazendo uma conta matem√°tica simples</a>, quando o script √© executado, o resultado √© OP_TRUE, tornando a transa√ß√£o v√°lida. N√£o apenas esse √© um script de travamento v√°lido, como tamb√©m a UTXO resultante poderia ser gasta por qualquer pessoa que tivesse as habilidades aritm√©ticas para saber que o n√∫mero 2 satisfaz o script.</p>
</div>
<div class="admonitionblock tip data-line-1762">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1763">
<p>As transa√ß√µes s√£o v√°lidas se o resultado no topo do stack for TRUE (definido como &amp;#x7b;0x01&amp;#x7d;), qualquer valor diferente de zero, n√£o OP_0, ou se o stack estiver vazio ap√≥s a execu√ß√£o do script. As transa√ß√µes s√£o inv√°lidas se o valor do topo do stack for FALSE (um valor vazio de comprimento zero, definido como &amp;#x7b;&amp;#x7d;) ou se a execu√ß√£o do script for suspensa por um operador, como o OP_VERIFY, o OP_RETURN ou um terminador condicional como o OP_ENDIF. Veja o <a href="#tx_script_ops">[tx_script_ops]</a> para mais detalhes.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="simplemath_script" class="imageblock data-line-1768">
<div class="content">
<img src="images/mbc2_0604.png" alt="TxScriptSimpleMathExample">
</div>
<div class="title">Figure 39. Script de valida√ß√£o do bitcoin fazendo uma conta matem√°tica simples</div>
</div>
<div class="paragraph pagebreak-before data-line-1771">
<p>O script a seguir √© um pouco mais complexo, que calcula 2 + 7 - 3 + 1. Note que quando o script cont√©m v√°rios operadores em uma linha, o stack permite que os resultados de um operador sejam usados pelo pr√≥ximo operador:</p>
</div>
<div class="listingblock data-line-1773">
<div class="content">
<pre>2 7 OP_ADD 3 OP_SUB 1 OP_ADD 7 OP_EQUAL</pre>
</div>
</div>
<div class="paragraph data-line-1777">
<p>Tente voc√™ mesmo validar o script anterior usando papel e caneta. Quando a execu√ß√£o do script terminar, voc√™ deve ficar com o valor TRUE no stack.</p>
</div>
<div id="script_exec" class="paragraph data-line-1780">
<p>===== Execu√ß√£o separada de scripts de destravamento e travamento</p>
</div>
<div class="paragraph data-line-1782">
<p>In the original Bitcoin client, the unlocking and locking scripts were concatenated and executed in sequence. For security reasons, this was changed in 2010, because of a vulnerability that allowed a malformed unlocking script to push data onto the stack and corrupt the locking script. In the current implementation, the scripts are executed separately with the stack transferred between the two executions, as described next.</p>
</div>
<div class="paragraph data-line-1784">
<p>Primeiro, o script de destravamento √© executado, usando o mecanismo de execu√ß√£o do stack. Se o script de destravamento for executado sem erros (por exemplo, ele n√£o possui ponteiros "pendentes" faltando), o stack principal √© copiado e o script de travamento √© executado. Se o resultado da execu√ß√£o do script de travamento com os dados do stack copiados a partir do script de destravamento for "TRUE", o script de destravamento teve sucesso em resolver as condi√ß√µes impostas pelo script de travamento e, portanto, a entrada √© uma autoriza√ß√£o v√°lida para gastar a UTXO. Se qualquer resultado diferente de "TRUE" permanecer ap√≥s a execu√ß√£o do script combinado, a entrada √© inv√°lida, pois ela n√£o conseguiu satisfazer as condi√ß√µes de gasto impostas na UTXO.</p>
</div>
<div id="p2pkh" class="paragraph data-line-1788">
<p>==== Pay-to-Public-Key-Hash (P2PKH)</p>
</div>
<div class="paragraph data-line-1790">
<p>The vast majority of transactions processed on the Bitcoin network spend outputs locked with a Pay-to-Public-Key-Hash or "P2PKH" script. These outputs contain a locking script that locks the output to a public key hash, more commonly known as a Bitcoin address. An output locked by a P2PKH script can be unlocked (spent) by presenting a public key and a digital signature created by the corresponding private key (see <a href="#digital_sigs">[digital_sigs]</a>).</p>
</div>
<div class="paragraph data-line-1792">
<p>For example, let&#8217;s look at Alice&#8217;s payment to Bob&#8217;s Cafe again. Alice made a payment of 0.015 bitcoin to the cafe&#8217;s Bitcoin address. That transaction output would have a locking script of the form:</p>
</div>
<div class="listingblock data-line-1794">
<div class="content">
<pre>OP_DUP OP_HASH160 &lt;Hash da Chave P√∫blica do Caf√©&gt; OP_EQUALVERIFY OP_CHECKSIG</pre>
</div>
</div>
<div class="paragraph data-line-1798">
<p>The Cafe Public Key Hash is equivalent to the Bitcoin address of the cafe, without the Base58Check encoding. Most applications would show the <em>public key hash</em> in hexadecimal encoding and not the familiar Bitcoin address Base58Check format that begins with a "1."</p>
</div>
<div class="paragraph data-line-1800">
<p>O script de travamento anterior pode ser satisfeito com um script de destravamento com o seguinte formato:</p>
</div>
<div class="listingblock data-line-1802">
<div class="content">
<pre>&lt;Assinatura do Caf√©&gt; &lt;Chave P√∫blica do Caf√©&gt;</pre>
</div>
</div>
<div class="paragraph data-line-1806">
<p>Os dois scripts juntos formariam o seguinte script de valida√ß√£o combinado:</p>
</div>
<div class="listingblock data-line-1808">
<div class="content">
<pre>&lt;Assinatura do Caf√©&gt; &lt;Chave P√∫blica do Caf√©&gt; OP_DUP OP_HASH160
&lt;Hash da Chave P√∫blica do Caf√©&gt; OP_EQUALVERIFY OP_CHECKSIG</pre>
</div>
</div>
<div class="paragraph data-line-1813">
<p>Quando executado, esse script combinado resultar√° em TRUE se, e somente se, o script de destravamento preencher as condi√ß√µes definidas pelo script de travamento. Em outras palavras, o resultado ser√° TRUE se o script de destravamento tiver uma assinatura v√°lida da chave privada do caf√© que corresponda ao hash de chave p√∫blica que foi definido como uma trava.</p>
</div>
<div class="paragraph data-line-1815">
<p>As Figuras <a data-type="xref" href="#P2PubKHash1" data-xrefstyle="select: labelnumber">#P2PubKHash1</a> e <a data-type="xref" href="#P2PubKHash2" data-xrefstyle="select: labelnumber">#P2PubKHash2</a> demonstram (em duas partes) uma execu√ß√£o passo-a-passo do script combinado, que provar√° que essa √© uma transa√ß√£o v√°lida.</p>
</div>
<div id="P2PubKHash1" class="imageblock data-line-1819">
<div class="content">
<img src="images/mbc2_0605.png" alt="Tx_Script_P2PubKeyHash_1">
</div>
<div class="title">Figure 40. Avaliando um script para uma transa√ß√£o P2PKH (parte 1 de 2)</div>
</div>
<div id="P2PubKHash2" class="imageblock data-line-1823">
<div class="content">
<img src="images/mbc2_0606.png" alt="Tx_Script_P2PubKeyHash_2">
</div>
<div class="title">Figure 41. Avaliando um script para uma transa√ß√£o P2PKH (parte 2 de 2)</div>
</div>
<div id="digital_sigs" class="paragraph data-line-1826">
<p>=== Assinaturas Digitais (ECDSA)</p>
</div>
<div class="paragraph data-line-1828">
<p>At√© agora, n√£o nos aprofundamos em detalhes sobre as "assinaturas digitais". Nesta se√ß√£o, veremos como as assinaturas digitais funcionam e como elas podem apresentar uma prova de posse de uma chave privada sem revelar essa chave privada.</p>
</div>
<div class="paragraph data-line-1830">
<p>O algoritmo de assinatura digital usado no bitcoin √© o <em>Algoritmo de Assinatura Digital de Curva El√≠ptica</em> (em ingl√™s, <em>Elliptic Curve Digital Signature Algorithm</em> ou <em>ECDSA</em>). O ECDSA √© o algoritmo usado para assinaturas digitais com base em pares de chaves privadas/p√∫blicas em curva el√≠ptica, conforme descrito em <a href="#elliptic_curve">[elliptic_curve]</a>. O ECDSA √© usado pelas fun√ß√µes de script OP_CHECKSIG, OP_CHECKSIGVERIFY, OP_CHECKMULTISIG e OP_CHECKMULTISIGVERIFY. Sempre que voc√™ encontrar essas fun√ß√µes em um script de travamento, o script de destravamento necessariamente precisa conter uma assinatura ECDSA.</p>
</div>
<div class="paragraph data-line-1832">
<p>Uma assinatura digital tem tr√™s finalidades no bitcoin. Primeiro, a assinatura prova que o propriet√°rio da chave privada, que se subentende ser o propriet√°rio dos fundos, <em>autorizou</em> o gasto desses fundos. Em segundo lugar, a prova de autoriza√ß√£o √© <em>ineg√°vel</em> (n√£o rep√∫dio). Em terceiro lugar, a assinatura prova que a transa√ß√£o (ou partes espec√≠ficas da transa√ß√£o) n√£o foi e <em>n√£o pode ser modificada</em> por ningu√©m ap√≥s ter sido assinada.</p>
</div>
<div class="paragraph data-line-1834">
<p>Observe que cada entrada de transa√ß√£o √© assinada de forma independente. Isso √© fundamental, pois nem as assinaturas nem as entradas precisam pertencer ou serem usadas pelos mesmos "donos". Um esquema espec√≠fico de transa√ß√£o chamado "CoinJoin" usa esse fato para criar transa√ß√µes com entradas de diferentes usu√°rios com o objetivo de se obter maior privacidade.</p>
</div>
<div class="admonitionblock note data-line-1837">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-1838">
<p>Cada entrada de transa√ß√£o e qualquer assinatura que ela possa conter √© <em>completamente</em> independente de qualquer outra entrada ou assinatura. V√°rios usu√°rios podem se unir para construir transa√ß√µes em que cada um assina apenas uma √∫nica entrada.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph data-line-541">
<p>Uma assinatura digital √© um esquema matem√°tico usado para demonstrar a autenticidade de uma mensagem ou documentos digitais. Uma assinatura digital v√°lida d√° ao destinat√°rio motivos para acreditar que a mensagem foi criada por um remetente conhecido (autentica√ß√£o), que o remetente n√£o pode negar ter enviado da mensagem (n√£o rep√∫dio) e que a mensagem n√£o foi alterada em tr√¢nsito (integridade).</p>
</div>
<div class="paragraph data-line-543">
<p><em>Fonte: <a href="https://en.wikipedia.org/wiki/Digital_signature" class="undefined" data-href="https://en.wikipedia.org/wiki/Digital_signature">https://en.wikipedia.org/wiki/Digital_signature</a></em></p>
</div>
<div class="sidebarblock data-line-544">
<div class="content">
<div class="paragraph data-line-546">
<p>==== Como Funcionam as Assinaturas Digitais</p>
</div>
<div class="paragraph data-line-548">
<p>Uma assinatura digital √© um <em>esquema matem√°tico</em> que consiste em duas partes. A primeira parte √© um algoritmo usado para criar uma assinatura, usando uma chave privada (a chave de assinatura), a partir de uma mensagem (a transa√ß√£o). A segunda parte √© um algoritmo que permite a qualquer pessoa verificar a assinatura, caso seja fornecida a mensagem e uma chave p√∫blica.</p>
</div>
<div class="paragraph data-line-550">
<p>===== Criando uma assinatura digital</p>
</div>
<div class="paragraph data-line-552">
<p>Na implementa√ß√£o do bitcoin do algoritmo ECDSA, a "mensagem" sendo assinada √© a transa√ß√£o, ou, mais precisamente, um hash de um subconjunto espec√≠fico dos dados inclu√≠dos na transa√ß√£o (ver <a href="#sighash_types">[sighash_types]</a>). A chave de assinatura √© a chave privada do usu√°rio. O resultado √© a assinatura:</p>
</div>
<div class="paragraph data-line-554">
<p>\(\(Sig = F_{sig}(F_{hash}(m), dA)\)\)</p>
</div>
<div class="paragraph data-line-556">
<p>onde:</p>
</div>
<div class="ulist data-line-558">
<ul>
<li class="data-line-558">
<p><em>dA</em> √© a chave privada que assina</p>
</li>
<li class="data-line-559">
<p><em>m</em> √© a transa√ß√£o (ou partes dela)</p>
</li>
<li class="data-line-560">
<p><em>F</em><sub><em>hash</em></sub> √© a fun√ß√£o de hash</p>
</li>
<li class="data-line-561">
<p><em>F</em><sub><em>sig</em></sub> √© o algoritmo de assinatura</p>
</li>
<li class="data-line-562">
<p><em>Sig</em> √© a assinatura resultante</p>
</li>
</ul>
</div>
<div class="paragraph data-line-564">
<p>Mais detalhes sobre a matem√°tica do Algoritmo de Assinatura Digital de Curva El√≠ptica (ECDSA) podem ser encontrados em <a href="#ecdsa_math">[ecdsa_math]</a>.</p>
</div>
<div class="paragraph data-line-566">
<p>A fun√ß√£o <em>F</em><sub><em>sig</em></sub> produz uma assinatura Sig que √© composta de dois valores, comumente referidos como R e S:</p>
</div>
<div class="listingblock data-line-568">
<div class="content">
<pre>Sig = (R, S)</pre>
</div>
</div>
<div class="paragraph data-line-572">
<p>Agora que os dois valores R e S foram calculados, eles s√£o serializados em um fluxo de bytes usando um esquema de codifica√ß√£o padronizado internacional denominado <em>Regras de Codifica√ß√£o Distintas</em> (em ingl√™s, <em>Distinguished Encoding Rules</em> ou <em>DER</em>).</p>
</div>
<div id="seralization_of_signatures_der" class="paragraph data-line-575">
<p>===== Serializa√ß√£o de assinaturas (DER)</p>
</div>
<div class="paragraph data-line-577">
<p>Vejamos novamente a transa√ß√£o que a Alice criou. Na entrada da transa√ß√£o, h√° um script de destravamento que cont√©m a seguinte assinatura codificada em DER pela carteira da Alice:</p>
</div>
<div class="listingblock data-line-579">
<div class="content">
<pre>3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e381301</pre>
</div>
</div>
<div class="paragraph data-line-583">
<p>Essa assinatura √© um stream de bytes serializado dos valores R e S produzidos pela carteira da Alice para provar que ela possui a chave privada autorizada a gastar aquela sa√≠da. O formato de serializa√ß√£o consiste em nove elementos, abaixo descritos:</p>
</div>
<div class="ulist data-line-585">
<ul>
<li class="data-line-585">
<p>0x30&#x2014;indicando o in√≠cio de uma sequ√™ncia DER</p>
</li>
<li class="data-line-586">
<p>0x45&#x2014;o comprimento da sequ√™ncia (69 bytes)</p>
</li>
<li class="data-line-587">
<p>0x02&#x2014;segue-se um valor inteiro</p>
</li>
<li class="data-line-588">
<p>0x21&#x2014;o comprimento do n√∫mero inteiro (33 bytes)</p>
</li>
<li class="data-line-589">
<p>R&#x2014;00884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb</p>
</li>
<li class="data-line-590">
<p>0x02&#x2014;segue-se um outro valor inteiro</p>
</li>
<li class="data-line-591">
<p>0x20&#x2014;o comprimento do n√∫mero inteiro (32 bytes)</p>
</li>
<li class="data-line-592">
<p>S&#x2014;4b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813</p>
</li>
<li class="data-line-593">
<p>Um sufixo (0x01) indicando o tipo de hash utilizado (SIGHASH_ALL)</p>
</li>
</ul>
</div>
<div class="paragraph data-line-595">
<p>Veja se voc√™ consegue decodificar a assinatura serializada da Alice (codificada em DER) usando esta lista. Os n√∫meros importantes s√£o R e S; o restante dos dados faz parte do esquema de codifica√ß√£o DER.</p>
</div>
<div class="paragraph data-line-597">
<p>==== Verificando a Assinatura</p>
</div>
<div class="paragraph data-line-599">
<p>Para verificar a assinatura, deve-se ter a assinatura (R e S), a transa√ß√£o serializada e a chave p√∫blica (que corresponde √† chave privada usada para criar a assinatura). Essencialmente, a verifica√ß√£o de uma assinatura significa "Apenas o propriet√°rio da chave privada que gerou esta chave p√∫blica poderia ter produzido esta assinatura nesta transa√ß√£o".</p>
</div>
<div class="paragraph data-line-601">
<p>O algoritmo de verifica√ß√£o de assinatura pega a mensagem (um hash da transa√ß√£o ou partes dela), a chave p√∫blica do signat√°rio e a assinatura (valores R e S) e retorna TRUE se a assinatura for v√°lida para esta mensagem e esta chave p√∫blica.</p>
</div>
<div id="sighash_types" class="paragraph data-line-604">
<p>==== Tipos de Hash de Assinatura (SIGHASH)</p>
</div>
<div class="paragraph data-line-606">
<p>As assinaturas digitais s√£o aplicadas √†s mensagens, que, no caso do bitcoin, s√£o as pr√≥prias transa√ß√µes. A assinatura implica um <em>compromisso</em> (um comprometimento) por parte do signat√°rio com dados de transa√ß√£o espec√≠ficos. Na forma mais simples, a assinatura se aplica a toda a transa√ß√£o, comprometendo-se com todas as entradas, todas as sa√≠das e todos os outros campos da transa√ß√£o. No entanto, uma assinatura pode comprometer-se com apenas um subconjunto dos dados em uma transa√ß√£o, o que √© √∫til para v√°rios cen√°rios, como veremos nesta se√ß√£o.</p>
</div>
<div class="paragraph data-line-608">
<p>Ao utilizar um sinalizador SIGHASH, as assinaturas do bitcoin t√™m uma maneira de indicar qual parte dos dados de uma transa√ß√£o est√° inclu√≠da no hash assinado pela chave privada. O sinalizador SIGHASH √© um √∫nico byte que √© anexado √† assinatura. Cada assinatura tem um sinalizador SIGHASH e o sinalizador pode ser diferente de entrada para entrada. Uma transa√ß√£o com tr√™s entradas assinadas pode ter tr√™s assinaturas com diferentes sinalizadores SIGHASH, cada assinatura assinando (comprometendo-se com) diferentes partes da transa√ß√£o.</p>
</div>
<div class="paragraph data-line-610">
<p>Remember, each input may contain a signature in its unlocking script. As a result, a transaction that contains several inputs may have signatures with different SIGHASH flags that commit different parts of the transaction in each of the inputs. Note also that bitcoin transactions may contain inputs from different "owners," who may sign only one input in a partially constructed (and invalid) transaction, collaborating with others to gather all the necessary signatures to make a valid transaction. Many of the SIGHASH flag types only make sense if you think of multiple participants collaborating outside the Bitcoin network and updating a partially signed transaction.</p>
</div>
<div class="paragraph pagebreak-before data-line-613">
<p>Existem tr√™s sinalizadores SIGHASH: ALL, NONE e SINGLE, conforme mostrado na <a href="#sighash_types_and_their">Tipos de SIGHASH e seus significados</a>.</p>
</div>
<table id="sighash_types_and_their" class="tableblock frame-all grid-all stretch data-line-618">
<caption class="title">Table 19. Tipos de SIGHASH e seus significados</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sinalizador SIGHASH</th>
<th class="tableblock halign-left valign-top">Valor</th>
<th class="tableblock halign-left valign-top">Descri√ß√£o</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A assinatura se aplica a todas as entradas e sa√≠das</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NONE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A assinatura se aplica a todas as entradas e nenhuma das sa√≠das</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SINGLE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A assinatura se aplica a todas as entradas, mas somente √† sa√≠da com o mesmo n√∫mero √≠ndice da entrada assinada</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-625">
<p>Al√©m disso, h√° um sinalizador modificador SIGHASH_ANYONECANPAY, que pode ser combinado com cada um dos sinalizadores anteriores. Quando ANYONECANPAY √© definido, apenas uma entrada √© assinada, deixando o resto (e seus n√∫meros de sequ√™ncia) abertos para modifica√ß√£o. O ANYONECANPAY tem o valor 0x80 e √© aplicado pelo operador bitwise OR, resultando nos sinalizadores combinados mostrados na <a href="#sighash_types_with_modifiers">Tipos de SIGHASH com modificadores e seus significados</a>.</p>
</div>
<table id="sighash_types_with_modifiers" class="tableblock frame-all grid-all stretch data-line-630">
<caption class="title">Table 20. Tipos de SIGHASH com modificadores e seus significados</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sinalizador SIGHASH</th>
<th class="tableblock halign-left valign-top">Valor</th>
<th class="tableblock halign-left valign-top">Descri√ß√£o</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL|ANYONECANPAY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x81</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A assinatura se aplica a uma entrada e todas as sa√≠das</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NONE|ANYONECANPAY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x82</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A assinatura se aplica a uma entrada e nenhuma das sa√≠das</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SINGLE|ANYONECANPAY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x83</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A assinatura se aplica a uma entrada e √† sa√≠da com o mesmo n√∫mero √≠ndice</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-637">
<p>Essas combina√ß√µes de sinalizadores est√£o resumidas na <a href="#sighash_combinations">Resumo das diferentes combina√ß√µes de sighash</a>.</p>
</div>
<div id="sighash_combinations" class="imageblock data-line-641">
<div class="content">
<img src="images/sighash_combinations.png" alt="Summary of different SIGHASH flag combinations">
</div>
<div class="title">Figure 42. Resumo das diferentes combina√ß√µes de sighash</div>
</div>
<div class="paragraph data-line-643">
<p>Os sinalizadores SIGHASH s√£o aplicados durante a assinatura e a verifica√ß√£o de uma maneira que uma c√≥pia da transa√ß√£o √© feita e certos campos dentro dela s√£o truncados (s√£o definidos para comprimento zero e esvaziados). A transa√ß√£o resultante √© serializada. O sinalizador SIGHASH √© adicionado ao final da transa√ß√£o serializada e o resultado √© transformado em um hash. O pr√≥prio hash √© a "mensagem" que √© assinada. Dependendo de qual sinalizador SIGHASH for usado, diferentes partes da transa√ß√£o s√£o truncadas. O hash resultante depende de diferentes subconjuntos dos dados na transa√ß√£o. Ao incluir o SIGHASH na √∫ltima etapa antes de transformar em hash, a assinatura tamb√©m compromete-se com o tipo do SIGHASH, de maneira que ele n√£o possa ser alterado no futuro (por exemplo, por um minerador).</p>
</div>
<div class="admonitionblock note data-line-646">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-647">
<p>Todos os tipos de SIGHASH assinam o campo nLocktime da transa√ß√£o (ver <a href="#transaction_locktime_nlocktime">[transaction_locktime_nlocktime]</a>). Al√©m disso, o pr√≥prio tipo do SIGHASH √© anexado √† transa√ß√£o antes de ela ser assinada, de modo que ele n√£o possa ser modificado depois de a transa√ß√£o ser assinada.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-650">
<p>No exemplo da transa√ß√£o da Alice (ver a lista em <a href="#seralization_of_signatures_der">[seralization_of_signatures_der]</a>), vimos que a √∫ltima parte da assinatura codificada em DER era 01, que √© o sinalizador SIGHASH_ALL. Isso trava os dados da transa√ß√£o, portanto a assinatura da Alice est√° comprometendo-se com o estado de todas as entradas e sa√≠das. Esta √© a forma de assinatura mais comum.</p>
</div>
<div class="paragraph data-line-652">
<p>Vejamos alguns dos outros tipos de SIGHASH e como eles podem ser usados na pr√°tica:</p>
</div>
<div class="dlist data-line-654">
<dl>
<dt class="hdlist1">ALL|ANYONECANPAY </dt>
<dd>
<p>Esta constru√ß√£o pode ser usada para fazer uma transa√ß√£o de "financiamento coletivo". Algu√©m tentando arrecadar fundos pode construir uma transa√ß√£o com uma √∫nica sa√≠da. A sa√≠da √∫nica da transa√ß√£o paga o valor da "meta" para a pessoa que est√° arrecadando os fundos. Essa transa√ß√£o obviamente n√£o √© v√°lida, pois ela n√£o tem entradas. No entanto, outras pessoas agora podem alter√°-la adicionando suas pr√≥prias entradas, como uma doa√ß√£o. Elas assinam suas pr√≥prias entradas com ALL|ANYONECANPAY. A menos que entradas suficientes sejam coletadas para atingir o valor da sa√≠da, a transa√ß√£o √© inv√°lida. Cada doa√ß√£o serve como uma garantia de pagamento, que n√£o pode ser coletada pela pessoa que est√° arrecadando os fundos at√© que todo o valor da meta tenha sido arrecadado.</p>
</dd>
<dt class="hdlist1">NONE </dt>
<dd>
<p>This construction can be used to create a "bearer check" or "blank check" of a specific amount. It commits to the input, but allows the output locking script to be changed. Anyone can write their own Bitcoin address into the output locking script and redeem the transaction. However, the output value itself is locked by the signature.</p>
</dd>
<dt class="hdlist1">NONE|ANYONECANPAY </dt>
<dd>
<p>Esta constru√ß√£o pode ser usada para construir um "coletor de p√≥". Os usu√°rios que t√™m UTXOs min√∫sculas em suas carteiras n√£o conseguem gast√°-las, pois o custo em taxas √© maior do que o valor dessas UTXOs p√≥. Com este tipo de assinatura, pode-se doar as UTXOs p√≥ para qualquer pessoa agreg√°-las e gast√°-las quando quiser.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-660">
<p>Existem algumas propostas para modificar ou expandir o sistema SIGHASH. Uma dessas propostas √© a <em>Bitmask Sighash Modes</em> feita por Glenn Willen da Blockstream, como parte do projeto Elements. O objetivo √© criar uma substitui√ß√£o flex√≠vel para os tipos de SIGHASH que permite a cria√ß√£o de "bitmasks de entradas e sa√≠das que sejam arbitr√°rios e regrav√°veis pelos mineradores" e que possam expressar "esquemas de pr√©-compromisso contratual mais complexos, como ofertas assinadas com troco em uma troca de ativos distribu√≠da".</p>
</div>
<div class="admonitionblock note data-line-663">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-664">
<p>Voc√™ n√£o ver√° os sinalizadores SIGHASH apresentados como uma op√ß√£o no aplicativo de carteira do usu√°rio. Com poucas exce√ß√µes, as carteiras geralmente constroem scripts P2PKH e assinam com sinalizadores SIGHASH_ALL. Para usar um sinalizador SIGHASH diferente, voc√™ teria que escrever um software para construir e assinar transa√ß√µes. Ou seja, os sinalizadores SIGHASH geralmente s√£o usados por aplicativos de bitcoin de prop√≥sito especial que permitem novos usos.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="ecdsa_math" class="paragraph data-line-668">
<p>==== Matem√°tica do ECDSA</p>
</div>
<div class="paragraph data-line-670">
<p>Conforme mencionado anteriormente, as assinaturas s√£o criadas por uma fun√ß√£o matem√°tica <em>F</em><sub><em>sig</em></sub> que produz uma assinatura composta de dois valores, o valor <em>R</em> e o valor <em>S</em>. Nesta se√ß√£o, veremos a fun√ß√£o <em>F</em><sub><em>sig</em></sub> em maiores detalhes.</p>
</div>
<div class="paragraph data-line-672">
<p>O algoritmo de assinatura primeiro gera um par de chaves p√∫blicas privadas <em>ef√™meras</em> (tempor√°rias). Este par de chaves tempor√°rias √© usado no c√°lculo dos valores <em>R</em> e <em>S</em>, ap√≥s uma transforma√ß√£o envolvendo a chave privada de assinatura e o hash da transa√ß√£o.</p>
</div>
<div class="paragraph data-line-674">
<p>O par de chaves tempor√°rias √© baseado em um n√∫mero aleat√≥rio <em>k</em>, que √© usado como a chave privada tempor√°ria. A partir do <em>k</em>, geramos a chave p√∫blica tempor√°ria correspondente <em>P</em> (calculada como <em>P = k*G</em>, da mesma forma que as chaves p√∫blicas do bitcoin s√£o derivadas; ver <a href="#pubkey">[pubkey]</a>). O valor <em>R</em> da assinatura digital √© ent√£o a coordenada x da chave p√∫blica ef√™mera <em>P</em>.</p>
</div>
<div class="paragraph data-line-676">
<p>A partir da√≠, o algoritmo calcula o valor <em>S</em> da assinatura, de modo que:</p>
</div>
<div class="paragraph data-line-678">
<p><em>S</em> = <em>k</em><sup>-1</sup> (<em>Hash</em>(<em>m</em>) + <em>dA</em> * <em>R</em>) <em>mod n</em></p>
</div>
<div class="paragraph data-line-680">
<p>onde:</p>
</div>
<div class="ulist data-line-682">
<ul>
<li class="data-line-682">
<p><em>k</em> √© a chave privada ef√™mera</p>
</li>
<li class="data-line-683">
<p><em>R</em> √© a coordenada x da chave p√∫blica ef√™mera</p>
</li>
<li class="data-line-684">
<p><em>dA</em> √© a chave privada que assina</p>
</li>
<li class="data-line-685">
<p><em>m</em> s√£o os dados da transa√ß√£o</p>
</li>
<li class="data-line-686">
<p><em>n</em> √© a ordem prima da curva el√≠ptica</p>
</li>
</ul>
</div>
<div class="paragraph data-line-688">
<p>A verifica√ß√£o √© o inverso da fun√ß√£o de gera√ß√£o de assinatura, usando os valores <em>R</em>, <em>S</em> e a chave p√∫blica para calcular um valor <em>P</em>, que √© um ponto na curva el√≠ptica (a chave p√∫blica ef√™mera usada na cria√ß√£o da assinatura):</p>
</div>
<div class="paragraph data-line-690">
<p><em>P</em> = <em>S</em><sup>-1</sup> * <em>Hash</em>(<em>m</em>) * <em>G</em> + <em>S</em><sup>-1</sup> * <em>R</em> * <em>Qa</em></p>
</div>
<div class="paragraph data-line-692">
<p>onde:</p>
</div>
<div class="ulist data-line-694">
<ul>
<li class="data-line-694">
<p><em>R</em> e <em>S</em> s√£o os valores da assinatura</p>
</li>
<li class="data-line-695">
<p><em>Qa</em> √© a chave p√∫blica da Alice</p>
</li>
<li class="data-line-696">
<p><em>m</em> s√£o os dados da transa√ß√£o que foram assinados</p>
</li>
<li class="data-line-697">
<p><em>G</em> √© o ponto gerador da curva el√≠ptica</p>
</li>
</ul>
</div>
<div class="paragraph data-line-699">
<p>Se a coordenada x do ponto calculado <em>P</em> for igual a <em>R</em>, ent√£o o verificador pode concluir que a assinatura √© v√°lida.</p>
</div>
<div class="paragraph data-line-701">
<p>Observe que, ao verificar a assinatura, a chave privada n√£o √© conhecida nem revelada.</p>
</div>
<div class="admonitionblock tip data-line-704">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-705">
<p>ECDSA √© necessariamente uma pe√ßa matem√°tica bastante complicada; uma explica√ß√£o completa vai al√©m do escopo deste livro. Existe uma s√©rie de √≥timos guias na internet que podem o conduzir no passo a passo: pesquise por "ECDSA explicado" ou acesse este link: <a href="https://bit.ly/2r0HhGB" class="undefined" data-href="https://bit.ly/2r0HhGB">https://bit.ly/2r0HhGB</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-708">
<p>==== A Import√¢ncia da Aleatoriedade nas Assinaturas</p>
</div>
<div class="paragraph data-line-710">
<p>Conforme vimos em <a href="#ecdsa_math">[ecdsa_math]</a>, o algoritmo de gera√ß√£o de assinatura usa uma chave aleat√≥ria <em>k</em>, que serve como a base para a gera√ß√£o de um par de chaves p√∫blica/privada ef√™meras. O valor de <em>k</em> n√£o √© importante, <em>contanto que seja aleat√≥rio</em>. Se o mesmo valor <em>k</em> for usado para produzir duas assinaturas em diferentes mensagens (transa√ß√µes), a <em>chave privada</em> de assinatura poder√° ser calculada por qualquer pessoa. Ou seja, a reutiliza√ß√£o de um mesmo valor para <em>k</em> em um algoritmo de assinatura leva √† exposi√ß√£o da chave privada!</p>
</div>
<div class="admonitionblock warning data-line-713">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-714">
<p>Se o mesmo valor <em>k</em> for usado no algoritmo de assinatura em duas transa√ß√µes diferentes, a chave privada poder√° ser calculada e ser exposta por qualquer pessoa!</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-717">
<p>Esta n√£o √© apenas uma possibilidade te√≥rica. Vimos esse problema levar √† exposi√ß√£o de chaves privadas em algumas implementa√ß√µes diferentes de algoritmos de assinatura de transa√ß√£o no bitcoin. Algumas pessoas tiveram fundos roubados devido √† reutiliza√ß√£o inadvertida de um valor <em>k</em>. O motivo mais comum para a reutiliza√ß√£o de um valor <em>k</em> √© um gerador de n√∫mero aleat√≥rio inicializado incorretamente.</p>
</div>
<div class="paragraph data-line-719">
<p>Para evitar essa vulnerabilidade, a pr√°tica recomendada pela ind√∫stria √© n√£o gerar <em>k</em> com um gerador de n√∫mero aleat√≥rio semeado com entropia, mas, em vez disso, usar um processo determin√≠stico-aleat√≥rio semeado com os dados da pr√≥prio transa√ß√£o. Isso garante que cada transa√ß√£o produza um <em>k</em> diferente. O algoritmo padr√£o da ind√∫stria para inicializa√ß√£o determin√≠stica de <em>k</em> √© definido em <a href="https://tools.ietf.org/html/rfc6979" data-href="https://tools.ietf.org/html/rfc6979">RFC 6979</a>, publicado pela <em>Internet Engineering Task Force</em>.</p>
</div>
<div class="paragraph data-line-721">
<p>Se voc√™ estiver implementando um algoritmo para assinar transa√ß√µes no bitcoin, voc√™ <em>deve</em> usar o RFC 6979 ou um algoritmo determin√≠stico-aleat√≥rio semelhante para garantir a gera√ß√£o de um <em>k</em> diferente para cada transa√ß√£o.</p>
</div>
<div class="paragraph data-line-723">
<p>=== Endere√ßos, Saldos e Outras Abstra√ß√µes do Bitcoin</p>
</div>
<div class="paragraph data-line-725">
<p>We began this chapter with the discovery that transactions look very different "behind the scenes" than how they are presented in wallets, blockchain explorers, and other user-facing applications. Many of the simplistic and familiar concepts from the earlier chapters, such as Bitcoin addresses and balances, seem to be absent from the transaction structure. We saw that transactions don&#8217;t contain Bitcoin addresses, per se, but instead operate through scripts that lock and unlock discrete values of bitcoin. Balances are not present anywhere in this system and yet every wallet application prominently displays the balance of the user&#8217;s wallet.</p>
</div>
<div class="paragraph data-line-727">
<p>Agora que exploramos o que realmente est√° inclu√≠do em uma transa√ß√£o de bitcoin, podemos examinar como as abstra√ß√µes de n√≠vel superior s√£o derivadas dos componentes aparentemente primitivos da transa√ß√£o.</p>
</div>
<div class="paragraph data-line-729">
<p>Vejamos novamente como a transa√ß√£o da Alice foi apresentada em um explorador de blocos popular (<a href="#alice_transaction_to_bobs_cafe">Transa√ß√£o da Alice para a Cafeteria do Bob</a>).</p>
</div>
<div id="alice_transaction_to_bobs_cafe" class="imageblock data-line-733">
<div class="content">
<img src="images/mbc2_0208.png" alt="Alice Coffee Transaction">
</div>
<div class="title">Figure 43. Transa√ß√£o da Alice para a Cafeteria do Bob</div>
</div>
<div class="paragraph data-line-735">
<p>On the left side of the transaction, the blockchain explorer shows Alice&#8217;s Bitcoin address as the "sender." In fact, this information is not in the transaction itself. When the blockchain explorer references the transaction it also references the previous transaction associated with the input and extracts the first output from that older transaction. Within that output is a locking script that locks the UTXO to Alice&#8217;s public key hash (a P2PKH script). The blockchain explorer extracted the public key hash and encoded it using Base58Check encoding to produce and display the Bitcoin address that represents that public key.</p>
</div>
<div class="paragraph data-line-737">
<p>Similarly, on the right side, the blockchain explorer shows the two outputs; the first to Bob&#8217;s Bitcoin address and the second to Alice&#8217;s Bitcoin address (as change). Once again, to create these Bitcoin addresses, the blockchain explorer extracted the locking script from each output, recognized it as a P2PKH script, and extracted the public-key-hash from within. Finally, the blockchain explorer reencoded each public key hash with Base58Check to produce and display the Bitcoin addresses.</p>
</div>
<div class="paragraph data-line-739">
<p>If you were to click on Bob&#8217;s Bitcoin address, the blockchain explorer would show you the view in <a href="#the_balance_of_bobs_bitcoin_address">The balance of Bob&#8217;s Bitcoin address</a>.</p>
</div>
<div id="the_balance_of_bobs_bitcoin_address" class="imageblock data-line-743">
<div class="content">
<img src="images/mbc2_0608.png" alt="The balance of Bob&#8217;s Bitcoin address">
</div>
<div class="title">Figure 44. The balance of Bob&#8217;s Bitcoin address</div>
</div>
<div class="paragraph data-line-745">
<p>The blockchain explorer displays the balance of Bob&#8217;s Bitcoin address. But nowhere in the Bitcoin system is there a concept of a "balance." Rather, the values displayed here are constructed by the blockchain explorer as follows.</p>
</div>
<div class="paragraph data-line-747">
<p>To construct the "Total Received" amount, the blockchain explorer first will decode the Base58Check encoding of the Bitcoin address to retrieve the 160-bit hash of Bob&#8217;s public key that is encoded within the address. Then, the blockchain explorer will search through the database of transactions, looking for outputs with P2PKH locking scripts that contain Bob&#8217;s public key hash. By summing up the value of all the outputs, the blockchain explorer can produce the total value received.</p>
</div>
<div class="paragraph data-line-749">
<p>Constructing the current balance (displayed as "Final Balance") requires a bit more work. The blockchain explorer keeps a separate database of the outputs that are currently unspent, the UTXO set. To maintain this database, the blockchain explorer must monitor the Bitcoin network, add newly created UTXO, and remove spent UTXO, in real time, as they appear in unconfirmed transactions. This is a complicated process that depends on keeping track of transactions as they propagate, as well as maintaining consensus with the Bitcoin network to ensure that the correct chain is followed. Sometimes, the blockchain explorer goes out of sync and its perspective of the UTXO set is incomplete or incorrect.</p>
</div>
<div class="paragraph data-line-751">
<p>A partir do conjunto UTXO, o explorador de blockchain soma o valor de todas as sa√≠das n√£o gastas que fazem refer√™ncia ao hash da chave p√∫blica do Bob e produz o valor do "Saldo Final" que √© exibido ao usu√°rio.</p>
</div>
<div class="paragraph data-line-753">
<p>Para produzir apenas essa tela, contendo esses dois "saldos", o explorador de blockchain precisa indexar e pesquisar dezenas, centenas ou mesmo centenas de milhares de transa√ß√µes.</p>
</div>
<div class="paragraph data-line-755">
<p>Em resumo, as informa√ß√µes apresentadas aos usu√°rios por meio de aplicativos de carteira, exploradores de blockchain e outras interfaces de usu√°rio do bitcoin s√£o frequentemente compostas de abstra√ß√µes de n√≠vel superior que s√£o derivadas ao se pesquisar muitas transa√ß√µes diferentes, ao se inspecionar seu conte√∫do e ao  se manipular os dados contidos nelas. Ao apresentar essa vis√£o simplista das transa√ß√µes de bitcoin, que se assemelham a cheques banc√°rios de um remetente para um destinat√°rio, esses aplicativos precisam abstrair muitos detalhes subjacentes. Eles se concentram principalmente nos tipos comuns de transa√ß√µes: P2PKH com assinaturas SIGHASH_ALL em todas as entradas. Portanto, embora os aplicativos de bitcoin possam apresentar mais de 80% de todas as transa√ß√µes em uma maneira f√°cil de ler, √†s vezes eles ficam perdidos quando se deparam com transa√ß√µes que fogem do normal. As transa√ß√µes que cont√™m scripts de travamento mais complexos, sinalizadores SIGHASH diferentes ou muitas entradas e sa√≠das, acabam demonstrando a simplicidade e a fraqueza dessas abstra√ß√µes.</p>
</div>
<div class="paragraph data-line-757">
<p>Todos os dias, centenas de transa√ß√µes que n√£o cont√™m sa√≠das P2PKH s√£o confirmadas na blockchain. Os exploradores de blockchain frequentemente apresentam mensagens de advert√™ncia em vermelho dizendo que eles n√£o conseguem decodificar um endere√ßo.</p>
</div>
<div class="paragraph data-line-759">
<p>Como veremos no pr√≥ximo cap√≠tulo, essas transa√ß√µes n√£o s√£o necessariamente estranhas. S√£o transa√ß√µes que cont√™m scripts de travamento mais complexos do que o P2PKH comum. A seguir, aprenderemos a decodificar e compreender scripts mais complexos e as aplica√ß√µes que eles suportam.</p>
</div>
<div id="adv_transactions" class="paragraph data-line-763">
<p>== Transa√ß√µes e Scripts Avan√ßados</p>
</div>
<div id="ch07_intro" class="paragraph data-line-766">
<p>=== Introdu√ß√£o</p>
</div>
<div class="paragraph data-line-768">
<p>No cap√≠tulo anterior, apresentamos os elementos b√°sicos das transa√ß√µes de bitcoin e vimos o tipo mais comum de script de transa√ß√£o, o script P2PKH. Neste cap√≠tulo, veremos scripts mais avan√ßados e como podemos us√°-los para construir transa√ß√µes com condi√ß√µes complexas.</p>
</div>
<div class="paragraph data-line-770">
<p>Primeiro, veremos os scripts <em>multiassinatura</em>. A seguir, examinaremos o segundo script de transa√ß√£o mais comum, o <em>Pay-to-Script-Hash</em> (em portugu√™s, <em>Paga-para-Hash-de-Script</em>), que abre um novo mundo de scripts complexos. Em seguida, examinaremos novos operadores de script que adicionam uma dimens√£o de tempo ao bitcoin, por meio de <em>timelocks</em>. Por √∫ltimo, veremos a <em>Segregated Witness</em> (em portugu√™s, <em>Testemunha Segregada</em>), uma mudan√ßa arquitetural na estrutura das transa√ß√µes.</p>
</div>
<div id="multisig" class="paragraph data-line-773">
<p>=== Multiassinatura</p>
</div>
<div class="paragraph data-line-775">
<p>Os scripts multiassinatura definem uma condi√ß√£o onde N chaves p√∫blicas s√£o registradas no script e pelo menos M delas devem fornecer assinaturas para destravar os fundos. Isso tamb√©m √© conhecido como um esquema M-de-N, onde N √© o n√∫mero total de chaves e M √© a quantidade m√≠nima de assinaturas necess√°rias para valida√ß√£o. Por exemplo, uma multiassinatura 2-de-3 √© aquela em que tr√™s chaves p√∫blicas s√£o listadas como signat√°rias em potencial e pelo menos duas delas devem ser usadas para criar assinaturas para uma transa√ß√£o v√°lida gastar os fundos.</p>
</div>
<div class="paragraph data-line-777">
<p>Atualmente, os scripts multiassinatura <em>padr√£o</em> s√£o limitados a no m√°ximo 3 chaves p√∫blicas listadas, o que significa que voc√™ pode fazer qualquer combina√ß√£o partindo de 1-de-1 at√© 3-de-3 ou qualquer combina√ß√£o dentro desse intervalo. A limita√ß√£o de 3 chaves listadas pode j√° ter sido removida no momento em que este livro for publicado, portanto, verifique a fun√ß√£o IsStandard() para ver o que √© aceito atualmente pela rede. Observe que o limite de 3 chaves se aplica apenas a scripts multiassinatura padr√£o (tamb√©m conhecidos como "<em>bare multisig</em>"), e n√£o a scripts multiassinatura embrulhados em um script Pay-to-Script-Hash (P2SH). Os scripts multiassinatura P2SH s√£o limitados a 15 chaves, permitindo multiassinaturas de at√© 15-de-15. Essa limita√ß√£o √© tamb√©m imposta pela fun√ß√£o IsStandard(). Aprenderemos sobre o P2SH em <a href="#p2sh">[p2sh]</a>.</p>
</div>
<div class="paragraph data-line-779">
<p>A forma geral usada por um script de travamento para definir uma condi√ß√£o multiassinatura M-de-N √©</p>
</div>
<div class="listingblock data-line-781">
<div class="content">
<pre>M &lt;Chave P√∫blica 1&gt; &lt;Chave P√∫blica 2&gt; ... &lt;Chave P√∫blica N&gt; N CHECKMULTISIG</pre>
</div>
</div>
<div class="paragraph data-line-785">
<p>onde N √© o n√∫mero total de chaves p√∫blicas listadas e M √© a quantidade m√≠nima de assinaturas necess√°rias para se gastar a sa√≠da.</p>
</div>
<div class="paragraph data-line-787">
<p>Um script de travamento definindo uma condi√ß√£o multiassinatura 2-de-3 fica dessa forma:</p>
</div>
<div class="listingblock data-line-789">
<div class="content">
<pre>2 &lt;Chave P√∫blica A&gt; &lt;Chave P√∫blica B&gt; &lt;Chave P√∫blica C&gt; 3 CHECKMULTISIG</pre>
</div>
</div>
<div class="paragraph data-line-793">
<p>O script de travamento acima pode ser satisfeito com um script de destravamento contendo qualquer combina√ß√£o de duas assinaturas obtidas a partir das chaves privadas que correspondem √†s tr√™s chaves p√∫blicas listadas:</p>
</div>
<div class="listingblock data-line-795">
<div class="content">
<pre>&lt;Assinatura B&gt; &lt;Assinatura C&gt;</pre>
</div>
</div>
<div class="paragraph data-line-799">
<p>Os dois scripts juntos formariam o seguinte script de valida√ß√£o combinado:</p>
</div>
<div class="listingblock data-line-801">
<div class="content">
<pre>&lt;Assinatura B&gt; &lt;Assinatura C&gt; 2 &lt;Chave P√∫blica A&gt; &lt;Chave P√∫blica B&gt; &lt;Chave P√∫blica C&gt; 3 CHECKMULTISIG</pre>
</div>
</div>
<div class="paragraph data-line-805">
<p>Quando executado, o script combinado ser√° avaliado como TRUE se, e somente se, o script de destravamento coincidir com as condi√ß√µes definidas pelo script de travamento. Neste caso, a condi√ß√£o √© se o script de destravamento tem uma assinatura v√°lida obtida a partir das duas chaves privadas que correspondem a duas das tr√™s chaves p√∫blicas definidas como uma trava.</p>
</div>
<div id="multisig_bug" class="paragraph data-line-808">
<p>===== Um bug na execu√ß√£o do CHECKMULTISIG</p>
</div>
<div class="paragraph data-line-810">
<p>Existe um bug na execu√ß√£o do CHECKMULTISIG que requer uma pequena solu√ß√£o alternativa. Quando o CHECKMULTISIG √© executado, ele deveria consumir M+N+2 itens na pilha como par√¢metros. No entanto, devido ao bug, o CHECKMULTISIG remover√° um valor a mais do que o esperado.</p>
</div>
<div class="paragraph data-line-812">
<p>Vamos examinar isso em mais detalhes usando o exemplo de valida√ß√£o anterior:</p>
</div>
<div class="listingblock data-line-814">
<div class="content">
<pre>&lt;Assinatura B&gt; &lt;Assinatura C&gt; 2 &lt;Chave P√∫blica A&gt; &lt;Chave P√∫blica B&gt; &lt;Chave P√∫blica C&gt; 3 CHECKMULTISIG</pre>
</div>
</div>
<div class="paragraph data-line-818">
<p>Primeiro, o CHECKMULTISIG remove o item do topo da pilha, que √© o N (neste exemplo "3"). Em seguida, ele remove N itens, que s√£o as chaves p√∫blicas que podem assinar. Neste exemplo, as chaves p√∫blicas A, B e C. Em seguida, ele remove um item da pilha, que √© o M, o qu√≥rum (quantas assinaturas s√£o necess√°rias). Aqui, M = 2. Neste ponto, o CHECKMULTISIG deve remover da pilha os M itens finais, que s√£o as assinaturas, e ver se elas s√£o v√°lidas. No entanto, infelizmente, um bug na implementa√ß√£o faz com que o CHECKMULTISIG remova um item a mais do que deveria (M+1 no total). O item extra √© desconsiderado na verifica√ß√£o das assinaturas, ent√£o ele n√£o tem efeito direto no CHECKMULTISIG em si. No entanto, um valor extra deve estar presente, pois se ele n√£o estiver presente, quando o CHECKMULTISIG tentar remover um item em uma pilha vazia, isso causar√° um erro de pilha e uma falha de script (marcando a transa√ß√£o como inv√°lida). Como o item extra √© desconsiderado, ele pode ser qualquer coisa, mas normalmente o valor 0 √© usado.</p>
</div>
<div class="paragraph data-line-820">
<p>Como esse bug tornou-se parte das regras de consenso, agora ele precisa ser replicado para sempre. Portanto, a valida√ß√£o de script correta seria assim:</p>
</div>
<div class="listingblock data-line-822">
<div class="content">
<pre>0 &lt;Assinatura B&gt; &lt;Assinatura C&gt; 2 &lt;Chave P√∫blica A&gt; &lt;Chave P√∫blica B&gt; &lt;Chave P√∫blica C&gt; 3 CHECKMULTISIG</pre>
</div>
</div>
<div class="paragraph data-line-826">
<p>Portanto, o script de destravamento que √© de fato usado na multiassinatura n√£o √©:</p>
</div>
<div class="listingblock data-line-828">
<div class="content">
<pre>&lt;Assinatura B&gt; &lt;Assinatura C&gt;</pre>
</div>
</div>
<div class="paragraph data-line-832">
<p>mas, em vez disso, √©:</p>
</div>
<div class="listingblock data-line-834">
<div class="content">
<pre>0 &lt;Assinatura B&gt; &lt;Assinatura C&gt;</pre>
</div>
</div>
<div class="paragraph data-line-838">
<p>De agora em diante, sempre que voc√™ se deparar com um script de destravamento multiassinatura, voc√™ j√° saber√° para que serve o 0 extra no in√≠cio do script, cujo √∫nico prop√≥sito √© contornar um bug que acidentalmente se tornou uma regra de consenso.</p>
</div>
<div id="p2sh" class="paragraph data-line-841">
<p>=== Pay-to-Script-Hash (P2SH)</p>
</div>
<div class="paragraph data-line-843">
<p>O <em>Pay-to-Script-Hash</em> (em portugu√™s, Paga-para-Hash-de-Script) ou P2SH foi introduzido em 2012 como um novo tipo poderoso de transa√ß√£o que simplifica muito o uso de scripts de transa√ß√£o complexos. Para explicar a necessidade do P2SH, vamos dar uma olhada em um exemplo pr√°tico.</p>
</div>
<div class="paragraph data-line-845">
<p>No <a href="#ch01_intro_what_is_bitcoin">Introdu√ß√£o</a> apresentamos o Mohammed, um importador de eletr√¥nicos que mora em Dubai. A empresa do Mohammed usa extensivamente o recurso de multiassinatura do bitcoin para suas contas corporativas. Os scripts multiassinatura s√£o um dos usos mais comuns das capacidades avan√ßadas de script do bitcoin e s√£o um recurso muito poderoso.  A empresa do Mohammed usa um script multiassinatura para todos os pagamentos de clientes, algo que √© conhecido em termos cont√°beis como "contas a receber" (em ingl√™s <em>"accounts receivable"</em> ou AR). Com o esquema multiassinatura, todos os pagamentos feitos pelos clientes s√£o travados de forma que eles exijam pelo menos duas assinaturas para serem liberados, uma do Mohammed e uma de seus s√≥cios ou uma de seu advogado que possui uma chave reserva. Um esquema multiassinatura como esse oferece controles de governan√ßa corporativa e protege contra roubo, apropria√ß√£o ind√©bita ou perda.</p>
</div>
<div class="paragraph data-line-847">
<p>O script resultante √© bastante longo e tem a seguinte forma:</p>
</div>
<div class="listingblock data-line-849">
<div class="content">
<pre>2 &lt;Chave P√∫blica do Mohammed&gt; &lt;Chave P√∫blica do S√≥cio1&gt; &lt;Chave P√∫blica do S√≥cio2&gt; &lt;Chave P√∫blica do S√≥cio3&gt; &lt;Chave P√∫blica do Advogado&gt; 5 CHECKMULTISIG</pre>
</div>
</div>
<div class="paragraph data-line-853">
<p>Embora os scripts multiassinatura sejam um recurso poderoso, eles s√£o complicados de usar. Dado o script anterior, o Mohammed teria que comunicar esse script a todos os clientes antes do pagamento. Cada cliente teria que usar um software de carteira de bitcoin especial, com a capacidade de criar scripts de transa√ß√£o personalizados, e cada cliente teria que entender como criar uma transa√ß√£o usando scripts personalizados. Al√©m disso, a transa√ß√£o resultante seria cerca de cinco vezes maior do que uma transa√ß√£o de pagamento simples, pois esse script cont√©m chaves p√∫blicas muito longas. O √¥nus dessa transa√ß√£o extra-grande seria arcado pelo cliente na forma de taxas de transa√ß√£o mais elevadas. Finalmente, um script de transa√ß√£o grande como este seria carregado no conjunto UTXO contido na mem√≥ria RAM de cada n√≥ completo, at√© que ele fosse gasto. Todos esses problemas tornam o uso de scripts de travamento complexos dif√≠cil na pr√°tica.</p>
</div>
<div class="paragraph data-line-855">
<p>P2SH was developed to resolve these practical difficulties and to make the use of complex scripts as easy as a payment to a Bitcoin address. With P2SH payments, the complex locking script is replaced with its digital fingerprint, a cryptographic hash. When a transaction attempting to spend the UTXO is presented later, it must contain the script that matches the hash, in addition to the unlocking script. In simple terms, P2SH means "pay to a script matching this hash, a script that will be presented later when this output is spent."</p>
</div>
<div class="paragraph data-line-857">
<p>Nas transa√ß√µes P2SH, o script de travamento que √© substitu√≠do por um hash √© referido como o <em>script de resgate</em> (em ingl√™s, <em>redeem script</em>), pois ele √© apresentado ao sistema no momento do resgate, ao inv√©s de ser apresentado como um script de travamento. A <a href="#without_p2sh">Script complexo sem P2SH</a> mostra o script sem P2SH e a <a href="#with_p2sh">Script complexo com P2SH</a> mostra o mesmo script codificado com P2SH.</p>
</div>
<table id="without_p2sh" class="tableblock frame-all grid-all stretch data-line-861">
<caption class="title">Table 21. Script complexo sem P2SH</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Script de Travamento</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 ChaveP√∫blica1 ChaveP√∫blica2 ChaveP√∫blica3 ChaveP√∫blica4 ChaveP√∫blica5 5 CHECKMULTISIG</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Script de Destravamento</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 Assinatura1 Assinatura2</p></td>
</tr>
</tbody>
</table>
<table id="with_p2sh" class="tableblock frame-all grid-all stretch data-line-868">
<caption class="title">Table 22. Script complexo com P2SH</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Script de Resgate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 ChaveP√∫blica1 ChaveP√∫blica2 ChaveP√∫blica3 ChaveP√∫blica4 ChaveP√∫blica5 5 CHECKMULTISIG</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Script de Travamento</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HASH160 &lt;hash de 20 bytes do script de resgate&gt; EQUAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Script de Destravamento</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 Assinatura1 Assinatura2 &lt;script de resgate&gt;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-874">
<p>Como voc√™ pode ver nas tabelas, com P2SH, o complexo script que detalha as condi√ß√µes para gastar a sa√≠da (o script de resgate) n√£o √© apresentado no script de travamento. Em vez disso, somente um hash do script de resgate √© adicionado no script de travamento e o script de resgate em si √© apresentado mais tarde, como parte do script de destravamento quando a sa√≠da for gasta. Isso transfere o fardo das taxas e da complexidade do remetente (quem cria a transa√ß√£o) para o destinat√°rio (quem destrava e gasta a transa√ß√£o).</p>
</div>
<div class="paragraph data-line-876">
<p>Vamos dar uma olhada na empresa do Mohammed, o script multiassinatura complexo e os scripts P2SH resultantes.</p>
</div>
<div class="paragraph data-line-878">
<p>Primeiro, o script multiassinatura que a empresa do Mohammed usa para todos os pagamentos que recebe de seus clientes:</p>
</div>
<div class="listingblock data-line-880">
<div class="content">
<pre>2 &lt;Chave P√∫blica do Mohammed&gt; &lt;Chave P√∫blica do S√≥cio1&gt; &lt;Chave P√∫blica do S√≥cio2&gt; &lt;Chave P√∫blica do S√≥cio3&gt; &lt;Chave P√∫blica do Advogado&gt; 5 CHECKMULTISIG</pre>
</div>
</div>
<div class="paragraph data-line-884">
<p>Se os marcadores forem substitu√≠dos pelas verdadeiras chaves p√∫blicas (demonstradas aqui como n√∫meros de 520 bits come√ßando com 04), voc√™ ver√° que esse script se torna muito longo:</p>
</div>
<div class="listingblock data-line-886">
<div class="content">
<pre>2
04C16B8698A9ABF84250A7C3EA7EEDEF9897D1C8C6ADF47F06CF73370D74DCCA01CDCA79DCC5C395D7EEC6984D83F1F50C900A24DD47F569FD4193AF5DE762C58704A2192968D8655D6A935BEAF2CA23E3FB87A3495E7AF308EDF08DAC3C1FCBFC2C75B4B0F4D0B1B70CD2423657738C0C2B1D5CE65C97D78D0E34224858008E8B49047E63248B75DB7379BE9CDA8CE5751D16485F431E46117B9D0C1837C9D5737812F393DA7D4420D7E1A9162F0279CFC10F1E8E8F3020DECDBC3C0DD389D99779650421D65CBD7149B255382ED7F78E946580657EE6FDA162A187543A9D85BAAA93A4AB3A8F044DADA618D087227440645ABE8A35DA8C5B73997AD343BE5C2AFD94A5043752580AFA1ECED3C68D446BCAB69AC0BA7DF50D56231BE0AABF1FDEEC78A6A45E394BA29A1EDF518C022DD618DA774D207D137AAB59E0B000EB7ED238F4D800 5 CHECKMULTISIG</pre>
</div>
</div>
<div class="paragraph data-line-891">
<p>Em vez disso, esse script inteiro pode ser representado por um hash criptogr√°fico de 20 bytes, aplicando-se primeiro o algoritmo de hash SHA256 e, em seguida, aplicando-se o algoritmo RIPEMD160 no resultado.</p>
</div>
<div class="paragraph data-line-893">
<p>Usamos o libbitcoin-explorer (bx) na linha de comando para produzir o hash do script, da seguinte maneira:</p>
</div>
<div class="listingblock data-line-895">
<div class="content">
<pre>echo \
2 \
[04C16B8698A9ABF84250A7C3EA7EEDEF9897D1C8C6ADF47F06CF73370D74DCCA01CDCA79DCC5C395D7EEC6984D83F1F50C900A24DD47F569FD4193AF5DE762C587] \
[04A2192968D8655D6A935BEAF2CA23E3FB87A3495E7AF308EDF08DAC3C1FCBFC2C75B4B0F4D0B1B70CD2423657738C0C2B1D5CE65C97D78D0E34224858008E8B49] \
[047E63248B75DB7379BE9CDA8CE5751D16485F431E46117B9D0C1837C9D5737812F393DA7D4420D7E1A9162F0279CFC10F1E8E8F3020DECDBC3C0DD389D9977965] \
[0421D65CBD7149B255382ED7F78E946580657EE6FDA162A187543A9D85BAAA93A4AB3A8F044DADA618D087227440645ABE8A35DA8C5B73997AD343BE5C2AFD94A5] \
[043752580AFA1ECED3C68D446BCAB69AC0BA7DF50D56231BE0AABF1FDEEC78A6A45E394BA29A1EDF518C022DD618DA774D207D137AAB59E0B000EB7ED238F4D800] \
5 CHECKMULTISIG \
| bx script-encode | bx sha256 | bx ripemd160
54c557e07dde5bb6cb791c7a540e0a4796f5e97e</pre>
</div>
</div>
<div class="paragraph data-line-908">
<p>A s√©rie de comandos acima codifica primeiro o script de resgate multiassinatura do Mohammed como um Script do bitcoin codificado em hexadecimal e serializado. O pr√≥ximo comando bx calcula o hash SHA256 do script. O pr√≥ximo comando bx faz outro <em>hashing</em> com o RIPEMD160, produzindo o hash do script final:</p>
</div>
<div class="paragraph data-line-910">
<p>O hash de 20 bytes do script de resgate do Mohammed √©:</p>
</div>
<div class="listingblock data-line-912">
<div class="content">
<pre>54c557e07dde5bb6cb791c7a540e0a4796f5e97e</pre>
</div>
</div>
<div class="paragraph data-line-916">
<p>Uma transa√ß√£o P2SH trava a sa√≠da para este hash, em vez do script de resgate mais longo, usando o script de travamento:</p>
</div>
<div class="listingblock data-line-918">
<div class="content">
<pre>HASH160 54c557e07dde5bb6cb791c7a540e0a4796f5e97e EQUAL</pre>
</div>
</div>
<div class="paragraph data-line-922">
<p>o qual, como voc√™ pode ver, √© muito mais curto. Em vez de "pagar para este script multiassinatura de 5 chaves", a transa√ß√£o P2SH equivalente √© "pagar para um script com este hash". Um cliente que faz um pagamento para a empresa do Mohammed s√≥ precisa incluir esse script de travamento muito mais curto em seu pagamento. Quando o Mohammed e seus s√≥cios desejarem gastar esta UTXO, eles dever√£o apresentar o script de resgate original (aquele cujo hash travou a UTXO) e as assinaturas necess√°rias para destrav√°-lo, dessa maneira:</p>
</div>
<div class="listingblock data-line-924">
<div class="content">
<pre>&lt;Assinatura1&gt; &lt;Assinatura2&gt; &lt;2 CP1 CP2 CP3 CP4 CP5 5 CHECKMULTISIG&gt;</pre>
</div>
</div>
<div class="paragraph data-line-928">
<p>Os dois scripts s√£o combinados em dois est√°gios. Primeiro, o script de resgate √© verificado em rela√ß√£o ao script de travamento para garantir que o hash corresponda:</p>
</div>
<div class="listingblock data-line-930">
<div class="content">
<pre>&lt;2 CP1 CP2 CP3 CP4 CP5 5 CHECKMULTISIG&gt; HASH160 &lt;hash do script de resgate&gt; EQUAL</pre>
</div>
</div>
<div class="paragraph data-line-933">
<p>Se o hash do script de resgate corresponder, o script de destravamento ser√° executado isoladamente, para destravar o script de resgate:</p>
</div>
<div class="listingblock data-line-935">
<div class="content">
<pre>&lt;Assinatura1&gt; &lt;Assinatura2&gt; 2 CP1 CP2 CP3 CP4 CP5 5 CHECKMULTISIG</pre>
</div>
</div>
<div class="paragraph data-line-939">
<p>Quase todos os scripts descritos neste cap√≠tulo s√≥ podem ser implementados como scripts P2SH. Por exemplo, um script de travamento multiassinatura padr√£o 2 de 5 n√£o pode ser usado diretamente no script de travamento de uma UTXO, pois a fun√ß√£o IsStandard() invalidaria a transa√ß√£o. Para estar em conformidade, um script de travamento P2SH pode ser usado em seu lugar, como visto acima. Uma transa√ß√£o que inclui um script de destravamento P2SH pode ser usada para resgatar essa UTXO e ser√° v√°lida desde que n√£o contenha mais do que 15 chaves p√∫blicas. </p>
</div>
<div class="admonitionblock tip data-line-942">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-943">
<p>Lembre-se, por causa da pol√≠tica definida pela fun√ß√£o IsStandard() no momento da reda√ß√£o deste livro, os scripts multiassinatura padr√£o s√£o limitados a no m√°ximo 3 chaves p√∫blicas listadas, enquanto os scripts P2SH s√£o limitados a no m√°ximo 15 chaves p√∫blicas listadas. Enquanto os scripts multiassinatura padr√£o podem invalidar transa√ß√µes por meio de seu script de travamento <em>ou</em> destravamento, os scripts P2SH podem invalidar transa√ß√µes <em>apenas</em> por meio de seu script de destravamento. Isso ocorre porque n√£o h√° como a fun√ß√£o IsStandard() saber se um hash de um script de resgate em um script de travamento inclui mais assinaturas do que a limita√ß√£o de tamanho atualmente imposta, portanto, ela s√≥ pode observar os scripts de destravamento nas entradas de transa√ß√£o.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-946">
<p>==== Endere√ßos P2SH</p>
</div>
<div class="paragraph data-line-948">
<p>Another important part of the P2SH feature is the ability to encode a script hash as an address, as defined in BIP-13. P2SH addresses are Base58Check encodings of the 20-byte hash of a script, just like Bitcoin addresses are Base58Check encodings of the 20-byte hash of a public key. P2SH addresses use the version prefix "5," which results in Base58Check-encoded addresses that start with a "3."</p>
</div>
<div class="paragraph data-line-950">
<p>Por exemplo, o script complexo do Mohammed, transformado em hash e codificado em Base58Check como um endere√ßo P2SH, torna-se 39RF6JqABiHdYHkfChV6USGMe6Nsr66Gzw. Podemos confirmar isso com o comando bx:</p>
</div>
<div class="listingblock data-line-952">
<div class="content">
<pre>echo \
'54c557e07dde5bb6cb791c7a540e0a4796f5e97e'\
 | bx address-encode -v 5
39RF6JqABiHdYHkfChV6USGMe6Nsr66Gzw</pre>
</div>
</div>
<div class="paragraph data-line-960">
<p>Now, Mohammed can give this "address" to his customers and they can use almost any bitcoin wallet to make a simple payment, as if it were a Bitcoin address. The 3 prefix gives them a hint that this is a special type of address, one corresponding to a script instead of a public key, but otherwise it works in exactly the same way as a payment to a Bitcoin address.</p>
</div>
<div class="paragraph data-line-962">
<p>Os endere√ßos P2SH escondem toda essa complexidade, de maneira que a pessoa que est√° fazendo o pagamento n√£o enxergue o script.</p>
</div>
<div class="paragraph data-line-964">
<p>==== Benef√≠cios do P2SH</p>
</div>
<div class="paragraph data-line-966">
<p>O recurso P2SH oferece os seguintes benef√≠cios em compara√ß√£o com o uso direto de scripts complexos para o travamento de sa√≠das:</p>
</div>
<div class="ulist data-line-968">
<ul>
<li class="data-line-968">
<p>Os scripts complexos s√£o substitu√≠dos por impress√µes digitais menores na sa√≠da da transa√ß√£o, tornando a transa√ß√£o menor.</p>
</li>
<li class="data-line-969">
<p>Os scripts podem ser codificados como um endere√ßo, de maneira que o remetente e a carteira do remetente n√£o precisem fazer modifica√ß√µes complexas para implementar o P2SH.</p>
</li>
<li class="data-line-970">
<p>O P2SH faz com que o fardo de se construir o script seja do recipiente, e n√£o do remetente.</p>
</li>
<li class="data-line-971">
<p>O P2SH transfere a obriga√ß√£o de armazenar o script longo da sa√≠da (que, al√©m de ser armazenada na blockchain, tamb√©m est√° no conjunto UTXO) para a entrada (que √© armazenada apenas na blockchain).</p>
</li>
<li class="data-line-972">
<p>O P2SH faz com que o fardo do armazenamento do script longo deixe de estar no presente (pagamento) e passe a estar no futuro (quando ele √© gasto).</p>
</li>
<li class="data-line-973">
<p>O P2SH faz com que os maiores custos com taxa de transa√ß√£o de um script longo deixem de ser do remetente e passem a ser do recipiente (destinat√°rio), que tem que incluir o script longo de resgate para poder gast√°-lo.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-975">
<p>==== Script de Resgate e Valida√ß√£o</p>
</div>
<div class="paragraph data-line-977">
<p>Antes da vers√£o 0.9.2 do cliente Bitcoin Core, o Pay-to-Script-Hash era limitado aos tipos padr√£o de scripts de transa√ß√£o de bitcoin pela fun√ß√£o IsStandard(). Isso significa que o script de resgate apresentado na transa√ß√£o de gasto s√≥ poderia ser um dos tipos padr√£o: P2PK, P2PKH ou multiassinatura.</p>
</div>
<div class="paragraph data-line-979">
<p>A partir da vers√£o 0.9.2 do cliente Bitcoin Core, as transa√ß√µes P2SH podem conter qualquer script v√°lido, tornando o padr√£o P2SH muito mais flex√≠vel e permitindo a experimenta√ß√£o de muitos tipos novos e complexos de transa√ß√µes.</p>
</div>
<div class="paragraph data-line-981">
<p>Voc√™ n√£o pode colocar um P2SH dentro de um script de resgate P2SH, pois a especifica√ß√£o P2SH n√£o √© recursiva. Al√©m disso, embora seja tecnicamente poss√≠vel incluir um RETURN (ver <a href="#op_return">[op_return]</a>) em um script de resgate, j√° que nada nas regras impede que voc√™ fa√ßa isso, isso n√£o tem uso pr√°tico, pois executar o RETURN durante a valida√ß√£o far√° com que a transa√ß√£o seja marcada como inv√°lida.</p>
</div>
<div class="paragraph data-line-983">
<p>Observe que, como o script de resgate n√£o √© apresentado √† rede at√© que voc√™ tente gastar uma sa√≠da P2SH, se voc√™ travar uma sa√≠da com o hash de um script de resgate inv√°lido, esse travamento ser√° processado de qualquer forma. A UTXO ser√° travada com sucesso. No entanto, voc√™ n√£o poder√° gast√°-la porque a transa√ß√£o de gasto, que inclui o script de resgate, n√£o ser√° aceita, pois o script √© inv√°lido. Isso cria um risco, visto que voc√™ pode travar bitcoins em um P2SH que n√£o poder√° ser gasto posteriormente. A rede aceitar√° o script de travamento P2SH mesmo que ele corresponda a um script de resgate inv√°lido, pois o hash do script n√£o d√° nenhuma indica√ß√£o do script que ele representa.</p>
</div>
<div class="admonitionblock warning data-line-986">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-987">
<p>Os scripts de travamento P2SH cont√™m o hash de um script de resgate, que n√£o fornece pistas quanto ao conte√∫do do script de resgate em si. A transa√ß√£o P2SH ser√° considerada v√°lida e ser√° aceita, mesmo que o script de resgate seja inv√°lido. Voc√™ poderia travar acidentalmente os bitcoins, de modo que eles n√£o possam mais ser gastos no futuro.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="op_return" class="paragraph data-line-993">
<p>=== Sa√≠da de Registro de Dados (RETURN)</p>
</div>
<div class="paragraph data-line-995">
<p>A blockchain do bitcoin, o seu livro-raz√£o distribu√≠do com carimbos de data e hora, tem usos potenciais muito al√©m dos pagamentos. Muitos desenvolvedores tentaram usar a linguagem de script de transa√ß√£o para aproveitar a seguran√ßa e a resili√™ncia do sistema em aplica√ß√µes como servi√ßos de cart√≥rio digital, certificados de a√ß√µes e contratos inteligentes. As primeiras tentativas de usar a linguagem de script do bitcoin para esses fins envolviam a cria√ß√£o de sa√≠das de transa√ß√£o que registravam dados na blockchain; por exemplo, para registrar uma impress√£o digital de um arquivo, de tal forma que qualquer pessoa pudesse estabelecer a prova de exist√™ncia desse arquivo em uma data espec√≠fica atrav√©s de uma refer√™ncia √†quela transa√ß√£o.</p>
</div>
<div class="paragraph data-line-997">
<p>The use of bitcoin&#8217;s blockchain to store data unrelated to bitcoin payments is a controversial subject. Many developers consider such use abusive and want to discourage it. Others view it as a demonstration of the powerful capabilities of blockchain technology and want to encourage such experimentation. Those who object to the inclusion of nonpayment data argue that it causes "blockchain bloat," burdening those running full Bitcoin nodes with carrying the cost of disk storage for data that the blockchain was not intended to carry. Moreover, such transactions create UTXO that cannot be spent, using the destination Bitcoin address as a freeform 20-byte field. Because the address is used for data, it doesn&#8217;t correspond to a private key and the resulting UTXO can <em>never</em> be spent; it&#8217;s a fake payment. These transactions that can never be spent are therefore never removed from the UTXO set and cause the size of the UTXO database to forever increase, or "bloat."</p>
</div>
<div class="paragraph data-line-999">
<p>Na vers√£o 0.9 do cliente Bitcoin Core, os √¢nimos foram apaziguados com a introdu√ß√£o do operador RETURN. O RETURN permite que os desenvolvedores adicionem 80 bytes de dados n√£o relacionados a pagamento a uma sa√≠da de transa√ß√£o. No entanto, ao contr√°rio do uso de UTXOs "falsas", o operador RETURN explicitamente cria uma sa√≠da que √© <em>comprovadamente n√£o gast√°vel</em>, a qual n√£o precisa ser armazenada no conjunto UTXO. As sa√≠das com RETURN s√£o registradas na blockchain, portanto, consomem espa√ßo em disco e contribuem para o aumento no tamanho da blockchain, mas elas n√£o s√£o armazenadas no conjunto UTXO e, portanto, n√£o incham a pool de mem√≥ria de UTXOs e diminuem os gastos que os n√≥s completos tem em mem√≥ria RAM, que √© cara.</p>
</div>
<div class="paragraph data-line-1001">
<p>Os scripts RETURN t√™m a seguinte forma:</p>
</div>
<div class="listingblock data-line-1003">
<div class="content">
<pre>RETURN &lt;dados&gt;</pre>
</div>
</div>
<div class="paragraph data-line-1007">
<p> A por√ß√£o de dados √© limitada a 80 bytes e na maioria das vezes representa um hash, como a sa√≠da do algoritmo SHA256 (32 bytes). Muitos aplicativos colocam um prefixo na frente dos dados para ajudar a identificar a aplica√ß√£o. Por exemplo, o servi√ßo de notas digitais de <a href="https://proofofexistence.com" data-href="https://proofofexistence.com">Prova de Exist√™ncia</a> usa o prefixo de 8 bytes+DOCPROOF+, que √© ASCII codificado como 44 4f 43 50 52 4f 4f 46 em hexadecimal.</p>
</div>
<div class="paragraph data-line-1009">
<p>Lembre-se de que n√£o existe um "script de destravamento" que corresponda ao RETURN que possa ser usado para "gastar" uma sa√≠da RETURN. O motivo principal pelo qual o RETURN foi criado, √© para que voc√™ n√£o possa gastar o dinheiro travado nessa sa√≠da e, portanto, para que ela n√£o precise ser mantida no conjunto UTXO como potencialmente gast√°vel‚Äîo RETURN √© <em>comprovadamente imposs√≠vel de ser gasto</em>. O RETURN geralmente √© uma sa√≠da com uma quantidade zero de bitcoin, pois qualquer bitcoin atribu√≠do a essa sa√≠da √© efetivamente perdido para sempre. Se um RETURN for referenciado como uma entrada em uma transa√ß√£o, o mecanismo de valida√ß√£o de script suspender√° a execu√ß√£o do script de valida√ß√£o e marcar√° a transa√ß√£o como inv√°lida. A execu√ß√£o do RETURN essencialmente faz com que o script "retorne" com um FALSE e suspenda a execu√ß√£o. Portanto, se voc√™ acidentalmente referenciar uma sa√≠da RETURN como uma entrada em uma transa√ß√£o, essa transa√ß√£o ser√° inv√°lida.</p>
</div>
<div class="paragraph data-line-1011">
<p>Uma transa√ß√£o padr√£o (que esteja em conformidade com as verifica√ß√µes IsStandard()) s√≥ pode ter uma √∫nica sa√≠da RETURN. No entanto, uma sa√≠da RETURN √∫nica pode ser combinada em uma transa√ß√£o com sa√≠das de qualquer outro tipo.</p>
</div>
<div class="paragraph data-line-1013">
<p>Duas novas op√ß√µes de linha de comando foram adicionadas ao Bitcoin Core a partir da vers√£o 0.10. A op√ß√£o datacarrier controla a retransmiss√£o e a minera√ß√£o de transa√ß√µes RETURN, com o padr√£o definido como "1" para permiti-las. A op√ß√£o datacarriersize recebe um argumento num√©rico especificando o tamanho m√°ximo em bytes do script RETURN, 83 bytes por padr√£o, o que permite um m√°ximo de 80 bytes de dados RETURN mais um byte do c√≥digo operacional RETURN e dois bytes do c√≥digo operacional PUSHDATA.</p>
</div>
<div class="admonitionblock note data-line-1016">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-1017">
<p>O RETURN foi inicialmente proposto com um limite de 80 bytes, mas o limite foi reduzido para 40 bytes quando o recurso foi lan√ßado. Em fevereiro de 2015, na vers√£o 0.10 do Bitcoin Core, o limite foi novamente aumentado para 80 bytes. Os n√≥s podem decidir n√£o retransmitir ou minerar o RETURN, ou apenas retransmitir e minerar os RETURN que contenham menos de 80 bytes de dados.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1020">
<p>=== Timelocks</p>
</div>
<div class="paragraph data-line-1022">
<p>Os timelocks s√£o restri√ß√µes em transa√ß√µes ou sa√≠das que s√≥ permitem o gasto ap√≥s um determinado momento no tempo. O bitcoin tem desde o seu in√≠cio um recurso de timelock a n√≠vel de transa√ß√£o. Ele √© implementado pelo campo nLocktime em uma transa√ß√£o. Dois novos recursos de timelock foram introduzidos no final de 2015 e em meados de 2016, que oferecem timelocks a n√≠vel de UTXO. Eles s√£o o CHECKLOCKTIMEVERIFY e o CHECKSEQUENCEVERIFY.</p>
</div>
<div class="paragraph data-line-1024">
<p>Os timelocks s√£o √∫teis para transa√ß√µes pr√©-datadas (com pagamento em data futura) e para travar fundos at√© uma data futura. Mais importante, os timelocks estendem o script do bitcoin para a dimens√£o do tempo, permitindo a cria√ß√£o de contratos inteligentes complexos de m√∫ltiplas etapas.</p>
</div>
<div id="transaction_locktime_nlocktime" class="paragraph data-line-1027">
<p>==== Locktime de Transa√ß√£o (nLocktime)</p>
</div>
<div class="paragraph data-line-1029">
<p>From the beginning, bitcoin has had a transaction-level timelock feature. Transaction locktime is a transaction-level setting (a field in the transaction data structure) that defines the earliest time that a transaction is valid and can be relayed on the network or added to the blockchain. Locktime is also known as nLocktime from the variable name used in the Bitcoin Core codebase. It is set to zero in most transactions to indicate immediate propagation and execution. If nLocktime is nonzero and below 500 million, it is interpreted as a block height, meaning the transaction is not valid and is not relayed or included in the blockchain prior to the specified block height. If it is greater than or equal to 500 million, it is interpreted as a Unix Epoch timestamp (seconds since Jan-1-1970) and the transaction is not valid prior to the specified time. Transactions with nLocktime specifying a future block or time must be held by the originating system and transmitted to the Bitcoin network only after they become valid. If a transaction is transmitted to the network before the specified nLocktime, the transaction will be rejected by the first node as invalid and will not be relayed to other nodes. The use of nLocktime is equivalent to postdating a paper check.</p>
</div>
<div id="locktime_limitations" class="paragraph data-line-1032">
<p>===== Limita√ß√µes do locktime de transa√ß√£o</p>
</div>
<div class="paragraph data-line-1034">
<p>O nLocktime tem a limita√ß√£o de que, embora ele torne poss√≠vel gastar algumas sa√≠das no futuro, ele n√£o torna imposs√≠vel gast√°-las at√© aquele momento no futuro. Vamos explicar isso usando o exemplo a seguir.</p>
</div>
<div class="paragraph data-line-1036">
<p>A Alice assina uma transa√ß√£o gastando uma de suas sa√≠das para o endere√ßo do Bob e define o nLocktime da transa√ß√£o para 3 meses no futuro. A seguir, a Alice envia essa transa√ß√£o para o Bob para ret√™-la. Com esta transa√ß√£o, a Alice e o Bob sabem que:</p>
</div>
<div class="ulist data-line-1038">
<ul>
<li class="data-line-1038">
<p>O Bob n√£o conseguir√° transmitir a transa√ß√£o para resgatar os fundos antes de decorridos 3 meses.</p>
</li>
<li class="data-line-1039">
<p>O Bob conseguir√° transmitir a transa√ß√£o ap√≥s 3 meses.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1041">
<p>Entretanto:</p>
</div>
<div class="ulist data-line-1043">
<ul>
<li class="data-line-1043">
<p>A Alice conseguir√° criar outra transa√ß√£o, fazendo um gasto duplo das mesmas entradas sem um locktime. Portanto, a Alice conseguir√° gastar a mesma UTXO antes de decorridos os 3 meses.</p>
</li>
<li class="data-line-1044">
<p>Bob n√£o tem garantia nenhuma de que a Alice n√£o far√° isso.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1046">
<p>√â importante entender as limita√ß√µes do nLocktime da transa√ß√£o. A √∫nica garantia √© a de que o Bob n√£o conseguir√° resgatar os fundos da transa√ß√£o antes de decorridos 3 meses. N√£o h√° garantia de que o Bob receber√° os fundos. Para obter tal garantia, a restri√ß√£o do timelock deve ser colocada na pr√≥pria UTXO e fazer parte do script de travamento, em vez de ser colocada na transa√ß√£o. Isso √© obtido pela pr√≥xima forma de timelock que veremos, que se chama Check Lock Time Verify.</p>
</div>
<div class="paragraph data-line-1048">
<p>==== Check Lock Time Verify (CLTV)</p>
</div>
<div class="paragraph data-line-1050">
<p>Em dezembro de 2015, uma nova forma de timelock foi introduzida no bitcoin atrav√©s de uma atualiza√ß√£o de soft fork. Com base em uma especifica√ß√£o da BIP-65, um novo operador de script chamado <em>CHECKLOCKTIMEVERIFY</em> (<em>CLTV</em>) foi adicionado √† linguagem de script. O CLTV √© um timelock de sa√≠da, e n√£o um timelock de transa√ß√£o, como √© o caso do nLocktime. Isso permite uma flexibilidade muito maior na maneira como os timelocks s√£o aplicados.</p>
</div>
<div class="paragraph data-line-1052">
<p>Em termos simples, ao adicionar o c√≥digo operacional CLTV no script de resgate de uma sa√≠da, ele restringe a sa√≠da, de modo que ela s√≥ possa ser gasta ap√≥s o tempo especificado ter decorrido.</p>
</div>
<div class="admonitionblock tip data-line-1055">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1056">
<p>Enquanto o nLocktime √© um timelock a n√≠vel de transa√ß√£o, o CLTV √© um timelock baseado na sa√≠da.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1059">
<p>O CLTV n√£o substitui o nLocktime, mas restringe UTXOs espec√≠ficas de forma que elas s√≥ possam ser gastas em uma transa√ß√£o futura que tenha um nLocktime definido com um valor maior ou igual ao CLTV.</p>
</div>
<div class="paragraph data-line-1061">
<p>O c√≥digo operacional CLTV aceita um par√¢metro como entrada, expresso como um n√∫mero no mesmo formato que o nLocktime (uma altura de bloco ou um carimbo de data/hora da √©poca Unix). Conforme indicado pelo sufixo VERIFY, o CLTV √© o tipo de c√≥digo operacional que suspende a execu√ß√£o do script se o resultado for FALSE. Se o resultado for TRUE, a execu√ß√£o continua.</p>
</div>
<div class="paragraph data-line-1063">
<p>Para travar uma sa√≠da com o CLTV, voc√™ deve inseri-lo script de resgate da sa√≠da, que fica na transa√ß√£o que cria a sa√≠da. Por exemplo, se a Alice estivesse pagando para o endere√ßo do Bob, a sa√≠da normalmente conteria um script P2PKH como este:</p>
</div>
<div class="listingblock data-line-1065">
<div class="content">
<pre>DUP HASH160 &lt;Hash da Chave P√∫blica do Bob&gt; EQUALVERIFY CHECKSIG</pre>
</div>
</div>
<div class="paragraph data-line-1069">
<p>Para travar a sa√≠da at√© um momento no futuro, digamos, daqui a tr√™s meses, seria usada uma transa√ß√£o P2SH com um script de resgate como este:</p>
</div>
<div class="listingblock data-line-1071">
<div class="content">
<pre>&lt;agora + 3 meses&gt; CHECKLOCKTIMEVERIFY DROP DUP HASH160 &lt;Hash da Chave P√∫blica do Bob&gt; EQUALVERIFY CHECKSIG</pre>
</div>
</div>
<div class="paragraph data-line-1075">
<p>onde &lt;agora {plus} 3 meses&gt; √© uma altura de bloco ou um valor de tempo estimado em 3 meses ap√≥s a transa√ß√£o ter sido minerada: altura de bloco atual &#43; 12.960 (blocos) ou data/hora atual da √©poca Unix &#43; 7.760.000 (segundos). Por enquanto, n√£o se preocupe com o c√≥digo operacional DROP que segue o CHECKLOCKTIMEVERIFY; ele ser√° explicado em breve.</p>
</div>
<div class="paragraph data-line-1077">
<p>When Bob tries to spend this UTXO, he constructs a transaction that references the UTXO as an input. He uses his signature and public key in the unlocking script of that input and sets the transaction nLocktime to be equal to or greater than the timelock in the CHECKLOCKTIMEVERIFY Alice set. Bob then broadcasts the transaction on the Bitcoin network.</p>
</div>
<div class="paragraph data-line-1079">
<p>A transa√ß√£o do Bob √© avaliada da seguinte maneira. Se o par√¢metro CHECKLOCKTIMEVERIFY definido pela Alice for menor ou igual ao nLocktime da transa√ß√£o de gasto, a execu√ß√£o do script continua (age como se ‚Äúnenhuma opera√ß√£o‚Äù ou um c√≥digo operacional NOP tivesse sido executado). Caso contr√°rio, a execu√ß√£o do script √© suspensa e a transa√ß√£o √© considerada inv√°lida.</p>
</div>
<div class="paragraph data-line-1081">
<p>Mais precisamente, o CHECKLOCKTIMEVERIFY falha e suspende a execu√ß√£o, marcando a transa√ß√£o como inv√°lida se: (fonte: BIP-65)</p>
</div>
<div class="olist arabic data-line-1083">
<ol class="arabic">
<li class="data-line-1083">
<p>a pilha estiver vazia; ou</p>
</li>
<li class="data-line-1084">
<p>o item no topo da pilha for menor que 0; ou</p>
</li>
<li class="data-line-1085">
<p>o tipo de timelock (altura vs. carimo de data/hora) do item no topo da pilha e o campo nLocktime n√£o forem os mesmos; ou</p>
</li>
<li class="data-line-1086">
<p>o item no topo da pilha for maior que o campo nLocktime da transa√ß√£o; ou</p>
</li>
<li class="data-line-1087">
<p>o campo nSequence da entrada √© 0xffffffff.</p>
</li>
</ol>
</div>
<div class="admonitionblock note data-line-1090">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-1091">
<p>O CLTV e o nLocktime usam o mesmo formato para descrever os timelocks, seja uma altura de bloco ou um tempo decorrido em segundos desde a √©poca do Unix. √â importante frisar que, quando usados juntos, o formato do nLocktime deve corresponder ao formato do CLTV usado nas sa√≠das&#x2014;ambos devem fazer refer√™ncia ou √† altura do bloco ou √† data/hora em segundos.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1094">
<p>Ap√≥s a execu√ß√£o, se o CLTV for satisfeito, o par√¢metro de tempo que o precedeu permanece como o item superior da pilha e pode precisar ser eliminado, com o DROP, para a correta execu√ß√£o dos c√≥digos operacionais subsequentes. Por esse motivo, voc√™ frequentemente ver√° o CHECKLOCKTIMEVERIFY seguido de DROP nos scripts.</p>
</div>
<div class="paragraph data-line-1096">
<p>Ao usar o nLocktime em conjunto com o CLTV, o cen√°rio descrito em <a href="#locktime_limitations">[locktime_limitations]</a> muda. A Alice n√£o consegue mais gastar o dinheiro (pois ele est√° travado com a chave do Bob) e o Bob n√£o consegue gast√°-lo antes que o locktime de 3 meses tenha expirado.</p>
</div>
<div class="paragraph data-line-1098">
<p>Ao introduzir a funcionalidade de timelock diretamente na linguagem de script, o CLTV nos permite desenvolver alguns scripts complexos muito interessantes.</p>
</div>
<div class="paragraph data-line-1100">
<p>O padr√£o √© definido na <a href="https://github.com/bitcoin/bips/blob/master/bip-0065.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0065.mediawiki">BIP-65 (CHECKLOCKTIMEVERIFY)</a>.</p>
</div>
<div class="paragraph data-line-1102">
<p>==== Timelocks Relativos</p>
</div>
<div class="paragraph data-line-1104">
<p>O nLocktime e o CLTV s√£o ambos <em>timelocks absolutos</em> no sentido de que eles especificam um ponto absoluto no tempo. Os pr√≥ximos dois recursos de timelock que examinaremos s√£o <em>timelocks relativos</em>, pois eles especificam, como condi√ß√£o para se gastar uma sa√≠da, um tempo decorrido desde a confirma√ß√£o da sa√≠da na blockchain.</p>
</div>
<div class="paragraph data-line-1106">
<p>Os timelocks relativos s√£o √∫teis porque permitem que uma cadeia de duas ou mais transa√ß√µes interdependentes seja mantida <em>fora da cadeia</em> (em ingl√™s, <em>off-chain</em>), enquanto imp√µem uma restri√ß√£o de tempo em uma transa√ß√£o que depende do tempo decorrido desde a confirma√ß√£o de uma transa√ß√£o anterior. Em outras palavras, o rel√≥gio n√£o come√ßa a contar at√© que a UTXO seja registrada na blockchain. Esta funcionalidade √© especialmente √∫til em canais de estado bidirecionais e Lightning Networks, como veremos em <a href="#state_channels">[state_channels]</a>.</p>
</div>
<div class="paragraph data-line-1108">
<p>Os timelocks relativos, assim como os timelocks absolutos, s√£o implementados tanto como um recurso a n√≠vel de transa√ß√£o quanto como um c√≥digo operacional a n√≠vel de script. O timelock relativo a n√≠vel de transa√ß√£o √© implementado como uma regra de consenso baseada no valor do nSequence, um campo de transa√ß√£o que √© definido em cada entrada de transa√ß√£o. Os timelocks relativos a n√≠vel de script s√£o implementados com o c√≥digo operacional CHECKSEQUENCEVERIFY (CSV).</p>
</div>
<div class="paragraph data-line-1110">
<p>Os timelocks relativos s√£o implementados de acordo com as especifica√ß√µes na <a href="https://github.com/bitcoin/bips/blob/master/bip-0068.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0068.mediawiki">BIP-68, Timelock relativo usando n√∫meros de sequ√™ncia impostos por consenso</a> e na <a href="https://github.com/bitcoin/bips/blob/master/bip-0112.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0112.mediawiki">BIP-112, CHECKSEQUENCEVERIFY</a>.</p>
</div>
<div class="paragraph data-line-1112">
<p>A BIP-68 e a BIP-112 foram ativadas em maio de 2016 como uma atualiza√ß√£o de soft fork das regras de consenso.</p>
</div>
<div class="paragraph data-line-1114">
<p>==== Timelocks Relativos com nSequence</p>
</div>
<div class="paragraph data-line-1116">
<p>Os timelocks relativos podem ser definidos em cada entrada de uma transa√ß√£o, ao se definir o campo nSequence de cada entrada.</p>
</div>
<div class="paragraph data-line-1118">
<p>===== Significado original da nSequence</p>
</div>
<div class="paragraph data-line-1120">
<p>O campo nSequence foi originalmente planejado (mas nunca devidamente implementado) para permitir a modifica√ß√£o de transa√ß√µes na mempool. Nesse uso, uma transa√ß√£o contendo entradas com valor nSequence menor que 2<sup>32</sup> - 1 (0xFFFFFFFF) indicaria uma transa√ß√£o que ainda n√£o havia sido "finalizada". Essa transa√ß√£o seria mantida na mempool at√© que fosse substitu√≠da por outra transa√ß√£o gastando as mesmas entradas com um valor nSequence maior. Uma vez recebida uma transa√ß√£o cujas entradas tivessem um valor nSequence de 0xFFFFFFFF, ela seria considerada "finalizada" e minerada.</p>
</div>
<div class="paragraph data-line-1122">
<p>O significado original do nSequence nunca foi devidamente implementado e o valor do nSequence geralmente √© definido como 0xFFFFFFFF em transa√ß√µes que n√£o utilizam timelocks. Para transa√ß√µes com nLocktime ou CHECKLOCKTIMEVERIFY, o nSequence deve ser definido para um valor menor que 2<sup>31</sup> para que as prote√ß√µes do timelock tenham efeito, conforme explicado abaixo.</p>
</div>
<div class="paragraph data-line-1124">
<p>===== nSequence como um timelock relativo imposto por consenso</p>
</div>
<div class="paragraph data-line-1126">
<p>Desde a ativa√ß√£o da BIP-68, novas regras de consenso s√£o aplicadas a qualquer transa√ß√£o contendo uma entrada cujo valor do nSequence seja menor que 2<sup>31</sup> (se o bit 1&lt;&lt;31 n√£o for definido). Programaticamente, isso significa que se o bit mais significativo (bit 1&lt;&lt;31) n√£o for definido, isso √© um sinalizador que significa "timelock relativo". Caso contr√°rio (se o bit 1&lt;&lt;31 for definido), o valor do nSequence √© reservado para outros usos, como habilitar o CHECKLOCKTIMEVERIFY, o nLocktime, o Opt-In-Replace-By-Fee e outros desenvolvimentos futuros.</p>
</div>
<div class="paragraph data-line-1128">
<p>As entradas de transa√ß√£o com valores de nSequence menores que 2<sup>31</sup> s√£o interpretadas como tendo um timelock relativo. Essa transa√ß√£o s√≥ ser√° considerada v√°lida depois que a entrada envelhecer o valor do timelock relativo. Por exemplo, uma transa√ß√£o com uma entrada com um nSequence definindo um timelock relativo de 30 blocos s√≥ ser√° considerada v√°lida quando pelo menos 30 blocos tiverem decorrido desde o momento em que a UTXO referenciada na entrada foi minerada. Visto que existe um campo nSequence em cada entrada, uma transa√ß√£o pode conter qualquer n√∫mero de entradas com timelock, todas as quais devem ter envelhecido o suficiente para que a transa√ß√£o seja considerada v√°lida. Uma transa√ß√£o pode incluir ao mesmo tempo entradas com timelock (nSequence &lt; 2<sup>31</sup>) e entradas sem um timelock relativo (nSequence &gt;= 2<sup>31</sup>).</p>
</div>
<div class="paragraph data-line-1130">
<p>O valor do nSequence √© especificado em blocos ou segundos, mas em um formato ligeiramente diferente do que √© usado no nLocktime. Um sinalizador de tipo √© usado para diferenciar entre valores contando blocos e valores contando tempo em segundos. O sinalizador de tipo √© definido no 23¬∫ bit menos significativo (ou seja, o valor 1&lt;&lt;22). Se o sinalizador de tipo for definido, o valor do nSequence ser√° interpretado como um m√∫ltiplo de 512 segundos. Se o sinalizador de tipo n√£o for definido, o valor do nSequence ser√° interpretado como um n√∫mero de blocos.</p>
</div>
<div class="paragraph data-line-1132">
<p>Ao interpretar o nSequence como um timelock relativo, apenas os 16 bits menos significativos s√£o considerados. Uma vez que os sinalizadores (bits 32 e 23) s√£o avaliados, o valor do nSequence √© geralmente "mascarado" com uma m√°scara de 16 bits (por exemplo, nSequence e 0x0000FFFF).</p>
</div>
<div class="paragraph data-line-1134">
<p>A <a href="#bip_68_def_of_nseq">Defini√ß√£o da codifica√ß√£o nSequence na BIP-68 (Fonte: BIP-68)</a> mostra o layout bin√°rio do valor nSequence, conforme definido pela BIP-68.</p>
</div>
<div id="bip_68_def_of_nseq" class="imageblock data-line-1138">
<div class="content">
<img src="images/mbc2_0701.png" alt="BIP-68 definition of nSequence encoding">
</div>
<div class="title">Figure 45. Defini√ß√£o da codifica√ß√£o nSequence na BIP-68 (Fonte: BIP-68)</div>
</div>
<div class="paragraph data-line-1141">
<p>Os timelocks relativos baseados em imposi√ß√£o por consenso do valor nSequence s√£o definidos na BIP-68.</p>
</div>
<div class="paragraph data-line-1143">
<p>O padr√£o √© definido na <a href="https://github.com/bitcoin/bips/blob/master/bip-0068.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0068.mediawiki">BIP-68, Timelock relativo usando n√∫meros de sequ√™ncia impostos por consenso</a>.</p>
</div>
<div class="paragraph data-line-1145">
<p>==== Timelocks Relativos com CSV</p>
</div>
<div class="paragraph data-line-1147">
<p>Assim como o CLTV e o nLocktime, existe tamb√©m um c√≥digo operacional de script para timelocks relativos que aproveita o valor do nSequence contido em scripts. Esse c√≥digo operacional √© o CHECKSEQUENCEVERIFY, comumente referido como CSV.</p>
</div>
<div class="paragraph data-line-1149">
<p>O c√≥digo operacional CSV, quando avaliado em um script de resgate de UTXO, permite que a UTXO seja gasta apenas em uma transa√ß√£o cujo valor nSequence da entrada seja maior ou igual ao par√¢metro CSV. Essencialmente, isso restringe o gasto da UTXO at√© que um certo n√∫mero de blocos ou segundos tenham decorrido em rela√ß√£o ao momento em que a UTXO foi minerada.</p>
</div>
<div class="paragraph data-line-1151">
<p>Tal como acontece com o CLTV, o valor no CSV deve corresponder ao formato usado no valor nSequence correspondente. Se o CSV for especificado em blocos, ent√£o o nSequence tamb√©m deve ser especificado em blocos. Se o CSV for especificado em segundos, ent√£o o nSequence tamb√©m deve ser especificado em segundos.</p>
</div>
<div class="paragraph data-line-1153">
<p>Os timelocks relativos com CSV s√£o especialmente √∫teis quando v√°rias transa√ß√µes (relacionadas entre si) s√£o criadas e assinadas, mas n√£o propagadas, sendo mantidas "fora da cadeia" (<em>off-chain</em>). Uma transa√ß√£o filha n√£o pode ser usada at√© que a transa√ß√£o pai tenha sido propagada e minerada, e tenha envelhecido o tempo especificado no timelock relativo. Uma aplica√ß√£o deste caso de uso pode ser vista em <a href="#state_channels">[state_channels]</a> e <a href="#lightning_network">[lightning_network]</a>.</p>
</div>
<div class="paragraph data-line-1155">
<p>O CSV √© definido em detalhes na <a href="https://github.com/bitcoin/bips/blob/master/bip-0112.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0112.mediawiki">BIP-112, CHECKSEQUENCEVERIFY</a>.</p>
</div>
<div class="paragraph data-line-1158">
<p>==== Median-Time-Past</p>
</div>
<div class="paragraph data-line-1160">
<p>Como parte da ativa√ß√£o dos timelocks relativos, houve tamb√©m uma mudan√ßa na forma como o tempo √© calculado para os timelocks (absolutos e relativos). No bitcoin, h√° uma diferen√ßa sutil, mas muito significativa, entre o hor√°rio real (hor√°rio no rel√≥gio de parede) e o hor√°rio de consenso. O bitcoin √© uma rede descentralizada, o que significa que cada participante tem sua pr√≥pria perspectiva de tempo. Os eventos na rede n√£o ocorrem instantaneamente em todos os lugares. A lat√™ncia da rede deve ser levada em considera√ß√£o na perspectiva de cada n√≥. No final, todas as informa√ß√µes s√£o sincronizadas para criar um livro-raz√£o comum. A cada 10 minutos, o bitcoin chega a um consenso sobre qual era o estado do livro-raz√£o no <em>passado</em>.</p>
</div>
<div class="paragraph data-line-1162">
<p>Os carimbos de data e hora definidos nos cabe√ßalhos dos blocos s√£o definidos pelos mineradores. As regras de consenso permitem um certo grau de liberdade para os mineradores, para considerar as diferen√ßas que existem na precis√£o dos rel√≥gios dos n√≥s descentralizados. No entanto, isso infelizmente cria um incentivo para os mineradores mentirem sobre o hor√°rio em que um bloco foi minerado, a fim de ganharem taxas extras ao inclu√≠rem transa√ß√µes com timelocks que ainda n√£o amadureceram. Veja a se√ß√£o a seguir para obter mais informa√ß√µes.</p>
</div>
<div class="paragraph data-line-1164">
<p>Para remover o incentivo que existe para os mineradores mentirem e para fortalecer a seguran√ßa dos timelocks, uma BIP foi proposta e ativada ao mesmo tempo que as BIPs para os timelocks relativos. Ela √© a BIP-113, que define uma nova medida de consenso de hor√°rio, a chamada <em>Median-Time-Past</em>.</p>
</div>
<div class="paragraph data-line-1166">
<p>A <em>Median-Time-Past</em> (em portugu√™s, <em>Mediana-do-Hor√°rio-do-Passado</em>) √© calculada obtendo-se os registros de data e hora dos √∫ltimos 11 blocos e encontrando-se a mediana. Esse hor√°rio mediano ent√£o se torna o hor√°rio de consenso e √© usado para todos os c√°lculos de timelock. Ao tomar o ponto m√©dio de aproximadamente duas horas no passado, a influ√™ncia do registro de data e hora de qualquer bloco isolado √© reduzida. Ao incorporar 11 blocos, nenhum minerador consegue influenciar sozinho os registros de data e hora a fim de ganhar taxas de transa√ß√µes com timelocks que ainda n√£o amadureceram.</p>
</div>
<div class="paragraph data-line-1168">
<p>A Median-Time-Past altera a implementa√ß√£o de c√°lculos de hora para o nLocktime, o CLTV, o nSequence e o CSV. O hor√°rio de consenso calculado pela Median-Time-Past est√° sempre aproximadamente uma hora atrasado em rela√ß√£o ao hor√°rio real (do rel√≥gio). Se voc√™ for criar transa√ß√µes com timelock, voc√™ dever√° levar isso em considera√ß√£o ao estimar o valor desejado para codificar no nLocktime, nSequence, CLTV e CSV.</p>
</div>
<div class="paragraph data-line-1170">
<p>A Median-Time-Past √© especificada na <a href="https://github.com/bitcoin/bips/blob/master/bip-0113.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0113.mediawiki">BIP-113</a>.</p>
</div>
<div id="fee_sniping" class="paragraph data-line-1173">
<p>==== Timelock como Prote√ß√£o contra Sniping de Taxas</p>
</div>
<div class="paragraph data-line-1175">
<p>O <em>sniping</em> de taxas √© um cen√°rio de ataque te√≥rico, no qual mineradores tentando reescrever blocos anteriores incluem transa√ß√µes com taxas maiores de blocos futuros, com o objetivo de maximizar os seus lucros.</p>
</div>
<div class="paragraph data-line-1177">
<p>Por exemplo, digamos que o bloco mais alto existente seja o bloco n¬∫100.000. Imagine que, em vez de tentar minerar o bloco n¬∫100.001 para estender a cadeia, alguns mineradores tentem reminerar o bloco n¬∫100.000. Esses mineradores podem decidir incluir qualquer transa√ß√£o v√°lida (que ainda n√£o foi minerada) em seu bloco candidato n¬∫100.000. Eles n√£o precisam refazer o bloco com as mesmas transa√ß√µes. Na verdade, eles t√™m um incentivo para escolher as transa√ß√µes mais lucrativas (com a maior taxa por KB) para incluir em seu bloco. Eles podem incluir quaisquer transa√ß√µes que estavam no bloco "antigo" n¬∫100.000, bem como quaisquer transa√ß√µes que estejam na mempool atual. Essencialmente, ao recriarem o bloco n¬∫100.000, eles t√™m a possibilidade de puxar as transa√ß√µes do "presente" para o "passado" reescrito.</p>
</div>
<div class="paragraph data-line-1179">
<p>Hoje, esse ataque n√£o √© muito lucrativo, pois a recompensa do bloco √© muito maior do que as taxas totais por bloco. Mas, em algum momento no futuro, as taxas de transa√ß√£o constituir√£o a maior parte da recompensa da minera√ß√£o (ou mesmo a totalidade da recompensa da minera√ß√£o). Nesse momento, esse cen√°rio se tornar√° inevit√°vel.</p>
</div>
<div class="paragraph data-line-1181">
<p>Para prevenir o "<em>sniping</em> de taxas", quando o Bitcoin Core cria transa√ß√µes, ele usa o nLocktime para limit√°-las ao "pr√≥ximo bloco", por padr√£o. Em nosso cen√°rio, o Bitcoin Core definiria o nLocktime como 100.001 em qualquer transa√ß√£o criada. Em circunst√¢ncias normais, este nLocktime n√£o tem efeito&#x2014; de qualquer maneira, as transa√ß√µes s√≥ poderiam ser inclu√≠das no bloco n¬∫100.001, pois ele √© o pr√≥ximo bloco.</p>
</div>
<div class="paragraph data-line-1183">
<p>Mas sob um ataque de fork/gasto duplo, os mineradores n√£o seriam capazes de incluir as transa√ß√µes da mempool que tem taxas altas, pois todas essas transa√ß√µes teriam um <em>timelock</em> para o bloco n¬∫100.001. Eles s√≥ conseguiriam reminerar o bloco n¬∫100.000 com quaisquer transa√ß√µes que fossem v√°lidas naquele momento no passado, ou seja, eles n√£o ganhariam novas taxas.</p>
</div>
<div class="paragraph data-line-1185">
<p>Para obter essa prote√ß√£o, o Bitcoin Core define o nLocktime em todas as novas transa√ß√µes como &lt;n¬∫ do bloco atual + 1&gt; e define o nSequence em todas as entradas como 0xFFFFFFFE para ativar o nLocktime.</p>
</div>
<div class="paragraph data-line-1187">
<p>=== Scripts com Controle de Fluxo (Cl√°usulas Condicionais)</p>
</div>
<div class="paragraph data-line-1189">
<p>Um dos recursos mais poderosos do Bitcoin Script √© o controle de fluxo, tamb√©m conhecido como cl√°usulas condicionais. Voc√™ provavelmente est√° familiarizado com o controle de fluxo em v√°rias linguagens de programa√ß√£o que usam a constru√ß√£o IF...THEN...ELSE. As cl√°usulas condicionais do bitcoin podem parecer um pouco diferentes, mas s√£o essencialmente a mesma constru√ß√£o.</p>
</div>
<div class="paragraph data-line-1191">
<p>Em um n√≠vel b√°sico, os c√≥digos operacionais condicionais do bitcoin nos permitem construir um script de resgate que tenha duas maneiras de ser destravado, dependendo de um resultado TRUE/FALSE (verdadeiro/falso) da avalia√ß√£o de uma condi√ß√£o l√≥gica. Por exemplo, se (IF) x for verdadeiro (TRUE), o script de resgate ser√° A, caso contr√°rio (ELSE), o script de resgate ser√° B.</p>
</div>
<div class="paragraph data-line-1193">
<p>Al√©m disso, as express√µes condicionais do bitcoin podem ser "aninhadas" indefinidamente, o que significa que uma cl√°usula condicional pode conter outra dentro dela, que cont√©m outra, etc. O controle de fluxo do Bitcoin Script pode ser usado para construir scripts muito complexos com centenas ou mesmo milhares de caminhos de execu√ß√£o poss√≠veis. N√£o h√° limite para o aninhamento, mas as regras de consenso imp√µem um limite no tamanho m√°ximo, em bytes, de um script.</p>
</div>
<div class="paragraph data-line-1195">
<p>O bitcoin implementa o controle de fluxo usando os c√≥digos operacionais IF, ELSE, ENDIF e NOTIF. Al√©m disso, as express√µes condicionais podem conter operadores booleanos, como BOOLAND, BOOLOR e NOT.</p>
</div>
<div class="paragraph data-line-1197">
<p>√Ä primeira vista, voc√™ pode achar os scripts de controle de fluxo do bitcoin confusos. Isso ocorre porque o Bitcoin Script √© uma linguagem de pilha. Da mesma forma que 1 {plus} 1 parece "invertido" quando expresso como 1 1 ADD, as cl√°usulas de controle de fluxo do bitcoin tamb√©m parecem que est√£o "invertidas".</p>
</div>
<div class="paragraph data-line-1199">
<p>Na maioria das linguagens de programa√ß√£o tradicionais (procedurais), o controle de fluxo tem a seguinte apar√™ncia:</p>
</div>
<div class="listingblock data-line-1202">
<div class="title">Pseudoc√≥digo do controle de fluxo na maioria das linguagens de programa√ß√£o</div>
<div class="content">
<pre>if ("se", condi√ß√£o):
  c√≥digo a ser executado quando a condi√ß√£o for verdadeira
else ("caso contr√°rio"):
  c√≥digo a ser executado quando a condi√ß√£o for falsa
c√≥digo a ser executado em qualquer caso</pre>
</div>
</div>
<div class="paragraph data-line-1210">
<p>Em uma linguagem baseada em pilha como o Bitcoin Script, a condi√ß√£o l√≥gica vem antes do IF, o que faz com que ela aparente estar "invertida", dessa maneira:</p>
</div>
<div class="listingblock data-line-1213">
<div class="title">Controle de fluxo no Bitcoin Script</div>
<div class="content">
<pre>condi√ß√£o
IF
  c√≥digo a ser executado quando a condi√ß√£o for verdadeira
ELSE
  c√≥digo a ser executado quando a condi√ß√£o for falsa
ENDIF
c√≥digo a ser executado em qualquer caso</pre>
</div>
</div>
<div class="paragraph data-line-1223">
<p>Ao ler o Bitcoin Script, lembre-se de que a condi√ß√£o avaliada vem <em>antes</em> do c√≥digo operacional IF.</p>
</div>
<div class="paragraph data-line-1225">
<p>==== Cl√°usulas Condicionais com C√≥digos Operacionais VERIFY</p>
</div>
<div class="paragraph data-line-1227">
<p>Outra forma de condicional no Bitcoin Script √© qualquer c√≥digo operacional que termina em VERIFY. O sufixo VERIFY significa que se a condi√ß√£o avaliada n√£o for TRUE (verdadeira), a execu√ß√£o do script √© imediatamente encerrada e a transa√ß√£o √© considerada inv√°lida.</p>
</div>
<div class="paragraph data-line-1229">
<p>Ao contr√°rio de uma cl√°usula IF, que oferece caminhos de execu√ß√£o alternativos, o sufixo VERIFY atua como uma <em>cl√°usula de prote√ß√£o</em>, continuando apenas se uma pr√©-condi√ß√£o for atendida.</p>
</div>
<div class="paragraph data-line-1231">
<p>Por exemplo, o script a seguir requer a assinatura do Bob e uma pr√©-imagem (um segredo) que produz um hash espec√≠fico. Ambas as condi√ß√µes devem ser satisfeitas para destrav√°-lo:</p>
</div>
<div class="listingblock data-line-1234">
<div class="title">Um script de resgate com uma cl√°usula de prote√ß√£o EQUALVERIFY.</div>
<div class="content">
<pre>HASH160 &lt;hash esperado&gt; EQUALVERIFY &lt;Chave P√∫blica do Bob&gt; CHECKSIG</pre>
</div>
</div>
<div class="paragraph data-line-1238">
<p>Para resgat√°-lo, o Bob deve construir um script de destravamento que apresente uma pr√©-imagem v√°lida e uma assinatura:</p>
</div>
<div class="listingblock data-line-1241">
<div class="title">Um script de destravamento para satisfazer o script de resgate acima</div>
<div class="content">
<pre>&lt;Assinatura do Bob&gt; &lt;hash da pr√©-imagem&gt;</pre>
</div>
</div>
<div class="paragraph data-line-1245">
<p>Sem apresentar a pr√©-imagem, Bob n√£o consegue chegar √† parte do script que verifica sua assinatura.</p>
</div>
<div class="paragraph pagebreak-after data-line-1248">
<p>Este script tamb√©m poderia ser escrito com um IF:</p>
</div>
<div class="listingblock data-line-1251">
<div class="title">Um script de resgate com uma cl√°usula de prote√ß√£o IF</div>
<div class="content">
<pre>HASH160 &lt;hash esperado&gt; EQUAL
IF
   &lt;Chave p√∫blica do Bob&gt; CHECKSIG
ENDIF</pre>
</div>
</div>
<div class="paragraph data-line-1258">
<p>O script de destravamento do Bob √© id√™ntico:</p>
</div>
<div class="listingblock data-line-1261">
<div class="title">Um script de destravamento para satisfazer o script de resgate acima</div>
<div class="content">
<pre>&lt;Assinatura do Bob&gt; &lt;hash da pr√©-imagem&gt;</pre>
</div>
</div>
<div class="paragraph data-line-1265">
<p>O script com o IF faz a mesma coisa que usar um c√≥digo operacional com um sufixo VERIFY; ambos funcionam como cl√°usulas de prote√ß√£o. No entanto, a constru√ß√£o com o VERIFY √© mais eficiente, pois usa dois c√≥digos operacionais a menos.</p>
</div>
<div class="paragraph data-line-1267">
<p>Ent√£o, quando devemos usar o VERIFY e quando devemos usar  o IF? Se tudo o que estamos tentando fazer √© anexar uma pr√©-condi√ß√£o (uma cl√°usula de prote√ß√£o), ent√£o √© melhor usarmos o VERIFY. Se, entretanto, quisermos ter mais de um caminho de execu√ß√£o (um controle de fluxo), ent√£o precisamos de uma cl√°usula de controle de fluxo IF...ELSE.</p>
</div>
<div class="admonitionblock tip data-line-1270">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1271">
<p>Um c√≥digo operacional como o EQUAL adicionar√° o resultado (TRUE/FALSE) na pilha, deixando-o l√° para ser avaliado por c√≥digos operacionais subsequentes. Em contraste, o sufixo de c√≥digo operacional EQUALVERIFY n√£o deixa nada na pilha. Os c√≥digos operacionais que terminam em VERIFY n√£o deixam o resultado na pilha.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1274">
<p>==== Usando Controle de Fluxo em Scripts</p>
</div>
<div class="paragraph data-line-1276">
<p>Um uso muito comum para o controle de fluxo no Bitcoin Script √© construir um script de resgate que oferece v√°rios caminhos de execu√ß√£o, cada um com uma maneira diferente de resgatar a UTXO.</p>
</div>
<div class="paragraph data-line-1278">
<p>Vejamos um exemplo simples, em que temos dois signat√°rios, a Alice e o Bob, e qualquer um deles pode resgatar. Com a funcionalidade de multiassinatura, isso seria expresso como um script multiassinatura 1-de-2. Para fins de demonstra√ß√£o, faremos a mesma coisa com uma cl√°usula IF:</p>
</div>
<div class="listingblock data-line-1280">
<div class="content">
<pre>IF
 &lt;Chave P√∫blica da Alice&gt; CHECKSIG
ELSE
 &lt;Chave p√∫blica do Bob&gt; CHECKSIG
ENDIF</pre>
</div>
</div>
<div class="paragraph data-line-1288">
<p>Olhando para este script de resgate, voc√™ pode estar se perguntando: "Onde est√° a condi√ß√£o? N√£o h√° nada antes da cl√°usula IF!"</p>
</div>
<div class="paragraph data-line-1290">
<p>A condi√ß√£o n√£o faz parte do script de resgate. Em vez disso, a condi√ß√£o ser√° oferecida no script de destravamento, permitindo que a Alice e o Bob "escolham" o caminho de execu√ß√£o que eles quiserem.</p>
</div>
<div class="paragraph data-line-1292">
<p>A Alice resgata a UTXO com o seguinte script de destravamento:</p>
</div>
<div class="listingblock data-line-1293">
<div class="content">
<pre>&lt;Assinatura da Alice&gt; 1</pre>
</div>
</div>
<div class="paragraph data-line-1297">
<p>O 1 no final serve como a condi√ß√£o (TRUE) que far√° com que a cl√°usula IF execute o primeiro caminho de resgate, para o qual a Alice tem uma assinatura.</p>
</div>
<div class="paragraph data-line-1299">
<p>Para que o Bob resgatasse a UTXO, ele teria que escolher o segundo caminho de execu√ß√£o atribuindo um valor FALSE √† cl√°usula IF:</p>
</div>
<div class="listingblock data-line-1301">
<div class="content">
<pre>&lt;Assinatura do Bob&gt; 0</pre>
</div>
</div>
<div class="paragraph data-line-1305">
<p>O script de destravamento do Bob coloca um 0 na pilha, fazendo com que a cl√°usula IF execute o segundo script (ELSE), que requer a assinatura de Bob.</p>
</div>
<div class="paragraph data-line-1307">
<p>Como as cl√°usulas IF podem ser aninhadas, podemos criar um "labirinto" de caminhos de execu√ß√£o. O script de destravamento pode fornecer um "mapa" selecionando qual caminho de execu√ß√£o √© de fato executado:</p>
</div>
<div class="listingblock data-line-1309">
<div class="content">
<pre>IF
  script A
ELSE
  IF
    script B
  ELSE
    script C
  ENDIF
ENDIF</pre>
</div>
</div>
<div class="paragraph data-line-1321">
<p>Nesse cen√°rio, h√° tr√™s caminhos de execu√ß√£o (script A, script B e script C). O script de destravamento fornece um caminho na forma de uma sequ√™ncia de valores TRUE ou FALSE. Para selecionar o caminho script B, por exemplo, o script de destravamento deve terminar em 1 0 (TRUE, FALSE). Esses valores ser√£o adicionados na pilha, de modo que o segundo valor (FALSE) termine no topo da pilha. A cl√°usula IF externa remove o valor FALSE da pilha e executa a primeira cl√°usula ELSE. Em seguida, o valor TRUE √© movido para o topo da pilha e √© avaliado pelo IF interno (aninhado), selecionando o caminho de execu√ß√£o B.</p>
</div>
<div class="paragraph data-line-1323">
<p>Usando essa constru√ß√£o, podemos fazer scripts de resgate com dezenas ou centenas de caminhos de execu√ß√£o, cada um oferecendo uma maneira diferente de resgatar a UTXO. Para gastar, constru√≠mos um script de destravamento que navega pelo caminho de execu√ß√£o, colocando os valores TRUE e FALSE apropriados na pilha em cada ponto de controle de fluxo. </p>
</div>
<div class="paragraph data-line-1325">
<p>=== Exemplo de Script Complexo</p>
</div>
<div class="paragraph data-line-1327">
<p>Nesta se√ß√£o combinaremos muitos dos conceitos deste cap√≠tulo em um √∫nico exemplo.</p>
</div>
<div class="paragraph data-line-1329">
<p>Nosso exemplo usa a hist√≥ria do Mohammed, o propriet√°rio da empresa de Dubai que opera um neg√≥cio de importa√ß√£o/exporta√ß√£o.</p>
</div>
<div class="paragraph data-line-1331">
<p>Neste exemplo, o Mohammed deseja construir uma conta de capital da empresa com regras flex√≠veis. O esquema que ele est√° criando requer diferentes n√≠veis de autoriza√ß√£o dependendo dos timelocks. Os participantes do esquema multiassinatura s√£o o Mohammed, seus dois s√≥cios Saeed e Zaira, e o advogado da empresa, o Abdul. Os tr√™s s√≥cios tomam decis√µes com base na regra da maioria, portanto, dois dos tr√™s devem concordar. No entanto, caso haja algum problema com suas chaves, eles querem que seu advogado possa recuperar os fundos com uma assinatura dos tr√™s s√≥cios. Finalmente, se todos os s√≥cios estiverem indispon√≠veis ou incapacitados por um tempo, eles querem que o advogado possa administrar a conta diretamente.</p>
</div>
<div class="paragraph data-line-1333">
<p>A seguir est√° o script de resgate que o Mohammed desenvolveu para o seu esquema multiassinatura (os n√∫meros no in√≠cio de cada linha correspondem ao n√∫mero da linha no script):</p>
</div>
<div class="listingblock data-line-1336">
<div class="title">Multiassinatura Vari√°vel com Timelock</div>
<div class="content">
<pre>01  IF
02    IF
03      2
04    ELSE
05      &lt;30 dias&gt; CHECKSEQUENCEVERIFY DROP
06      &lt;Chave P√∫blica do Advogado Abdul&gt; CHECKSIGVERIFY
07      1
08    ENDIF
09    &lt;Chave P√∫blica do Mohammed&gt; &lt;Chave P√∫blica do Saeed&gt; &lt;Chave P√∫blica da Zaira&gt; 3 CHECKMULTISIG
10  ELSE
11    &lt;90 dias&gt; CHECKSEQUENCEVERIFY DROP
12    &lt;Chave P√∫blica do Advogado Abdul&gt; CHECKSIG
13  ENDIF</pre>
</div>
</div>
<div class="paragraph data-line-1352">
<p>O script do Mohammed implementa tr√™s caminhos de execu√ß√£o usando cl√°usulas de controle de fluxo IF...ELSE aninhadas.</p>
</div>
<div class="paragraph data-line-1354">
<p>No primeiro caminho de execu√ß√£o, este script opera como uma multiassinatura 2-de-3 simples com os tr√™s s√≥cios. Este caminho de execu√ß√£o consiste nas linhas 3 e 9. A linha 3 define o qu√≥rum da multiassinatura para 2 (2-de-3). Este caminho de execu√ß√£o pode ser selecionado colocando-se TRUE TRUE no final do script de destravamento:</p>
</div>
<div class="listingblock data-line-1357">
<div class="title">Script de destravamento para o primeiro caminho de execu√ß√£o (multiassinatura 2-de-3)</div>
<div class="content">
<pre>0 &lt;Assinatura do Mohammed&gt; &lt;Assinatura da Zaira&gt; TRUE TRUE</pre>
</div>
</div>
<div class="admonitionblock tip data-line-1363">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1364">
<p>O 0 no in√≠cio deste script de destravamento √© devido a um bug no CHECKMULTISIG que remove um valor extra da pilha. O valor extra √© desconsiderado pelo CHECKMULTISIG, mas ele deve estar presente, caso contr√°rio o script falhar√°. Uma solu√ß√£o para contornar o bug geralmente consiste em adicionar um 0, conforme descrito em <a href="#multisig_bug">[multisig_bug]</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1367">
<p>O segundo caminho de execu√ß√£o s√≥ pode ser usado 30 dias ap√≥s a cria√ß√£o da UTXO. Ap√≥s passados esses 30 dias, ele exigir√° a assinatura do advogado Abdul e a assinatura de um dos tr√™s s√≥cios (uma multiassinatura 1-de-3). Isso √© realizado na linha 7 do script, que define o qu√≥rum da multiassinatura para 1. Para selecionar este caminho de execu√ß√£o, o script de destravamento terminaria em FALSE TRUE:</p>
</div>
<div class="listingblock data-line-1370">
<div class="title">Script de destravamento para o segundo caminho de execu√ß√£o (advogado + 1-de-3)</div>
<div class="content">
<pre>0 &lt;Assinatura do Advogado Abdul&gt; &lt;Assinatura do Saeed&gt; FALSE TRUE</pre>
</div>
</div>
<div class="admonitionblock tip data-line-1375">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1376">
<p>Por que FALSE TRUE? Isso n√£o est√° invertido? Isso acontece porque os dois valores s√£o adicionados na pilha, o FALSE sendo adicionado primeiro e o TRUE sendo adicionado em seguida. O TRUE √©, portanto, o <em>primeiro</em> valor a ser removido pelo primeiro c√≥digo operacional IF.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1379">
<p>Por fim, o terceiro caminho de execu√ß√£o permite que o Abdul, o advogado, gaste os fundos sozinho, mas somente ap√≥s 90 dias. Para selecionar este caminho de execu√ß√£o, o script de destravamento deve terminar em FALSE:</p>
</div>
<div class="listingblock data-line-1382">
<div class="title">Script de destravamento para o terceiro caminho de execu√ß√£o (apenas o advogado)</div>
<div class="content">
<pre>&lt;Assinatura do Advogado Abdul&gt; FALSE</pre>
</div>
</div>
<div class="paragraph data-line-1386">
<p>Tente executar o script no papel para ver como ele se comporta na pilha.</p>
</div>
<div class="paragraph data-line-1388">
<p>Mais algumas coisas a serem consideradas ao ler este exemplo. Veja se voc√™ consegue encontrar as respostas:</p>
</div>
<div class="ulist data-line-1390">
<ul>
<li class="data-line-1390">
<p>Por que o advogado n√£o pode resgatar o terceiro caminho de execu√ß√£o a qualquer momento, selecionando-o com FALSE no script de destravamento?</p>
</li>
<li class="data-line-1392">
<p>Quantos caminhos de execu√ß√£o podem ser usados 5, 35 e 105 dias, respectivamente, ap√≥s a UTXO ser minerada?</p>
</li>
<li class="data-line-1394">
<p>Os fundos s√£o perdidos se o advogado perder a chave? Sua resposta mudaria caso 91 dias se passaram?</p>
</li>
<li class="data-line-1396">
<p>De que maneira os s√≥cios "zeram" o rel√≥gio a cada 29 ou 89 dias para prevenir que o advogado acesse os fundos?</p>
</li>
<li class="data-line-1398">
<p>Por que alguns c√≥digos operacionais CHECKSIG neste script t√™m o sufixo VERIFY e outros n√£o?</p>
</li>
</ul>
</div>
<div id="segwit" class="paragraph data-line-1401">
<p>=== Segregated Witness (Testemunha Segregada)</p>
</div>
<div class="paragraph data-line-1403">
<p>A Segregated Witness ou segwit (em portugu√™s, Testemunha Segregada) √© uma atualiza√ß√£o para as regras de consenso do bitcoin e para o protocolo da rede, que foi proposta e implementada como um soft-fork BIP-9, o qual foi ativado na rede principal do bitcoin em 1¬∫ de agosto de 2017.</p>
</div>
<div class="paragraph data-line-1405">
<p>Na criptografia, o termo "testemunha" (em ingl√™s, <em>witness</em>) √© usado para descrever uma solu√ß√£o para um quebra-cabe√ßa criptogr√°fico. Em termos de bitcoin, a testemunha satisfaz uma condi√ß√£o criptogr√°fica colocada em uma sa√≠da de transa√ß√£o n√£o gasta (UTXO).</p>
</div>
<div class="paragraph data-line-1407">
<p>No contexto do bitcoin, uma assinatura digital √© <em>um tipo de testemunha</em>, mas uma testemunha √© mais amplamente qualquer solu√ß√£o que seja capaz de satisfazer as condi√ß√µes impostas a uma UTXO e de destravar essa UTXO para ser gasta. O termo "testemunha" √© um termo mais geral para um "script de destravamento" ou "scriptSig".</p>
</div>
<div class="paragraph data-line-1409">
<p>Antes da introdu√ß√£o da segwit, cada entrada em uma transa√ß√£o era seguida pelos dados de testemunha que a destravavam. Os dados de testemunha eram incorporados √† transa√ß√£o como parte de cada entrada. Portanto, "<em>testemunha segregada</em>" nada mais √© do que separar (segregar) a assinatura ou o script de destravamento de uma sa√≠da espec√≠fica. Para simplificar, pense como se fosse um "scriptSig separado" ou uma "assinatura separada".</p>
</div>
<div class="paragraph data-line-1411">
<p>A Segregated Witness, portanto, √© uma mudan√ßa arquitet√¥nica para o bitcoin que visa mover os dados de testemunha do campo scriptSig (script de destravamento) de uma transa√ß√£o para uma estrutura separada de dados de <em>testemunha</em> que acompanha uma transa√ß√£o. Os clientes podem solicitar dados de transa√ß√µes com ou sem os dados de testemunha que as acompanham.</p>
</div>
<div class="paragraph data-line-1413">
<p>Nesta se√ß√£o, veremos alguns dos benef√≠cios da Segregated Witness, descreveremos o mecanismo usado para implantar e implementar essa mudan√ßa de arquitetura, assim como demonstraremos o uso da Segregated Witness em transa√ß√µes e endere√ßos.</p>
</div>
<div class="paragraph data-line-1415">
<p>A Segregated Witness √© definida pelas seguintes BIPs:</p>
</div>
<div class="dlist data-line-1417">
<dl>
<dt class="hdlist1"><a href="https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki">BIP-141</a> </dt>
<dd>
<p>A defini√ß√£o principal da Segregated Witness.</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/bitcoin/bips/blob/master/bip-0143.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0143.mediawiki">BIP-143</a> </dt>
<dd>
<p>Verifica√ß√£o de Assinatura de Transa√ß√£o para o Programa de Testemunha Vers√£o 0</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/bitcoin/bips/blob/master/bip-0144.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0144.mediawiki">BIP-144</a> </dt>
<dd>
<p>Servi√ßos de Par&#x2014;Novas mensagens de rede e formatos de serializa√ß√£o</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/bitcoin/bips/blob/master/bip-0145.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0145.mediawiki">BIP-145</a> </dt>
<dd>
<p>Atualiza√ß√µes do getblocktemplate para a Segregated Witness (para minera√ß√£o)</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/bitcoin/bips/blob/master/bip-0173.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0173.mediawiki">BIP-173</a></dt>
<dd>
<p>Formato de endere√ßo Base32 para sa√≠das de testemunha v0-16 nativas</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-1428">
<p>==== Por que a Segregated Witness foi Implementada?</p>
</div>
<div class="paragraph data-line-1430">
<p>A Segregated Witness √© uma mudan√ßa arquitet√¥nica que tem v√°rios efeitos sobre a escalabilidade, a seguran√ßa, os incentivos econ√¥micos e o desempenho do bitcoin:</p>
</div>
<div class="dlist data-line-1432">
<dl>
<dt class="hdlist1">Maleabilidade de transa√ß√£o </dt>
<dd>
<p>Ao mover a testemunha para fora dos dados da transa√ß√£o, o hash de transa√ß√£o, que √© usado como um identificador, deixa de incluir os dados de testemunha. Como os dados de testemunha s√£o a √∫nica parte da transa√ß√£o que pode ser modificada por terceiros (ver <a href="#segwit_txid">[segwit_txid]</a>), remov√™-los tamb√©m remove a oportunidade para ataques de maleabilidade de transa√ß√£o. Com a Segregated Witness, os hashes de transa√ß√£o tornam-se imut√°veis para qualquer pessoa que n√£o seja o criador da transa√ß√£o, o que representa um grande avan√ßo na implementa√ß√£o de muitos outros protocolos que dependem da constru√ß√£o de transa√ß√µes de bitcoin avan√ßadas, como canais de pagamento, transa√ß√µes encadeadas e redes lightning.</p>
</dd>
<dt class="hdlist1">Controle de Vers√£o de Script </dt>
<dd>
<p>Com a introdu√ß√£o de scripts de Segregated Witness, cada script de travamento √© precedido por um n√∫mero de <em>vers√£o de script</em>, semelhante √† maneira como as transa√ß√µes e os blocos t√™m n√∫meros de vers√£o. A adi√ß√£o de um n√∫mero de vers√£o de script permite que a linguagem de script seja atualizada de maneira compat√≠vel com vers√µes anteriores (ou seja, usando atualiza√ß√µes de soft fork) para introduzir novos operandos, sintaxe ou sem√¢ntica de script. A capacidade de atualizar a linguagem de script de uma forma n√£o disruptiva aumentar√° bastante a velocidade de inova√ß√£o do bitcoin.</p>
</dd>
<dt class="hdlist1">Escalabilidade da Rede e do Armazenamento </dt>
<dd>
<p>Os dados de testemunha geralmente contribuem bastante para o tamanho total de uma transa√ß√£o. Scripts mais complexos, como aqueles usados para multiassinaturas ou canais de pagamento, s√£o muito grandes. Em alguns casos, esses scripts respondem pela maioria (mais de 75%) dos dados em uma transa√ß√£o. Ao mover os dados de testemunha para fora dos dados da transa√ß√£o, a Segregated Witness melhora a escalabilidade do bitcoin. Os n√≥s podem remover os dados de testemunha ap√≥s validar as assinaturas ou ignor√°-los completamente, caso eles fa√ßam a verifica√ß√£o de pagamento simplificada. Os dados de testemunha n√£o precisam ser transmitidos para todos os n√≥s e n√£o precisam ser armazenados no disco por todos os n√≥s.</p>
</dd>
<dt class="hdlist1">Otimiza√ß√£o da Verifica√ß√£o de Assinatura </dt>
<dd>
<p>A Segregated Witness atualiza as fun√ß√µes de assinatura (CHECKSIG, CHECKMULTISIG, etc.) para reduzir a complexidade computacional do algoritmo. Antes da segwit, o algoritmo usado para produzir uma assinatura exigia um n√∫mero de opera√ß√µes de hash que era proporcional ao tamanho da transa√ß√£o. Os c√°lculos de <em>hashing</em> dos dados aumentavam em O(n<sup>2</sup>) em rela√ß√£o ao n√∫mero de opera√ß√µes de assinatura, introduzindo uma carga computacional substancial em todos os n√≥s que verificam a assinatura. Com a segwit, o algoritmo foi alterado para reduzir a complexidade para O(n).</p>
</dd>
<dt class="hdlist1">Melhoria na Assinatura Offline </dt>
<dd>
<p>As assinaturas da Segregated Witness incorporam o valor (quantia) referenciado por cada entrada no hash que √© assinado. Antes disso, um dispositivo de assinatura offline, como uma carteira de hardware, tinha que verificar a quantia de cada entrada antes de assinar uma transa√ß√£o. Isso geralmente era feito atrav√©s de um streaming de uma grande quantidade de dados contendo informa√ß√µes sobre as transa√ß√µes pr√©vias referenciadas como entradas. Como a quantia agora faz parte do hash de compromisso que √© assinado, um dispositivo offline n√£o precisa mais das transa√ß√µes pr√©vias. Se as quantias n√£o corresponderem (se elas forem adulteradas por um sistema online comprometido), a assinatura ser√° inv√°lida.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-1442">
<p>==== Como Funciona a Segregated Witness</p>
</div>
<div class="paragraph data-line-1444">
<p>√Ä primeira vista, a Segregated Witness parece ser uma mudan√ßa na forma como as transa√ß√µes s√£o constru√≠das e, portanto, um recurso a n√≠vel de transa√ß√£o, mas ela n√£o √©. Em vez disso, a  Segregated Witness √© uma mudan√ßa na forma como a UTXO individual √© gasta e, portanto, √© um recurso a n√≠vel de cada sa√≠da individual.</p>
</div>
<div class="paragraph data-line-1446">
<p>Uma transa√ß√£o pode gastar sa√≠das da Segregated Witness, sa√≠das tradicionais (testemunha em linha) ou ambas. Portanto, n√£o faz muito sentido se referir a uma transa√ß√£o como uma "transa√ß√£o de Segregated Witness". Em vez disso, devemos nos referir a sa√≠das de transa√ß√£o espec√≠ficas como "sa√≠das de Segregated Witness" ou "sa√≠das com testmunha segregada".</p>
</div>
<div class="paragraph data-line-1448">
<p>Quando uma transa√ß√£o gasta uma UTXO, ela deve fornecer uma testemunha. Em uma UTXO tradicional, o script de travamento requer que os dados de testemunha sejam fornecidos <em>em linha</em> na entrada da transa√ß√£o que gasta a UTXO. Uma UTXO de Segregated Witness, entretanto, especifica um script de travamento que pode ser satisfeito com dados de testemunha que estejam fora da entrada (que estejam segregados da entrada).</p>
</div>
<div class="paragraph data-line-1450">
<p>==== Soft Fork (Retrocompatibilidade)</p>
</div>
<div class="paragraph data-line-1452">
<p>Segregated Witness is a significant change to the way outputs and transactions are architected. Such a change would normally require a simultaneous change in every Bitcoin node and wallet to change the consensus rules&#x2014;what is known as a hard fork. Instead, segregated witness is introduced with a much less disruptive change, which is backward compatible, known as a soft fork. This type of upgrade allows non-upgraded software to ignore the changes and continue to operate without any disruption.</p>
</div>
<div class="paragraph data-line-1454">
<p>As sa√≠das de Segregated Witness s√£o constru√≠das de forma que elas ainda possam ser validadas por sistemas mais antigos que n√£o reconhecem a segwit. Para uma carteira ou n√≥ antigo, uma sa√≠da de Segregated Witness parece ser uma sa√≠da que <em>qualquer pessoa pode gastar</em>. Essas sa√≠das podem ser gastas com uma assinatura vazia, portanto, o fato de n√£o haver assinatura dentro da transa√ß√£o (a assinatura √© segregada) n√£o invalida a transa√ß√£o. Carteiras e n√≥s de minera√ß√£o mais novos, no entanto, veem a sa√≠da de Segregated Witness e esperam encontrar uma testemunha v√°lida para ela nos dados de testemunha da transa√ß√£o.</p>
</div>
<div class="paragraph data-line-1456">
<p>==== Exemplos de Sa√≠da e de Transa√ß√£o com Segregated Witness</p>
</div>
<div class="paragraph data-line-1458">
<p>Vamos dar uma olhada em algumas de nossas transa√ß√µes de exemplo para ver como elas mudariam com a Segregated Witness. Veremos primeiro como um pagamento Pay-to-Public-Key-Hash (P2PKH) √© transformado com o programa da Segregated Witness. Em seguida, veremos o equivalente da Segregated Witness para os scripts Pay-to-Script-Hash (P2SH). Finalmente, veremos como ambos os programas de Segregated Witness descritos acima podem ser incorporados a um script P2SH.</p>
</div>
<div id="p2wpkh" class="paragraph data-line-1461">
<p>===== Pay-to-Witness-Public-Key-Hash (P2WPKH)</p>
</div>
<div class="paragraph data-line-1463">
<p>Em <a href="#cup_of_coffee">[cup_of_coffee]</a>, a Alice criou uma transa√ß√£o para pagar ao Bob por uma x√≠cara de caf√©. Essa transa√ß√£o criou uma sa√≠da P2PKH com um valor de 0,015 BTC que poderia ser gasto pelo Bob. O script da sa√≠da √© semelhante a este:</p>
</div>
<div class="listingblock data-line-1466">
<div class="title">Exemplo de script de sa√≠da P2PKH</div>
<div class="content">
<pre>DUP HASH160 ab68025513c3dbd2f7b92a94e0581f5d50f654e7 EQUALVERIFY CHECKSIG</pre>
</div>
</div>
<div class="paragraph data-line-1470">
<p>Com a Segregated Witness, a Alice criaria um script Pay-to-Witness-Public-Key-Hash (P2WPKH) (em portugu√™s, Paga-para-Testemunha-de-Hash-de-Chave-P√∫blica), que ficaria assim:</p>
</div>
<div class="listingblock data-line-1473">
<div class="title">Exemplo de script de sa√≠da P2WPKH</div>
<div class="content">
<pre>0 ab68025513c3dbd2f7b92a94e0581f5d50f654e7</pre>
</div>
</div>
<div class="paragraph data-line-1477">
<p>As you can see, a Segregated Witness output‚Äôs locking script is much simpler than a traditional output. It consists of two values that are pushed on to the script evaluation stack. To an old (nonsegwit-aware) Bitcoin client, the two pushes would look like an output that anyone can spend and does not require a signature (or rather, can be spent with an empty signature). To a newer, segwit-aware client, the first number (0) is interpreted as a version number (the <em>witness version</em>) and the second part (20 bytes) is the equivalent of a locking script known as a <em>witness program</em>. The 20-byte witness program is simply the hash of the public key, as in a P2PKH script.</p>
</div>
<div class="paragraph data-line-1479">
<p>Agora, vamos examinar a transa√ß√£o correspondente que o Bob usa para gastar essa sa√≠da. Para o script original (n√£o segwit), a transa√ß√£o do Bob teria que incluir uma assinatura na entrada de transa√ß√£o:</p>
</div>
<div class="listingblock data-line-1482">
<div class="title">Transa√ß√£o decodificada mostrando uma sa√≠da P2PKH sendo gasta com uma assinatura</div>
<div class="content">
<pre>[...]
‚ÄúVin‚Äù : [
"txid": "0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2",
"vout": 0,
     	 "scriptSig": ‚Äú&lt;scriptSig do Bob&gt;‚Äù,
]
[...]</pre>
</div>
</div>
<div class="paragraph data-line-1492">
<p>No entanto, para gastar a sa√≠da de Segregated Witness, a transa√ß√£o n√£o tem uma assinatura na parte da entrada. Em vez disso, a transa√ß√£o do Bob tem um scriptSig vazio nos dados da transa√ß√£o (a primeira parte de uma transa√ß√£o, que inclui a parte da entrada) e inclui sua assinatura nos dados de testemunha (a segunda parte de uma transa√ß√£o, que √© separada dos dados da transa√ß√£o):</p>
</div>
<div class="listingblock data-line-1495">
<div class="title">Transa√ß√£o decodificada mostrando uma sa√≠da P2WPKH sendo gasta com dados de testemunha separados</div>
<div class="content">
<pre>[...]
‚ÄúVin‚Äù : [
"txid": "0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2",
"vout": 0,
     	 "scriptSig": ‚Äú‚Äù,
]
[...]
‚Äúwitness‚Äù: ‚Äú&lt;dados de testemunha do Bob&gt;‚Äù
[...]</pre>
</div>
</div>
<div class="paragraph data-line-1507">
<p>===== Constru√ß√£o do P2WPKH pela carteira</p>
</div>
<div class="paragraph data-line-1509">
<p>√â extremamente importante observar que o P2WPKH s√≥ deve ser criado pelo benefici√°rio (destinat√°rio) e que ele n√£o deve ser convertido pelo remetente a partir de uma chave p√∫blica, um script P2PKH ou um endere√ßo conhecido. O destinat√°rio n√£o tem como saber se a carteira do remetente tem a capacidade de construir transa√ß√µes segwit e de gastar sa√≠das P2WPKH.</p>
</div>
<div class="paragraph data-line-1511">
<p>Al√©m disso, as sa√≠das P2WPKH devem ser constru√≠das a partir do hash de uma chave p√∫blica <em>comprimida</em>. As chaves p√∫blicas n√£o comprimidas n√£o fazem parte do padr√£o segwit e podem ser explicitamente desabilitadas por um soft fork no futuro. Se o hash usado no P2WPKH vier de uma chave p√∫blica n√£o comprimida, ele pode n√£o ser gast√°vel e voc√™ pode acabar perdendo os seus fundos. As sa√≠das P2WPKH devem ser criadas pela carteira do benefici√°rio ao se derivar uma chave p√∫blica comprimida a partir de sua chave privada.</p>
</div>
<div class="admonitionblock warning data-line-1514">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-1515">
<p>P2WPKH should be constructed by the payee (recipient) by converting a compressed public key to a P2WPKH hash. You should never transform a P2PKH script, Bitcoin address, or uncompressed public key to a P2WPKH witness script.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="p2wsh" class="paragraph data-line-1519">
<p>===== Pay-to-Witness-Script-Hash (P2WSH)</p>
</div>
<div class="paragraph data-line-1521">
<p>O segundo tipo de programa de testemunha corresponde a um script Pay-to-Script-Hash (P2SH). N√≥s vimos esse tipo de script em <a href="#p2sh">[p2sh]</a>. Naquele exemplo, o P2SH foi usado pela empresa do Mohammed para expressar um script multiassinatura. Os pagamentos para a empresa do Mohammed foram codificados com um script de travamento como este:</p>
</div>
<div class="listingblock data-line-1524">
<div class="title">Exemplo de script de sa√≠da P2SH</div>
<div class="content">
<pre>HASH160 54c557e07dde5bb6cb791c7a540e0a4796f5e97e EQUAL</pre>
</div>
</div>
<div class="paragraph data-line-1528">
<p>Este script P2SH faz refer√™ncia ao hash de um <em>script de resgate</em> que define uma exig√™ncia de uma multiassinatura 2-de-5 para se gastar os fundos. Para gastar essa sa√≠da, a empresa do Mohammed apresentaria o script de resgate (cujo hash corresponde ao hash de script contido na sa√≠da P2SH) e as assinaturas necess√°rias para satisfazer esse script de resgate, tudo dentro da entrada da transa√ß√£o:</p>
</div>
<div class="listingblock data-line-1531">
<div class="title">Transa√ß√£o decodificada mostrando uma sa√≠da P2SH sendo gasta</div>
<div class="content">
<pre>[...]
‚ÄúVin‚Äù : [
"txid": "abcdef12345...",
"vout": 0,
     	 "scriptSig": ‚Äú&lt;AssA&gt; &lt;AssB&gt; &lt;2 CPubA CPubB CPubC CPubD CPubE 5 CHECKMULTISIG&gt;‚Äù,
]</pre>
</div>
</div>
<div class="paragraph data-line-1540">
<p>Agora, vamos ver como esse exemplo ficaria caso ele fosse atualizado para a segwit. Se os clientes do Mohammed estivessem usando uma carteira compat√≠vel com segwit, eles fariam um pagamento criando uma sa√≠da Pay-to-Witness-Script-Hash (P2WSH) (em portugu√™s, Paga-para-Testemunha-de-Hash-de-Script) semelhante a esta:</p>
</div>
<div class="listingblock data-line-1543">
<div class="title">Exemplo de script de sa√≠da P2WSH</div>
<div class="content">
<pre>0 a9b7b38d972cabc7961dbfbcb841ad4508d133c47ba87457b4a0e8aae86dbb89</pre>
</div>
</div>
<div class="paragraph data-line-1547">
<p>Novamente, assim como no exemplo do P2WPKH, voc√™ pode ver que o script equivalente da Segregated Witness √© muito mais simples e omite os v√°rios operandos de script que s√£o vistos nos scripts P2SH. Em vez disso, o programa de Segregated Witness consiste em dois valores que s√£o adicionados na pilha: a vers√£o da testemunha (0) e o hash SHA256 de 32 bytes do script de resgate.</p>
</div>
<div class="paragraph data-line-1549">
<p>A empresa do Mohammed pode gastar a sa√≠da P2WSH apresentando o script de resgate correto e um n√∫mero suficiente de assinaturas para satisfaz√™-lo. Tanto o script de resgate quanto as assinaturas seriam segregados <em>fora</em> dos dados da transa√ß√£o de gasto como parte dos dados de testemunha. Na entrada da transa√ß√£o, a carteira do Mohammed colocaria um scriptSig vazio:</p>
</div>
<div class="listingblock data-line-1552">
<div class="title">Transa√ß√£o decodificada mostrando uma sa√≠da P2WSH sendo gasta com dados de testemunha separados</div>
<div class="content">
<pre>[...]
‚ÄúVin‚Äù : [
"txid": "abcdef12345...",
"vout": 0,
     	 "scriptSig": ‚Äú‚Äù,
]
[...]
‚Äúwitness‚Äù: ‚Äú&lt;AssA&gt; &lt;AssB&gt; &lt;2 CPubA CPubB CPubC CPubD CPubE 5 CHECKMULTISIG&gt;‚Äù
[...]</pre>
</div>
</div>
<div class="admonitionblock tip data-line-1565">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1566">
<p>Enquanto o P2SH usa o hash de 20 bytes do RIPEMD160(SHA256(script)), o programa de testemunha P2WSH usa um hash de 32 bytes do SHA256(script). Esta diferen√ßa na escolha do algoritmo de hash √© deliberada e fornece maior seguran√ßa para o P2WSH (128 bits de seguran√ßa no P2WSH versus 80 bits de seguran√ßa no P2SH). Ela tamb√©m √© usada para diferenciar entre os dois tipos de programas de testemunha (P2WPKH e P2WSH) atrav√©s do comprimento do hash (ver abaixo).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1570">
<p>===== Diferenciando entre P2WPKH e P2WSH</p>
</div>
<div class="paragraph data-line-1572">
<p>Nas duas se√ß√µes anteriores, demonstramos dois tipos de programas de testemunha: <a href="#p2wpkh">[p2wpkh]</a> e <a href="#p2wsh">[p2wsh]</a>. Ambos os tipos de programas de testemunha consistem em um n√∫mero de vers√£o de apenas um byte seguido por um hash mais longo. Eles s√£o muito semelhantes, mas s√£o interpretados de maneiras muito diferentes: um √© interpretado como um hash de chave p√∫blica, que √© satisfeito por uma assinatura e o outro √© interpretado como um hash de script, que √© satisfeito por um script de resgate. A diferen√ßa crucial entre eles √© o comprimento do hash:</p>
</div>
<div class="ulist data-line-1574">
<ul>
<li class="data-line-1574">
<p>O hash de chave p√∫blica no P2WPKH tem 20 bytes</p>
</li>
<li class="data-line-1575">
<p>O hash de script no P2WSH tem 32 bytes</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1577">
<p>Essa diferen√ßa √© o que permite que uma carteira diferencie os dois tipos de programa de testemunha. Observando o comprimento do hash, uma carteira pode determinar qual √© o tipo do programa de testemunha, P2WPKH ou P2WSH.</p>
</div>
<div class="paragraph data-line-1579">
<p>==== Atualizando para a Segregated Witness</p>
</div>
<div class="paragraph data-line-1581">
<p>Como podemos ver nos exemplos anteriores, a atualiza√ß√£o para a Segregated Witness √© um processo de duas etapas. Primeiro, as carteiras devem criar sa√≠das especiais do tipo segwit. Ent√£o, essas sa√≠das podem ser gastas por carteiras que sabem como construir transa√ß√µes de Segregated Witness. Nos exemplos, a carteira da Alice era compat√≠vel com segwit e tinha a capacidade de criar sa√≠das especiais com scripts de Segregated Witness. A carteira do Bob tamb√©m √© compat√≠vel com a segwit e tem a capacidade de gastar essas sa√≠das. O que pode n√£o ser √≥bvio a partir do exemplo √© que, na pr√°tica, a carteira da Alice precisa <em>saber</em> que o Bob usa uma carteira que √© compat√≠vel com segwit e consegue gastar essas sa√≠das. Caso contr√°rio, se a carteira de Bob n√£o for atualizada e a Alice tentar fazer pagamentos de segwit para o Bob, a carteira do Bob n√£o ser√° capaz de detectar esses pagamentos.</p>
</div>
<div class="admonitionblock tip data-line-1584">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1585">
<p>Para os pagamentos dos tipos P2WPKH e P2WSH, ambas as carteiras (do remetente e do destinat√°rio) precisam ser atualizadas para que elas possam usar a segwit. Al√©m disso, a carteira do remetente precisa saber que a carteira do destinat√°rio √© compat√≠vel com a segwit.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1588">
<p>A Segregated Witness n√£o ser√° implementada simultaneamente em toda a rede. Em vez disso, a Segregated Witness √© implementada como uma atualiza√ß√£o compat√≠vel com vers√µes anteriores (retrocompat√≠vel), onde <em>clientes antigos e clientes novos podem coexistir</em>. Os desenvolvedores de carteira atualizar√£o os seus aplicativos de carteira de forma independente para adicionar os recursos da segwit. Os pagamentos dos tipos P2WPKH e P2WSH ser√£o usados quando tanto o remetente quanto o destinat√°rio forem compat√≠veis com a segwit. Os pagamentos tradicionais, dos tipos P2PKH e o P2SH, continuar√£o a funcionar nas carteiras n√£o atualizadas. Isso nos deixa com dois cen√°rios importantes, que ser√£o abordados na pr√≥xima se√ß√£o:</p>
</div>
<div class="ulist data-line-1590">
<ul>
<li class="data-line-1590">
<p>Capacidade de uma carteira de remetente incompat√≠vel em fazer um pagamento para uma carteira de destinat√°rio compat√≠vel com segwit.</p>
</li>
<li class="data-line-1592">
<p>Capacidade de uma carteira de remetente compat√≠vel em reconhecer e distinguir entre os destinat√°rios que s√£o compat√≠veis dos que s√£o incompat√≠veis com segwit, por meio de seus <em>endere√ßos</em>.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1594">
<p>===== Embutindo a Segregated Witness dentro do P2SH</p>
</div>
<div class="paragraph data-line-1596">
<p>Vamos supor, por exemplo, que a carteira da Alice n√£o seja atualizada para a segwit, mas a carteira do Bob seja atualizada e consiga lidar com transa√ß√µes da segwit. A Alice e o Bob podem usar transa√ß√µes "antigas" n√£o segwit. Mas o Bob provavelmente gostaria de usar a segwit para reduzir as taxas de transa√ß√£o, aproveitando o desconto que ele teria ao deixar de incluir os dados de testemunha.</p>
</div>
<div class="paragraph data-line-1598">
<p>Nesse caso, a carteira do Bob pode construir um endere√ßo P2SH que cont√©m um script segwit dentro dele. A carteira da Alice v√™ esse endere√ßo como se fosse um endere√ßo P2SH "normal" e consegue fazer pagamentos para ele sem sequer saber que a segwit existe. A carteira do Bob pode ent√£o gastar esse pagamento com uma transa√ß√£o de segwit, aproveitando ao m√°ximo as vantagens da segwit e reduzindo as taxas de transa√ß√£o.</p>
</div>
<div class="paragraph data-line-1600">
<p>As duas formas de scripts de testemunha, o P2WPKH e o P2WSH, podem ser embutidas em um endere√ßo P2SH. A primeira forma embutida √© denominada P2SH(P2WPKH) e a segunda √© denominada P2SH(P2WSH).</p>
</div>
<div class="paragraph data-line-1602">
<p>===== Pay-to-Witness-Public-Key-Hash dentro de um Pay-to-Script-Hash</p>
</div>
<div class="paragraph data-line-1604">
<p>A primeira forma de script de testemunha que examinaremos √© a P2SH(P2WPKH). Ela √© um programa de testemunha Pay-to-Witness-Public-Key-Hash, embutido em um script Pay-to-Script-Hash, para que possa ser usado por uma carteira que n√£o tenha conhecimento da segwit.</p>
</div>
<div class="paragraph data-line-1606">
<p>Bob&#8217;s wallet constructs a P2WPKH witness program with Bob&#8217;s public key. This witness program is then hashed and the resulting hash is encoded as a P2SH script. The P2SH script is converted to a Bitcoin address, one that starts with a "3," as we saw in the <a href="#p2sh">[p2sh]</a> section.</p>
</div>
<div class="paragraph data-line-1608">
<p>A carteira do Bob come√ßa com o programa de testemunha P2WPKH que vimos anteriormente:</p>
</div>
<div class="listingblock data-line-1611">
<div class="title">Programa de testemunha P2WPKH do Bob</div>
<div class="content">
<pre>0 ab68025513c3dbd2f7b92a94e0581f5d50f654e7</pre>
</div>
</div>
<div class="paragraph data-line-1615">
<p>O programa de testemunha P2WPKH consiste na vers√£o da testemunha e no hash de chave p√∫blica de 20 bytes do Bob.</p>
</div>
<div class="paragraph data-line-1617">
<p>A carteira do Bob ent√£o faz o hash do programa de testemunha anterior, primeiro com o SHA256, depois com o RIPEMD160, produzindo outro hash de 20 bytes.</p>
</div>
<div class="paragraph data-line-1619">
<p>Vamos usar bx na linha de comando para replicar isso:</p>
</div>
<div class="listingblock data-line-1622">
<div class="title">HASH160 do programa de testemunha P2WPKH</div>
<div class="content">
<pre>echo \
'0 [ab68025513c3dbd2f7b92a94e0581f5d50f654e7]'\
 | bx script-encode | bx sha256 | bx ripemd160
3e0547268b3b19288b3adef9719ec8659f4b2b0b</pre>
</div>
</div>
<div class="paragraph data-line-1630">
<p>Next, the redeem script hash is converted to a Bitcoin address. Let&#8217;s use bx on the command-line again:</p>
</div>
<div class="listingblock data-line-1633">
<div class="title">Endere√ßo P2SH</div>
<div class="content">
<pre>echo \
'3e0547268b3b19288b3adef9719ec8659f4b2b0b' \
| bx address-encode -v 5
37Lx99uaGn5avKBxiW26HjedQE3LrDCZru</pre>
</div>
</div>
<div class="paragraph data-line-1640">
<p>Now, Bob can display this address for customers to pay for their coffee. Alice&#8217;s wallet can make a payment to 37Lx99uaGn5avKBxiW26HjedQE3LrDCZru, just as it would to any other Bitcoin address.</p>
</div>
<div class="paragraph data-line-1642">
<p>Para pagar para o Bob, a carteira da Alice travaria a sa√≠da com um script P2SH:</p>
</div>
<div class="listingblock data-line-1643">
<div class="content">
<pre>HASH160 3e0547268b3b19288b3adef9719ec8659f4b2b0b EQUAL</pre>
</div>
</div>
<div class="paragraph data-line-1647">
<p>Mesmo que a carteira da Alice n√£o tenha suporte para segwit, o pagamento que ela cria pode ser gasto pelo Bob atrav√©s de uma transa√ß√£o com segwit.</p>
</div>
<div class="paragraph data-line-1649">
<p>===== Pay-to-Witness-Script-Hash dentro de um Pay-to-Script-Hash</p>
</div>
<div class="paragraph data-line-1651">
<p>Da mesma forma, um programa de testemunha P2WSH para um script multiassinatura ou outro script complicado pode ser embutido dentro de um script e endere√ßo P2SH, permitindo que qualquer carteira fa√ßa pagamentos que s√£o compat√≠veis com a segwit.</p>
</div>
<div class="paragraph data-line-1653">
<p>Conforme vimos em <a href="#p2wsh">[p2wsh]</a>, a empresa do Mohammed est√° usando pagamentos de Segregated Witness com scripts multiassinatura. Para possibilitar que qualquer cliente pague para sua empresa, independente se suas carteiras foram ou n√£o atualizadas para a segwit, a carteira do Mohammed pode embutir o programa de testemunha P2WSH dentro de um script P2SH.</p>
</div>
<div class="paragraph data-line-1655">
<p>Primeiro, a carteira do Mohammed faz o hash do script de resgate com o SHA256 (apenas uma vez). Vamos usar bx na linha de comando para fazer isso :</p>
</div>
<div class="listingblock data-line-1658">
<div class="title">A carteira do Mohammed cria um programa de testemunha P2WSH</div>
<div class="content">
<pre>echo \
2 \ [04C16B8698A9ABF84250A7C3EA7EEDEF9897D1C8C6ADF47F06CF73370D74DCCA01CDCA79DCC5C395D7EEC6984D83F1F50C900A24DD47F569FD4193AF5DE762C587] \
[04A2192968D8655D6A935BEAF2CA23E3FB87A3495E7AF308EDF08DAC3C1FCBFC2C75B4B0F4D0B1B70CD2423657738C0C2B1D5CE65C97D78D0E34224858008E8B49] \
[047E63248B75DB7379BE9CDA8CE5751D16485F431E46117B9D0C1837C9D5737812F393DA7D4420D7E1A9162F0279CFC10F1E8E8F3020DECDBC3C0DD389D9977965] \
[0421D65CBD7149B255382ED7F78E946580657EE6FDA162A187543A9D85BAAA93A4AB3A8F044DADA618D087227440645ABE8A35DA8C5B73997AD343BE5C2AFD94A5] \
[043752580AFA1ECED3C68D446BCAB69AC0BA7DF50D56231BE0AABF1FDEEC78A6A45E394BA29A1EDF518C022DD618DA774D207D137AAB59E0B000EB7ED238F4D800] \
5 CHECKMULTISIG \
| bx script-encode | bx sha256
9592d601848d04b172905e0ddb0adde59f1590f1e553ffc81ddc4b0ed927dd73</pre>
</div>
</div>
<div class="paragraph data-line-1670">
<p>A seguir, o hash do script de resgate √© transformado em um programa de testemunha P2WSH:</p>
</div>
<div class="listingblock data-line-1672">
<div class="content">
<pre>0 9592d601848d04b172905e0ddb0adde59f1590f1e553ffc81ddc4b0ed927dd73</pre>
</div>
</div>
<div class="paragraph data-line-1676">
<p>Em seguida, o pr√≥prio programa de testemunha √© transformado em hash com o SHA256 e o RIPEMD160, produzindo um novo hash de 20 bytes, como usado no P2SH tradicional. Vamos usar bx na linha de comando para fazer isso:</p>
</div>
<div class="listingblock data-line-1679">
<div class="title">O HASH160 do programa de testemunha P2WSH</div>
<div class="content">
<pre> echo \
'0 [9592d601848d04b172905e0ddb0adde59f1590f1e553ffc81ddc4b0ed927dd73]'\
 | bx script-encode | bx sha256 | bx ripemd160
86762607e8fe87c0c37740cddee880988b9455b2</pre>
</div>
</div>
<div class="paragraph data-line-1686">
<p>Next, the wallet constructs a P2SH Bitcoin address from this hash. Again, we use bx to calculate on the command-line:</p>
</div>
<div class="listingblock data-line-1689">
<div class="title">P2SH Bitcoin address</div>
<div class="content">
<pre>echo \
'86762607e8fe87c0c37740cddee880988b9455b2'\
 | bx address-encode -v 5
3Dwz1MXhM6EfFoJChHCxh1jWHb8GQqRenG</pre>
</div>
</div>
<div class="paragraph data-line-1696">
<p>Agora, os clientes do Mohammed podem fazer pagamentos neste endere√ßo, sem precisarem ter suporte √† segwit. Para enviar um pagamento a Mohammed, uma carteira travaria a sa√≠da com o seguinte script P2SH:</p>
</div>
<div class="listingblock data-line-1699">
<div class="title">Script P2SH usado para travar os pagamentos para a multiassinatura do Mohammed</div>
<div class="content">
<pre>HASH160 86762607e8fe87c0c37740cddee880988b9455b2 EQUAL</pre>
</div>
</div>
<div class="paragraph data-line-1703">
<p>A empresa do Mohammed pode ent√£o construir transa√ß√µes com segwit para gastar esses pagamentos, aproveitando os recursos da segwit, incluindo taxas de transa√ß√£o mais baixas.</p>
</div>
<div class="paragraph data-line-1705">
<p>===== Endere√ßos de Segregated Witness</p>
</div>
<div class="paragraph data-line-1707">
<p>Mesmo ap√≥s a ativa√ß√£o da segwit, levar√° algum tempo at√© que a maioria das carteiras seja atualizada. Inicialmente, a segwit ser√° embutida no P2SH, conforme vimos na se√ß√£o anterior, para facilitar a compatibilidade entre as carteiras com suporte e as carteiras sem suporte √† segwit.</p>
</div>
<div class="paragraph data-line-1709">
<p>No entanto, assim que as carteiras suportarem amplamente a segwit, far√° sentido codificar os scripts de testemunha diretamente em um formato de endere√ßo nativo projetado para a segwit, em vez de embuti-los no P2SH.</p>
</div>
<div class="paragraph data-line-1711">
<p>O formato de endere√ßo segwit nativo √© definido na BIP-173:</p>
</div>
<div class="dlist data-line-1713">
<dl>
<dt class="hdlist1"><a href="https://github.com/bitcoin/bips/blob/master/bip-0173.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0173.mediawiki">BIP-173</a></dt>
<dd>
<p>Formato de endere√ßo Base32 para sa√≠das de testemunha v0-16 nativas</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-1715">
<p>BIP-173 only encodes witness (P2WPKH and P2WSH) scripts. It is not compatible with non-segwit P2PKH or P2SH scripts. BIP-173 is a checksummed Base32 encoding, as compared to the Base58 encoding of a "traditional" Bitcoin address. BIP-173 addresses are also called <em>bech32</em> addresses, pronounced "beh-ch thirty two", alluding to the use of a "BCH" error detection algorithm and 32-character encoding set.</p>
</div>
<div class="paragraph data-line-1717">
<p>Os endere√ßos da BIP-173 usam um conjunto de 32 caracteres alfanum√©ricos apenas em letras min√∫sculas, cuidadosamente selecionados para reduzir erros de leitura e de digita√ß√£o. Por escolher um conjunto de caracteres apenas em letras min√∫sculas, o bech32 √© mais f√°cil de ser lido e soletrado, al√©m de ser 45% mais eficiente de ser codificado em c√≥digos QR.</p>
</div>
<div class="paragraph data-line-1719">
<p>O algoritmo de detec√ß√£o de erros BCH √© uma grande melhoria em rela√ß√£o ao algoritmo de soma de verifica√ß√£o anterior (do Base58Check), permitindo n√£o s√≥ a detec√ß√£o, mas tamb√©m a <em>corre√ß√£o</em> de erros. Ao detectar um erro, as interfaces de entrada de endere√ßo (como campos de texto em formul√°rios) podem detectar e destacar qual caractere provavelmente foi digitado incorretamente.</p>
</div>
<div class="paragraph data-line-1721">
<p>A partir da especifica√ß√£o da BIP-173, aqui est√£o alguns exemplos de endere√ßos bech32:</p>
</div>
<div class="dlist data-line-1723">
<dl>
<dt class="hdlist1">Endere√ßo P2WPKH da Mainnet</dt>
<dd>
<p>bc1qw508d6qejxtdg4y5r3zarvary0c5xw7kv8f3t4</p>
</dd>
<dt class="hdlist1">Endere√ßo P2WPKH da Testnet</dt>
<dd>
<p>tb1qw508d6qejxtdg4y5r3zarvary0c5xw7kxpjzsx</p>
</dd>
<dt class="hdlist1">Endere√ßo P2WSH da Mainnet</dt>
<dd>
<p>bc1qrp33g0q5c5txsp9arysrx4k6zdkfs4nce4xj0gdcccefvpysxf3qccfmv3</p>
</dd>
<dt class="hdlist1">Endere√ßo P2WSH da Testnet</dt>
<dd>
<p>tb1qrp33g0q5c5txsp9arysrx4k6zdkfs4nce4xj0gdcccefvpysxf3q0sl5k7</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-1728">
<p>Como voc√™ pode ver nesses exemplos, uma <em>string</em> de um endere√ßo bech32 da segwit tem at√© 90 caracteres e consiste em tr√™s partes:</p>
</div>
<div class="dlist data-line-1730">
<dl>
<dt class="hdlist1">A parte leg√≠vel por humanos</dt>
<dd>
<p>O prefixo "bc" ou "tb", que identifica a mainnet ou a testnet</p>
</dd>
<dt class="hdlist1">O separador</dt>
<dd>
<p>O d√≠gito "1", que n√£o faz parte do conjunto de codifica√ß√£o de 32 caracteres e s√≥ pode aparecer nesta posi√ß√£o como um separador</p>
</dd>
<dt class="hdlist1">A parte de dados</dt>
<dd>
<p>Um m√≠nimo de 6 caracteres alfanum√©ricos, que correspondem ao script de testemunha codificado e com soma de verifica√ß√£o (<em>checksum</em>)</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-1736">
<p>Atualmente, apenas algumas carteiras aceitam ou produzem endere√ßos segwit bech32 nativos, mas √† medida que a ado√ß√£o da segwit aumenta, voc√™ os ver√° cada vez mais.</p>
</div>
<div class="paragraph data-line-1738">
<p>A <a href="#segwit_addresses">Endere√ßos de bitcoin n√£o segwit (legado) e endere√ßos segwit</a> mostra os endere√ßos de bitcoin n√£o segwit (legado ou <em>legacy</em>) e segwit.</p>
</div>
<table id="segwit_addresses" class="tableblock frame-all grid-all stretch data-line-1742">
<caption class="title">Table 23. Endere√ßos de bitcoin n√£o segwit (legado) e endere√ßos segwit</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tipo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Codifica√ß√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prefixo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endere√ßo Legado P2PKH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base58</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endere√ßo Legado P2PKH Testnet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base58</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">m ou n</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endere√ßo Legado P2SH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base58</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endere√ßo Legado P2SH Testnet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base58</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endere√ßo Segwit Aninhado/Embutido P2SH(P2WPKH)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base58</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endere√ßo Segwit Aninhado/Embutido P2SH(P2WSH)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base58</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endere√ßo Segwit Nativo P2WPKH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bech32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bc1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endere√ßo Segwit Nativo P2WPKH Testnet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bech32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tb1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endere√ßo Segwit Nativo P2WSH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bech32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bc1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endere√ßo Segwit Nativo P2WSH Testnet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bech32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tb1</p></td>
</tr>
</tbody>
</table>
<div id="segwit_txid" class="paragraph data-line-1757">
<p>===== Identificadores de transa√ß√£o</p>
</div>
<div class="paragraph data-line-1759">
<p>Um dos maiores benef√≠cios da Segregated Witness √© que ela elimina a maleabilidade de transa√ß√£o por terceiros.</p>
</div>
<div class="paragraph data-line-1761">
<p>Antes da segwit, as transa√ß√µes podiam ter suas assinaturas sutilmente modificadas por terceiros, alterando seu ID (hash) de transa√ß√£o sem alterar nenhuma das propriedades fundamentais (entradas, sa√≠das, quantias). Isso criou oportunidades para ataques de nega√ß√£o de servi√ßo, bem como ataques contra softwares de carteira mal escritos que presumiam que os hashes de transa√ß√µes n√£o confirmadas eram imut√°veis.</p>
</div>
<div class="paragraph data-line-1763">
<p>Com a introdu√ß√£o da Segregated Witness, as transa√ß√µes agora t√™m dois identificadores, txid e wtxid. O ID de transa√ß√£o tradicional txid √© o hash SHA256 duplo da transa√ß√£o serializada, sem os dados de testemunha. Um wtxid de transa√ß√£o √© o hash SHA256 duplo do novo formato de serializa√ß√£o da transa√ß√£o com dados de testemunha.</p>
</div>
<div class="paragraph data-line-1765">
<p>O txid tradicional √© calculado exatamente da mesma maneira que uma transa√ß√£o sem segwit. No entanto, como uma transa√ß√£o segwit pura (uma transa√ß√£o contendo apenas entradas com segwit) tem scriptSigs vazios em todas as entradas, nenhuma parte da transa√ß√£o pode ser modificada por terceiros. Portanto, em uma transa√ß√£o segwit pura, o txid √© imut√°vel por um terceiro, mesmo quando a transa√ß√£o ainda n√£o foi confirmada.</p>
</div>
<div class="paragraph data-line-1767">
<p>O wtxid √© como um ID "estendido", pois o hash tamb√©m incorpora os dados de testemunha. Se uma transa√ß√£o for transmitida sem dados de testemunha, o wtxid e o txid ser√£o id√™nticos. Observe que, uma vez que o wtxid inclui os dados de testemunha (as assinaturas) e como os dados de testemunha podem ser male√°veis, o wtxid deve ser considerado male√°vel at√© que a transa√ß√£o seja confirmada. Apenas o txid de uma transa√ß√£o segwit pura pode ser considerado imut√°vel por terceiros.</p>
</div>
<div class="admonitionblock tip data-line-1770">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1771">
<p>As transa√ß√µes com Segregated Witness t√™m dois IDs: o txid e o wtxid. O txid √© o hash da transa√ß√£o sem os dados de testemunha e o wtxid √© o hash que inclui os dados de testemunha. Somente as transa√ß√µes segwit puras (transa√ß√µes que cont√™m apenas entradas segwit) possuem um txid que n√£o √© suscet√≠vel √† maleabilidade de transa√ß√£o por terceiros.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1774">
<p>==== Novo Algoritmo de Assinatura da Segregated Witness</p>
</div>
<div class="paragraph data-line-1776">
<p>A Segregated Witness modifica a sem√¢ntica das quatro fun√ß√µes de verifica√ß√£o de assinatura (CHECKSIG, CHECKSIGVERIFY, CHECKMULTISIG e CHECKMULTISIGVERIFY), mudando a maneira como um hash de compromisso de transa√ß√£o √© calculado.</p>
</div>
<div class="paragraph data-line-1778">
<p>As assinaturas nas transa√ß√µes de bitcoin s√£o aplicadas em um <em>hash de compromisso</em>, que √© calculado a partir dos dados da transa√ß√£o, travando partes espec√≠ficas dos dados que indicam o compromisso do signat√°rio com esses valores. Por exemplo, em uma assinatura simples do tipo SIGHASH_ALL, o hash de compromisso inclui todas as entradas e sa√≠das.</p>
</div>
<div class="paragraph data-line-1780">
<p>Unfortunately, the way the commitment hash was calculated introduced the possibility that a node verifying the signature can be forced to perform a significant number of hash computations. Specifically, the hash operations increase in O(n<sup>2</sup>) with respect to the number of signature operations in the transaction. An attacker could therefore create a transaction with a very large number of signature operations, causing the entire Bitcoin network to have to perform hundreds or thousands of hash operations to verify the transaction.</p>
</div>
<div class="paragraph data-line-1782">
<p>A segwit representou uma oportunidade de resolver esse problema ao alterar a maneira como o hash de compromisso √© calculado. Para programas de testemunha da vers√£o 0 da segwit, a verifica√ß√£o de assinatura ocorre usando um algoritmo de hash de compromisso aprimorado, conforme especificado na BIP-143.</p>
</div>
<div class="paragraph data-line-1784">
<p>O novo algoritmo atinge dois objetivos importantes. Em primeiro lugar, o n√∫mero de opera√ß√µes de hash aumenta em uma propor√ß√£o muito mais gradual (O(n)) em rela√ß√£o ao n√∫mero de opera√ß√µes de assinatura, reduzindo a oportunidade de serem criados ataques de nega√ß√£o de servi√ßo com transa√ß√µes excessivamente complexas. Em segundo lugar, o hash de compromisso agora tamb√©m inclui os valores (as quantias) de cada entrada como parte do compromisso. Isso significa que um signat√°rio pode se comprometer com um valor de entrada espec√≠fico sem precisar "buscar" e verificar a transa√ß√£o anterior referenciada pela entrada. No caso de dispositivos off-line, como carteiras de hardware, isso simplifica muito a comunica√ß√£o entre o host (o computador/celular/tablet) e a carteira de hardware, eliminando a necessidade de se transmitir transa√ß√µes anteriores para valida√ß√£o. Uma carteira de hardware pode aceitar o valor da entrada "conforme declarado" por um host que n√£o seja de confian√ßa. Como a assinatura √© inv√°lida se o valor da entrada n√£o estiver correto, a carteira de hardware n√£o precisa validar o valor antes de assinar a entrada.</p>
</div>
<div class="paragraph data-line-1786">
<p>==== Incentivos Econ√¥micos para a Segregated Witness</p>
</div>
<div class="paragraph data-line-1788">
<p>Bitcoin mining nodes and full nodes incur costs for the resources used to support the Bitcoin network and the blockchain. As the volume of bitcoin transactions increases, so does the cost of resources (CPU, network bandwidth, disk space, memory). Miners are compensated for these costs through fees that are proportional to the size (in bytes) of each transaction. Nonmining full nodes are not compensated, so they incur these costs because they have a need to run an authoritative fully validating full-index node, perhaps because they use the node to operate a bitcoin business.</p>
</div>
<div class="paragraph data-line-1790">
<p>Sem as taxas de transa√ß√£o, o crescimento dos dados do bitcoin aumentaria dramaticamente. As taxas destinam-se a alinhar as necessidades dos usu√°rios do bitcoin com a carga que suas transa√ß√µes imp√µem √† rede, por meio de um mecanismo de descoberta de pre√ßo baseado no mercado.</p>
</div>
<div class="paragraph data-line-1792">
<p>The calculation of fees based on transaction size treats all the data in the transaction as equal in cost. But from the perspective of full nodes and miners, some parts of a transaction carry much higher costs. Every transaction added to the Bitcoin network affects the consumption of four resources on nodes:</p>
</div>
<div class="dlist data-line-1794">
<dl>
<dt class="hdlist1">Espa√ßo em disco </dt>
<dd>
<p>Todas as transa√ß√µes s√£o armazenadas na blockchain, o que acaba contribuindo para um aumento no tamanho total da blockchain. A blockchain √© armazenada em disco, mas o armazenamento pode ser otimizado atrav√©s da exclus√£o de transa√ß√µes mais antigas, tamb√©m conhecida pelo termo ‚Äúpodagem‚Äù (em ingl√™s, <em>pruning</em>).</p>
</dd>
<dt class="hdlist1">CPU</dt>
<dd>
<p>Cada transa√ß√£o deve ser validada, o que requer tempo de CPU.</p>
</dd>
<dt class="hdlist1">Largura de banda </dt>
<dd>
<p>Cada transa√ß√£o √© transmitida (atrav√©s da propaga√ß√£o de inunda√ß√£o) pela rede pelo menos uma vez. Sem qualquer otimiza√ß√£o no protocolo de propaga√ß√£o dos blocos, as transa√ß√µes s√£o transmitidas novamente como parte de um bloco, dobrando o impacto na capacidade da rede.</p>
</dd>
<dt class="hdlist1">Mem√≥ria </dt>
<dd>
<p>Os n√≥s que validam transa√ß√µes mant√™m o √≠ndice UTXO ou todo o conjunto UTXO na mem√≥ria para acelerar a valida√ß√£o. Como o armazenamento em mem√≥ria √© pelo menos uma ordem de magnitude mais caro do que o armazenamento em disco, o crescimento do conjunto UTXO contribui desproporcionalmente para o custo de execu√ß√£o de um n√≥.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-1802">
<p>Como voc√™ pode ver na lista, nem todas as partes de uma transa√ß√£o t√™m um impacto igual no custo de execu√ß√£o de um n√≥ ou na capacidade do bitcoin de escalar para suportar mais transa√ß√µes. A parte mais cara de uma transa√ß√£o s√£o as sa√≠das rec√©m-criadas, pois elas s√£o adicionadas ao conjunto UTXO na mem√≥ria. Em compara√ß√£o, as assinaturas (tamb√©m conhecidas como dados de testemunha) adicionam uma menor carga √† rede e ao custo de execu√ß√£o de um n√≥, pois os dados de testemunha s√£o validados apenas uma vez e depois nunca mais s√£o usados. Al√©m disso, imediatamente ap√≥s receber uma nova transa√ß√£o e validar os dados de testemunha, os n√≥s podem descartar esses dados de testemunha. Se as taxas forem calculadas com base no tamanho da transa√ß√£o, sem discriminar entre esses dois tipos de dados, os incentivos de mercado das taxas n√£o estar√£o alinhados com os custos reais impostos por uma transa√ß√£o. Na verdade, a estrutura de taxas atual incentiva o comportamento oposto, pois os dados de testemunha constituem a maior parte de uma transa√ß√£o.</p>
</div>
<div class="paragraph data-line-1804">
<p>Os incentivos criados pelas taxas s√£o importantes, pois eles afetam o comportamento das carteiras. Todas as carteiras devem implementar alguma estrat√©gia para montar transa√ß√µes que leve em considera√ß√£o uma s√©rie de fatores, como privacidade (reduzindo a reutiliza√ß√£o de endere√ßos), fragmenta√ß√£o (fazendo muitos trocos) e taxas. Se as taxas est√£o servindo como um forte incentivo para as carteiras usarem o m√≠nimo de entradas poss√≠vel nas transa√ß√µes, isso pode levar a estrat√©gias de sele√ß√£o de UTXO e de endere√ßo de troco que inadvertidamente incham o conjunto UTXO.</p>
</div>
<div class="paragraph data-line-1806">
<p>As transa√ß√µes consomem UTXOs em suas entradas e criam novas UTXOs com suas sa√≠das. Portanto, uma transa√ß√£o que tem mais entradas do que sa√≠das resultar√° em uma diminui√ß√£o no conjunto UTXO, enquanto uma transa√ß√£o que possui mais sa√≠das do que entradas resultar√° em um aumento no conjunto UTXO. Vamos considerar a <em>diferen√ßa</em> entre as entradas e as sa√≠das e cham√°-la de ‚ÄúNova-UTXO-l√≠quida‚Äù (em ingl√™s, <em>Net-new-UTXO</em>). Essa √© uma m√©trica importante, pois nos diz qual impacto uma transa√ß√£o ter√° no recurso mais caro de toda a rede, o conjunto UTXO em mem√≥ria. Uma transa√ß√£o com uma Nova-UTXO-l√≠quida positiva aumenta esse fardo. Uma transa√ß√£o com uma Nova-UTXO-l√≠quida negativa reduz o fardo. Portanto, o que queremos √© encorajar as transa√ß√µes que tenham uma Nova-UTXO-l√≠quida negativa ou as que sejam neutras e tenham uma Nova-UTXO-l√≠quida zero.</p>
</div>
<div class="paragraph data-line-1808">
<p>Let‚Äôs look at an example of what incentives are created by the transaction fee calculation, with and without Segregated Witness. We will look at two different transactions. Transaction A is a 3-input, 2-output transaction, which has a Net-new-UTXO metric of &#x2013;1, meaning it consumes one more UTXO than it creates, reducing the UTXO set by one. Transaction B is a 2-input, 3-output transaction, which has a Net-new-UTXO metric of 1, meaning it adds one UTXO to the UTXO set, imposing additional cost on the entire Bitcoin network. Both transactions use multisignature (2-of-3) scripts to demonstrate how complex scripts increase the impact of segregated witness on fees. Let‚Äôs assume a transaction feerate of 30 satoshi per byte and a 75% fee discount on witness data:</p>
</div>
<dl>
<dt>Sem Segregated Witness</dt>
<dd>
<p>Taxa da Transa√ß√£o A: 28.590 satoshis</p>
<p>Taxa da Transa√ß√£o B: 20.760 satoshis</p>
</dd>

<dt>Com Segregated Witness</dt>
<dd>
<p>Taxa da Transa√ß√£o A: 12.255 satoshis</p>
<p>Taxa da Transa√ß√£o B: 10.425 satoshis</p>
</dd>
</dl>
<div class="paragraph data-line-1827">
<p>Ambas as transa√ß√µes s√£o menos caras quando a Segregated Witness √© implementada. Comparando os custos entre as duas transa√ß√µes, vemos que antes da Segregated Witness, a transa√ß√£o com a Nova-UTXO-l√≠quida positiva tem economias de custo significativas. Com a Segregated Witness, a diferen√ßa de custo diminui significativamente em termos absolutos e relativos. Embora seria necess√°rio que as entradas se tornassem mais baratas do que as sa√≠daspara que a consolida√ß√£o do conjunto UTXO fosse incentivada, esse desconto reduz o incentivo para se criar novas UTXOs com o intuito de se evitar o uso de mais entradas.</p>
</div>
<div class="paragraph data-line-1829">
<p>Segregated Witness therefore has two main effects on the fees paid by bitcoin users. Firstly, segwit reduces the overall cost of transactions by discounting witness data and increasing the capacity of the Bitcoin blockchain. Secondly, segwit‚Äôs discount on witness data partially mitigates a misalignment of incentives that may have inadvertently created more bloat in the UTXO set.</p>
</div>
<div id="bitcoin_network_ch08" class="paragraph data-line-1832">
<p>== A Rede Bitcoin</p>
</div>
<div class="paragraph data-line-1834">
<p>=== Arquitetura de Rede Par-a-Par</p>
</div>
<div class="paragraph data-line-1836">
<p>Bitcoin is structured as a peer-to-peer network architecture on top of the internet. The term peer-to-peer, or P2P, means that the computers that participate in the network are peers to each other, that they are all equal, that there are no "special" nodes, and that all nodes share the burden of providing network services. The network nodes interconnect in a mesh network with a "flat" topology. There is no server, no centralized service, and no hierarchy within the network. Nodes in a P2P network both provide and consume services at the same time with reciprocity acting as the incentive for participation. P2P networks are inherently resilient, decentralized, and open. A preeminent example of a P2P network architecture was the early internet itself, where nodes on the IP network were equal. Today&#8217;s internet architecture is more hierarchical, but the Internet Protocol still retains its flat-topology essence. Beyond bitcoin, the largest and most successful application of P2P technologies is file sharing, with Napster as the pioneer and BitTorrent as the most recent evolution of the architecture.</p>
</div>
<div class="paragraph data-line-1838">
<p>A arquitetura da rede P2P do bitcoin √© muito mais do que uma escolha de topologia. O bitcoin √© projetado para ser um sistema de dinheiro em esp√©cie digital P2P, e a arquitetura da rede √© tanto um reflexo quanto uma base fundamental dessa caracter√≠stica-chave. A descentraliza√ß√£o do controle √© um princ√≠pio-chave do projeto, e ela s√≥ pode ser obtida e mantida atrav√©s de uma rede de consenso P2P descentralizada.</p>
</div>
<div class="paragraph data-line-1840">
<p>The term "Bitcoin network" refers to the collection of nodes running the bitcoin P2P protocol. In addition to the bitcoin P2P protocol, there are other protocols such as Stratum that are used for mining and lightweight or mobile wallets. These additional protocols are provided by gateway routing servers that access the Bitcoin network using the bitcoin P2P protocol and then extend that network to nodes running other protocols. For example, Stratum servers connect Stratum mining nodes via the Stratum protocol to the main Bitcoin network and bridge the Stratum protocol to the bitcoin P2P protocol. We use the term "extended Bitcoin network" to refer to the overall network that includes the bitcoin P2P protocol, pool-mining protocols, the Stratum protocol, and any other related protocols connecting the components of the Bitcoin system.</p>
</div>
<div class="paragraph data-line-1842">
<p>=== Tipos de N√≥ e suas Fun√ß√µes</p>
</div>
<div class="paragraph data-line-1844">
<p>Although nodes in the bitcoin P2P network are equal, they may take on different roles depending on the functionality they are supporting. A Bitcoin node is a collection of functions: routing, the blockchain database, mining, and wallet services. A full node with all four of these functions is shown in <a href="#full_node_reference">A Bitcoin network node with all four functions: wallet, miner, full blockchain database, and network routing</a>.</p>
</div>
<div id="full_node_reference" class="imageblock smallerfifty data-line-1849">
<div class="content">
<img src="images/mbc2_0801.png" alt="FullNodeReferenceClient_Small">
</div>
<div class="title">Figure 46. A Bitcoin network node with all four functions: wallet, miner, full blockchain database, and network routing</div>
</div>
<div class="paragraph data-line-1851">
<p>Todos os n√≥s incluem a fun√ß√£o de roteamento para participar na rede e podem incluir outras funcionalidades adicionais. Todos os n√≥s validam e propagam as transa√ß√µes e os blocos, e descobrem e mant√™m conex√µes com outros pares. No exemplo de n√≥ completo da <a href="#full_node_reference">A Bitcoin network node with all four functions: wallet, miner, full blockchain database, and network routing</a>, a fun√ß√£o de roteamento √© indicada por um c√≠rculo com a letra "N", indicando um "N√≥ Roteador da Rede".</p>
</div>
<div class="paragraph data-line-1853">
<p>Alguns n√≥s, chamados de n√≥s completos, tamb√©m mant√™m uma c√≥pia completa e atualizada da blockchain. Os n√≥s completos conseguem verificar de maneira aut√¥noma e confi√°vel qualquer transa√ß√£o, sem depender de uma refer√™ncia externa. Alguns n√≥s mant√™m somente uma parte da blockchain e verificam as transa√ß√µes utilizando um m√©todo conhecido como <em>verifica√ß√£o de pagamento simplificada</em> (em ingl√™s, <em>simplified payment verification</em> ou SPV). Estes n√≥s s√£o conhecidos como n√≥s de SPV ou n√≥s leves (em ingl√™s, <em>lightweight</em>). No exemplo de n√≥ completo da figura, a fun√ß√£o de banco de dados da blockchain de um n√≥ completo est√° indicada por um c√≠rculo contendo a letra "B", indicando uma "Blockchain Completa". Na <a href="#bitcoin_network">The extended Bitcoin network showing various node types, gateways, and protocols</a>, os n√≥s de SPV est√£o representados sem o c√≠rculo contendo a letra "B", indicando que eles n√£o t√™m uma c√≥pia completa da blockchain.</p>
</div>
<div class="paragraph data-line-1855">
<p>Mining nodes compete to create new blocks by running specialized hardware to solve the Proof-of-Work algorithm. Some mining nodes are also full nodes, maintaining a full copy of the blockchain, while others are lightweight nodes participating in pool mining and depending on a pool server to maintain a full node. The mining function is shown in the full node as a circle called "Miner" or the letter "M."</p>
</div>
<div class="paragraph data-line-1857">
<p>User wallets might be part of a full node, as is usually the case with desktop Bitcoin clients. Increasingly, many user wallets, especially those running on resource-constrained devices such as smartphones, are SPV nodes. The wallet function is shown in <a href="#full_node_reference">A Bitcoin network node with all four functions: wallet, miner, full blockchain database, and network routing</a> as a circle called "Wallet" or the letter "W."</p>
</div>
<div class="paragraph data-line-1859">
<p>Al√©m dos tipos de n√≥s principais no protocolo P2P do bitcoin, existem tamb√©m servidores e n√≥s executando outros protocolos, como protocolos especializados de minera√ß√£o em pool e protocolos de acesso de clientes leves.</p>
</div>
<div class="paragraph data-line-1861">
<p><a href="#node_type_ledgend">Different types of nodes on the extended Bitcoin network</a> shows the most common node types on the extended Bitcoin network.</p>
</div>
<div class="paragraph data-line-1863">
<p>=== A Rede Bitcoin Estendida</p>
</div>
<div class="paragraph data-line-1865">
<p>The main Bitcoin network, running the bitcoin P2P protocol, consists of between 5,000 and 8,000 listening nodes running various versions of the bitcoin reference client (Bitcoin Core) and a few hundred nodes running various other implementations of the bitcoin P2P protocol, such as Bitcoin Classic, Bitcoin Unlimited, BitcoinJ, Libbitcoin, btcd, and bcoin. A small percentage of the nodes on the bitcoin P2P network are also mining nodes, competing in the mining process, validating transactions, and creating new blocks. Various large companies interface with the Bitcoin network by running full-node clients based on the Bitcoin Core client, with full copies of the blockchain and a network node, but without mining or wallet functions. These nodes act as network edge routers, allowing various other services (exchanges, wallets, block explorers, merchant payment processing) to be built on top.</p>
</div>
<div class="paragraph data-line-1867">
<p>The extended Bitcoin network includes the network running the bitcoin P2P protocol, described earlier, as well as nodes running specialized protocols. Attached to the main bitcoin P2P network are a number of pool servers and protocol gateways that connect nodes running other protocols. These other protocol nodes are mostly pool mining nodes (see <a href="#mining">[mining]</a>) and lightweight wallet clients, which do not carry a full copy of the blockchain.</p>
</div>
<div class="paragraph data-line-1869">
<p><a href="#bitcoin_network">The extended Bitcoin network showing various node types, gateways, and protocols</a> shows the extended Bitcoin network with the various types of nodes, gateway servers, edge routers, and wallet clients and the various protocols they use to connect to each other.</p>
</div>
<div id="node_type_ledgend" class="imageblock data-line-1873">
<div class="content">
<img src="images/mbc2_0802.png" alt="BitcoinNodeTypes">
</div>
<div class="title">Figure 47. Different types of nodes on the extended Bitcoin network</div>
</div>
<div id="bitcoin_network" class="imageblock data-line-1877">
<div class="content">
<img src="images/mbc2_0803.png" alt="BitcoinNetwork">
</div>
<div class="title">Figure 48. The extended Bitcoin network showing various node types, gateways, and protocols</div>
</div>
<div class="paragraph data-line-1879">
<p>=== Redes de Retransmiss√£o do Bitcoin</p>
</div>
<div class="paragraph data-line-1881">
<p>While the bitcoin P2P network serves the general needs of a broad variety of node types, it exhibits too high network latency for the specialized needs of bitcoin mining nodes.</p>
</div>
<div class="paragraph data-line-1883">
<p>Os mineradores do bitcoin est√£o envolvidos em uma competi√ß√£o apertada no tempo para resolver o problema da Prova-de-Trabalho e estender a blockchain (ver o <a href="#mining">[mining]</a>). Ao participarem desta competi√ß√£o, os mineradores do bitcoin precisam minimizar o tempo entre a propaga√ß√£o de um bloco vencedor e o in√≠cio da pr√≥xima rodada da competi√ß√£o. Na minera√ß√£o, a lat√™ncia da rede est√° diretamente relacionada √†s margens de lucro.</p>
</div>
<div class="paragraph data-line-1885">
<p>Uma <em>Rede de Transmiss√£o de Bitcoin</em> (Bitcoin Relay Network) √© uma rede que tenta minimizar a lat√™ncia na transmiss√£o de blocos entre os mineradores. A <a href="https://www.bitcoinrelaynetwork.org" data-href="https://www.bitcoinrelaynetwork.org">Bitcoin Relay Network</a> original foi criada pelo desenvolvedor principal Matt Corallo em 2015 para permitir a sincroniza√ß√£o r√°pida dos blocos entre os mineradores com lat√™ncia muito baixa. A rede consistia em v√°rios nodes especializados hospedados na infraestrutura da Amazon Web Services em todo o mundo e servia para conectar a maioria dos mineradores e das pools de minera√ß√£o.</p>
</div>
<div class="paragraph data-line-1887">
<p>  A Bitcoin Relay Network original foi substitu√≠da em 2016 com a introdu√ß√£o do <em>Fast Internet Bitcoin Relay Engine</em> (Motor de Rede de Transmiss√£o R√°pida de Bitcoin) ou <a href="https://bitcoinfibre.org" data-href="https://bitcoinfibre.org"><em>FIBRE</em></a>, tamb√©m criado pelo desenvolvedor principal Matt Corallo. A FIBER √© uma rede de retransmiss√£o baseada em UDP que retransmite blocos dentro de uma rede de nodes. A FIBER implementa a otimiza√ß√£o do <em>bloco compacto</em> para reduzir ainda mais a quantidade de dados transmitidos e a lat√™ncia da rede.</p>
</div>
<div class="paragraph data-line-1889">
<p>As redes de retransmiss√£o n√£o s√£o substitutos para a rede P2P do bitcoin. Em vez disso, s√£o redes de sobreposi√ß√£o que fornecem conectividade adicional entre n√≥s que possuem necessidades especializadas. Assim como as rodovias n√£o substituem as estradas rurais, mas servem como atalhos entre dois pontos com tr√°fego intenso, voc√™ ainda precisar√° das estradas menores para poder chegar √†s rodovias.</p>
</div>
<div class="paragraph data-line-1891">
<p>=== Descoberta da Rede</p>
</div>
<div class="paragraph data-line-1893">
<p>When a new node boots up, it must discover other Bitcoin nodes on the network in order to participate. To start this process, a new node must discover at least one existing node on the network and connect to it. The geographic location of other nodes is irrelevant; the Bitcoin network topology is not geographically defined. Therefore, any existing Bitcoin nodes can be selected at random.</p>
</div>
<div class="paragraph data-line-1895">
<p>Para se conectar a um par conhecido, os n√≥s estabelecem uma conex√£o TCP, geralmente na porta 8333 (a porta que geralmente √© usada pelo bitcoin), ou a uma porta alternativa, caso tenha sido fornecida. Ao estabelecer uma conex√£o, o n√≥ iniciar√° um "aperto de m√£o" (ver a <a href="#network_handshake">O aperto de m√£os inicial entre os pares</a>) ao transmitir uma mensagem version, que cont√©m informa√ß√µes de identifica√ß√£o b√°sicas, descritas a seguir:</p>
</div>
<div class="dlist data-line-1897">
<dl>
<dt class="hdlist1">nVersion</dt>
<dd>
<p>A vers√£o do protocolo P2P do bitcoin que o cliente "fala" (por exemplo, 70002)</p>
</dd>
<dt class="hdlist1">nLocalServices</dt>
<dd>
<p>Uma lista dos servi√ßos locais suportados pelo n√≥, atualmente apenas NODE_NETWORK</p>
</dd>
<dt class="hdlist1">nTime</dt>
<dd>
<p>A hora atual</p>
</dd>
<dt class="hdlist1">addrYou</dt>
<dd>
<p>O endere√ßo IP do n√≥ remoto, da maneira que ele √© visto a partir desse n√≥</p>
</dd>
<dt class="hdlist1">addrMe</dt>
<dd>
<p>O endere√ßo IP do n√≥ local, da maneira que ele √© descoberto pelo n√≥ local</p>
</dd>
<dt class="hdlist1">subver</dt>
<dd>
<p>Uma sub-vers√£o mostrando o tipo de software sendo executado nesse n√≥ (ex: <span class="keep-together"><code>/Satoshi:0.9.2.1/</code></span>)</p>
</dd>
<dt class="hdlist1">BestHeight</dt>
<dd>
<p>A altura de bloco da blockchain deste n√≥</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-1905">
<p>(Veja <a href="https://bit.ly/1qlsC7w" data-href="https://bit.ly/1qlsC7w">GitHub</a> para um exemplo de uma vers√£o de mensagem da rede.)</p>
</div>
<div class="paragraph data-line-1907">
<p>A mensagem version √© sempre a primeira mensagem a ser enviada de qualquer par para outro par. O par local que recebe uma mensagem version examinar√° a nVersion relatada pelo par remoto e decidir√° se o par remoto √© compat√≠vel. Se o par remoto for compat√≠vel, o par local reconhecer√° a mensagem version e estabelecer√° uma conex√£o enviando uma mensagem verack.</p>
</div>
<div class="paragraph data-line-1909">
<p>How does a new node find peers? The first method is to query DNS using a number of "DNS seeds," which are DNS servers that provide a list of IP addresses of Bitcoin nodes. Some of those DNS seeds provide a static list of IP addresses of stable bitcoin listening nodes. Some of the DNS seeds are custom implementations of BIND (Berkeley Internet Name Daemon) that return a random subset from a list of Bitcoin node addresses collected by a crawler or a long-running Bitcoin node.  The Bitcoin Core client contains the names of nine different DNS seeds. The diversity of ownership and diversity of implementation of the different DNS seeds offers a high level of reliability for the initial bootstrapping process. In the Bitcoin Core client, the option to use the DNS seeds is controlled by the option switch -dnsseed (set to 1 by default, to use the DNS seed).</p>
</div>
<div class="paragraph data-line-1911">
<p>Alternatively, a bootstrapping node that knows nothing of the network must be given the IP address of at least one Bitcoin node, after which it can establish connections through further introductions. The command-line argument -seednode can be used to connect to one node just for introductions using it as a seed. After the initial seed node is used to form introductions, the client will disconnect from it and use the newly discovered peers.</p>
</div>
<div id="network_handshake" class="imageblock data-line-1915">
<div class="content">
<img src="images/mbc2_0804.png" alt="NetworkHandshake">
</div>
<div class="title">Figure 49. O aperto de m√£os inicial entre os pares</div>
</div>
<div class="paragraph data-line-1917">
<p>Assim que uma ou mais conex√µes s√£o estabelecidas, o novo n√≥ enviar√° uma mensagem addr contendo o seu pr√≥prio endere√ßo IP para seus vizinhos. Seus vizinhos, por suas vezes, retransmitir√£o a mensagem addr para os vizinhos deles, garantindo que o n√≥ rec√©m-conectado se torne bem conhecido e melhor conectado. Adicionalmente, o n√≥ rec√©m-conectado pode enviar getaddr para os vizinhos, solicitando-lhes que retornem uma lista de endere√ßos IP de outros pares. Dessa maneira, um n√≥ pode encontrar pares para conectar-se e divulgar sua exist√™ncia na rede para que outros n√≥s o encontrem. A <a href="#address_propagation">Propaga√ß√£o e descoberta de endere√ßo</a> demonstra o protocolo de descoberta de endere√ßo.</p>
</div>
<div id="address_propagation" class="imageblock data-line-1922">
<div class="content">
<img src="images/mbc2_0805.png" alt="AddressPropagation">
</div>
<div class="title">Figure 50. Propaga√ß√£o e descoberta de endere√ßo</div>
</div>
<div class="paragraph data-line-1924">
<p>A node must connect to a few different peers in order to establish diverse paths into the Bitcoin network. Paths are not persistent‚Äînodes come and go‚Äîand so the node must continue to discover new nodes as it loses old connections as well as assist other nodes when they bootstrap. Only one connection is needed to bootstrap, because the first node can offer introductions to its peer nodes and those peers can offer further introductions. It&#8217;s also unnecessary and wasteful of network resources to connect to more than a handful of nodes. After bootstrapping, a node will remember its most recent successful peer connections, so that if it is rebooted it can quickly reestablish connections with its former peer network. If none of the former peers respond to its connection request, the node can use the seed nodes to bootstrap again.</p>
</div>
<div class="paragraph data-line-1926">
<p>Em um n√≥ executando o cliente Bitcoin Core, voc√™ pode listar as conex√µes com os pares atrav√©s do comando getpeerinfo:</p>
</div>
<div class="listingblock data-line-1929">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ bitcoin-cli getpeerinfo</code></pre>
</div>
</div>
<div class="listingblock data-line-1933">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
    {
        "addr" : "85.213.199.39:8333",
        "services" : "00000001",
        "lastsend" : 1405634126,
        "lastrecv" : 1405634127,
        "bytessent" : 23487651,
        "bytesrecv" : 138679099,
        "conntime" : 1405021768,
        "pingtime" : 0.00000000,
        "version" : 70002,
        "subver" : "/Satoshi:0.9.2.1/",
        "inbound" : false,
        "startingheight" : 310131,
        "banscore" : 0,
        "syncnode" : true
    },
    {
        "addr" : "58.23.244.20:8333",
        "services" : "00000001",
        "lastsend" : 1405634127,
        "lastrecv" : 1405634124,
        "bytessent" : 4460918,
        "bytesrecv" : 8903575,
        "conntime" : 1405559628,
        "pingtime" : 0.00000000,
        "version" : 70001,
        "subver" : "/Satoshi:0.8.6/",
        "inbound" : false,
        "startingheight" : 311074,
        "banscore" : 0,
        "syncnode" : false
    }
]</code></pre>
</div>
</div>
<div class="paragraph data-line-1970">
<p>Para desativar o gerenciamento autom√°tico dos pares e especificar uma lista de endere√ßos IP, os usu√°rios podem usar a op√ß√£o -connect=&lt;Endere√ßoIP&gt; e especificar um ou mais endere√ßos IP. Se essa op√ß√£o for utilizada, o n√≥ ir√° conectar-se somente aos endere√ßos IP selecionados, ao inv√©s de automaticamente descobrir e manter conex√µes com os pares.</p>
</div>
<div class="paragraph data-line-1972">
<p>Se n√£o houver tr√°fego em uma conex√£o, os n√≥s periodicamente enviar√£o uma mensagem para manter a conex√£o ativa. Se um n√≥ n√£o se comunicar em uma conex√£o por mais de 90 minutos, assume-se que ele esteja desconectado e um novo par ser√° procurado. Logo, a rede ajusta-se dinamicamente aos n√≥s transit√≥rios e aos problemas da rede, e pode crescer e diminuir organicamente conforme a necessidade, sem precisar de um controle central.</p>
</div>
<div class="paragraph data-line-1974">
<p>=== N√≥s completos</p>
</div>
<div class="paragraph data-line-1976">
<p>Full nodes are nodes that maintain a full blockchain with all transactions. More accurately, they probably should be called "full blockchain nodes." In the early years of bitcoin, all nodes were full nodes and currently the Bitcoin Core client is a full blockchain node. In the past two years, however, new forms of Bitcoin clients have been introduced that do not maintain a full blockchain but run as lightweight clients. We&#8217;ll examine these in more detail in the next section.</p>
</div>
<div class="paragraph data-line-1978">
<p>Full blockchain nodes maintain a complete and up-to-date copy of the Bitcoin blockchain with all the transactions, which they independently build and verify, starting with the very first block (genesis block) and building up to the latest known block in the network. A full blockchain node can independently and authoritatively verify any transaction without recourse or reliance on any other node or source of information. The full blockchain node relies on the network to receive updates about new blocks of transactions, which it then verifies and incorporates into its local copy of the blockchain.</p>
</div>
<div class="paragraph data-line-1980">
<p>Running a full blockchain node gives you the pure bitcoin experience: independent verification of all transactions without the need to rely on, or trust, any other systems. It&#8217;s easy to tell if you&#8217;re running a full node because it requires more than one hundred gigabytes of persistent storage (disk space) to store the full blockchain. If you need a lot of disk and it takes two to three days to sync to the network, you are running a full node. That is the price of complete independence and freedom from central authority.</p>
</div>
<div class="paragraph data-line-1982">
<p>There are a few alternative implementations of full blockchain Bitcoin clients, built using different programming languages and software architectures. However, the most common implementation is the reference client Bitcoin Core, also known as the Satoshi client. More than 75% of the nodes on the Bitcoin network run various versions of Bitcoin Core. It is identified as "Satoshi" in the sub-version string sent in the version message and shown by the command getpeerinfo as we saw earlier; for example, /Satoshi:0.8.6/.</p>
</div>
<div class="paragraph data-line-1984">
<p>=== Trocando o "Invent√°rio"</p>
</div>
<div class="paragraph data-line-1986">
<p>The first thing a full node will do once it connects to peers is try to construct a complete blockchain. If it is a brand-new node and has no blockchain at all, it only knows one block, the genesis block, which is statically embedded in the client software. Starting with block #0 (the genesis block), the new node will have to download hundreds of thousands of blocks to synchronize with the network and reestablish the full blockchain.</p>
</div>
<div class="paragraph data-line-1988">
<p>O processo de sincroniza√ß√£o da blockchain √© iniciado a partir da mensagem version, pois ela cont√©m a BestHeight, que √© a altura atual (o n√∫mero de blocos) da blockchain de um n√≥. Ao ver a mensagem version de seus pares, um n√≥ saber√° quantos blocos cada um deles tem e ser√° capaz de comparar com o n√∫mero de blocos que existem em sua pr√≥pria blockchain. Os n√≥s pareados trocar√£o uma mensagem getblocks, a qual cont√©m o hash (a impress√£o digital) do bloco mais alto de suas blockchains locais. A seguir, um dos pares ser√° capaz de identificar que o hash recebido pertence a um bloco que n√£o est√° no topo, mas que pertence a um bloco antigo, logo deduzindo que sua blockchain local √© mais comprida do que a de seu par.</p>
</div>
<div class="paragraph data-line-1990">
<p>O par com a blockchain mais comprida possui mais blocos que o outro n√≥ e consegue identificar quais blocos o outro n√≥ precisa para ficar "em dia". Ele identificar√° os primeiros 500 blocos para serem compartilhados e transmitir√° seus hashes usando uma mensagem inv (<em>inventory</em>). O n√≥ que estiver com esses blocos em falta ir√° ent√£o receb√™-los, ao emitir uma s√©rie de mensagens getdata solicitando os dados completos dos blocos, identificando os blocos solicitados usando os hashes da mensagem inv.</p>
</div>
<div class="paragraph data-line-1992">
<p>Vamos assumir, por exemplo, que um n√≥ tenha apenas o bloco g√™nese. Ele ent√£o receber√° uma mensagem inv de seus pares contendo os hashes dos pr√≥ximos 500 blocos na cadeia. Ele come√ßar√° a solicitar blocos de todos os seus pares conectados, distribuindo o servi√ßo, de maneira que ele n√£o sobrecarregue nenhum de seus pares com requisi√ß√µes. O n√≥ mant√©m um registro de quantos blocos est√£o "em tr√¢nsito" por conex√£o com par, que s√£o os blocos que ele solicitou mas n√£o recebeu, certificando-se de que ele n√£o exceda um limite (MAX_BLOCKS_IN_TRANSIT_PER_PEER). Dessa maneira, se ele precisar de muitos blocos, ele s√≥ ir√° solicitar novos blocos quando as solicita√ß√µes pr√©vias forem completadas, permitindo que os pares controlem o ritmo de updates e n√£o sobrecarregando a rede. √Ä medida que cada bloco √© recebido, ele √© adicionado √† blockchain, conforme veremos no <a href="#blockchain">[blockchain]</a>. √Ä medida que a blockchain local √© gradualmente constru√≠da, mais blocos s√£o solicitados e recebidos, e o processo continua at√© que o n√≥ alcance o resto da rede.</p>
</div>
<div class="paragraph data-line-1994">
<p>Esse processo‚Äîde comparar a blockchain local com as blockchains dos pares e de adquirir os blocos que est√£o em falta‚Äîacontece sempre que um n√≥ fica offline por algum per√≠odo de tempo. Seja porque um n√≥ ficou apenas alguns minutos offline e est√° com apenas alguns blocos em falta, seja porque ficou um m√™s inteiro offline e est√° com milhares de blocos em falta, o n√≥ sempre enviar√° inicialmente uma mensagem getblocks, receber√° uma resposta inv e, em seguida, come√ßar√° a baixar os blocos que faltam. A <a href="#inventory_synchronization">N√≥ sincronizando a blockchain ao adquirir blocos de um par</a> demonstra o invent√°rio e o protocolo de propaga√ß√£o dos blocos.</p>
</div>
<div id="inventory_synchronization" class="imageblock smallerfifty data-line-1999">
<div class="content">
<img src="images/mbc2_0806.png" alt="InventorySynchronization">
</div>
<div class="title">Figure 51. N√≥ sincronizando a blockchain ao adquirir blocos de um par</div>
</div>
<div id="spv_nodes" class="paragraph data-line-2002">
<p>=== N√≥s de Verifica√ß√£o de Pagamento Simplificada (SPV)</p>
</div>
<div class="paragraph data-line-2004">
<p>Not all nodes have the ability to store the full blockchain. Many Bitcoin clients are designed to run on space- and power-constrained devices, such as smartphones, tablets, or embedded systems. For such devices, a <em>simplified payment verification</em> (SPV) method is used to allow them to operate without storing the full blockchain. These types of clients are called SPV clients or lightweight clients. As bitcoin adoption surges, the SPV node is becoming the most common form of Bitcoin node, especially for bitcoin wallets.</p>
</div>
<div class="paragraph data-line-2006">
<p>Os n√≥s de SPV fazem o download apenas dos cabe√ßalhos dos blocos, eles n√£o baixam as transa√ß√µes inclu√≠das em cada bloco. A cadeia de blocos resultante, sem as transa√ß√µes, √© 1.000 vezes menor do que a blockchain completa. Os n√≥s de SPV n√£o s√£o capazes de construir uma imagem completa de todas as UTXOs que est√£o dispon√≠veis para serem gastas, visto que eles n√£o conhecem todas as transa√ß√µes da rede. Os n√≥s de SPV verificam as transa√ß√µes usando um m√©todo levemente diferente, que depende dos pares para fornecerem, sob demanda, visualiza√ß√µes parciais de partes relevantes da blockchain.</p>
</div>
<div class="paragraph data-line-2008">
<p>Como uma analogia, um n√≥ completo √© como se fosse um turista em uma cidade estranha, equipado com um mapa detalhado incluindo todas as ruas e todos os endere√ßos da cidade. Em compara√ß√£o, um n√≥ de SPV √© como se fosse um turista em uma cidade estranha, pedindo a pessoas aleat√≥rias na rua orienta√ß√µes de como chegar a um lugar, enquanto ele sabe apenas o nome de uma avenida principal. Embora ambos os turistas possam verificar que uma rua existe ao visit√°-la, o turista sem o mapa n√£o sabe o que se passa em cada rua colateral e n√£o sabe quais outras ruas existem na cidade. Ao chegar na frente da Avenida da Igreja, n¬∫23, o turista sem o mapa n√£o tem como saber se existem outros endere√ßos "Avenida da Igreja, n¬∫23" na cidade ou se ele realmente est√° no endere√ßo correto. A melhor solu√ß√£o para o turista sem mapa √© pedir orienta√ß√µes para um n√∫mero suficiente de pessoas e torcer para que algumas delas n√£o estejam tentando lhe passar a perna.</p>
</div>
<div class="paragraph data-line-2010">
<p>A verifica√ß√£o de pagamento simplificada (SPV) verifica as transa√ß√µes atrav√©s de refer√™ncias √† <em>profundidade</em> delas na blockchain, em vez da <em>altura</em>. Enquanto um n√≥ com a blockchain completa construir√° uma cadeia totalmente verificada contendo milhares de blocos e transa√ß√µes que podem ser seguidas na blockchain (retrospectivamente no tempo) at√© o bloco g√™nese, um n√≥ de SPV verificar√° a cadeia de todos os blocos (mas n√£o todas as transa√ß√µes) e ligar√° essa cadeia √† transa√ß√£o de interesse.</p>
</div>
<div class="paragraph data-line-2012">
<p>Por exemplo, ao examinar uma transa√ß√£o no bloco 300.000, um n√≥ completo segue todos os 300.000 blocos at√© o bloco g√™nese e constr√≥i um banco de dados completo de UTXOs, estabelecendo a validade da transa√ß√£o ao confirmar que a UTXO ainda n√£o foi gasta. Um n√≥ de SPV n√£o consegue validar se a UTXO ainda n√£o foi gasta. Ao inv√©s disso, o n√≥ de SPV estabelecer√° uma liga√ß√£o entre a transa√ß√£o e o bloco que a cont√©m, usando um <em>caminho de merkle</em> (ver <a href="#merkle_trees">[merkle_trees]</a>). Ent√£o, o n√≥ de SPV aguarda at√© ver os seis blocos, do 300.001 at√© o 300.006, empilhados em cima do bloco contendo a transa√ß√£o e verifica-a ao estabelecer sua profundidade sob os blocos 300.006 a 300.001. O fato de que outros n√≥s na rede aceitaram o bloco 300.000 e ent√£o fizeram o trabalho necess√°rio para produzir mais seis blocos em cima dele √© a prova, ainda que indireta, de que a transa√ß√£o n√£o foi um gasto duplo.</p>
</div>
<div class="paragraph data-line-2014">
<p>An SPV node cannot be persuaded that a transaction exists in a block when the transaction does not in fact exist. The SPV node establishes the existence of a transaction in a block by requesting a merkle path proof and by validating the Proof-of-Work in the chain of blocks. However, a transaction&#8217;s existence can be "hidden" from an SPV node. An SPV node can definitely prove that a transaction exists but cannot verify that a transaction, such as a double-spend of the same UTXO, doesn&#8217;t exist because it doesn&#8217;t have a record of all transactions. This vulnerability can be used in a denial-of-service attack or for a double-spending attack against SPV nodes. To defend against this, an SPV node needs to connect randomly to several nodes, to increase the probability that it is in contact with at least one honest node. This need to randomly connect means that SPV nodes also are vulnerable to network partitioning attacks or Sybil attacks, where they are connected to fake nodes or fake networks and do not have access to honest nodes or the real Bitcoin network.</p>
</div>
<div class="paragraph data-line-2016">
<p>Para a maioria dos fins pr√°ticos, os n√≥s de SPV bem conectados s√£o seguros o suficiente, alcan√ßando um equil√≠brio entre necessidade de recursos, praticidade e seguran√ßa. Para uma seguran√ßa infal√≠vel, no entanto, nada √© melhor do que executar um n√≥ com a blockchain completa.</p>
</div>
<div class="admonitionblock tip data-line-2019">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-2020">
<p>Um n√≥ com a blockchain completa verifica uma transa√ß√£o ao checar toda a cadeia de milhares de blocos abaixo dela, para ter a certeza de que a UTXO j√° n√£o foi gasta anteriormente, enquanto um n√≥ de SPV verifica uma transa√ß√£o ao checar qu√£o profundo o bloco da transa√ß√£o est√° enterrado sob uma por√ß√£o de blocos acima dele.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-2023">
<p>Para receber os cabe√ßalhos dos blocos, os n√≥s de SPV usam uma mensagem getheaders, em vez da mensagem getblocks. O par que responder enviar√° at√© 2.000 cabe√ßalhos de blocos usando uma √∫nica mensagem headers. O processo √© o mesmo que um n√≥ completo utiliza para receber blocos completos. Os n√≥s de SPV tamb√©m definem um filtro na conex√£o com os pares, para filtrar a transmiss√£o de blocos futuros e transa√ß√µes enviadas pelos pares. Quaisquer transa√ß√µes de interesse s√£o recebidas usando uma requisi√ß√£o getdata. Em resposta, o par gera uma mensagem tx contendo as transa√ß√µes. A <a href="#spv_synchronization">N√≥ de SPV sincronizando os cabe√ßalhos dos blocos</a> mostra a sincroniza√ß√£o dos cabe√ßalhos dos blocos.</p>
</div>
<div class="paragraph data-line-2025">
<p>Because SPV nodes need to retrieve specific transactions in order to selectively verify them, they also create a privacy risk. Unlike full blockchain nodes, which collect all transactions within each block, the SPV node&#8217;s requests for specific data can inadvertently reveal the addresses in their wallet. For example, a third party monitoring a network could keep track of all the transactions requested by a wallet on an SPV node and use those to associate Bitcoin addresses with the user of that wallet, destroying the user&#8217;s privacy.</p>
</div>
<div id="spv_synchronization" class="imageblock data-line-2029">
<div class="content">
<img src="images/mbc2_0807.png" alt="SPVSynchronization">
</div>
<div class="title">Figure 52. N√≥ de SPV sincronizando os cabe√ßalhos dos blocos</div>
</div>
<div class="paragraph data-line-2031">
<p>Logo ap√≥s a introdu√ß√£o dos n√≥s de SPV e dos n√≥s leves, os desenvolvedores do bitcoin adicionaram uma funcionalidade conhecida como <em>filtros de bloom</em>, com o objetivo de resolver os problemas de privacidade dos n√≥s de SPV. Os filtros de bloom permitem que os n√≥s de SPV recebam um subconjunto de transa√ß√µes sem precisarem revelar em quais endere√ßos eles est√£o interessados, atrav√©s de um mecanismo de filtragem que utiliza probabilidades ao inv√©s de padr√µes fixos.</p>
</div>
<div id="bloom_filters" class="paragraph data-line-2034">
<p>=== Filtros de Bloom</p>
</div>
<div class="paragraph data-line-2036">
<p>A bloom filter is a probabilistic search filter that offers an efficient way to express a search pattern while protecting privacy. They are used by SPV nodes to ask their peers for transactions matching a specific pattern, without revealing exactly which addresses, keys, or transactions they are searching for.</p>
</div>
<div class="paragraph data-line-2038">
<p>Na nossa analogia anterior, uma turista sem um mapa est√° pedindo orienta√ß√µes para um endere√ßo espec√≠fico, "Rua da Igreja, 23". Se ela pedir orienta√ß√µes para estranhos nessa rua, ela inadvertidamente revelar√° seu destino. Um filtro de bloom seria como se ela perguntasse, "Existem ruas nessa vizinhan√ßa cujo nome termina em E-J-A?" Uma pergunta como essa revela um pouco menos sobre o destino desejado do que se ela perguntasse especificamente pela "Rua da Igreja, 23". Usando essa t√©cnica, a turista poderia especificar o endere√ßo desejado em mais detalhes, como "termina em R-E-J-A", ou em menos detalhes, como "termina em A". Ao variar a precis√£o de sua busca, a turista revela mais ou menos informa√ß√µes, √† custa de resultados mais ou menos espec√≠ficos. Se ela pedir orienta√ß√µes com um padr√£o de busca menos espec√≠fico, ela receber√° muito mais endere√ßos poss√≠veis e ter√° uma privacidade maior, mas muitos dos resultados ser√£o irrelevantes. Se ela pedir orienta√ß√µes com um padr√£o de busca muito espec√≠fico, ela receber√° poucos resultados, mas perder√° em privacidade.</p>
</div>
<div class="paragraph data-line-2040">
<p>Os filtros de bloom cumprem essa fun√ß√£o ao permitir que um n√≥ de SPV especifique um padr√£o de busca para transa√ß√µes que possa ser refinado de acordo com precis√£o ou privacidade. Um filtro de bloom mais espec√≠fico produzir√° resultados precisos, mas √† custa de revelar quais endere√ßos est√£o na carteira do usu√°rio. Um filtro de bloom menos espec√≠fico produzir√° mais dados sobre mais transa√ß√µes, muitas delas irrelevantes para o n√≥, mas permitir√° que o n√≥ mantenha uma melhor privacidade.</p>
</div>
<div class="paragraph data-line-2042">
<p>==== Como Funcionam os Filtros de Bloom</p>
</div>
<div class="paragraph data-line-2044">
<p>Os filtros de bloom s√£o implementados como um array (uma lista) de tamanho vari√°vel de N d√≠gitos bin√°rios (um campo de bits) e um n√∫mero vari√°vel de M fun√ß√µes de hash. As fun√ß√µes de hash s√£o projetadas para sempre produzir um output entre 1 e N, correspondendo ao array de d√≠gitos bin√°rios. As fun√ß√µes de hash s√£o geradas deterministicamente, de maneira que qualquer n√≥ implementando um filtro de bloom sempre usar√° as mesmas fun√ß√µes de hash e sempre receber√° os mesmos resultados para um input espec√≠fico. Ao escolher filtros de bloom de diferentes comprimentos (N) e um n√∫mero diferente (M) de fun√ß√µes de hash, o filtro de bloom pode ser melhorado, variando o n√≠vel de acur√°cia, e, portanto, de privacidade.</p>
</div>
<div class="paragraph data-line-2046">
<p>Na <a href="#bloom1">Um exemplo de um filtro de bloom simples, com um campo de 16 bits e tr√™s fun√ß√µes de hash</a>, usamos um array muito pequeno de 16 bits e um conjunto de tr√™s fun√ß√µes de hash para demonstrar como os filtros de bloom funcionam.</p>
</div>
<div id="bloom1" class="imageblock data-line-2050">
<div class="content">
<img src="images/mbc2_0808.png" alt="Bloom1">
</div>
<div class="title">Figure 53. Um exemplo de um filtro de bloom simples, com um campo de 16 bits e tr√™s fun√ß√µes de hash</div>
</div>
<div class="paragraph data-line-2052">
<p>O filtro de bloom √© inicializado de maneira que o array de bits seja todo de zeros. Para adicionar um padr√£o ao filtro de bloom, o padr√£o √© transformado em hash por cada fun√ß√£o de hash, uma depois da outra. A aplica√ß√£o da primeira fun√ß√£o de hash no input resulta em um n√∫mero entre 1 e N. O bit correspondente no array (indexada de 1 a N) √© encontrado e definido como 1, registrando o output da fun√ß√£o de hash. A seguir, a pr√≥xima fun√ß√£o de hash √© usada para definir outro bit, e assim por diante. Uma vez que todas as M fun√ß√µes de hash forem aplicadas, o padr√£o de busca ser√° "registrado" no filtro de bloom como M bits que mudaram de 0 para 1.</p>
</div>
<div class="paragraph data-line-2054">
<p>A <a href="#bloom2">Adicionando um padr√£o "A" para o nosso filtro de bloom simples</a> √© um exemplo da adi√ß√£o de um padr√£o "A" para o filtro de bloom simples mostrado na <a href="#bloom1">Um exemplo de um filtro de bloom simples, com um campo de 16 bits e tr√™s fun√ß√µes de hash</a>.</p>
</div>
<div class="paragraph data-line-2056">
<p>Adicionar um segundo padr√£o √© t√£o simples quanto repetir esse processo. O padr√£o √© transformado em hash por cada fun√ß√£o de hash de cada vez e o resultado √© registrado ao se definir os bits como 1. Observe que √† medida que o filtro de bloom √© preenchido com mais padr√µes, um resultado de fun√ß√£o de hash pode coincidir com um bit que j√° esteja definido como 1, neste caso o bit n√£o √© modificado. Em ess√™ncia, √† medida que mais padr√µes gravam em bits sobreponentes, o filtro de bloom come√ßa a se tornar saturado com mais bits definidos como 1 e a acur√°cia do filtro diminui. √â por isso que o filtro √© uma estrutura de dados probabil√≠stica‚Äîele se torna menos preciso √† medida que mais padr√µes s√£o adicionados. A acur√°cia depende do n√∫mero de padr√µes adicionados versus o tamanho do array de bits (N) e o n√∫mero de fun√ß√µes de hash (M). Um array de bits maior e mais fun√ß√µes de hash podem registrar mais padr√µes com maior acur√°cia. Um array de bits menor ou menos fun√ß√µes de hash registrar√£o menos padr√µes e ter√£o menor acur√°cia.</p>
</div>
<div id="bloom2" class="imageblock data-line-2060">
<div class="content">
<img src="images/mbc2_0809.png" alt="Bloom2">
</div>
<div class="title">Figure 54. Adicionando um padr√£o "A" para o nosso filtro de bloom simples</div>
</div>
<div class="paragraph data-line-2062">
<p>A <a href="#bloom3">Adicionando um segundo padr√£o "B" para o nosso filtro de bloom simples</a> √© um exemplo da adi√ß√£o de um segundo padr√£o "B" para o filtro de bloom simples.</p>
</div>
<div id="bloom3" class="imageblock smallereighty data-line-2067">
<div class="content">
<img src="images/mbc2_0810.png" alt="Bloom3">
</div>
<div class="title">Figure 55. Adicionando um segundo padr√£o "B" para o nosso filtro de bloom simples</div>
</div>
<div class="paragraph data-line-2069">
<p>Para testar se um padr√£o faz parte de um filtro de bloom, o padr√£o √© transformado em hash por cada fun√ß√£o de hash e o padr√£o de bits resultante √© testado contra o array de bits. Se todos os bits indexados pelas fun√ß√µes de hash forem definidos como 1, ent√£o o padr√£o √© <em>provavelmente</em> registrado no filtro de bloom. Como os bits podem ser definidos devido √† sobreposi√ß√£o de m√∫ltiplos padr√µes, a resposta n√£o √© uma certeza, ela √© probabil√≠stica. Em outras palavras, uma correspond√™ncia positiva no filtro de bloom √© um "Talvez, Sim".</p>
</div>
<div class="paragraph data-line-2071">
<p>A <a href="#bloom4">Testando a exist√™ncia de um padr√£o "X" no filtro de bloom. O resultado √© uma correspond√™ncia positiva probabil√≠stica, significando "Talvez".</a> √© um exemplo que testa a exist√™ncia do padr√£o "X" no filtro de bloom simples. Os bits correspondentes est√£o definidos como 1, ent√£o o padr√£o √© provavelmente uma correspond√™ncia.</p>
</div>
<div id="bloom4" class="imageblock smallereighty data-line-2076">
<div class="content">
<img src="images/mbc2_0811.png" alt="Bloom4">
</div>
<div class="title">Figure 56. Testando a exist√™ncia de um padr√£o "X" no filtro de bloom. O resultado √© uma correspond√™ncia positiva probabil√≠stica, significando "Talvez".</div>
</div>
<div class="paragraph data-line-2078">
<p>Por outro lado, se um padr√£o for testado contra um filtro de bloom e qualquer um dos bits estiver definido como 0, isso prova que o padr√£o n√£o foi registrado no filtro de bloom. O resultado negativo n√£o √© uma probabilidade, ele √© uma certeza. Em outras palavras, uma correspond√™ncia negativa no filtro de bloom √© um "Definitivamente N√£o!".</p>
</div>
<div class="paragraph data-line-2080">
<p>A <a href="#bloom5">Testando a exist√™ncia do padr√£o "Y" no filtro de bloom. O resultado √© uma correspond√™ncia negativa definitiva, significando "Definitivamente N√£o!"</a> √© um exemplo que testa a exist√™ncia do padr√£o "Y" no filtro de bloom simples. Um dos bits correspondentes est√° definido como 0, ent√£o o padr√£o definitivamente n√£o √© uma correspond√™ncia.</p>
</div>
<div id="bloom5" class="imageblock data-line-2084">
<div class="content">
<img src="images/mbc2_0812.png" alt="mbc2 0812">
</div>
<div class="title">Figure 57. Testando a exist√™ncia do padr√£o "Y" no filtro de bloom. O resultado √© uma correspond√™ncia negativa definitiva, significando "Definitivamente N√£o!"</div>
</div>
<div class="paragraph data-line-2086">
<p>=== Como os N√≥s de SPV usam os Filtros de Bloom</p>
</div>
<div class="paragraph data-line-2088">
<p>Os filtros de bloom s√£o usados para filtrar as transa√ß√µes (e os blocos que as cont√™m) que um n√≥ de SPV recebe de seus pares, selecionando apenas as transa√ß√µes de interesse para o n√≥ de SPV, sem revelar em quais endere√ßos ou chaves ele est√° interessado.</p>
</div>
<div class="paragraph data-line-2090">
<p>Um n√≥ de SPV inicializar√° um filtro de bloom como "vazio"; nesse estado, o filtro de bloom n√£o corresponder√° a nenhum padr√£o. A seguir, o n√≥ de SPV far√° uma lista de todos os endere√ßos, chaves e hashes nos quais ele est√° interessado. Ele far√° isso extraindo o hash da chave p√∫blica, o hash do script e os IDs de transa√ß√£o de qualquer UTXO controlada por sua carteira. O n√≥ de SPV ent√£o adiciona cada um deles ao filtro de bloom, de modo que o filtro de bloom ir√° "encontrar uma correspond√™ncia" caso esses padr√µes estiverem presentes em uma transa√ß√£o, sem revelar os padr√µes.</p>
</div>
<div class="paragraph data-line-2092">
<p>The SPV node will then send a filterload message to the peer, containing the bloom filter to use on the connection. On the peer, bloom filters are checked against each incoming transaction. The full node checks several parts of the transaction against the bloom filter, looking for a match including:</p>
</div>
<div class="ulist data-line-2094">
<ul>
<li class="data-line-2094">
<p>O ID da transa√ß√£o</p>
</li>
<li class="data-line-2095">
<p>Os componentes de dados dos scripts de travamento de cada uma das sa√≠das da transa√ß√£o (cada chave e cada hash no script)</p>
</li>
<li class="data-line-2096">
<p>Cada uma das entradas da transa√ß√£o</p>
</li>
<li class="data-line-2097">
<p>Cada um dos componentes de dados de assinatura de entrada (ou scripts de testemunha)</p>
</li>
</ul>
</div>
<div class="paragraph data-line-2099">
<p>Ao serem verificados contra todos esses componentes, os filtros de bloom podem ser usados para buscar correspond√™ncias de hashes de chave p√∫blica, scripts, valores de OP_RETURN, chaves p√∫blicas em assinaturas ou qualquer componente futuro de um contrato inteligente ou de um script complexo.</p>
</div>
<div class="paragraph data-line-2101">
<p>Depois que um filtro √© estabelecido, o par testar√° cada sa√≠da da transa√ß√£o com o filtro de bloom. Apenas as transa√ß√µes que correspondem ao filtro s√£o enviadas para o n√≥.</p>
</div>
<div class="paragraph data-line-2103">
<p>Em resposta a uma mensagem getdata vindo do n√≥, os pares enviar√£o uma mensagem merkleblock que cont√©m somente os cabe√ßalhos de bloco para os blocos correspondentes ao filtro e um caminho de merkle (ver <a href="#merkle_trees">[merkle_trees]</a>) para cada transa√ß√£o correspondente. O par tamb√©m enviar√° mensagens tx contendo as transa√ß√µes que correspondem ao filtro.</p>
</div>
<div class="paragraph data-line-2105">
<p>√Ä medida que o n√≥ completo envia transa√ß√µes para o n√≥ de SPV, o n√≥ de SPV descarta todos os falsos positivos e usa as transa√ß√µes correspondentes corretas para atualizar o seu conjunto UTXO e o saldo da carteira. Ao atualizar sua pr√≥pria vis√£o do conjunto UTXO, ele tamb√©m modifica o filtro de bloom para filtrar quaisquer transa√ß√µes futuras que fa√ßam refer√™ncia √† UTXO que ele acabou de encontrar. O n√≥ completo ent√£o usa o novo filtro de bloom para filtrar as novas transa√ß√µes e todo o processo se repete.</p>
</div>
<div class="paragraph data-line-2107">
<p>O n√≥ definindo o filtro de bloom pode adicionar padr√µes ao filtro de maneira interativa ao enviar uma mensagem filteradd. Para limpar o filtro de bloom, o n√≥ pode enviar uma mensagem filterclear. Como n√£o √© poss√≠vel remover um padr√£o de um filtro de bloom, caso um padr√£o n√£o seja mais desejado, um n√≥ dever√° limpar o filtro atual e reenviar um novo filtro de bloom.</p>
</div>
<div class="paragraph data-line-2109">
<p>O protocolo de rede e o mecanismo de filtro de bloom para nodes SPV s√£o definidos em <a href="https://bit.ly/1x6qCiO" data-href="https://bit.ly/1x6qCiO">BIP-37(Peer Services)</a>.</p>
</div>
<div class="paragraph data-line-2112">
<p>=== N√≥s de SPV e Privacidade</p>
</div>
<div class="paragraph data-line-2114">
<p>Os n√≥s que implementam a verifica√ß√£o de pagamento simplificada t√™m uma privacidade mais fraca do que um n√≥ completo. Um n√≥ completo recebe todas as transa√ß√µes e, portanto, n√£o revela se est√° usando algum endere√ßo de sua carteira. Por outro lado, um n√≥ de SPV recebe uma lista filtrada de transa√ß√µes relacionadas aos endere√ßos que est√£o em sua carteira. Como resultado, ele reduz a privacidade do propriet√°rio.</p>
</div>
<div class="paragraph data-line-2116">
<p>Os filtros de bloom s√£o uma maneira de reduzir a perda de privacidade. Sem eles, um n√≥ de SPV teria que listar explicitamente os endere√ßos nos quais ele estivesse interessado, criando uma grave viola√ß√£o de privacidade. No entanto, mesmo com os filtros de bloom, um advers√°rio pode coletar informa√ß√µes suficientes ao longo do tempo, descobrindo quais s√£o os endere√ßos que est√£o contidos na carteira do cliente de SPV. Para fazer isso, ele pode monitorar o tr√°fego de um cliente de SPV ou conectar-se diretamente a ele como um n√≥ na rede P2P.</p>
</div>
<div class="paragraph data-line-2118">
<p>=== Conex√µes Criptografadas e Autenticadas</p>
</div>
<div class="paragraph data-line-2120">
<p>Most new users of bitcoin assume that the network communications of a Bitcoin node are encrypted. In fact, the original implementation of bitcoin communicates entirely in the clear. While this is not a major privacy concern for full nodes, it is a big problem for SPV nodes.</p>
</div>
<div class="paragraph data-line-2122">
<p>Como forma de aumentar a privacidade e a seguran√ßa da rede P2P do bitcoin, existem duas solu√ß√µes que fornecem criptografia das comunica√ß√µes: <em>Transporte Tor</em> e <em>Autentica√ß√£o e Criptografia P2P</em> com a BIP-150 e a BIP-151.</p>
</div>
<div class="paragraph data-line-2124">
<p>==== Transporte Tor</p>
</div>
<div class="paragraph data-line-2126">
<p>O Tor, que significa <em>A Rede de Roteamento Cebola</em> (em ingl√™s, <em>The Onion Routing network</em>), √© um projeto de software e de rede que oferece criptografia e encapsulamento de dados por meio de caminhos de rede randomizados que oferecem anonimato, irrastreabilidade e privacidade.</p>
</div>
<div class="paragraph data-line-2128">
<p>Bitcoin Core offers several configuration options that allow you to run a Bitcoin node with its traffic transported over the Tor network. In addition, Bitcoin Core can also offer a Tor hidden service allowing other Tor nodes to connect to your node directly over Tor.</p>
</div>
<div class="paragraph data-line-2130">
<p>A partir da vers√£o 0.12 do Bitcoin Core, um n√≥ oferecer√° um servi√ßo oculto do Tor automaticamente se ele for capaz de se conectar a um servi√ßo Tor local. Se voc√™ tiver o Tor instalado e o processo do Bitcoin Core for executado como um usu√°rio com permiss√µes adequadas para acessar o cookie de autentica√ß√£o do Tor, ele deve funcionar automaticamente. Use a flag debug para ativar a depura√ß√£o do Bitcoin Core para o servi√ßo do Tor, dessa maneira:</p>
</div>
<div class="listingblock data-line-2132">
<div class="content">
<pre>$ bitcoind --daemon --debug=tor</pre>
</div>
</div>
<div class="paragraph data-line-2136">
<p>Voc√™ dever√° ver a mensagem "tor: ADD_ONION successful" nos logs, indicando que o Bitcoin Core adicionou um servi√ßo oculto √† rede Tor.</p>
</div>
<div class="paragraph data-line-2138">
<p>Voc√™ pode encontrar mais instru√ß√µes sobre como executar o Bitcoin Core como um servi√ßo oculto do Tor na documenta√ß√£o do Bitcoin Core (<em>docs / tor.md</em>) e em v√°rios tutoriais online.</p>
</div>
<div class="paragraph data-line-2140">
<p>==== Autentica√ß√£o e Criptografia Par-a-Par</p>
</div>
<div class="paragraph data-line-2142">
<p>Two Bitcoin Improvement Proposals, BIP-150 and BIP-151, add support for P2P authentication and encryption in the bitcoin P2P network. These two BIPs define optional services that may be offered by compatible Bitcoin nodes. BIP-151 enables negotiated encryption for all communications between two nodes that support BIP-151. BIP-150 offers optional peer authentication that allows nodes to authenticate each other&#8217;s identity using ECDSA and private keys. BIP-150 requires that prior to authentication the two nodes have established encrypted communications as per BIP-151.</p>
</div>
<div class="paragraph data-line-2144">
<p>As of February 2021, BIP-150 and BIP-151 are not implemented in Bitcoin Core. However, the two proposals have been implemented by at least one alternative Bitcoin client named bcoin.</p>
</div>
<div class="paragraph data-line-2146">
<p>A BIP-150 e a BIP-151 permitem que os usu√°rios executem clientes de SPV que se conectam a um n√≥ completo de confian√ßa, usando criptografia e autentica√ß√£o para proteger a privacidade do cliente de SPV.</p>
</div>
<div class="paragraph data-line-2148">
<p>Additionally, authentication can be used to create networks of trusted Bitcoin nodes and prevent Man-in-the-Middle attacks. Finally, P2P encryption, if deployed broadly, would strengthen the resistance of bitcoin to traffic analysis and privacy-eroding surveillance, especially in totalitarian countries where internet use is heavily controlled and monitored.</p>
</div>
<div class="paragraph data-line-2150">
<p>O padr√£o √© definido na <a href="https://github.com/bitcoin/bips/blob/master/bip-0150.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0150.mediawiki">BIP-150 (Autentica√ß√£o de Par)</a> e na <a href="https://github.com/bitcoin/bips/blob/master/bip-0151.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0151.mediawiki">BIP-151 (Criptografia de Comunica√ß√£o Par-a-Par)</a>.</p>
</div>
<div class="paragraph data-line-2152">
<p>=== Pools de Transa√ß√µes</p>
</div>
<div class="paragraph data-line-2154">
<p>Almost every node on the Bitcoin network maintains a temporary list of unconfirmed transactions called the <em>memory pool</em>, <em>mempool</em>, or <em>transaction pool</em>. Nodes use this pool to keep track of transactions that are known to the network but are not yet included in the blockchain. For example, a wallet node will use the transaction pool to track incoming payments to the user&#8217;s wallet that have been received on the network but are not yet confirmed.</p>
</div>
<div class="paragraph data-line-2156">
<p>√Ä medida que as transa√ß√µes s√£o recebidas e verificadas, elas v√£o sendo adicionadas ao pool de transa√ß√µes e retransmitidas aos n√≥s vizinhos para serem propagadas para a rede.</p>
</div>
<div class="paragraph data-line-2158">
<p>Algumas implementa√ß√µes de n√≥s tamb√©m mant√™m uma pool separada de transa√ß√µes √≥rf√£s. Caso uma entrada de transa√ß√£o referir-se a uma transa√ß√£o que ainda n√£o seja conhecida, como, por exemplo, uma transa√ß√£o pai desconhecida, a transa√ß√£o √≥rf√£ ser√° armazenada temporariamente na pool de transa√ß√µes √≥rf√£s at√© que a transa√ß√£o pai seja recebida.</p>
</div>
<div class="paragraph data-line-2160">
<p>Quando uma transa√ß√£o √© adicionada √† pool de transa√ß√µes, verifica-se na pool de transa√ß√µes √≥rf√£s se h√° quaisquer transa√ß√µes √≥rf√£s com refer√™ncias para as sa√≠das dessa transa√ß√£o rec√©m-adicionada, em outras palavras, verifica-se se h√° transa√ß√µes que sejam filhas dessa transa√ß√£o. Quaisquer transa√ß√µes √≥rf√£s correspondentes s√£o ent√£o validadas. Se elas forem v√°lidas, elas s√£o removidas da pool de transa√ß√µes √≥rf√£s e s√£o adicionadas √† pool de transa√ß√µes, completando a cadeia que iniciou com a transa√ß√£o pai. Na presen√ßa de uma transa√ß√£o rec√©m-adicionada, que n√£o √© mais uma transa√ß√£o √≥rf√£, o processo √© repetido recursivamente em busca de quaisquer outras transa√ß√µes descendentes, at√© que n√£o se encontre mais nenhuma descendente. Atrav√©s desse processo, a chegada de uma transa√ß√£o pai desencadeia uma reconstru√ß√£o em cascata de uma cadeia completa de transa√ß√µes interdependentes ao reunir as transa√ß√µes √≥rf√£s com suas transa√ß√µes pais ao longo de toda a cadeia.</p>
</div>
<div class="paragraph data-line-2162">
<p>Tanto a pool de transa√ß√µes quanto a pool de transa√ß√µes √≥rf√£s (quando implementada) s√£o armazenadas na mem√≥ria local e n√£o s√£o salvas em um armazenamento persistente; em vez disso, elas s√£o preenchidas dinamicamente a partir das mensagens recebidas da rede. Quando um n√≥ √© iniciado, ambas as pools est√£o vazias e passam a ser gradualmente preenchidas com as novas transa√ß√µes que s√£o recebidas da rede.</p>
</div>
<div class="paragraph data-line-2164">
<p>Some implementations of the Bitcoin client also maintain an UTXO database or pool, which is the set of all unspent outputs on the blockchain. Bitcoin Core users will find it in the chainstate/ folder of their client&#8217;s data directory. Although the name "UTXO pool" sounds similar to the transaction pool, it represents a different set of data. Unlike the transaction and orphan pools, the UTXO pool is not initialized empty but instead contains millions of entries of unspent transaction outputs, everything that is unspent from all the way back to the genesis block. The UTXO pool may be housed in local memory or as an indexed database table on persistent storage.</p>
</div>
<div class="paragraph data-line-2166">
<p>Enquanto a pool de transa√ß√µes e a pool de transa√ß√µes √≥rf√£s representam uma perspectiva local de um n√≥ isolado, e podem variar significativamente de n√≥ para n√≥ dependendo de quando o n√≥ foi iniciado ou reiniciado, a pool de UTXOs representa o consenso emergente da rede e, portanto, apresentar√° pouca varia√ß√£o entre os n√≥s. Al√©m disso, a pool de transa√ß√µes e a pool de transa√ß√µes √≥rf√£s cont√™m somente transa√ß√µes n√£o confirmadas, enquanto a pool de UTXOs cont√©m somente sa√≠das confirmadas.</p>
</div>
<div id="blockchain" class="paragraph data-line-2169">
<p>== A Blockchain</p>
</div>
<div class="paragraph data-line-2171">
<p>=== Introdu√ß√£o</p>
</div>
<div class="paragraph data-line-2173">
<p>A estrutura de dados da blockchain √© uma lista ordenada de blocos de transa√ß√µes, onde cada bloco est√° ligado ao bloco anterior. A blockchain pode ser armazenada como um arquivo simples ou em um banco de dados simples. O cliente Bitcoin Core armazena os metadados da blockchain usando o banco de dados LevelDB do Google. Os blocos s√£o interligados de tr√°s para frente, ou seja, cada bloco se refere ao bloco anterior na cadeia. A blockchain √© frequentemente visualizada como uma pilha vertical de blocos, com os blocos empilhados uns sobre os outros e com o primeiro bloco servindo como a funda√ß√£o (o alicerce) que suporta a pilha de blocos. A visualiza√ß√£o dos blocos empilhados uns sobre os outros resulta no uso de termos como "altura" para se referir √† dist√¢ncia em rela√ß√£o ao primeiro bloco, e "topo" ou "ponta" para se referir ao bloco que foi adicionado mais recentemente.</p>
</div>
<div class="paragraph data-line-2175">
<p>Cada bloco contido na blockchain √© identificado por um hash, que √© gerado utilizando-se o algoritmo de hash criptogr√°fico SHA256 no cabe√ßalho do bloco. Cada bloco tamb√©m cont√©m uma refer√™ncia ao bloco anterior, conhecido como bloco <em>pai</em>, atrav√©s do campo "hash do bloco anterior" que existe no cabe√ßalho do bloco. Em outras palavras, cada bloco cont√©m o hash de seu bloco pai dentro de seu pr√≥prio cabe√ßalho. A sequ√™ncia de hashes ligando cada bloco ao seu bloco pai cria uma cadeia que pode ser seguida retrogradamente at√© o primeiro bloco que j√° foi criado, que √© conhecido como o <em>bloco g√™nese</em>.</p>
</div>
<div class="paragraph data-line-2177">
<p>Embora um bloco tenha apenas um bloco pai, ele pode temporariamente ter m√∫ltiplos blocos filhos. Cada um dos blocos filhos refere-se ao mesmo bloco pai e cont√©m o mesmo hash (o hash do bloco pai) no campo "hash do bloco anterior". M√∫ltiplos blocos filhos surgem quando h√° uma "bifurca√ß√£o" da blockchain, uma situa√ß√£o tempor√°ria que ocorre quando diferentes blocos s√£o descobertos quase que simultaneamente por diferentes mineradores (ver <a href="#forks">[forks]</a>). No final, somente um bloco filho ser√° inclu√≠do na blockchain e a "bifurca√ß√£o" deixar√° de existir. Apesar de cada bloco poder ter mais do que um filho, cada bloco pode ter somente um pai. Isso ocorre porque um bloco possui apenas um √∫nico campo "hash do bloco anterior", que √© uma refer√™ncia ao seu bloco pai √∫nico.</p>
</div>
<div class="paragraph data-line-2179">
<p>O campo "hash do bloco anterior" est√° dentro do cabe√ßalho do bloco e, portanto, afeta o hash do bloco <em>atual</em>. Se a identidade de um pai muda, a identidade de um filho muda tamb√©m. Quando o bloco pai √© modificado de qualquer maneira, o hash do bloco pai muda. O hash modificado do bloco pai exige uma mudan√ßa no campo "hash do bloco anterior" do bloco filho. Isso, por sua vez, faz com que o hash do bloco filho mude, o que requer uma mudan√ßa no campo "hash do bloco anterior" do bloco neto, que, por sua vez, muda o hash do bloco neto, e assim por diante. Esse efeito domin√≥ garante que, assim que um bloco tiver muitas gera√ß√µes o sucedendo, ele n√£o possa ser modificado sem que a pessoa que modificou seja for√ßada a calcular novamente todos os blocos subsequentes. Como esse novo c√°lculo exigiria um enorme processamento computacional (e, portanto, um enorme consumo de energia), a exist√™ncia de uma longa cadeia de blocos faz com que a hist√≥ria profunda da blockchain seja imut√°vel, o que √© uma caracter√≠stica-chave para a seguran√ßa do bitcoin.</p>
</div>
<div class="paragraph data-line-2181">
<p>Uma maneira de imaginar a blockchain seria como um solo, onde os blocos seriam camadas de uma forma√ß√£o geol√≥gica, ou como uma amostra do n√∫cleo de uma geleira. As camadas da superf√≠cie podem mudar com as esta√ß√µes, ou mesmo serem destru√≠das antes de terem tempo para se assentarem. Mas quanto mais profundo escavarmos, veremos que maior ser√° a estabilidade das camadas geol√≥gicas. Quando voc√™ escavar algumas centenas de metros de profundidade, voc√™ estar√° olhando para uma fotografia do passado que permaneceu intocada por milh√µes de anos. Na blockchain, pode acontecer que os poucos blocos mais recentes tenham que ser revisados, caso haja um novo c√°lculo da cadeia devido a uma bifurca√ß√£o. Os seis blocos do topo s√£o como os cent√≠metros mais superficiais do solo. Mas quanto mais fundo voc√™ penetrar na blockchain, al√©m dos seis blocos, cada vez menor se torna a probabilidade desses blocos se modificarem. Ap√≥s 100 blocos de profundidade, h√° tanta estabilidade que uma transa√ß√£o coinbase‚Äîuma transa√ß√£o contendo bitcoins rec√©m-minerados‚Äîpode ser gasta. Ap√≥s alguns milhares de blocos de profundidade (cerca de um m√™s), a blockchain j√° √© considerada uma hist√≥ria estabelecida, para todos os fins pr√°ticos. Apesar de o protocolo sempre permitir que uma cadeia seja desfeita por uma cadeia mais longa, e apesar de sempre existir a possibilidade de qualquer bloco ser revertido, a probabilidade de ocorr√™ncia de um evento como esse diminui √† medida que o tempo passa, at√© que ela se torne √≠nfima.</p>
</div>
<div class="paragraph data-line-2183">
<p>=== Estrutura de um Bloco</p>
</div>
<div class="paragraph data-line-2185">
<p>Um bloco √© uma estrutura de dados <em>container</em> que agrega as transa√ß√µes para inclus√£o no livro-raz√£o p√∫blico, a blockchain. O bloco √© composto por um cabe√ßalho, contendo metadados, seguido por uma longa lista de transa√ß√µes que constituem a maior parte de seu tamanho. O cabe√ßalho do bloco tem 80 bytes, enquanto uma transa√ß√£o tem, em m√©dia, pelo menos 400 bytes e um bloco cont√©m, em m√©dia, mais de 1.900 transa√ß√µes. Um bloco completo, com todas as transa√ß√µes, √© portanto 10.000 vezes maior do que o cabe√ßalho do bloco. A <a href="#block_structure1">A estrutura de um bloco</a> descreve a estrutura de um bloco.</p>
</div>
<table id="block_structure1" class="tableblock frame-all grid-all stretch pagebreak-before data-line-2191">
<caption class="title">Table 24. A estrutura de um bloco</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tamanho</th>
<th class="tableblock halign-left valign-top">Campo</th>
<th class="tableblock halign-left valign-top">Descri√ß√£o</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tamanho do Bloco</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O tamanho do bloco, em bytes, ap√≥s esse campo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">80 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cabe√ßalho do Bloco</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">V√°rios campos formam o cabe√ßalho do bloco</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1&#x2013;9 bytes (VarInt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contador de Transa√ß√µes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N√∫mero de transa√ß√µes que o bloco cont√©m</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vari√°vel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transa√ß√µes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">As transa√ß√µes registradas nesse bloco</p></td>
</tr>
</tbody>
</table>
<div id="block_header" class="paragraph data-line-2200">
<p>=== Cabe√ßalho do Bloco</p>
</div>
<div class="paragraph data-line-2202">
<p>O cabe√ßalho do bloco consiste em tr√™s conjuntos de metadados de bloco. Primeiro, existe uma refer√™ncia ao hash do bloco anterior, que conecta esse bloco ao bloco anterior na blockchain. O segundo conjunto de metadados, a <em>dificuldade</em>, a <em>data e hora (timestamp)</em> e o <em>nonce</em>, est√° relacionado √† competi√ß√£o da minera√ß√£o, conforme detalhado no <a href="#mining">[mining]</a>. A terceira parte dos metadados √© a raiz da √°rvore de merkle, uma estrutura de dados usada para resumir de maneira eficiente todas as transa√ß√µes contidas no bloco. A <a href="#block_header_structure_ch09">A estrutura do cabe√ßalho do bloco</a> descreve a estrutura de um cabe√ßalho de bloco.</p>
</div>
<table id="block_header_structure_ch09" class="tableblock frame-all grid-all stretch data-line-2208">
<caption class="title">Table 25. A estrutura do cabe√ßalho do bloco</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tamanho</th>
<th class="tableblock halign-left valign-top">Campo</th>
<th class="tableblock halign-left valign-top">Descri√ß√£o</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vers√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Um n√∫mero de vers√£o para servir como refer√™ncia nas atualiza√ß√µes de software/protocolo.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hash do Bloco Anterior</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uma refer√™ncia ao hash do bloco anterior (bloco pai) na cadeia</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Raiz de Merkle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Um hash da raiz da √°rvore de merkle das transa√ß√µes desse bloco</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data e Hora (timestamp)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O momento aproximado em que este bloco foi criado (em segundos decorridos desde a √âpoca Unix)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alvo de Dificuldade</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O alvo de dificuldade do algoritmo de Prova-de-Trabalho para esse bloco</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nonce</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Um contador usado para o algoritmo de Prova-de-Trabalho</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-2218">
<p>O nonce, o alvo de dificuldade e a data e hora (<em>timestamp</em>) s√£o usados no processo de minera√ß√£o e ser√£o discutidos em maiores detalhes no <a href="#mining">[mining]</a>.</p>
</div>
<div id="block_hash" class="paragraph data-line-2221">
<p>=== Identificadores dos Blocos: Hash do Cabe√ßalho e Altura do Bloco</p>
</div>
<div class="paragraph data-line-2223">
<p>O identificador prim√°rio de um bloco √© o seu hash criptogr√°fico, uma impress√£o digital que √© criada ao se fazer um <em>hashing</em> duplo do cabe√ßalho do bloco usando o algoritmo SHA256. O hash resultante tem 32 bytes e √© chamado de <em>hash do bloco</em>, entretanto, seria mais preciso cham√°-lo de <em>hash do cabe√ßalho do bloco</em>, <span role="keep-together">pois apenas o cabe√ßalho do bloco √© usado para comput√°-lo. Por exemplo,</span> 000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f √© o hash do bloco do primeiro bloco criado na hist√≥ria do bitcoin. O hash do bloco identifica o bloco de maneira √∫nica e sem ambiguidades, e pode ser derivado de maneira independente por qualquer n√≥, basta fazer um <em>hashing</em> duplo do cabe√ßalho do bloco com o algoritmo SHA256.</p>
</div>
<div class="paragraph data-line-2225">
<p>Note que o hash do bloco n√£o est√° inclu√≠do no interior da estrutura de dados do bloco, nem quando o bloco √© transmitido na rede, nem quando ele √© armazenado como parte da blockchain no armazenamento persistente de um n√≥. Ao inv√©s disso, o hash do bloco √© processado por cada n√≥ assim que o bloco √© recebido da rede. O hash do bloco pode ser armazenado em uma tabela de banco de dados separada como parte dos metadados do bloco, para facilitar a indexa√ß√£o e uma aquisi√ß√£o mais r√°pida de blocos a partir do disco.</p>
</div>
<div class="paragraph data-line-2227">
<p>Uma segunda maneira de se identificar um bloco √© atrav√©s da sua posi√ß√£o na blockchain, que √© chamada de <span role="keep-together"><em>altura do bloco</em> (em ingl√™s, _block height_). O primeiro bloco criado no bitcoin est√° na altura de bloco 0 (zero) e √© o</span> <span role="keep-together">mesmo bloco que foi referenciado anteriomente com o seguinte hash de bloco:</span>  000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f. Logo, um bloco pode ser identificado de duas maneiras diferentes: atrav√©s da refer√™ncia ao hash do bloco ou atrav√©s da refer√™ncia √† altura do bloco. Cada bloco subsequente que √© adicionado "em cima" daquele bloco inicial est√° uma posi√ß√£o "mais alta" na blockchain, como se fossem caixas empilhadas umas sobre as outras.</p>
</div>
<div class="paragraph data-line-2229">
<p>Al√©m disso, o termo <em>altura de bloco atual</em> (em ingl√™s, <em>current block height</em>) indica o tamanho da blockchain em blocos em um dado momento. Por exemplo, a altura de bloco atual em 1¬∫ de mar√ßo de 2021 era de aproximadamente 672.722, o que significa que havia 672.722 blocos empilhados sobre o primeiro bloco que foi criado em janeiro de 2009.</p>
</div>
<div class="paragraph data-line-2231">
<p>Unlike the block hash, the block height is not a unique identifier. Although a single block will always have a specific and invariant block height, the reverse is not true‚Äîthe block height does not always identify a single block. Two or more blocks might have the same block height, competing for the same position in the blockchain. This scenario is discussed in detail in the section <a href="#forks">[forks]</a>. The block height is also not a part of the block&#8217;s data structure; it is not stored within the block. Each node dynamically identifies a block&#8217;s position (height) in the blockchain when it is received from the Bitcoin network. The block height might also be stored as metadata in an indexed database table for faster retrieval.</p>
</div>
<div class="admonitionblock tip data-line-2234">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-2235">
<p>O <em>hash do bloco</em> de um determinado bloco sempre identifica um √∫nico bloco individualmente. Um bloco tamb√©m sempre tem uma <em>altura de bloco</em> espec√≠fica. Entretanto, nem sempre uma altura de bloco espec√≠fica pode identificar um bloco √∫nico. Na verdade, dois ou mais blocos podem competir por uma mesma posi√ß√£o na blockchain.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-2238">
<p>=== O Bloco G√™nese</p>
</div>
<div class="paragraph data-line-2240">
<p>O primeiro bloco na blockchain √© chamado de bloco g√™nese e foi criado em 2009. Ele √© o ancestral comum de todos os blocos na blockchain, o que significa que se voc√™ escolher qualquer bloco e seguir a cadeia retrogradamente no tempo, voc√™ sempre acabar√° chegando no bloco g√™nese.</p>
</div>
<div class="paragraph data-line-2242">
<p>Every node always starts with a blockchain of at least one block because the genesis block is statically encoded within the Bitcoin client software, such that it cannot be altered. Every node always "knows" the genesis block&#8217;s hash and structure, the fixed time it was created, and even the single transaction within. Thus, every node has the starting point for the blockchain, a secure "root" from which to build a trusted blockchain.</p>
</div>
<div class="paragraph data-line-2244">
<p>Veja o bloco g√™nese codificado estaticamente dentro do cliente do Bitcoin Core, em <a href="https://bit.ly/1x6rcwP" data-href="https://bit.ly/1x6rcwP"><em>chainparams.cpp</em></a>.</p>
</div>
<div class="paragraph data-line-2246">
<p>O seguinte hash identificador pertence ao bloco g√™nese:</p>
</div>
<div class="listingblock data-line-2248">
<div class="content">
<pre>000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f</pre>
</div>
</div>
<div class="paragraph data-line-2252">
<p>Voc√™ pode pesquisar esse hash de bloco em qualquer site do explorador de bloco, como <em>Blockchain.com</em>, e encontrar√° uma p√°gina que descreve o conte√∫do desse bloco, com um URL contendo esse hash:</p>
</div>
<div class="paragraph data-line-2254">
<p><a href="https://www.blockchain.com/btc/block/000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f" class="undefined" data-href="https://www.blockchain.com/btc/block/000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f">https://www.blockchain.com/btc/block/000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f</a></p>
</div>
<div class="paragraph data-line-2256">
<p>Usando o cliente de refer√™ncia Bitcoin Core na linha de comando:</p>
</div>
<div class="listingblock data-line-2258">
<div class="content">
<pre>$ bitcoin-cli getblock 000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f</pre>
</div>
</div>
<div class="listingblock data-line-2262">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "hash" : "000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f",
    "confirmations" : 308321,
    "size" : 285,
    "height" : 0,
    "version" : 1,
    "merkleroot" : "4a5e1e4baab89f3a32518a88c31bc87f618f76673e2cc77ab2127b7afdeda33b",
    "tx" : [
        "4a5e1e4baab89f3a32518a88c31bc87f618f76673e2cc77ab2127b7afdeda33b"
    ],
    "time" : 1231006505,
    "nonce" : 2083236893,
    "bits" : "1d00ffff",
    "difficulty" : 1.00000000,
    "nextblockhash" : "00000000839a8e6886ab5951d76f411475428afc90947ee320161bbf18eb6048"
}</code></pre>
</div>
</div>
<div class="paragraph data-line-2281">
<p>O bloco g√™nese cont√©m uma mensagem escondida em seu interior. A entrada da transa√ß√£o coinbase cont√©m o texto "<em>The Times 03/Jan/2009 Chancellor on brink of second bailout for banks</em>" (em portugu√™s, "The Times 03/Jan/2009 Chanceler prestes a realizar um segundo resgate aos bancos"). Essa mensagem tinha como objetivo servir como prova da data mais precoce em que esse bloco foi criado, ao usar como refer√™ncia a manchete de um jornal brit√¢nico, o <em>The Times</em>. Ela tamb√©m serve como um lembrete da import√¢ncia de um sistema monet√°rio independente, com o lan√ßamento do bitcoin ocorrendo ao mesmo tempo em que ocorria uma crise monet√°ria internacional sem precedentes. A mensagem foi embutida no primeiro bloco por Satoshi Nakamoto, o criador do bitcoin.</p>
</div>
<div class="paragraph data-line-2283">
<p>=== Ligando os Blocos na Blockchain</p>
</div>
<div class="paragraph data-line-2285">
<p>Os n√≥s completos do bitcoin mant√™m uma c√≥pia local da blockchain, que inicia no bloco g√™nese. A c√≥pia local da blockchain √© constantemente atualizada √† medida que novos blocos s√£o encontrados e s√£o usados para estender a cadeia. Assim que um n√≥ recebe os blocos vindo da rede, ele validar√° esses blocos e depois ir√° lig√°-los √† blockchain existente. Para estabelecer essa liga√ß√£o, o n√≥ examinar√° o cabe√ßalho do bloco recebido da rede e procurar√° pelo "hash do bloco anterior".</p>
</div>
<div class="paragraph data-line-2287">
<p>Vamos supor, por exemplo, que um n√≥ tenha 277.314 blocos na c√≥pia local da blockchain. O √∫ltimo bloco que o n√≥ conhece √© o bloco 277.314, que tem o seguinte hash de cabe√ßalho de bloco:</p>
</div>
<div class="listingblock data-line-2289">
<div class="content">
<pre>00000000000000027e7ba6fe7bad39faf3b5a83daed765f05f7d1b71a1632249</pre>
</div>
</div>
<div class="paragraph data-line-2293">
<p>The Bitcoin node then receives a new block from the network, which it parses as follows:</p>
</div>
<div class="listingblock data-line-2296">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "size" : 43560,
    "version" : 2,
    "previousblockhash" :
        "00000000000000027e7ba6fe7bad39faf3b5a83daed765f05f7d1b71a1632249",
    "merkleroot" :
        "5e049f4030e0ab2debb92378f53c0a6e09548aea083f3ab25e1d94ea1155e29d",
    "time" : 1388185038,
    "difficulty" : 1180923195.25802612,
    "nonce" : 4215469401,
    "tx" : [
        "257e7497fb8bc68421eb2c7b699dbab234831600e7352f0d9e6522c7cf3f6c77",

 #[... muitas outras transa√ß√µes omitidas ...]

        "05cfd38f6ae6aa83674cc99e4d75a1458c165b7ab84725eda41d018a09176634"
    ]
}</code></pre>
</div>
</div>
<div class="paragraph data-line-2317">
<p>Olhando para esse novo bloco, o n√≥ encontra o campo previousblockhash (hash do bloco anterior), que cont√©m o hash do seu bloco pai. Ele √© um hash que o n√≥ j√° conhece, que corresponde ao hash do √∫ltimo bloco na cadeia, que est√° na altura 277.314. Logo, esse novo bloco √© um bloco filho do √∫ltimo bloco na cadeia e estende a blockchain existente. O n√≥ adiciona esse novo bloco ao fim da cadeia, aumentando o comprimento da blockchain, que agora tem uma nova altura de 277.315. A <a href="#chain_of_blocks">Blocos ligados em uma cadeia, atrav√©s da refer√™ncia ao hash do cabe√ßalho do bloco anterior</a> mostra a cadeia de tr√™s blocos, ligados atrav√©s das refer√™ncias contidas no campo previousblockhash (hash do bloco anterior).</p>
</div>
<div id="merkle_trees" class="paragraph data-line-2321">
<p>=== √Årvores de Merkle</p>
</div>
<div class="paragraph data-line-2323">
<p>Each block in the Bitcoin blockchain contains a summary of all the transactions in the block using a <em>merkle tree</em>.</p>
</div>
<div class="paragraph data-line-2325">
<p>Uma <em>√°rvore de merkle</em>, tamb√©m conhecida como <em>√°rvore de hash bin√°ria</em>, √© uma estrutura de dados usada para resumir e verificar a integridade de grandes conjuntos de dados de maneira eficiente. As √°rvores de merkle s√£o √°rvores bin√°rias que cont√™m hashes criptogr√°ficos. O termo "√°rvore" √© usado na ci√™ncia da computa√ß√£o para descrever uma estrutura de dados ramificada, mas essas √°rvores geralmente s√£o exibidas de cabe√ßa para baixo, com a "raiz" no topo e as "folhas" na por√ß√£o inferior de um diagrama, como voc√™ ver√° nos exemplos a seguir.</p>
</div>
<div id="chain_of_blocks" class="imageblock smallerfourtyfive data-line-2330">
<div class="content">
<img src="images/mbc2_0901.png" alt="mbc2 0901">
</div>
<div class="title">Figure 58. Blocos ligados em uma cadeia, atrav√©s da refer√™ncia ao hash do cabe√ßalho do bloco anterior</div>
</div>
<div class="paragraph data-line-2332">
<p>As √°rvores de merkle s√£o usadas no bitcoin para resumir todas as transa√ß√µes contidas em um bloco, produzindo uma impress√£o digital geral de todo o conjunto de transa√ß√µes, fornecendo um processo muito eficiente para verificar se uma transa√ß√£o foi inclu√≠da em um bloco. Uma √°rvore de merkle √© constru√≠da atrav√©s do <em>hashing</em> recursivo de pares de n√≥s at√© que s√≥ haja um √∫nico hash, que √© conhecido como a <em>raiz</em> ou <em>raiz de merkle</em>. O algoritmo de hash criptogr√°fico usado nas √°rvores de merkle do bitcoin √© o SHA256 aplicado duas vezes, tamb√©m conhecido como SHA256 duplo.</p>
</div>
<div class="paragraph data-line-2334">
<p>Quando N elementos de dados s√£o submetidos a <em>hashing</em> e s√£o resumidos em uma √°rvore de merkle, voc√™ precisa de no m√°ximo 2*log~2~(N) c√°lculos para verificar se um elemento foi inclu√≠do na √°rvore, o que demonstra que a √°rvore de merkle √© uma estrutura de dados muito eficiente.</p>
</div>
<div class="paragraph data-line-2336">
<p>A √°rvore de merkle √© constru√≠da de baixo para cima. No exemplo a seguir, iniciamos com quatro transa√ß√µes, A, B, C e D, que formam as <em>folhas</em> da √°rvore de merkle, como demonstrado na <a href="#simple_merkle">Calculando os n√≥s em uma √°rvore de merkle</a>. As transa√ß√µes n√£o s√£o armazenadas na √°rvore de merkle; em vez disso, seus dados s√£o transformados em hash, e o hash resultante √© armazenado em cada n√≥ folha como H<sub>A</sub>, H<sub>B</sub>, H<sub>C</sub> e H<sub>D</sub>:</p>
</div>
<pre data-type="codelisting">
H<sub>A</sub> = SHA256(SHA256(Transa√ß√£o A))
</pre>
<div class="paragraph data-line-2344">
<p>Os pares consecutivos de n√≥s folhas s√£o ent√£o resumidos em um n√≥ pai, ao se concatenar dois hashes e fazendo um <em>hashing</em> dos dois juntos. Por exemplo, para construir um n√≥ pai H<sub>AB</sub>, os dois hashes de 32 bytes dos filhos s√£o concatenados para criar uma <em>string</em> de 64 bytes. Essa <em>string</em> √© submetida ent√£o a um <em>hashing</em> duplo para produzir o hash do n√≥ pai:</p>
</div>
<pre data-type="codelisting">
H<sub>AB</sub> = SHA256(SHA256(H<sub>A</sub> + H<sub>B</sub>))
</pre>
<div class="paragraph data-line-2352">
<p>O processo continua at√© que haja apenas um √∫nico n√≥ no topo, o n√≥ que √© conhecido como a raiz de merkle. Esse hash de 32 bytes √© armazenado no cabe√ßalho do bloco e resume todos os dados contidos em todas as quatro transa√ß√µes. A <a href="#simple_merkle">Calculando os n√≥s em uma √°rvore de merkle</a> mostra como a raiz √© calculada atrav√©s de hashes dos n√≥s agrupados em pares.</p>
</div>
<div id="simple_merkle" class="imageblock data-line-2356">
<div class="content">
<img src="images/mbc2_0902.png" alt="merkle_tree">
</div>
<div class="title">Figure 59. Calculando os n√≥s em uma √°rvore de merkle</div>
</div>
<div class="paragraph data-line-2358">
<p>Como a √°rvore de merkle √© uma √°rvore bin√°ria, ela precisa de um n√∫mero par de n√≥s folha. Se houver um n√∫mero √≠mpar de transa√ß√µes para serem resumidas, o hash da √∫ltima transa√ß√£o ser√° duplicado para criar uma <em>√°rvore balanceada</em>, ou seja, uma √°rvore que cont√©m um n√∫mero par de n√≥s folhas. Isso √© demonstrado na <a href="#merkle_tree_odd">A duplica√ß√£o de um elemento de dados gera um n√∫mero par de elementos de dados</a>, onde a transa√ß√£o C √© duplicada.</p>
</div>
<div id="merkle_tree_odd" class="imageblock data-line-2362">
<div class="content">
<img src="images/mbc2_0903.png" alt="merkle_tree_odd">
</div>
<div class="title">Figure 60. A duplica√ß√£o de um elemento de dados gera um n√∫mero par de elementos de dados</div>
</div>
<div class="paragraph data-line-2364">
<p>O mesmo m√©todo que √© usado para construir uma √°rvore a partir de quatro transa√ß√µes pode ser generalizado para construir √°rvores de qualquer tamanho. No bitcoin √© comum existirem centenas a milhares de transa√ß√µes em um √∫nico bloco, que podem ser resumidas exatamente da mesma maneira, ao produzir uma √∫nica raiz de merkle com apenas 32 bytes de dados. Na <a href="#merkle_tree_large">Uma √°rvore de merkle resumindo muitos elementos de dados</a>, voc√™ ver√° uma √°rvore constru√≠da a partir de 16 transa√ß√µes. Note que embora a raiz aparente ser maior do que os n√≥s folhas no diagrama, ela tem exatamente o mesmo tamanho, apenas 32 bytes. N√£o importa se um bloco tem apenas uma ou centenas de milhares de transa√ß√µes, a raiz de merkle sempre as resumir√° em 32 bytes.</p>
</div>
<div class="paragraph data-line-2366">
<p>To prove that a specific transaction is included in a block, a node only needs to produce log~2~(N) 32-byte hashes, constituting an <em>authentication path</em> or <em>merkle path</em> connecting the specific transaction to the root of the tree. This is especially important as the number of transactions increases, because the base-2 logarithm of the number of transactions increases much more slowly. This allows Bitcoin nodes to efficiently produce paths of 10 or 12 hashes (320‚Äì384 bytes), which can provide proof of a single transaction out of more than a thousand transactions in a megabyte-sized block.</p>
</div>
<div id="merkle_tree_large" class="imageblock data-line-2370">
<div class="content">
<img src="images/mbc2_0904.png" alt="merkle_tree_large">
</div>
<div class="title">Figure 61. Uma √°rvore de merkle resumindo muitos elementos de dados</div>
</div>
<div class="paragraph data-line-2372">
<p>Na <a href="#merkle_tree_path">Um caminho de merkle sendo usado para provar a inclus√£o de um elemento de dados</a>, um n√≥ pode provar que uma transa√ß√£o K foi inclu√≠da no bloco ao produzir um caminho de merkle que tenha um comprimento de apenas quatro hashes de 32 bytes (128 bytes no total). O caminho consiste em quatro hashes (os ret√¢ngulos com fundo escurecido na <a href="#merkle_tree_path">Um caminho de merkle sendo usado para provar a inclus√£o de um elemento de dados</a>) H<sub>L</sub>, H<sub>IJ</sub>, H<sub>MNOP</sub> e H<sub>ABCDEFGH</sub>. Com esses quatro hashes fornecidos como um caminho de autentica√ß√£o, qualquer n√≥ consegue provar que o H<sub>K</sub> (o ret√¢ngulo com fundo preto na parte inferior do diagrama) est√° incluso na raiz de merkle ao computar quatro hashes pareados adicionais: H<sub>KL</sub>, H<sub>IJKL</sub>, H<sub>IJKLMNOP</sub> e a raiz da √°rvore de merkle (os quatro ret√¢ngulos com contorno tracejado no diagrama).</p>
</div>
<div id="merkle_tree_path" class="imageblock data-line-2376">
<div class="content">
<img src="images/mbc2_0905.png" alt="merkle_tree_path">
</div>
<div class="title">Figure 62. Um caminho de merkle sendo usado para provar a inclus√£o de um elemento de dados</div>
</div>
<div class="paragraph data-line-2379">
<p>O c√≥digo no <a href="#merkle_example">Construindo uma √°rvore de merkle</a> demonstra o processo de cria√ß√£o de uma √°rvore de merkle desde os hashes dos n√≥s folhas at√© a raiz, usando a biblioteca libbitcoin para algumas fun√ß√µes auxiliares.</p>
</div>
<div id="merkle_example" class="exampleblock pagebreak-before data-line-2384">
<div class="title">Example 20. Construindo uma √°rvore de merkle</div>
<div class="content">
<div class="listingblock data-line-2386">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">Unresolved directive in for_use_mastering-bitcoin_chapter-9_pt_BR.adoc - include::code/merkle.cpp[]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-2391">
<p>O <a href="#merkle_example_run">Compilando e executando o c√≥digo de exemplo merkle.cpp</a> mostra o resultado da compila√ß√£o e da execu√ß√£o do c√≥digo de merkle.</p>
</div>
<div id="merkle_example_run" class="exampleblock data-line-2395">
<div class="title">Example 21. Compilando e executando o c√≥digo de exemplo merkle.cpp</div>
<div class="content">
<div class="listingblock data-line-2397">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># Compilar o c√≥digo merkle.cpp
$ g++ -o merkle merkle.cpp $(pkg-config --cflags --libs libbitcoin)
# Rodar o execut√°vel merkle
$ ./merkle
Lista de hashes da merkle atual:
  32650049a0418e4380db0af81788635d8b65424d397170b8499cdc28c4d27006
  30861db96905c8dc8b99398ca1cd5bd5b84ac3264a4e1b3e65afa1bcee7540c4

Lista de hashes da merkle atual:
  d47780c084bad3830bcdaf6eace035e4c6cbf646d103795d22104fb105014ba3

Resultado: d47780c084bad3830bcdaf6eace035e4c6cbf646d103795d22104fb105014ba3</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-2414">
<p>A efici√™ncia da √°rvore de merkle torna-se √≥bvia √† medida que ela cresce em escala. A <a href="#block_structure2">Efici√™ncia da √°rvore de merkle</a> mostra a quantidade de dados que precisam ser trocados na forma de um caminho de merkle para se provar que uma transa√ß√£o faz parte de um bloco.</p>
</div>
<table id="block_structure2" class="tableblock frame-all grid-all stretch data-line-2419">
<caption class="title">Table 26. Efici√™ncia da √°rvore de merkle</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">N¬∫ de transa√ß√µes</th>
<th class="tableblock halign-left valign-top">Tamanho aprox. do bloco</th>
<th class="tableblock halign-left valign-top">Tamanho do caminho (em hashes)</th>
<th class="tableblock halign-left valign-top">Tamanho do caminho (em bytes)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 transa√ß√µes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 kilobytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 hashes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">128 bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">512 transa√ß√µes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">128 kilobytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9 hashes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">288 bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.048 transa√ß√µes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">512 kilobytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11 hashes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">352 bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">65.535 transa√ß√µes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 megabytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 hashes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">512 bytes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-2427">
<p>Como voc√™ pode ver na tabela, enquanto o tamanho do bloco aumenta rapidamente, de 4 KB com 16 transa√ß√µes at√© um tamanho de bloco de 16 MB para comportar 65.535 transa√ß√µes, o caminho de merkle necess√°rio para provar a inclus√£o de uma transa√ß√£o cresce muito mais lentamente, de 128 bytes at√© somente 512 bytes. Com as √°rvores de merkle, um n√≥ pode fazer apenas o download dos cabe√ßalhos dos blocos (80 bytes por bloco) e ainda ser capaz de identificar a inclus√£o de uma transa√ß√£o em um bloco ao adquirir um pequeno caminho de merkle de um n√≥ completo, sem precisar armazenar ou transmitir a vasta maioria da blockchain, que pode ter v√°rios gigabytes de tamanho. Os n√≥s que n√£o mant√™m uma blockchain completa, conhecidos como n√≥s de verifica√ß√£o de pagamento simplificada (SPV), usam caminhos de merkle para verificar as transa√ß√µes sem ter que fazer o download dos blocos completos.</p>
</div>
<div class="paragraph data-line-2429">
<p>=== √Årvores de Merkle e Verifica√ß√£o de Pagamento Simplificada (SPV)</p>
</div>
<div class="paragraph data-line-2431">
<p>Merkle trees are used extensively by SPV nodes. SPV nodes don&#8217;t have all transactions and do not download full blocks, just block headers. In order to verify that a transaction is included in a block, without having to download all the transactions in the block, they use an authentication path, or merkle path.</p>
</div>
<div class="paragraph data-line-2433">
<p>Considere, por exemplo, que um n√≥ de SPV esteja interessado em receber pagamentos para um endere√ßo contido em sua carteira. O n√≥ de SPV estabelecer√° um filtro de bloom (ver <a href="#bloom_filters">[bloom_filters]</a>) em suas conex√µes com os outros pares (n√≥s), limitando-se a receber somente aquelas transa√ß√µes que contiverem os endere√ßos de interesse. Quando um par (n√≥) vizinho enxergar uma transa√ß√£o que corresponde ao filtro de bloom do n√≥ de SPV, ele enviar√° aquele bloco usando uma mensagem merkleblock. A mensagem merkleblock cont√©m o cabe√ßalho do bloco e o caminho de merkle que liga a transa√ß√£o de interesse √† raiz de merkle do bloco. O n√≥ de SPV usa esse caminho de merkle para ligar a transa√ß√£o ao bloco e verificar que a transa√ß√£o foi inclu√≠da no bloco. O n√≥ de SPV tamb√©m usa o cabe√ßalho do bloco para ligar o bloco ao resto da blockchain. A combina√ß√£o dessas duas liga√ß√µes, entre a transa√ß√£o e o bloco, e entre o bloco e a blockchain, comprova que a transa√ß√£o foi registrada na blockchain. No final, o n√≥ de SPV ter√° recebido menos que um kilobyte de dados para o cabe√ßalho do bloco e o caminho de merkle, uma quantidade de dados que √© mais do que mil vezes menor do que um bloco completo (cerca de 1 megabyte atualmente).</p>
</div>
<div class="paragraph data-line-2435">
<p>=== Blockchains de Testes do Bitcoin</p>
</div>
<div class="paragraph data-line-2437">
<p>You might be surprised to learn that there is more than one Bitcoin blockchain. The "main" Bitcoin blockchain, the one created by Satoshi Nakamoto on January 3rd, 2009, the one with the genesis block we studied in this chapter, is called <em>mainnet</em>.  There are other Bitcoin blockchains that are used for testing purposes: at this time <em>testnet</em>, <em>segnet</em>, and <em>regtest</em>. Let&#8217;s look at each in turn.</p>
</div>
<div class="paragraph data-line-2440">
<p>==== Testnet&#x2014;O Playground de Testes do Bitcoin</p>
</div>
<div class="paragraph data-line-2442">
<p>Testnet √© o nome da blockchain, da rede e da moeda que s√£o usadas para fins de teste. A testnet √© uma rede P2P ativa com recursos completos, com carteiras, bitcoins de teste (moedas da testnet), minera√ß√£o e todos os outros recursos da mainnet. Na verdade, existem apenas duas diferen√ßas: as moedas da testnet n√£o t√™m valor e a dificuldade de minera√ß√£o deve ser baixa o suficiente para que qualquer pessoa possa minerar moedas da testnet com relativa facilidade (mantendo-as sem valor).</p>
</div>
<div class="paragraph data-line-2444">
<p>Qualquer desenvolvimento de software destinado para uso em produ√ß√£o na rede principal (mainnet) do bitcoin deve primeiro ser testado na testnet com moedas de teste (test coins). Isso protege os desenvolvedores de perdas monet√°rias devido a bugs e protege a rede de comportamento n√£o intencional devido a bugs.</p>
</div>
<div class="paragraph data-line-2446">
<p>Manter as moedas sem valor e a minera√ß√£o f√°cil, entretanto, √© uma tarefa dif√≠cil. Apesar dos apelos dos desenvolvedores, algumas pessoas usam equipamentos avan√ßados de minera√ß√£o (GPUs e ASICs) para minerar na testnet. Isso aumenta a dificuldade, torna imposs√≠vel minerar com uma CPU e, eventualmente, dificulta tanto a obten√ß√£o de moedas de teste, que as pessoas come√ßam a valoriz√°-las. Como resultado, de tempos em tempos, a testnet precisa ser descartada e reiniciada a partir de um novo bloco g√™nese, reiniciando a dificuldade.</p>
</div>
<div class="paragraph data-line-2448">
<p>A testnet atual √© chamada de <em>testnet3</em>, a terceira itera√ß√£o de testnet, reiniciada em fevereiro de 2011 para redefinir a dificuldade da testnet anterior.</p>
</div>
<div class="paragraph data-line-2450">
<p>Tenha em mente que a testnet3 √© uma blockchain pesada, que j√° tinha mais de 25 GB no ano de 2021. Ela levar√° um dia ou mais para ser totalmente sincronizada e usar√° recursos do seu computador. N√£o tanto quanto a mainnet usar√°, mas n√£o se pode dizer que ela √© uma blockchain "leve". Uma boa maneira de se executar um n√≥ da testnet √© atrav√©s de uma imagem de m√°quina virtual (por exemplo, VirtualBox, Docker, Cloud Server, etc.) dedicada a esse prop√≥sito.</p>
</div>
<div class="paragraph data-line-2452">
<p>===== Usando a testnet</p>
</div>
<div class="paragraph data-line-2454">
<p>O Bitcoin Core, como quase todos os outros softwares do bitcoin, tem suporte total para opera√ß√µes na testnet. Todas as fun√ß√µes do Bitcoin Core tamb√©m funcionam na testnet, incluindo a carteira, a minera√ß√£o de moedas da testnet e a sincroniza√ß√£o de um n√≥ completo na testnet.</p>
</div>
<div class="paragraph data-line-2456">
<p>Para iniciar o Bitcoin Core na testnet em vez da mainnet, use o <em>switch</em> testnet:</p>
</div>
<div class="listingblock data-line-2458">
<div class="content">
<pre>$ bitcoind -testnet</pre>
</div>
</div>
<div class="paragraph data-line-2462">
<p>Nos logs, voc√™ ver√° que o bitcoind est√° construindo uma nova blockchain no subdiret√≥rio testnet3 do diret√≥rio padr√£o bitcoind:</p>
</div>
<div class="listingblock data-line-2464">
<div class="content">
<pre>bitcoind: Usando o diret√≥rio de dados /home/nomedousuario/.bitcoin/testnet3</pre>
</div>
</div>
<div class="paragraph data-line-2468">
<p>Para conectar-se ao bitcoind, use a ferramenta de linha de comando bitcoin-cli, mas tamb√©m √© necess√°rio altern√°-la para o modo testnet:</p>
</div>
<div class="listingblock data-line-2470">
<div class="content">
<pre>$ bitcoin-cli -testnet getblockchaininfo
{
  "chain": "test",
  "blocks": 1088,
  "headers": 139999,
  "bestblockhash": "0000000063d29909d475a1c4ba26da64b368e56cce5d925097bf3a2084370128",
  "difficulty": 1,
  "mediantime": 1337966158,
  "verificationprogress": 0.001644065914099759,
  "chainwork": "0000000000000000000000000000000000000000000000000000044104410441",
  "pruned": false,
  "softforks": [

  [...]</pre>
</div>
</div>
<div class="paragraph data-line-2487">
<p>Voc√™ tamb√©m pode usar a testnet3 em outras implementa√ß√µes de n√≥ completo, como a btcd (escrita em Go) e a bcoin (escrita em JavaScript), para experimentar e aprender em outras linguagens de programa√ß√£o e outros <em>frameworks</em>.</p>
</div>
<div class="paragraph data-line-2489">
<p>Em 2021, a testnet3 oferece suporte a todos os recursos da mainnet, incluindo a Segregated Witness (ver <a href="#segwit">[segwit]</a>). Portanto, a testnet3 tamb√©m pode ser usada para testar os recursos da Segregated Witness.</p>
</div>
<div class="paragraph data-line-2491">
<p>==== Segnet&#x2014;A Testnet da Segregated Witness</p>
</div>
<div class="paragraph data-line-2494">
<p>Em 2016, uma testnet de prop√≥sito especial foi lan√ßada para auxiliar no desenvolvimento e nos testes da Segregated Witness (tamb√©m conhecida como segwit; ver <a href="#segwit">[segwit]</a>). Esta blockchain de testes √© chamada de segnet e pode ser utilizada executando-se uma vers√£o especial (um <em>branch</em>) do Bitcoin Core.</p>
</div>
<div class="paragraph data-line-2496">
<p>Como a segwit foi adicionada √† testnet3, n√£o √© mais necess√°rio usar a segnet para se testar os recursos da segwit.</p>
</div>
<div class="paragraph data-line-2498">
<p>No futuro, √© prov√°vel que vejamos outras blockchains de testnet que ser√£o projetadas especificamente para testar um √∫nico recurso ou uma grande mudan√ßa arquitetural, como a segnet.</p>
</div>
<div class="paragraph data-line-2500">
<p>==== Regtest&#x2014;A Blockchain Local</p>
</div>
<div class="paragraph data-line-2502">
<p> A regtest, que significa "Teste de Regress√£o", √© um recurso do Bitcoin Core que permite criar uma blockchain local para fins de teste. Ao contr√°rio da testnet3, que √© uma blockchain de testes p√∫blica e compartilhada, as blockchains de regtest foram feitas para serem executadas como sistemas fechados usados para testes locais. Voc√™ lan√ßa uma blockchain regtest do zero, criando um bloco g√™nese local. Voc√™ pode adicionar outros n√≥s √† rede, ou execut√°-la com um √∫nico n√≥ apenas para testar o software Bitcoin Core.</p>
</div>
<div class="paragraph data-line-2504">
<p>Para iniciar o Bitcoin Core no modo regtest, use a <em>flag</em> regtest:</p>
</div>
<div class="listingblock data-line-2506">
<div class="content">
<pre>$ bitcoind -regtest</pre>
</div>
</div>
<div class="paragraph data-line-2510">
<p>Assim como acontece com a testnet, o Bitcoin Core inicializar√° uma nova blockchain no subdiret√≥rio <em>regtest</em> do seu diret√≥rio padr√£o bitcoind:</p>
</div>
<div class="listingblock data-line-2512">
<div class="content">
<pre>bitcoind: Usando o diret√≥rio de dados /home/nomedousuario/.bitcoin/regtest</pre>
</div>
</div>
<div class="paragraph data-line-2516">
<p>Para usar a ferramenta de linha de comando, voc√™ tamb√©m precisa especificar a <em>flag</em> regtest. Vamos usar o comando getblockchaininfo para inspecionar a blockchain da regtest:</p>
</div>
<div class="listingblock data-line-2518">
<div class="content">
<pre>$ bitcoin-cli -regtest getblockchaininfo
{
  "chain": "regtest",
  "blocks": 0,
  "headers": 0,
  "bestblockhash": "0f9188f13cb7b2c71f2a335e3a4fc328bf5beb436012afca590b1a11466e2206",
  "difficulty": 4.656542373906925e-10,
  "mediantime": 1296688602,
  "verificationprogress": 1,
  "chainwork": "0000000000000000000000000000000000000000000000000000000000000002",
  "pruned": false,
  [...]</pre>
</div>
</div>
<div class="paragraph data-line-2533">
<p>Como voc√™ pode ver, ainda n√£o h√° nenhum bloco. Vamos minerar alguns (500 blocos) e ganhar a recompensa:</p>
</div>
<div class="listingblock data-line-2535">
<div class="content">
<pre>$ bitcoin-cli -regtest generate 500
[
  "7afed70259f22c2bf11e406cb12ed5c0657b6e16a6477a9f8b28e2046b5ba1ca",
  "1aca2f154a80a9863a9aac4c72047a6d3f385c4eec5441a4aafa6acaa1dada14",
  "4334ecf6fb022f30fbd764c3ee778fabbd53b4a4d1950eae8a91f1f5158ed2d1",
  "5f951d34065efeaf64e54e91d00b260294fcdfc7f05dbb5599aec84b957a7766",
  "43744b5e77c1dfece9d05ab5f0e6796ebe627303163547e69e27f55d0f2b9353",
   [...]
  "6c31585a48d4fc2b3fd25521f4515b18aefb59d0def82bd9c2185c4ecb754327"
]</pre>
</div>
</div>
<div class="paragraph data-line-2548">
<p>A minera√ß√£o de todos esses blocos levar√° apenas alguns segundos, o que certamente facilita a realiza√ß√£o de testes. Se voc√™ verificar o saldo da sua carteira, voc√™ ver√° que ganhou recompensas pelos primeiros 400 blocos (as recompensas das transa√ß√µes coinbase precisam ter 100 blocos de profundidade para que voc√™ possa gast√°-las):</p>
</div>
<div class="listingblock data-line-2550">
<div class="content">
<pre>$ bitcoin-cli -regtest getbalance
12462.50000000</pre>
</div>
</div>
<div class="paragraph data-line-2555">
<p>=== Usando Blockchains de Testes para Desenvolvimento</p>
</div>
<div class="paragraph data-line-2557">
<p>As v√°rias blockchains do bitcoin (regtest, segnet, testnet3 e mainnet) oferecem uma variedade de ambientes de testes para o desenvolvimento bitcoin. Use as blockchains de testes se voc√™ estiver desenvolvendo para o Bitcoin Core ou outro cliente de consenso de n√≥ completo; um aplicativo como uma carteira, exchange ou site de com√©rcio eletr√¥nico; ou at√© mesmo se estiver desenvolvendo novos contratos inteligentes e scripts complexos.</p>
</div>
<div class="paragraph data-line-2559">
<p>Voc√™ pode usar as blockchains de testes para estabelecer uma sequ√™ncia de desenvolvimento. Teste seu c√≥digo localmente na regtest enquanto voc√™ o desenvolve. Quando estiver pronto para experiment√°-lo em uma rede p√∫blica, mude para a testnet para expor seu c√≥digo a um ambiente mais din√¢mico, com mais diversidade de c√≥digos e aplicativos. Finalmente, quando voc√™ estiver confiante de que seu c√≥digo funciona conforme o esperado, mude para a mainnet para coloc√°-lo em produ√ß√£o. Conforme voc√™ faz altera√ß√µes, melhorias, corre√ß√µes de bugs, etc., inicie a sequ√™ncia de desenvolvimento novamente, implementando cada altera√ß√£o primeiro na regtest, depois na testnet e, finalmente, colocando em produ√ß√£o na mainnet.</p>
</div>
<div id="minera√ß√£o" class="paragraph data-line-2562">
<p>== Minera√ß√£o e Consenso</p>
</div>
<div class="paragraph data-line-2565">
<p>=== Introdu√ß√£o</p>
</div>
<div class="paragraph data-line-2567">
<p>A palavra "minera√ß√£o" pode causar confus√£o. Como ela nos remete √† semelhan√ßa com a extra√ß√£o de metais preciosos, ela foca nossa aten√ß√£o na recompensa que √© paga pela minera√ß√£o, que s√£o os novos bitcoins gerados em cada bloco. Embora a minera√ß√£o seja incentivada por essa recompensa, o prop√≥sito principal da minera√ß√£o n√£o √© a recompensa ou a gera√ß√£o de novas moedas. Se voc√™ enxerga a minera√ß√£o como sendo apenas o processo atrav√©s do qual as moedas s√£o criadas, voc√™ est√° confundindo os meios (os incentivos) com o objetivo do processo. A minera√ß√£o √© o mecanismo que sustenta a c√¢mara de compensa√ß√£o descentralizada, atrav√©s da qual as transa√ß√µes s√£o validadas e compensadas. A minera√ß√£o √© a inven√ß√£o que torna o bitcoin especial, um mecanismo de seguran√ßa descentralizado que √© a base para o dinheiro em esp√©cie digital P2P.</p>
</div>
<div class="paragraph data-line-2569">
<p>Mining <em>secures the Bitcoin system</em> and enables the emergence of network-wide <em>consensus without a central authority</em>. The reward of newly minted coins and transaction fees is an incentive scheme that aligns the actions of miners with the security of the network, while simultaneously implementing the monetary supply.</p>
</div>
<div class="admonitionblock tip data-line-2572">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-2573">
<p>O prop√≥sito da minera√ß√£o n√£o √© a cria√ß√£o de novos bitcoins. Isso √© apenas o sistema de incentivos usado pela minera√ß√£o. O verdadeiro prop√≥sito da minera√ß√£o √© servir como um mecanismo que mant√©m a <em>seguran√ßa</em> do bitcoin <em>decentralizada</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-2576">
<p>Os mineradores validam novas transa√ß√µes e as registram no livro-raz√£o global. Um novo bloco, contendo transa√ß√µes que ocorreram desde o √∫ltimo bloco, √© "minerado", em m√©dia, a cada 10 minutos, fazendo com que estas transa√ß√µes sejam adicionadas √† blockchain (cadeia de blocos). As transa√ß√µes que foram inclu√≠das em um bloco que foi adicionado √† blockchain s√£o consideradas "confirmadas", o que permite que os novos propriet√°rios possam gastar os bitcoins recebidos nestas transa√ß√µes.</p>
</div>
<div class="paragraph data-line-2578">
<p>Os mineradores recebem dois tipos de recompensa como pagamento pela seguran√ßa fornecida pela minera√ß√£o: as novas moedas que s√£o criadas a cada novo bloco, tamb√©m conhecida como a <em>recompensa do bloco</em> ou <em>recompensa coinbase</em>, e as taxas de transa√ß√£o presentes em todas as transa√ß√µes inclu√≠das no bloco. Para ganhar essa recompensa, os mineradores competem entre si para resolver um dif√≠cil problema matem√°tico baseado em um algoritmo de hash criptogr√°fico. A solu√ß√£o para o problema, chamada de Prova-de-Trabalho, √© inclu√≠da no novo bloco e serve como prova de que o minerador gastou uma significativa quantidade de esfor√ßo computacional. A competi√ß√£o para resolver o algoritmo de Prova-de-Trabalho, a fim de obter a recompensa e o direito de registrar transa√ß√µes na blockchain, √© a base do modelo de seguran√ßa da rede bitcoin.</p>
</div>
<div class="paragraph data-line-2580">
<p>O processo √© chamado de minera√ß√£o porque a recompensa (a gera√ß√£o de novas moedas) √© projetada para simular rendimentos decrescentes, semelhante ao que ocorre com a minera√ß√£o de metais preciosos. A oferta monet√°ria do bitcoin √© aumentada atrav√©s da minera√ß√£o, semelhante √† forma como um banco central emite dinheiro ao imprimir c√©dulas. A quantidade m√°xima de bitcoins rec√©m-criados que um minerador pode adicionar a um bloco diminui, em m√©dia, a cada quatro anos (ou exatamente a cada 210.000 blocos). Essa quantidade m√°xima iniciou com 50 bitcoins por bloco em janeiro de 2009 e caiu pela metade, para 25 bitcoins por bloco, em novembro de 2012. Ela caiu de novo pela metade, para 12,5 bitcoins por bloco, em julho de 2016 e mais uma vez, para 6,25 bitcoins por bloco, em maio de 2020. Com base nesta f√≥rmula, as recompensas de minera√ß√£o do bitcoin diminuem exponencialmente at√© aproximadamente o ano de 2140, quando todos os bitcoins (20,99999998 milh√µes) ter√£o sido emitidos. Ap√≥s 2140, novas unidades de bitcoin n√£o ser√£o mais emitidas.</p>
</div>
<div class="paragraph data-line-2582">
<p>Os mineradores de bitcoin tamb√©m ganham as taxas das transa√ß√µes. Cada transa√ß√£o geralmente inclui uma taxa de transa√ß√£o, que corresponde √† diferen√ßa do n√∫mero de bitcoins contidos nas entradas e nas sa√≠das da transa√ß√£o. O minerador de bitcoin vencedor recebe as taxas das transa√ß√µes que foram inclu√≠das no bloco que ele minerou. Atualmente, as taxas representam 0,5% ou menos da renda de um minerador de bitcoin, ou seja, a maior parte da renda dos mineradores vem dos bitcoins rec√©m-criados. No entanto, √† medida que a recompensa do bloco diminui ao longo do tempo e o n√∫mero de transa√ß√µes por bloco aumenta, uma propor√ß√£o maior da renda dos mineradores vir√° das taxas das transa√ß√µes. Gradualmente, a recompensa da minera√ß√£o ser√° dominada pelas taxas de transa√ß√£o, que se tornar√£o o principal incentivo para os mineradores. Ap√≥s 2140, a quantia de novos bitcoins gerados em cada bloco cair√° para zero e a minera√ß√£o do bitcoin ser√° incentivada exclusivamente pelas taxas das transa√ß√µes.</p>
</div>
<div class="paragraph data-line-2584">
<p>Neste cap√≠tulo, examinaremos primeiro a minera√ß√£o como um mecanismo de oferta monet√°ria e, em seguida, examinaremos a fun√ß√£o mais importante da minera√ß√£o: o mecanismo de consenso descentralizado que garante a seguran√ßa do bitcoin.</p>
</div>
<div class="paragraph data-line-2586">
<p>To understand mining and consensus, we will follow Alice&#8217;s transaction as it is received and added to a block by Jing&#8217;s mining equipment. Then we will follow the block as it is mined, added to the blockchain, and accepted by the Bitcoin network through the process of emergent consensus.</p>
</div>
<div class="paragraph data-line-2588">
<p>==== A Economia do Bitcoin e a Cria√ß√£o de Moedas</p>
</div>
<div class="paragraph data-line-2590">
<p>Os bitcoins s√£o "cunhados" durante a cria√ß√£o de cada bloco em uma taxa fixa e decrescente. Cada bloco √© gerado, em m√©dia, a cada 10 minutos, e cont√©m bitcoins completamente novos, que foram criados a partir do nada. A cada 210.000 blocos, ou aproximadamente a cada quatro anos, a taxa de emiss√£o da moeda √© diminu√≠da em 50%. Nos primeiros quatro anos de opera√ß√£o da rede, cada bloco continha 50 novos bitcoins.</p>
</div>
<div class="paragraph data-line-2592">
<p>Em novembro de 2012, a taxa de emiss√£o de novos bitcoins foi reduzida para 25 bitcoins por bloco. Em julho de 2016, foi reduzida para 12,5 bitcoins por bloco e, em maio de 2020, foi reduzida novamente para 6,25 bitcoins por bloco. A taxa de emiss√£o de novas moedas diminuir√° dessa maneira, exponencialmente, atrav√©s de 32 "redu√ß√µes pela metade" (em ingl√™s, <em>halvings</em>), at√© o bloco n¬∫6.720.000 (que ser√° minerado aproximadamente no ano de 2137), quando a unidade monet√°ria m√≠nima de 1 satoshi ser√° atingida. Finalmente, ap√≥s 6,93 milh√µes de blocos, aproximadamente no ano de 2140, quase 2.099.999.997.690.000 de satoshis, ou quase 21 milh√µes de bitcoins, ter√£o sido emitidos. Depois disso, os blocos n√£o conter√£o nenhum bitcoin novo e os mineradores ser√£o recompensados apenas por meio das taxas de transa√ß√£o. A <a href="#bitcoin_money_supply">Oferta monet√°ria do bitcoin ao longo do tempo, baseada em uma taxa de emiss√£o com progress√£o geom√©trica decrescente</a> mostra o total de bitcoins em circula√ß√£o ao longo do tempo, √† medida que a emiss√£o da moeda diminui.</p>
</div>
<div id="bitcoin_money_supply" class="imageblock data-line-2596">
<div class="content">
<img src="images/mbc2_1001.png" alt="BitcoinMoneySupply">
</div>
<div class="title">Figure 63. Oferta monet√°ria do bitcoin ao longo do tempo, baseada em uma taxa de emiss√£o com progress√£o geom√©trica decrescente</div>
</div>
<div class="admonitionblock note data-line-2599">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-2600">
<p>O n√∫mero m√°ximo de moedas mineradas no bitcoin √© o <em>limite superior</em> do total de recompensas de minera√ß√£o poss√≠veis. Na pr√°tica, um minerador pode intencionalmente minerar um bloco que recebe menos do que a recompensa completa a que tem direito. Blocos desse tipo j√° foram minerados no passado e mais poder√£o ser minerados no futuro, resultando em uma emiss√£o total de moedas menor do que a esperada.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-2603">
<p>No c√≥digo do <a href="#max_money">Um script para calcular o total de bitcoins que ser√£o emitidos</a>, calculamos a quantidade total de bitcoins que ser√° emitida.</p>
</div>
<div id="max_money" class="exampleblock data-line-2607">
<div class="title">Example 22. Um script para calcular o total de bitcoins que ser√£o emitidos</div>
<div class="content">
<div class="listingblock data-line-2609">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">Unresolved directive in for_use_mastering-bitcoin_chapter-10_pt_BR.adoc - include::code/max_money.py[]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-2614">
<p>O <a href="#max_money_run">Executando o script max_money.py</a> mostra o output produzido ao executar-se esse script.</p>
</div>
<div id="max_money_run" class="exampleblock data-line-2618">
<div class="title">Example 23. Executando o script max_money.py</div>
<div class="content">
<div class="listingblock data-line-2620">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ python max_money.py
Total de bitcoins que ser√£o criados: 2100000000000000.0 satoshis</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-2626">
<p>A emiss√£o decrescente e finita cria uma oferta monet√°ria fixa que resiste √† infla√ß√£o. Ao contr√°rio das moedas fiduci√°rias, que podem ser infinitamente impressas por um banco central, o bitcoin jamais poder√° ser inflacionado atrav√©s de uma impress√£o de moedas.</p>
</div>
</div>
</div>
<div class="paragraph data-line-70">
<p>A consequ√™ncia mais importante e debatida da emiss√£o monet√°ria fixa e descrescente √© que a moeda tende a ser inerentemente <em>deflacion√°ria</em>. A defla√ß√£o √© o fen√¥meno em que h√° aprecia√ß√£o (aumento de valor) devido a um descasamento entre a oferta e a demanda, o que faz com que uma moeda ganhe valor (e a taxa de c√¢mbio aumente). Em um cen√°rio de defla√ß√£o de pre√ßos (o oposto da infla√ß√£o de pre√ßos), o dinheiro vai ganhando mais poder de compra com o passar do tempo.</p>
</div>
<div class="paragraph data-line-72">
<p>Muitos economistas argumentam que uma economia deflacion√°ria √© um desastre e deveria ser evitada a todo custo. Isso porque em um per√≠odo de r√°pida defla√ß√£o, as pessoas tendem a acumular dinheiro ao inv√©s de gast√°-lo, na esperan√ßa de que os pre√ßos cair√£o no futuro. Esse fen√¥meno ocorreu durante a "D√©cada Perdida" do Jap√£o, quando um colapso completo da demanda levou a moeda a uma espiral deflacion√°ria.</p>
</div>
<div class="paragraph data-line-74">
<p>Os especialistas em bitcoin argumentam que a defla√ß√£o n√£o √© algo ruim por si s√≥. Segundo eles, a defla√ß√£o √© associada a um colapso na demanda porque este foi o √∫nico exemplo de defla√ß√£o que n√≥s temos dispon√≠vel para estudar. Em uma moeda fiduci√°ria com a possibilidade de impress√£o ilimitada, √© muito dif√≠cil de se entrar em uma espiral deflacion√°ria, a menos que exista um colapso completo na demanda e um desinteresse em imprimir dinheiro. A defla√ß√£o do bitcoin n√£o √© causada por um colapso na demanda, mas sim por uma oferta restrita previs√≠vel.</p>
</div>
<div class="paragraph data-line-76">
<p>O aspecto positivo da defla√ß√£o, √© claro, √© que ela √© o oposto da infla√ß√£o. A infla√ß√£o causa uma desvaloriza√ß√£o lenta, mas inevit√°vel, da moeda, resultando em uma forma de tributa√ß√£o oculta que pune os poupadores para resgatar os devedores (incluindo os maiores devedores de todos, que s√£o os pr√≥prios governos). As moedas sob controle governamental sofrem com o risco moral da f√°cil emiss√£o de d√≠vidas, que mais tarde podem ser apagadas atrav√©s da desvaloriza√ß√£o da moeda √† custa dos poupadores.</p>
</div>
<div class="paragraph data-line-78">
<p>Resta saber se o aspecto deflacion√°rio da moeda √© um problema quando ele n√£o √© impulsionado por uma r√°pida retra√ß√£o econ√¥mica, ou se ele √© uma vantagem, caso os benef√≠cios da prote√ß√£o contra a infla√ß√£o e a perda do poder de compra superem em muito os riscos da defla√ß√£o.</p>
</div>
<div class="sidebarblock data-line-79">
<div class="content">
<div class="paragraph data-line-81">
<p>=== Consenso Descentralizado</p>
</div>
<div class="paragraph data-line-83">
<p>In the previous chapter we looked at the blockchain, the global public ledger (list) of all transactions, which everyone in the Bitcoin network accepts as the authoritative record of ownership.</p>
</div>
<div class="paragraph data-line-85">
<p>But how can everyone in the network agree on a single universal "truth" about who owns what, without having to trust anyone? All traditional payment systems depend on a trust model that has a central authority providing a clearinghouse service, basically verifying and clearing all transactions. Bitcoin has no central authority, yet somehow every full node has a complete copy of a public ledger that it can trust as the authoritative record. The blockchain is not created by a central authority, but is assembled independently by every node in the network. Somehow, every node in the network, acting on information transmitted across insecure network connections, can arrive at the same conclusion and assemble a copy of the same public ledger as everyone else. This chapter examines the process by which the Bitcoin network achieves global consensus without central authority.</p>
</div>
<div class="paragraph data-line-87">
<p>A principal inven√ß√£o de Satoshi Nakamoto foi o mecanismo descentralizado usado para se atingir o <em>consenso emergente</em>. Diz-se emergente, pois o consenso n√£o √© atingido de maneira expl√≠cita‚Äîn√£o existe uma elei√ß√£o ou um momento fixo no qual o consenso ocorre. Ao inv√©s disso, o consenso √© um artefato que emerge da intera√ß√£o ass√≠ncrona de milhares de n√≥s independentes, todos seguindo regras simples. Todas as propriedades do bitcoin derivam dessa inven√ß√£o, incluindo a moeda, as transa√ß√µes, os pagamentos e o modelo de seguran√ßa que n√£o depende de confian√ßa ou de uma autoridade central.</p>
</div>
<div class="paragraph data-line-89">
<p>O consenso descentralizado do bitcoin emerge da intera√ß√£o de quatro processos que ocorrem independentemente nos n√≥s distribu√≠dos em toda a rede:</p>
</div>
<div class="ulist pagebreak-before data-line-92">
<ul>
<li class="data-line-92">
<p>Verifica√ß√£o independente de cada transa√ß√£o, realizada por cada n√≥ completo, com base em uma extensa lista de crit√©rios</p>
</li>
<li class="data-line-93">
<p>Agrega√ß√£o independente dessas transa√ß√µes em novos blocos, realizada pelos n√≥s de minera√ß√£o, juntamente com computa√ß√£o demonstrada atrav√©s de um algoritmo de Prova-de-Trabalho</p>
</li>
<li class="data-line-94">
<p>Verifica√ß√£o independente dos novos blocos por cada n√≥ e inclus√£o deles em uma cadeia</p>
</li>
<li class="data-line-95">
<p>Sele√ß√£o independente, por cada n√≥, da cadeia de blocos com a maior computa√ß√£o acumulada demonstrada atrav√©s da Prova-de-Trabalho</p>
</li>
</ul>
</div>
<div class="paragraph data-line-97">
<p>In the next few sections we will examine these processes and how they interact to create the emergent property of network-wide consensus that allows any Bitcoin node to assemble its own copy of the authoritative, trusted, public, global ledger.</p>
</div>
<div id="tx_verification" class="paragraph data-line-100">
<p>=== Verifica√ß√£o Independente de Transa√ß√µes</p>
</div>
<div class="paragraph data-line-102">
<p>In <a href="#transactions">[transactions]</a>, we saw how wallet software creates transactions by collecting UTXO, providing the appropriate unlocking scripts, and then constructing new outputs assigned to a new owner. The resulting transaction is then sent to the neighboring nodes in the Bitcoin network so that it can be propagated across the entire Bitcoin network.</p>
</div>
<div class="paragraph data-line-104">
<p>However, before forwarding transactions to its neighbors, every Bitcoin node that receives a transaction will first verify the transaction. This ensures that only valid transactions are propagated across the network, while invalid transactions are discarded at the first node that encounters them.</p>
</div>
<div class="paragraph data-line-106">
<p>Cada n√≥ verifica cada transa√ß√£o usando uma <em>checklist</em> contendo v√°rios crit√©rios:</p>
</div>
<div class="ulist data-line-108">
<ul>
<li class="data-line-108">
<p>A sintaxe da transa√ß√£o e a estrutura de dados devem estar corretas.</p>
</li>
<li class="data-line-109">
<p>Nem a lista de entradas, nem a lista de sa√≠das est√£o vazias.</p>
</li>
<li class="data-line-110">
<p>O tamanho da transa√ß√£o √© menor que o tamanho m√°ximo permitido para um bloco, excluindo dados de testemunha, conforme mostrado em <a href="https://bit.ly/3t623VL" data-href="https://bit.ly/3t623VL"><em>tx_check.cpp</em></a>.</p>
</li>
<li class="data-line-111">
<p>Cada valor de sa√≠da, assim como o total, deve estar dentro da faixa de valores permitida (menos do que 21 milh√µes de moedas, mais do que o valor m√≠nimo considerado como <em>p√≥</em>).</p>
</li>
<li class="data-line-112">
<p>Nenhuma das entradas tem hash=0, N=‚Äì1 (transa√ß√µes coinbase n√£o devem ser retransmitidas).</p>
</li>
<li class="data-line-113">
<p>nLocktime √© igual a INT_MAX, ou os valores de nLocktime e nSequence s√£o satisfeitos de acordo com a MedianTimePast (mediana do hor√°rio do passado).</p>
</li>
<li class="data-line-114">
<p>O tamanho da transa√ß√£o em bytes √© maior ou igual a 82.</p>
</li>
<li class="data-line-115">
<p>O n√∫mero de opera√ß√µes de assinatura (SIGOPS) contidas na transa√ß√£o √© menor do que o limite de opera√ß√µes de assinatura.</p>
</li>
<li class="data-line-116">
<p>O script de destravamento (scriptSig) s√≥ pode adicionar n√∫meros no stack, e o script de travamento (scriptPubkey) deve coincidir com as formas IsStandard (isso rejeita transa√ß√µes que sejam "fora do padr√£o").</p>
</li>
<li class="data-line-117">
<p>Deve existir uma transa√ß√£o correspondente na pool ou em um bloco na cadeia principal.</p>
</li>
<li class="data-line-118">
<p>Para cada entrada, se a sa√≠da referenciada existir em qualquer outra transa√ß√£o na pool, a transa√ß√£o deve ser rejeitada.</p>
</li>
<li class="data-line-119">
<p>Para cada entrada, buscar pela transa√ß√£o pai no ramo principal e na pool de transa√ß√µes. Se a transa√ß√£o pai estiver faltando para qualquer entrada, essa ser√° uma transa√ß√£o √≥rf√£. Adicionar √† pool de transa√ß√µes √≥rf√£s, caso uma transa√ß√£o correspondente j√° n√£o estiver na pool.</p>
</li>
<li class="data-line-120">
<p>Para cada entrada, se a transa√ß√£o pai for uma transa√ß√£o coinbase, ela deve ter uma COINBASE_MATURITY de pelo menos 100 confirma√ß√µes.</p>
</li>
<li class="data-line-121">
<p>Para cada entrada, a sa√≠da referenciada deve existir e n√£o pode ter sido gasta previamente.</p>
</li>
<li class="data-line-122">
<p>Usando as transa√ß√µes pai para adquirir os valores de entrada, verificar se cada valor de entrada, assim como a soma dos valores, est√£o dentro do intervalo permitido de valores (menor do que 21 milh√µes de moedas, maior do que 0).</p>
</li>
<li class="data-line-123">
<p>Rejeitar se a soma dos valores das entradas for menor do que a soma dos valores das sa√≠das.</p>
</li>
<li class="data-line-124">
<p>Rejeitar se a taxa de transa√ß√£o seria muito baixa (minRelayTxFee) para entrar em um bloco vazio.</p>
</li>
<li class="data-line-125">
<p>Os scripts de destravamento para cada entrada devem ser validados em rela√ß√£o aos scripts de travamento das sa√≠das correspondentes.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-127">
<p>Essas condi√ß√µes podem ser vistas em detalhes nas fun√ß√µes AcceptToMemoryPool, CheckTransaction e CheckInputs do Bitcoin Core. Note que as condi√ß√µes mudam ao longo do tempo, para lidar com novos tipos de ataques de nega√ß√£o de servi√ßo ou, √†s vezes, para relaxar as regras de modo a incluir mais tipos de transa√ß√µes.</p>
</div>
<div class="paragraph data-line-129">
<p>Ao verificar independentemente cada transa√ß√£o √† medida que ela √© recebida e antes de propag√°-la, cada n√≥ constr√≥i uma pool de transa√ß√µes v√°lidas (mas n√£o confirmadas), que √© conhecida como <em>pool de transa√ß√µes</em>, <em>pool de mem√≥ria</em> ou <em>mempool</em>.</p>
</div>
<div class="paragraph data-line-131">
<p>=== N√≥s Mineradores</p>
</div>
<div class="paragraph data-line-133">
<p>Some of the nodes on the Bitcoin network are specialized nodes called <em>miners</em>. In <a href="#ch01_intro_what_is_bitcoin">Introdu√ß√£o</a> we introduced Jing, a computer engineering student in Shanghai, China, who is a bitcoin miner. Jing earns bitcoin by running a "mining rig," which is a specialized computer-hardware system designed to mine bitcoin. Jing&#8217;s specialized mining hardware is connected to a server running a full Bitcoin node. Unlike Jing, some miners mine without a full node, as we will see in <a href="#mining_pools">[mining_pools]</a>. Like every other full node, Jing&#8217;s node receives and propagates unconfirmed transactions on the Bitcoin network. Jing&#8217;s node, however, also aggregates these transactions into new blocks.</p>
</div>
<div class="paragraph data-line-135">
<p>Jing&#8217;s node is listening for new blocks, propagated on the Bitcoin network, as do all nodes. However, the arrival of a new block has special significance for a mining node. The competition among miners effectively ends with the propagation of a new block that acts as an announcement of a winner. To miners, receiving a valid new block means someone else won the competition and they lost. However, the end of one round of a competition is also the beginning of the next round. The new block is not just a checkered flag, marking the end of the race; it is also the starting pistol in the race for the next block.</p>
</div>
<div class="paragraph data-line-137">
<p>=== Agregando Transa√ß√µes em Blocos</p>
</div>
<div class="paragraph data-line-139">
<p>After validating transactions, a Bitcoin node will add them to the <em>memory pool</em>, or <em>transaction pool</em>, where transactions await until they can be included (mined) into a block. Jing&#8217;s node collects, validates, and relays new transactions just like any other node. Unlike other nodes, however, Jing&#8217;s node will then aggregate these transactions into a <em>candidate block</em>.</p>
</div>
<div class="paragraph data-line-141">
<p>Vamos seguir os blocos que foram criados durante o per√≠odo em que a Alice comprou uma x√≠cara de caf√© da Cafeteria do Bob (ver <a href="#cup_of_coffee">[cup_of_coffee]</a>). A transa√ß√£o da Alice foi inclu√≠da no bloco 277.316. Para demonstrar os conceitos nesse cap√≠tulo, assumiremos que o bloco foi minerado pelo sistema de minera√ß√£o do Jing e seguiremos a transa√ß√£o da Alice √† medida que ela √© inclu√≠da nesse novo bloco.</p>
</div>
<div class="paragraph data-line-143">
<p>Jing&#8217;s mining node maintains a local copy of the blockchain. By the time Alice buys the cup of coffee, Jing&#8217;s node has assembled a chain up to block 277,314. Jing&#8217;s node is listening for transactions, trying to mine a new block and also listening for blocks discovered by other nodes. As Jing&#8217;s node is mining, it receives block 277,315 through the Bitcoin network. The arrival of this block signifies the end of the competition for block 277,315 and the beginning of the competition to create block 277,316.</p>
</div>
<div class="paragraph data-line-145">
<p>Durante os √∫ltimos 10 minutos, enquanto o n√≥ do Jing procurava uma solu√ß√£o para o bloco 277.315, ele tamb√©m estava coletando transa√ß√µes para preparar para o pr√≥ximo bloco. Agora ele j√° coletou algumas centenas de transa√ß√µes na pool de mem√≥ria. Ao receber o bloco 277.315 e valid√°-lo, o n√≥ do Jing tamb√©m ir√° compar√°-lo com todas as transa√ß√µes na pool de mem√≥ria e remover√° qualquer transa√ß√£o que j√° tiver sido inclu√≠da no bloco 277.315. As transa√ß√µes que permanecem na pool de mem√≥ria s√£o transa√ß√µes n√£o confirmadas e est√£o aguardando para serem registradas em um novo bloco.</p>
</div>
<div class="paragraph data-line-147">
<p>O n√≥ do Jing imediatamente constr√≥i um novo bloco vazio, um candidato para o bloco 277.316. Esse bloco √© chamado de <em>bloco candidato</em>, pois ele ainda n√£o √© um bloco v√°lido, visto que ele n√£o cont√©m uma Prova-de-Trabalho v√°lida. O bloco s√≥ se torna v√°lido se o minerador conseguir encontrar uma solu√ß√£o para o algoritmo de Prova-de-Trabalho.</p>
</div>
<div class="paragraph data-line-149">
<p>Quando o n√≥ do Jing agrega todas as transa√ß√µes da pool de mem√≥ria, o novo bloco candidato tem 418 transa√ß√µes com um total de taxas de transa√ß√£o de 0,09094928 bitcoin. Voc√™ pode ver este bloco na blockchain usando a interface em linha de comando do cliente Bitcoin Core, como demonstrado no <a href="#block277316">Usando a linha de comando para recuperar o bloco 277.316</a>.</p>
</div>
<div id="block277316" class="exampleblock data-line-153">
<div class="title">Example 24. Usando a linha de comando para recuperar o bloco 277.316</div>
<div class="content">
<div class="listingblock data-line-155">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ bitcoin-cli getblockhash 277316

0000000000000001b6b9a13b095e96db41c4a928b97ef2d944a9b31b2cc7bdc4

$ bitcoin-cli getblock 0000000000000001b6b9a13b095e96db41c4a928b97ef2d9\
44a9b31b2cc7bdc4</code></pre>
</div>
</div>
<div class="listingblock data-line-166">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "hash" : "0000000000000001b6b9a13b095e96db41c4a928b97ef2d944a9b31b2cc7bdc4",
    "confirmations" : 35561,
    "size" : 218629,
    "height" : 277316,
    "version" : 2,
    "merkleroot" : "c91c008c26e50763e9f548bb8b2fc323735f73577effbc55502c51eb4cc7cf2e",
    "tx" : [
        "d5ada064c6417ca25c4308bd158c34b77e1c0eca2a73cda16c737e7424afba2f",
        "b268b45c59b39d759614757718b9918caf0ba9d97c56f3b91956ff877c503fbe",

        ... 417 outras transa√ß√µes ...

       ],
    "time" : 1388185914,
    "nonce" : 924591752,
    "bits" : "1903a30c",
    "difficulty" : 1180923195.25802612,
    "chainwork" : "000000000000000000000000000000000000000000000934695e92aaf53afa1a",
    "previousblockhash" : "0000000000000002a7bbd25a417c0374cc55261021e8a9ca74442b01284f0569"
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-191">
<p>==== A Transa√ß√£o Coinbase</p>
</div>
<div class="paragraph data-line-193">
<p>A primeira transa√ß√£o de qualquer bloco √© uma transa√ß√£o especial, chamada de <em>transa√ß√£o coinbase</em>. Essa transa√ß√£o √© constru√≠da pelo n√≥ do Jing e cont√©m a <em>recompensa</em> pelos seus esfor√ßos de minera√ß√£o.</p>
</div>
<div class="admonitionblock note data-line-196">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-197">
<p>Quando o bloco 277.316 foi minerado, a recompensa era de 25 bitcoins por bloco. Desde ent√£o, j√° se passaram dois per√≠odos de "redu√ß√£o pela metade" (em ingl√™s, <em>halvings</em>). A recompensa do bloco mudou para 12,5 bitcoins em julho de 2016 e depois para 6,25 bitcoins em maio de 2020.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-200">
<p>O n√≥ do Jing cria a transa√ß√£o coinbase como um pagamento para a sua pr√≥pria carteira: "Pague ao endere√ßo do Jing 25,09094928 bitcoins". O valor total da recompensa que o Jing coleta por minerar um bloco √© a soma da recompensa coinbase (25 novos bitcoins) com as taxas de transa√ß√£o (0,09094928) de todas as transa√ß√µes inclu√≠das no bloco, como demonstrado no <a href="#generation_tx_example">Transa√ß√£o coinbase</a>.</p>
</div>
<div id="generation_tx_example" class="exampleblock data-line-205">
<div class="title">Example 25. Transa√ß√£o coinbase</div>
<div class="content">
<div class="listingblock data-line-206">
<div class="content">
<pre>$ bitcoin-cli getrawtransaction d5ada064c6417ca25c4308bd158c34b77e1c0eca2a73cda16c737e7424afba2f 1</pre>
</div>
</div>
<div class="listingblock c_less_space data-line-212">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "hex" : "01000000010000000000000000000000000000000000000000000000000000000000000000ffffffff0f03443b0403858402062f503253482fffffffff0110c08d9500000000232102aa970c592640d19de03ff6f329d6fd2eecb023263b9ba5d1b81c29b523da8b21ac00000000",
    "txid" : "d5ada064c6417ca25c4308bd158c34b77e1c0eca2a73cda16c737e7424afba2f",
    "version" : 1,
    "locktime" : 0,
    "vin" : [
        {
            "coinbase" : "03443b0403858402062f503253482f",
            "sequence" : 4294967295
        }
    ],
    "vout" : [
        {
            "value" : 25.09094928,
            "n" : 0,
            "scriptPubKey" : {
                "asm" : "02aa970c592640d19de03ff6f329d6fd2eecb023263b9ba5d1b81c29b523da8b21OP_CHECKSIG",
                "hex" : "2102aa970c592640d19de03ff6f329d6fd2eecb023263b9ba5d1b81c29b523da8b21ac",
                "reqSigs" : 1,
                "type" : "pubkey",
                "addresses" : [
                    "1MxTkeEP2PmHSMze5tUZ1hAV3YTKu2Gh1N"
                ]
            }
        }
    ]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-243">
<p>Unlike regular transactions, the coinbase transaction does not consume (spend) UTXO as inputs. Instead, it has only one input, called the <em>coinbase</em>, which creates bitcoin from nothing. The coinbase transaction has one output, payable to the miner&#8217;s own Bitcoin address. The output of the coinbase transaction sends the value of 25.09094928 bitcoin to the miner&#8217;s Bitcoin address; in this case it is 1MxTkeEP2PmHSMze5tUZ1hAV3YTKu2Gh1N.</p>
</div>
<div class="paragraph data-line-245">
<p>==== Recompensa da Coinbase e Taxas</p>
</div>
<div class="paragraph data-line-247">
<p>Para construir a transa√ß√£o coinbase, o n√≥ do Jing primeiro calcula a quantia total de taxas de transa√ß√£o ao somar todas as entradas e sa√≠das das 418 transa√ß√µes que foram adicionadas ao bloco. As taxas s√£o calculadas da seguinte forma:</p>
</div>
<div class="listingblock data-line-249">
<div class="content">
<pre>Total de Taxas = Soma(Entradas) ‚Äì Soma(Sa√≠das)</pre>
</div>
</div>
<div class="paragraph data-line-253">
<p>No bloco 277.316, o total de taxas de transa√ß√£o √© de 0,09094928 bitcoin.</p>
</div>
<div class="paragraph data-line-255">
<p>A seguir, o n√≥ do Jing calcula a recompensa correta para o novo bloco. A recompensa √© calculada com base na altura do bloco, iniciando em 50 bitcoins por bloco e reduzindo-a pela metade a cada 210.000 blocos. Como esse bloco est√° na altura 277.316, a recompensa correta √© de 25 bitcoins.</p>
</div>
<div class="paragraph data-line-257">
<p>O c√°lculo pode ser visto na fun√ß√£o GetBlockSubsidy no cliente Bitcoin Core, como demonstrado no <a href="#getblocksubsidy_source">Calculando a recompensa do bloco&#x2014;Fun√ß√£o GetBlockSubsidy, Cliente Bitcoin Core, main.cpp</a>.</p>
</div>
<div id="getblocksubsidy_source" class="exampleblock data-line-261">
<div class="title">Example 26. Calculando a recompensa do bloco&#x2014;Fun√ß√£o GetBlockSubsidy, Cliente Bitcoin Core, main.cpp</div>
<div class="content">
<div class="listingblock c_less_space data-line-264">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">CAmount GetBlockSubsidy(int nHeight, const Consensus::Params&amp; consensusParams)
{
    int halvings = nHeight / consensusParams.nSubsidyHalvingInterval;
    // For√ßa a recompensa do bloco para zero quando o deslocamento para a direita for indefinido
    if (halvings &gt;= 64)
        return 0;

    CAmount nSubsidy = 50 * COIN;
    // O subs√≠dio √© cortado pela metade a cada 210.000 blocos, o que acontecer√°, em m√©dia, a cada 4 anos.
    nSubsidy &gt;&gt;= halvings;
    return nSubsidy;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-280">
<p>O subs√≠dio inicial √© calculado em satoshis ao se multiplicar 50 pela constante COIN (100.000.000 satoshis). Isso define a recompensa inicial (nSubsidy) como 5 bilh√µes de satoshis.</p>
</div>
<div class="paragraph data-line-282">
<p>Em seguida, a fun√ß√£o calcula o n√∫mero de halvings  (redu√ß√µes pela metade no subs√≠dio) que ocorreram dividindo a altura do bloco atual pelo intervalo de <em>halving</em> (SubsidyHalvingInterval). No caso do bloco 277.316, com um intervalo de <em>halving</em> a cada 210.000 blocos, o resultado √© 1 <em>halving</em> (uma redu√ß√£o pela metade).</p>
</div>
<div class="paragraph data-line-284">
<p>O n√∫mero m√°ximo permitido de <em>halvings</em> √© de 64, ent√£o o c√≥digo imp√µe uma recompensa zero (retorna apenas as taxas) se as 64 <em>halvings</em> forem excedidas.</p>
</div>
<div class="paragraph data-line-286">
<p>Em seguida, a fun√ß√£o usa o operador de deslocamento bin√°rio √† direita para dividir a recompensa (nSubsidy) por dois a cada rodada de <em>halving</em>. No caso do bloco 277.316, isso faria um deslocamento bin√°rio √† direita da recompensa de 5 bilh√µes de satoshis uma vez (um <em>halving</em>), o que resultaria em 2,5 bilh√µes de satoshis, ou 25 bitcoins. O operador de deslocamento bin√°rio √† direita √© usado porque ele √© mais eficiente do que se fazer v√°rias divis√µes repetidas. Para evitar um bug potencial, a opera√ß√£o de deslocamento √© pulada ap√≥s 63 <em>halvings</em>, e a recompensa passa a ser definida como 0.</p>
</div>
<div class="paragraph data-line-288">
<p>Finalmente, a recompensa coinbase (nSubsidy) √© adicionada √†s taxas de transa√ß√£o (nFees), e retorna-se o valor da soma.</p>
</div>
<div class="admonitionblock tip data-line-291">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-292">
<p>Se o n√≥ de minera√ß√£o do Jing cria a transa√ß√£o coinbase, o que impede o Jing de se "auto-recompensar" com 100 ou 1.000 bitcoins? A resposta √© que uma recompensa incorreta resultaria no bloco sendo considerado inv√°lido por todos os outros n√≥s da rede, o que acabaria desperdi√ßando toda a eletricidade que o Jing usou para a Prova-de-Trabalho. O Jing s√≥ consegue gastar a recompensa se o seu bloco for aceito por todos os n√≥s da rede.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-295">
<p>==== Estrutura da Transa√ß√£o Coinbase</p>
</div>
<div class="paragraph data-line-297">
<p>Com esses c√°lculos, o n√≥ do Jing constr√≥i ent√£o a transa√ß√£o coinbase para pagar a si pr√≥prio 25,09094928 bitcoins.</p>
</div>
<div class="paragraph data-line-299">
<p>Como voc√™ pode ver no <a href="#generation_tx_example">Transa√ß√£o coinbase</a>, a transa√ß√£o coinbase possui um formato especial. Ao inv√©s de ter uma entrada de transa√ß√£o especificando uma UTXO pr√©via para ser gasta, ela possui uma entrada "coinbase". J√° examinamos as entradas de transa√ß√£o na <a href="#tx_in_structure">Serializa√ß√£o da entrada de transa√ß√£o</a>. Agora vamos comparar uma entrada de uma transa√ß√£o comum com uma entrada de uma transa√ß√£o coinbase. A <a href="#table_8-1">A estrutura de uma entrada de uma transa√ß√£o "normal"</a> demonstra a estrutura de uma entrada de uma transa√ß√£o comum, enquanto a <a href="#table_8-2">A estrutura de uma entrada de uma transa√ß√£o coinbase</a> demonstra a estrutura de uma entrada de uma transa√ß√£o coinbase.</p>
</div>
<table id="table_8-1" class="tableblock frame-all grid-all stretch data-line-304">
<caption class="title">Table 27. A estrutura de uma entrada de uma transa√ß√£o "normal"</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tamanho</th>
<th class="tableblock halign-left valign-top">Campo</th>
<th class="tableblock halign-left valign-top">Descri√ß√£o</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hash da Transa√ß√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apontador para a transa√ß√£o contendo a UTXO a ser gasta</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">√çndice da Sa√≠da</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O n√∫mero √≠ndice da UTXO a ser gasta, o primeiro √© 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1&#x2013;9 bytes (VarInt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tamanho do Script de Destravamento</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comprimento em bytes do Script de Destravamento</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vari√°vel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Script de Destravamento</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Um script que preenche as condi√ß√µes necess√°rias para o script de travamento da UTXO</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N√∫mero Sequencial</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Geralmente definido como 0xFFFFFFFF para excluir a BIP-125 e a BIP-68</p></td>
</tr>
</tbody>
</table>
<table id="table_8-2" class="tableblock frame-all grid-all stretch data-line-316">
<caption class="title">Table 28. A estrutura de uma entrada de uma transa√ß√£o coinbase</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tamanho</th>
<th class="tableblock halign-left valign-top">Campo</th>
<th class="tableblock halign-left valign-top">Descri√ß√£o</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hash da Transa√ß√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Todos os bits s√£o "0": N√£o √© uma refer√™ncia a um hash de transa√ß√£o</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">√çndice da Sa√≠da</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Todos os bits s√£o "1": 0xFFFFFFFF</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1&#x2013;9 bytes (VarInt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tamanho dos Dados Coinbase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comprimento dos dados coinbase, de 2 a 100 bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vari√°vel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dados Coinbase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dados arbitr√°rios usados para o nonce extra e tags de minera√ß√£o. Em blocos da v2, deve come√ßar com a altura do bloco</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N√∫mero Sequencial</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definido como 0xFFFFFFFF</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-325">
<p>Em uma transa√ß√£o coinbase, os dois primeiros campos s√£o definidos para valores que n√£o representam uma refer√™ncia a uma UTXO. Ao inv√©s de ter um "hash da transa√ß√£o", o primeiro campo √© preenchido com 32 bytes, todos definidos como zero. O "√≠ndice da sa√≠da" √© preenchido com 4 bytes, todos definidos como 0xFF (255 em decimais). O "Script de Destravamento" (scriptSig) √© substitu√≠do pelos dados coinbase, que √© um campo de dados usado pelos mineradores, como veremos a seguir.</p>
</div>
<div class="paragraph data-line-327">
<p>==== Dados Coinbase</p>
</div>
<div class="paragraph data-line-329">
<p>As transa√ß√µes coinbase n√£o t√™m um campo de script de destravamento (tamb√©m conhecido como scriptSig). Em vez disso, este campo √© substitu√≠do pelos dados coinbase, que devem ter entre 2 e 100 bytes. Exceto pelos primeiros bytes, os demais bytes dos dados coinbase podem ser usados pelos mineradores da maneira que quiserem; s√£o dados arbitr√°rios.</p>
</div>
<div class="paragraph data-line-331">
<p>No bloco g√™nese, por exemplo, Satoshi Nakamoto adicionou nos dados coinbase o texto "<em>The Times 03/Jan/2009 Chancellor on brink of second bailout for banks</em>" (em portugu√™s, "The Times 03/Jan/2009 Chanceler prestes a conceder segundo resgate aos bancos"), usando isso como prova da data em que o primeiro bloco foi gerado, e tamb√©m para passar uma mensagem. Atualmente os mineradores usam os dados coinbase para incluir valores extras de nonce e <em>strings</em> identificando a pool de minera√ß√£o.</p>
</div>
<div class="paragraph data-line-333">
<p>Antigamente os primeiros bytes da coinbase costumavam ser arbitr√°rios. Atualmente, desde a BIP-34, os blocos da vers√£o 2 (blocos com o campo de vers√£o definido como 2) devem conter o √≠ndice da altura do bloco como uma opera√ß√£o "push" de script no in√≠cio do campo dos dados coinbase.</p>
</div>
<div class="paragraph data-line-335">
<p>No bloco 277.316, vemos que a coinbase (ver o <a href="#generation_tx_example">Transa√ß√£o coinbase</a>), que est√° no script de destravamento ou no campo scriptSig da entrada da transa√ß√£o, cont√©m o valor hexadecimal 03443b0403858402062f503253482f. Vamos decodificar esse valor.</p>
</div>
<div class="paragraph data-line-337">
<p>O primeiro byte, 03, instrui o motor de execu√ß√£o do script a adicionar os pr√≥ximos tr√™s bytes no stack do script (ver a <a href="#tx_script_ops_table_pushdata">Operadores que adicionam valores no stack</a>). Os pr√≥ximos tr√™s bytes, 0x443b04, s√£o a altura do bloco codificada no formato little-endian (em sentido contr√°rio, com o byte menos significativo primeiro). Inverta a ordem dos bytes e o resultado ser√° 0x043b44, que √© 277.316 em decimais.</p>
</div>
<div class="paragraph data-line-339">
<p>Os pr√≥ximos poucos d√≠gitos hexadecimais (03858402062) s√£o usados para codificar um <em>nonce</em> extra (ver <a href="#extra_nonce">[extra_nonce]</a>), ou um valor aleat√≥rio, usado para achar uma solu√ß√£o adequada para a Prova-de-Trabalho.</p>
</div>
<div class="paragraph data-line-341">
<p>A parte final dos dados coinbase (2f503253482f) √© a <em>string</em> codificada em ASCII <span class="keep-together"><code>/P2SH/</code></span>, que indica que o n√≥ minerador que minerou esse bloco oferece suporte para a melhoria P2SH definida na BIP-16. Na √©poca em que a funcionalidade P2SH foi introduzida, os mineradores tiveram que sinalizar se eles estavam apoiando a BIP-16 ou a BIP-17. Aqueles que apoiavam a implementa√ß√£o da BIP-16 deveriam incluir a <em>string</em> /P2SH/ nos seus dados coinbase. Aqueles que apoiavam a implementa√ß√£o da BIP-17 deveriam incluir a <em>string</em> p2sh/CHV nos seus dados coinbase. Por fim, a BIP-16 acabou sendo eleita como a vencedora, e muitos mineradores continuaram a incluir a <em>string</em> /P2SH/ em seus dados coinbase para indicar que eles oferecem suporte para essa funcionalidade.</p>
</div>
<div class="paragraph data-line-343">
<p>O <a href="#satoshi_words">Extra√ß√£o dos dados coinbase do bloco g√™nese</a> usa a biblioteca libbitcoin apresentada em <a href="#alt_libraries">[alt_libraries]</a> para extrair os dados coinbase do bloco g√™nese, exibindo a mensagem do Satoshi. Como a biblioteca libbitcoin cont√©m uma c√≥pia est√°tica do bloco g√™nese, o c√≥digo de exemplo pode adquirir o bloco g√™nese diretamente da biblioteca.</p>
</div>
<div id="satoshi_words" class="exampleblock data-line-347">
<div class="title">Example 27. Extra√ß√£o dos dados coinbase do bloco g√™nese</div>
<div class="content">
<div class="listingblock data-line-349">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">Unresolved directive in for_use_mastering-bitcoin_chapter-10_pt_BR.adoc - include::code/satoshi-words.cpp[]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-354">
<p>Compilamos o c√≥digo com o compilador GNU de C++ e rodamos o execut√°vel resultante, como demonstrado no <a href="#satoshi_words_run">Compilando e executando o c√≥digo de exemplo satoshi-words</a>.</p>
</div>
<div id="satoshi_words_run" class="exampleblock data-line-358">
<div class="title">Example 28. Compilando e executando o c√≥digo de exemplo satoshi-words</div>
<div class="content">
<div class="listingblock data-line-360">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># Compila o c√≥digo
$  g++ -o satoshi-words satoshi-words.cpp $(pkg-config --cflags --libs libbitcoin)
# Roda o execut√°vel
$ ./satoshi-words
^DÔøΩÔøΩ&lt;GS&gt;^A^DEThe Times 03/Jan/2009 Chancellor on brink of second bailout for banks</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-369">
<p>=== Construindo o Cabe√ßalho do Bloco</p>
</div>
<div class="paragraph data-line-371">
<p>Para construir o cabe√ßalho do bloco, o n√≥ minerador precisa preench√™-lo em seis campos, conforme listados na <a href="#block_header_structure_ch10">A estrutura do cabe√ßalho do bloco</a>.</p>
</div>
<table id="block_header_structure_ch10" class="tableblock frame-all grid-all stretch data-line-376">
<caption class="title">Table 29. A estrutura do cabe√ßalho do bloco</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tamanho</th>
<th class="tableblock halign-left valign-top">Campo</th>
<th class="tableblock halign-left valign-top">Descri√ß√£o</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vers√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Um n√∫mero de vers√£o para monitorar atualiza√ß√µes de software/protocolo.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hash do Bloco Anterior</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uma refer√™ncia ao hash do bloco anterior (bloco pai) na blockchain</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Raiz de Merkle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Um hash da raiz da √°rvore de merkle das transa√ß√µes desse bloco</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data e Hora (timestamp)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O momento aproximado em que este bloco foi criado (em segundos decorridos desde a √âpoca Unix)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alvo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O alvo do algoritmo de Prova-de-Trabalho para este bloco</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nonce</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Um contador usado para o algoritmo de Prova-de-Trabalho</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-386">
<p>No momento em que o bloco 277.316 foi minerado, o n√∫mero de vers√£o descrevendo a estrutura do bloco era a vers√£o 2, que √© codificada no formato <em>little-endian</em> em 4 bytes como 0x02000000.</p>
</div>
<div class="paragraph data-line-388">
<p>A seguir, o n√≥ de minera√ß√£o precisa adicionar o "Hash do Bloco Anterior" (tamb√©m conhecido como prevhash). Esse √© o hash do cabe√ßalho do bloco 277.315, o bloco previamente recebido da rede, que o n√≥ do Jing aceitou e selecionou como sendo o bloco <em>pai</em> do bloco candidato 277.316. O hash do cabe√ßalho do bloco para o bloco 277.315 √©:</p>
</div>
<div class="listingblock data-line-390">
<div class="content">
<pre>0000000000000002a7bbd25a417c0374cc55261021e8a9ca74442b01284f0569</pre>
</div>
</div>
<div class="admonitionblock tip data-line-395">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-396">
<p>Ao selecionar o bloco <em>pai</em> espec√≠fico, indicado pelo campo Hash do Bloco Anterior no cabe√ßalho do bloco candidato, o Jing est√° dedicando seu poder de minera√ß√£o para estender a cadeia que termina naquele bloco espec√≠fico. Em ess√™ncia, √© assim que o Jing "vota", usando seu poder de minera√ß√£o, na cadeia v√°lida de maior dificuldade.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-399">
<p>O pr√≥ximo passo √© fazer um resumo de todas as transa√ß√µes com uma √°rvore de merkle, para adicionar a raiz de merkle ao cabe√ßalho do bloco. A transa√ß√£o coinbase √© listada como a primeira transa√ß√£o no bloco. A seguir, mais 418 transa√ß√µes s√£o adicionadas ap√≥s a transa√ß√£o coinbase, totalizando 419 transa√ß√µes no bloco. Conforme vimos em <a href="#merkle_trees">[merkle_trees]</a>, deve haver um n√∫mero par de n√≥s "folhas" na √°rvore, portanto, a √∫ltima transa√ß√£o √© duplicada, criando 420 n√≥s, cada um contendo o hash de uma transa√ß√£o. Os hashes das transa√ß√µes s√£o ent√£o combinados, em pares, criando cada n√≠vel da √°rvore, at√© que todas as transa√ß√µes sejam resumidas em um n√≥ √∫nico na "raiz" da √°rvore. A raiz da √°rvore de merkle resume todas as transa√ß√µes em um valor √∫nico de 32 bytes, que voc√™ pode ver listado como "raiz de merkle" ("<em>merkle root</em>") em <a href="#block277316">Usando a linha de comando para recuperar o bloco 277.316</a>, e abaixo:</p>
</div>
<div class="listingblock data-line-401">
<div class="content">
<pre>c91c008c26e50763e9f548bb8b2fc323735f73577effbc55502c51eb4cc7cf2e</pre>
</div>
</div>
<div class="paragraph data-line-405">
<p>Depois disso, o n√≥ de minera√ß√£o do Jing adicionar√° um carimbo de data e hora de 4 bytes, codificado como um <em>timestamp</em> de √âpoca Unix, que √© baseado no n√∫mero de segundos decorridos desde a meia-noite UTC de quinta-feira, 1¬∫ de janeiro de 1970. O valor 1388185914 corresponde a sexta-feira, 27 de dezembro de 2013, 23:11:54 UTC.</p>
</div>
<div class="paragraph data-line-407">
<p>A seguir, o n√≥ do Jing preenche o alvo, que define a Prova-de-Trabalho necess√°ria para tornar esse bloco v√°lido. O alvo √© armazenado no bloco utilizando-se a m√©trica "bits alvo" ("<em>target bits</em>"), que √© uma codifica√ß√£o mantissa-expoente do alvo. A codifica√ß√£o tem um expoente de 1 byte, seguido por uma mantissa (um coeficiente) de 3 bytes. No bloco 277.316, por exemplo, o valor dos bits alvo √© 0x1903a30c. A primeira parte 0x19 √© um expoente hexadecimal, enquanto a segundo parte, 0x03a30c, √© o coeficiente. O conceito de um alvo √© explicado em <a href="#target">[target]</a> e a representa√ß√£o "bits alvo" √© explicada em <a href="#target_bits">[target_bits]</a>.</p>
</div>
<div class="paragraph data-line-409">
<p>O √∫ltimo campo √© o nonce, que √© inicializado em zero.</p>
</div>
<div class="paragraph data-line-411">
<p>Com todos os outros campos preenchidos, o cabe√ßalho do bloco agora est√° completo e o processo de minera√ß√£o pode come√ßar. O objetivo agora √© encontrar um valor para o nonce que resulte em um hash de cabe√ßalho de bloco menor ou igual ao alvo. O n√≥ de minera√ß√£o ter√° que testar bilh√µes ou trilh√µes de valores de nonce at√© encontrar um nonce que satisfa√ßa essa exig√™ncia.</p>
</div>
<div class="paragraph data-line-413">
<p>=== Minerando o Bloco</p>
</div>
<div class="paragraph data-line-415">
<p>Now that a candidate block has been constructed by Jing&#8217;s node, it is time for Jing&#8217;s hardware mining rig to "mine" the block, to find a solution to the Proof-of-Work algorithm that makes the block valid. Throughout this book we have studied cryptographic hash functions as used in various aspects of the Bitcoin system. The hash function SHA256 is the function used in bitcoin&#8217;s mining process.</p>
</div>
<div class="paragraph data-line-417">
<p>Explicando de maneira simples, a minera√ß√£o √© o processo no qual se submete o cabe√ßalho do bloco a uma fun√ß√£o de hash de maneira repetida, at√© que o hash resultante corresponda a um alvo espec√≠fico. Os resultados da fun√ß√£o de hash n√£o podem ser determinados com anteced√™ncia, e n√£o √© poss√≠vel criar um padr√£o que produzir√° um valor de hash espec√≠fico. Essa caracter√≠stca das fun√ß√µes de hash faz com que a √∫nica maneira de se produzir um resultado de hash que corresponde a um alvo espec√≠fico seja atrav√©s de sucessivas tentativas, modificando aleatoriamente os dados que alimentam a fun√ß√£o (conhecidos como a entrada ou <em>input</em> da fun√ß√£o) at√© que o hash resultante desejado apare√ßa por acaso.</p>
</div>
<div class="paragraph data-line-419">
<p>==== Algoritmo de Prova-de-Trabalho</p>
</div>
<div class="paragraph data-line-421">
<p>Um algoritmo de hash pega uma entrada (um <em>input</em>) de dados de comprimento arbitr√°rio e produz como sa√≠da um resultado determin√≠stico de comprimento fixo, que √© uma impress√£o digital da entrada. Para cada entrada espec√≠fica, o hash resultante sempre ser√° o mesmo e pode ser facilmente calculado e verificado por qualquer pessoa que implementar o mesmo algoritmo de hash. A caracter√≠stica-chave de um algoritmo de hash criptogr√°fico √© que √© computacionalmente invi√°vel encontrar duas entradas diferentes que produzam a mesma impress√£o digital (o que √© conhecido como uma <em>colis√£o</em>). Consequentemente, tamb√©m √© virtualmente imposs√≠vel selecionar-se uma entrada de uma maneira a produzir uma impress√£o digital desejada, a menos que se fique tentando usar entradas aleat√≥rias.</p>
</div>
<div class="paragraph data-line-423">
<p>Com a fun√ß√£o de hash SHA256, a sa√≠da (o resultado) da fun√ß√£o sempre tem 256 bits de comprimento, independente do tamanho da entrada. No <a href="#sha256_example1">Exemplo de SHA256</a>, usaremos o int√©rprete Python para calcular o hash SHA256 da frase, "I am Satoshi Nakamoto".</p>
</div>
<div id="sha256_example1" class="exampleblock data-line-427">
<div class="title">Example 29. Exemplo de SHA256</div>
<div class="content">
<div class="listingblock data-line-429">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ python</code></pre>
</div>
</div>
<div class="listingblock data-line-433">
<div class="content">
<pre class="highlight"><code class="language-pycon" data-lang="pycon">Python 3.7.3
&gt;&gt;&gt; import hashlib
&gt;&gt;&gt; hashlib.sha256(b"I am Satoshi Nakamoto").hexdigest()
'5d7c7ba21cbbcd75d14800b100252d5b428e5b1213d27c385bc141ca6b47989e'</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-441">
<p>O <a href="#sha256_example1">Exemplo de SHA256</a> demonstra o resultado ao se calcular o hash da frase "I am Satoshi Nakamoto": 5d7c7ba21cbbcd75d14800b100252d5b428e5b1213d27c385bc141ca6b47989e. Esse n√∫mero de 256 bits √© o <em>hash</em> ou o "<em>digest</em>" da frase e ele √© dependente de cada parte da frase. A adi√ß√£o de uma √∫nica letra, uma pontua√ß√£o ou qualquer outro caractere produzir√° um hash diferente.</p>
</div>
<div class="paragraph data-line-443">
<p>Agora, se mudarmos a frase, dever√≠amos ver hashes completamente diferentes. Vamos experimentar isso ao adicionar um n√∫mero ao final de nossa frase, usando o script Python simples no <a href="#sha256_example_generator">Script SHA256 para gerar muitos hashes atrav√©s de itera√ß√£o com um nonce</a>.</p>
</div>
<div id="sha256_example_generator" class="exampleblock data-line-447">
<div class="title">Example 30. Script SHA256 para gerar muitos hashes atrav√©s de itera√ß√£o com um nonce</div>
<div class="content">
<div class="listingblock c_less_space data-line-450">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">Unresolved directive in for_use_mastering-bitcoin_chapter-10_pt_BR.adoc - include::code/hash_example.py[]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-455">
<p>A execu√ß√£o desse exemplo produzir√° os hashes de v√°rias frases, que ser√£o diferentes devido √† adi√ß√£o de um n√∫mero no final do texto. Ao incrementar o n√∫mero, podemos obter hashes diferentes, como demonstrado no <a href="#sha256_example_generator_output">Sa√≠das SHA256 de um script usado para gerar muitos hashes atrav√©s de itera√ß√£o com um nonce</a>.</p>
</div>
<div id="sha256_example_generator_output" class="exampleblock data-line-459">
<div class="title">Example 31. Sa√≠das SHA256 de um script usado para gerar muitos hashes atrav√©s de itera√ß√£o com um nonce</div>
<div class="content">
<div class="listingblock data-line-461">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ python hash_example.py</code></pre>
</div>
</div>
<div class="listingblock data-line-465">
<div class="content">
<pre>I am Satoshi Nakamoto0 =&gt; a80a81401765c8eddee25df36728d732...
I am Satoshi Nakamoto1 =&gt; f7bc9a6304a4647bb41241a677b5345f...
I am Satoshi Nakamoto2 =&gt; ea758a8134b115298a1583ffb80ae629...
I am Satoshi Nakamoto3 =&gt; bfa9779618ff072c903d773de30c99bd...
I am Satoshi Nakamoto4 =&gt; bce8564de9a83c18c31944a66bde992f...
I am Satoshi Nakamoto5 =&gt; eb362c3cf3479be0a97a20163589038e...
I am Satoshi Nakamoto6 =&gt; 4a2fd48e3be420d0d28e202360cfbaba...
I am Satoshi Nakamoto7 =&gt; 790b5a1349a5f2b909bf74d0d166b17a...
I am Satoshi Nakamoto8 =&gt; 702c45e5b15aa54b625d68dd947f1597...
I am Satoshi Nakamoto9 =&gt; 7007cf7dd40f5e933cd89fff5b791ff0...
I am Satoshi Nakamoto10 =&gt; c2f38c81992f4614206a21537bd634a...
I am Satoshi Nakamoto11 =&gt; 7045da6ed8a914690f087690e1e8d66...
I am Satoshi Nakamoto12 =&gt; 60f01db30c1a0d4cbce2b4b22e88b9b...
I am Satoshi Nakamoto13 =&gt; 0ebc56d59a34f5082aaef3d66b37a66...
I am Satoshi Nakamoto14 =&gt; 27ead1ca85da66981fd9da01a8c6816...
I am Satoshi Nakamoto15 =&gt; 394809fb809c5f83ce97ab554a2812c...
I am Satoshi Nakamoto16 =&gt; 8fa4992219df33f50834465d3047429...
I am Satoshi Nakamoto17 =&gt; dca9b8b4f8d8e1521fa4eaa46f4f0cd...
I am Satoshi Nakamoto18 =&gt; 9989a401b2a3a318b01e9ca9a22b0f3...
I am Satoshi Nakamoto19 =&gt; cda56022ecb5b67b2bc93a2d764e75f...</pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-489">
<p>Cada frase produz um resultado de hash completamente diferente. Eles parecem ser completamente aleat√≥rios, mas voc√™ √© capaz de reproduzir exatamente os mesmos resultados desse exemplo em qualquer computador com Python e ver exatamente os mesmos hashes.</p>
</div>
<div class="paragraph data-line-491">
<p>O n√∫mero usado como uma vari√°vel em um cen√°rio deste tipo √© chamado de <em>nonce</em>. O nonce √© usado para variar o output de uma fun√ß√£o criptogr√°fica, nesse caso para variar a impress√£o digital da frase ao ser submetida ao algoritmo SHA256.</p>
</div>
<div class="paragraph data-line-493">
<p>Para fazer um desafio com esse algoritmo, vamos definir um alvo: encontrar uma frase que produza um hash hexadecimal que come√ßa com um zero. Felizmente, isso n√£o √© dif√≠cil! O <a href="#sha256_example_generator_output">Sa√≠das SHA256 de um script usado para gerar muitos hashes atrav√©s de itera√ß√£o com um nonce</a> demonstra que a frase "I am Satoshi Nakamoto13" produz o hash 0ebc56d59a34f5082aaef3d66b37a661696c2b618e62432727216ba9531041a5, que preenche nossos crit√©rios. Levamos 13 tentativas at√© encontr√°-lo. Em termos de probabilidades, se a sa√≠da da fun√ß√£o de hash for distribu√≠da igualmente, esperar√≠amos encontrar um resultado com um zero como prefixo hexadecimal uma vez a cada 16 hashes (um em cada 16 d√≠gitos hexadecimais, do 0 ao F). Em termos num√©ricos, isso significa encontrar um valor de hash que √© menor que 0x1000000000000000000000000000000000000000000000000000000000000000. Chamamos esse limiar de <em>alvo</em> e o objetivo √© encontrar um hash que √© numericamente menor ou igual ao alvo. Se diminuirmos o alvo, torna-se cada vez mais dif√≠cil a tarefa de encontrar um hash que √© menor que o alvo.</p>
</div>
<div class="paragraph data-line-495">
<p>Para fazer uma analogia simples, imagine um jogo onde os jogadores lan√ßam um par de dados repetidamente, tentando obter uma soma que seja menor ou igual a um alvo especificado. Na primeira rodada, o alvo da soma √© 11. A menos que voc√™ tire seis em ambos os dados, voc√™ ganha. Na pr√≥xima rodada o alvo √© 10. Os jogadores devem obter uma soma que seja menor ou igual a 10 para ganhar, o que tamb√©m √© uma tarefa f√°cil. Digamos que algumas rodadas mais tarde o alvo √© 5. Agora, mais da metade dos lan√ßamentos exceder√° o alvo e, portanto, ser√£o inv√°lidos. O n√∫mero de lan√ßamentos necess√°rios para se ganhar aumenta exponencialmente, quanto menor for o alvo. Por fim, quando o alvo for 2 (o menor poss√≠vel), somente um em cada 36 lan√ßamentos, ou 2% deles, produzir√° um resultado vencedor.</p>
</div>
<div class="paragraph data-line-497">
<p>Do ponto de vista de um observador que sabe que o alvo do jogo de dados √© 2, se algu√©m conseguiu obter um resultado vencedor ao lan√ßar os dados, pode-se presumir que a pessoa teve que lan√ßar os dados, em m√©dia, 36 vezes. Em outras palavras, √© poss√≠vel estimar-se a quantidade de trabalho necess√°ria para se ter sucesso a partir da dificuldade imposta pelo alvo. Quando o algoritmo √© baseado em uma fun√ß√£o determin√≠stica como a SHA256, o pr√≥prio input constitui uma <em>prova</em> de que uma certa quantidade de <em>trabalho</em> foi realizada para produzir um resultado menor ou igual ao alvo. Portanto, Prova-de-Trabalho (em ingl√™s, <em>Proof-of-Work</em>).</p>
</div>
<div class="admonitionblock tip data-line-500">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-501">
<p>Mesmo que cada tentativa produza um resultado aleat√≥rio, a probabilidade de se conseguir obter um resultado pode ser calculada antecipadamente. Portanto, um resultado com uma determinada dificuldade constitui prova de que uma determinada quantidade de trabalho foi realizada.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-504">
<p>No <a href="#sha256_example_generator_output">Sa√≠das SHA256 de um script usado para gerar muitos hashes atrav√©s de itera√ß√£o com um nonce</a>, o "nonce" vencedor √© 13 e esse resultado pode ser confirmado por qualquer pessoa de maneira independente. Qualquer um pode adicionar o n√∫mero 13 como sufixo da frase "I am Satoshi Nakamoto" e computar o hash, verificando que ele √© menor do que o alvo. A confirma√ß√£o desse resultado tamb√©m √© uma Prova-de-Trabalho, pois ela serve como prova de que n√≥s trabalhamos para encontrar esse nonce. Enquanto a verifica√ß√£o exige a computa√ß√£o de apenas um √∫nico hash, foi necess√°ria a computa√ß√£o de 13 hashes at√© que encontr√°ssemos um nonce que funcionasse. Se tiv√©ssemos um alvo menor (uma dificuldade maior), muitos mais hashes precisariam ser computados at√© se encontrar um nonce v√°lido, mas continuaria sendo necess√°ria a computa√ß√£o de apenas um √∫nico hash para verific√°-lo. Al√©m disso, qualquer pessoa que souber o alvo poder√° estimar a dificuldade usando estat√≠sticas, e, portanto, poder√° saber quanto de trabalho foi necess√°rio para se descobrir o "nonce" vencedor.</p>
</div>
<div class="admonitionblock tip data-line-507">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-508">
<p>A Prova-de-Trabalho deve produzir um hash <em>menor ou igual</em> ao alvo. Um alvo mais alto significa que √© menos dif√≠cil encontrar um hash que √© menor ou igual ao alvo. Um alvo mais baixo significa que √© mais dif√≠cil encontrar um hash que √© menor ou igual ao alvo. O alvo e a dificuldade est√£o inversamente relacionados.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-512">
<p>Bitcoin&#8217;s Proof-of-Work is very similar to the challenge shown in <a href="#sha256_example_generator_output">Sa√≠das SHA256 de um script usado para gerar muitos hashes atrav√©s de itera√ß√£o com um nonce</a>. The miner constructs a candidate block filled with transactions. Next, the miner calculates the hash of this block&#8217;s header and sees if it is equal to or smaller than the current <em>target</em>. If the hash is greater than the target, the miner will modify the nonce (usually just incrementing it by one) and try again. At the current difficulty in the Bitcoin network, miners have to try quadrillions of times before finding a nonce that results in a low enough block header hash.</p>
</div>
<div class="paragraph data-line-514">
<p>Um algoritmo muito simplificado de Prova-de-Trabalho √© implementado em Python no <a href="#pow_example1">Implementa√ß√£o de uma Prova-de-Trabalho simplificada</a>.</p>
</div>
<div id="pow_example1" class="exampleblock data-line-518">
<div class="title">Example 32. Implementa√ß√£o de uma Prova-de-Trabalho simplificada</div>
<div class="content">
<div class="listingblock data-line-520">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">Unresolved directive in for_use_mastering-bitcoin_chapter-10_pt_BR.adoc - include::code/proof-of-work-example.py[]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-525">
<p>Ao executar esse c√≥digo, voc√™ pode definir a dificuldade desejada (em bits, a quantidade de bits iniciais que devem ser zero) e ver quanto tempo leva para seu computador encontrar uma solu√ß√£o. No <a href="#pow_example_outputs">Executando o exemplo de Prova-de-Trabalho em diferentes dificuldades</a>, voc√™ pode ver como isso funciona em um laptop comum.</p>
</div>
<div id="pow_example_outputs" class="exampleblock data-line-529">
<div class="title">Example 33. Executando o exemplo de Prova-de-Trabalho em diferentes dificuldades</div>
<div class="content">
<div class="listingblock data-line-531">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ python proof-of-work-example.py*</code></pre>
</div>
</div>
<div class="listingblock data-line-535">
<div class="content">
<pre>Dificuldade: 1 (0 bits)

[...]

Dificuldade: 8 (3 bits)
Iniciando a busca...
Sucesso com o nonce 9
O hash √© 1c1c105e65b47142f028a8f93ddf3dabb9260491bc64474738133ce5256cb3c1
Tempo Decorrido: 0.0004 segundos
Poder de Hashing: 25065 hashes por segundo
Dificuldade: 16 (4 bits)
Iniciando a busca...
Sucesso com o nonce 25
O hash √© 0f7becfd3bcd1a82e06663c97176add89e7cae0268de46f94e7e11bc3863e148
Tempo Decorrido: 0.0005 segundos
Poder de Hashing: 52507 hashes por segundo
Dificuldade: 32 (5 bits)
Iniciando a busca...
Sucesso com o nonce 36
O hash √© 029ae6e5004302a120630adcbb808452346ab1cf0b94c5189ba8bac1d47e7903
Tempo Decorrido: 0.0006 segundos
Poder de Hashing: 58164 hashes por segundo

[...]

Dificuldade: 4194304 (22 bits)
Iniciando a busca...
Sucesso com o nonce 1759164
O hash √© 0000008bb8f0e731f0496b8e530da984e85fb3cd2bd81882fe8ba3610b6cefc3
Tempo Decorrido: 13.3201 segundos
Poder de Hashing: 132068 hashes por segundo
Dificuldade: 8388608 (23 bits)
Iniciando a busca...
Sucesso com o nonce 14214729
O hash √© 000001408cf12dbd20fcba6372a223e098d58786c6ff93488a9f74f5df4df0a3
Tempo Decorrido: 110.1507 segundos
Poder de Hashing: 129048 hashes por segundo
Dificuldade: 16777216 (24 bits)
Iniciando a busca...
Sucesso com o nonce 24586379
O hash √© 0000002c3d6b370fccd699708d1b7cb4a94388595171366b944d68b2acce8b95
Tempo Decorrido: 195.2991 segundos
Poder de Hashing: 125890 hashes por segundo

[...]

Dificuldade: 67108864 (26 bits)
Iniciando a busca...
Sucesso com o nonce 84561291
O hash √© 0000001f0ea21e676b6dde5ad429b9d131a9f2b000802ab2f169cbca22b1e21a
Tempo Decorrido: 665.0949 segundos
Poder de Hashing: 127141 hashes por segundo</pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-591">
<p>Como voc√™ pode ver, aumentar a dificuldade em um bit aumenta em duas vezes o tempo necess√°rio para se encontrar uma solu√ß√£o. Se voc√™ pensar em todo o espa√ßo num√©rico de 256 bits, cada vez que voc√™ restringe mais um bit a zero, voc√™ diminui o espa√ßo de busca pela metade. No <a href="#pow_example_outputs">Executando o exemplo de Prova-de-Trabalho em diferentes dificuldades</a>, s√£o necess√°rias 84 milh√µes de tentativas de hash para se encontrar um nonce que produza um hash cujos 26 bits iniciais sejam zero. Mesmo a uma velocidade de mais de 120.000 hashes por segundo, ainda s√£o necess√°rios 10 minutos para se encontrar essa solu√ß√£o em um notebook.</p>
</div>
<div class="paragraph data-line-593">
<p>No momento em que este livro estava sendo escrito, a rede estava tentando encontrar um bloco cujo hash do cabe√ßalho fosse menor ou igual a:</p>
</div>
<div class="listingblock data-line-595">
<div class="content">
<pre>0000000000000000029AB9000000000000000000000000000000000000000000</pre>
</div>
</div>
<div class="paragraph data-line-599">
<p>Como voc√™ pode ver, h√° muitos zeros no in√≠cio desse alvo, o que significa que o intervalo de hashes aceitos √© muito menor, e, portanto, √© mais dif√≠cil encontrar um hash v√°lido. Levar√° em m√©dia mais de 1,8 zetahashes (1,8 sextilh√µes de hashes) para a rede descobrir o pr√≥ximo bloco. Parece uma tarefa imposs√≠vel, mas felizmente a rede atualmente tem um poder de processamento de 3 exahashes por segundo (EH/s) (3 quintilh√µes de hashes/segundo), o que √© suficiente para encontrar um bloco a cada 10 minutos em m√©dia. </p>
</div>
<div id="target_bits" class="paragraph data-line-602">
<p>==== Representa√ß√£o do Alvo</p>
</div>
<div class="paragraph data-line-604">
<p>No <a href="#block277316">Usando a linha de comando para recuperar o bloco 277.316</a>, vimos que o bloco cont√©m o alvo, em uma nota√ß√£o chamada "bits alvo" ou simplesmente "bits", que no bloco 277.316 tinha o valor de 0x1903a30c. Essa nota√ß√£o expressa o alvo da Prova-de-Trabalho em um formato coeficiente/expoente, com os primeiros dois d√≠gitos hexadecimais sendo o expoente e os pr√≥ximos seis d√≠gitos hexadecimais sendo o coeficiente. Nesse bloco, portanto, o expoente √© 0x19 e o coeficiente √© 0x03a30c.</p>
</div>
<div class="paragraph data-line-606">
<p>A f√≥rmula para calcular o alvo de dificuldade a partir dessa representa√ß√£o √©:</p>
</div>
<ul class="simplelist">
  <li>alvo = coeficiente * 2<sup>(8*(expoente‚Äì3))</sup></li>
</ul>
<div class="paragraph data-line-614">
<p>Usando essa f√≥rmula, e o valor 0x1903a30c para os bits de dificuldade, obtemos:</p>
</div>
<ul class="simplelist">
  <li>alvo = 0x03a30c * 2<sup>0x08*(0x19-0x03)</sup></li>
  <li>=> alvo = 0x03a30c * 2<sup>(0x08*0x16)</sup></li>
  <li>=> alvo = 0x03a30c * 2<sup>0xB0</sup></li>
</ul>
<div class="paragraph data-line-624">
<p>que em decimal √©:</p>
</div>
<ul class="simplelist">
  <li>=> alvo = 238,348 * 2<sup>176</sup></li>
  <li>=> alvo = <br/>22,829,202,948,393,929,850,749,706,076,701,368,331,072,452,018,388,575,715,328</li>
</ul>
<div class="paragraph data-line-633">
<p>transformando de volta para hexadecimal:</p>
</div>
<ul class="simplelist">
  <li>=> alvo = <br/>0x0000000000000003A30C00000000000000000000000000000000000000000000</li>
</ul>
<div class="paragraph data-line-641">
<p>Isso significa que um bloco v√°lido para a altura 277.316 √© um bloco que tem um hash de cabe√ßalho de bloco que √© menor do que esse alvo. Em bin√°rios, esse n√∫mero deve ter mais do que 60 bits iniciais definidos como zero. Com esse n√≠vel de dificuldade, um √∫nico minerador processando 1 trilh√£o de hashes por segundo (1 terahash por segundo ou 1 TH/s) encontraria uma solu√ß√£o, em m√©dia, somente uma vez a cada 8.496 blocos ou uma vez a cada 59 dias.</p>
</div>
<div id="target" class="paragraph data-line-644">
<p>==== Reajustando o Alvo para Ajustar a Dificuldade</p>
</div>
<div class="paragraph data-line-646">
<p>Conforme vimos anteriormente, o alvo determina a dificuldade e, portanto, afeta o qu√£o demorado ser√° necess√°rio para encontrar uma solu√ß√£o para o algoritmo de Prova-de-Trabalho. Isso nos levanta algumas quest√µes √≥bvias: por que a dificuldade √© ajust√°vel? Quem a ajusta? Como ela √© ajustada?</p>
</div>
<div class="paragraph data-line-648">
<p>Os blocos do bitcoin s√£o gerados, em m√©dia, a cada 10 minutos. Essa √© a "frequ√™ncia card√≠aca" do bitcoin, que sustenta a frequ√™ncia da emiss√£o de moedas e a velocidade de confirma√ß√£o das transa√ß√µes. Ela tem que permanecer constante n√£o apenas a curto prazo, mas tamb√©m a prazos muito longos, como d√©cadas. Ao longo desse tempo, espera-se que o poder de processamento computacional continuar√° aumentando em um ritmo r√°pido. Al√©m disso, o n√∫mero de participantes na minera√ß√£o e os computadores que eles usam tamb√©m mudar√£o constantemente. Para manter o tempo de gera√ß√£o de blocos em 10 minutos, a dificuldade da minera√ß√£o precisa ser ajustada para contabilizar essas mudan√ßas. De fato, o alvo da Prova-de-Trabalho √© um par√¢metro din√¢mico que √© ajustado periodicamente para atingir a meta de um intervalo de 10 minutos entre cada bloco. Simplificando, o alvo √© definido de forma que o poder de minera√ß√£o atual resulte em um intervalo de 10 minutos entre a gera√ß√£o dos blocos.</p>
</div>
<div class="paragraph data-line-650">
<p>Como, ent√£o, tal ajuste √© feito em uma rede completamente descentralizada? O reajuste do alvo ocorre automaticamente e em cada n√≥ completo de maneira independente. A cada 2.016 blocos, todos os n√≥s reajustam o alvo da Prova-de-Trabalho. A equa√ß√£o para reajustar o alvo mede o tempo que foi necess√°rio para serem encontrados os √∫ltimos 2.016 blocos e o compara com o tempo esperado de 20.160 minutos (2.016 blocos vezes o intervalo de bloco desejado de 10 minutos). A raz√£o entre os per√≠odos de tempo atual e o desejado √© calculada, e um ajuste proporcional (para cima ou para baixo) √© feito ao alvo. Simplificando: se a rede estiver encontrando blocos em um ritmo mais r√°pido do que a cada 10 minutos, a dificuldade ir√° aumentar (o alvo ir√° diminuir). E se a descoberta de blocos estiver mais lenta do que o esperado, a dificuldade ir√° diminuir (o alvo ir√° aumentar).</p>
</div>
<div class="paragraph data-line-652">
<p>A equa√ß√£o pode ser resumida como:</p>
</div>
<div class="listingblock data-line-654">
<div class="content">
<pre>Novo Alvo = Alvo Antigo * (Tempo Necess√°rio para Encontrar os √öltimos 2.016 Blocos / 20.160 min.)</pre>
</div>
</div>
<div class="paragraph data-line-658">
<p>O <a href="#retarget_code">Reajustando o alvo da Prova-de-Trabalho&#x2014;CalculateNextWorkRequired() em pow.cpp</a> demonstra o c√≥digo usado no cliente Bitcoin Core.</p>
</div>
<div id="retarget_code" class="exampleblock data-line-662">
<div class="title">Example 34. Reajustando o alvo da Prova-de-Trabalho&#x2014;CalculateNextWorkRequired() em pow.cpp</div>
<div class="content">
<div class="listingblock data-line-664">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">   // Limita o passo de ajuste
    int64_t nActualTimespan = pindexLast-&gt;GetBlockTime() - nFirstBlockTime;
    LogPrintf("  nActualTimespan = %d  before bounds\n", nActualTimespan);
    if (nActualTimespan &lt; params.nPowTargetTimespan/4)
        nActualTimespan = params.nPowTargetTimespan/4;
    if (nActualTimespan &gt; params.nPowTargetTimespan*4)
        nActualTimespan = params.nPowTargetTimespan*4;

    //Reajusta o alvo
    const arith_uint256 bnPowLimit = UintToArith256(params.powLimit);
    arith_uint256 bnNew;
    arith_uint256 bnOld;
    bnNew.SetCompact(pindexLast-&gt;nBits);
    bnOld = bnNew;
    bnNew *= nActualTimespan;
    bnNew /= params.nPowTargetTimespan;

    if (bnNew &gt; bnPowLimit)
        bnNew = bnPowLimit;</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note data-line-690">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-691">
<p>Enquanto a calibragem do alvo acontece a cada 2.016 blocos, a exist√™ncia de um erro <em>off-by-one</em> (OBOE, "erro por um") no cliente Bitcoin Core original faz com que ela seja baseada no tempo total dos 2.015 blocos anteriores (e n√£o 2.016, como deveria ser), o que resulta em uma dificuldade 0,05% maior no reajuste do alvo.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-695">
<p>Os par√¢metros Interval (2.016 blocos) e TargetTimespan (duas semanas ou 1.209.600 segundos) s√£o definidos no arquivo <em>chainparams.cpp</em>.</p>
</div>
<div class="paragraph data-line-697">
<p>Para evitar uma volatilidade extrema na dificuldade, o reajuste do alvo deve ser menor do que um fator de quatro (4) por ciclo. Se o ajuste de alvo necess√°rio √© maior do que um fator de quatro, ele ser√° ajustado pelo fator de quatro, e n√£o mais do que isso. Qualquer ajuste adicional ser√° realizado no pr√≥ximo per√≠odo de reajuste do alvo, pois o desequil√≠brio persistir√° durante os pr√≥ximos 2.016 blocos. Portanto, grandes discrep√¢ncias entre o poder de <em>hashing</em> e a dificuldade podem levar v√°rios ciclos de 2.016 blocos para se equilibrarem.</p>
</div>
<div class="admonitionblock tip data-line-700">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-701">
<p>A dificuldade de se minerar um bloco de bitcoin √© de aproximadamente "10 minutos de processamento" para toda a rede, e baseia-se no tempo que foi necess√°rio para serem encontrados os √∫ltimos 2.016 blocos, sendo ajustada a cada 2.016 blocos. E esse ajuste da dificuldade √© feito atrav√©s da redu√ß√£o ou da eleva√ß√£o do alvo.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-704">
<p>Perceba que o alvo √© independente do n√∫mero de transa√ß√µes ou do valor das transa√ß√µes. Isso significa que tanto o alvo do poder de <em>hashing</em> quanto a eletricidade gasta para manter a seguran√ßa da rede bitcoin tamb√©m s√£o totalmente independentes do n√∫mero de transa√ß√µes. O bitcoin pode acomodar mais transa√ß√µes, atingir uma ado√ß√£o maior e se manter seguro sem que seja necess√°rio nenhum aumento no poder de <em>hashing</em> que j√° existe hoje. O aumento no poder de <em>hashing</em> representa as for√ßas do mercado √† medida que novos mineradores entram no mercado para competir pela recompensa. Enquanto houver um poder de <em>hashing</em> suficiente sob o controle de mineradores agindo honestamente em busca da recompensa, ele ser√° suficiente para prevenir ataques de "tomada de controle" ("<em>takeover</em>") e, portanto, ser√° suficiente para manter o bitcoin seguro.</p>
</div>
<div class="paragraph data-line-706">
<p>A dificuldade de minera√ß√£o est√° intimamente relacionada com o custo da eletricidade e a taxa de c√¢mbio do bitcoin na moeda usada para pagar pela eletricidade. Os sistemas de minera√ß√£o de alto desempenho tem a maior efici√™ncia poss√≠vel da gera√ß√£o atual de fabrica√ß√£o de sil√≠cio, convertendo a eletricidade em computa√ß√£o de hashes na taxa mais alta poss√≠vel. A principal influ√™ncia no mercado de minera√ß√£o √© o pre√ßo de um kilowatt-hora de eletricidade em bitcoin, porque ele determina a rentabilidade da minera√ß√£o e, portanto, os incentivos para se entrar ou sair do mercado de minera√ß√£o.</p>
</div>
<div class="paragraph data-line-708">
<p>=== Minerando um Bloco com Sucesso</p>
</div>
<div class="paragraph data-line-710">
<p>Conforme vimos anteriormente, o n√≥ do Jing construiu um bloco candidato e preparou-o para ser minerado. O Jing possui v√°rios equipamentos de minera√ß√£o em hardware com circuitos integrados de aplica√ß√£o espec√≠fica (ASICs), nos quais centenas de milhares de circuitos integrados executam em paralelo o algoritmo SHA256 a velocidades incr√≠veis. Muitas dessas m√°quinas especializadas s√£o conectadas ao seu n√≥ de minera√ß√£o atrav√©s de uma porta USB ou de uma rede local. A seguir, o n√≥ de minera√ß√£o sendo executado no desktop do Jing transmite o cabe√ßalho do bloco para seu hardware de minera√ß√£o, que come√ßa a testar trilh√µes de nonces por segundo. Como o nonce tem apenas 32 bits, depois de esgotar todos os nonces poss√≠veis (cerca de 4 bilh√µes), o hardware de minera√ß√£o altera o cabe√ßalho do bloco (ajustando o espa√ßo extra do nonce ou o <em>timestamp</em> da coinbase) e reinicia o contador de nonces, testando novas combina√ß√µes.</p>
</div>
<div class="paragraph data-line-712">
<p>Quase 11 minutos depois de come√ßar a minerar o bloco 277.316, uma das m√°quinas de minera√ß√£o encontra uma solu√ß√£o e a envia de volta ao n√≥ de minera√ß√£o.</p>
</div>
<div class="paragraph data-line-714">
<p>Quando inserido no cabe√ßalho do bloco, o nonce 924.591.752 produz o seguinte hash de bloco:</p>
</div>
<div class="listingblock data-line-716">
<div class="content">
<pre>0000000000000001b6b9a13b095e96db41c4a928b97ef2d944a9b31b2cc7bdc4</pre>
</div>
</div>
<div class="paragraph data-line-720">
<p>que √© menor do que o alvo:</p>
</div>
<div class="listingblock data-line-722">
<div class="content">
<pre>0000000000000003A30C00000000000000000000000000000000000000000000</pre>
</div>
</div>
<div class="paragraph data-line-726">
<p>Imediatamente, o n√≥ de minera√ß√£o do Jing transmite o bloco para todos os seus pares (n√≥s com os quais ele est√° conectado). Eles recebem, validam e ent√£o propagam o novo bloco. √Ä medida que o bloco √© disseminado na rede, cada n√≥ o adiciona √† sua pr√≥pria c√≥pia da blockchain, estendendo-a para uma nova altura de 277.316 blocos. Conforme os n√≥s de minera√ß√£o v√£o recebendo e validando o bloco, eles deixam de tentar encontrar um bloco com a mesma altura e imediatamente passam a computar o pr√≥ximo bloco na cadeia, usando o bloco do Jing como bloco "pai". Ao trabalharem para acrescentar um bloco sobre o bloco rec√©m-descoberto do Jing, os outros mineradores est√£o essencialmente "votando" com seu poder de minera√ß√£o, endossando o bloco do Jing e a cadeia que ele estende.</p>
</div>
<div class="paragraph data-line-728">
<p>Na pr√≥xima se√ß√£o, aprenderemos sobre o processo que cada n√≥ usa para validar um bloco e selecionar a cadeia mais longa, criando o consenso que forma a cadeia de blocos (blockchain) descentralizada.</p>
</div>
<div class="paragraph data-line-730">
<p>=== Validando um Novo Bloco</p>
</div>
<div class="paragraph data-line-732">
<p>O terceiro passo no mecanismo de consenso do bitcoin √© a valida√ß√£o independente de cada bloco novo, que √© realizada por cada n√≥ da rede. √Ä medida que os blocos rec√©m-criados s√£o propagados pela rede, cada n√≥ realiza uma s√©rie de testes para valid√°-los antes de propag√°-los para seus pares. Isso garante que somente blocos v√°lidos ser√£o propagados na rede. A valida√ß√£o independente tamb√©m garante que os mineradores que agirem honestamente ter√£o seus blocos incorporados na blockchain, e, portanto, receber√£o sua recompensa. Os mineradores que agirem desonestamente ter√£o seus blocos rejeitados e n√£o apenas perder√£o sua recompensa, como tamb√©m ter√£o desperdi√ßado o esfor√ßo despendido para encontrar uma solu√ß√£o de Prova-de-Trabalho, ou seja, ter√£o gasto com energia el√©trica sem obter nenhuma compensa√ß√£o.</p>
</div>
<div class="paragraph data-line-734">
<p>Quando um n√≥ recebe um bloco novo, ele validar√° o bloco ao verific√°-lo contra uma longa lista de crit√©rios que precisam ser preenchidos; caso contr√°rio, o bloco ser√° rejeitado. Esses crit√©rios podem ser vistos nas fun√ß√µes CheckBlock e CheckBlockHeader do cliente Bitcoin Core, e incluem:</p>
</div>
<div class="ulist data-line-736">
<ul>
<li class="data-line-736">
<p>A estrutura de dados do bloco √© sintaticamente v√°lida</p>
</li>
<li class="data-line-737">
<p>O hash do cabe√ßalho do bloco √© menor ou igual ao alvo (imp√µe a Prova-de-Trabalho)</p>
</li>
<li class="data-line-738">
<p>A data e hora no timestamp do bloco √© menor do que duas horas no futuro (permitindo erros de hor√°rio)</p>
</li>
<li class="data-line-739">
<p>O tamanho do bloco est√° dentro dos limites aceit√°veis</p>
</li>
<li class="data-line-740">
<p>A primeira transa√ß√£o (e somente a primeira) √© uma transa√ß√£o coinbase</p>
</li>
<li class="data-line-741">
<p>Todas as transa√ß√µes contidas no bloco s√£o v√°lidas usando o <em>checklist</em> de transa√ß√µes discutido em <a href="#tx_verification">[tx_verification]</a></p>
</li>
</ul>
</div>
<div class="paragraph data-line-743">
<p>A valida√ß√£o independente de cada bloco novo feita por todos os n√≥s da rede garante que os mineradores n√£o possam trapacear. Nas se√ß√µes anteriores, vimos como os mineradores conseguem criar uma transa√ß√£o que os recompensa com os novos bitcoins criados no bloco e como eles recebem as taxas de transa√ß√£o. Mas por que os mineradores n√£o criam para eles pr√≥prios uma transa√ß√£o com mil bitcoins de recompensa, ao inv√©s de usar a recompensa correta? Porque todos os n√≥s validam os blocos de acordo com as mesmas regras. Uma transa√ß√£o coinbase inv√°lida tornaria inv√°lido todo o bloco, o que resultaria em um bloco sendo rejeitado e, portanto, a transa√ß√£o jamais seria inclu√≠da na blockchain. Os mineradores tem que construir um bloco perfeito, baseado nas regras compartilhadas que todos os n√≥s seguem, e miner√°-lo com uma solu√ß√£o correta para a Prova-de-Trabalho. Para fazer isso, eles gastam muita energia el√©trica na minera√ß√£o, e se eles trapacearem, todos os seus gastos com energia el√©trica e todos os seus esfor√ßos ser√£o desperdi√ßados. Esse √© o motivo pelo qual a valida√ß√£o independente √© um componente-chave do consenso descentralizado.</p>
</div>
<div class="paragraph data-line-745">
<p>=== Montando e Selecionando Cadeias de Blocos</p>
</div>
<div class="paragraph data-line-747">
<p>A etapa final no mecanismo de consenso descentralizado do bitcoin √© a uni√£o dos blocos em cadeias e a sele√ß√£o da cadeia que tem a maior Prova-de-Trabalho. Assim que um n√≥ validar um novo bloco, ele tentar√° montar uma cadeia conectando o bloco √† blockchain existente.</p>
</div>
<div class="paragraph data-line-749">
<p>Os n√≥s mant√™m tr√™s conjuntos de blocos: aqueles conectados √† blockchain principal, aqueles que formam ramifica√ß√µes da blockchain principal (cadeias secund√°rias), e, por √∫ltimo, os blocos que n√£o tem um bloco pai conhecido nas cadeias conhecidas (blocos √≥rf√£os). Os blocos inv√°lidos s√£o rejeitados assim que qualquer crit√©rio de valida√ß√£o falhar e, portanto, n√£o s√£o inclu√≠dos em nenhuma cadeia.</p>
</div>
<div class="paragraph data-line-751">
<p>A qualquer momento, a "cadeia principal" √© a cadeia de blocos <em>v√°lida</em> que tiver a maior quantidade acumulada de Prova-de-Trabalho associada a ela. Na maioria dos casos, ela tamb√©m ser√° a cadeia que tem o maior n√∫mero de blocos, a menos que existam duas cadeias de comprimento semelhante e uma delas tiver mais Prova-de-Trabalho. A cadeia principal tamb√©m ter√° ramos com blocos que s√£o "irm√£os" dos blocos que est√£o na cadeia principal. Esses blocos s√£o v√°lidos, mas n√£o fazem parte da cadeia principal. Eles s√£o mantidos para refer√™ncia futura, caso uma dessas cadeias secund√°rias for estendida e passar a apresentar maior quantidade de trabalho do que a cadeia principal. Na pr√≥xima se√ß√£o (<a href="#forks">[forks]</a>), veremos como as cadeias secund√°rias surgem como resultado de uma minera√ß√£o quase simult√¢nea de blocos em uma mesma altura.</p>
</div>
<div class="paragraph data-line-753">
<p>Quando um bloco novo √© recebido, um n√≥ tentar√° inclu√≠-lo na blockchain existente. O n√≥ verificar√° neste bloco o campo "hash do bloco anterior", que √© a refer√™ncia ao pai do bloco. Em seguida, o n√≥ tentar√° encontrar esse pai na blockchain existente. Na maioria das vezes, o pai ser√° o bloco no "topo" da cadeia principal, ou seja, esse bloco novo estender√° a cadeia principal. Por exemplo, o novo bloco 277.316 possui uma refer√™ncia ao hash de seu bloco pai 277.315. A maioria dos n√≥s que recebem o 277.316 j√° ter√£o o bloco 277.315 como o topo de suas cadeias principais e, portanto, incluir√£o o bloco novo e estender√£o essa cadeia.</p>
</div>
<div class="paragraph data-line-755">
<p>√Äs vezes, como veremos em <a href="#forks">[forks]</a>, o bloco novo estende uma cadeia que n√£o √© a cadeia principal. Nesse caso, o n√≥ anexar√° o bloco novo √† cadeia secund√°ria que ele estende e, a seguir, comparar√° o trabalho da cadeia secund√°ria com o trabalho da cadeia principal. Se a cadeia secund√°ria possuir uma quantidade de trabalho acumulado maior do que a da cadeia principal, o n√≥ ir√° <em>reconvergir</em> para a cadeia secund√°ria, ou seja, ele selecionar√° a cadeia secund√°ria como sendo a sua nova cadeia principal, fazendo com que a cadeia principal anterior se torne uma cadeia secund√°ria. Se o n√≥ for um minerador, ele passar√° a construir um bloco que estende essa cadeia nova, que √© mais longa.</p>
</div>
<div class="paragraph data-line-757">
<p>Se um bloco v√°lido √© recebido e nenhum bloco pai √© encontrado nas cadeias existentes, o bloco √© considerado um "√≥rf√£o". Os blocos √≥rf√£os s√£o salvos na pool de blocos √≥rf√£os, onde eles ficam at√© que os seus blocos pais sejam recebidos. Assim que o bloco pai √© recebido e vinculado √†s cadeias existentes, o bloco √≥rf√£o pode ent√£o ser retirado da pool e ser vinculado a seu bloco pai, passando a fazer parte de uma cadeia. Os blocos √≥rf√£os geralmente surgem quando dois blocos que foram minerados em um curto espa√ßo de tempo s√£o recebidos em ordem inversa, ou seja, o bloco filho √© recebido antes do bloco pai.</p>
</div>
<div class="paragraph data-line-759">
<p>Ao selecionar a cadeia com maior quantidade de trabalho acumulado, todos os n√≥s acabam atingindo um consenso disseminado em toda a rede. As discrep√¢ncias tempor√°rias entre as cadeias acabam sendo resolvidas √† medida que uma maior quantidade de trabalho √© adicionada, estendendo uma das poss√≠veis cadeias. Os n√≥s mineradores "votam" com seu poder de minera√ß√£o ao escolher qual cadeia eles estender√£o ao minerarem o pr√≥ximo bloco. Quando os mineradores mineram um bloco novo e estendem a cadeia, o bloco novo representa o voto deles.</p>
</div>
<div class="paragraph data-line-761">
<p>Na pr√≥xima se√ß√£o, veremos como discrep√¢ncias entre cadeias concorrentes (forks) s√£o resolvidas atrav√©s da sele√ß√£o independente da cadeia com a maior quantidade de trabalho acumulado.</p>
</div>
<div id="forks" class="paragraph data-line-764">
<p>==== Forks da Blockchain</p>
</div>
<div class="paragraph data-line-766">
<p>Because the blockchain is a decentralized data structure, different copies of it are not always consistent. Blocks might arrive at different nodes at different times, causing the nodes to have different perspectives of the blockchain. To resolve this, each node always selects and attempts to extend the chain of blocks that represents the most Proof-of-Work, also known as the longest chain or greatest cumulative work chain. By summing the work recorded in each block in a chain, a node can calculate the total amount of work that has been expended to create that chain. As long as all nodes select the greatest-cumulative-work chain, the global Bitcoin network eventually converges to a consistent state. Forks occur as temporary inconsistencies between versions of the blockchain, which are resolved by eventual reconvergence as more blocks are added to one of the forks.</p>
</div>
<div class="admonitionblock tip data-line-769">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-770">
<p>As bifurca√ß√µes de blockchain descritas nesta se√ß√£o ocorrem naturalmente (acidentalmente) como resultado de atrasos de transmiss√£o na rede global. Mais adiante neste cap√≠tulo, tamb√©m examinaremos as bifurca√ß√µes que s√£o induzidas deliberadamente (hard forks e soft forks), que s√£o usadas para modificar as regras de consenso.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-773">
<p>In the next few diagrams, we follow the progress of a "fork" event across the network. The diagram is a simplified representation of the Bitcoin network. For illustration purposes, different blocks are shown as different shapes (star, triangle, upside-down triangle, rhombus), spreading across the network. Each node in the network is represented as a circle.</p>
</div>
<div class="paragraph data-line-775">
<p>Cada n√≥ tem sua pr√≥pria perspectiva da blockchain global. √Ä medida que cada n√≥ recebe blocos de seus vizinhos, ele atualiza sua pr√≥pria c√≥pia da blockchain, selecionando a cadeia com a maior quantidade de trabalho acumulado. Para fins de ilustra√ß√£o, cada n√≥ cont√©m uma figura que representa o bloco que ele acredita ser a atual ponta da cadeia principal. Portanto, a figura de uma estrela em um n√≥ significa que o bloco estrela √© a ponta da cadeia principal para esse n√≥.</p>
</div>
<div class="paragraph data-line-777">
<p>No primeiro diagrama (<a href="#fork1">Antes da bifurca√ß√£o&#x2014;todos os n√≥s tem a mesma perspectiva</a>), a rede tem uma perspectiva unificada da blockchain, com o bloco estrela sendo a ponta da cadeia principal.</p>
</div>
<div id="fork1" class="imageblock smallereighty data-line-782">
<div class="content">
<img src="images/mbc2_1002.png" alt="Before the fork - all nodes have the same perspective">
</div>
<div class="title">Figure 64. Antes da bifurca√ß√£o&#x2014;todos os n√≥s tem a mesma perspectiva</div>
</div>
<div class="paragraph data-line-784">
<p>Uma "bifurca√ß√£o" ocorre sempre quando h√° dois blocos v√°lidos diferentes na mesma altura de bloco competindo para formar a blockchain mais longa. Em condi√ß√µes normais, isso ocorre sempre que dois mineradores resolvem o algoritmo de Prova-de-Trabalho em um intervalo de tempo muito curto. Quando ambos os mineradores descobrem uma solu√ß√£o para seus respectivos blocos candidatos, eles imediatamente transmitem os seus respectivos blocos "vencedores" para seus vizinhos imediatos, que, por suas vezes, come√ßam a propagar o bloco pela rede. Cada n√≥ que receber um bloco v√°lido ir√° incorpor√°-lo √† sua blockchain, estendendo a blockchain em um bloco. Se mais tarde o n√≥ descobrir outro bloco v√°lido estendendo o mesmo bloco pai (na mesma altura de bloco), ele conectar√° o segundo bloco em uma cadeia secund√°ria, bifurcando a sua cadeia principal. Como resultado, alguns n√≥s ir√£o "enxergar" um bloco vencedor primeiro, enquanto outros n√≥s ir√£o "enxergar" o outro bloco vencedor primeiro, o que levar√° ao surgimento de duas vers√µes concorrentes da mesma blockchain.</p>
</div>
<div class="paragraph data-line-786">
<p>Na <a href="#fork2">Visualiza√ß√£o de um evento de bifurca√ß√£o da blockchain: dois blocos s√£o encontrados simultaneamente</a>, podemos ver dois mineradores (N√≥ X e N√≥ Y) que mineram dois blocos diferentes quase que simultaneamente. Esses dois blocos s√£o filhos do bloco estrela, e estendem a cadeia ao serem acrescentados no topo do bloco estrela. Para facilitar o nosso acompanhamento, um deles √© representado como um bloco tri√¢ngulo originando-se do N√≥ X, e o outro √© representado como um bloco tri√¢ngulo invertido originando-se do N√≥ Y.</p>
</div>
<div id="fork2" class="imageblock smallersixty data-line-791">
<div class="content">
<img src="images/mbc2_1003.png" alt="Visualization of a blockchain fork event: two blocks found simultaneously">
</div>
<div class="title">Figure 65. Visualiza√ß√£o de um evento de bifurca√ß√£o da blockchain: dois blocos s√£o encontrados simultaneamente</div>
</div>
<div class="paragraph data-line-793">
<p>Vamos assumir, por exemplo, que o minerador N√≥ X encontra uma solu√ß√£o de Prova-de-Trabalho para um bloco "tri√¢ngulo" que estende a blockchain, sendo acrescentado no topo do bloco pai "estrela". Quase simultaneamente, o minerador N√≥ Y, que tamb√©m est√° estendendo a cadeia do bloco "estrela", encontra uma solu√ß√£o para o bloco "tri√¢ngulo invertido", o seu bloco candidato. Agora, existem dois blocos poss√≠veis; um iremos cham√°-lo de bloco "tri√¢ngulo", que se origina no N√≥ X; e o outro iremos cham√°-lo de bloco "tri√¢ngulo invertido", que se origina no N√≥ Y. Ambos os blocos foram minerados com sucesso, ambos s√£o v√°lidos (cont√™m uma solu√ß√£o v√°lida para a Prova-de-Trabalho) e ambos estendem o mesmo bloco pai (o bloco "estrela"). Ambos os blocos provavelmente cont√™m quase as mesmas transa√ß√µes, com apenas algumas diferen√ßas na ordem delas.</p>
</div>
<div class="paragraph data-line-795">
<p>√Ä medida que os dois blocos s√£o propagados, alguns n√≥s recebem o bloco "tri√¢ngulo" primeiro, enquanto outros recebem o bloco "tri√¢ngulo invertido" primeiro. Como demonstrado na <a href="#fork3">Visualiza√ß√£o de um evento de bifurca√ß√£o da blockchain: dois blocos s√£o propagados, dividindo a rede</a>, a rede se divide em duas perspectivas diferentes da blockchain, um lado cujo topo √© o bloco tri√¢ngulo, e um outro lado cujo topo √© o bloco tri√¢ngulo invertido.</p>
</div>
<div id="fork3" class="imageblock smallersixty data-line-800">
<div class="content">
<img src="images/mbc2_1004.png" alt="Visualization of a blockchain fork event: two blocks propagate, splitting the network">
</div>
<div class="title">Figure 66. Visualiza√ß√£o de um evento de bifurca√ß√£o da blockchain: dois blocos s√£o propagados, dividindo a rede</div>
</div>
<div class="paragraph data-line-802">
<p>Na <a href="#fork3">Visualiza√ß√£o de um evento de bifurca√ß√£o da blockchain: dois blocos s√£o propagados, dividindo a rede</a>, o minerador "N√≥ X" minerou (criou) o bloco tri√¢ngulo e estendeu a cadeia estrela com ele. Logo, o N√≥ X inicialmente considera a cadeia com o bloco "tri√¢ngulo" como sendo a cadeia principal. Mais tarde, o N√≥ X tamb√©m recebeu o bloco "tri√¢ngulo invertido" que foi minerado pelo N√≥ Y. Como ele foi recebido depois do bloco "tri√¢ngulo", presume-se que ele "perdeu" a corrida. No entanto, o bloco "tri√¢ngulo invertido" n√£o √© descartado. Ele est√° vinculado ao bloco pai "estrela" e forma uma cadeia secund√°ria. Enquanto o N√≥ X assume a sua cadeia como sendo a cadeia vencedora, ele mant√©m a cadeia "perdedora" para que tenha as informa√ß√µes necess√°rias para reconvergir caso a cadeia "perdedora" venha a se tornar a cadeia "vencedora" no futuro.</p>
</div>
<div class="paragraph data-line-804">
<p>No outro lado da rede, o minerador N√≥ Y constr√≥i uma blockchain com base em sua pr√≥pria perspectiva da sequ√™ncia de eventos. O minerador N√≥ Y minerou (criou) o "tri√¢ngulo invertido" e inicialmente considera essa cadeia como sendo a cadeia principal (a cadeia "vencedora"). Mais tarde, quando ele recebeu o bloco "tri√¢ngulo" que foi minerado pelo N√≥ X, ele o conectou ao bloco pai "estrela", formando uma cadeia secund√°ria.</p>
</div>
<div class="paragraph data-line-806">
<p>Nenhum dos lados da rede est√° "certo" ou "errado". Ambos os lados s√£o perspectivas v√°lidas da blockchain. No futuro apenas um dos lados prevalecer√°, e isso depender√° de como essas duas cadeias concorrentes ser√£o estendidas por trabalho adicional.</p>
</div>
<div class="paragraph data-line-808">
<p>Cada n√≥ de minera√ß√£o com perspectiva semelhante √† do N√≥ X imediatamente come√ßar√° a minerar um bloco candidato que estende a cadeia com o bloco "tri√¢ngulo" na ponta. Ao vincular o bloco "tri√¢ngulo" como sendo o bloco pai de seus blocos candidatos, os mineradores est√£o votando usando o seu poder de <em>hashing</em>. O voto dos mineradores ap√≥ia a cadeia que eles elegeram como sendo a cadeia principal.</p>
</div>
<div class="paragraph data-line-810">
<p>Qualquer n√≥ de minera√ß√£o cuja perspectiva se assemelhe com a do n√≥ Y come√ßar√° a construir um bloco candidato com o bloco "tri√¢ngulo invertido" como pai, estendendo a cadeia que eles acreditam ser a cadeia principal. E assim, a corrida come√ßa novamente.</p>
</div>
<div class="paragraph data-line-812">
<p>As bifurca√ß√µes quase sempre s√£o resolvidas no intervalo de um bloco (10 minutos em m√©dia). Enquanto parte do poder de <em>hashing</em> da rede est√° tentando acrescentar um bloco no topo do bloco pai "tri√¢ngulo", outra parte do poder de <em>hashing</em> est√° tentando acrescentar um bloco no topo do bloco pai "tri√¢ngulo invertido". Mesmo que o poder de minera√ß√£o esteja dividido quase igualmente, provavelmente um grupo de mineradores encontrar√° uma solu√ß√£o e propag√°-la antes que outro grupo de mineradores tenha encontrado qualquer solu√ß√£o. Digamos que, por exemplo, os mineradores tentando acrescentar um bloco no topo do bloco pai "tri√¢ngulo" encontram um novo bloco "losango" que estende a cadeia (por exemplo, estrela-tri√¢ngulo-losango). Eles imediatamente propagam esse bloco novo e toda a rede o enxerga como uma solu√ß√£o v√°lida, como demonstrado em <a href="#fork4">Visualiza√ß√£o de um evento de bifurca√ß√£o da blockchain: um novo bloco estende uma das cadeias, reconvergindo a rede. O N√≥ X e o N√≥ Y agora consideram o bloco "tri√¢ngulo invertido" como sendo um bloco obsoleto.</a>.</p>
</div>
<div class="paragraph data-line-814">
<p>Todos os n√≥s que haviam escolhido o "tri√¢ngulo" como vencedor na rodada anterior simplesmente estender√£o a cadeia em mais um bloco. Os n√≥s que escolheram o "tri√¢ngulo invertido" como vencedor, no entanto, enxergar√£o agora duas cadeias: estrela-tri√¢ngulo-losango e estrela-tri√¢ngulo invertido. A cadeia estrela-tri√¢ngulo-losango agora √© maior (possui mais trabalho acumulado) do que a outra cadeia. Como resultado, aqueles n√≥s definir√£o a cadeia estrela-tri√¢ngulo-losango como sendo a cadeia principal e passar√£o a considerar a cadeia estrela-tri√¢ngulo invertido como sendo a cadeia secund√°ria, como demonstrado na <a href="#fork5">Visualiza√ß√£o de um evento de bifurca√ß√£o da blockchain: a rede reconverge em uma nova cadeia mais longa</a>. Esse processo chama-se reconverg√™ncia da cadeia, pois aqueles n√≥s s√£o for√ßados a revisar sua vis√£o da blockchain para incorporar a nova evid√™ncia de uma cadeia mais longa. Qualquer minerador que estiver trabalhando em estender a cadeia estrela-tri√¢ngulo invertido ter√° que parar o trabalho, pois o seu bloco candidato agora √© considerado filho de um <em>bloco obsoleto</em> (em ingl√™s, <em>stale block</em>), j√° que o seu bloco pai "tri√¢ngulo invertido" n√£o est√° mais na cadeia mais longa. Como o bloco tri√¢ngulo invertido agora est√° obsoleto, o minerador N√≥ Y (que minerou esse bloco) n√£o ser√° capaz de gastar a recompensa de minera√ß√£o desse bloco, apesar de esse bloco ser v√°lido e ter sido minerado com sucesso. As transa√ß√µes contidas no "tri√¢ngulo invertido" que n√£o est√£o no "tri√¢ngulo" s√£o re-inseridas na mempool para serem inclu√≠das no pr√≥ximo bloco, tornando-se parte da cadeia principal. Toda a rede reconverge para uma √∫nica blockchain estrela-tri√¢ngulo-losango, com o "losango" sendo o √∫ltimo bloco na cadeia. Todos os mineradores imediatamente come√ßam a trabalhar nos blocos candidatos que referenciam o "losango" como seu pai, estendendo a cadeia estrela-tri√¢ngulo-losango.</p>
</div>
<div id="fork4" class="imageblock smallereighty data-line-819">
<div class="content">
<img src="images/mbc2_1005.png" alt="Visualization of a blockchain fork event: a new block extends one fork">
</div>
<div class="title">Figure 67. Visualiza√ß√£o de um evento de bifurca√ß√£o da blockchain: um novo bloco estende uma das cadeias, reconvergindo a rede. O N√≥ X e o N√≥ Y agora consideram o bloco "tri√¢ngulo invertido" como sendo um bloco obsoleto.</div>
</div>
<div id="fork5" class="imageblock smallereighty data-line-824">
<div class="content">
<img src="images/mbc2_1006.png" alt="Visualization of a blockchain fork event: the network reconverges on a new longest chain">
</div>
<div class="title">Figure 68. Visualiza√ß√£o de um evento de bifurca√ß√£o da blockchain: a rede reconverge em uma nova cadeia mais longa</div>
</div>
<div class="paragraph data-line-826">
<p>Teoricamente √© poss√≠vel que uma bifurca√ß√£o se estenda em dois blocos, caso dois blocos forem encontrados quase que simultaneamente por mineradores em "lados" opostos de uma bifurca√ß√£o anterior. Entretanto, a chance disso acontecer √© muito baixa. Enquanto uma bifurca√ß√£o com um bloco de extens√£o pode ocorrer quase que diariamente, uma bifurca√ß√£o com dois blocos de extens√£o ocorre no m√°ximo uma vez no intervalo de algumas semanas.</p>
</div>
<div class="paragraph data-line-828">
<p>O intervalo de bloco de 10 minutos do bitcoin foi planejado para ser um ajuste equilibrado entre tempos de confirma√ß√£o r√°pidos (liquida√ß√£o das transa√ß√µes) e a probabilidade de uma bifurca√ß√£o. Um intervalo de tempo menor entre os blocos faria com que as transa√ß√µes fossem liquidadas mais rapidamente, mas causaria bifurca√ß√µes mais frequentes da blockchain, enquanto um intervalo de tempo maior entre os blocos diminuiria o n√∫mero de bifurca√ß√µes, mas faria com que as transa√ß√µes fossem liquidadas mais lentamente.</p>
</div>
<div class="paragraph data-line-830">
<p>=== Minera√ß√£o e a Corrida do <em>Hashing</em></p>
</div>
<div class="paragraph data-line-832">
<p>Bitcoin mining is an extremely competitive industry. The hashing power has increased exponentially every year of bitcoin&#8217;s existence. Some years the growth has reflected a complete change of technology, such as in 2010 and 2011 when many miners switched from using CPU mining to GPU mining and field programmable gate array (FPGA) mining. In 2013 the introduction of ASIC mining lead to another giant leap in mining power, by placing the SHA256 function directly on silicon chips specialized for the purpose of mining. The first such chips could deliver more mining power in a single box than the entire Bitcoin network in 2010.</p>
</div>
<div class="paragraph data-line-834">
<p>The following list shows the total hashing power of the Bitcoin network in terahashes/sec (TH/sec), since its inception in 2009 (source: Blockchain.com):</p>
</div>
<div class="dlist data-line-836">
<dl>
<dt class="hdlist1">2009</dt>
<dd>
<p>0,000004 ‚Äì 0,00001 TH/s (crescimento de 2,40&#x00D7;)</p>
</dd>
<dt class="hdlist1">2010</dt>
<dd>
<p>0,00001 ‚Äì 0,14 TH/s (crescimento de 14.247&#x00D7;)</p>
</dd>
<dt class="hdlist1">2011</dt>
<dd>
<p>0,14 ‚Äì 9,49 TH/s (crescimento de 63,92&#x00D7;)</p>
</dd>
<dt class="hdlist1">2012</dt>
<dd>
<p>9,49 ‚Äì 22 TH/s (crescimento de 2,32&#x00D7;)</p>
</dd>
<dt class="hdlist1">2013</dt>
<dd>
<p>22 ‚Äì 15.942 TH/s (crescimento de 723,32&#x00D7;)</p>
</dd>
<dt class="hdlist1">2014</dt>
<dd>
<p>15.942 ‚Äì 306.333 TH/s (crescimento de 19,21&#x00D7;)</p>
</dd>
<dt class="hdlist1">2015</dt>
<dd>
<p>306.333 ‚Äì 881.232 TH/s (crescimento de 2,87&#x00D7;)</p>
</dd>
<dt class="hdlist1">2016</dt>
<dd>
<p>881.232 ‚Äì 2.807.540 TH/s (crescimento de 3,18&#x00D7;)</p>
</dd>
<dt class="hdlist1">2017</dt>
<dd>
<p>2.807.540 ‚Äì 18.206.558 TH/s (crescimento de 6,48&#x00D7;)</p>
</dd>
<dt class="hdlist1">2018</dt>
<dd>
<p>18.206.558 ‚Äì 41.801.528 TH/s (crescimento de 2,29&#x00D7;)</p>
</dd>
<dt class="hdlist1">2019</dt>
<dd>
<p>41.801.528 ‚Äì 109.757.127 TH/s (crescimento de 2,62&#x00D7;)</p>
</dd>
<dt class="hdlist1">2020</dt>
<dd>
<p>109.757.127 ‚Äì 149.064.869 TH/s (crescimento de 1,35&#x00D7;)</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-849">
<p>In the chart in <a href="#network_hashing_power">Poder de hashing total, em terahashes por segundo (TH/s) (gr√°fico em escala linear)</a>, we can see that Bitcoin network&#8217;s hashing power increased over the past two years. As you can see, the competition between miners and the growth of bitcoin has resulted in an exponential increase in the hashing power (total hashes per second across the network).</p>
</div>
<div id="network_hashing_power" class="imageblock data-line-853">
<div class="content">
<img src="images/mbc2_1007.png" alt="NetworkHashingRate">
</div>
<div class="title">Figure 69. Poder de hashing total, em terahashes por segundo (TH/s) (gr√°fico em escala linear)</div>
</div>
<div class="paragraph data-line-855">
<p>Como a quantidade de poder de <em>hashing</em> aplicada √† minera√ß√£o de bitcoin explodiu, a dificuldade aumentou para igual√°-la. A dificuldade mostrada no gr√°fico da <a href="#bitcoin_difficulty">Dificuldade de minera√ß√£o do bitcoin (gr√°fico em escala logar√≠tmica)</a> √© medida como uma raz√£o entre a dificuldade atual e a dificuldade m√≠nima (a dificuldade do primeiro bloco).</p>
</div>
<div id="bitcoin_difficulty" class="imageblock data-line-859">
<div class="content">
<img src="images/mbc2_1008.png" alt="BitcoinDifficulty">
</div>
<div class="title">Figure 70. Dificuldade de minera√ß√£o do bitcoin (gr√°fico em escala logar√≠tmica)</div>
</div>
<div class="paragraph data-line-861">
<p>Nos √∫ltimos dois anos, os chips de minera√ß√£o ASIC tornaram-se cada vez mais densos, aproximando-se da tecnologia de ponta na fabrica√ß√£o em sil√≠cio, com um tamanho de recurso (resolu√ß√£o) de 7 nan√¥metros (nm). Atualmente, os fabricantes de ASICs est√£o tentando superar os fabricantes de chips de CPU, projetando chips com 5 nm, pois a rentabilidade da minera√ß√£o est√° fazendo com que essa ind√∫stria evolua at√© mais rapidamente do que a ind√∫stria de processadores de prop√≥sito geral. N√£o existem mais passos gigantes para se dar na minera√ß√£o no bitcoin, pois a ind√∫stria atingiu o limite da Lei de Moore, que estipula que a densidade computacional dobrar√° aproximadamente a cada 18 meses. Entretanto, o poder de minera√ß√£o da rede continua a avan√ßar em um ritmo exponencial, √† medida que a corrida por chips de maior densidade √© combinada com uma corrida por <em>data centers</em> de maior densidade, onde milhares desses chips podem ser empregados. Agora n√£o √© mais uma quest√£o de quanta minera√ß√£o pode ser feita em um chip, mas quantos chips podem ser espremidos em um pr√©dio, enquanto ainda se dissipa o calor e se fornece energia adequada.</p>
</div>
<div id="extra_nonce" class="paragraph data-line-864">
<p>==== A Solu√ß√£o do Nonce Extra</p>
</div>
<div class="paragraph data-line-866">
<p>Desde 2012, a minera√ß√£o do bitcoin evoluiu para resolver uma limita√ß√£o fundamental na estrutura do cabe√ßalho do bloco. No in√≠cio do bitcoin, um minerador podia encontrar um bloco ao ficar testando os valores de nonce at√© que o hash resultante fosse menor ou igual ao alvo. √Ä medida que a dificuldade cresceu, os mineradores frequentemente ciclavam por todos os 4 bilh√µes de valores do nonce sem encontrar nenhum bloco. Entretanto, isso foi facilmente resolvido ao se atualizar o <em>timestamp</em> (carimbo de data e hora) do bloco para contabilizar pelo tempo decorrido. Como o <em>timestamp</em> faz parte do cabe√ßalho do bloco, essa mudan√ßa permitiu que os mineradores fizessem suas buscas pelo valor do nonce novamente com resultados diferentes. No entanto, quando o hardware de minera√ß√£o excedeu 4 GH/s, essa abordagem tornou-se cada vez mais dif√≠cil, pois os valores do nonce esgotavam-se em menos de um segundo. √Ä medida que os equipamentos de minera√ß√£o ASIC come√ßaram a aumentar e exceder a taxa de terahashes por segundo (TH/s), o software de minera√ß√£o precisou de mais espa√ßo para os valores de nonce. O <em>timestamp</em> podia ser estendido mais um pouco, mas ficar empurrando-o para o futuro uma hora faria com que o bloco se tornasse inv√°lido. O cabe√ßalho do bloco precisava de um novo lugar nele para ser usado como fonte para os valores de nonce. A solu√ß√£o foi usar a transa√ß√£o coinbase como uma fonte para valores extra de nonce. Como o script da coinbase pode armazenar entre 2 e 100 bytes de dados, os mineradores come√ßaram a usar esse espa√ßo como espa√ßo extra para o nonce, o que permitiu que eles explorassem uma faixa muito maior de valores de cabe√ßalhos de blocos para encontrar blocos v√°lidos. A transa√ß√£o coinbase √© inclu√≠da na √°rvore de merkle, ou seja, qualquer mudan√ßa no script coinbase faz com que a raiz de merkle mude. Os 8 bytes extras do nonce, mais os 4 bytes do nonce "padr√£o" permitem aos mineradores explorarem um total de 2<sup>96</sup> (o n√∫mero 8 seguido de 28 zeros) possibilidades <em>por segundo</em> sem ter que modificar o <em>timestamp</em>. Se, no futuro, os mineradores conseguirem ciclar atrav√©s de todas essas possibilidades, eles poder√£o ent√£o modificar o <em>timestamp</em>. Tamb√©m h√° mais espa√ßo no script da coinbase para futuras expans√µes do espa√ßo extra de nonce.</p>
</div>
<div id="mining_pools" class="paragraph data-line-869">
<p>==== Pools de Minera√ß√£o</p>
</div>
<div class="paragraph data-line-871">
<p>Nesse ambiente altamente competitivo, os mineradores individuais que trabalham sozinhos (tamb√©m conhecidos como mineradores solo) n√£o tem chances de vencer. A probabilidade de um deles encontrar um bloco e compensar os custos com eletricidade e hardware √© t√£o baixa, que acaba virando uma aposta, como jogar em uma loteria. Nem mesmo o sistema de minera√ß√£o ASIC mais r√°pido √© capaz de competir com os sistemas comerciais que empilham dezenas de milhares desses chips em enormes galp√µes pr√≥ximos de esta√ß√µes de energia hidrel√©trica. Em fun√ß√£o disso, os mineradores agora re√∫nem-se para formar associa√ß√µes conhecidas como pools de minera√ß√£o, agrupando o seu poder de <em>hashing</em> e compartilhando as recompensas entre os milhares de participantes da pool. Ao participar de uma pool, os mineradores recebem uma pequena cota da recompensa total, mas tipicamente s√£o recompensados diariamente, reduzindo as incertezas.</p>
</div>
<div class="paragraph data-line-873">
<p>Vejamos um exemplo espec√≠fico. Suponha que um minerador comprou um hardware de minera√ß√£o com uma taxa de hashing combinada de 14.000 gigahashes por segundo (GH/s), ou 14 TH/s. Em 2017, esse equipamento custava cerca de US$2.500. O hardware em funcionamento consome 1.375 watts (1,3 kW) de eletricidade, 33 kW-hora por dia, a um custo de US$1 a US$2 por dia em uma cidade com tarifa de energia el√©trica muito baixa. Na dificuldade atual do bitcoin, o minerador ser√° capaz de minerar sozinho um bloco aproximadamente uma vez a cada quatro anos. Como calculamos essa probabilidade? Ela √© baseada em uma taxa de hashing global da rede de 3 EH/s (em 2017) e na taxa de hashing do minerador de 14 TH/s:</p>
</div>
<ul class="simplelist">
  <li>P = (14 * 10<sup>12</sup> / 3 * 10<sup>18</sup>) * 210.240 = 0,98</li>
</ul>
<div class="paragraph data-line-881">
<p>&#8230;&#8203;onde 210.240 √© o n√∫mero de blocos em quatro anos. O minerador tem 98% de probabilidade de encontrar um bloco em quatro anos, com base na taxa de hash global no in√≠cio do per√≠odo.</p>
</div>
<div class="paragraph data-line-883">
<p>Se o minerador encontrar um √∫nico bloco nesse per√≠odo de tempo, o pagamento de 6,25 bitcoins, a aproximadamente 1.000 d√≥lares por bitcoin, resultar√° em um √∫nico pagamento de 6.250 d√≥lares, que produzir√° um lucro l√≠quido de cerca de 750 d√≥lares. No entanto, a chance de encontrar um bloco em um per√≠odo de 4 anos depende da sorte do minerador. Ele pode encontrar dois blocos em 4 anos e ter um lucro maior. Ou ele pode n√£o encontrar nenhum bloco durante 5 anos e, com isso, sofrer um grande preju√≠zo financeiro. Pior ainda, a dificuldade do algoritmo de Prova-de-Trabalho do bitcoin provavelmente aumentar√° significativamente ao longo desse per√≠odo. Se a atual taxa de crescimento do poder de <em>hashing</em> permanecer est√°vel, isso significa que o minerador tem, no m√°ximo, um ano para recuperar o seu investimento inicial antes de o seu equipamento de minera√ß√£o ficar obsoleto e precisar ser substitu√≠do por outro equipamento mais poderoso. Em fun√ß√£o disso, do ponto de vista financeiro, s√≥ faz sentido minerar bitcoin em lugares com um custo de eletricidade muito baixo (menos de 1 centavo de d√≥lar por kW-hora) e apenas em uma escala muito grande.</p>
</div>
<div class="paragraph data-line-885">
<p>Mining pools coordinate many hundreds or thousands of miners, over specialized pool-mining protocols. The individual miners configure their mining equipment to connect to a pool server, and specify a Bitcoin address, which will receive their share of the rewards. Their mining hardware remains connected to the pool server while mining, synchronizing their efforts with the other miners. Thus, the pool miners share the effort to mine a block and then share in the rewards.</p>
</div>
<div class="paragraph data-line-887">
<p>Successful blocks pay the reward to a pool Bitcoin address, rather than individual miners. The pool server will periodically make payments to the miners' Bitcoin addresses, once their share of the rewards has reached a certain threshold. Typically, the pool server charges a percentage fee of the rewards for providing the pool-mining service.</p>
</div>
<div class="paragraph data-line-889">
<p>Miners participating in a pool split the work of searching for a solution to a candidate block, earning "shares" for their mining contribution. The mining pool sets a higher target (lower difficulty) for earning a share, typically more than 1,000 times easier than the Bitcoin network&#8217;s target. When someone in the pool successfully mines a block, the reward is earned by the pool and then shared with all miners in proportion to the number of shares they contributed to the effort.</p>
</div>
<div class="paragraph data-line-891">
<p>Pools are open to any miner, big or small, professional or amateur. A pool will therefore have some participants with a single small mining machine, and others with a garage full of high-end mining hardware. Some will be mining with a few tens of a kilowatt of electricity, others will be running a data center consuming a megawatt of power. How does a mining pool measure the individual contributions, so as to fairly distribute the rewards, without the possibility of cheating? The answer is to use bitcoin&#8217;s Proof-of-Work algorithm to measure each pool miner&#8217;s contribution, but set at a lower difficulty so that even the smallest pool miners win a share frequently enough to make it worthwhile to contribute to the pool. By setting a lower difficulty for earning shares, the pool measures the amount of work done by each miner. Each time a pool miner finds a block header hash that is equal to or less than the pool target, she proves she has done the hashing work to find that result. More importantly, the work to find shares contributes, in a statistically measurable way, to the overall effort to find a hash equal to or lower than the Bitcoin network&#8217;s target. Thousands of miners trying to find low-value hashes will eventually find one low enough to satisfy the Bitcoin network target.</p>
</div>
<div class="paragraph data-line-893">
<p>Vamos voltar √† analogia do jogo de dados. Se os jogadores estiverem lan√ßando os dados com o objetivo de obter um resultado menor ou igual a quatro (a dificuldade geral da rede), uma pool definiria um alvo mais f√°cil, contando quantas vezes os jogadores da pool conseguiram obter um resultado menor ou igual a oito. Quando os jogadores da pool obtiverem um resultado menor ou igual a oito (o alvo da cota da pool), mas maior do que quatro (maior que a dificuldade geral da rede), eles ganham cotas, mas nem eles nem a pool ganham o jogo, pois eles n√£o atingiram o alvo do jogo (menor ou igual a quatro). Os jogadores da pool atingir√£o o alvo mais f√°cil da pool muito mais frequentemente, ganhando cotas com bastante regularidade, mesmo que eles n√£o atinjam o alvo mais dif√≠cil que √© necess√°rio para se ganhar o jogo. De vez em quando, um dos jogadores da pool lan√ßar√° dois dados combinados e obter√° um resultado menor ou igual a quatro, com isso, o jogador da pool ganha uma cota e toda a pool ganha o jogo. Ent√£o, os ganhos podem ser distribu√≠dos para os jogadores da pool com base na quantidade de cotas que cada um ganhou. Apesar de o alvo da pool (menor ou igual a oito) n√£o ser uma vit√≥ria, ele √© uma maneira justa de se medir os lan√ßamentos de dados dos jogadores, e isso ocasionalmente produz um lan√ßamento com um resultado menor ou igual a quatro.</p>
</div>
<div class="paragraph data-line-895">
<p>Similarly, a mining pool will set a (higher and easier) pool target that will ensure that an individual pool miner can find block header hashes that are equal to or less than the pool target often, earning shares. Every now and then, one of these attempts will produce a block header hash that is equal to or less than the Bitcoin network target, making it a valid block and the whole pool wins.</p>
</div>
<div class="paragraph data-line-897">
<p>===== Pools gerenciadas</p>
</div>
<div class="paragraph data-line-899">
<p>A maioria das pools de minera√ß√£o s√£o "gerenciadas", ou seja, existe uma empresa ou um indiv√≠duo executando um servidor de pool. O propriet√°rio do servidor de pool √© chamado de <em>operador da pool</em>, e ele cobra dos mineradores da pool uma taxa percentual dos ganhos.</p>
</div>
<div class="paragraph data-line-901">
<p>The pool server runs specialized software and a pool-mining protocol that coordinate the activities of the pool miners. The pool server is also connected to one or more full Bitcoin nodes and has direct access to a full copy of the blockchain database. This allows the pool server to validate blocks and transactions on behalf of the pool miners, relieving them of the burden of running a full node. For pool miners, this is an important consideration, because a full node requires a dedicated computer with at least 300 to 350 GB of persistent storage (disk) and at least 2 to 4 GB of memory (RAM). Furthermore, the bitcoin software running on the full node needs to be monitored, maintained, and upgraded frequently. Any downtime caused by a lack of maintenance or lack of resources will hurt the miner&#8217;s profitability. For many miners, the ability to mine without running a full node is another big benefit of joining a managed pool.</p>
</div>
<div class="paragraph data-line-903">
<p>Pool miners connect to the pool server using a mining protocol such as Stratum (STM) or GetBlockTemplate (GBT). An older standard called GetWork (GWK) has been mostly obsolete since late 2012, because it does not easily support mining at hash rates above 4 GH/s. Both the STM and GBT protocols create block <em>templates</em> that contain a template of a candidate block header. The pool server constructs a candidate block by aggregating transactions, adding a coinbase transaction (with extra nonce space), calculating the merkle root, and linking to the previous block hash. The header of the candidate block is then sent to each of the pool miners as a template. Each pool miner then mines using the block template, at a higher (easier) target than the Bitcoin network target, and sends any successful results back to the pool server to earn shares.</p>
</div>
<div class="paragraph data-line-905">
<p>===== Pool de minera√ß√£o par-a-par (P2Pool)</p>
</div>
<div class="paragraph data-line-907">
<p>As pools gerenciadas criam uma oportunidade para que o operador da pool possa trapacear, seja direcionando os esfor√ßos da pool para transa√ß√µes de gasto duplo, seja minerando blocos inv√°lidos (ver <a href="#consensus_attacks">[consensus_attacks]</a>). Al√©m disso, os servidores de pool centralizados representam um ponto √∫nico de falha. Se o servidor da pool cair ou tornar-se lento devido a ataques de nega√ß√£o de servi√ßo, os mineradores da pool n√£o ser√£o capazes de minerar. Em 2011, para resolver esses problemas causados pela centraliza√ß√£o, um novo m√©todo de minera√ß√£o em pool foi proposto e implementado: o P2Pool, que √© uma pool de minera√ß√£o par-a-par, sem um operador central.</p>
</div>
<div class="paragraph data-line-909">
<p>P2Pool works by decentralizing the functions of the pool server, implementing a parallel blockchain-like system called a <em>share chain</em>. A share chain is a blockchain running at a lower difficulty than the Bitcoin blockchain. The share chain allows pool miners to collaborate in a decentralized pool by mining shares on the share chain at a rate of one share block every 30 seconds. Each of the blocks on the share chain records a proportionate share reward for the pool miners who contribute work, carrying the shares forward from the previous share block. When one of the share blocks also achieves the Bitcoin network target, it is propagated and included on the Bitcoin blockchain, rewarding all the pool miners who contributed to all the shares that preceded the winning share block. Essentially, instead of a pool server keeping track of pool miner shares and rewards, the share chain allows all pool miners to keep track of all shares using a decentralized consensus mechanism like bitcoin&#8217;s blockchain consensus mechanism.</p>
</div>
<div class="paragraph data-line-911">
<p>P2Pool mining is more complex than pool mining because it requires that the pool miners run a dedicated computer with enough disk space, memory, and internet bandwidth to support a full Bitcoin node and the P2Pool node software. P2Pool miners connect their mining hardware to their local P2Pool node, which simulates the functions of a pool server by sending block templates to the mining hardware. On P2Pool, individual pool miners construct their own candidate blocks, aggregating transactions much like solo miners, but then mine collaboratively on the share chain. P2Pool is a hybrid approach that has the advantage of much more granular payouts than solo mining, but without giving too much control to a pool operator like managed pools.</p>
</div>
<div class="paragraph data-line-914">
<p>Apesar de o P2Pool reduzir a concentra√ß√£o de poder dos operadores das pools de minera√ß√£o, ele teoricamente √© vulner√°vel a ataques de 51% contra a pr√≥pria cadeia de cotas. Uma ado√ß√£o muito maior do P2Pool n√£o elimina o risco de o bitcoin sofrer um ataque de 51%. No entanto, o P2Pool torna o bitcoin mais robusto de uma maneira geral, como parte de um ecossistema de minera√ß√£o diversificado.</p>
</div>
<div id="consensus_attacks" class="paragraph data-line-917">
<p>=== Ataques de Consenso</p>
</div>
<div class="paragraph data-line-919">
<p>Bitcoin&#8217;s consensus mechanism is, at least theoretically, vulnerable to attack by miners (or pools) that attempt to use their hashing power to dishonest or destructive ends. As we saw, the consensus mechanism depends on having a majority of the miners acting honestly out of self-interest. However, if a miner or group of miners can achieve a significant share of the mining power, they can attack the consensus mechanism so as to disrupt the security and availability of the Bitcoin network.</p>
</div>
<div class="paragraph data-line-921">
<p>√â importante observar que os ataques de consenso s√≥ podem afetar consensos no futuro, ou, no m√°ximo, no passado mais recente (dezenas de blocos). O livro-raz√£o do bitcoin torna-se cada vez mais imut√°vel √† medida que o tempo passa. Embora, em teoria, uma bifurca√ß√£o possa ocorrer em qualquer profundidade, na pr√°tica, o poder computacional necess√°rio para se for√ßar uma bifurca√ß√£o muito profunda √© imenso, o que faz com que os blocos antigos sejam considerados praticamente imut√°veis. Os ataques de consenso tamb√©m n√£o afetam a seguran√ßa das chaves privadas e do algoritmo de assinatura (ECDSA). Um ataque de consenso n√£o √© capaz de roubar bitcoins, gastar bitcoins sem assinaturas ou redirecionar bitcoins, nem de modificar transa√ß√µes antigas ou registros de posse. Os ataques de consenso s√≥ s√£o capazes de afetar os blocos mais recentes e de causar nega√ß√µes de servi√ßo na cria√ß√£o de blocos futuros.</p>
</div>
<div class="paragraph data-line-923">
<p>Um cen√°rio de ataque contra o mecanismo de consenso √© o chamado "ataque de 51%". Nesse cen√°rio, um grupo de mineradores, controlando uma maioria (51%) do poder de <em>hashing</em> total da rede, conspira para atacar o bitcoin. Com a capacidade de minerar a maioria dos blocos, os mineradores atacantes podem gerar bifurca√ß√µes (forks) deliberadas na blockchain, gerar transa√ß√µes de gasto duplo ou executar ataques de nega√ß√£o de servi√ßo (DoS) contra endere√ßos ou transa√ß√µes espec√≠ficas. Um ataque de bifurca√ß√£o/gasto duplo √© um ataque onde o atacante faz com que blocos j√° confirmados sejam invalidados ao fazer uma bifurca√ß√£o em um n√≠vel abaixo deles, com uma posterior reconverg√™ncia em uma cadeia alternativa. Com poder suficiente, um atacante pode invalidar seis ou mais blocos em sequ√™ncia, invalidando transa√ß√µes que antes eram consideradas imut√°veis (com seis confirma√ß√µes). Note que o gasto duplo s√≥ pode ser feito nas transa√ß√µes do pr√≥prio atacante, para as quais o atacante pode produzir uma assinatura v√°lida. Fazer um gasto duplo da pr√≥pria transa√ß√£o s√≥ √© rent√°vel se, ao invalidar uma transa√ß√£o, o atacante puder receber um pagamento em outra moeda de forma irrevers√≠vel ou receber um produto sem ter que pagar por ele.</p>
</div>
<div class="paragraph data-line-925">
<p>Vamos examinar um exemplo pr√°tico de um ataque de 51%. No primeiro cap√≠tulo, analisamos uma transa√ß√£o entre a Alice e o Bob por uma x√≠cara de caf√©. O Bob, o dono da cafeteria, est√° disposto a aceitar pagamentos pelas suas x√≠caras de caf√© sem esperar por uma confirma√ß√£o (a inclus√£o da transa√ß√£o em um bloco minerado), pois o risco de um gasto duplo com uma x√≠cara de caf√© √© baixo se comparado com a conveni√™ncia de se oferecer um servi√ßo r√°pido ao consumidor. Isso √© semelhante √† pr√°tica das cafeterias que aceitam pagamentos de cart√£o de cr√©dito sem uma assinatura do cliente em valores menores que 25 d√≥lares, pois o risco de um reembolso de um pagamento com cart√£o de cr√©dito √© baixo, enquanto o custo em ter que esperar o cliente assinar √© comparativamente maior. Em contraste, vender um item mais caro por bitcoins aumenta o risco de um ataque de gasto duplo, no qual o comprador transmite uma outra transa√ß√£o concorrente que gasta as mesmas entradas (as mesmas UTXOs) e cancela o pagamento do comerciante. Um ataque de gasto duplo pode ocorrer de duas formas: ou antes de uma transa√ß√£o ser confirmada, ou se o atacante gerar uma bifurca√ß√£o da blockchain com o objetivo de desfazer v√°rios blocos j√° minerados anteriormente. Um ataque de 51% permite que os atacantes fa√ßam gastos duplos de suas pr√≥prias transa√ß√µes em uma nova cadeia, e, com isso, desfazendo a transa√ß√£o correspondente na cadeia antiga.</p>
</div>
<div class="paragraph data-line-927">
<p>Em nosso exemplo, o Mallory, um atacante mal-intencionado, vai at√© a galeria da Carol e compra um belo tr√≠ptico com tr√™s pinturas retratando o Satoshi Nakatomo como Prometeus. Ela vende as pinturas "O Grande Fogo" para o Mallory por 250.000 d√≥lares em bitcoin. Ao inv√©s de esperar que a transa√ß√£o receba seis ou mais confirma√ß√µes, ela embala e entrega as pinturas para o Mallory ap√≥s uma √∫nica confirma√ß√£o ter ocorrido. O Mallory tem um c√∫mplice, Paul, que opera uma grande pool de minera√ß√£o. O seu c√∫mplice faz um ataque de 51% assim que a transa√ß√£o do Mallory √© inclu√≠da em um bloco. Ele direciona a pool de minera√ß√£o para reminerar a mesma altura de bloco em que est√° o bloco contendo a transa√ß√£o do Mallory, substituindo o pagamento do Mallory para a Carol por uma transa√ß√£o que faz um gasto duplo da mesma entrada do pagamento do Mallory. A transa√ß√£o de gasto duplo consome a mesma UTXO e a paga de volta para a carteira do Mallory, ao inv√©s de pag√°-la para a Carol, essencialmente permitindo que o Mallory permane√ßa com os seus bitcoins. Em seguida, Paul direciona a pool de minera√ß√£o para minerar um bloco adicional, para tornar a cadeia contendo a transa√ß√£o de gasto duplo maior do que a cadeia original (causando uma bifurca√ß√£o abaixo do bloco contendo a transa√ß√£o do Mallory). Quando a bifurca√ß√£o da blockchain resolver-se em favor da nova cadeia (mais longa), a transa√ß√£o de gasto duplo substituir√° o pagamento original √† Carol. Agora a Carol est√° sem as suas tr√™s pinturas e tamb√©m n√£o tem mais nenhum pagamento em bitcoin. Durante todo esse per√≠odo, os participantes da pool de minera√ß√£o do Paul permanecem sem estar cientes da tentativa de gasto duplo, pois a minera√ß√£o que eles fazem √© automatizada e eles n√£o conseguem monitorar todas as transa√ß√µes ou blocos.</p>
</div>
<div class="paragraph data-line-929">
<p>Para se proteger contra um ataque desse tipo, um comerciante vendendo itens de valor elevado deve esperar pelo menos seis confirma√ß√µes antes de entregar o produto ao comprador. Outra op√ß√£o seria o comerciante usar uma conta de garantia (conta-cau√ß√£o) multiassinatura (em ingl√™s, <em>multisig escrow account</em>), novamente esperando por v√°rias confirma√ß√µes at√© que a conta de garantia receba os fundos. Quanto maior for o n√∫mero de confirma√ß√µes, mais dif√≠cil se torna invalidar uma transa√ß√£o com um ataque de 51%. Para itens de valor elevado, o pagamento usando bitcoin ainda ser√° conveniente e eficiente, mesmo que o comprador tenha que esperar 24 horas pela entrega, o que seria equivalente a aproximadamente 144 confirma√ß√µes.</p>
</div>
<div class="paragraph data-line-931">
<p>In addition to a double-spend attack, the other scenario for a consensus attack is to deny service to specific bitcoin participants (specific Bitcoin addresses). An attacker with a majority of the mining power can simply ignore specific transactions. If they are included in a block mined by another miner, the attacker can deliberately fork and remine that block, again excluding the specific transactions. This type of attack can result in a sustained denial-of-service against a specific address or set of addresses for as long as the attacker controls the majority of the mining power.</p>
</div>
<div class="paragraph data-line-933">
<p>Apesar do nome, o cen√°rio de um ataque de 51% n√£o exige um poder de <em>hashing</em> de 51%. De fato, esse ataque pode ser tentado com uma pequena porcentagem de poder de <em>hashing</em>. O valor m√≠nimo de 51% √© simplesmente o n√≠vel em que esse tipo de ataque tem sucesso quase garantido. Um ataque de consenso √© basicamente um cabo de guerra para o pr√≥ximo bloco e o grupo "mais forte" tem maior probabilidade de vencer. Com menos poder de <em>hashing</em>, a probabilidade de sucesso √© reduzida, pois outros mineradores controlam a gera√ß√£o de alguns blocos com o seu poder de minera√ß√£o "honesto". Podemos olhar isso da seguinte maneira: quanto mais poder de <em>hashing</em> um atacante tiver, mais longa ser√° a bifurca√ß√£o que ele poder√° criar deliberadamente, mais blocos no passado recente ele poder√° invalidar ou mais blocos no futuro ele poder√° controlar. Grupos de pesquisa de seguran√ßa usaram modelos estat√≠sticos para alegar que v√°rios tipos de ataques de consenso j√° s√£o poss√≠veis com um poder de <em>hashing</em> de apenas 30%.</p>
</div>
<div class="paragraph data-line-935">
<p>O aumento maci√ßo no poder de <em>hashing</em> total tornou o bitcoin imperme√°vel a ataques feitos por um minerador isolado. N√£o h√° mais como um minerador solo controlar mais do que uma pequena percentagem do poder total de minera√ß√£o. Entretanto, a centraliza√ß√£o do controle causada pelas pools de minera√ß√£o introduziu o risco de ataques em busca de lucro realizados por um operador de pool de minera√ß√£o. O operador de uma pool gerenciada controla a constru√ß√£o dos blocos candidatos, assim como as transa√ß√µes que s√£o inclu√≠das nos blocos. Isso d√° ao operador da pool o poder de excluir transa√ß√µes ou acrescentar transa√ß√µes de gasto duplo. Se esse abuso de poder for feito de uma maneira limitada e sutil, um operador de pool teoricamente seria capaz de lucrar com um ataque de consenso, sem ser descoberto.</p>
</div>
<div class="paragraph data-line-937">
<p>Not all attackers will be motivated by profit, however. One potential attack scenario is where an attacker intends to disrupt the Bitcoin network without the possibility of profiting from such disruption. A malicious attack aimed at crippling bitcoin would require enormous investment and covert planning, but could conceivably be launched by a well-funded, most likely state-sponsored, attacker. Alternatively, a well-funded attacker could attack bitcoin&#8217;s consensus by simultaneously amassing mining hardware, compromising pool operators, and attacking other pools with denial-of-service. All of these scenarios are theoretically possible, but increasingly impractical as the Bitcoin network&#8217;s overall hashing power continues to grow exponentially.</p>
</div>
<div class="paragraph data-line-939">
<p>Undoubtedly, a serious consensus attack would erode confidence in bitcoin in the short term, possibly causing a significant price decline. However, the Bitcoin network and software are constantly evolving, so consensus attacks would be met with immediate countermeasures by the bitcoin community, making bitcoin more robust.</p>
</div>
<div id="consensus_changes" class="paragraph data-line-942">
<p>=== Alterando as Regras de Consenso</p>
</div>
<div class="paragraph data-line-944">
<p>The rules of consensus determine the validity of transactions and blocks. These rules are the basis for collaboration between all Bitcoin nodes and are responsible for the convergence of all local perspectives into a single consistent blockchain across the entire network.</p>
</div>
<div class="paragraph data-line-946">
<p>While the consensus rules are invariable in the short term and must be consistent across all nodes, they are not invariable in the long term. In order to evolve and develop the Bitcoin system, the rules have to change from time to time to accommodate new features, improvements, or bug fixes. Unlike traditional software development, however, upgrades to a consensus system are much more difficult and require coordination between all the participants.</p>
</div>
<div id="hard_forks" class="paragraph data-line-950">
<p>==== Hard Forks
In <a href="#forks">[forks]</a> we looked at how the Bitcoin network may briefly diverge, with two parts of the network following two different branches of the blockchain for a short time. We saw how this process occurs naturally, as part of the normal operation of the network and how the network reconverges on a common blockchain after one or more blocks are mined.</p>
</div>
<div class="paragraph data-line-953">
<p>H√° um outro cen√°rio no qual a rede pode divergir para seguir duas cadeias: uma mudan√ßa nas regras de consenso. Esse tipo de bifurca√ß√£o √© chamado de <em>hard fork</em> (bifurca√ß√£o r√≠gida), pois, depois da bifurca√ß√£o, a rede n√£o se reconverte em uma √∫nica cadeia. Em vez disso, as duas cadeias evoluem independentemente. Os hard forks ocorrem quando uma parte da rede est√° operando sob um conjunto de regras de consenso que √© diferente do resto da rede. Isso pode ocorrer devido a um bug ou por uma altera√ß√£o deliberada na implementa√ß√£o das regras de consenso.</p>
</div>
<div class="paragraph data-line-955">
<p>Os hard forks podem ser usados para alterar as regras de consenso, mas, para isso, eles exigem coordena√ß√£o entre todos os participantes do sistema. Quaisquer n√≥s que n√£o forem atualizados para as novas regras de consenso ser√£o incapazes de participar do mecanismo de consenso, e, em fun√ß√£o disso, ser√£o for√ßados a usar uma cadeia separada no momento do hard fork. Portanto, uma mudan√ßa introduzida por um hard fork pode ser considerada como n√£o "compat√≠vel adiante", caso os sistemas que n√£o foram atualizados n√£o consigam processar as novas regras de consenso ap√≥s o evento do hard fork.</p>
</div>
<div class="paragraph data-line-957">
<p>Vamos examinar a mec√¢nica de um hard fork com um exemplo espec√≠fico.</p>
</div>
<div class="paragraph data-line-959">
<p>A <a href="#blockchainwithforks">Uma blockchain com bifurca√ß√µes</a> demonstra uma blockchain com dois forks. Na altura do bloco 4, ocorreu um fork de um √∫nico bloco. Esse √© o tipo de fork espont√¢neo que vimos em <a href="#forks">[forks]</a>. Ao ser minerado o bloco 5, a rede reconvergiu em uma √∫nica cadeia, e com isso o fork foi resolvido.</p>
</div>
<div id="blockchainwithforks" class="imageblock data-line-963">
<div class="content">
<img src="images/mbc2_1009.png" alt="A blockchain with forks">
</div>
<div class="title">Figure 71. Uma blockchain com bifurca√ß√µes</div>
</div>
<div class="paragraph data-line-965">
<p>Mais tarde, no entanto, na altura do bloco 6, ocorreu um hard fork. Vamos supor que uma nova implementa√ß√£o do cliente tenha sido lan√ßada com uma mudan√ßa nas regras de consenso. A partir da altura do bloco 7, os mineradores que estiverem executando essa nova implementa√ß√£o aceitar√£o um novo tipo de assinatura digital, vamos cham√°-la de assinatura "Smores", que n√£o √© baseada em ECDSA. Imediatamente depois, um n√≥ executando a nova implementa√ß√£o cria uma transa√ß√£o que cont√©m uma assinatura Smores, e, a seguir, um minerador com o software atualizado minera o bloco 7b, que cont√©m esta transa√ß√£o.</p>
</div>
<div class="paragraph data-line-967">
<p>Qualquer n√≥ ou minerador que n√£o tiver atualizado o software para validar as assinaturas Smores agora √© incapaz de processar o bloco 7b. Do ponto de vista deles, eles consideram inv√°lidos tanto a transa√ß√£o que continha uma assinatura Smores quanto o bloco 7b que continha essa transa√ß√£o, pois eles est√£o avaliando as transa√ß√µes e os blocos de acordo com as antigas regras de consenso. Esses n√≥s rejeitar√£o a transa√ß√£o e o bloco, e n√£o os propagar√£o. Os mineradores que ainda estiverem usando as regras antigas n√£o aceitar√£o o bloco 7b e continuar√£o a minerar um bloco candidato cujo pai √© o bloco 6. Na verdade, os mineradores que usam as regras antigas podem nem mesmo receber o bloco 7b, se todos os n√≥s aos quais eles est√£o conectados tamb√©m estiverem obedecendo as regras antigas e, portanto, n√£o estiverem propagando o bloco. Por fim, eles minerar√£o o bloco 7a, que √© v√°lido sob as regras antigas e n√£o cont√©m nenhuma transa√ß√£o com assinaturas Smores.</p>
</div>
<div class="paragraph data-line-969">
<p>As duas cadeias continuam divergindo a partir deste ponto. Os mineradores na cadeia "b" continuar√£o a aceitar e minerar transa√ß√µes contendo assinaturas Smores, enquanto os mineradores na cadeia "a" continuar√£o a ignorar essas transa√ß√µes. Mesmo se o bloco 8b n√£o contiver nenhuma transa√ß√£o com assinatura Smores, os mineradores na cadeia "a" n√£o ser√£o capazes de process√°-la. Para eles, o bloco 8b parece ser um bloco √≥rf√£o, pois seu bloco pai 7b n√£o √© reconhecido como um bloco v√°lido.</p>
</div>
<div class="paragraph data-line-971">
<p>==== Hard Forks: Software, Rede, Minera√ß√£o e Cadeia</p>
</div>
<div class="paragraph data-line-973">
<p>Para desenvolvedores de software, o termo "fork" tem outro significado, o que acaba gerando ainda mais confus√£o para o significado do termo "hard fork". No software de c√≥digo aberto, um <em>fork</em> ocorre quando um grupo de desenvolvedores resolve seguir um objetivo diferente e inicia uma implementa√ß√£o concorrente de um projeto de c√≥digo aberto. J√° discutimos duas circunst√¢ncias que levar√£o a um hard fork no bitcoin: um bug nas regras de consenso e uma modifica√ß√£o deliberada das regras de consenso. No caso de uma modifica√ß√£o deliberada nas regras de consenso, um fork do software precede o hard fork. No entanto, para que esse tipo de hard fork ocorra, uma nova implementa√ß√£o de software das regras de consenso deve ser desenvolvida, adotada e lan√ßada.</p>
</div>
<div class="paragraph data-line-975">
<p>Alguns exemplos de forks de software que tentaram alterar as regras de consenso incluem o Bitcoin XT, o Bitcoin Classic e, mais recentemente, o Bitcoin Unlimited. No entanto, nenhum desses forks de software resultou em um hard fork. Embora um fork de software seja uma pr√©-condi√ß√£o necess√°ria, ele n√£o √© suficiente por si s√≥ para que um hard fork ocorra. Para que um hard fork ocorra, a implementa√ß√£o concorrente deve ser adotada e as novas regras devem ser ativadas por mineradores, carteiras e n√≥s intermedi√°rios. Por outro lado, existem v√°rias implementa√ß√µes alternativas do Bitcoin Core, e at√© mesmo forks de software, que n√£o alteram as regras de consenso e, contanto que n√£o tenham um bug, podem coexistir na rede e interoperar sem causar um hard fork.</p>
</div>
<div class="paragraph data-line-977">
<p>As regras de consenso podem diferir de maneiras √≥bvias e expl√≠citas na valida√ß√£o de transa√ß√µes ou blocos. As regras tamb√©m podem diferir de maneiras mais sutis, na implementa√ß√£o das regras de consenso, quando elas se aplicam a scripts do bitcoin ou primitivos criptogr√°ficos, como assinaturas digitais. Finalmente, as regras de consenso podem diferir de maneiras imprevistas devido a restri√ß√µes de consenso impl√≠citas impostas por limita√ß√µes do sistema ou detalhes de implementa√ß√£o. Um exemplo deste √∫ltimo tipo de hard fork foi visto no hard fork inesperado que ocorreu durante a atualiza√ß√£o do Bitcoin Core da vers√£o 0.7 para a 0.8, que foi causado por uma limita√ß√£o na implementa√ß√£o da Berkeley DB, usada para armazenar os blocos.</p>
</div>
<div class="paragraph data-line-979">
<p>Conceitualmente, podemos imaginar que um hard fork se desenvolve em quatro est√°gios: uma bifurca√ß√£o do software, uma bifurca√ß√£o da rede, uma bifurca√ß√£o da minera√ß√£o e uma bifurca√ß√£o da cadeia.</p>
</div>
<div class="paragraph data-line-981">
<p>O processo come√ßa quando uma implementa√ß√£o alternativa do cliente, com regras de consenso modificadas, √© criada pelos desenvolvedores.</p>
</div>
<div class="paragraph data-line-983">
<p>Quando essa implementa√ß√£o concorrente √© empregada na rede, uma certa porcentagem de mineradores, usu√°rios de carteira e n√≥s intermedi√°rios podem adotar e executar essa implementa√ß√£o. Dependendo se as novas regras de consenso aplicam-se a blocos, transa√ß√µes ou algum outro aspecto do sistema, uma nova bifurca√ß√£o poder√° surgir. Se as novas regras de consenso forem aplicadas a transa√ß√µes, uma carteira que cria uma transa√ß√£o sob as novas regras pode precipitar uma bifurca√ß√£o de rede, seguida por um hard fork quando a transa√ß√£o for minerada em um bloco. Se as novas regras forem aplicadas a blocos, o processo de hard fork come√ßar√° quando um bloco for minerado de acordo com as novas regras.</p>
</div>
<div class="paragraph data-line-985">
<p>Primeiro, a rede bifurcar√°. Os n√≥s baseados na implementa√ß√£o original das regras de consenso rejeitar√£o todas as transa√ß√µes e blocos criados de acordo com as novas regras. Al√©m disso, os n√≥s que seguem as regras de consenso originais ir√£o temporariamente banir e desconectar-se de quaisquer n√≥s que estejam lhes enviando essas transa√ß√µes e blocos inv√°lidos. Como resultado, a rede ser√° dividida em duas: os n√≥s antigos permanecer√£o conectados apenas aos n√≥s antigos e os novos n√≥s ser√£o conectados apenas aos novos n√≥s. Assim que uma √∫nica transa√ß√£o ou bloco usando as novas regras propagar-se pela rede, a rede se dividir√° em duas.</p>
</div>
<div class="paragraph data-line-987">
<p>Quando um minerador usando as novas regras minerar um bloco, o poder de minera√ß√£o e a cadeia tamb√©m se bifurcar√£o. Os novos mineradores minerar√£o em cima do novo bloco, enquanto os antigos mineradores minerar√£o uma cadeia separada que √© baseada nas regras antigas. A rede dividida far√° com que os mineradores operando em regras de consenso separadas provavelmente n√£o recebam os blocos uns dos outros, pois eles est√£o conectados a duas redes separadas.</p>
</div>
<div class="paragraph data-line-989">
<p>==== Mineradores Divergentes e Dificuldade</p>
</div>
<div class="paragraph data-line-991">
<p>√Ä medida que os mineradores divergem na minera√ß√£o em duas cadeias diferentes, o poder de <em>hashing</em> √© dividido entre as cadeias. O poder de minera√ß√£o pode ser dividido em qualquer propor√ß√£o entre as duas cadeias. As novas regras podem ser seguidas tanto por uma pequena minoria, quanto por uma grande maioria do poder de minera√ß√£o.</p>
</div>
<div class="paragraph data-line-993">
<p>Vamos supor, por exemplo, uma divis√£o de 80%&#x2013;20%, com a maioria do poder de minera√ß√£o usando as novas regras de consenso. Suponhamos tamb√©m que a bifurca√ß√£o ocorra imediatamente ap√≥s um per√≠odo de reajuste do alvo.</p>
</div>
<div class="paragraph data-line-995">
<p>Cada uma das duas cadeias herdaria a dificuldade do per√≠odo de reajuste de alvo. As novas regras de consenso teriam comprometido com elas 80% do poder de minera√ß√£o anteriormente dispon√≠vel. Do ponto de vista dessa cadeia, o poder de minera√ß√£o diminuiu repentinamente 20% em rela√ß√£o ao per√≠odo anterior. Os blocos ser√£o encontrados em m√©dia a cada 12,5 minutos, o que representa a queda de 20% no poder de minera√ß√£o dispon√≠vel para estender essa cadeia. Esse ritmo de emiss√£o de blocos permanecer√° (n√£o havendo qualquer mudan√ßa no poder de <em>hashing</em>) at√© que os 2.016 blocos sejam minerados, o que levar√° aproximadamente 25.200 minutos (a 12,5 minutos por bloco), ou 17,5 dias. Ap√≥s 17,5 dias, um reajuste do alvo ocorrer√° e a dificuldade ser√° ajustada (reduzida em 20%) para que novamente sejam produzidos blocos a cada 10 minutos, levando em considera√ß√£o a quantidade reduzida de poder de <em>hashing</em> nesta cadeia.</p>
</div>
<div class="paragraph data-line-997">
<p>A cadeia minorit√°ria, minerando sob as regras antigas e com apenas 20% do poder de <em>hashing</em>, enfrentar√° uma tarefa muito mais dif√≠cil. Nessa cadeia, os blocos agora ser√£o minerados a cada 50 minutos, em m√©dia. A dificuldade n√£o ser√° ajustada durante os pr√≥ximos 2.016 blocos, que levar√£o 100.800 minutos, ou cerca de 10 semanas, para serem minerados. Assumindo uma capacidade fixa por bloco, isso tamb√©m resultar√° em uma redu√ß√£o em cinco vezes na capacidade de transa√ß√µes, pois h√° menos blocos dispon√≠veis a cada hora para registrar as transa√ß√µes.</p>
</div>
<div class="paragraph data-line-999">
<p>==== Hard Forks Contenciosos</p>
</div>
<div class="paragraph data-line-1001">
<p>O desenvolvimento de software de consenso est√° apenas dando os seus primeiros passos. Assim como o surgimento do desenvolvimento de c√≥digo aberto mudou os m√©todos e os produtos de software e criou novas metodologias, novas ferramentas e novas comunidades, o desenvolvimento de software de consenso tamb√©m representa uma nova fronteira na ci√™ncia da computa√ß√£o. De todos os debates, experimentos e conflitos no <em>roadmap</em> do desenvolvimento do bitcoin, veremos o surgimento de novas ferramentas, pr√°ticas, metodologias e comunidades de desenvolvimento.</p>
</div>
<div class="paragraph data-line-1003">
<p>Os hard forks s√£o vistos como arriscados porque eles for√ßam uma minoria a ou atualizar o software, ou permanecer em uma cadeia minorit√°ria. O risco de dividir todo o sistema em dois sistemas concorrentes √© visto por muitos como um risco inaceit√°vel. Como resultado, muitos desenvolvedores relutam em usar o mecanismo de hard fork para implementar atualiza√ß√µes nas regras de consenso, a menos que haja suporte quase un√¢nime de toda a rede. Quaisquer propostas hard fork que n√£o tenham apoio quase un√¢nime s√£o consideradas muito "contenciosas" para serem tentadas, sob o risco de ocorrer uma divis√£o do sistema.</p>
</div>
<div class="paragraph data-line-1005">
<p>A quest√£o dos hard forks √© altamente controversa na comunidade de desenvolvimento do bitcoin, especialmente no que se refere a quaisquer altera√ß√µes propostas √†s regras de consenso que controlam o limite m√°ximo do tamanho do bloco. Alguns desenvolvedores se op√µem a qualquer tipo de hard fork, pois consideram isso muito arriscado. Outros enxergam o mecanismo do hard fork como uma ferramenta essencial para atualizar as regras de consenso de uma forma que evite "d√≠vidas t√©cnicas" e forne√ßa uma ruptura n√≠tida com o passado. E, por √∫ltimo, alguns desenvolvedores enxergam os hard forks como um mecanismo que deve ser usado raramente, com muito planejamento pr√©vio e apenas sob consenso quase un√¢nime.</p>
</div>
<div class="paragraph data-line-1007">
<p>Algumas novas metodologias j√° foram desenvolvidas para lidar com os riscos dos hard forks. Na pr√≥xima se√ß√£o, veremos os soft forks e os m√©todos BIP-34 e BIP-9 para sinaliza√ß√£o e ativa√ß√£o de modifica√ß√µes de consenso.</p>
</div>
<div class="paragraph data-line-1009">
<p>==== Soft Forks</p>
</div>
<div class="paragraph data-line-1011">
<p>Nem todas as altera√ß√µes de regras de consenso geram hard forks. As √∫nicas altera√ß√µes de consenso que geram bifurca√ß√µes s√£o aquelas que s√£o incompat√≠veis "daqui para a frente". Se a altera√ß√£o for implementada de forma que um cliente n√£o atualizado ainda veja a transa√ß√£o ou o bloco como v√°lido de acordo com as regras anteriores, a altera√ß√£o pode ocorrer sem uma bifurca√ß√£o.</p>
</div>
<div class="paragraph data-line-1013">
<p>O termo <em>soft fork</em> foi introduzido para distinguir este m√©todo de atualiza√ß√£o de um "hard fork". Na pr√°tica, um soft fork n√£o √© sequer uma bifurca√ß√£o. Um soft fork √© uma mudan√ßa das regras de consenso compat√≠vel com clientes que n√£o foram atualizados, pois permite que os clientes n√£o atualizados continuem a operar em consenso com as novas regras.</p>
</div>
<div class="paragraph data-line-1015">
<p>Um aspecto dos soft forks que n√£o √© imediatamente √≥bvio √© que as atualiza√ß√µes de soft fork s√≥ podem ser usadas para restringir as regras de consenso, e n√£o para expandi-las. Para serem compat√≠veis com todos os clientes daqui para a frente (os atualizados e os n√£o atualizados), as transa√ß√µes e os blocos criados sob as novas regras devem ser v√°lidos tamb√©m sob as regras antigas, mas n√£o vice-versa. As novas regras podem apenas limitar o que √© v√°lido; caso contr√°rio, elas gerar√£o um hard fork quando forem rejeitadas pelos clientes que n√£o foram atualizados e ainda seguem as regras antigas.</p>
</div>
<div class="paragraph data-line-1017">
<p>Os soft forks podem ser implementados de v√°rias maneiras&#x2014;o termo n√£o especifica um m√©todo em particular, mas sim um conjunto de m√©todos que t√™m uma caracter√≠stica em comum: eles n√£o exigem que todos os n√≥s atualizem, nem for√ßam os n√≥s n√£o atualizados para fora do consenso.</p>
</div>
<div class="paragraph data-line-1019">
<p>===== Soft forks redefinindo c√≥digos operacionais NOP</p>
</div>
<div class="paragraph data-line-1021">
<p>V√°rios soft forks foram implementados no bitcoin com base na reinterpreta√ß√£o de c√≥digos operacionais NOP. O Script do bitcoin tinha dez c√≥digos operacionais reservados para uso futuro, do NOP1 ao NOP10. De acordo com as regras de consenso, a presen√ßa desses c√≥digos operacionais em um script √© interpretada como um operador nulo-potente, o que significa que eles n√£o t√™m efeito. A execu√ß√£o continua ap√≥s o c√≥digo operacional NOP, como se ele n√£o existisse.</p>
</div>
<div class="paragraph data-line-1023">
<p>Um soft fork, portanto, pode modificar a sem√¢ntica de um c√≥digo NOP para dar a ele um novo significado. Por exemplo, a BIP-65 (CHECKLOCKTIMEVERIFY) reinterpretou o c√≥digo operacional NOP2. Os clientes que implementam a BIP-65 interpretam o NOP2 como OP_CHECKLOCKTIMEVERIFY e imp√µem uma regra de consenso de <em>locktime</em> absoluto em UTXOs que cont√™m este c√≥digo operacional em seus scripts de travamento. Essa altera√ß√£o √© um soft fork, pois uma transa√ß√£o que √© v√°lida sob a BIP-65 tamb√©m √© v√°lida em qualquer cliente que n√£o tenha implementado a BIP-65. Para os clientes antigos, o script cont√©m um c√≥digo NOP, que √© ignorado.</p>
</div>
<div class="paragraph data-line-1025">
<p>===== Outras maneiras de se atualizar com soft fork</p>
</div>
<div class="paragraph data-line-1027">
<p>A reinterpreta√ß√£o dos c√≥digos operacionais NOP foi planejada para ser um mecanismo √≥bvio para atualiza√ß√µes de consenso. Recentemente, no entanto, foi introduzido outro mecanismo de soft fork que n√£o depende dos c√≥digos operacionais NOP para um tipo muito espec√≠fico de mudan√ßa de consenso. Esse mecanismo √© examinado com mais detalhes em <a href="#segwit">[segwit]</a>. A segwit √© uma mudan√ßa arquitetural na estrutura de uma transa√ß√£o, que move o script de destravamento (a testemunha) de dentro da transa√ß√£o para uma estrutura de dados externa (segregando-a). A segwit foi inicialmente concebida para ser uma atualiza√ß√£o introduzida atrav√©s de um hard fork, pois ela modificava uma estrutura fundamental (a transa√ß√£o). Em novembro de 2015, um desenvolvedor trabalhando no Bitcoin Core prop√¥s um mecanismo por meio do qual a segwit poderia ser introduzida atrav√©s de um soft fork. O mecanismo usado para isso foi uma modifica√ß√£o do script de travamento da UTXO criado sob regras da segwit, de maneira que os clientes n√£o atualizados vissem o script de travamento como resgat√°vel por qualquer script de destravamento. Como resultado, foi poss√≠vel introduzir a segwit com um soft fork, n√£o sendo mais necess√°rio exigir que cada n√≥ fosse atualizado ou que se separasse da cadeia principal.</p>
</div>
<div class="paragraph data-line-1029">
<p>√â prov√°vel que ainda sejam descobertos novos mecanismos pelos quais as atualiza√ß√µes possam ser feitas de uma maneira que seja compat√≠vel "daqui para a frente", assim como acontece em um soft fork.</p>
</div>
<div class="paragraph data-line-1031">
<p>==== Cr√≠ticas aos Soft Forks</p>
</div>
<div class="paragraph data-line-1033">
<p>Os soft forks baseados nos c√≥digos operacionais NOP geralmente n√£o s√£o controversos. Os c√≥digos operacionais NOP foram implementados no Bitcoin Script com o objetivo expl√≠cito de permitir atualiza√ß√µes n√£o disruptivas.</p>
</div>
<div class="paragraph data-line-1035">
<p>No entanto, muitos desenvolvedores consideram que outros m√©todos de atualiza√ß√£o com soft fork tem desvantagens inaceit√°veis. As cr√≠ticas mais comuns √†s altera√ß√µes com soft fork incluem:</p>
</div>
<div class="dlist data-line-1037">
<dl>
<dt class="hdlist1">D√≠vida t√©cnica</dt>
<dd>
<p>Como os soft forks s√£o tecnicamente mais complexos do que uma atualiza√ß√£o de hard fork, eles introduzem uma <em>d√≠vida t√©cnica</em>, um termo que se refere ao aumento do custo futuro de manuten√ß√£o do c√≥digo devido √†s limita√ß√µes dos designs escolhidos no passado. A complexidade do c√≥digo, por sua vez, aumenta a probabilidade da ocorr√™ncia de bugs e vulnerabilidades de seguran√ßa.</p>
</dd>
<dt class="hdlist1">Relaxamento da valida√ß√£o</dt>
<dd>
<p>Os clientes n√£o atualizados enxergam transa√ß√µes como v√°lidas, sem avaliar as regras de consenso modificadas. Na pr√°tica, os clientes n√£o atualizados n√£o est√£o validando usando toda a gama das regras de consenso, pois eles n√£o conhecem as novas regras. Isso se aplica a atualiza√ß√µes baseadas em NOP, bem como a outras atualiza√ß√µes de soft fork.</p>
</dd>
<dt class="hdlist1">Atualiza√ß√µes irrevers√≠veis</dt>
<dd>
<p>Como os soft forks criam transa√ß√µes com restri√ß√µes de consenso adicionais, na pr√°tica, eles acabam tornando-se atualiza√ß√µes irrevers√≠veis. Se um upgrade de soft fork fosse revertido ap√≥s a ativa√ß√£o, qualquer transa√ß√£o criada sob as novas regras poderia resultar em uma perda de fundos sob as regras antigas. Por exemplo, se uma transa√ß√£o CLTV for avaliada sob as regras antigas, n√£o h√° restri√ß√£o de <em>timelock</em> e ela pode ser gasta a qualquer momento. Portanto, os cr√≠ticos afirmam que se um soft fork problem√°tico tivesse que ser revertido por causa de um bug, isso quase certamente levaria a uma perda de fundos.</p>
</dd>
</dl>
</div>
<div id="softforksignaling" class="paragraph data-line-1044">
<p>=== Sinaliza√ß√£o de Soft Fork com Vers√£o de Bloco</p>
</div>
<div class="paragraph data-line-1046">
<p>Como os soft forks permitem que os clientes n√£o atualizados continuem a operar dentro do consenso, o mecanismo para "ativar" um soft fork ocorre atrav√©s dos mineradores sinalizando prontid√£o: a maioria dos mineradores deve concordar que est√° pronta e disposta a fazer cumprir as novas regras de consenso. Para coordenar suas a√ß√µes, existe um mecanismo de sinaliza√ß√£o que lhes permite mostrar seu apoio a uma mudan√ßa de regra de consenso. Este mecanismo foi introduzido com a ativa√ß√£o da BIP-34 em mar√ßo de 2013 e depois foi substitu√≠do pela ativa√ß√£o da BIP-9 em julho de 2016.</p>
</div>
<div class="paragraph data-line-1048">
<p>==== Sinaliza√ß√£o e Ativa√ß√£o da BIP-34</p>
</div>
<div class="paragraph data-line-1050">
<p>A primeira implementa√ß√£o, na BIP-34, usou o campo da vers√£o do bloco para permitir que os mineradores sinalizassem a prontid√£o para uma mudan√ßa espec√≠fica de regra de consenso. Antes da BIP-34, a vers√£o do bloco era definida como "1" por <em>conven√ß√£o</em>, e n√£o imposta por <em>consenso</em>.</p>
</div>
<div class="paragraph data-line-1052">
<p>A BIP-34 definiu uma mudan√ßa de regra de consenso que exigia que o campo dos dados coinbase na entrada de uma transa√ß√£o coinbase contivesse a altura do bloco. Antes da BIP-34, os dados coinbase podiam conter quaisquer dados arbitr√°rios que os mineradores decidissem incluir. Ap√≥s a ativa√ß√£o da BIP-34, os blocos v√°lidos deveriam conter uma altura de bloco espec√≠fica no in√≠cio dos dados coinbase e ser identificados com um n√∫mero de vers√£o maior ou igual a "2".</p>
</div>
<div class="paragraph data-line-1054">
<p>Para sinalizar a mudan√ßa e a ativa√ß√£o da BIP-34, os mineradores definiram a vers√£o do bloco para "2", ao inv√©s de "1". Isso n√£o invalidou imediatamente os blocos da vers√£o "1". Uma vez ativada, os blocos da vers√£o "1" se tornariam inv√°lidos e todos os blocos da vers√£o "2" seriam obrigados a conter a altura do bloco na coinbase para serem v√°lidos.</p>
</div>
<div class="paragraph data-line-1056">
<p>A BIP-34 definiu um mecanismo de ativa√ß√£o em duas etapas, com base em uma janela temporal de 1.000 blocos. Um minerador sinalizaria a sua prontid√£o individual para a BIP-34 construindo blocos com o n√∫mero de vers√£o "2". A rigor, esses blocos ainda n√£o precisavam obedecer √† nova regra de consenso de incluir a altura do bloco na transa√ß√£o coinbase, pois a regra de consenso ainda n√£o havia sido ativada. As regras de consenso foram ativadas em duas etapas:</p>
</div>
<div class="ulist data-line-1058">
<ul>
<li class="data-line-1058">
<p>Se 75% (750 dos 1.000 blocos mais recentes) estiverem marcados com a vers√£o "2", ent√£o os blocos da vers√£o "2" devem conter a altura do bloco na transa√ß√£o coinbase ou eles ser√£o rejeitados como inv√°lidos. Os blocos da vers√£o "1" ainda s√£o aceitos pela rede e n√£o precisam conter a altura do bloco. As regras de consenso antigas e novas coexistem durante este per√≠odo.</p>
</li>
<li class="data-line-1060">
<p>Quando 95% (950 dos 1.000 blocos mais recentes) forem da vers√£o "2", os blocos da vers√£o "1" n√£o mais ser√£o considerados v√°lidos. Os blocos da vers√£o "2" s√≥ ser√£o v√°lidos se eles contiverem a altura do bloco na coinbase (assim como na etapa anterior). Depois disso, todos os blocos devem estar de acordo com as novas regras de consenso, e todos os blocos v√°lidos devem conter a altura do bloco na transa√ß√£o coinbase.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1062">
<p>Ap√≥s a sinaliza√ß√£o e ativa√ß√£o bem-sucedidas de acordo com as regras da BIP-34, este mecanismo foi usado mais duas vezes para ativar soft forks:</p>
</div>
<div class="ulist data-line-1064">
<ul>
<li class="data-line-1064">
<p>A codifica√ß√£o DER estrita de assinaturas da <a href="https://github.com/bitcoin/bips/blob/master/bip-0066.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0066.mediawiki">BIP-66</a> foi ativada pela sinaliza√ß√£o de estilo BIP-34 com uma vers√£o de bloco "3" e invalidando os blocos da vers√£o "2".</p>
</li>
<li class="data-line-1066">
<p>O CHECKLOCKTIMEVERIFY da <a href="https://github.com/bitcoin/bips/blob/master/bip-0065.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0065.mediawiki">BIP-65</a> foi ativado pela sinaliza√ß√£o do estilo BIP-34 com uma vers√£o de bloco "4" e invalidando os blocos da vers√£o "3".</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1068">
<p>Ap√≥s a ativa√ß√£o da BIP-65, o mecanismo de sinaliza√ß√£o e ativa√ß√£o da BIP-34 foi aposentado e substitu√≠do pelo mecanismo de sinaliza√ß√£o da BIP-9, descrito a seguir.</p>
</div>
<div class="paragraph data-line-1070">
<p>O padr√£o √© definido na <a href="https://github.com/bitcoin/bips/blob/master/bip-0034.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0034.mediawiki">BIP-34 (Bloco v2, Altura na Coinbase)</a>.</p>
</div>
<div class="paragraph data-line-1072">
<p>==== Sinaliza√ß√£o e Ativa√ß√£o da BIP-9</p>
</div>
<div class="paragraph data-line-1074">
<p>O mecanismo usado pela BIP-34, BIP-66 e BIP-65 foi bem-sucedido na ativa√ß√£o de tr√™s soft forks. No entanto, ele acabou sendo substitu√≠do, pois tinha v√°rias limita√ß√µes:</p>
</div>
<div class="ulist data-line-1076">
<ul>
<li class="data-line-1076">
<p>Como o valor inteiro da vers√£o do bloco era utilizado, apenas um soft fork poderia ser ativado por vez, portanto, era necess√°ria uma coordena√ß√£o entre as propostas do soft fork e um acordo sobre sua prioriza√ß√£o e ordem de ativa√ß√£o.</p>
</li>
<li class="data-line-1078">
<p>Al√©m disso, como a vers√£o do bloco foi incrementada, o mecanismo n√£o oferecia uma maneira direta de se rejeitar uma altera√ß√£o e ent√£o propor uma diferente. Se os clientes antigos ainda estivessem em execu√ß√£o, eles poderiam confundir a sinaliza√ß√£o de uma nova altera√ß√£o como se fosse uma sinaliza√ß√£o da altera√ß√£o rejeitada anteriormente.</p>
</li>
<li class="data-line-1080">
<p>Cada nova altera√ß√£o reduzia de maneira irrevers√≠vel as vers√µes de bloco dispon√≠veis para altera√ß√µes futuras.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1082">
<p>A BIP-9 foi proposta para superar esses desafios e melhorar o ritmo e a facilidade de implementa√ß√£o de altera√ß√µes futuras.</p>
</div>
<div class="paragraph data-line-1084">
<p>A BIP-9 interpreta a vers√£o do bloco como um campo de bits ao inv√©s de um n√∫mero inteiro. Como a vers√£o do bloco foi originalmente usada como um n√∫mero inteiro, as vers√µes 1 a 4, apenas 29 bits permanecem dispon√≠veis para serem usados como um campo de bits. Isso deixa 29 bits para poderem ser usados para sinalizar prontid√£o, de forma independente e simult√¢nea, a 29 propostas diferentes.</p>
</div>
<div class="paragraph data-line-1086">
<p>A BIP-9 tamb√©m define um tempo m√°ximo para sinaliza√ß√£o e ativa√ß√£o. Dessa forma, os mineradores n√£o precisam sinalizar para sempre. Se uma proposta n√£o for ativada dentro do per√≠odo TIMEOUT (definido na proposta), a proposta √© considerada rejeitada. A proposta pode ser enviada novamente para sinaliza√ß√£o com um bit diferente, renovando o per√≠odo de ativa√ß√£o.</p>
</div>
<div class="paragraph data-line-1088">
<p>Al√©m disso, ap√≥s o TIMEOUT ter expirado e um recurso ter sido ativado ou rejeitado, o bit de sinaliza√ß√£o pode ser reutilizado para outra funcionalidade, sem causar confus√£o. Portanto, at√© 29 altera√ß√µes podem ser sinalizadas em paralelo e ap√≥s o TIMEOUT os bits podem ser "reciclados" para propor novas altera√ß√µes.</p>
</div>
<div class="admonitionblock note data-line-1091">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-1092">
<p>Embora os bits de sinaliza√ß√£o possam ser reutilizados ou reciclados, desde que o per√≠odo de vota√ß√£o n√£o se sobreponha, os autores da BIP-9 recomendam que os bits sejam reutilizados apenas quando necess√°rio, visto que um comportamento inesperado pode ocorrer devido a bugs em softwares mais antigos. Em suma, provavelmente n√£o veremos reutiliza√ß√µes at√© que todos os 29 bits tenham sido usados pelo menos uma vez.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1095">
<p>As altera√ß√µes propostas s√£o identificadas por uma estrutura de dados que cont√©m os seguintes campos:</p>
</div>
<div class="dlist data-line-1097">
<dl>
<dt class="hdlist1">name</dt>
<dd>
<p>Uma breve descri√ß√£o usada para distinguir entre as propostas. Na maioria das vezes, a BIP descrevendo a proposta, como "bipN", onde N √© o n√∫mero da BIP.</p>
</dd>
<dt class="hdlist1">bit</dt>
<dd>
<p>0 a 28, o bit na vers√£o de bloco que os mineradores usam para sinalizar aprova√ß√£o para esta proposta.</p>
</dd>
<dt class="hdlist1">starttime</dt>
<dd>
<p>O momento (baseado no <em>Median Time Past</em>, ou MTP) em que a sinaliza√ß√£o come√ßa, ap√≥s o qual o valor do bit √© interpretado como sinaliza√ß√£o de prontid√£o para a proposta.</p>
</dd>
<dt class="hdlist1">endtime</dt>
<dd>
<p>O momento (baseado no MTP) ap√≥s o qual a altera√ß√£o √© considerada rejeitada, caso ela n√£o tenha atingido o limiar de ativa√ß√£o.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-1105">
<p>Ao contr√°rio da BIP-34, a BIP-9 conta a sinaliza√ß√£o de ativa√ß√£o em intervalos inteiros com base no per√≠odo de reajuste do alvo de dificuldade, que √© de 2.016 blocos. Para cada per√≠odo de reajuste do alvo, se a soma dos blocos sinalizando para uma proposta exceder 95% (1.916 de 2.016), a proposta ser√° ativada um per√≠odo de reajuste do alvo depois.</p>
</div>
<div class="paragraph data-line-1107">
<p>A BIP-9 oferece um diagrama de estado da proposta para ilustrar os v√°rios est√°gios e transi√ß√µes de uma proposta, conforme demonstrado na <a href="#bip9states">Diagrama de transi√ß√£o de estado da BIP-9</a>.</p>
</div>
<div class="paragraph data-line-1109">
<p>As propostas come√ßam no estado DEFINED (definida), uma vez que seus par√¢metros s√£o conhecidos (definidos) no software do bitcoin. Para blocos com MTP ap√≥s o <em>starttime</em> (o momento em que a sinaliza√ß√£o come√ßa), o estado da proposta muda para STARTED (iniciada). Se o limiar (valor m√≠nimo) de vota√ß√£o for excedido em um per√≠odo de reajuste do alvo e o <em>timeout</em> (tempo limite) n√£o tiver sido excedido, o estado da proposta muda para LOCKED_IN (travada). Um per√≠odo de reajuste do alvo depois, a proposta se torna ACTIVE (ativa). Uma vez atingido o estado ACTIVE, as propostas permanecem nesse estado perpetuamente. Se o <em>timeout</em> (tempo limite) expirar antes de o limiar (valor m√≠nimo) de vota√ß√£o ser atingido, o estado da proposta muda para FAILED, indicando uma proposta rejeitada. As propostas rejeitadas permanecem no estado FAILED perpetuamente.</p>
</div>
<div id="bip9states" class="imageblock data-line-1113">
<div class="content">
<img src="images/mbc2_1010.png" alt="BIP-9 Proposal State Transition Diagram">
</div>
<div class="title">Figure 72. Diagrama de transi√ß√£o de estado da BIP-9</div>
</div>
<div class="paragraph data-line-1115">
<p>A BIP-9 foi implementada pela primeira vez para a ativa√ß√£o do CHECKSEQUENCEVERIFY e das BIPs associadas (68, 112, 113). A proposta chamada "csv" foi ativada com sucesso em julho de 2016.</p>
</div>
<div class="paragraph data-line-1117">
<p>O padr√£o √© definido na <a href="https://github.com/bitcoin/bips/blob/master/bip-0009.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0009.mediawiki">BIP-9 (Bits de vers√£o com tempo limite e atraso)</a>.</p>
</div>
<div class="paragraph data-line-1119">
<p>=== Desenvolvimento de Software de Consenso</p>
</div>
<div class="paragraph data-line-1121">
<p>O software de consenso continua a evoluir e h√° muitas discuss√µes sobre os v√°rios mecanismos que s√£o usados para alterar as regras de consenso. Por sua pr√≥pria natureza, o bitcoin estabelece um n√≠vel de exig√™ncia muito alto na coordena√ß√£o e no consenso para mudan√ßas. Por ser um sistema descentralizado, ele n√£o possui uma "autoridade" que possa impor sua vontade aos participantes da rede. O poder √© difundido entre v√°rios constituintes, como mineradores, desenvolvedores core, desenvolvedores de carteira, corretoras, comerciantes e usu√°rios finais. As decis√µes n√£o podem ser tomadas unilateralmente por nenhum desses constituintes. Por exemplo, embora os mineradores possam teoricamente mudar as regras por maioria simples (51%), eles s√£o limitados pelo consentimento dos outros constituintes. Se eles atuarem unilateralmente, os demais participantes podem simplesmente recusar-se a segui-los, mantendo a atividade econ√¥mica em uma cadeia minorit√°ria. Sem atividade econ√¥mica (transa√ß√µes, comerciantes, carteiras, corretoras), os mineradores estar√£o minerando uma moeda sem valor, com blocos vazios. Esta distribui√ß√£o de poder significa que todos os participantes devem agir de maneira coordenada, ou nenhuma mudan√ßa pode ser feita. O <em>status quo</em> √© o estado est√°vel desse sistema, com a possibilidade de apenas algumas mudan√ßas, caso haja um forte consenso por parte de uma ampla maioria. A exig√™ncia de uma vota√ß√£o m√≠nima de 95% para os soft forks reflete essa realidade.</p>
</div>
<div class="paragraph data-line-1123">
<p>√â importante reconhecer que n√£o existe uma solu√ß√£o perfeita para o desenvolvimento de consenso. Tanto os hard forks quanto os soft forks possuem limita√ß√µes. Para alguns tipos de altera√ß√µes, os soft forks podem ser uma escolha melhor; para outros tipos, os hard forks podem ser uma escolha melhor. N√£o existe uma escolha perfeita; os dois tipos de forks carregam riscos. A √∫nica caracter√≠stica constante do desenvolvimento de software de consenso √© que a mudan√ßa √© dif√≠cil e o consenso for√ßa um acordo.</p>
</div>
<div class="paragraph data-line-1125">
<p>Alguns enxergam isso como sendo uma fraqueza dos sistemas de consenso. Com o tempo, voc√™ poder√° enxergar isso da mesma maneira que eu enxergo, como sendo a maior for√ßa do sistema.</p>
</div>
<div class="paragraph data-line-1127">
<p>Unresolved directive in &lt;stdin&gt; - include::for_use_mastering-bitcoin_chapter-11_pt_BR.adoc[]</p>
</div>
<div class="paragraph data-line-1129">
<p>Unresolved directive in &lt;stdin&gt; - include::for_use_mastering-bitcoin_chapter-12_pt_BR.adoc[]</p>
</div>
<div id="satoshi_whitepaper" class="paragraph data-line-1133">
<p>== O Whitepaper do Bitcoin por Satoshi Nakamoto</p>
</div>
<div class="admonitionblock note data-line-1136">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-1137">
<p>Esta √© a tradu√ß√£o para o portugu√™s do Brasil do <em>whitepaper</em> original do bitcoin, reproduzido em sua √≠ntegra como foi publicado por Satoshi Nakamoto em outubro de 2008.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1140">
<p>=== Bitcoin - Um Sistema de Dinheiro em Esp√©cie Eletr√¥nico Par-a-Par</p>
</div>
<div class="paragraph data-line-1142">
<p>Satoshi Nakamoto</p>
</div>
<div class="paragraph data-line-1144">
<p><em>satoshin@gmx.com</em></p>
</div>
<div class="paragraph data-line-1146">
<p><a href="https://bitcoin.org/en/" class="orm:hideurl"><em>www.bitcoin.org</em></a></p>
</div>
<div class="paragraph data-line-1148">
<p><strong>Resumo.</strong> Uma vers√£o puramente par-a-par de dinheiro em esp√©cie eletr√¥nico permitiria que pagamentos on-line fossem enviados diretamente de uma parte para outra, sem passar por uma institui√ß√£o financeira. As assinaturas digitais fornecem parte da solu√ß√£o, mas os principais benef√≠cios s√£o perdidos se um terceiro de confian√ßa ainda √© necess√°rio para evitar o gasto duplo. Propomos uma solu√ß√£o para o problema do gasto duplo usando uma rede par-a-par (<em>peer-to-peer</em>). A rede registra a data e a hora (<em>timestamp</em>) das transa√ß√µes ao transform√°-las em hashes que s√£o adicionados em uma cadeia cont√≠nua de prova-de-trabalho baseada em hashes, formando um registro que n√£o pode ser alterado sem que a prova-de-trabalho seja refeita. A cadeia mais longa n√£o apenas serve como prova da sequ√™ncia de eventos testemunhados, mas tamb√©m serve como prova de que ela veio da maior pool de poder computacional. Contanto que a maior parte do poder computacional seja controlada por n√≥s que n√£o est√£o cooperando para atacar a rede, estes n√≥s gerar√£o a cadeia mais longa e superar√£o os atacantes. A rede em si requer uma estrutura m√≠nima. As mensagens s√£o transmitidas em regime de melhor esfor√ßo, e os n√≥s podem sair e regressar √† rede √† vontade, aceitando a cadeia mais longa de prova-de-trabalho como prova do que aconteceu enquanto eles estiveram fora.</p>
</div>
<div class="paragraph data-line-1150">
<p>=== Introdu√ß√£o
O com√©rcio na Internet tem dependido quase que exclusivamente de institui√ß√µes financeiras servindo como terceiros de confian√ßa para processar pagamentos eletr√¥nicos. Enquanto o sistema funciona bem o suficiente para a maioria das opera√ß√µes, ele ainda sofre com as defici√™ncias inerentes ao modelo baseado em confian√ßa. Transa√ß√µes completamente n√£o revers√≠veis n√£o s√£o realmente poss√≠veis, pois as institui√ß√µes financeiras n√£o podem evitar a media√ß√£o de conflitos. O custo da media√ß√£o aumenta os custos de transa√ß√£o, o que limita o tamanho m√≠nimo pr√°tico da transa√ß√£o e elimina a possibilidade de pequenas transa√ß√µes ocasionais, e h√° um custo mais amplo na perda da capacidade de fazer pagamentos n√£o revers√≠veis para servi√ßos n√£o revers√≠veis. Com a possibilidade de revers√£o, a necessidade de confian√ßa se espalha. Os comerciantes precisam ser cautelosos com os seus clientes, incomodando-os para obter mais informa√ß√µes do que seriam de outra forma necess√°rias. Uma certa percentagem de fraude √© aceita como inevit√°vel. Estes custos e incertezas de pagamento podem ser evitados em uma transa√ß√£o presencial atrav√©s do uso de dinheiro esp√©cie, no entanto, n√£o h√° nenhum mecanismo que permita a realiza√ß√£o de pagamentos atrav√©s de um canal de comunica√ß√£o sem o envolvimento de um participante de confian√ßa.</p>
</div>
<div class="paragraph data-line-1153">
<p>O que √© necess√°rio √© um sistema de pagamento eletr√¥nico que seja baseado em prova criptogr√°fica em vez de confian√ßa, permitindo que quaisquer duas partes dispostas possam transacionar diretamente uma com a outra sem a necessidade de um terceiro de confian√ßa. Transa√ß√µes que s√£o computacionalmente impratic√°veis de serem revertidas protegeriam os vendedores de fraudes e mecanismos rotineiros de cust√≥dia poderiam ser facilmente implementados para proteger os compradores. Neste artigo, propomos uma solu√ß√£o para o problema do gasto duplo usando um servidor de carimbo de data e hora (<em>timestamp</em>) distribu√≠do par-a-par (<em>peer-to-peer</em>) para gerar prova computacional da ordem cronol√≥gica das transa√ß√µes. O sistema √© seguro desde que n√≥s honestos controlem coletivamente mais poder computacional do que qualquer grupo cooperante de n√≥s atacantes.</p>
</div>
<div class="paragraph data-line-1155">
<p>==== Transa√ß√µes
Definimos uma moeda eletr√¥nica como uma cadeia de assinaturas digitais. Cada dono transfere a moeda para o pr√≥ximo ao assinar digitalmente um hash da transa√ß√£o anterior e a chave p√∫blica do pr√≥ximo dono e adicionando-os ao final da moeda. Quem recebe a moeda pode verificar as assinaturas para verificar a cadeia de posse.</p>
</div>
<div class="imageblock data-line-1158">
<div class="content">
<img src="images/mbc2_abin01.png" alt="Transactions">
</div>
</div>
<div class="paragraph data-line-1160">
<p>O problema, obviamente, √© que o benefici√°rio n√£o consegue verificar se um dos donos n√£o fez um gasto duplo da moeda. Uma solu√ß√£o comum √© introduzir uma autoridade central de confian√ßa, ou casa da moeda, que verifique cada transa√ß√£o para ver se houve um gasto duplo. Depois de cada transa√ß√£o, a moeda deve ser devolvida √† casa da moeda para a emiss√£o de uma nova moeda, e apenas as moedas emitidas diretamente pela casa da moeda possuem a garantia de n√£o terem sido usadas em um gasto duplo. O problema desta solu√ß√£o √© que o destino de todo o sistema monet√°rio depende da empresa que gerencia a casa da moeda, com todas as transa√ß√µes tendo que passar por ela, como se fosse um banco.</p>
</div>
<div class="paragraph data-line-1162">
<p>Precisamos de uma maneira de fazer com que o benefici√°rio possa saber se os donos anteriores n√£o assinaram quaisquer transa√ß√µes anteriores. Para nossos prop√≥sitos, a transa√ß√£o mais antiga √© a que conta, por isso, n√£o nos preocupamos com tentativas posteriores de gasto duplo. A √∫nica maneira de se confirmar a aus√™ncia de uma transa√ß√£o √© estar ciente de todas as transa√ß√µes. No modelo baseado em casa da moeda, a mesma estava ciente de todas as transa√ß√µes e decidia qual tinha chegado primeiro. Para alcan√ßar este objetivo sem um participante de confian√ßa, as transa√ß√µes devem ser anunciadas publicamente [1], e precisamos de um sistema para que os participantes concordem com um √∫nico hist√≥rico contendo a ordem em que as transa√ß√µes foram recebidas. O benefici√°rio precisa ter uma prova de que, no momento de cada transa√ß√£o, a maioria dos n√≥s concordava que ela tinha sido a primeira a ser recebida.</p>
</div>
<div class="paragraph data-line-1164">
<p>==== Servidor de Carimbo de Data e Hora (<em>Timestamp</em>)
A solu√ß√£o que propomos come√ßa com um servidor de carimbo de data e hora (<em>timestamp</em>). Um servidor de carimbo de data e hora funciona gerando um hash de um bloco de itens e publicando amplamente o hash em lugares como um jornal ou um post na Usenet [2-5]. O carimbo de data e hora comprova que os dados existiam naquela √©poca, obviamente, pois eles precisavam existir para serem usados na gera√ß√£o do hash. Cada carimbo de data e hora inclui o carimbo anterior em seu hash, formando uma cadeia, com cada carimbo adicional refor√ßando os que vieram antes dele.</p>
</div>
<div class="imageblock data-line-1167">
<div class="content">
<img src="images/mbc2_abin02.png" alt="timestamp server">
</div>
</div>
<div class="paragraph data-line-1169">
<p>==== Prova-de-Trabalho
Para implementar um servidor de carimbos de data e hora distribu√≠do em uma base par-a-par (<em>peer-to-peer</em>), teremos de usar um sistema de prova-de-trabalho semelhante ao Hashcash de Adam Back [6], ao inv√©s de jornais ou posts na Usenet. A prova-de-trabalho envolve a procura por um valor que, quando transformado em hash, atrav√©s de um algoritmo como o SHA-256, o hash comece com um determinado n√∫mero de bits zero. O trabalho m√©dio exigido √© exponencial ao n√∫mero de bits zero requeridos e pode ser verificada por meio da execu√ß√£o de um √∫nico hash. Para nossa rede de carimbos de data e hora, implementamos a prova-de-trabalho ao incrementar um nonce no bloco at√© que seja encontrado um valor que d√™ ao hash do bloco a quantidade exigida de bits zero. Uma vez que o esfor√ßo computacional tenha sido gasto para satisfazer a prova-de-trabalho, o bloco n√£o pode ser modificado sem que o trabalho seja refeito. √Ä medida que outros blocos s√£o encadeados mais tarde, o trabalho para modificar o bloco incluiria refazer todos os blocos que foram encadeados posteriormente.</p>
</div>
<div class="imageblock data-line-1172">
<div class="content">
<img src="images/mbc2_abin03.png" alt="pow">
</div>
</div>
<div class="paragraph data-line-1174">
<p>A prova-de-trabalho tamb√©m resolve o problema que existe em se determinar a representa√ß√£o na tomada de decis√£o atrav√©s de uma maioria. Se a maioria fosse baseada em um-endere√ßo-IP-um-voto, isso poderia ser subvertido por qualquer pessoa capaz de alocar muitos IPs. A prova-de-trabalho √©, essencialmente, uma-CPU-um-voto. A decis√£o da maioria √© representada pela cadeia mais longa, que tem o maior esfor√ßo de prova-de-trabalho investido nela. Se a maioria do poder computacional (poder de CPU) for controlada por n√≥s honestos, a cadeia honesta crescer√° mais r√°pido e superar√° quaisquer cadeias concorrentes. Para modificar um bloco anterior, um atacante teria que refazer a prova-de-trabalho do bloco e de todos os blocos posteriores e, em seguida, alcan√ßar e superar o trabalho dos n√≥s honestos. Mais tarde mostraremos que a probabilidade de um atacante mais lento ter sucesso em alcan√ßar os n√≥s honestos diminui exponencialmente √† medida que blocos subsequentes s√£o adicionados.</p>
</div>
<div class="paragraph data-line-1176">
<p>Para compensar o aumento da velocidade do hardware e o interesse variado em se executar n√≥s ao longo do tempo, a dificuldade da prova-de-trabalho √© determinada por uma m√©dia m√≥vel visando um n√∫mero m√©dio de blocos por hora. Se eles forem gerados r√°pido demais, a dificuldade aumenta.</p>
</div>
<div class="paragraph data-line-1178">
<p>==== Rede</p>
</div>
<div class="paragraph data-line-1180">
<p>Os passos para executar a rede s√£o os seguintes:</p>
</div>
<div class="olist arabic data-line-1182">
<ol class="arabic">
<li class="data-line-1182">
<p>As transa√ß√µes novas s√£o transmitidas para todos os n√≥s.</p>
</li>
<li class="data-line-1183">
<p>Cada n√≥ coleta as transa√ß√µes novas em um bloco.</p>
</li>
<li class="data-line-1184">
<p>Cada n√≥ trabalha para encontrar uma prova-de-trabalho dif√≠cil para o seu bloco.</p>
</li>
<li class="data-line-1185">
<p>Quando um n√≥ encontra uma prova-de-trabalho, ele transmite o bloco para todos os n√≥s.</p>
</li>
<li class="data-line-1186">
<p>Os n√≥s aceitam o bloco somente se todas as suas transa√ß√µes s√£o v√°lidas e ainda n√£o foram gastas.</p>
</li>
<li class="data-line-1187">
<p>Os n√≥s expressam sua aceita√ß√£o do bloco ao trabalhar na cria√ß√£o do pr√≥ximo bloco na cadeia, usando o hash do bloco aceito como o hash anterior.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-1189">
<p>Os n√≥s sempre consideram a cadeia mais longa como sendo a correta e continuar√£o trabalhando para estend√™-la. Se dois n√≥s transmitirem simultaneamente diferentes vers√µes do pr√≥ximo bloco, alguns n√≥s podem receber um ou o outro primeiro. Nesse caso, eles trabalham com o primeiro bloco que eles receberam, mas salvam o outro ramo, para caso ele venha a se tornar mais longo. O empate ser√° quebrado quando a pr√≥xima prova-de-trabalho for encontrada e um ramo se tornar mais longo; os n√≥s que estavam trabalhando no outro ramo, ent√£o, mudar√£o para o mais longo.</p>
</div>
<div class="paragraph data-line-1191">
<p>As transmiss√µes das novas transa√ß√µes n√£o precisam necessariamente alcan√ßar todos os n√≥s. Contanto que elas atinjam muitos n√≥s, elas brevemente entrar√£o em um bloco. As transmiss√µes de bloco tamb√©m s√£o tolerantes com mensagens perdidas. Se um n√≥ n√£o recebe um bloco, ele ir√° solicit√°-lo quando receber o pr√≥ximo bloco e perceber que est√° com um bloco em falta.</p>
</div>
<div class="paragraph data-line-1193">
<p>==== Incentivo
Por conven√ß√£o, a primeira transa√ß√£o de um bloco √© uma transa√ß√£o especial que inicia uma nova moeda que pertence ao criador do bloco. Isso gera um incentivo para que os n√≥s apoiem a rede, e serve como uma maneira para colocar as moedas em circula√ß√£o, uma vez que n√£o existe uma autoridade central para emiti-las. A adi√ß√£o est√°vel de uma quantidade constante de novas moedas √© an√°loga a garimpeiros consumindo recursos para colocar mais ouro em circula√ß√£o. No nosso caso, o que est√° sendo consumido √© tempo de processamento computacional e eletricidade.</p>
</div>
<div class="paragraph data-line-1196">
<p>O incentivo tamb√©m pode ser financiado com taxas de transa√ß√£o. Se o valor de sa√≠da de uma transa√ß√£o for menor do que o valor de entrada da transa√ß√£o, a diferen√ßa √© uma taxa de transa√ß√£o que √© adicionada ao valor do incentivo do bloco que cont√©m a transa√ß√£o. Assim que um n√∫mero predeterminado de moedas j√° tiver entrado em circula√ß√£o, o incentivo pode gradualmente passar a ser composto apenas pelas taxas de transa√ß√£o, sendo completamente livre de infla√ß√£o.</p>
</div>
<div class="paragraph data-line-1198">
<p>O incentivo deve ajudar a encorajar os n√≥s a se manterem honestos. Se um atacante ganancioso for capaz de reunir mais poder computacional do que todos os n√≥s honestos, ele teria que escolher entre us√°-lo para defraudar as pessoas ao roubar seus pagamentos de volta, ou us√°-lo para gerar novas moedas. Ele deveria achar que √© mais lucrativo jogar de acordo com as regras, que lhe favorecem ao obter um n√∫mero maior de novas moedas do que todos os outros participantes combinados obt√™m, do que prejudicar o sistema e a validade de sua pr√≥pria riqueza.</p>
</div>
<div class="paragraph data-line-1200">
<p>==== Recupera√ß√£o do Espa√ßo em Disco</p>
</div>
<p>Assim que a transa√ß√£o mais recente em uma moeda estiver enterrada sob blocos suficientes, as transa√ß√µes gastas anteriormente podem ser descartadas para economizar espa√ßo em disco. Para facilitar isso sem quebrar o hash do bloco, as transa√ß√µes s√£o transformadas em hashes que formam uma √Årvore de Merkle <a href="#ref_seven">[7]</a> <a href="#ref_two">[2]</a> <a href="#ref_five">[5]</a>, da qual apenas a raiz √© inclu√≠da no hash do bloco. Blocos antigos podem ent√£o ser compactados ao se remover ramos da √°rvore. Os hashes internos n√£o precisam ser armazenados.</p>
<div class="imageblock data-line-1206">
<div class="content">
<img src="images/mbc2_abin04.png" alt="disk">
</div>
</div>
<div class="paragraph data-line-1208">
<p>Um cabe√ßalho de bloco sem nenhuma transa√ß√£o tem cerca de 80 bytes. Se supormos que os blocos s√£o gerados a cada 10 minutos, 80 bytes * 6 * 24 * 365 = 4,2 MB por ano. Com computadores geralmente sendo vendidos com 2 GB de RAM em 2008, e a Lei de Moore prevendo um crescimento de 1,2 GB por ano, o armazenamento n√£o deve ser um problema, mesmo que os cabe√ßalhos de bloco tenham que ser mantidos em mem√≥ria.</p>
</div>
<div class="paragraph data-line-1210">
<p>==== Verifica√ß√£o de Pagamento Simplificada
√â poss√≠vel verificar os pagamentos sem executar um n√≥ de rede completo. Um usu√°rio precisa apenas manter uma c√≥pia dos cabe√ßalhos de bloco da cadeia com a prova-de-trabalho mais longa, que ele pode recuperar consultando os n√≥s da rede at√© que ele esteja convencido de que tem a cadeia mais longa, e obter o ramo de Merkle ligando a transa√ß√£o ao bloco em que ela est√° registrada. Ele n√£o consegue verificar a transa√ß√£o por conta pr√≥pria, mas, ligando-a a um lugar na cadeia, ele consegue ver que um n√≥ da rede a aceitou, e os blocos adicionados depois dela s√£o uma confirma√ß√£o adicional de que a rede a aceitou.</p>
</div>
<div class="imageblock data-line-1213">
<div class="content">
<img src="images/mbc2_abin05.png" alt="spv">
</div>
</div>
<div class="paragraph data-line-1215">
<p>Como tal, a verifica√ß√£o √© confi√°vel contanto que os n√≥s honestos controlem a rede, mas √© mais vulner√°vel se a rede for subjugada por um atacante com maior poder. Embora os n√≥s da rede consigam verificar as transa√ß√µes por si mesmos, o m√©todo simplificado pode ser enganado por transa√ß√µes fabricadas de um atacante durante o tempo que o atacante com maior poder conseguir dominar a rede. Uma estrat√©gia para se proteger disso seria aceitar alertas dos n√≥s da rede quando eles detectam um bloco inv√°lido, levando o software do usu√°rio a baixar o bloco completo e as transa√ß√µes alarmadas para confirmar a inconsist√™ncia. As empresas que recebem pagamentos frequentes provavelmente desejar√£o executar seus pr√≥prios n√≥s para uma seguran√ßa mais independente e uma verifica√ß√£o mais r√°pida.</p>
</div>
<div class="paragraph data-line-1217">
<p>==== Combinando e Dividindo Valor
Embora poderia ser poss√≠vel lidar com as moedas individualmente, seria complicado fazer uma transa√ß√£o separada para cada centavo em uma transfer√™ncia. Para permitir que o valor seja dividido e combinado, as transa√ß√µes cont√™m m√∫ltiplas entradas e sa√≠das. Normalmente haver√° ou uma √∫nica entrada de uma transa√ß√£o pr√©via com uma quantia maior, ou v√°rias entradas combinando quantias menores, e no m√°ximo duas sa√≠das: uma para o pagamento e, se houver, uma retornando o troco ao remetente.</p>
</div>
<div class="imageblock data-line-1220">
<div class="content">
<img src="images/mbc2_abin06.png" alt="combining-splitting">
</div>
</div>
<div class="paragraph data-line-1222">
<p>Deve-se notar que a dispers√£o, quando uma transa√ß√£o depende de v√°rias transa√ß√µes, e essas transa√ß√µes dependem de muitas outras, n√£o representa um problema. Nunca h√° a necessidade de se extrair uma c√≥pia independente completa do hist√≥rico de uma transa√ß√£o.</p>
</div>
<div class="paragraph data-line-1224">
<p>==== Privacidade
O modelo banc√°rio tradicional atinge um n√≠vel de privacidade ao limitar o acesso √†s informa√ßoes da transa√ß√£o para as partes envolvidas e o terceiro de confian√ßa. A necessidade de se anunciar todas as transa√ß√µes publicamente impossibilita a utiliza√ß√£o deste m√©todo, mas a privacidade ainda pode ser mantida ao quebrar-se o fluxo de informa√ß√µes em outro ponto: ao manter-se as chaves p√∫blicas em anonimato. O p√∫blico pode ver que algu√©m est√° enviando uma quantia para alguma outra pessoa, mas sem informa√ß√µes que vinculam a transa√ß√£o a qualquer indiv√≠duo. Isto √© semelhante ao n√≠vel de informa√ß√µes divulgadas pelas bolsas de valores, onde o hor√°rio e o valor das negocia√ß√µes individuais, a "fita", √© tornada p√∫blica, mas sem dizer quem foram os participantes das negocia√ß√µes.</p>
</div>
<div class="imageblock data-line-1227">
<div class="content">
<img src="images/mbc2_abin07.png" alt="privacy">
</div>
</div>
<div class="paragraph data-line-1229">
<p>Como uma prote√ß√£o adicional, um novo par de chaves deve ser utilizado a cada transa√ß√£o, a fim de evitar que elas sejam vinculadas a um dono comum. Algum grau de vincula√ß√£o ainda √© inevit√°vel em transa√ß√µes com m√∫ltiplas entradas, que necessariamente revelam que as entradas eram propriedade de um mesmo dono. Existe o risco de que, se o dono de uma chave for revelado, a vincula√ß√£o poderia revelar outras transa√ß√µes que pertenceram ao mesmo dono.</p>
</div>
<div class="paragraph data-line-1231">
<p>==== C√°lculos
Consideramos o cen√°rio de um atacante tentando gerar uma cadeia alternativa mais r√°pido do que a cadeia honesta. Mesmo que isso seja feito, isso n√£o deixa o sistema aberto a mudan√ßas arbitr√°rias, como a cria√ß√£o de valor a partir do nada ou a tomada de dinheiro que nunca pertenceu ao atacante. Os n√≥s n√£o aceitar√£o uma transa√ß√£o inv√°lida como forma de pagamento, e os n√≥s honestos jamais aceitar√£o um bloco contendo transa√ß√µes inv√°lidas. A √∫nica coisa que um atacante pode fazer √© tentar alterar uma de suas pr√≥prias transa√ß√µes para tomar de volta o dinheiro que ele gastou recentemente.</p>
</div>
<div class="paragraph data-line-1234">
<p>A corrida entre a cadeia honesta e a cadeia de um atacante pode ser caracterizada como uma Caminhada Aleat√≥ria Binomial. O evento de sucesso √© a cadeia honesta sendo estendida em mais um bloco, aumentando a sua lideran√ßa em +1, e o evento de falha √© a cadeia do atacante sendo estendida em mais um bloco, reduzindo a diferen√ßa entre as cadeias em -1.</p>
</div>
<p>A probabilidade de um atacante recuperar-se de um dado d√©ficit √© an√°logo ao problema da Ru√≠na do Jogador. Suponha que um jogador com cr√©dito ilimitado comece em um d√©ficit (preju√≠zo) e jogue potencialmente um n√∫mero infinito de tentativas para tentar atingir o ponto de equil√≠brio. Podemos calcular a probabilidade de ele atingir o ponto de equil√≠brio, ou de um atacante alcan√ßar a cadeia honesta, da seguinte maneira <a href="#ref_eight">[8]</a>:</p>
<div class="paragraph data-line-1240">
<p>p = probabilidade de um n√≥ honesto encontrar o pr√≥ximo bloco</p>
</div>
<div class="paragraph data-line-1242">
<p>q = probabilidade de o atacante encontrar o pr√≥ximo bloco</p>
</div>
<div class="paragraph data-line-1244">
<p>q<sub>z</sub> = probabilidade de o atacante conseguir alcan√ßar a cadeia honesta estando z blocos atr√°s</p>
</div>
<div class="imageblock data-line-1246">
<div class="content">
<img src="images/mbc2_abin08.png" alt="eq1">
</div>
</div>
<div class="paragraph data-line-1248">
<p>Dada a nossa suposi√ß√£o que p &gt; q, a probabilidade cai exponencialmente √† medida que aumenta o n√∫mero de blocos que o atacante tem que minerar para alcan√ßar a cadeia honesta. Com as probabilidades contra ele, se ele n√£o fizer uma arrancada de sorte logo no in√≠cio, suas chances se tornam muito pequenas √† medida que ele fica mais para tr√°s.</p>
</div>
<div class="paragraph data-line-1250">
<p>Vamos agora considerar quanto tempo o destinat√°rio de uma nova transa√ß√£o precisa esperar antes de ficar suficientemente certo que o remetente n√£o pode mudar a transa√ß√£o. Assumimos que o remetente √© um atacante que quer fazer o destinat√°rio acreditar que ele lhe pagou por um determinado momento, e que depois altera a transa√ß√£o para pagar de volta para si mesmo ap√≥s decorrido um certo per√≠odo de tempo. O destinat√°rio ser√° alertado quando isso acontecer, mas o remetente espera que o alerta aconte√ßa tarde demais.</p>
</div>
<div class="paragraph data-line-1252">
<p>O destinat√°rio gera um novo par de chaves e d√° a chave p√∫blica para o remetente, pouco antes de assinar. Isso previne que o remetente prepare uma cadeia de blocos antes do tempo, ao trabalhar de forma cont√≠nua at√© que tenha a sorte de chegar √† frente suficientemente, e depois executando a transa√ß√£o naquele momento. Uma vez que a transa√ß√£o √© enviada, o remetente desonesto come√ßa a trabalhar em segredo em uma cadeia paralela contendo uma vers√£o alternativa de sua transa√ß√£o.</p>
</div>
<div class="paragraph data-line-1254">
<p>O destinat√°rio espera at√© que a transa√ß√£o tenha sido adicionada a um bloco e z blocos sejam ligados depois desse bloco. Ele n√£o sabe a quantidade exata de progresso do atacante, mas assumindo que os blocos honestos levaram o tempo m√©dio esperado por bloco, o progresso potencial do atacante ser√° uma distribui√ß√£o de Poisson com valor esperado:</p>
</div>
<div class="imageblock data-line-1256">
<div class="content">
<img src="images/mbc2_abin09.png" alt="eq2">
</div>
</div>
<div class="paragraph data-line-1258">
<p>Para obter a probabilidade atual de o atacante ainda poder alcan√ßar a cadeia honesta, multiplicamos a densidade de Poisson para cada quantidade de progresso que ele poderia ter feito pela probabilidade de ele alcan√ßar a cadeia honesta a partir daquele ponto:</p>
</div>
<div class="imageblock data-line-1260">
<div class="content">
<img src="images/mbc2_abin10.png" alt="eq3">
</div>
</div>
<div class="paragraph data-line-1262">
<p>Rearranjando para evitar a soma da cauda infinita da distribui√ß√£o&#8230;&#8203;</p>
</div>
<div class="imageblock data-line-1264">
<div class="content">
<img src="images/mbc2_abin11.png" alt="eq4">
</div>
</div>
<div class="paragraph data-line-1266">
<p>Convertendo para c√≥digo C&#8230;&#8203;</p>
</div>
<div class="listingblock data-line-1269">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">#include &lt;math.h&gt;
double ProbabilidadeDeSucessoDoAtacante(double q, int z)
{
    double p = 1.0 - q;
    double lambda = z * (q / p);
    double sum = 1.0;
    int i, k;
    for (k = 0; k &lt;= z; k++)
    {
        double poisson = exp(-lambda);
        for (i = 1; i &lt;= k; i++)
            poisson *= lambda / i;
        sum -= poisson * (1 - pow(q / p, z - k));
    }
    return sum;
}</code></pre>
</div>
</div>
<div class="paragraph data-line-1288">
<p>Rodando alguns resultados, podemos ver a probabilidade cair exponencialmente conforme o z aumenta.</p>
</div>
<div class="listingblock data-line-1289">
<div class="content">
<pre>q=0.1
z=0  P=1.0000000
z=1  P=0.2045873
z=2  P=0.0509779
z=3  P=0.0131722
z=4  P=0.0034552
z=5  P=0.0009137
z=6  P=0.0002428
z=7  P=0.0000647
z=8  P=0.0000173
z=9  P=0.0000046
z=10 P=0.0000012</pre>
</div>
</div>
<div class="listingblock data-line-1303">
<div class="content">
<pre>q=0.3
z=0  P=1.0000000
z=5  P=0.1773523
z=10 P=0.0416605
z=15 P=0.0101008
z=20 P=0.0024804
z=25 P=0.0006132
z=30 P=0.0001522
z=35 P=0.0000379
z=40 P=0.0000095
z=45 P=0.0000024
z=50 P=0.0000006</pre>
</div>
</div>
<div class="paragraph data-line-1317">
<p>Resolvendo para P menor que 0,1%&#8230;&#8203;</p>
</div>
<div class="listingblock data-line-1318">
<div class="content">
<pre>P &lt; 0.001
q=0.10 z=5
q=0.15 z=8
q=0.20 z=11
q=0.25 z=15
q=0.30 z=24
q=0.35 z=41
q=0.40 z=89
q=0.45 z=340</pre>
</div>
</div>
<div class="paragraph data-line-1330">
<p>==== Conclus√£o
Propusemos um sistema para transa√ß√µes eletr√¥nicas que n√£o depende de confian√ßa. Come√ßamos com o framework habitual de moedas feitas a partir de assinaturas digitais, que fornece um forte controle de posse, mas √© incompleto sem que haja uma maneira de evitar o gasto duplo. Para resolver isso, propusemos uma rede par-a-par (<em>peer-to-peer</em>) usando prova-de-trabalho para registrar um hist√≥rico p√∫blico de transa√ß√µes que rapidamente se torna computacionalmente impratic√°vel de ser alterado por um atacante, caso os n√≥s honestos controlem a maior parte do poder computacional. A rede √© robusta em sua simplicidade n√£o estruturada. Os n√≥s trabalham todos de uma vez, com pouca coordena√ß√£o. Eles n√£o precisam ser identificados, uma vez que as mensagens n√£o s√£o roteadas para nenhum lugar em particular e s√≥ precisam ser entregues em regime de melhor esfor√ßo. Os n√≥s podem sair e voltar √† rede √† vontade, aceitando a cadeia de prova-de-trabalho como prova do que aconteceu enquanto eles estiveram fora. Eles votam com seu poder computacional, expressando a sua aceita√ß√£o dos blocos v√°lidos ao trabalharem para estend√™-los e rejeitando os blocos inv√°lidos ao recusarem-se a trabalhar com eles. Quaisquer regras e incentivos necess√°rios podem ser aplicados com este mecanismo de consenso.</p>
</div>
<div class="paragraph data-line-1333">
<p>==== Refer√™ncias</p>
</div>
<p>
<span id="ref_one">[1]</span> W. Dai, "b-money," <a href="http://www.weidai.com/bmoney.txt"><em>http://www.weidai.com/bmoney.txt</em></a>, 1998.
</p>
<p>
<span id="ref_two">[2]</span> H. Massias, X.S. Avila, and J.-J. Quisquater, "Design of a secure timestamping service with minimal trust requirements," no 20th Symposium on Information Theory in the Benelux, maio de 1999.
</p>
<p>
<span id="ref_three">[3]</span> S. Haber, W.S. Stornetta, "How to time-stamp a digital document," em Journal of Cryptology, vol. 3, n¬∫2, p√°ginas 99-111, 1991.
</p>

<p>
<span id="ref_four">[4]</span> D. Bayer, S. Haber, W.S. Stornetta, "Improving the efficiency and reliability of digital time-stamping," em Sequences II: Methods in Communication, Security and Computer Science, p√°ginas 329-334, 1993.
</p>

<p>
<span id="ref_five">[5]</span> S. Haber, W.S. Stornetta, "Secure names for bit-strings," em Proceedings of the 4th ACM Conference on Computer and Communications Security, p√°ginas 28-35, abril de 1997.
</p>

<p>
<span id="ref_six">[6]</span> A. Back, "Hashcash - a denial of service counter-measure," <a href="http://www.hashcash.org/papers/hashcash.pdf"><em>http://www.hashcash.org/papers/hashcash.pdf</em></a>, 2002.
</p>

<p>
<span id="ref_seven">[7]</span> R.C. Merkle, "Protocols for public key cryptosystems," em Proc. 1980 Symposium on Security and Privacy, IEEE Computer Society, p√°ginas 122-133, abril de 1980.
</p>

<p>
<span id="ref_eight">[8]</span> W. Feller, "An introduction to probability theory and its applications," 1957.
</p>
<div class="paragraph data-line-1366">
<p>=== Licen√ßa</p>
</div>
<div class="paragraph data-line-1368">
<p>Este whitepaper foi publicado em outubro de 2008 por Satoshi Nakamoto. Mais tarde (em 2009) ele foi adicionado como um documento de suporte no software do bitcoin, que carrega a mesma licen√ßa MIT. Ele foi reproduzido nesse livro, sem modifica√ß√µes al√©m de formata√ß√µes, sob os termos da licen√ßa MIT:</p>
</div>
<div class="paragraph data-line-1370">
<p>A Licen√ßa MIT (MIT)
Copyright (c) 2008 Satoshi Nakamoto</p>
</div>
<div class="paragraph data-line-1373">
<p>√â concedida permiss√£o gratuita a qualquer pessoa que adquira uma c√≥pia desse software e dos arquivos de documenta√ß√£o associados (o "Software"), para utilizar o Software sem restri√ß√£o, incluindo, entre outros, o direito de utilizar, copiar, modificar, mesclar, publicar, distribuir, sublicenciar e/ou vender c√≥pias do Software, e de permitir que as pessoas √†s quais o Software √© fornecido o fa√ßam, de acordo com as seguintes condi√ß√µes:</p>
</div>
<div class="paragraph data-line-1375">
<p>O aviso de direitos autorais acima e este aviso de permiss√£o dever√° ser inclu√≠do em todas as c√≥pias e partes materiais do Software.</p>
</div>
<div class="paragraph data-line-1377">
<p>O SOFTWARE √â FORNECIDO "NO ESTADO EM QUE SE ENCONTRA", SEM NENHUMA GARANTIA, EXPL√çCITA OU IMPL√çCITA, INCLUINDO, ENTRE OUTRAS, GARANTIAS DE COMERCIALIZA√á√ÉO, N√ÉO VIOLA√á√ÉO E ADEQUA√á√ÉO A UMA FINALIDADE ESPEC√çFICA. EM NENHUMA HIP√ìTESE, OS AUTORES OU DETENTORES DOS DIREITOS AUTORAIS SER√ÉO LEGALMENTE RESPONS√ÅVEIS POR QUALQUER REIVINDICA√á√ÉO, INDENIZA√á√ÉO OU OBRIGA√á√ïES, EM UMA A√á√ÉO DE CONTRATO, RESPONSABILIDADE CIVIL OU DE OUTRO MODO, ORIUNDA, DECORRENTE DE OU RELACIONADA AO SOFTWARE, AO USO OU A OUTRAS OPERA√á√ïES COM O SOFTWARE.</p>
</div>
<div id="tx_script_ops" class="paragraph data-line-1381">
<p>== Operadores de Linguagem, Constantes e S√≠mbolos de Script de Transa√ß√£o</p>
</div>
<div class="admonitionblock note data-line-1384">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-1385">
<p>Tabelas e descri√ß√µes provenientes de <a href="https://en.bitcoin.it/wiki/Script" class="undefined" data-href="https://en.bitcoin.it/wiki/Script">https://en.bitcoin.it/wiki/Script</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1388">
<p>A <a href="#tx_script_ops_table_pushdata">Operadores que adicionam valores no stack</a> mostra os operadores usados para adicionar valores no stack.</p>
</div>
<table id="tx_script_ops_table_pushdata" class="tableblock frame-all grid-all stretch data-line-1393">
<caption class="title">Table 30. Operadores que adicionam valores no stack</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">S√≠mbolo</th>
<th class="tableblock halign-left valign-top">Valor (hex)</th>
<th class="tableblock halign-left valign-top">Descri√ß√£o</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_0 ou OP_FALSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Um array vazio √© adicionado no stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 a 75</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01 a 0x4b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adiciona os pr√≥ximos N bytes no stack, onde N tem de 1 a 75 bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_PUSHDATA1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x4c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O pr√≥ximo byte do script cont√©m N, adiciona os pr√≥ximos N bytes no stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_PUSHDATA2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x4d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Os pr√≥ximos dois bytes do script cont√™m N, adiciona os pr√≥ximos N bytes no stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_PUSHDATA4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x4e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Os pr√≥ximos quatro bytes do script cont√™m N, adiciona os pr√≥ximos N bytes no stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_1NEGATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x4f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adiciona o valor "‚Äì1" no stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_RESERVED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x50</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suspende&#x2014;Transa√ß√£o inv√°lida, a menos que seja encontrado em uma cl√°usula OP_IF n√£o executada</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_1 ou OP_TRUE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x51</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adiciona o valor "1" no stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_2 a OP_16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x52 a 0x60</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Para OP_N, adiciona o valor "N" no stack, por exemplo, OP_2 adiciona "2" no stack</p></td>
</tr>
</tbody>
</table>
<div class="paragraph pagebreak-before data-line-1407">
<p>A <a href="#tx_script_ops_table_control">Operadores de controle de fluxo condicional</a> mostra os operadores de controle de fluxo condicional.</p>
</div>
<table id="tx_script_ops_table_control" class="tableblock frame-all grid-all stretch data-line-1412">
<caption class="title">Table 31. Operadores de controle de fluxo condicional</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">S√≠mbolo</th>
<th class="tableblock halign-left valign-top">Valor (hex)</th>
<th class="tableblock halign-left valign-top">Descri√ß√£o</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_NOP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x61</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N√£o faz nada</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_VER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x62</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suspende&#x2014;Transa√ß√£o inv√°lida, a menos que seja encontrado em uma cl√°usula OP_IF n√£o executada</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_IF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x63</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executa as declara√ß√µes a seguir se o topo do stack n√£o for 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_NOTIF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executa as declara√ß√µes a seguir se o topo do stack for 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_VERIF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x65</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suspende&#x2014;Transa√ß√£o inv√°lida</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_VERNOTIF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x66</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suspende&#x2014;Transa√ß√£o inv√°lida</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_ELSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x67</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executa apenas se as declara√ß√µes anteriores n√£o foram executadas</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_ENDIF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x68</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Termina o bloco OP_IF, OP_NOTIF, OP_ELSE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_VERIFY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x69</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verifica o topo do stack, suspende e invalida a transa√ß√£o se n√£o for TRUE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_RETURN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x6a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suspende e invalida a transa√ß√£o</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-1426">
<p>A <a href="#tx_script_ops_table_timelock">Opera√ß√µes de timelock</a> mostra os operadores usados para timelocks.</p>
</div>
<table id="tx_script_ops_table_timelock" class="tableblock frame-all grid-all stretch data-line-1431">
<caption class="title">Table 32. Opera√ß√µes de timelock</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">S√≠mbolo</th>
<th class="tableblock halign-left valign-top">Valor (hex)</th>
<th class="tableblock halign-left valign-top">Descri√ß√£o</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_CHECKLOCKTIMEVERIFY (antigamente OP_NOP2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marca uma transa√ß√£o como inv√°lida se o item do topo do stack for maior do que o campo nLockTime da transa√ß√£o, caso contr√°rio, a avalia√ß√£o do script continua como se um OP_NOP tivesse sido executado. A transa√ß√£o √© tamb√©m inv√°lida se 1. o stack estiver vazio; ou 2. o item no topo do stack for negativo; ou 3. o item no topo do stack for maior ou igual a 500000000 enquanto o campo nLockTime da transa√ß√£o for menor do que 500000000, ou vice-versa; ou 4. o campo nSequence da entrada for igual a 0xffffffff. A sem√¢ntica precisa √© descrita na BIP-65</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_CHECKSEQUENCEVERIFY (antigamente OP_NOP3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marca a transa√ß√£o como inv√°lida se o tempo de travamento relativo da entrada (imposto pela BIP-68 atrav√©s do nSequence) n√£o for igual ou maior do que o valor do item no topo do stack. A sem√¢ntica precisa √© descrita na BIP-112</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-1437">
<p>A <a href="#tx_script_ops_table_stack">Opera√ß√µes de stack</a> mostra os operadores usados para manipular o stack.</p>
</div>
<table id="tx_script_ops_table_stack" class="tableblock frame-all grid-all stretch data-line-1442">
<caption class="title">Table 33. Opera√ß√µes de stack</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">S√≠mbolo</th>
<th class="tableblock halign-left valign-top">Valor (hex)</th>
<th class="tableblock halign-left valign-top">Descri√ß√£o</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_TOALTSTACK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x6b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove o item do topo do stack e o adiciona no stack alternativo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_FROMALTSTACK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x6c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove o item do topo do stack alternativo e o adiciona no stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_2DROP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x6d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove os dois itens do topo do stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_2DUP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x6e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplica os dois itens no topo do stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_3DUP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x6f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplica os tr√™s itens no topo do stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_2OVER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x70</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copia o terceiro e o quarto itens do stack para o topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_2ROT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x71</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Move o quinto e o sexto itens do stack para o topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_2SWAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x72</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permuta os dois pares de itens no topo do stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_IFDUP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x73</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplica o item no topo do stack se ele n√£o for 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_DEPTH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x74</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conta os itens no stack e adiciona o resultado da contagem</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_DROP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x75</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove o item do topo do stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_DUP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x76</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplica o item no topo do stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_NIP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x77</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove o segundo item do stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_OVER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x78</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copia o segundo item do stack para o topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_PICK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x79</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove o valor N do topo, e depois copia o en√©simo (N¬∫) item para o topo do stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_ROLL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove o valor N do topo, e depois move o en√©simo (N¬∫) item para o topo do stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_ROT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inverte os tr√™s itens do topo do stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_SWAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permuta os dois itens do topo do stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_TUCK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copia o item do topo do stack e o insere entre o item do topo e o segundo item</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-1465">
<p>A <a href="#tx_script_ops_table_splice">Opera√ß√µes com peda√ßos de string</a> mostra os operadores de <em>string</em>.</p>
</div>
<table id="tx_script_ops_table_splice" class="tableblock frame-all grid-all stretch data-line-1470">
<caption class="title">Table 34. Opera√ß√µes com peda√ßos de string</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">S√≠mbolo</th>
<th class="tableblock halign-left valign-top">Valor (hex)</th>
<th class="tableblock halign-left valign-top">Descri√ß√£o</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_CAT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desativado (concatena os dois itens do topo)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_SUBSTR</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desativado (retorna a <em>substring</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_LEFT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desativado (retorna a <em>substring</em> √† esquerda)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_RIGHT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x81</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desativado (retorna a <em>substring</em> √† direita)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_SIZE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x82</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Calcula o comprimento da <em>string</em> do item do topo do stack e adiciona o resultado no stack</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-1479">
<p>A <a href="#tx_script_ops_table_binmath">Operadores de aritm√©tica bin√°ria e condicionais</a> mostra os operadores de aritm√©tica bin√°ria e de l√≥gica booleana.</p>
</div>
<table id="tx_script_ops_table_binmath" class="tableblock frame-all grid-all stretch data-line-1484">
<caption class="title">Table 35. Operadores de aritm√©tica bin√°ria e condicionais</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">S√≠mbolo</th>
<th class="tableblock halign-left valign-top">Valor (hex)</th>
<th class="tableblock halign-left valign-top">Descri√ß√£o</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_INVERT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x83</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desativado (inverte os bits do item do topo)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_AND</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x84</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desativado (booleano AND dos dois itens do topo)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_OR</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x85</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desativado (booleano OR dos dois itens do topo)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_XOR</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x86</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desativado (booleano XOR dos dois itens do topo)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_EQUAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x87</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adiciona TRUE (1) se os dois itens do topo forem exatamente iguais, caso contr√°rio adiciona FALSE (0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_EQUALVERIFY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x88</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O mesmo que o OP_EQUAL, mas depois executa o OP_VERIFY ap√≥s para suspender se n√£o for TRUE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_RESERVED1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x89</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suspende&#x2014;Transa√ß√£o inv√°lida, a menos que seja encontrado em uma cl√°usula OP_IF n√£o executada</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_RESERVED2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x8a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suspende&#x2014;Transa√ß√£o inv√°lida, a menos que seja encontrado em uma cl√°usula OP_IF n√£o executada</p></td>
</tr>
</tbody>
</table>
<div class="paragraph pagebreak-before data-line-1497">
<p>A <a href="#tx_script_ops_table_numbers">Operadores num√©ricos</a> mostra os operadores num√©ricos (aritm√©ticos).</p>
</div>
<table id="tx_script_ops_table_numbers" class="tableblock frame-all grid-all stretch data-line-1502">
<caption class="title">Table 36. Operadores num√©ricos</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">S√≠mbolo</th>
<th class="tableblock halign-left valign-top">Valor (hex)</th>
<th class="tableblock halign-left valign-top">Descri√ß√£o</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_1ADD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x8b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Soma 1 ao item do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_1SUB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x8c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subtrai 1 do item do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_2MUL</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x8d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desativado (multiplica o item do topo por 2)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_2DIV</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x8e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desativado (divide o item do topo por 2)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_NEGATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x8f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inverte o sinal do item do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_ABS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x90</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Muda o sinal do item do topo para positivo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_NOT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x91</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Se o item do topo for 0 ou 1 Booleano, inverte-o, caso contr√°rio retorna 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_0NOTEQUAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x92</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Se o item do topo for 0, retorna 0, caso contr√°rio retorna 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_ADD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x93</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove os dois itens do topo, soma-os e adiciona o resultado</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_SUB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x94</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove os dois itens do topo, subtrai o primeiro do segundo e adiciona o resultado</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_MUL</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x95</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desativado (multiplica os dois itens do topo)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_DIV</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desativado (divide o segundo item pelo primeiro item)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_MOD</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x97</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desativado (restante divide o segundo item pelo primeiro item)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_LSHIFT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x98</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desativado (desloca o segundo item √† esquerda pelo n√∫mero de bits do primeiro item)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_RSHIFT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x99</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desativado (desloca o segundo item √† direita pelo n√∫mero de bits do primeiro item)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_BOOLAND</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x9a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Booleano AND dos dois itens do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_BOOLOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x9b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Booleano OR dos dois itens do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_NUMEQUAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x9c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retorna TRUE se os dois itens do topo forem n√∫meros iguais</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_NUMEQUALVERIFY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x9d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O mesmo que o NUMEQUAL, mas depois executa o OP_VERIFY para suspender se n√£o for TRUE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_NUMNOTEQUAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x9e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retorna TRUE se os dois itens do topo n√£o forem n√∫meros iguais</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_LESSTHAN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x9f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retorna TRUE se o segundo item for menor que o item do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_GREATERTHAN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retorna TRUE se o segundo item for maior do que o item do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_LESSTHANOREQUAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retorna TRUE se o segundo item for menor ou igual ao item do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_GREATERTHANOREQUAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retorna TRUE se o segundo item for maior ou igual ao item do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_MIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retorna o menor dos dois itens do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retorna o maior dos dois itens do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_WITHIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retorna TRUE se o terceiro item estiver entre o segundo item (ou for igual) e o primeiro item</p></td>
</tr>
</tbody>
</table>
<div class="paragraph pagebreak-before data-line-1534">
<p>A <a href="#tx_script_ops_table_crypto">Opera√ß√µes criptogr√°ficas e de hashing</a> mostra os operadores de fun√ß√µes criptogr√°ficas.</p>
</div>
<table id="tx_script_ops_table_crypto" class="tableblock frame-all grid-all stretch data-line-1539">
<caption class="title">Table 37. Opera√ß√µes criptogr√°ficas e de hashing</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">S√≠mbolo</th>
<th class="tableblock halign-left valign-top">Valor (hex)</th>
<th class="tableblock halign-left valign-top">Descri√ß√£o</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_RIPEMD160</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retorna o hash RIPEMD160 do item do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_SHA1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retorna o hash SHA1 do item do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_SHA256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retorna o hash SHA256 do item do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_HASH160</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retorna o hash RIPEMD160(SHA256(x)) do item do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_HASH256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xaa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retorna o hash SHA256(SHA256(x)) do item do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_CODESEPARATOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xab</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marca o in√≠cio dos dados verificados pela assinatura</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_CHECKSIG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xac</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove uma chave p√∫blica e a assinatura, valida a assinatura para os dados da transa√ß√£o transformados em hash, retorna TRUE se corresponde</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_CHECKSIGVERIFY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xad</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O mesmo que o CHECKSIG, mas depois executa o OP_VERIFY para suspender se n√£o for TRUE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_CHECKMULTISIG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xae</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executa o CHECKSIG para cada par de assinatura e chave p√∫blica fornecido. Todos devem corresponder. Um bug na implementa√ß√£o remove um valor extra, para contorn√°-lo, usa-se prefixo com OP_0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_CHECKMULTISIGVERIFY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xaf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O mesmo que o CHECKMULTISIG, mas depois executa o OP_VERIFY para suspender se n√£o for TRUE</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-1553">
<p>A <a href="#tx_script_ops_table_nop">N√£o operadores</a> mostra os s√≠mbolos n√£o operadores.</p>
</div>
<table id="tx_script_ops_table_nop" class="tableblock frame-all grid-all stretch data-line-1558">
<caption class="title">Table 38. N√£o operadores</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">S√≠mbolo</th>
<th class="tableblock halign-left valign-top">Valor (hex)</th>
<th class="tableblock halign-left valign-top">Descri√ß√£o</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_NOP1 a OP_NOP10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb0 a 0xb9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N√£o faz nada, √© ignorado</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-1564">
<p>A <a href="#tx_script_ops_table_internal">C√≥digos OP reservados para uso interno pelo analisador sint√°tico</a> mostra os c√≥digos de operador reservados para serem usados pelo analisador sint√°tico interno de script.</p>
</div>
<table id="tx_script_ops_table_internal" class="tableblock frame-all grid-all stretch data-line-1569">
<caption class="title">Table 39. C√≥digos OP reservados para uso interno pelo analisador sint√°tico</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">S√≠mbolo</th>
<th class="tableblock halign-left valign-top">Valor (hex)</th>
<th class="tableblock halign-left valign-top">Descri√ß√£o</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_SMALLDATA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Representa um campo de dados pequeno</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_SMALLINTEGER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xfa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Representa um campo de dados num√©ricos pequeno</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_PUBKEYS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xfb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Representa os campos de chave p√∫blica</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_PUBKEYHASH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xfd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Representa um campo de hash da chave p√∫blica</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_PUBKEY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xfe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Representa um campo de chave p√∫blica</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_INVALIDOPCODE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xff</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Representa qualquer c√≥digo OP que n√£o est√° atualmente designado</p></td>
</tr>
</tbody>
</table>
<div id="appdxbitcoinimpproposals" class="paragraph data-line-1581">
<p>== Propostas de Melhoria ao Bitcoin</p>
</div>
<div class="paragraph data-line-1583">
<p>As Propostas de Melhoria ao Bitcoin (em ingl√™s, <em>Bitcoin Improvement Proposals</em> ou BIPs) s√£o documentos de design que fornecem informa√ß√µes para a comunidade do bitcoin, ou que s√£o usados para descrever um novo recurso para o bitcoin, ou para descrever seus processos ou ambiente.</p>
</div>
<div class="paragraph data-line-1585">
<p>De acordo com a BIP-01 <em>Prop√≥sito e Diretrizes das BIPs</em>, existem tr√™s tipos de BIPs:</p>
</div>
<div class="dlist data-line-1587">
<dl>
<dt class="hdlist1">BIP <em>Padr√£o</em> (Standard)</dt>
<dd>
<p>Descreve qualquer mudan√ßa que afete a maioria ou a totalidade das implementa√ß√µes do bitcoin, tais como uma mudan√ßa no protocolo da rede, uma mudan√ßa nas regras de valida√ß√£o de transa√ß√µes e blocos ou qualquer mudan√ßa ou adi√ß√£o que afete a interoperabilidade de aplicativos usando bitcoin.</p>
</dd>
<dt class="hdlist1">BIP <em>Informativa</em></dt>
<dd>
<p>Descreve uma quest√£o relacionada ao design do bitcoin ou fornece orienta√ß√µes gerais/informa√ß√µes para a comunidade do bitcoin, mas n√£o prop√µe uma nova funcionalidade. As BIPs informativas n√£o necessariamente representam um consenso ou uma recomenda√ß√£o da comunidade do bitcoin, de forma que usu√°rios e implementadores podem ignorar ou seguir as orienta√ß√µes dessas BIPs.</p>
</dd>
<dt class="hdlist1"><em>Process</em> BIP</dt>
<dd>
<p>Describes a bitcoin process, or proposes a change to (or an event in) a process. Process BIPs are like standard BIPs but apply to areas other than the Bitcoin protocol itself. They might propose an implementation, but not to bitcoin&#8217;s codebase; they often require community consensus; and unlike informational BIPs, they are more than recommendations, and users are typically not free to ignore them. Examples include procedures, guidelines, changes to the decision-making process, and changes to the tools or environment used in bitcoin development. Any meta-BIP is also considered a process BIP.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-1591">
<p>As BIPs s√£o registradas em um reposit√≥rio versionado do GitHub: <a href="https://github.com/bitcoin/bips" data-href="https://github.com/bitcoin/bips">https://github.com/bitcoin/bips</a> . A <a href="#table_d-1">Lista das BIPs</a> mostra uma listagem do estado das BIPs em abril de 2017. Consulte o reposit√≥rio oficial para obter informa√ß√µes atualizadas sobre as BIPs existentes e seus conte√∫dos.</p>
</div>
<table id="table_d-1" class="tableblock frame-all grid-all stretch data-line-1596">
<caption class="title">Table 40. Lista das BIPs</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">N√∫mero</th>
<th class="tableblock halign-left valign-top">T√≠tulo</th>
<th class="tableblock halign-left valign-top">Autor</th>
<th class="tableblock halign-left valign-top">Tipo</th>
<th class="tableblock halign-left valign-top">Status</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-1"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0001.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0001.mediawiki">BIP-1</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BIP Purpose and Guidelines</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amir Taaki</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Substitu√≠da</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-2"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0002.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0002.mediawiki">BIP-2</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BIP process, revised</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Luke Dashjr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ativa</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-8"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0008.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0008.mediawiki">BIP-8</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version bits with guaranteed lock-in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shaolin Fry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informativa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-9"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0009.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0009.mediawiki">BIP-9</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version bits with timeout and delay</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pieter Wuille, Peter Todd, Greg Maxwell, Rusty Russell</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informativa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conclu√≠da</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-10"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0010.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0010.mediawiki">BIP-10</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multi-Sig Transaction Distribution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alan Reiner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informativa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removida</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-11"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0011.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0011.mediawiki">BIP-11</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">M-of-N Standard Transactions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conclu√≠da</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-12"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0012.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0012.mediawiki">BIP-12</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_EVAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removida</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-13"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0013.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0013.mediawiki">BIP-13</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address Format for pay-to-script-hash</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conclu√≠da</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-14"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0014.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0014.mediawiki">BIP-14</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Protocol Version and User Agent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amir Taaki, Patrick Strateman</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conclu√≠da</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-15"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0015.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0015.mediawiki">BIP-15</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aliases</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amir Taaki</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adiada</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-16"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0016.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0016.mediawiki">BIP-16</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pay to Script Hash</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conclu√≠da</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-17"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0017.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0017.mediawiki">BIP-17</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_CHECKHASHVERIFY (CHV)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Luke Dashjr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removida</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-18"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0018.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0018.mediawiki">BIP-18</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hashScriptCheck</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Luke Dashjr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proposta</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-19"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0019.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0019.mediawiki">BIP-19</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">M-of-N Standard Transactions (Low SigOp)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Luke Dashjr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-20"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0020.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0020.mediawiki">BIP-20</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URI Scheme</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Luke Dashjr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Substitu√≠da</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-21"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0021.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0021.mediawiki">BIP-21</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URI Scheme</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nils Schneider, Matt Corallo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conclu√≠da</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-22"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0022.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0022.mediawiki">BIP-22</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">getblocktemplate - Fundamentals</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Luke Dashjr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conclu√≠da</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-23"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0023.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0023.mediawiki">BIP-23</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">getblocktemplate - Pooled Mining</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Luke Dashjr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conclu√≠da</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-30"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0030.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0030.mediawiki">BIP-30</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate transactions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pieter Wuille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conclu√≠da</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-31"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0031.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0031.mediawiki">BIP-31</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pong message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mike Hearn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conclu√≠da</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-32"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki">BIP-32</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hierarchical Deterministic Wallets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pieter Wuille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informativa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conclu√≠da</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-33"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0033.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0033.mediawiki">BIP-33</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stratized Nodes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amir Taaki</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-34"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0034.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0034.mediawiki">BIP-34</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block v2, Height in Coinbase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conclu√≠da</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-35"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0035.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0035.mediawiki">BIP-35</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mempool message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jeff Garzik</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conclu√≠da</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-36"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0036.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0036.mediawiki">BIP-36</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom Services</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stefan Thomas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-37"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0037.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0037.mediawiki">BIP-37</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection Bloom filtering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mike Hearn, Matt Corallo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conclu√≠da</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-39"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki">BIP-39</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mnemonic code for generating deterministic keys</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marek Palatinus, Pavol Rusnak, Aaron Voisine, Sean Bowe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proposta</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-40"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0040.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0040.mediawiki">BIP-40</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stratum wire protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marek Palatinus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N¬∫ BIP alocado</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-41"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0041.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0041.mediawiki">BIP-41</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stratum mining protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marek Palatinus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N¬∫ BIP alocado</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-42"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0042.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0042.mediawiki">BIP-42</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A finite monetary supply for Bitcoin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pieter Wuille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-43"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0043.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0043.mediawiki">BIP-43</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Purpose Field for Deterministic Wallets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marek Palatinus, Pavol Rusnak</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informativa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-44"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki">BIP-44</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multi-Account Hierarchy for Deterministic Wallets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marek Palatinus, Pavol Rusnak</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proposta</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-45"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0045.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0045.mediawiki">BIP-45</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Structure for Deterministic P2SH Multisignature Wallets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manuel Araoz, Ryan X. Charles, Matias Alejo Garcia</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proposta</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-47"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0047.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0047.mediawiki">BIP-47</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reusable Payment Codes for Hierarchical Deterministic Wallets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Justus Ranvier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informativa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-49"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0049.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0049.mediawiki">BIP-49</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Derivation scheme for P2WPKH-nested-in-P2SH based accounts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Daniel Weigl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informativa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-50"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0050.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0050.mediawiki">BIP-50</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">March 2013 Chain Fork Post-Mortem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informativa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conclu√≠da</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-60"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0060.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0060.mediawiki">BIP-60</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fixed Length "version" Message (Relay-Transactions Field)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amir Taaki</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-61"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0061.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0061.mediawiki">BIP-61</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reject P2P message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conclu√≠da</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-62"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0062.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0062.mediawiki">BIP-62</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dealing with malleability</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pieter Wuille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removida</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-63"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0063.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0063.mediawiki">BIP-63</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stealth Addresses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Peter Todd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N¬∫ BIP alocado</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-64"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0064.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0064.mediawiki">BIP-64</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">getutxo message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mike Hearn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-65"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0065.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0065.mediawiki">BIP-65</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_CHECKLOCKTIMEVERIFY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Peter Todd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conclu√≠da</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-66"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0066.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0066.mediawiki">BIP-66</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strict DER signatures</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pieter Wuille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conclu√≠da</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-67"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0067.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0067.mediawiki">BIP-67</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deterministic Pay-to-script-hash multi-signature addresses through public key sorting</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Thomas Kerin, Jean-Pierre Rupp, Ruben de Vries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proposta</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-68"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0068.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0068.mediawiki">BIP-68</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Relative lock-time using consensus-enforced sequence numbers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark Friedenbach, BtcDrak, Nicolas Dorier, kinoshitajona</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conclu√≠da</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-69"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0069.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0069.mediawiki">BIP-69</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lexicographical Indexing of Transaction Inputs and Outputs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kristov Atlas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informativa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proposta</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-70"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0070.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0070.mediawiki">BIP-70</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Payment Protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen, Mike Hearn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conclu√≠da</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-71"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0071.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0071.mediawiki">BIP-71</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Payment Protocol MIME types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conclu√≠da</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-72"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0072.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0072.mediawiki">BIP-72</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bitcoin: uri extensions for Payment Protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conclu√≠da</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-73"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0073.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0073.mediawiki">BIP-73</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use "Accept" header for response type negotiation with Payment Request URLs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stephen Pair</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conclu√≠da</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-74"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0074.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0074.mediawiki">BIP-74</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow zero value OP_RETURN in Payment Protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Toby Padilla</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-75"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0075.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0075.mediawiki">BIP-75</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Out of Band Address Exchange using Payment Protocol Encryption</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Justin Newton, Matt David, Aaron Voisine, James MacWhyte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-80"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0080.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0080.mediawiki">BIP-80</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hierarchy for Non-Colored Voting Pool Deterministic Multisig Wallets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Justus Ranvier, Jimmy Song</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informativa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adiada</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-81"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0081.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0081.mediawiki">BIP-81</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hierarchy for Colored Voting Pool Deterministic Multisig Wallets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Justus Ranvier, Jimmy Song</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informativa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adiada</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-83"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0083.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0083.mediawiki">BIP-83</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dynamic Hierarchical Deterministic Key Trees</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eric Lombrozo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-90"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0090.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0090.mediawiki">BIP-90</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Buried Deployments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suhas Daftuar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informativa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-99"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0099.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0099.mediawiki">BIP-99</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Motivation and deployment of consensus rule changes ([soft/hard]forks)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jorge Tim√≥n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informativa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-101"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0101.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0101.mediawiki">BIP-101</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Increase maximum block size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removida</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-102"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0102.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0102.mediawiki">BIP-102</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block size increase to 2MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jeff Garzik</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-103"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0103.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0103.mediawiki">BIP-103</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block size following technological growth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pieter Wuille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-104"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0104.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0104.mediawiki">BIP-104</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Block75' - Max block size like difficulty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">t.khan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-105"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0105.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0105.mediawiki">BIP-105</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Consensus based block size retargeting algorithm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BtcDrak</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-106"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0106.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0106.mediawiki">BIP-106</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dynamically Controlled Bitcoin Block Size Max Cap</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Upal Chakraborty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-107"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0107.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0107.mediawiki">BIP-107</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dynamic limit on the block size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Washington Y. Sanchez</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-109"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0109.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0109.mediawiki">BIP-109</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Two million byte size limit with sigop and sighash limits</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rejeitada</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-111"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0111.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0111.mediawiki">BIP-111</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NODE_BLOOM service bit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matt Corallo, Peter Todd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proposta</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-112"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0112.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0112.mediawiki">BIP-112</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CHECKSEQUENCEVERIFY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BtcDrak, Mark Friedenbach, Eric Lombrozo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conclu√≠da</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-113"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0113.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0113.mediawiki">BIP-113</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Median time-past as endpoint for lock-time calculations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Thomas Kerin, Mark Friedenbach</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conclu√≠da</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-114"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0114.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0114.mediawiki">BIP-114</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Merkelized Abstract Syntax Tree</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Johnson Lau</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-120"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0120.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0120.mediawiki">BIP-120</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proof of Payment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kalle Rosenbaum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-121"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0121.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0121.mediawiki">BIP-121</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proof of Payment URI scheme</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kalle Rosenbaum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-122"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0122.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0122.mediawiki">BIP-122</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URI scheme for Blockchain references / exploration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marco Pontello</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-123"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0123.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0123.mediawiki">BIP-123</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BIP Classification</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eric Lombrozo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ativa</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-124"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0124.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0124.mediawiki">BIP-124</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hierarchical Deterministic Script Templates</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eric Lombrozo, William Swanson</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informativa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-125"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0125.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0125.mediawiki">BIP-125</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Opt-in Full Replace-by-Fee Signaling</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">David A. Harding, Peter Todd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proposta</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-126"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0126.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0126.mediawiki">BIP-126</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Best Practices for Heterogeneous Input Script Transactions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kristov Atlas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informativa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-130"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0130.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0130.mediawiki">BIP-130</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sendheaders message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suhas Daftuar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proposta</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-131"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0131.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0131.mediawiki">BIP-131</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Coalescing Transaction" Specification (wildcard inputs)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Chris Priest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-132"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0132.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0132.mediawiki">BIP-132</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Committee-based BIP Acceptance Process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Andy Chase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removida</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-133"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0133.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0133.mediawiki">BIP-133</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feefilter message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alex Morcos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-134"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0134.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0134.mediawiki">BIP-134</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flexible Transactions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tom Zander</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-140"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0140.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0140.mediawiki">BIP-140</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Normalized TXID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Christian Decker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-141"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki">BIP-141</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Segregated Witness (Consensus layer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eric Lombrozo, Johnson Lau, Pieter Wuille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-142"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0142.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0142.mediawiki">BIP-142</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address Format for Segregated Witness</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Johnson Lau</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adiada</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-143"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0143.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0143.mediawiki">BIP-143</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction Signature Verification for Version 0 Witness Program</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Johnson Lau, Pieter Wuille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-144"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0144.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0144.mediawiki">BIP-144</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Segregated Witness (Peer Services)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eric Lombrozo, Pieter Wuille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-145"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0145.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0145.mediawiki">BIP-145</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">getblocktemplate Updates for Segregated Witness</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Luke Dashjr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-146"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0146.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0146.mediawiki">BIP-146</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dealing with signature encoding malleability</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Johnson Lau, Pieter Wuille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-147"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0147.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0147.mediawiki">BIP-147</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dealing with dummy stack element malleability</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Johnson Lau</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-148"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0148.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0148.mediawiki">BIP-148</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mandatory activation of segwit deployment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shaolin Fry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-150"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0150.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0150.mediawiki">BIP-150</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Peer Authentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jonas Schnelli</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-151"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0151.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0151.mediawiki">BIP-151</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Peer-to-Peer Communication Encryption</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jonas Schnelli</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-152"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0152.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0152.mediawiki">BIP-152</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compact Block Relay</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matt Corallo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-171"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0171.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0171.mediawiki">BIP-171</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Currency/exchange rate information API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Luke Dashjr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-180"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0180.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0180.mediawiki">BIP-180</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block size/weight fraud proof</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Luke Dashjr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-199"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0199.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0199.mediawiki">BIP-199</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hashed Time-Locked Contract transactions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sean Bowe, Daira Hopwood</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padr√£o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
</tbody>
</table>
<div id="appdx_bitcore" class="paragraph data-line-1699">
<p>== Bitcore</p>
</div>
<div class="paragraph data-line-1702">
<p>O Bitcore √© um conjunto de ferramentas fornecido pela BitPay. Seu objetivo √© fornecer ferramentas f√°ceis de usar para os desenvolvedores do Bitcoin. Quase todo o c√≥digo do Bitcore √© escrito em JavaScript. Existem alguns m√≥dulos escritos especificamente para o NodeJS. Al√©m disso, o m√≥dulo "bitcore-node" do Bitcore inclui o c√≥digo C++ do Bitcoin Core. Para maiores informa√ß√µes, visite o site <a href="https://bitcore.io" class="undefined" data-href="https://bitcore.io">https://bitcore.io</a>.</p>
</div>
<div class="paragraph data-line-1704">
<p>=== Lista de Recursos do Bitcore</p>
</div>
<div class="ulist data-line-1706">
<ul>
<li class="data-line-1706">
<p>N√≥ completo de bitcoin (bitcore-node)</p>
</li>
<li class="data-line-1707">
<p>Explorador de blocos (insight)</p>
</li>
<li class="data-line-1708">
<p>Utilit√°rios de bloco, transa√ß√£o e carteira (bitcore-lib)</p>
</li>
<li class="data-line-1709">
<p>Comunica√ß√£o direta com a rede P2P do bitcoin (bitcore-p2p)</p>
</li>
<li class="data-line-1710">
<p>Gera√ß√£o de semente mnem√¥nica (bitcore-mnemonic)</p>
</li>
<li class="data-line-1711">
<p>Protocolo de pagamento (bitcore-payment-protocol)</p>
</li>
<li class="data-line-1712">
<p>Verifica√ß√£o e assinatura de mensagens (bitcore-message)</p>
</li>
<li class="data-line-1713">
<p>Esquema Integrado de Criptografia de Curva El√≠ptica (ECIES) (bitcore-ecies)</p>
</li>
<li class="data-line-1714">
<p>Servi√ßo de carteira (bitcore-wallet-service)</p>
</li>
<li class="data-line-1715">
<p>Cliente de carteira (bitcore-wallet-client)</p>
</li>
<li class="data-line-1716">
<p>Integra√ß√£o de servi√ßos diretamente com o Bitcoin Core (bitcore-node)</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1718">
<p>=== Exemplos de Bibliotecas do Bitcore</p>
</div>
<div class="paragraph data-line-1720">
<p>==== Pr√©-requisitos</p>
</div>
<div class="ulist data-line-1722">
<ul>
<li class="data-line-1722">
<p>NodeJS &gt;= 4.x</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1724">
<p>Se estiver usando o NodeJS e o n√≥ REPL:</p>
</div>
<div class="listingblock data-line-1727">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ npm install -g bitcore-lib bitcore-p2p</code></pre>
</div>
</div>
<div class="paragraph data-line-1731">
<p>==== Exemplos de Carteiras usando a bitcore-lib</p>
</div>
<div class="paragraph data-line-1733">
<p>Criando um novo endere√ßo Bitcoin com uma chave privada associada:</p>
</div>
<div class="listingblock data-line-1735">
<div class="content">
<pre>&gt; bitcore = require('bitcore-lib')
&gt; privateKey = new bitcore.PrivateKey()
&gt; address = privateKey.toAddress().toString()</pre>
</div>
</div>
<div class="paragraph data-line-1741">
<p>Criando uma chave privada e um endere√ßo determin√≠stico hier√°rquico:</p>
</div>
<div class="listingblock data-line-1743">
<div class="content">
<pre>&gt; hdPrivateKey = bitcore.HDPrivateKey()
&gt; hdPublicKey = bitcore.HDPublicKey(hdPrivateKey)
&gt; hdAddress = new bitcore.Address(hdPublicKey.publicKey).toString()</pre>
</div>
</div>
<div class="paragraph data-line-1749">
<p>Criando e assinando uma transa√ß√£o a partir de uma UTXO:</p>
</div>
<div class="listingblock data-line-1751">
<div class="content">
<pre>&gt; utxo = {
txId: txId, // ID da transa√ß√£o que cont√©m uma sa√≠da n√£o gasta
outputIndex: outputIndex, // √≠ndice da sa√≠da (ex: 0)
  address: addressOfUtxo, // endere√ßo da UTXO
  script: bitcore.Script.buildPublicKeyHashOut(addressOfUtxo).toString(),
satoshis: satoshis // quantia enviada para o endere√ßo
}
&gt; fee = 3000 // taxa definida adequadamente para as condi√ß√µes na rede
&gt; tx = new bitcore.Transaction()
        .from(utxo)
        .to(address, 35000)
        .fee(fee)
        .enableRBF()
        .sign(privateKeyOfUtxo)</pre>
</div>
</div>
<div class="paragraph data-line-1768">
<p>Substituindo a √∫ltima transa√ß√£o na mempool (<em>replace-by-fee</em>):</p>
</div>
<div class="listingblock data-line-1770">
<div class="content">
<pre>&gt; rbfTx = new Transaction()
           .from(utxo)
           .to(address, 35000)
           .fee(fee*2)
           .enableRBF()
           .sign(privateKeyOfUtxo);
&gt; tx.serialize();
&gt; rbfTx.serialize();</pre>
</div>
</div>
<div class="paragraph data-line-1781">
<p>Transmitindo uma transa√ß√£o para a rede bitcoin
(nota: transmite apenas transa√ß√µes v√°lidas; consulte <a href="https://bitnodes.21.co/nodes" class="undefined" data-href="https://bitnodes.21.co/nodes">https://bitnodes.21.co/nodes</a> para hosts pares):</p>
</div>
<div class="olist arabic data-line-1784">
<ol class="arabic">
<li class="data-line-1784">
<p>Copie o c√≥digo abaixo em um arquivo chamado <em>broadcast.js</em>.</p>
</li>
<li class="data-line-1785">
<p>As vari√°veis tx e rbfTx s√£o o output das fun√ß√µes tx.serialize() e rbfTx.serialize(), respectivamente.</p>
</li>
<li class="data-line-1786">
<p>Para substituir por taxa (<em>replace-by-fee</em>), o par deve suportar a op√ß√£o mempoolreplace do bitcoind e deve ter ela definida como 1.</p>
</li>
<li class="data-line-1787">
<p>Execute o n√≥ do arquivo <em>broadcast.js</em>:</p>
</li>
</ol>
</div>
<div class="listingblock data-line-1789">
<div class="content">
<pre>var p2p = require('bitcore-p2p');
var bitcore = require('bitcore-lib');
var tx = new bitcore.Transaction('output da fun√ß√£o serialize');
var rbfTx = new bitcore.Transaction('output da fun√ß√£o serialize');
var host = 'endere√ßo ip'; // usar n√≥ par v√°lido escutando na porta tcp 8333
var peer = new p2p.Peer({host: host});
var messages = new p2p.Messages();
peer.on('ready', function() {
  var txs = [messages.Transaction(tx), messages.Transaction(rbfTx)];
  var index = 0;
  var interval = setInterval(function() {
    peer.sendMessage(txs[index++]);
    console.log('transa√ß√£o: ' + index + ' enviada');
    if (index === txs.length) {
      clearInterval(interval);
      console.log('desconectando do peer: ' + host);
      peer.disconnect();
    }
  }, 2000);
});
peer.connect();</pre>
</div>
</div>
<div id="appdx-pycoin" class="paragraph data-line-1815">
<p>== pycoin, ku e tx</p>
</div>
<div class="paragraph data-line-1818">
<p>A biblioteca Python <a href="https://github.com/richardkiss/pycoin" data-href="https://github.com/richardkiss/pycoin">pycoin</a>, originalmente escrita e mantida por Richard Kiss, √© uma biblioteca baseada em Python que suporta a manipula√ß√£o de chaves e transa√ß√µes bitcoin, suportando at√© mesmo a linguagem de script, o suficiente para lidar com transa√ß√µes fora do padr√£o.</p>
</div>
<div class="paragraph data-line-1820">
<p>A biblioteca pycoin suporta tanto o Python 2 (2.7.x) quanto o Python 3 (3.3 e posteirores), e vem com alguns utilit√°rios de linha de comando √∫teis, o ku e o tx.</p>
</div>
<div class="paragraph data-line-1822">
<p>=== Utilit√°rio de Chave (Key Utility, KU)</p>
</div>
<div class="paragraph data-line-1824">
<p>O utilit√°rio de linha de comando ku ("key utility, utilit√°rio de chave") √© um canivete su√≠√ßo para a manipula√ß√£o de chaves. Ele suporta chaves BIP-32, WIF e endere√ßos (bitcoin e alt coins). A seguir, alguns exemplos.</p>
</div>
<div class="paragraph data-line-1826">
<p>Criar uma chave privada BIP-32 usando fontes de entropia padr√£o GPG e <em>/dev/random</em>:</p>
</div>
<div class="listingblock data-line-1829">
<div class="content">
<pre>$ ku create

input           : create
network         : Bitcoin
wallet key      : xprv9s21ZrQH143K3LU5ctPZTBnb9kTjA5Su9DcWHvXJemiJBsY7VqXUG7hipgdWaU
                    m2nhnzdvxJf5KJo9vjP2nABX65c5sFsWsV8oXcbpehtJi
public version  : xpub661MyMwAqRbcFpYYiuvZpKjKhnJDZYAkWSY76JvvD7FH4fsG3Nqiov2CfxzxY8
                    DGcpfT56AMFeo8M8KPkFMfLUtvwjwb6WPv8rY65L2q8Hz
tree depth      : 0
fingerprint     : 9d9c6092
parent f'print  : 00000000
child index     : 0
chain code      : 80574fb260edaa4905bc86c9a47d30c697c50047ed466c0d4a5167f6821e8f3c
private key     : yes
secret exponent : 112471538590155650688604752840386134637231974546906847202389294096567806844862
 hex            : f8a8a28b28a916e1043cc0aca52033a18a13cab1638d544006469bc171fddfbe
wif             : L5Z54xi6qJusQT42JHA44mfPVZGjyb4XBRWfxAzUWwRiGx1kV4sP
 uncompressed   : 5KhoEavGNNH4GHKoy2Ptu4KfdNp4r56L5B5un8FP6RZnbsz5Nmb
public pair x   : 76460638240546478364843397478278468101877117767873462127021560368290114016034
public pair y   : 59807879657469774102040120298272207730921291736633247737077406753676825777701
 x as hex       : a90b3008792432060fa04365941e09a8e4adf928bdbdb9dad41131274e379322
 y as hex       : 843a0f6ed9c0eb1962c74533795406914fe3f1957c5238951f4fe245a4fcd625
y parity        : odd
key pair as sec : 03a90b3008792432060fa04365941e09a8e4adf928bdbdb9dad41131274e379322
 uncompressed   : 04a90b3008792432060fa04365941e09a8e4adf928bdbdb9dad41131274e379322
                    843a0f6ed9c0eb1962c74533795406914fe3f1957c5238951f4fe245a4fcd625
hash160         : 9d9c609247174ae323acfc96c852753fe3c8819d
 uncompressed   : 8870d869800c9b91ce1eb460f4c60540f87c15d7
Bitcoin address : 1FNNRQ5fSv1wBi5gyfVBs2rkNheMGt86sp
 uncompressed   : 1DSS5isnH4FsVaLVjeVXewVSpfqktdiQAM</pre>
</div>
</div>
<div class="paragraph data-line-1862">
<p>Criar uma chave BIP-32 a partir de uma frase de senha (<em>passphrase</em>):</p>
</div>
<div class="admonitionblock warning data-line-1865">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-1866">
<p>A frase de senha usada nesse exemplo √© f√°cil demais de ser descoberta.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock data-line-1869">
<div class="content">
<pre>$ ku P:foo

input           : P:foo
network         : Bitcoin
wallet key      : xprv9s21ZrQH143K31AgNK5pyVvW23gHnkBq2wh5aEk6g1s496M8ZMjxncCKZKgb5j
                    ZoY5eSJMJ2Vbyvi2hbmQnCuHBujZ2WXGTux1X2k9Krdtq
public version  : xpub661MyMwAqRbcFVF9ULcqLdsEa5WnCCugQAcgNd9iEMQ31tgH6u4DLQWoQayvtS
                    VYFvXz2vPPpbXE1qpjoUFidhjFj82pVShWu9curWmb2zy
tree depth      : 0
fingerprint     : 5d353a2e
parent f'print  : 00000000
child index     : 0
chain code      : 5eeb1023fd6dd1ae52a005ce0e73420821e1d90e08be980a85e9111fd7646bbc
private key     : yes
secret exponent : 65825730547097305716057160437970790220123864299761908948746835886007793998275
 hex            : 91880b0e3017ba586b735fe7d04f1790f3c46b818a2151fb2def5f14dd2fd9c3
wif             : L26c3H6jEPVSqAr1usXUp9qtQJw6NHgApq6Ls4ncyqtsvcq2MwKH
 uncompressed   : 5JvNzA5vXDoKYJdw8SwwLHxUxaWvn9mDea6k1vRPCX7KLUVWa7W
public pair x   : 81821982719381104061777349269130419024493616650993589394553404347774393168191
public pair y   : 58994218069605424278320703250689780154785099509277691723126325051200459038290
 x as hex       : b4e599dfa44555a4ed38bcfff0071d5af676a86abf123c5b4b4e8e67a0b0b13f
 y as hex       : 826d8b4d3010aea16ff4c1c1d3ae68541d9a04df54a2c48cc241c2983544de52
y parity        : even
key pair as sec : 02b4e599dfa44555a4ed38bcfff0071d5af676a86abf123c5b4b4e8e67a0b0b13f
 uncompressed   : 04b4e599dfa44555a4ed38bcfff0071d5af676a86abf123c5b4b4e8e67a0b0b13f
                    826d8b4d3010aea16ff4c1c1d3ae68541d9a04df54a2c48cc241c2983544de52
hash160         : 5d353a2ecdb262477172852d57a3f11de0c19286
 uncompressed   : e5bd3a7e6cb62b4c820e51200fb1c148d79e67da
Bitcoin address : 19Vqc8uLTfUonmxUEZac7fz1M5c5ZZbAii
 uncompressed   : 1MwkRkogzBRMehBntgcq2aJhXCXStJTXHT</pre>
</div>
</div>
<div class="paragraph data-line-1903">
<p>Adquirir informa√ß√µes como JSON:</p>
</div>
<div class="listingblock data-line-1906">
<div class="content">
<pre>$ ku P:foo -P -j</pre>
</div>
</div>
<div class="listingblock data-line-1910">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "y_parity": "even",
   "public_pair_y_hex": "826d8b4d3010aea16ff4c1c1d3ae68541d9a04df54a2c48cc241c2983544de52",
   "private_key": "no",
   "parent_fingerprint": "00000000",
   "tree_depth": "0",
   "network": "Bitcoin",
   "btc_address_uncompressed": "1MwkRkogzBRMehBntgcq2aJhXCXStJTXHT",
   "key_pair_as_sec_uncompressed": "04b4e599dfa44555a4ed38bcfff0071d5af676a86abf123c5b4b4e8e67a0b0b13f826d8b4d3010aea16ff4c1c1d3ae68541d9a04df54a2c48cc241c2983544de52",
   "public_pair_x_hex": "b4e599dfa44555a4ed38bcfff0071d5af676a86abf123c5b4b4e8e67a0b0b13f",
   "wallet_key": "xpub661MyMwAqRbcFVF9ULcqLdsEa5WnCCugQAcgNd9iEMQ31tgH6u4DLQWoQayvtSVYFvXz2vPPpbXE1qpjoUFidhjFj82pVShWu9curWmb2zy",
   "chain_code": "5eeb1023fd6dd1ae52a005ce0e73420821e1d90e08be980a85e9111fd7646bbc",
   "child_index": "0",
   "hash160_uncompressed": "e5bd3a7e6cb62b4c820e51200fb1c148d79e67da",
   "btc_address": "19Vqc8uLTfUonmxUEZac7fz1M5c5ZZbAii",
   "fingerprint": "5d353a2e",
   "hash160": "5d353a2ecdb262477172852d57a3f11de0c19286",
   "input": "P:foo",
   "public_pair_x": "81821982719381104061777349269130419024493616650993589394553404347774393168191",
   "public_pair_y": "58994218069605424278320703250689780154785099509277691723126325051200459038290",
   "key_pair_as_sec": "02b4e599dfa44555a4ed38bcfff0071d5af676a86abf123c5b4b4e8e67a0b0b13f"
}</code></pre>
</div>
</div>
<div class="paragraph data-line-1935">
<p>Chave p√∫blica BIP-32:</p>
</div>
<div class="listingblock data-line-1937">
<div class="content">
<pre>$ ku -w -P P:foo
xpub661MyMwAqRbcFVF9ULcqLdsEa5WnCCugQAcgNd9iEMQ31tgH6u4DLQWoQayvtSVYFvXz2vPPpbXE1qpjoUFidhjFj82pVShWu9curWmb2zy</pre>
</div>
</div>
<div class="paragraph data-line-1942">
<p>Gerar uma subchave:</p>
</div>
<div class="listingblock data-line-1944">
<div class="content">
<pre>$ ku -w -s3/2 P:foo
xprv9wTErTSkjVyJa1v4cUTFMFkWMe5eu8ErbQcs9xajnsUzCBT7ykHAwdrxvG3g3f6BFk7ms5hHBvmbdutNmyg6iogWKxx6mefEw4M8EroLgKj</pre>
</div>
</div>
<div class="paragraph data-line-1949">
<p>Gerar uma subchave endurecida:</p>
</div>
<div class="listingblock data-line-1951">
<div class="content">
<pre>$ ku -w -s3/2H P:foo
xprv9wTErTSu5AWGkDeUPmqBcbZWX1xq85ZNX9iQRQW9DXwygFp7iRGJo79dsVctcsCHsnZ3XU3DhsuaGZbDh8iDkBN45k67UKsJUXM1JfRCdn1</pre>
</div>
</div>
<div class="paragraph data-line-1956">
<p>Gerar uma chave privada WIF:</p>
</div>
<div class="listingblock data-line-1958">
<div class="content">
<pre>$ ku -W P:foo
L26c3H6jEPVSqAr1usXUp9qtQJw6NHgApq6Ls4ncyqtsvcq2MwKH</pre>
</div>
</div>
<div class="paragraph data-line-1963">
<p>Gerar um endere√ßo:</p>
</div>
<div class="listingblock data-line-1966">
<div class="content">
<pre>$ ku -a P:foo
19Vqc8uLTfUonmxUEZac7fz1M5c5ZZbAii</pre>
</div>
</div>
<div class="paragraph data-line-1973">
<p>Gerar v√°rias subchaves:</p>
</div>
<div class="listingblock data-line-1976">
<div class="content">
<pre>$ ku P:foo -s 0/0-5 -w
xprv9xWkBDfyBXmZjBG9EiXBpy67KK72fphUp9utJokEBFtjsjiuKUUDF5V3TU8U8cDzytqYnSekc8bYuJS8G3bhXxKWB89Ggn2dzLcoJsuEdRK
xprv9xWkBDfyBXmZnzKf3bAGifK593gT7WJZPnYAmvc77gUQVej5QHckc5Adtwxa28ACmANi9XhCrRvtFqQcUxt8rUgFz3souMiDdWxJDZnQxzx
xprv9xWkBDfyBXmZqdXA8y4SWqfBdy71gSW9sjx9JpCiJEiBwSMQyRxan6srXUPBtj3PTxQFkZJAiwoUpmvtrxKZu4zfsnr3pqyy2vthpkwuoVq
xprv9xWkBDfyBXmZsA85GyWj9uYPyoQv826YAadKWMaaEosNrFBKgj2TqWuiWY3zuqxYGpHfv9cnGj5P7e8EskpzKL1Y8Gk9aX6QbryA5raK73p
xprv9xWkBDfyBXmZv2q3N66hhZ8DAcEnQDnXML1J62krJAcf7Xb1HJwuW2VMJQrCofY2jtFXdiEY8UsRNJfqK6DAdyZXoMvtaLHyWQx3FS4A9zw
xprv9xWkBDfyBXmZw4jEYXUHYc9fT25k9irP87n2RqfJ5bqbjKdT84Mm7Wtc2xmzFuKg7iYf7XFHKkSsaYKWKJbR54bnyAD9GzjUYbAYTtN4ruo</pre>
</div>
</div>
<div class="paragraph pagebreak-before data-line-1987">
<p>Gerar os endere√ßos correspondentes:</p>
</div>
<div class="listingblock data-line-1990">
<div class="content">
<pre>$ ku P:foo -s 0/0-5 -a
1MrjE78H1R1rqdFrmkjdHnPUdLCJALbv3x
1AnYyVEcuqeoVzH96zj1eYKwoWfwte2pxu
1GXr1kZfxE1FcK6ZRD5sqqqs5YfvuzA1Lb
116AXZc4bDVQrqmcinzu4aaPdrYqvuiBEK
1Cz2rTLjRM6pMnxPNrRKp9ZSvRtj5dDUML
1WstdwPnU6HEUPme1DQayN9nm6j7nDVEM</pre>
</div>
</div>
<div class="paragraph data-line-2001">
<p>Gerar os WIFs correspondentes:</p>
</div>
<div class="listingblock data-line-2004">
<div class="content">
<pre>$ ku P:foo -s 0/0-5 -W
L5a4iE5k9gcJKGqX3FWmxzBYQc29PvZ6pgBaePLVqT5YByEnBomx
Kyjgne6GZwPGB6G6kJEhoPbmyjMP7D5d3zRbHVjwcq4iQXD9QqKQ
L4B3ygQxK6zH2NQGxLDee2H9v4Lvwg14cLJW7QwWPzCtKHdWMaQz
L2L2PZdorybUqkPjrmhem4Ax5EJvP7ijmxbNoQKnmTDMrqemY8UF
L2oD6vA4TUyqPF8QG4vhUFSgwCyuuvFZ3v8SKHYFDwkbM765Nrfd
KzChTbc3kZFxUSJ3Kt54cxsogeFAD9CCM4zGB22si8nfKcThQn8C</pre>
</div>
</div>
<div class="paragraph data-line-2016">
<p>Verificar se isso funciona ao escolher uma <em>string</em> BIP-32 (a que corresponde √† subchave 0/3):</p>
</div>
<div class="listingblock data-line-2020">
<div class="content">
<pre>$ ku -W xprv9xWkBDfyBXmZsA85GyWj9uYPyoQv826YAadKWMaaEosNrFBKgj2TqWuiWY3zuqxYGpHfv9cnGj5P7e8EskpzKL1Y8Gk9aX6QbryA5raK73p
L2L2PZdorybUqkPjrmhem4Ax5EJvP7ijmxbNoQKnmTDMrqemY8UF
$ ku -a xprv9xWkBDfyBXmZsA85GyWj9uYPyoQv826YAadKWMaaEosNrFBKgj2TqWuiWY3zuqxYGpHfv9cnGj5P7e8EskpzKL1Y8Gk9aX6QbryA5raK73p
116AXZc4bDVQrqmcinzu4aaPdrYqvuiBEK</pre>
</div>
</div>
<div class="paragraph data-line-2028">
<p>Sim, isso parece familiar.</p>
</div>
<div class="paragraph data-line-2030">
<p>A partir de um expoente secreto:</p>
</div>
<div class="listingblock data-line-2033">
<div class="content">
<pre>$ ku 1

input           : 1
network         : Bitcoin
secret exponent : 1
 hex            : 1
wif             : KwDiBf89QgGbjEhKnhXJuH7LrciVrZi3qYjgd9M7rFU73sVHnoWn
 uncompressed   : 5HpHagT65TZzG1PH3CSu63k8DbpvD8s5ip4nEB3kEsreAnchuDf
public pair x   : 55066263022277343669578718895168534326250603453777594175500187360389116729240
public pair y   : 32670510020758816978083085130507043184471273380659243275938904335757337482424
 x as hex       : 79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798
 y as hex       : 483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8
y parity        : even
key pair as sec : 0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798
 uncompressed   : 0479be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798
                    483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8
hash160         : 751e76e8199196d454941c45d1b3a323f1433bd6
 uncompressed   : 91b24bf9f5288532960ac687abb035127b1d28a5
Bitcoin address : 1BgGZ9tcN4rm9KBzDn7KprQz87SZ26SAMH
 uncompressed   : 1EHNa6Q4Jz2uvNExL497mE43ikXhwF6kZm</pre>
</div>
</div>
<div class="paragraph data-line-2057">
<p>Vers√£o Litecoin:</p>
</div>
<div class="listingblock data-line-2060">
<div class="content">
<pre>$ ku -nL 1

input            : 1
network          : Litecoin
secret exponent  : 1
 hex             : 1
wif              : T33ydQRKp4FCW5LCLLUB7deioUMoveiwekdwUwyfRDeGZm76aUjV
 uncompressed    : 6u823ozcyt2rjPH8Z2ErsSXJB5PPQwK7VVTwwN4mxLBFrao69XQ
public pair x    : 55066263022277343669578718895168534326250603453777594175500187360389116729240
public pair y    : 32670510020758816978083085130507043184471273380659243275938904335757337482424
 x as hex        : 79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798
 y as hex        : 483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8
y parity         : even
key pair as sec  : 0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798
 uncompressed    : 0479be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798
                     483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8
hash160          : 751e76e8199196d454941c45d1b3a323f1433bd6
 uncompressed    : 91b24bf9f5288532960ac687abb035127b1d28a5
Litecoin address : LVuDpNCSSj6pQ7t9Pv6d6sUkLKoqDEVUnJ
 uncompressed    : LYWKqJhtPeGyBAw7WC8R3F7ovxtzAiubdM</pre>
</div>
</div>
<div class="paragraph data-line-2084">
<p>WIF Dogecoin:</p>
</div>
<div class="listingblock data-line-2087">
<div class="content">
<pre>$ ku -nD -W 1
QNcdLVw8fHkixm6NNyN6nVwxKek4u7qrioRbQmjxac5TVoTtZuot</pre>
</div>
</div>
<div class="paragraph data-line-2093">
<p>A partir de um par p√∫blico (na Testnet):</p>
</div>
<div class="listingblock data-line-2096">
<div class="content">
<pre>$ ku -nT 55066263022277343669578718895168534326250603453777594175500187360389116729240,even

input                   : 550662630222773436695787188951685343262506034537775941755001873603
                            89116729240,even
network                 : Bitcoin testnet
public pair x           : 55066263022277343669578718895168534326250603453777594175500187360389116729240
public pair y           : 32670510020758816978083085130507043184471273380659243275938904335757337482424
 x as hex               : 79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798
 y as hex               : 483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8
y parity                : even
key pair as sec         : 0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798
 uncompressed           : 0479be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798
                            483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8
hash160                 : 751e76e8199196d454941c45d1b3a323f1433bd6
 uncompressed           : 91b24bf9f5288532960ac687abb035127b1d28a5
Bitcoin testnet address : mrCDrCybB6J1vRfbwM5hemdJz73FwDBC8r
 uncompressed           : mtoKs9V381UAhUia3d7Vb9GNak8Qvmcsme</pre>
</div>
</div>
<div class="paragraph data-line-2117">
<p>A partir de hash160:</p>
</div>
<div class="listingblock data-line-2120">
<div class="content">
<pre>$ ku 751e76e8199196d454941c45d1b3a323f1433bd6

input           : 751e76e8199196d454941c45d1b3a323f1433bd6
network         : Bitcoin
hash160         : 751e76e8199196d454941c45d1b3a323f1433bd6
Bitcoin address : 1BgGZ9tcN4rm9KBzDn7KprQz87SZ26SAMH</pre>
</div>
</div>
<div class="paragraph data-line-2130">
<p>Como um endere√ßo Dogecoin:</p>
</div>
<div class="listingblock data-line-2133">
<div class="content">
<pre>$ ku -nD 751e76e8199196d454941c45d1b3a323f1433bd6

input            : 751e76e8199196d454941c45d1b3a323f1433bd6
network          : Dogecoin
hash160          : 751e76e8199196d454941c45d1b3a323f1433bd6
Dogecoin address : DFpN6QqFfUm3gKNaxN6tNcab1FArL9cZLE</pre>
</div>
</div>
<div class="paragraph data-line-2142">
<p>==== Utilit√°rio de Transa√ß√£o (Transacion Utility, TX)</p>
</div>
<div class="paragraph data-line-2144">
<p>
O utilit√°rio de linha de comando tx ir√° exibir transa√ß√µes em formato leg√≠vel por humanos, buscar transa√ß√µes b√°sicas do cache de transa√ß√µes da pycoin ou de servi√ßos da web (blockchain.info, blockcypher.com, blockr.io e chain.so s√£o atualmente suportados), mesclar transa√ß√µes , adicionar ou remover entradas ou sa√≠das e assinar transa√ß√µes.</p>
</div>
<div class="paragraph data-line-2147">
<p>A seguir temos alguns exemplos.</p>
</div>
<div class="paragraph data-line-2150">
<p>Veja a famosa transa√ß√£o "pizza":</p>
</div>
<div class="listingblock data-line-2153">
<div class="content">
<pre>$ tx 49d2adb6e476fa46d8357babf78b1b501fd39e177ac7833124b3f67b17c40c2a
aviso: considere definir a vari√°vel de ambiente PYCOIN_CACHE_DIR=~/.pycoin_cache para fazer o cache das transa√ß√µes adquiridas atrav√©s de servi√ßos web
aviso: n√£o foram encontrados provedores de servi√ßo para get_tx; considere definir a vari√°vel de ambiente PYCOIN_BTC_PROVIDERS
uso: tx [-h] [-t TRANSACTION_VERSION] [-l LOCK_TIME] [-n NETWORK] [-a]
          [-i endere√ßo] [-f caminho-para-chaves-privadas] [-g ARGUMENTO_GPG]
          [--remove-tx-in tx_in_index_to_delete]
          [--remove-tx-out tx_out_index_to_delete] [-F transaction-fee] [-u]
          [-b URL_DO_BITCOIND] [-o caminho-para-o-arquivo-output]
          argumento [argumento ...]
tx: erro: n√£o foi poss√≠vel encontrar o Tx com o id 49d2adb6e476fa46d8357babf78b1b501fd39e177ac7833124b3f67b17c40c2a</pre>
</div>
</div>
<div class="paragraph data-line-2167">
<p>Opa! N√£o definimos os servi√ßos web. Vamos fazer isso agora:</p>
</div>
<div class="listingblock data-line-2171">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ PYCOIN_CACHE_DIR=~/.pycoin_cache
$ PYCOIN_BTC_PROVIDERS="block.io blockchain.info blockexplorer.com"
$ export PYCOIN_CACHE_DIR PYCOIN_BTC_PROVIDERS</code></pre>
</div>
</div>
<div class="paragraph data-line-2178">
<p>Isso n√£o √© feito automaticamente, portanto uma ferramenta de linha de comando n√£o vazar√° para um website de terceiros informa√ß√µes potencialmente privadas sobre as transa√ß√µes que voc√™ est√° interessado. Se voc√™ n√£o se importar com isso, voc√™ pode inserir essas linhas em seu <em>.profile</em>.</p>
</div>
<div class="paragraph data-line-2180">
<p>Vamos tentar novamente:</p>
</div>
<div class="listingblock data-line-2182">
<div class="content">
<pre>$ tx 49d2adb6e476fa46d8357babf78b1b501fd39e177ac7833124b3f67b17c40c2a
Version:  1  tx hash 49d2adb6e476fa46d8357babf78b1b501fd39e177ac7833124b3f67b17c40c2a  159 bytes
TxIn count: 1; TxOut count: 1
Lock time: 0 (v√°lido a qualquer momento)
Input:
  0:                          (desconhecido) de 1e133f7de73ac7d074e2746a3d6717dfc99ecaa8e9f9fade2cb8b0b20a5e0441:0
Output:
  0: 1CZDM6oTttND6WPdt3D6bydo7DYKzd9Qik recebe 10000000,00000 mBTC
Total em sa√≠das 10000000,00000 mBTC
incluindo as n√£o gastas no dump hexadecimal, j√° que a transa√ß√£o n√£o est√° completamente assinada
010000000141045e0ab2b0b82cdefaf9e9a8ca9ec9df17673d6a74e274d0c73ae77d3f131e000000004a493046022100a7f26eda874931999c90f87f01ff1ffc76bcd058fe16137e0e63fdb6a35c2d78022100a61e9199238eb73f07c8f209504c84b80f03e30ed8169edd44f80ed17ddf451901ffffffff010010a5d4e80000001976a9147ec1003336542cae8bded8909cdd6b5e48ba0ab688ac00000000

** n√£o foi poss√≠vel validar a transa√ß√£o, pois est√£o faltando as transa√ß√µes-fonte</pre>
</div>
</div>
<div class="paragraph data-line-2198">
<p>A √∫ltima linha aparece porque para validar as assinaturas das transa√ß√µes, voc√™ tecnicamente precisa das transa√ß√µes-fonte. Ent√£o vamos adicionar -a para acrescentar √†s transa√ß√µes uma informa√ß√£o de fonte:</p>
</div>
<div class="listingblock data-line-2200">
<div class="content">
<pre>$ tx -a 49d2adb6e476fa46d8357babf78b1b501fd39e177ac7833124b3f67b17c40c2a
aviso: as recomenda√ß√µes de taxas de transa√ß√£o calculadas casualmente e as estimativas podem estar incorretas
aviso: taxa de transa√ß√£o menor que o valor esperado (calculado casualmente) de 0,1 mBTC, a transa√ß√£o pode n√£o se propagar
Version:  1  tx hash 49d2adb6e476fa46d8357babf78b1b501fd39e177ac7833124b3f67b17c40c2a  159 bytes
TxIn count: 1; TxOut count: 1
Lock time: 0 (v√°lido a qualquer momento)
Input:
  0: 17WFx2GQZUmh6Up2NDNCEDk3deYomdNCfk de 1e133f7de73ac7d074e2746a3d6717dfc99ecaa8e9f9fade2cb8b0b20a5e0441:0 10000000.00000 mBTC  sig ok
Output:
  0: 1CZDM6oTttND6WPdt3D6bydo7DYKzd9Qik recebe 10000000,00000 mBTC
Total em entradas  10000000,00000 mBTC
Total em sa√≠das 10000000,00000 mBTC
Total em taxas        0,00000 mBTC

010000000141045e0ab2b0b82cdefaf9e9a8ca9ec9df17673d6a74e274d0c73ae77d3f131e000000004a493046022100a7f26eda874931999c90f87f01ff1ffc76bcd058fe16137e0e63fdb6a35c2d78022100a61e9199238eb73f07c8f209504c84b80f03e30ed8169edd44f80ed17ddf451901ffffffff010010a5d4e80000001976a9147ec1003336542cae8bded8909cdd6b5e48ba0ab688ac00000000

todos os valores da transa√ß√£o de recebimento foram validados</pre>
</div>
</div>
<div class="paragraph data-line-2220">
<p>Agora, vamos ver as sa√≠das n√£o gastas (UTXOs) para um endere√ßo espec√≠fico. No bloco n¬∫1, vemos uma transa√ß√£o coinbase para 12c6DSiU4Rq3P4ZxziKxzrL5LmMBrzjrJX. Vamos usar fetch_unspent para encontrar todas as moedas nesse endere√ßo:</p>
</div>
<div class="listingblock data-line-2222">
<div class="content">
<pre>$ fetch_unspent 12c6DSiU4Rq3P4ZxziKxzrL5LmMBrzjrJX
a3a6f902a51a2cbebede144e48a88c05e608c2cce28024041a5b9874013a1e2a/0/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/333000
cea36d008badf5c7866894b191d3239de9582d89b6b452b596f1f1b76347f8cb/31/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/10000
065ef6b1463f552f675622a5d1fd2c08d6324b4402049f68e767a719e2049e8d/86/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/10000
a66dddd42f9f2491d3c336ce5527d45cc5c2163aaed3158f81dc054447f447a2/0/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/10000
ffd901679de65d4398de90cefe68d2c3ef073c41f7e8dbec2fb5cd75fe71dfe7/0/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/100
d658ab87cc053b8dbcfd4aa2717fd23cc3edfe90ec75351fadd6a0f7993b461d/5/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/911
36ebe0ca3237002acb12e1474a3859bde0ac84b419ec4ae373e63363ebef731c/1/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/100000
fd87f9adebb17f4ebb1673da76ff48ad29e64b7afa02fda0f2c14e43d220fe24/0/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/1
dfdf0b375a987f17056e5e919ee6eadd87dad36c09c4016d4a03cea15e5c05e3/1/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/1337
cb2679bfd0a557b2dc0d8a6116822f3fcbe281ca3f3e18d3855aa7ea378fa373/0/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/1337
d6be34ccf6edddc3cf69842dce99fe503bf632ba2c2adb0f95c63f6706ae0c52/1/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/2000000
    0e3e2357e806b6cdb1f70b54c3a3a17b6714ee1f0e68bebb44a74b1efd512098/0/410496b538e853519c726a2c91e61ec11600ae1390813a627c66fb8be7947be63c52da7589379515d4e0a604f8141781e62294721166bf621e73a82cbf2342c858eeac/5000000000</pre>
</div>
</div>
<div id="appdx_bx" class="paragraph data-line-2241">
<p>== Comandos do Bitcoin Explorer (bx)</p>
</div>
<div class="paragraph data-line-2243">
<p>O Bitcoin Explorer (bx) √© uma ferramenta de linha de comando que oferece uma variedade de comandos para gerenciamento de chaves e constru√ß√£o de transa√ß√£o. √â parte da biblioteca libbitcoin.</p>
</div>
<div class="listingblock data-line-2245">
<div class="content">
<pre>Uso: bx COMANDO [--help]

Info: Os comandos bx s√£o:

address-decode
address-embed
address-encode
address-validate
base16-decode
base16-encode
base58-decode
base58-encode
base58check-decode
base58check-encode
base64-decode
base64-encode
bitcoin160
bitcoin256
btc-to-satoshi
ec-add
ec-add-secrets
ec-multiply
ec-multiply-secrets
ec-new
ec-to-address
ec-to-public
ec-to-wif
fetch-balance
fetch-header
fetch-height
fetch-history
fetch-stealth
fetch-tx
fetch-tx-index
hd-new
hd-private
hd-public
hd-to-address
hd-to-ec
hd-to-public
hd-to-wif
help
input-set
input-sign
input-validate
message-sign
message-validate
mnemonic-decode
mnemonic-encode
ripemd160
satoshi-to-btc
script-decode
script-encode
script-to-address
seed
send-tx
send-tx-node
send-tx-p2p
settings
sha160
sha256
sha512
stealth-decode
stealth-encode
stealth-public
stealth-secret
stealth-shared
tx-decode
tx-encode
uri-decode
uri-encode
validate-tx
watch-address
wif-to-ec
wif-to-public
wrap-decode
wrap-encode</pre>
</div>
</div>
<div class="paragraph data-line-2325">
<p>Para maiores informa√ß√µes, veja a <a href="https://github.com/libbitcoin/libbitcoin-explorer" data-href="https://github.com/libbitcoin/libbitcoin-explorer">p√°gina do Bitcoin Explorer</a> e a <a href="https://github.com/libbitcoin/libbitcoin-explorer/wiki" data-href="https://github.com/libbitcoin/libbitcoin-explorer/wiki">documenta√ß√£o do usu√°rio do Bitcoin Explorer</a>.</p>
</div>
<div class="paragraph data-line-2327">
<p>=== Exemplos de Uso do Comando bx</p>
</div>
<div class="paragraph data-line-2329">
<p>Vamos dar uma olhada em alguns exemplos usando comandos do Bitcoin Explorer para trabalharmos com chaves e endere√ßos:</p>
</div>
<div class="paragraph data-line-2331">
<p>Gera um valor "semente" aleat√≥rio usando o comando seed, que usa o gerador de n√∫meros aleat√≥rios do sistema operacional. Passe a semente para o comando ec-new para gerar uma nova chave privada. Salvamos o output padr√£o no arquivo <em>private_key</em>:</p>
</div>
<div class="listingblock data-line-2333">
<div class="content">
<pre>$ bx seed | bx ec-new &gt; private_key
$ cat private_key
73096ed11ab9f1db6135857958ece7d73ea7c30862145bcc4bbc7649075de474</pre>
</div>
</div>
<div class="paragraph data-line-2339">
<p>Agora, gere a chave p√∫blica a partir da chave privada usando o comando ec-to-public. Passamos o arquivo <em>private_key</em> no input padr√£o e salvamos o output padr√£o do comando em um novo arquivo <em>public_key</em>:</p>
</div>
<div class="listingblock data-line-2341">
<div class="content">
<pre>$ bx ec-to-public &lt; private_key &gt; public_key
$ cat public_key
02fca46a6006a62dfdd2dbb2149359d0d97a04f430f12a7626dd409256c12be500</pre>
</div>
</div>
<div class="paragraph data-line-2347">
<p>Podemos reformatar a public_key como um endere√ßo usando o comando ec-to-address. Passamos a <em>public_key</em> no input padr√£o:</p>
</div>
<div class="listingblock data-line-2349">
<div class="content">
<pre>$ bx ec-to-address &lt; public_key
17re1S4Q8ZHyCP8Kw7xQad1Lr6XUzWUnkG</pre>
</div>
</div>
<div class="paragraph data-line-2354">
<p>Chaves geradas dessa maneira produzem uma carteira n√£o determin√≠stica tipo-0. Isso significa que cada chave √© gerada a partir de uma semente independente. Os comandos do Bitcoin Explorer tamb√©m podem gerar chaves deterministicamente, de acordo com a BIP-32. Nesse caso, uma chave "mestre" √© criada a partir da semente e ent√£o √© estendida deterministicamente para produzir uma √°rvore de subchaves, resultando em uma carteira determin√≠stica tipo-2.</p>
</div>
<div class="paragraph data-line-2356">
<p>Primeiro, usaremos os comandos seed e hd-new para gerar uma chave mestre que ser√° usada como a base para derivar uma hierarquia de chaves.</p>
</div>
<div class="listingblock data-line-2358">
<div class="content">
<pre>$ bx seed &gt; seed
$ cat seed
eb68ee9f3df6bd4441a9feadec179ff1

$ bx hd-new &lt; seed &gt; master
$ cat master
xprv9s21ZrQH143K2BEhMYpNQoUvAgiEjArAVaZaCTgsaGe6LsAnwubeiTcDzd23mAoyizm9cApe51gNfLMkBqkYoWWMCRwzfuJk8RwF1SVEpAQ</pre>
</div>
</div>
<div class="paragraph data-line-2368">
<p>Agora usaremos o comando hd-private para gerar uma chave de "conta" dificultada e uma sequ√™ncia de duas chaves privadas no interior da conta:</p>
</div>
<div class="listingblock data-line-2370">
<div class="content">
<pre>$ bx hd-private --hard &lt; master &gt; account
$ cat account
xprv9vkDLt81dTKjwHB8fsVB5QK8cGnzveChzSrtCfvu3aMWvQaThp59ueufuyQ8Qi3qpjk4aKsbmbfxwcgS8PYbgoR2NWHeLyvg4DhoEE68A1n

$ bx hd-private --index 0 &lt; account
xprv9xHfb6w1vX9xgZyPNXVgAhPxSsEkeRcPHEUV5iJcVEsuUEACvR3NRY3fpGhcnBiDbvG4LgndirDsia1e9F3DWPkX7Tp1V1u97HKG1FJwUpU

$ bx hd-private --index 1 &lt; account
xprv9xHfb6w1vX9xjc8XbN4GN86jzNAZ6xHEqYxzbLB4fzHFd6VqCLPGRZFsdjsuMVERadbgDbziCRJru9n6tzEWrASVpEdrZrFidt1RDfn4yA3</pre>
</div>
</div>
<div class="paragraph data-line-2382">
<p>A seguir usaremos o comando hd-public para gerar a sequ√™ncia correspondente de duas chaves p√∫blicas.</p>
</div>
<div class="listingblock data-line-2384">
<div class="content">
<pre>$ bx hd-public --index 0 &lt; account
xpub6BH1zcTuktiFu43rUZ2gXqLgzu5F3tLEeTQ5t6iE3aQtM2VMTxMcyLN9fYHiGhGpQe9QQYmqL2eYPFJ3vezHz5wzaSW4FiGrseNDR4LKqTy

$ bx hd-public --index 1 &lt; account
xpub6BH1zcTuktiFx6CzhPbGjG3UYQ13WR16CmtbPiagEKpEVtpyjshWyMaMV1cn7nUPUkgQHPVXJVqsrA8xWbGQDhohEcDFTEYMvYzwRD7Juf8</pre>
</div>
</div>
<div class="paragraph data-line-2392">
<p>As chaves p√∫blicas tamb√©m podem ser derivadas a partir de suas chaves privadas correspondentes ao utilizar-se ocomando hd-to-public:</p>
</div>
<div class="listingblock data-line-2394">
<div class="content">
<pre>$ bx hd-private --index 0 &lt; account | bx hd-to-public
xpub6BH1zcTuktiFu43rUZ2gXqLgzu5F3tLEeTQ5t6iE3aQtM2VMTxMcyLN9fYHiGhGpQe9QQYmqL2eYPFJ3vezHz5wzaSW4FiGrseNDR4LKqTy

$ bx hd-private --index 1 &lt; account | bx hd-to-public
xpub6BH1zcTuktiFx6CzhPbGjG3UYQ13WR16CmtbPiagEKpEVtpyjshWyMaMV1cn7nUPUkgQHPVXJVqsrA8xWbGQDhohEcDFTEYMvYzwRD7Juf8</pre>
</div>
</div>
<div class="paragraph data-line-2402">
<p>Podemos gerar um n√∫mero praticamente ilimitado de chaves em uma cadeia determin√≠stica, todas derivadas de uma √∫nica semente. Essa t√©cnica √© usada em muitas aplica√ß√µes de carteira para gerar chaves que podem ser usadas em back ups e restauradas com um valor √∫nico de semente. Isso √© mais f√°cil do que ter que fazer back up de toda a carteira com todas suas chaves geradas aleatoriamente cada vez que uma nova chave for criada.</p>
</div>
<div class="paragraph data-line-2404">
<p>A semente pode ser codificada usando o comando mnemonic-encode:</p>
</div>
<div class="listingblock data-line-2406">
<div class="content">
<pre>$ bx hd-mnemonic &lt; seed &gt; words
adore repeat vision worst especially veil inch woman cast recall dwell appreciate</pre>
</div>
</div>
<div class="paragraph data-line-2411">
<p>A semente pode ser decodificada usando o comando mnemonic-decode:</p>
</div>
<div class="listingblock data-line-2413">
<div class="content">
<pre>$ bx mnemonic-decode &lt; words
eb68ee9f3df6bd4441a9feadec179ff1</pre>
</div>
</div>
<div class="paragraph data-line-2418">
<p>A codifica√ß√£o do mnem√¥nico pode facilitar a grava√ß√£o da semente e at√© mesmo lembrar dela.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. "Bitcoin: A Peer-to-Peer Electronic Cash System," Satoshi Nakamoto (<a href="https://bitcoin.org/bitcoin.pdf" class="undefined" data-href="https://bitcoin.org/bitcoin.pdf">https://bitcoin.org/bitcoin.pdf</a>).
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-07-10 05:56:35 -0400
</div>
</div>
</body>
</html>