<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>Maîtriser Bitcoin</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article data-line-1">
<div id="header">
<h1>Maîtriser Bitcoin</h1>
</div>
<div id="content">
<div class="sect1 data-line-2">
<h2 id="_prefácio">Prefácio</h2>
<div class="sectionbody">
<div class="sect2 data-line-4">
<h3 id="_escrevendo_o_livro_do_bitcoin">Escrevendo o Livro do Bitcoin</h3>
<div class="paragraph data-line-6">
<p>A primeira vez que ouvi falar em bitcoin foi em meados de 2011. Minha reação imediata foi mais ou menos essa "Pfft! Dinheiro de nerd!" e eu ignorei-o por mais seis meses, sem compreender a sua importância. Esta é uma reação que eu tenho observado com frequência entre muitas das pessoas mais inteligentes que conheço, o que me dá algum consolo. Na segunda vez que me deparei com o bitcoin, em uma lista de discussão, eu decidi ler o seu "manual de instruções" oficial, o white paper escrito por Satoshi Nakamoto, para ver do que se tratava. Ainda me lembro do momento em que eu terminei de ler aquelas nove páginas, quando eu percebi que o bitcoin não era simplesmente uma moeda digital, mas uma rede de confiança que também poderia servir de base para aplicações muito mais avançadas do que apenas moedas. Após chegar à conclusão de que "isso não é dinheiro, mas sim uma rede de confiança descentralizada", comecei uma jornada de quatro meses em que passei devorando cada pedaço de informação que eu conseguia encontrar sobre o assunto. Eu me tornei obcecado e encantado, passando 12 ou mais horas por dia colado ao monitor, lendo, escrevendo, programando e aprendendo o máximo que eu podia. Após pular muitas refeições, saí desse período de obsessão nove quilos mais magro e determinado a dedicar-me a trabalhar com bitcoin.</p>
</div>
<div class="paragraph data-line-8">
<p>Dois anos depois, após criar várias pequenas startups para explorar serviços e produtos relacionados ao bitcoin, eu decidi que estava na hora de escrever o meu primeiro livro. O bitcoin foi um tópico que me levou a um frenesi de criatividade e que consumiu meus pensamentos; foi a tecnologia mais empolgante que eu encontrei desde que conheci a Internet. Estava na hora de compartilhar minha paixão sobre essa incrível tecnologia com uma audiência mais ampla.</p>
</div>
</div>
<div class="sect2 data-line-10">
<h3 id="_público_alvo">Público Alvo</h3>
<div class="paragraph data-line-12">
<p>Esse livro foi escrito principalmente para programadores. Se você sabe alguma linguagem de programação, esse livro irá ensiná-lo como as moedas criptográficas funcionam, como utilizá-las e como desenvolver softwares que trabalhem com elas. Os primeiros capítulos também são adequados como uma introdução aprofundada ao bitcoin para não-programadores—pessoas que queiram entender o funcionamento interno do bitcoin e das criptomoedas.</p>
</div>
</div>
<div class="sect2 data-line-14">
<h3 id="_convenções_usadas_neste_livro">Convenções Usadas neste Livro</h3>
<div class="paragraph data-line-16">
<p>As seguintes convenções tipográficas são usadas neste livro:</p>
</div>
<div class="dlist data-line-18">
<dl>
<dt class="hdlist1"><em>Itálico</em></dt>
<dd>
<p>Indica novos termos, URLs, endereços de e-mail, nomes e extensões de arquivos.</p>
</dd>
<dt class="hdlist1">Largura constante</dt>
<dd>
<p>Usada para listagem de programas, assim como dentro de parágrafos para se referir a elementos de programas como variáveis e nomes de funções, banco de dados, tipos de dados, variáveis de ambiente, declarações e palavras-chave.</p>
</dd>
<dt class="hdlist1"><strong><code>Largura constante em negrito</code></strong></dt>
<dd>
<p>Mostra comandos ou outro texto que deveria ser digitado literalmente pelo usuário.</p>
</dd>
<dt class="hdlist1"><em>Largura constante em itálico</em></dt>
<dd>
<p>Mostra um texto que deveria ser substituído por valores fornecidos pelo usuário, ou valores determinados pelo contexto.</p>
</dd>
</dl>
</div>
<div class="admonitionblock tip data-line-28">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-29">
<p>Este ícone significa uma dica ou sugestão.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note data-line-33">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-34">
<p>Este ícone significa uma nota geral.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning data-line-38">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-39">
<p>Esse ícone indica uma mensagem de aviso ou cuidado.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2 data-line-42">
<h3 id="_exemplos_de_códigos">Exemplos de Códigos</h3>
<div class="paragraph data-line-44">
<p>Os exemplos são ilustrados em Python, C++ e usando uma linha de comando de um sistema operacional do tipo Unix, como o Linux ou o macOS. Todos os <em>snippets</em> de códigos estão disponíveis no subdiretório <em>code</em> do repositório principal no GitHub (<a href="https://github.com/bitcoinbook/bitcoinbook" data-href="https://github.com/bitcoinbook/bitcoinbook">https://github.com/bitcoinbook/bitcoinbook</a>). Você pode fazer um fork do código do livro, testar exemplos de códigos ou enviar correções via GitHub.</p>
</div>
<div class="paragraph data-line-46">
<p>Todos os <em>snippets</em> de códigos podem ser replicados na maioria dos sistemas operacionais com uma instalação mínima dos compiladores e interpretadores das linguagens correspondentes. Quando necessário, nós providenciaremos as instruções básicas de instalação e exemplos passo-a-passo dos resultados dessas instruções.</p>
</div>
<div class="paragraph data-line-48">
<p>Alguns dos <em>snippets</em> e <em>outputs</em> de códigos foram reformatados para a impressão. Em todos esses casos, as linhas foram divididas por uma barra invertida (\), seguida por um caractere de nova linha. Ao transcrever os exemplos, remova estes dois caracteres e una as linhas novamente, assim você obterá resultados idênticos aos mostrados no exemplo.</p>
</div>
<div class="paragraph data-line-50">
<p>Todos os <em>snippets</em> de códigos, sempre que possível, usam valores e cálculos reais, de maneira que você possa construir de exemplo a exemplo e observar os mesmo resultados em qualquer código que você escrever para calcular os mesmos valores. Por exemplo, as chaves privadas e seus endereços e chaves públicas correspondentes são reais. As amostras de transação, blocos e referências à blockchain foram realmente introduzidas na blockchain do bitcoin e fazem parte do livro-razão público, para que você possa revisá-las em qualquer sistema bitcoin.</p>
</div>
</div>
<div class="sect2 data-line-52">
<h3 id="_endereços_e_transações_de_bitcoin_neste_livro">Endereços e Transações de Bitcoin neste Livro</h3>
<div class="paragraph data-line-54">
<p>Os endereços, transações, chaves, códigos QR e dados da blockchain do bitcoin usados neste livro são, em sua maior parte, verdadeiros. Isso significa que você pode navegar pela blockchain, examinar as transações usadas como exemplos, recuperá-las com seus próprios scripts ou programas, etc.</p>
</div>
<div class="paragraph data-line-56">
<p>É importante frisar que as chaves privadas usadas para construir os endereços ou estão impressas neste livro ou foram "queimadas". Isso significa que, se você enviar dinheiro para qualquer um desses endereços, o dinheiro será perdido para sempre ou, em alguns casos, qualquer pessoa que puder ler o livro poderá pegar esse dinheiro usando as chaves privadas impressas nele.</p>
</div>
<div class="admonitionblock warning data-line-59">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-60">
<p>NÃO ENVIE DINHEIRO A QUALQUER ENDEREÇO CONTIDO NESTE LIVRO. Seu dinheiro será tomado por outro leitor ou será perdido para sempre.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2 data-line-63">
<h3 id="_publicação_pela_oreilly_media">Publicação pela O&#8217;Reilly Media</h3>
<div class="paragraph data-line-65">
<p>Este livro é derivado sob a licença do livro "Mastering Bitcoin 2nd Edition", publicado pela O&#8217;Reilly Media.</p>
</div>
</div>
<div class="sect2 data-line-67">
<h3 id="_copyright_e_licença_do_livro">Copyright e Licença do Livro</h3>
<div class="paragraph data-line-69">
<p>Copyright (c) 2014 Andreas M. Antonopoulos LLC</p>
</div>
<div class="paragraph data-line-71">
<p>Este trabalho está licenciado sob a Licença Internacional Creative Commons Atribuição-CompartilhaIgual 4.0. Para ver uma cópia desta licença, visite</p>
</div>
<div class="paragraph data-line-73">
<p><a href="http://creativecommons.org/licenses/by-sa/4.0/" class="undefined" data-href="http://creativecommons.org/licenses/by-sa/4.0/">http://creativecommons.org/licenses/by-sa/4.0/</a>.</p>
</div>
<div class="paragraph data-line-75">
<p>Para atribuição de créditos, visite o link do repositório do livro:</p>
</div>
<div class="paragraph data-line-77">
<p><a href="https://github.com/bitcoinbook/bitcoinbook" class="undefined" data-href="https://github.com/bitcoinbook/bitcoinbook">https://github.com/bitcoinbook/bitcoinbook</a></p>
</div>
<div class="paragraph data-line-79">
<p>e inclua esta licença ou uma licença aberta equivalente, para satisfazer os requisitos CompartilhaIgual.</p>
</div>
<div class="paragraph data-line-81">
<p>Esta licença compatível com a "Free Culture" foi aprovada pela minha editora O&#8217;Reilly Media (<a href="http://oreilly.com" class="undefined" data-href="http://oreilly.com">http://oreilly.com</a>), que entende o valor do código aberto. A O&#8217;Reilly Media não apenas é a melhor editora de livros técnicos do mundo, como também é uma forte defensora de uma cultura aberta e do compartilhamento de conhecimento.</p>
</div>
<div class="paragraph data-line-83">
<p>Obrigado, O&#8217;Reilly!</p>
</div>
</div>
<div class="sect2 pagebreak-before data-line-86">
<h3 id="_como_entrar_em_contato_com_o_autor">Como Entrar em Contato com o Autor</h3>
<div class="paragraph data-line-88">
<p>Entre em contato comigo, Andreas M. Antonopoulos, no meu site:
<a href="https://aantonop.com/" class="undefined" data-href="https://aantonop.com/">https://aantonop.com/</a></p>
</div>
<div class="paragraph data-line-91">
<p>Informações sobre o <em>Dominando o Bitcoin (Mastering Bitcoin)</em>, a Edição Aberta e as traduções estão disponíveis em:
<a href="https://bitcoinbook.info/" class="undefined" data-href="https://bitcoinbook.info/">https://bitcoinbook.info/</a></p>
</div>
<div class="paragraph data-line-94">
<p>Siga-me no Twitter:
<a href="https://twitter.com/aantonop" class="undefined" data-href="https://twitter.com/aantonop">https://twitter.com/aantonop</a></p>
</div>
<div class="paragraph data-line-97">
<p>Veja mais de 500 vídeos educacionais em meu canal do YouTube:
<a href="https://youtube.com/aantonop" class="undefined" data-href="https://youtube.com/aantonop">https://youtube.com/aantonop</a></p>
</div>
<div class="paragraph data-line-100">
<p>Muito obrigado a todos os meus colaboradores que apoiam o meu trabalho através de doações mensais. Siga-me no Patreon:
<a href="https://patreon.com/aantonop" class="undefined" data-href="https://patreon.com/aantonop">https://patreon.com/aantonop</a></p>
</div>
</div>
<div class="sect2 data-line-103">
<h3 id="_agradecimentos">Agradecimentos</h3>
<div class="paragraph data-line-105">
<p>Este livro representa os esforços e as contribuições de muitas pessoas. Agradeço por toda a ajuda que recebi de amigos, colegas e até desconhecidos, que se juntaram a mim nessa tarefa de escrever o livro técnico definitivo sobre criptomoedas e bitcoin.</p>
</div>
<div class="paragraph data-line-107">
<p>É impossível fazer uma distinção entre a tecnologia do bitcoin e a comunidade bitcoin—e este livro é um produto tanto dessa comunidade quanto é sobre a tecnologia. Meu trabalho nesse livro foi encorajado, comemorado. apoiado e recompensado por toda a comunidade bitcoin desde o seu início até o fim. Mais do que tudo, esse livro me permitiu fazer parte de uma comunidade maravilhosa por dois anos e não posso agradecer suficientemente por eu ter sido aceito por essa comunidade. Há um número imenso de pessoas para ser mencionadas pelo nome—pessoas que encontrei em conferências, eventos, seminários, meetups, encontros de pizza e pequenas reuniões, assim como tantos que se comunicam comigo via Twitter, reddit, bitcointalk.org e pelo GitHub e que impactaram esse livro de alguma forma. Cada ideia, analogia, pergunta, resposta e explicação que você encontrar nesse livro foi de algum modo inspirada, testada ou melhorada através da interação com a comunidade. Muito obrigado a todos pelo apoio; esse livro não teria acontecido sem vocês. Serei eternamente grato.</p>
</div>
<div class="paragraph data-line-109">
<p>A jornada para se tornar um autor começa, é claro, muito antes do primeiro livro. Minha língua nativa (e também na escola) era o grego, e por isso tive que fazer um curso reparador de redação em inglês ainda no meu primeiro ano da universidade. Sou muito grato a Diana Kordas, minha professora de redação em inglês, que muito me ajudou a construir a confiança e as habilidades que precisei naquele ano. Mais para frente, já como profissional, desenvolvi minhas habilidades em redação técnica sobre <em>data centers</em>, escrevendo para a revista <em>Network World</em>. Meus agradecimentos a John Dix e John Gallant, que me deram meu primeiro trabalho em redação como colunista na <em>Network World</em>, ao meu editor Michael Cooney e à minha colega Johna Till Johnson, que editaram minhas colunas e as tornaram publicáveis. Escrever 500 palavras por semana durante quatro anos me deu experiência suficiente para eventualmente considerar a me tornar um autor.</p>
</div>
<div class="paragraph data-line-111">
<p>Obrigado também àqueles que me apoiaram quando enviei à O&#8217;Reilly minha proposta de livro, ao enviarem referências e revisarem o esboço. Especificamente, obrigado a John Gallant, Gregory Ness, Richard Stiennon, Joel Snyder, Adam B. Levine, Sandra Gittlen, John Dix, Johna Till Johnson, Roger Ver e Jon Matonis. Um obrigado especial a Richard Kagan e Tymon Mattozko, que revisaram as primeiras versões da proposta e a Matthew Owain Taylor, que fez a editoração da proposta.</p>
</div>
<div class="paragraph data-line-113">
<p>Agradeço a Cricket Liu, autor da obra da O&#8217;Reilly <em>DNS e BIND</em>, que me apresentou à O&#8217;Reilly. Agradeço também a Michael Loukides e Allyson MacDonald da O&#8217;Reilly, que trabalharam por meses para ajudar a tornar este livro realidade. Allyson foi especialmente paciente quando os prazos foram perdidos e as entregas atrasadas, conforme a vida interferia em nosso cronograma planejado. Na segunda edição, agradeço a Timothy McGovern por orientar o processo, Kim Cofer por editar com paciência e Rebecca Panzer por ilustrar muitos novos diagramas.</p>
</div>
<div class="paragraph data-line-115">
<p>Os primeiros rascunhos dos primeiros capítulos foram os mais difíceis, porque o bitcoin é um assunto difícil de desvendar. Toda vez que puxei uma linha da tecnologia bitcoin, tive que puxar a coisa toda. Repetidamente, fiquei paralisado e um pouco desanimado enquanto lutava para facilitar a compreensão do tópico e criar uma narrativa em torno de um assunto técnico tão denso. Por fim, eu decidi contar a história do bitcoin através das histórias das pessoas que usam o bitcoin e o livro inteiro ficou muito mais fácil de escrever. Devo agradecer ao meu amigo e mentor, Richard Kagan, que me ajudou a desenvolver as histórias e a superar os momentos de bloqueio de escritor. Agradeço a Pamela Morgan, que revisou os primeiros rascunhos de cada capítulo na primeira e na segunda edições do livro e fez as perguntas difíceis para torná-los melhores. Além disso, obrigado aos desenvolvedores do grupo Meetup de San Francisco Bitcoin Developers, bem como Taariq Lewis e Denise Terry por ajudarem a testar o material inicial. Agradeço também a Andrew Naugler pelo design do infográfico.</p>
</div>
<div class="paragraph data-line-117">
<p>Durante o desenvolvimento do livro, eu disponibilizei os primeiros rascunhos via GitHub e convidei o público para comentar. Mais de uma centena de comentários, sugestões, correções e contribuições me foram enviadas em resposta. Tais contribuições foram reconhecidas e agradecidas publicamente em <a href="#github_contrib">[github_contrib]</a>. Acima de tudo, um agradecimento especial para os editores voluntários do GitHub Ming T. Ngyuen (1ª edição) e Will Binns (2ª edição), que trabalharam incansavelmente para organizar, gerenciar e resolver solicitações de pull e relatos de problemas, assim como realizar correções de bugs no GitHub.</p>
</div>
<div class="paragraph data-line-119">
<p>Após finalizado o rascunho do livro, ele passou por diversas rodadas de revisão técnica. Obrigado a Cricket Liu e Lorne Lantz pelas extensas revisões, comentários e apoio.</p>
</div>
<div class="paragraph data-line-121">
<p>Vários desenvolvedores de bitcoin contribuíram com amostras de código, análises, comentários e incentivo. Obrigado a Amir Taaki e Eric Voskuil, por exemplo de trechos de código e muitos ótimos comentários; a Chris Kleeschulte, por contribuir com o apêndice sobre o Bitcore; a Vitalik Buterin e Richard Kiss, pela ajuda na matemática da curva elíptica e nas contribuições de código; a Gavin Andresen, pelas correções, comentários e incentivo; a Michalis Kargakis, por comentários, contribuições e redação do btcd; e a Robin Inge, por enviar erratas melhorando a segunda impressão. Na segunda edição, recebi novamente muita ajuda de muitos desenvolvedores do Bitcoin Core, incluindo Eric Lombrozo, que desmistificou a Segregated Witness, Luke Dashjr, que ajudou a melhorar o capítulo sobre transações, Johnson Lau, que revisou a Segregated Witness e outros capítulos, e muitos outros. Devo agradecimentos a Joseph Poon, Tadge Dryja e Olaoluwa Osuntokun, que explicaram a Lightning Network, revisaram meu texto e responderam minhas dúvidas quando tive dificuldades.</p>
</div>
<div class="paragraph data-line-123">
<p>Eu devo o meu amor pelas palavras e livros à minha mãe, Theresa, que me criou em uma casa repleta de livros em cada parede. Minha mãe também me deu meu primeiro computador em 1982, mesmo ela sendo uma tecnófoba assumida. Meu pai, Menelaos, um engenheiro civil que recém publicou seu primeiro livro aos 80 anos de idade, foi quem me ensinou o pensamento lógico e analítico, bem como o amor pela ciência e pela engenharia.</p>
</div>
<div class="paragraph data-line-125">
<p>Obrigado a todos vocês por me apoiarem durante esta jornada.</p>
</div>
<div class="paragraph data-line-3">
<p>Unresolved directive in for_use_mastering-bitcoin_preface-open_pt_BR.adoc - include::github_contrib.adoc[]</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2">
<h2 id="_glossário_rápido">Glossário Rápido</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>Este glossário rápido contém muitos dos termos relacionados ao bitcoin que são usados nesse livro. Recomendamos que marque essa página para usá-la como uma referência rápida.</p>
</div>
<div class="dlist data-line-6">
<dl>
<dt class="hdlist1">endereço (address)</dt>
<dd>
<p>A Bitcoin address looks like 1DSrfJdB2AnWaFNgSbv3MZC2m74996JafV. It consists of a string of letters and numbers. It&#8217;s really an encoded base58check version of a public key 160-bit hash. Just as you ask others to send an email to your email address, you would ask others to send you bitcoin to one of your Bitcoin addresses.</p>
</dd>
<dt class="hdlist1">bip</dt>
<dd>
<p><em>Bitcoin Improvement Proposals</em> (em português, Propostas de Melhoria ao Bitcoin). Um conjunto de propostas que membros da comunidade bitcoin enviaram para melhorar o bitcoin. Por exemplo, a BIP-21 é uma proposta para melhorar a estrutura do Identificador Uniforme de Recursos (URI) do bitcoin.</p>
</dd>
<dt class="hdlist1">bitcoin</dt>
<dd>
<p>O nome da unidade monetária (da moeda), da rede e do software.</p>
</dd>
<dt class="hdlist1">bloco (block)</dt>
<dd>
<p>Um agrupamento de transações, marcado com um carimbo de data e hora (um <em>timestamp</em>) e uma impressão digital do bloco anterior. O cabeçalho do bloco é submetido a <em>hashing</em> para produzir uma prova de trabalho, assim validando as transações. Os blocos válidos são adicionados à blockchain principal através do consenso da rede.</p>
</dd>
<dt class="hdlist1">blockchain (cadeia de blocos)</dt>
<dd>
<p>Uma lista de blocos validados, cada um ligado ao seu antecessor até chegar ao bloco gênese.</p>
</dd>
<dt class="hdlist1">recompensa do bloco/coinbase (block reward ou coinbase reward)</dt>
<dd>
<p>Uma quantidade de moedas incluída em cada novo bloco, que serve como uma recompensa da rede ao minerador que encontrou a solução da Prova-de-Trabalho. Aproximadamente a cada quatro anos, ou exatamente a cada 210.000 blocos, a recompensa do bloco é reduzida pela metade (halving). Atualmente a recompensa é de 6,25 BTC por bloco.</p>
</dd>
<dt class="hdlist1">Problema dos Generais Bizantinos</dt>
<dd>
<p>Um sistema de computador confiável deve ser capaz de lidar com a falha de um ou mais de seus componentes. Um componente com falha pode exibir um tipo de comportamento que frequentemente pode passar despercebido—como enviar informações conflitantes para diferentes partes do sistema. O problema de lidar com esse tipo de falha é expresso de maneira abstrata como o Problema dos Generais Bizantinos.</p>
</dd>
<dt class="hdlist1">bloco candidato (candidate block)</dt>
<dd>
<p>Um bloco que um minerador ainda está tentando minerar. Ainda não é considerado um bloco válido, pois não contém uma Prova-de-Trabalho válida.</p>
</dd>
<dt class="hdlist1">coinbase/dados coinbase (coinbase/coinbase data)</dt>
<dd>
<p>Um campo especial usado como entrada única para as transações coinbase. O campo de dados coinbase permite reivindicar a recompensa do bloco e fornece até 100 bytes para dados arbitrários.
Não deve ser confundido com transação coinbase ou recompensa coinbase.</p>
</dd>
<dt class="hdlist1">transação coinbase</dt>
<dd>
<p>A primeira transação em um bloco. Sempre criada por um minerador, ela inclui uma única coinbase.
Não deve ser confundida com coinbase (dados coinbase) ou recompensa coinbase.</p>
</dd>
<dt class="hdlist1">armazenamento frio (<em>cold storage</em>)</dt>
<dd>
<p>Refere-se a manter uma reserva de bitcoin offline. O armazenamento frio é obtido quando as chaves privadas são criadas e armazenadas em um ambiente offline seguro. O armazenamento frio é importante para qualquer pessoa que tenha economias em bitcoin. Os computadores online são vulneráveis a hackers e não devem ser usados para armazenar uma quantidade significativa de bitcoin.</p>
</dd>
<dt class="hdlist1">confirmações (confirmations)</dt>
<dd>
<p>Assim que uma transação é incluída em um bloco, dizemos que ela tem uma confirmação. Assim que <em>outro</em> bloco é minerado na mesma blockchain, a transação passa a ter duas confirmações, e assim por diante. Seis ou mais confirmações são consideradas como prova suficiente de que uma transação não pode mais ser revertida.</p>
</dd>
<dt class="hdlist1">consenso (consensus)</dt>
<dd>
<p>Quando vários nós, geralmente a maioria dos nós na rede, têm todos os mesmos blocos em sua melhor cadeia de blocos validada localmente.
Não deve ser confundido com regras de consenso.</p>
</dd>
<dt class="hdlist1">regras de consenso (consensus rules)</dt>
<dd>
<p>As regras de validação de bloco que os nós completos seguem para permanecer em consenso com outros nós.
Não deve ser confundido com consenso.</p>
</dd>
<dt class="hdlist1">dificuldade (difficulty)</dt>
<dd>
<p>Uma configuração que é definida em toda a rede e controla quanto esforço computacional é necessário para produzir uma prova de trabalho.</p>
</dd>
<dt class="hdlist1">reajuste do alvo de dificuldade (difficulty retargeting)</dt>
<dd>
<p>Um recálculo da dificuldade que ocorre em toda a rede a cada 2.016 blocos, levando em consideração o poder de <em>hashing</em> dos 2.016 blocos anteriores.</p>
</dd>
<dt class="hdlist1">alvo da dificuldade (difficulty target)</dt>
<dd>
<p>Uma dificuldade na qual todo o poder computacional da rede encontrará blocos aproximadamente a cada 10 minutos.</p>
</dd>
<dt class="hdlist1">gasto duplo (double-spend)</dt>
<dd>
<p>O gasto duplo ocorre quando alguém gasta com sucesso uma quantia de dinheiro mais de uma vez. O bitcoin protege contra gastos duplos ao verificar cada transação que é adicionada à cadeia de blocos, certificando-se de que as entradas da transação ainda não tenham sido gastas.</p>
</dd>
<dt class="hdlist1">ECDSA</dt>
<dd>
<p>O Algoritmo de Assinatura Digital de Curva Elíptica (em inglês <em>Elliptic Curve Digital Signature Algorithm</em> ou ECDSA) é um algoritmo criptográfico usado pelo bitcoin para garantir que os fundos só possam ser gastos pelos seus legítimos proprietários.</p>
</dd>
<dt class="hdlist1">nonce extra</dt>
<dd>
<p>À medida que a dificuldade de mineração aumentou, os mineradores frequentemente percorriam todos os 4 bilhões de valores do nonce sem encontrar um bloco. Como o script coinbase pode armazenar entre 2 e 100 bytes de dados, os mineradores começaram a usar esse espaço como espaço de nonce extra, permitindo-lhes explorar um intervalo muito maior de valores de cabeçalho de bloco para encontrar blocos válidos.</p>
</dd>
<dt class="hdlist1">taxas (fees)</dt>
<dd>
<p>O remetente de uma transação geralmente inclui uma taxa para a rede pelo processamento da transação solicitada. A maioria das transações exige uma taxa mínima de 0,5 mBTC.</p>
</dd>
<dt class="hdlist1">fork (bifurcação)</dt>
<dd>
<p>O fork, também conhecido como fork acidental, ocorre quando dois ou mais blocos têm a mesma altura de bloco, bifurcando a cadeia de blocos (blockchain). Normalmente ocorre quando dois ou mais mineradores encontram blocos quase ao mesmo tempo. Também pode acontecer como parte de um ataque.</p>
</dd>
<dt class="hdlist1">bloco gênese (genesis block)</dt>
<dd>
<p>O primeiro bloco na blockchain, usado para inicializar a criptomoeda.</p>
</dd>
<dt class="hdlist1">halving</dt>
<dd>
<p>Um evento de <em>halving</em> (redução pela metade) ocorre quando a recompensa do bloco é cortada pela metade, o que acontece aproximadamente a cada quatro anos (ou precisamente a cada 210.000 blocos). O bitcoin já teve três eventos de <em>halving</em>: em 2012 (de 50 para 25 BTC), em 2016 (de 25 para 12,5 BTC) e em 2020 (de 12,5 para 6,25 BTC).</p>
</dd>
<dt class="hdlist1">hard fork</dt>
<dd>
<p>O hard fork, também conhecido como "mudança causadora de hard fork", é uma divergência permanente na blockchain, que geralmente ocorre quando nós não atualizados não conseguem validar os blocos criados pelo nós atualizados que seguem novas regras de consenso.
Não deve ser confundido com fork, soft fork, fork do software ou fork do Git.</p>
</dd>
<dt class="hdlist1">carteira de hardware</dt>
<dd>
<p>Uma carteira de hardware é um tipo especial de carteira de bitcoin que armazena as chaves privadas do usuário em um dispositivo de hardware seguro.</p>
</dd>
<dt class="hdlist1">hash</dt>
<dd>
<p>Uma impressão digital de alguma entrada binária.</p>
</dd>
<dt class="hdlist1">hashlocks</dt>
<dd>
<p>Um hashlock é um tipo de trava que restringe o gasto de uma saída até que um dado específico seja revelado publicamente. Os hashlocks têm a propriedade útil de que, uma vez que qualquer hashlock seja aberto publicamente, qualquer outro hashlock protegido usando a mesma chave também pode ser aberto. Isso torna possível criar várias saídas que são todas travadas pelo mesmo hashlock e que se tornam todas gastáveis ao mesmo tempo.</p>
</dd>
<dt class="hdlist1">protocolo HD (HD protocol)</dt>
<dd>
<p>O protocolo de transferência e criação de chave Determinística Hierárquica (HD) (BIP-32), que permite criar chaves filhas a partir de chaves pais em uma hierarquia.</p>
</dd>
<dt class="hdlist1">carteira HD (HD wallet)</dt>
<dd>
<p>Carteiras usando o protocolo de criação de chave e de transferência Determinística Hierárquica (Protocolo HD) (BIP-32).</p>
</dd>
<dt class="hdlist1">semente (seed) da carteira HD</dt>
<dd>
<p>A semente da carteira HD ou semente raiz é um valor potencialmente curto usado como uma semente para gerar a chave privada mestra e o código de cadeia mestre para uma carteira HD.</p>
</dd>
<dt class="hdlist1">HTLC</dt>
<dd>
<p>Um Contrato de Hash TimeLock ou HTLC é uma classe de pagamentos que usa travas de hash e de tempo (hashlocks e timelocks) para exigir que o receptor de um pagamento ou reconheça o recebimento do pagamento antes de um prazo ao gerar prova criptográfica de pagamento, ou perca a capacidade de reivindicar o pagamento, devolvendo-o para o pagador.</p>
</dd>
<dt class="hdlist1">KYC</dt>
<dd>
<p><em>Conheça seu cliente</em> (em inglês, <em>Know your customer</em> ou KYC) é o processo no qual uma empresa identifica e verifica a identidade de seus clientes. O termo também é usado para se referir ao regulamento bancário que rege essas atividades.</p>
</dd>
<dt class="hdlist1">LevelDB</dt>
<dd>
<p>A LevelDB é uma biblioteca de armazenamento de código aberto baseada em pares de chave-valor com armazento em disco. A LevelDB é uma biblioteca para persistência, leve e de propósito único, com ligações para muitas plataformas.</p>
</dd>
<dt class="hdlist1">Lightning Networks (Redes Lightning)</dt>
<dd>
<p>A Lightning Network é uma implementação de Contratos Hash Timelock (HTLCs) com canais de pagamento bidirecionais que permitem que os pagamentos sejam roteados com segurança em vários canais de pagamento par-a-par. Isso permite a formação de uma rede onde qualquer par da rede possa pagar a qualquer outro par, mesmo que eles não tenham um canal aberto diretamente entre si.</p>
</dd>
<dt class="hdlist1">Locktime</dt>
<dd>
<p>O Locktime, ou mais tecnicamente o nLockTime, é a parte de uma transação que indica o primeiro momento no tempo ou o primeiro bloco em que essa transação pode ser adicionada à cadeia de blocos.</p>
</dd>
<dt class="hdlist1">mempool</dt>
<dd>
<p>The bitcoin Mempool (memory pool) is a collection of all transaction data in a block that have been verified by Bitcoin nodes, but are not yet confirmed.</p>
</dd>
<dt class="hdlist1">raiz de merkle (merkle root)</dt>
<dd>
<p>O nó raiz de uma árvore de merkle, um descendente de todos os pares de hash na árvore. Os cabeçalhos de bloco devem incluir uma raiz de merkle válida que seja descendente de todas as transações incluídas naquele bloco.</p>
</dd>
<dt class="hdlist1">árvore de merkle (merkle tree)</dt>
<dd>
<p>Uma árvore que é construída ao se fazer <em>hashing</em> de dados dispostos em pares (as folhas), cujos resultados são dispostos em pares e novamente são submetidos a <em>hashing</em>, até permanecer um único hash, que é a raiz de merkle. No bitcoin, as folhas quase sempre são transações de um único bloco.</p>
</dd>
<dt class="hdlist1">minerador (miner)</dt>
<dd>
<p>Um nó da rede que encontra uma prova de trabalho válida para novos blocos, ao fazer repetidos <em>hashings</em>.</p>
</dd>
<dt class="hdlist1">recompensa da mineração (mining reward)</dt>
<dd>
<p>A recompensa que os mineradores recebem em troca da segurança fornecida pela mineração. Inclui as novas moedas criadas em cada novo bloco, também conhecido como recompensa de bloco ou recompensa coinbase, e as taxas de transação de todas as transações incluídas no bloco.</p>
</dd>
<dt class="hdlist1">multiassinatura (multisignature ou multisig)</dt>
<dd>
<p>Multiassinatura refere-se à exigência de um número mínimo (M) de chaves (N) para autorizar uma transação M-de-N.</p>
</dd>
<dt class="hdlist1">rede (network)</dt>
<dd>
<p>A peer-to-peer network that propagates transactions and blocks to every Bitcoin node on the network.</p>
</dd>
<dt class="hdlist1">nonce</dt>
<dd>
<p>O "nonce" em um bloco de bitcoin é um campo de 32 bits (4 bytes) cujo valor é definido de forma que o hash do bloco contenha uma sequência de zeros iniciais. Os demais campos não podem ser alterados, pois eles possuem um significado definido.</p>
</dd>
<dt class="hdlist1">transações off-chain/fora da cadeia</dt>
<dd>
<p>Uma transação <em>off-chain</em> é a movimentação de valor fora da cadeia de blocos (da blockchain). Enquanto uma transação <em>on-chain</em>&#x2014;geralmente chamada simplesmente de <em>uma transação</em>&#x2014;modifica a blockchain e depende da blockchain para determinar sua validade, uma transação <em>off-chain</em> depende de outros métodos para registrar e validar a transação.</p>
</dd>
<dt class="hdlist1">código operacional (opcode)</dt>
<dd>
<p>Códigos de operação da linguagem Script do bitcoin que adicionam dados ou executam funções em um script pubkey ou um script de assinatura.</p>
</dd>
<dt class="hdlist1">protocolo de Ativos Abertos (Open Assets protocol)</dt>
<dd>
<p>The Open Assets Protocol is a simple and powerful protocol built on top of the Bitcoin blockchain. It allows issuance and transfer of user-created assets.</p>
</dd>
<dt class="hdlist1">OP_RETURN</dt>
<dd>
<p>Um código operacional usado em uma das saídas em uma transação OP_RETURN. Não deve ser confundido com uma transação OP_RETURN.</p>
</dd>
<dt class="hdlist1">transação OP_RETURN</dt>
<dd>
<p>Um tipo de transação que adiciona dados arbitrários a um script pubkey comprovadamente impossível de ser gasto, que os nós completos não precisam armazenar em seu banco de dados de UTXOs. Não deve ser confundida com um código operacional OP_RETURN.</p>
</dd>
<dt class="hdlist1">bloco órfão (orphan block)</dt>
<dd>
<p>Blocos cujo bloco pai não foi processado pelo nó local, portanto, ainda não podem ser totalmente validados. Não devem ser confundido com bloco obsoleto.</p>
</dd>
<dt class="hdlist1">transações órfãs</dt>
<dd>
<p>Transações que não podem entrar na <em>pool</em> devido a uma ou mais transações de entrada ausentes.</p>
</dd>
<dt class="hdlist1">saída de transação (output)</dt>
<dd>
<p>Uma saída (em inglês, <em>output</em>), saída de transação ou TxOut é uma saída em uma transação que contém dois campos: um campo de valor para transferir zero ou mais satoshis e um script pubkey para indicar quais condições devem ser cumpridas para que esses satoshis possam sejam gastos posteriormente.</p>
</dd>
<dt class="hdlist1">P2PKH</dt>
<dd>
<p>Transactions that pay a Bitcoin address contain P2PKH or Pay To PubKey Hash scripts. An output locked by a P2PKH script can be unlocked (spent) by presenting a public key and a digital signature created by the corresponding private key.</p>
</dd>
<dt class="hdlist1">P2SH</dt>
<dd>
<p>P2SH ou Pay-to-Script-Hash (em português, Paga-para-Hash-de-Script) é um novo tipo poderoso de transação que simplifica muito o uso de scripts de transação complexos. Com o P2SH, o script complexo que detalha as condições para se gastar a saída (o script de resgate) não é apresentado no script de travamento. Em vez disso, inclui-se apenas um hash do script de resgate no script de travamento.</p>
</dd>
<dt class="hdlist1">P2SH, endereço</dt>
<dd>
<p>Os endereços P2SH são codificações Base58Check do hash de 20 bytes de um script. Eles usam o prefixo de versão "5", o que resulta em endereços codificados por Base58Check que começam com "3". Os endereços P2SH escondem toda a complexidade, para que a pessoa que faz o pagamento não veja o script.</p>
</dd>
<dt class="hdlist1">P2WPKH</dt>
<dd>
<p>A assinatura de um P2WPKH (Pay-to-Witness-Public-Key-Hash ou Paga-para-Testemunha-de-Hash-de-Chave-Pública) contém as mesmas informações que um pagamento P2PKH, mas está localizada no campo testemunha ao invés do campo scriptSig. O scriptPubKey também é modificado.</p>
</dd>
<dt class="hdlist1">P2WSH</dt>
<dd>
<p>A diferença existente entre o P2SH e o P2WSH (Pay-to-Witness-Script-Hash ou Paga-para-Testemunha-de-Hash-de-Script) é a mudança do local da prova criptográfica do campo scriptSig para o campo testemunha, assim como o scriptPubKey, que também é modificado.</p>
</dd>
<dt class="hdlist1">carteira de papel (paper wallet)</dt>
<dd>
<p>No sentido mais específico, uma carteira de papel é um documento que contém todos os dados necessários para gerar qualquer quantidade de chaves privadas de bitcoin, formando uma carteira de chaves. No entanto, as pessoas costumam usar o termo para se referir a qualquer maneira de armazenar bitcoin offline como um documento físico. Esta segunda definição também inclui chaves de papel e códigos resgatáveis.</p>
</dd>
<dt class="hdlist1">frase de senha (passphrase)</dt>
<dd>
<p>Uma frase de senha (em inglês, <em>passphrase</em>) é uma <em>string</em> opcional criada pelo usuário que serve como um fator de segurança adicional protegendo a semente, mesmo quando a semente for comprometida por furto ou roubo. Ela também pode ser usada como uma forma de negação plausível, quando se usa uma frase de senha para abrir uma carteira com uma quantidade menor de fundos, a qual é usada para distrair um criminoso da carteira "verdadeira", que contém a maioria dos fundos.</p>
</dd>
<dt class="hdlist1">canais de pagamento (payment channels)</dt>
<dd>
<p>A micropayment channel or payment channel is a class of techniques designed to allow users to make multiple bitcoin transactions without committing all of the transactions to the Bitcoin blockchain. In a typical payment channel, only two transactions are added to the block chain but an unlimited or nearly unlimited number of payments can be made between the participants.</p>
</dd>
<dt class="hdlist1">pool, mineração em (pooled mining)</dt>
<dd>
<p>A mineração em pool é uma modalidade de mineração na qual vários clientes geradores contribuem para a geração de um bloco e, em seguida, dividem a recompensa do bloco de acordo com o poder de processamento contribuído.</p>
</dd>
<dt class="hdlist1">Proof-of-Stake</dt>
<dd>
<p>O Proof-of-Stake (PoS) (em português, Prova de Participação, Prova de Montante ou Prova de Aposta) é um método através do qual a rede de blockchain de uma criptomoeda visa alcançar um consenso distribuído. O Proof-of-Stake pede aos usuários que comprovem a posse de uma certa quantidade de moeda (que é o seu "stake" na moeda).</p>
</dd>
<dt class="hdlist1">Prova-de-Trabalho (Proof-of-Work)</dt>
<dd>
<p>Um dado que requer computação significativa para ser encontrado. No bitcoin, os mineradores precisam encontrar uma solução numérica para o algoritmo SHA256 que atenda a um alvo que é definido em toda a rede, o alvo de dificuldade.</p>
</dd>
<dt class="hdlist1">RIPEMD-160</dt>
<dd>
<p>A RIPEMD-160 é uma função de hash criptográfica de 160 bits. A RIPEMD-160 é uma versão reforçada da RIPEMD que tem como resultado um hash de 160 bits, e espera-se que seja segura nos próximos dez anos ou mais.</p>
</dd>
<dt class="hdlist1">satoshi</dt>
<dd>
<p>Um satoshi é a menor denominação de bitcoin que pode ser registrada na <em>blockchain</em>. É o equivalente a 0,00000001 bitcoin e recebe o nome em homenagem ao criador do bitcoin, Satoshi Nakamoto. </p>
</dd>
<dt class="hdlist1">Satoshi Nakamoto</dt>
<dd>
<p>Satoshi Nakamoto é o nome usado pela pessoa ou pelo grupo de pessoas que projetou o bitcoin e criou sua implementação de referência original, o Bitcoin Core. Como parte da implementação, eles também criaram o primeiro banco de dados de blockchain. No processo, eles foram os primeiros a resolver o problema do gasto duplo em moedas digitais. Sua verdadeira identidade permanece desconhecida.</p>
</dd>
<dt class="hdlist1">Script</dt>
<dd>
<p>O bitcoin usa um sistema de script para transações. Semelhante ao Forth, o Script é simples, baseado em pilha e é processado da esquerda para a direita. Ele é propositalmente não Turing completo, sem loops.</p>
</dd>
<dt class="hdlist1">ScriptPubKey (script pubkey) </dt>
<dd>
<p>Um ScriptPubKey, ou script pubkey, é um script incluído nas saídas que define as condições que devem ser cumpridas para que esses satoshis sejam gastos. Os dados para o cumprimento das condições podem ser fornecidos em um script de assinatura.</p>
</dd>
<dt class="hdlist1">ScriptSig (script de assinatura)</dt>
<dd>
<p>Um ScriptSig, ou script de assinatura, são os dados gerados por um pagador que quase sempre são usados como variáveis para satisfazer um script pubkey.</p>
</dd>
<dt class="hdlist1">chave secreta/chave privada (secret key/private key)</dt>
<dd>
<p>O número secreto que destrava os bitcoins enviados para o endereço correspondente. Uma chave <span class="keep-together">secreta</span> tem a seguinte aparência:</p>
<div class="listingblock data-line-221">
<div class="content">
<pre>5J76sF8L5jTtzE96r66Sf8cka9y44wdpJjMwCxR3tzLh3ibVPxh</pre>
</div>
</div>
</dd>
<dt class="hdlist1">Segregated Witness</dt>
<dd>
<p>Segregated Witness (em português, Testemunha Segregada) é uma atualização do protocolo Bitcoin no qual os dados de assinatura (a "testemunha") são separados dos dados do remetente/destinatário para otimizar ainda mais a estrutura das transações. A Segregated Witness foi implementada como um soft fork; uma mudança que tecnicamente torna mais restritivas as regras do protocolo do bitcoin.</p>
</dd>
<dt class="hdlist1">SHA</dt>
<dd>
<p>O Algoritmo de Hash Seguro (em inglês, <em>Secure Hash Algorithm</em> ou SHA) é uma família de funções de hash criptográficas publicadas pelo Instituto Nacional de Padrões e Tecnologia (<em>National Institute of Standards and Technology</em> ou NIST).</p>
</dd>
<dt class="hdlist1">SPV (Verificação de Pagamento Simplificada)</dt>
<dd>
<p>SPV ou verificação de pagamento simplificada (em inglês, <em>simplified payment verification</em>) é um método para verificar se determinadas transações foram incluídas em um bloco, sem precisar fazer o download do bloco inteiro. Este método de verificação é frequentemente usado por clientes leves de bitcoin.</p>
</dd>
<dt class="hdlist1">soft fork</dt>
<dd>
<p>Um soft fork ou "mudança causadora de soft fork" é uma bifurcação temporária na blockchain que normalmente ocorre quando os mineradores que usam nós não atualizados não seguem uma nova regra de consenso, pois seus nós não conhecem essa nova regra.
Não deve ser confundido com fork, hard fork, fork de software ou fork do Git.</p>
</dd>
<dt class="hdlist1">bloco obsoleto (<em>stale block</em>)</dt>
<dd>
<p>Um bloco válido que foi minerado com sucesso, mas que não está incluído no ramo principal atual (com a maior Prova-de-Trabalho acumulada), pois algum outro bloco válido foi minerado na mesma altura e teve sua cadeia estendida primeiro. O minerador de um bloco obsoleto não fica com a recompensa do bloco ou as taxas das transações desse bloco.
Não deve ser confundido com bloco órfão ou bloco candidato.</p>
</dd>
<dt class="hdlist1">timelocks</dt>
<dd>
<p>Um timelock é um tipo de trava que restringe o gasto de alguns bitcoins até um determinado período/data no futuro ou uma altura de bloco. Os timelocks são muito usados em contratos de bitcoin, incluindo canais de pagamento e contratos hash time lock (HTLC).</p>
</dd>
<dt class="hdlist1">transação (transaction)</dt>
<dd>
<p>In simple terms, a transfer of bitcoin from one address to another. More precisely, a transaction is a signed data structure expressing a transfer of value. Transactions are transmitted over the Bitcoin network, collected by miners, and included into blocks, made permanent on the blockchain.</p>
</dd>
<dt class="hdlist1">pool de transações (transaction pool)</dt>
<dd>
<p>Uma coleção não ordenada de transações que não estão em blocos na cadeia principal, mas para as quais temos transações de entrada.</p>
</dd>
<dt class="hdlist1">completude de Turing (Turing completeness)</dt>
<dd>
<p>Uma linguagem de programação é chamada de "Turing completa" se ela puder executar qualquer programa que uma máquina de Turing possa executar, dado tempo e memória suficientes.</p>
</dd>
<dt class="hdlist1">saída de transação não gasta (unspent transaction output ou UTXO)</dt>
<dd>
<p>Uma UTXO é uma saída de transação não gasta que pode ser gasta como uma entrada em uma nova transação.</p>
</dd>
<dt class="hdlist1">carteira (wallet)</dt>
<dd>
<p>Software that holds all your Bitcoin addresses and secret keys. Use it to send, receive, and store your bitcoin.</p>
</dd>
<dt class="hdlist1">WIF - Wallet Import Format (Formato de Importação de Carteira)</dt>
<dd>
<p>O WIF ou Wallet Import Format é um formato de intercâmbio de dados projetado para permitir a exportação e a importação de uma chave privada com um sinalizador indicando se ela usa ou não uma chave pública comprimida.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-5">
<p>Algumas definições contribuídas foram obtidas sob uma licença CC-BY a partir da <a href="https://en.bitcoin.it/wiki/Main_Page" data-href="https://en.bitcoin.it/wiki/Main_Page">Wiki do bitcoin</a> ou de outras fontes de documentação de código aberto.</p>
</div>
</div>
</div>
<div class="sect1 pagenumrestart data-line-3">
<h2 id="ch01_intro_what_is_bitcoin">Introdução</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1 data-line-5">
<h2 id="_o_que_é_o_bitcoin">O que é o Bitcoin?</h2>
<div class="sectionbody">
<div class="paragraph data-line-7">
<p>Bitcoin é um conjunto de conceitos e tecnologias que formam as bases de um ecossistema de dinheiro digital. Unidades de moeda chamadas de bitcoin são utilizadas para armazenar e transmitir valor entre participantes na rede Bitcoin. Usuários da Bitcoin comunicam-se entre si utilizando o protocolo Bitcoin primariamente por meio da internet, embora outras redes de transporte também possam ser utilizadas. A pilha de protocolos Bitcoin, disponível como um software de código aberto, pode ser executada numa ampla gama de dispositivos computacionais, incluindo notebooks e smartphones, tornando a tecnologia de fácil acesso.</p>
</div>
<div class="admonitionblock tip data-line-10">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-11">
<p>Note como a unidade de conta é chamada de "bitcoin" com <em>b</em> minúsculo, e o sistema é chamado de "Bitcoin", como <em>B</em> maiúsculo.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-14">
<p>Os usuários podem transferir bitcoins através da rede para fazer as mesmas atividades que as moedas convencionais podem fazer, incluindo comprar e vender bens, enviar dinheiro a pessoas e organizações ou mesmo conceder crédito. Os bitcoins podem ser comprados, vendidos ou trocados por outras moedas em casas de câmbio especializadas, conhecidas como <em>exchanges</em> ou corretoras. De certo modo, o bitcoin é o dinheiro perfeito para a Internet, pois é rápido, seguro e sem fronteiras.</p>
</div>
<div class="paragraph data-line-16">
<p>Ao contrário das moedas tradicionais, o bitcoin é totalmente virtual. Não existem moedas físicas ou mesmo moedas digitais em si. As moedas estão implícitas em transações que transferem valor do remetente para o destinatário. Os usuários de Bitcoin possuem chaves que lhes permitem provar serem donos de bitcoin na rede Bitcoin. Com essas chaves, eles podem assinar transações para desbloquear o valor e gastá-lo, transferindo-o para um novo proprietário. As chaves geralmente são armazenadas em uma carteira digital no computador ou smartphone de cada usuário. A posse da chave que pode assinar uma transação é o único pré-requisito para gastar bitcoin, colocando o controle inteiramente nas mãos de cada usuário.</p>
</div>
<div class="paragraph data-line-18">
<p>Bitcoin é um sistema distribuído ponto a ponto (P2P). Como tal, não existe um servidor central ou ponto de controle. Bitcoins, ou seja, unidades de bitcoin, são criadas através de um processo chamado mineração, que envolve competir para encontrar soluções para um problema matemático durante o processamento de transações de Bitcoin. Qualquer participante da rede Bitcoin (ou seja, qualquer pessoa que use um dispositivo executando a pilha completa do protocolo Bitcoin) pode operar como um minerador, usando o poder de processamento de seu computador para verificar e registrar transações. A cada 10 minutos, em média, um minerador de Bitcoin pode validar as transações dos últimos 10 minutos e é recompensado com um novo bitcoin. Essencialmente, a mineração de Bitcoin descentraliza as funções de emissão de moeda e compensação de um banco central, e substitui a necessidade de qualquer banco central.</p>
</div>
<div class="paragraph data-line-20">
<p>O protocolo Bitcoin inclui algoritmos integrados que regulam a função de mineração em toda a rede. A dificuldade da tarefa de processamento que os mineradores devem realizar é ajustada dinamicamente para que, em média, alguém tenha sucesso a cada 10 minutos, independentemente de quantos mineradores (e quanto processamento) estejam competindo a qualquer momento. O protocolo também reduz pela metade a taxa na qual novos bitcoins são criados a cada 4 anos, e limita o número total de bitcoins que serão criados a um total fixo logo abaixo de 21 milhões de moedas. O resultado é que o número de bitcoin em circulação segue de perto uma curva facilmente previsível que se aproxima de 21 milhões no ano de 2140. Devido à diminuição da taxa de emissão do bitcoin, a longo prazo, a moeda Bitcoin é deflacionária. Além disso, o bitcoin não pode ser inflado “imprimindo” dinheiro novo acima e além da taxa de emissão esperada.</p>
</div>
<div class="paragraph data-line-22">
<p>Nos bastidores, Bitcoin também é o nome do protocolo, uma rede peer-to-peer e uma inovação na computação distribuída. A moeda bitcoin é realmente apenas a primeira aplicação desta invenção. Bitcoin representa o culminar de décadas de pesquisa em criptografia e sistemas distribuídos, e inclui quatro inovações principais reunidas em uma combinação única e poderosa. Bitcoin consiste em:</p>
</div>
<div class="ulist data-line-24">
<ul>
<li class="data-line-24">
<p>Uma rede peer to peer descentralizada (o protocolo Bitcoin)</p>
</li>
<li class="data-line-25">
<p>Um registro público de transações (a <em>blockchain</em> ou cadeia de blocos)</p>
</li>
<li class="data-line-26">
<p>Um conjunto de regras para validação independente de transações e emissão de moedas (regras de consenso)</p>
</li>
<li class="data-line-27">
<p>Um mecanismo para alcançar um consenso descentralizado global sobre qual é a <em>blockchain</em> válida (algoritmo de Prova-de-Trabalho)</p>
</li>
</ul>
</div>
<div class="paragraph data-line-29">
<p>Como desenvolvedor, vejo o Bitcoin como semelhante à internet do dinheiro, uma rede para propagar valor e garantir a propriedade de ativos digitais por meio de computação distribuída. Há muito mais no Bitcoin do que parece à primeira vista.</p>
</div>
<div class="paragraph data-line-31">
<p>Neste capítulo, começaremos explicando alguns dos principais conceitos e termos, obtendo o software necessário e usando o Bitcoin para transações simples. Nos capítulos seguintes, vamos começar a desembrulhar as camadas de tecnologia que tornam o Bitcoin possível e examinar o funcionamento interno da rede e do protocolo Bitcoin.</p>
</div>
<div class="paragraph pagebreak-before less_space data-line-34">
<p>Moedas Digitais Antes do Bitcoin</p>
</div>
<div class="sidebarblock data-line-35">
<div class="content">
<div class="paragraph data-line-37">
<p>O surgimento de uma moeda digital viável está intimamente relacionado à evolução da criptografia. Isso não é algo surpreendente quando se leva em consideração os desafios fundamentais que existem em se usar bits para representar um valor que pode ser trocado por bens e serviços. Três perguntas básicas que são feitas por qualquer pessoa que aceita um dinheiro digital são:</p>
</div>
<div class="olist arabic data-line-39">
<ol class="arabic">
<li class="data-line-39">
<p>Posso confiar que o dinheiro é autêntico e não é falsificado?</p>
</li>
<li class="data-line-40">
<p>Posso confiar que o dinheiro digital só pode ser gasto uma única vez (conhecido como o problema do "gasto duplo")?</p>
</li>
<li class="data-line-41">
<p>Posso estar seguro de que ninguém vai alegar que esse dinheiro lhe pertence, e não pertence a mim?</p>
</li>
</ol>
</div>
<div class="paragraph data-line-43">
<p>Os emissores de cédulas de dinheiro estão constantemente enfrentando o problema da falsificação através do uso de papéis e tecnologias de impressão cada vez mais sofisticados. O dinheiro físico resolve facilmente o problema do gasto duplo, pois a mesma nota de papel não pode estar em dois lugares ao mesmo tempo. Mas o dinheiro convencional também é frequentemente armazenado e transmitido de forma digital. Nestes casos, os problemas de falsificação e de gasto duplo são resolvidos através da compensação de todas as transações eletrônicas por autoridades centrais que detêm uma visão global da moeda em circulação. No caso do dinheiro digital, que não pode se beneficiar de tintas especiais ou marcas holográficas, a criptografia proporciona a base para se confiar na legitimidade de um valor que um usuário afirma possuir. Especificamente, as assinaturas digitais criptográficas permitem que um usuário assine um ativo digital ou uma transação que comprove a posse do ativo. Com a arquitetura apropriada, as assinaturas digitais também podem ser usadas para resolver o problema do gasto duplo.</p>
</div>
<div class="paragraph data-line-45">
<p>No final dos anos 1980, quando a criptografia começou a se tornar mais acessível e entendida, muitos pesquisadores começaram a tentar usá-la para construir moedas digitais. Estes projetos pioneiros emitiram diferentes formas de dinheiro digital, normalmente lastreadas por uma moeda nacional ou um metal precioso - como o ouro.</p>
</div>
<div class="paragraph data-line-47">
<p>Apesar de essas moedas digitais pioneiras terem funcionado, elas eram centralizadas e, como resultado, eram fáceis de serem atacadas tanto por governos como por hackers. As primeiras moedas digitais usavam uma câmara de compensação central para liquidar todas as transações em intervalos regulares, da mesma forma que um sistema bancário tradicional. Infelizmente, na maior parte dos casos, essas moedas digitais precursoras se tornaram alvo de governos preocupados e acabaram sendo aniquiladas judicialmente. Algumas fracassaram em quebras espetaculares quando a companhia responsável foi liquidada repentinamente. Para se ter robustez contra a intervenção de opositores, sejam eles governos legítimos ou agentes criminosos, era necessária a criação de uma moeda digital <em>descentralizada</em>, que não tivesse um único ponto de ataque. O bitcoin é um sistema desse tipo, projetado para ser descentralizado e livre de qualquer autoridade central ou ponto de controle centralizado que possa ser atacado ou corrompido.</p>
</div>
</div>
</div>
<div class="sect2 data-line-51">
<h3 id="_a_história_do_bitcoin">A História do Bitcoin</h3>
<div class="paragraph data-line-53">
<p>O bitcoin foi inventado em 2008 com a publicação de um artigo intitulado "Bitcoin: Um Sistema de Dinheiro em Espécie Eletrônico Par-a-Par,"<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup> escrito por um autor sob o pseudônimo de Satoshi Nakamoto (ver <a href="#satoshi_whitepaper">[satoshi_whitepaper]</a>). Nakamoto combinou várias invenções anteriores como o b-money e o HashCash para criar um sistema de dinheiro em espécie eletrônico completamente descentralizado que não depende de uma autoridade central para a emissão ou liquidação da moeda e para a validação de transações. A inovação-chave foi usar um sistema de computação distribuída (chamado de algoritmo de "Prova-de-Trabalho" ou <em>"Proof-of-Work"</em>) para conduzir uma "eleição" global a cada 10 minutos, permitindo que a rede descentralizada chegue a um <em>consenso</em> sobre o estado das transações. Isto resolve de maneira elegante o problema do gasto duplo, que ocorre quando uma mesma unidade da moeda é gasta duas vezes. Antes do bitcoin, o problema do gasto duplo era uma fraqueza do dinheiro digital, e sua solução envolvia a compensação de todas as transações através de uma câmara de compensação central.</p>
</div>
<div class="paragraph data-line-55">
<p>A rede Bitcoin começou em 2009, com base em uma implementação de referência publicada por Nakamoto e desde então revisada por muitos outros programadores. A implementação do algoritmo Proof-of-Work (mineração) que fornece segurança e resiliência para Bitcoin aumentou exponencialmente em poder, e agora excede o poder de processamento combinado dos principais supercomputadores do mundo. O valor total de mercado do Bitcoin por vezes ultrapassou US$ 1 trilhão de dólares, dependendo da taxa de câmbio de bitcoin para dólar. A maior transação processada até agora pela rede foi de US$ 1,1 bilhão, transmitida instantaneamente e processada por uma taxa de apenas US$ 0,68.</p>
</div>
<div class="paragraph data-line-57">
<p>Satoshi Nakamoto withdrew from the public in April 2011, leaving the responsibility of developing the code and network to a thriving group of volunteers. The identity of the person or people behind Bitcoin is still unknown. However, neither Satoshi Nakamoto nor anyone else exerts individual control over the Bitcoin system, which operates based on fully transparent mathematical principles, open source code, and consensus among participants. The invention itself is groundbreaking and has already spawned new science in the fields of distributed computing, economics, and econometrics.</p>
</div>
<div class="sidebarblock data-line-61">
<div class="content">
<div class="title">Uma Solução para um Problema de Computação Distribuída</div>
<div class="paragraph data-line-62">
<p>A invenção de Satoshi Nakamoto também é uma solução prática e inovadora para um problema da computação distribuída conhecido como o "Problema dos Generais Bizantinos". Resumidamente, o problema consiste em se tentar chegar a um acordo sobre um curso de ação ou o estado de um sistema enquanto se troca informações em uma rede não confiável e potencialmente comprometida. A solução de Satoshi Nakamoto, que usa o conceito de Prova-de-Trabalho para obter consenso <em>sem uma autoridade central de confiança</em>, representa um importante avanço na computação distribuída e tem ampla aplicabilidade além do seu uso em moedas. Ela pode ser usada para obter consenso em redes descentralizadas para provar a legitimidade de eleições, loterias, registros de ativos, notarização digital e muito mais.</p>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-67">
<h3 id="user-stories">Usos do Bitcoin, Usuários e Suas Histórias</h3>
<div class="paragraph data-line-69">
<p>Bitcoin is an innovation in the ancient technology of money. At its core, money simply facilitates the exchange of value between people. Therefore, in order to fully understand Bitcoin and its uses, we&#8217;ll examine it from the perspective of people using it. Each of the people and their stories, as listed here, illustrates one or more specific use cases. We&#8217;ll be seeing them throughout the book:</p>
</div>
<div class="dlist data-line-71">
<dl>
<dt class="hdlist1">Varejo de produtos de baixo valor nos Estados Unidos</dt>
<dd>
<p>Alice lives in Northern California&#8217;s Bay Area. She has heard about Bitcoin from her techie friends and wants to start using it. We will follow her story as she learns about Bitcoin, acquires some, and then spends some of her bitcoin to buy a cup of coffee at Bob&#8217;s Cafe in Palo Alto. This story will introduce us to the software, the exchanges, and basic transactions from the perspective of a retail consumer.</p>
</dd>
<dt class="hdlist1">Varejo de produtos de alto valor nos Estados Unidos</dt>
<dd>
<p>Carol is an art gallery owner in San Francisco. She sells expensive paintings for Bitcoin. This story will introduce the risks of a "51%" consensus attack for retailers of high-value items.</p>
</dd>
<dt class="hdlist1">Serviços de contrato offshore</dt>
<dd>
<p>Bob, the cafe owner in Palo Alto, is building a new website. He has contracted with an Indian web developer, Gopesh, who lives in Bangalore, India. Gopesh has agreed to be paid in bitcoin. This story will examine the use of Bitcoin for outsourcing, contract services, and international wire transfers.</p>
</dd>
<dt class="hdlist1">Loja virtual</dt>
<dd>
<p>Gabriel is an enterprising young teenager in Rio de Janeiro, running a small web store that sells Bitcoin-branded t-shirts, coffee mugs, and stickers. Gabriel is too young to have a bank account, but his parents are encouraging his entrepreneurial spirit.</p>
</dd>
<dt class="hdlist1">Doações beneficentes</dt>
<dd>
<p>Eugenia is the director of a children&#8217;s charity in the Philippines. Recently she has discovered Bitcoin and wants to use it to reach a whole new group of foreign and domestic donors to fundraise for her charity. She&#8217;s also investigating ways to use Bitcoin to distribute funds quickly to areas of need. This story will show the use of Bitcoin for global fundraising across currencies and borders and the use of an open ledger for transparency in charitable organizations.</p>
</dd>
<dt class="hdlist1">Importação/exportação</dt>
<dd>
<p>Mohammed is an electronics importer in Dubai. He&#8217;s trying to use Bitcoin to buy electronics from the United States and China for import into the UAE to accelerate the process of payments for imports. This story will show how Bitcoin can be used for large business-to-business international payments tied to physical goods.</p>
</dd>
<dt class="hdlist1">Mineração de bitcoins</dt>
<dd>
<p>Jing is a computer engineering student in Shanghai. He has built a "mining" rig to mine for bitcoin using his engineering skills to supplement his income. This story will examine the "industrial" base of Bitcoin: the specialized equipment used to secure the Bitcoin network and issue new currency.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-92">
<p>Each of these stories is based on the real people and real industries currently using Bitcoin to create new markets, new industries, and innovative solutions to global economic issues.</p>
</div>
</div>
<div class="sect2 data-line-94">
<h3 id="_como_começar">Como Começar</h3>
<div class="paragraph data-line-96">
<p>Bitcoin is a protocol that can be accessed using a client application that speaks the protocol. A "Bitcoin wallet" is the most common user interface to the Bitcoin system, just like a web browser is the most common user interface for the HTTP protocol. There are many implementations and brands of Bitcoin wallets, just like there are many brands of web browsers (e.g., Chrome, Safari, Firefox, and Internet Explorer). And just like we all have our favorite browsers (Mozilla Firefox, Yay!) and our villains (Internet Explorer, Yuck!), Bitcoin wallets vary in quality, performance, security, privacy, and reliability. There is also a reference implementation of the Bitcoin protocol that includes a wallet, known as the "Satoshi Client" or "Bitcoin Core," which is derived from the original implementation written by Satoshi Nakamoto.</p>
</div>
<div class="sect3 data-line-98">
<h4 id="_escolhendo_uma_carteira_de_bitcoin">Escolhendo uma Carteira de Bitcoin</h4>
<div class="paragraph data-line-100">
<p>Bitcoin wallets are one of the most actively developed applications in the Bitcoin ecosystem. There is intense competition, and while a new wallet is probably being developed right now, several wallets from last year are no longer actively maintained. Many wallets focus on specific platforms or specific uses and some are more suitable for beginners while others are filled with features for advanced users. Choosing a wallet is highly subjective and depends on the use and user expertise. Therefore it would be pointless to recommend a specific brand or wallet. However, we can categorize Bitcoin wallets according to their platform and function and provide some clarity about all the different types of wallets that exist. Better yet, moving keys or seeds between Bitcoin wallets is relatively easy, so it is worth trying out several different wallets until you find one that fits your needs.</p>
</div>
<div class="paragraph pagebreak-before data-line-103">
<p>As carteiras de bitcoin podem ser categorizadas da seguinte forma, de acordo com a plataforma:</p>
</div>
<div class="dlist data-line-105">
<dl>
<dt class="hdlist1">Desktop wallet</dt>
<dd>
<p>A desktop wallet was the first type of Bitcoin wallet created as a reference implementation and many users run desktop wallets for the features, autonomy, and control they offer. Running on general-use operating systems such as Windows and Mac OS has certain security disadvantages, however, as these platforms are often insecure and poorly configured.</p>
</dd>
<dt class="hdlist1">Mobile wallet</dt>
<dd>
<p>A mobile wallet is the most common type of Bitcoin wallet. Running on smart-phone operating systems such as Apple iOS and Android, these wallets are often a great choice for new users. Many are designed for simplicity and ease-of-use, but there are also fully featured mobile wallets for power users.</p>
</dd>
<dt class="hdlist1">Web wallet</dt>
<dd>
<p>Web wallets are accessed through a web browser and store the user&#8217;s wallet on a server owned by a third party. This is similar to webmail in that it relies entirely on a third-party server. Some of these services operate using client-side code running in the user&#8217;s browser, which keeps control of the Bitcoin keys in the hands of the user. Most, however, present a compromise by taking control of the Bitcoin keys from users in exchange for ease-of-use. It is inadvisable to store large amounts of bitcoin on third-party systems.</p>
</dd>
<dt class="hdlist1">Hardware wallet</dt>
<dd>
<p>Hardware wallets are devices that operate a secure self-contained Bitcoin wallet on special-purpose hardware. They usually connect to a desktop or mobile device via USB cable or near-field-communication (NFC), and are operated with a web browser or accompanying software. By handling all Bitcoin-related operations on the specialized hardware, these wallets are considered very secure and suitable for storing large amounts of bitcoin.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-113">
<p>Another way to categorize bitcoin wallets is by their degree of autonomy and how they interact with the Bitcoin network:</p>
</div>
<div class="dlist data-line-115">
<dl>
<dt class="hdlist1">Full-node client</dt>
<dd>
<p>A full client, or "full node," is a client that stores the entire history of Bitcoin transactions (every transaction by every user, ever), manages users' wallets, and can initiate transactions directly on the Bitcoin network. A full node handles all aspects of the protocol and can independently validate the entire blockchain and any transaction. A full-node client consumes substantial computer resources (e.g., more than 125 GB of disk, 2 GB of RAM) but offers complete autonomy and independent transaction verification.</p>
</dd>
<dt class="hdlist1">Lightweight client</dt>
<dd>
<p>A lightweight client, also known as a simplified-payment-verification (SPV) client, connects to Bitcoin full nodes (mentioned previously) for access to the Bitcoin transaction information, but stores the user wallet locally and independently creates, validates, and transmits transactions. Lightweight clients interact directly with the Bitcoin network, without an intermediary.</p>
</dd>
<dt class="hdlist1">Third-party API client</dt>
<dd>
<p>A third-party API client is one that interacts with Bitcoin through a third-party system of application programming interfaces (APIs), rather than by connecting to the Bitcoin network directly. The wallet may be stored by the user or by third-party servers, but all transactions go through a third party.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-121">
<p>Combining these categorizations, many Bitcoin wallets fall into a few groups, with the three most common being desktop full client, mobile lightweight wallet, and web third-party wallet. The lines between different categories are often blurry, as many wallets run on multiple platforms and can interact with the network in different ways.</p>
</div>
<div class="paragraph data-line-123">
<p>For the purposes of this book, we will be demonstrating the use of a variety of downloadable Bitcoin clients, from the reference implementation (Bitcoin Core) to mobile and web wallets. Some of the examples will require the use of Bitcoin Core, which, in addition to being a full client, also exposes APIs to the wallet, network, and transaction services. If you are planning to explore the programmatic interfaces into the Bitcoin system, you will need to run Bitcoin Core, or one of the alternative clients.</p>
</div>
</div>
<div class="sect3 data-line-125">
<h4 id="_início_rápido">Início Rápido</h4>
<div class="paragraph data-line-127">
<p>Alice, who we introduced in <a href="#user-stories">Usos do Bitcoin, Usuários e Suas Histórias</a>, is not a technical user and only recently heard about Bitcoin from her friend Joe. While at a party, Joe is once again enthusiastically explaining Bitcoin to all around him and is offering a demonstration. Intrigued, Alice asks how she can get started with Bitcoin. Joe says that a mobile wallet is best for new users and he recommends a few of his favorite wallets. Alice downloads "Bluewallet" (available for iOS and Android) and installs it on her phone.</p>
</div>
<div class="paragraph data-line-129">
<p>When Alice runs her wallet application for the first time, she chooses the option to create a new Bitcoin wallet, and takes a moment <strong>away from Joe and all other parties</strong> to write down a secret mnemonic phrase <em>in order</em> on a piece of paper. As explained by the mobile wallet and by Joe earlier, the mnemonic phrase allows Alice to restore her wallet in case she loses her mobile device and grants her access to her funds on another device. After creating her wallet and securing her mnemonic phrase, Alice can tap on her wallet to see her bitcoin amount, transaction history, as well as two buttons that allow her to either <em>receive</em> or <em>send</em> bitcoin, shown in <a href="#bluewallet-welcome">Alice uses the Receive screen on her Bluewallet mobile Bitcoin wallet, and displays her address to Bob in a QR code format</a>.</p>
</div>
</div>
<div class="sect3 data-line-131">
<h4 id="_palavras_mnemônicas">Palavras Mnemônicas</h4>
<div class="paragraph data-line-133">
<p>A modern Bitcoin wallet will provide a <em>mnemonic phrase</em> (also sometimes called a "seed" or "seed phrase") for Alice to back up. The mnemonic phrase consists of 12-24 English words, selected randomly by the software, and used as the basis for the keys that are generated by the wallet. The mnemonic phrase can be used by Alice to restore all the transactions and funds in her wallet in the case of an event such as a lost mobile device, a software bug, or memory corruption.</p>
</div>
<div class="admonitionblock tip data-line-136">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-137">
<p>O termo correto para essas palavras de backup é "frase mnemônica". Evitamos o uso do termo "semente" para se referir a uma frase mnemônica, pois embora seu uso seja comum, ele é incorreto.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-141">
<h4 id="mnemonic-storage">Armazenando o Mnemônico com Segurança</h4>
<div class="paragraph data-line-143">
<p>A Alice precisa ter o cuidado de armazenar a frase mnemônica de uma forma que equilibre a necessidade de evitar roubos com a necessidade de evitar a perda acidental. Se ela não a proteger o suficiente, sua frase mnemônica corre o risco de ser roubada. Se ela a proteger demais, sua frase mnemônica correrá o risco de ser perdida para sempre. A maneira recomendada de equilibrar adequadamente esses riscos é anotar com caneta e papel duas cópias da frase mnemônica, em dois papéis diferentes, com cada uma das palavras sendo numerada, pois a ordem das palavras importa.</p>
</div>
<div class="paragraph data-line-145">
<p>Depois de a Alice anotar a sua frase mnemônica, ela deve escolher um lugar seguro separado para armazenar cada uma das duas cópias, como uma gaveta trancada ou um cofre à prova de incêndios.</p>
</div>
<div class="admonitionblock warning data-line-148">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-149">
<p>Nunca tente inventar um esquema de segurança "por conta própria" que desvie de alguma forma das recomendações de melhores práticas descritas anteriormente. Não corte o papel do seu mnemônico pela metade, não faça capturas de tela, não armazene seu mnemônico em pendrives/drives de USB, em um e-mail ou na nuvem,  não criptografe-o e não tente fazer qualquer outro método que não seja o padrão. Você perderá o equilíbrio entre os riscos de perda permanente ou roubo. Muitas pessoas já perderam fundos, não por roubo, mas porque tentaram uma solução fora do padrão sem ter a experiência para equilibrar os riscos envolvidos. As recomendações de melhores práticas são cuidadosamente equilibradas por especialistas e são adequadas para a grande maioria dos usuários.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sidebarblock data-line-151">
<div class="content">
<div id="bluewallet-welcome" class="imageblock data-line-154">
<div class="content">
<img src="images/mbc2_0101.png" alt="BluewalletWelcome">
</div>
<div class="title">Figure 1. Alice uses the Receive screen on her Bluewallet mobile Bitcoin wallet, and displays her address to Bob in a QR code format</div>
</div>
<div class="paragraph data-line-156">
<p>A página principal da carteira exibe o saldo de bitcoins, o histórico de transações e os botões <em>Receber</em> e <em>Enviar</em>. Além disso, muitas carteiras apresentam uma funcionalidade que permite comprar bitcoin diretamente por meio de uma corretora ou um serviço semelhante, onde você pode usar a sua moeda fiduciária para trocar por criptomoedas, pagando o preço atual do bitcoin. O botão <em>Comprar Bitcoin</em> permitiria a Alice comprar bitcoin dessa maneira.</p>
</div>
<div class="paragraph data-line-158">
<p>Alice is now ready to start using her new bitcoin wallet.  Her wallet application randomly generated a private key (described in more detail in <a href="#private_keys">[private_keys]</a>) which will be used to derive Bitcoin addresses that direct to her wallet. At this point, her Bitcoin addresses are not known to the Bitcoin network or "registered" with any part of the Bitcoin system. Her Bitcoin addresses are simply random numbers that correspond to her private key that she can use to control access to the funds. The addresses are generated independently by her wallet without reference or registration with any service. In fact, in most wallets, there is no association between a Bitcoin address and any externally identifiable information including the user&#8217;s identity. Until the moment an address is referenced as the recipient of value in a transaction posted on the bitcoin ledger, the Bitcoin address is simply part of the vast number of possible addresses that are valid in bitcoin. Only once an address has been associated with a transaction does it become part of the known addresses in the network.</p>
</div>
<div class="paragraph data-line-160">
<p>Alice uses the <em>Receive</em> button, which displays a QR code along with a Bitcoin address. The QR code is the square with a pattern of black and white dots, serving as a form of barcode that contains the same information in a format that can be scanned by Joe&#8217;s smartphone camera. Next to the wallet&#8217;s QR code is the Bitcoin address it encodes, and Alice may choose to manually send her address to Joe by copying it onto her clipboard with a tap. Of note, when receiving funds to a new mobile wallet for the first time, many wallets will often re-verify that you have indeed secured your mnemonic phrase. This can range from a simple prompt to requiring the user to manually re-enter the phrase.</p>
</div>
<div class="admonitionblock tip data-line-163">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-164">
<p>Bitcoin addresses start with 1, 3, or bc1. Like email addresses, they can be shared with other bitcoin users who can use them to send bitcoin directly to your wallet. There is nothing sensitive, from a security perspective, about the Bitcoin address. It can be posted anywhere without risking the security of the account. Unlike email addresses, you can create new addresses as often as you like, all of which will direct funds to your wallet. In fact, many modern wallets automatically create a new address for every transaction to maximize privacy. A wallet is simply a collection of addresses and the keys that unlock the funds within.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="getting_first_bitcoin" class="paragraph data-line-169">
<p>==== Obtendo o seu Primeiro Bitcoin</p>
</div>
<div class="paragraph data-line-171">
<p>A Alice pode adquirir bitcoin de várias maneiras:</p>
</div>
<div class="ulist data-line-173">
<ul>
<li class="data-line-173">
<p>Ela pode trocar um pouco de sua moeda nacional (por exemplo, BRL) em uma corretora (exchange) de criptomoedas</p>
</li>
<li class="data-line-174">
<p>Ela pode comprar de um amigo, ou de um conhecido em um encontro de usuários de bitcoin (Meetup de Bitcoin), em troca de dinheiro em espécie</p>
</li>
<li class="data-line-175">
<p>Ela pode encontrar um caixa eletrônico (ATM) de bitcoin na cidade onde ela mora, que funciona como uma máquina de vendas automática, vendendo bitcoin por dinheiro em espécie</p>
</li>
<li class="data-line-176">
<p>Ela pode oferecer suas habilidades ou um produto que ela vende e aceitar o pagamento em bitcoin</p>
</li>
<li class="data-line-177">
<p>Ela pode pedir a seu empregador ou clientes que paguem em bitcoin</p>
</li>
</ul>
</div>
<div class="paragraph data-line-179">
<p>Todos esses métodos têm diferentes graus de dificuldade e muitos envolvem o pagamento de uma taxa. Algumas instituições financeiras também exigirão que a Alice forneça documentos de identificação para cumprir os regulamentos bancários locais/práticas de prevenção à lavagem de dinheiro (PLD) (em inglês, anti-money laundering ou AML), um processo que é conhecido como KYC (do inglês, <em>Know Your Customer</em>, ou Conheça o seu Cliente). Contudo, com todos esses métodos à disposição, a Alice conseguirá receber seus primeiros bitcoins.</p>
</div>
<div class="admonitionblock tip data-line-182">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-183">
<p>One of the advantages of bitcoin over other payment systems is that, when used correctly, it affords users much more privacy. Acquiring, holding, and spending bitcoin does not require you to divulge sensitive and personally identifiable information to third parties. However, where bitcoin touches traditional systems, such as currency exchanges, national and international regulations often apply. In order to exchange bitcoin for your national currency, you will often be required to provide proof of identity and banking information. Users should be aware that once a Bitcoin address is attached to an identity, all associated bitcoin transactions are also easy to identify and track. This is one reason many users choose to maintain dedicated exchange accounts unlinked to their wallets.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-186">
<p>A Alice foi apresentada ao bitcoin por um amigo, então ela tem uma maneira fácil de adquirir o seu primeiro bitcoin. A seguir, veremos como ela faz para comprar bitcoin de seu amigo Joe e como o Joe faz para enviar o bitcoin para a carteira dela.</p>
</div>
<div id="bitcoin_price" class="paragraph data-line-189">
<p>==== Encontrando o Preço Atual do Bitcoin</p>
</div>
<div class="paragraph data-line-191">
<p>Antes que a Alice possa comprar bitcoin do Joe, eles precisam concordar com a <em>taxa de câmbio</em> entre o bitcoin e o dólar americano. Isso levanta uma pergunta comum para aqueles que são novatos no bitcoin: "Quem define o preço do bitcoin?" A resposta curta é que o preço é definido pelos mercados.</p>
</div>
<div class="paragraph data-line-193">
<p>O bitcoin, assim como a maioria das outras moedas, tem uma <em>taxa de câmbio flutuante</em>. Isso significa que o valor do bitcoin em relação a qualquer outra moeda flutua de acordo com a oferta e a demanda nos vários mercados onde é negociado. Por exemplo, o "preço" do bitcoin em dólares americanos é calculado em cada mercado com base na negociação mais recente que envolveu a troca de bitcoins por dólares americanos ou vice-versa. Como tal, o preço tende a flutuar várias vezes por segundo. Um serviço de preços agregará os preços de vários mercados e calculará uma média ponderada por volume de transações, que representa a taxa de câmbio do mercado amplo de um par de moedas (por exemplo, BTC/USD).</p>
</div>
<div class="paragraph data-line-195">
<p>Existem centenas de aplicativos e sites que fornecem o preço atual do mercado. Aqui estão alguns dos mais populares:</p>
</div>
<div class="dlist data-line-197">
<dl>
<dt class="hdlist1"><a href="https://bitcoinaverage.com/" data-href="https://bitcoinaverage.com/">Bitcoin Average</a></dt>
<dd>
<p>Um site que fornece uma visão simples da média ponderada por volume de cada moeda.</p>
</dd>
<dt class="hdlist1"><a href="https://coincap.io/" data-href="https://coincap.io/">CoinCap</a></dt>
<dd>
<p>Um serviço listando a capitalização de mercado e as taxas de câmbio de centenas de criptomoedas, incluindo o bitcoin.</p>
</dd>
<dt class="hdlist1"><a href="https://bit.ly/cmebrr" data-href="https://bit.ly/cmebrr">Taxa de Referência do Bitcoin da Bolsa de Mercadorias de Chicago</a></dt>
<dd>
<p>Uma taxa de referência que pode ser usada para referência institucional e contratual, fornecida como parte dos feeds de dados de investimento da Bolsa de Mercadorias de Chicago (CME).</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-201">
<p>Além desses diversos sites e aplicativos, a maioria das carteiras de bitcoin converterá automaticamente valores entre bitcoin e outras moedas. O Joe usará sua carteira para converter o preço automaticamente antes de enviar bitcoins para a Alice.</p>
</div>
<div id="sending_receiving" class="paragraph data-line-204">
<p>==== Enviando e Recebendo Bitcoin</p>
</div>
<div class="paragraph data-line-206">
<p>Alice has decided to exchange $10 US dollars for bitcoin, so as not to risk too much money on this new technology. She gives Joe $10 in cash, opens her Bluewallet mobile wallet application, and selects Receive. This displays a QR code with Alice&#8217;s first Bitcoin address.</p>
</div>
<div class="paragraph data-line-208">
<p>O Joe então seleciona Enviar na carteira Bluewallet do seu smartphone, que passa a exibir uma tela contendo os seguintes campos:</p>
</div>
<div class="ulist data-line-210">
<ul>
<li class="data-line-210">
<p>A quantia a ser enviada, em bitcoin (BTC) ou em sua moeda local (USD)</p>
</li>
<li class="data-line-211">
<p>A destination Bitcoin address</p>
</li>
<li class="data-line-212">
<p>Uma nota (descrição) para a transação</p>
</li>
<li class="data-line-213">
<p>Uma taxa de transação</p>
</li>
</ul>
</div>
<div class="paragraph data-line-215">
<p>In the input field for the Bitcoin address, there is a small <em>Scan</em> button. This allows Joe to scan the QR code with his smartphone camera so that he doesn&#8217;t have to type in Alice&#8217;s Bitcoin address, which is quite long and difficult to type. Joe taps the <em>Scan</em> button and it activates the smartphone camera, scanning the QR code displayed on Alice&#8217;s smartphone.</p>
</div>
<div class="paragraph data-line-217">
<p>Joe now has Alice&#8217;s Bitcoin address set as the recipient. Joe enters the amount as $10 US dollars and his wallet converts it by accessing the most recent exchange rate from an online service. The exchange rate at the time is $100 US dollars per bitcoin, so $10 US dollars is worth 0.10 bitcoin (BTC), or 100 millibitcoin (mBTC) as shown in the screenshot from Joe&#8217;s wallet (see <a href="#bluewallet-mobile-send">Tela de envio da carteira de bitcoin móvel Bluewallet</a>).</p>
</div>
<div class="paragraph data-line-219">
<p>No campo nota/descrição da transação, Joe digita "Alice". Ele pode usar este campo para adicionar algumas informações sobre sua transação, que possam ser consultadas no futuro. Esta função serve apenas para que Joe possa manter um controle de suas transações já realizadas. A nota/descrição da transação será armazenada na carteira de seu celular e apenas Joe poderá vê-la. Ela não será enviada para Alice, nem armazenada na blockchain.</p>
</div>
<div class="paragraph data-line-221">
<p>Ele também seleciona uma taxa de transação para sua transação. Quanto maior a taxa de transação, mais rápido sua transação será confirmada (incluída em um bloco por um minerador). Ele seleciona a taxa de transação mínima possível naquele momento (0 satoshis / byte).</p>
</div>
<div class="admonitionblock tip data-line-224">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-225">
<p>O preço do bitcoin mudou muito nos últimos anos, sofrendo uma incrível valorização desde que a primeira edição deste livro foi escrita. Em março de 2021, uma pessoa precisaria de aproximadamente 54 mil dólares para comprar um bitcoin inteiro. Muitos exemplos neste livro fazem referência a transações que realmente ocorreram no passado, quando o preço do bitcoin era muito mais baixo e ainda era possível realizar transações com taxa zero. Imagine que amigo generoso Joe seria, caso ele tivesse feito o mesmo acordo com a Alice hoje!</p>
</div>
</td>
</tr>
</table>
</div>
<div id="bluewallet-mobile-send" class="imageblock smallereighty data-line-231">
<div class="content">
<img src="images/mbc2_0102.png" alt="bluewallet mobile send screen">
</div>
<div class="title">Figure 2. Tela de envio da carteira de bitcoin móvel Bluewallet</div>
</div>
<div class="paragraph data-line-233">
<p>Using Bluewallet, Joe carefully checks to make sure he has entered the correct amount, because he is about to transmit money and mistakes are irreversible. For simplicity sake, we will assume that Joe does not pay any transaction fees. The purpose and setting of transaction fees are covered in subsequent chapters.  After double-checking the address and amount, he presses <em>Send</em> to transmit the transaction. Joe&#8217;s mobile bitcoin wallet constructs a transaction that assigns 0.10 BTC to the address provided by Alice, sourcing the funds from Joe&#8217;s wallet and signing the transaction with Joe&#8217;s private keys. This tells the Bitcoin network that Joe has authorized a transfer of value to Alice&#8217;s new address. As the transaction is transmitted via the peer-to-peer protocol, it quickly propagates across the Bitcoin network. In less than a second, most of the well-connected nodes in the network receive the transaction and see Alice&#8217;s address for the first time.</p>
</div>
<div class="paragraph data-line-235">
<p>Meanwhile, Alice&#8217;s wallet is constantly "listening" to published transactions on the Bitcoin network, looking for any that match the addresses it contains. A few seconds after Joe&#8217;s wallet transmits the transaction, Alice&#8217;s wallet will indicate that it is receiving 0.10 BTC.</p>
</div>
<div class="admonitionblock tip data-line-238">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-239">
<p>Cada bitcoin pode ser subdividido em 100 milhões de unidades, cada uma chamada de "satoshi" (no singular) ou "satoshis" (no plural). Batizado em homenagem ao criador do bitcoin, o Satoshi é a menor unidade de bitcoin, equivalente a 0,00000001 BTC.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="confirmações" class="paragraph data-line-244">
<div class="title">Confirmações</div>
<p>  ("confirmações", consulte = "também mineração e consenso; transações" )  A princípio, a carteira de Alice mostrará a transação de Joe como "Não confirmada". Isso significa que a transação foi propagada para a rede, mas ainda não foi registrada no livro de transações bitcoin, conhecido como blockchain. Para ser confirmada, uma transação deve ser incluída em um bloco e adicionada ao blockchain, o que acontece a cada 10 minutos, em média. Em termos financeiros tradicionais, isso é conhecido como <em>clearing</em>. Este livro cobrirá em detalhes a propagação, validação e compensação (ou confirmação) de transações bitcoin.</p>
</div>
<div class="paragraph data-line-246">
<p>A Alice agora é a orgulhosa dona de 0,10 BTC que ela pode gastar. No próximo capítulo, observaremos sua primeira compra com bitcoin e examinaremos em maiores detalhes as tecnologias de transação e propagação envolvidas.</p>
</div>
<div id="ch02_bitcoin_overview" class="paragraph data-line-249">
<p>== Como Funciona o Bitcoin</p>
</div>
<div class="paragraph data-line-251">
<p>=== Transações, Blocos, Mineração e a Blockchain</p>
</div>
<div class="paragraph data-line-253">
<p>The Bitcoin system, unlike traditional banking and payment systems, is based on decentralized trust. Instead of a central trusted authority, in bitcoin, trust is achieved as an emergent property from the interactions of different participants in the Bitcoin system. In this chapter, we will examine bitcoin from a high level by tracking a single transaction through the Bitcoin system and watch as it becomes "trusted" and accepted by the bitcoin mechanism of distributed consensus and is finally recorded on the blockchain, the distributed ledger of all transactions. Subsequent chapters will delve into the technology behind transactions, the network, and mining.</p>
</div>
<div class="paragraph data-line-255">
<p>==== Visão Geral do Bitcoin</p>
</div>
<div class="paragraph data-line-257">
<p>In the overview diagram shown in <a href="#bitcoin-overview">Visão Geral do Bitcoin</a>, we see that the Bitcoin system consists of users with wallets containing keys, transactions that are propagated across the network, and miners who produce (through competitive computation) the consensus blockchain, which is the authoritative ledger of all transactions.</p>
</div>
<div class="paragraph data-line-260">
<p>Each example in this chapter is based on an actual transaction made on the Bitcoin network, simulating the interactions between the users (Joe, Alice, Bob, and Gopesh) by sending funds from one wallet to another. While tracking a transaction through the Bitcoin network to the blockchain, we will use a <em>blockchain explorer</em> site to visualize each step. A blockchain explorer is a web application that operates as a bitcoin search engine, in that it allows you to search for addresses, transactions, and blocks and see the relationships and flows between them.</p>
</div>
<div id="bitcoin-overview" class="imageblock data-line-264">
<div class="content">
<img src="images/mbc2_0201.png" alt="Bitcoin Overview">
</div>
<div class="title">Figure 3. Visão Geral do Bitcoin</div>
</div>
<div class="paragraph data-line-266">
<p>    Exploradores de blockchain populares incluem:</p>
</div>
<div class="ulist data-line-268">
<ul>
<li class="data-line-268">
<p><a href="https://live.blockcypher.com" data-href="https://live.blockcypher.com">BlockCypher Explorer</a></p>
</li>
<li class="data-line-269">
<p><a href="https://blockchain.com" data-href="https://blockchain.com">Blockchain.com</a></p>
</li>
<li class="data-line-270">
<p><a href="https://insight.bitpay.com" data-href="https://insight.bitpay.com">BitPay Insight</a></p>
</li>
<li class="data-line-271">
<p><a href="https://blockstream.info" data-href="https://blockstream.info">Blockstream Explorer</a></p>
</li>
</ul>
</div>
<div class="paragraph data-line-273">
<p>Each of these has a search function that can take a Bitcoin address, transaction hash, block number, or block hash and retrieve corresponding information from the Bitcoin network. With each transaction or block example, we will provide a URL so you can look it up yourself and study it in detail.</p>
</div>
<div id="cup_of_coffee" class="paragraph data-line-277">
<p>==== Comprando uma Xícara de Café</p>
</div>
<div class="paragraph data-line-279">
<p>A Alice, apresentada no capítulo anterior, é uma nova usuária que acabou de adquirir seu primeiro bitcoin. Em <a href="#getting_first_bitcoin">[getting_first_bitcoin]</a>, Alice se encontrou com seu amigo Joe para trocar dinheiro em espécie por bitcoin. A transação criada pelo Joe transferiu 0,10 BTC para a carteira da Alice. Agora a Alice fará sua primeira transação em uma loja, comprando uma xícara de café na cafeteria do Bob em Palo Alto, na Califórnia.</p>
</div>
<div class="paragraph data-line-281">
<p>A Cafeteria do Bob recentemente começou a aceitar pagamentos em bitcoin adicionando uma opção de bitcoin em seu sistema de ponto de venda. Os preços na Cafeteria do Bob são listados na moeda local (dólares americanos), mas, no caixa, os clientes têm a opção de pagar em dólares ou bitcoin. A Alice faz o pedido de uma xícara de café e o Bob o registra no caixa, como faz para todas as transações. O sistema do ponto de venda converte automaticamente o preço total de dólares americanos para bitcoin de acordo com a cotação atual no mercado e, a seguir, exibe o preço em ambas as moedas:</p>
</div>
<div class="listingblock data-line-283">
<div class="content">
<pre>Total:
$1,50 USD
0,015 BTC</pre>
</div>
</div>
<div class="paragraph data-line-290">
<p>Bob diz: "A conta deu 1,50 dólares, ou 15 milibits."</p>
</div>
<div class="paragraph data-line-292">
<p>O sistema de ponto de venda do Bob também criará automaticamente um código QR contendo uma <em>solicitação de pagamento</em> (ver a <a href="#payment-request-QR">Código QR da solicitação de pagamento</a>).</p>
</div>
<div class="paragraph data-line-294">
<p>Unlike a QR code that simply contains a destination Bitcoin address, a payment request is a QR-encoded URL that contains a destination address, a payment amount, and a generic description such as "Bob&#8217;s Cafe." This allows a bitcoin wallet application to prefill the information used to send the payment while showing a human-readable description to the user. You can scan the QR code with a bitcoin wallet application to see what Alice would see.</p>
</div>
<div id="payment-request-QR" class="imageblock data-line-299">
<div class="content">
<img src="images/mbc2_0202.png" alt="payment-request">
</div>
<div class="title">Figure 4. Código QR da solicitação de pagamento</div>
</div>
<div class="admonitionblock tip data-line-302">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-303">
<p>Tente escanear esse código QR com a sua carteira para ver o endereço e a quantia, mas NÃO ENVIE DINHEIRO para esse endereço.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="payment-request-URL" class="listingblock data-line-307">
<div class="title">O código QR da solicitação de pagamento codifica a seguinte URL, definida na BIP-21:</div>
<div class="content">
<pre>bitcoin:1GdK9UzpHBzqzX2A9JFP3Di4weBwqgmoQA?
amount=0.015&amp;
label=Bob%27s%20Cafe&amp;
message=Purchase%20at%20Bob%27s%20Cafe

Componentes da URL

A Bitcoin address: "1GdK9UzpHBzqzX2A9JFP3Di4weBwqgmoQA"
Valor do pagamento (amount): "0.015" (“0,015 BTC”)
Um rótulo para o endereço do destinatário (label): "Bob's Cafe" (“Cafeteria do Bob”)
Uma descrição para o pagamento (message): "Purchase at Bob's Cafe" (“Compra na Cafeteria do Bob”)</pre>
</div>
</div>
<div class="paragraph data-line-321">
<p>A Alice então usa o smartphone dela para escanear o código de barras sendo exibido na tela do Bob. Seu smartphone mostra um pagamento de 0,0150 BTC para a Cafeteria do Bob e ela toca no botão Enviar para autorizar o pagamento. Após alguns segundos (aproximadamente o mesmo tempo necessário para uma autorização de cartão de crédito), Bob vê a transação no caixa, completando a transação.</p>
</div>
<div class="paragraph data-line-323">
<p>Nas seções a seguir, examinaremos essa transação em maiores detalhes. Veremos como a carteira da Alice a construiu, como ela foi propagada pela rede, como foi verificada e, finalmente, como o Bob pode gastar essa quantia recebida em transações futuras.</p>
</div>
<div class="admonitionblock note data-line-326">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-327">
<p>The Bitcoin network can transact in fractional values, e.g., from millibitcoin (1/1000th of a bitcoin) down to 1/100,000,000th of a bitcoin, which is known as a satoshi.  Throughout this book, we’ll use the term “bitcoin” to refer to any quantity of bitcoin currency, from the smallest unit (1 satoshi) to the total number (21,000,000) of all bitcoin that will ever be mined.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-330">
<p>Você pode examinar a transação da Alice para o Cafeteria do Bob na blockchain usando um site explorador de blocos (ver <a href="#view_alice_transaction">Veja a transação de Alice em https://www.blockchain.com/btc/tx/0627052b6f28912f2703066a912ea577f2ce4da4caa5a5f thirtya57286c345c2f2[blockchain.com]</a>):</p>
</div>
<div id="view_alice_transaction" class="exampleblock data-line-334">
<div class="title">Example 1. Veja a transação de Alice em <a href="https://www.blockchain.com/btc/tx/0627052b6f28912f2703066a912ea577f2ce4da4caa5a5f" class="undefined" data-href="https://www.blockchain.com/btc/tx/0627052b6f28912f2703066a912ea577f2ce4da4caa5a5f">https://www.blockchain.com/btc/tx/0627052b6f28912f2703066a912ea577f2ce4da4caa5a5f</a> thirtya57286c345c2f2[blockchain.com]</div>
<div class="content">
<div class="listingblock data-line-335">
<div class="content">
<pre>https://www.blockchain.com/btc/tx/0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2</pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-340">
<p>=== Transações de Bitcoin</p>
</div>
<div class="paragraph data-line-342">
<p>Em termos simples, uma transação informa para a rede que o dono de uma quantidade de bitcoins autorizou a transferência de alguns destes bitcoins para outro dono. O novo dono agora pode gastar esses bitcoins ao criar uma nova transação que autoriza a transferência para um outro dono, e assim por diante, em uma cadeia de posse de bitcoins.</p>
</div>
<div class="paragraph data-line-344">
<p>==== Entradas e Saídas de Transação</p>
</div>
<div class="paragraph data-line-346">
<p>As transações são como linhas em um livro de contabilidade de dupla entrada. Cada transação contém uma ou mais "entradas" (em inglês, <em>inputs</em>), que são como débitos em uma conta de bitcoin. Do outro lado da transação, há uma ou mais "saídas" (em inglês, <em>outputs</em>), que são como créditos adicionados a uma conta de bitcoin. As entradas e as saídas (os débitos e os créditos) não necessariamente somam o mesmo valor. Na verdade, as saídas somam um pouco menos do que as entradas, e essa diferença representa uma <em>taxa de transação</em> implícita, que é um pequeno pagamento cobrado pelo minerador que inclui a transação no registro contábil do bitcoin. Uma transação de bitcoin é mostrada como uma entrada em um livro de contabilidade em <a href="#transaction-double-entry">Transação como uma contabilidade de dupla entrada</a>.</p>
</div>
<div class="paragraph data-line-348">
<p>The transaction also contains proof of ownership for each amount of bitcoin (inputs) whose value is being spent, in the form of a digital signature from the owner, which can be independently validated by anyone. In bitcoin terms, "spending" is signing a transaction that transfers value from a previous transaction over to a new owner identified by a Bitcoin address.</p>
</div>
<div id="transaction-double-entry" class="imageblock data-line-352">
<div class="content">
<img src="images/mbc2_0203.png" alt="Transaction Double-Entry">
</div>
<div class="title">Figure 5. Transação como uma contabilidade de dupla entrada</div>
</div>
<div class="paragraph data-line-354">
<p>==== Cadeias de Transações</p>
</div>
<div class="paragraph data-line-356">
<p>Alice&#8217;s payment to Bob&#8217;s Cafe uses a previous transaction&#8217;s output as its input. In the previous chapter, Alice received bitcoin from her friend Joe in return for cash. That transaction created a bitcoin value locked by Alice&#8217;s key. Her new transaction to Bob&#8217;s Cafe references the previous transaction as an input and creates new outputs to pay for the cup of coffee and receive change. The transactions form a chain, where the inputs from the latest transaction correspond to outputs from previous transactions. Alice&#8217;s key provides the signature that unlocks those previous transaction outputs, thereby proving to the Bitcoin network that she owns the funds. She attaches the payment for coffee to Bob&#8217;s address, thereby "encumbering" that output with the requirement that Bob produces a signature in order to spend that amount. This represents a transfer of value between Alice and Bob. This chain of transactions, from Joe to Alice to Bob, is illustrated in <a href="#blockchain-mnemonic">Uma cadeia de transações, onde a saída de uma transação é a entrada da próxima transação</a>.</p>
</div>
<div id="blockchain-mnemonic" class="imageblock data-line-360">
<div class="content">
<img src="images/mbc2_0204.png" alt="Transaction chain">
</div>
<div class="title">Figure 6. Uma cadeia de transações, onde a saída de uma transação é a entrada da próxima transação</div>
</div>
<div class="paragraph data-line-362">
<p>==== Criando o Troco</p>
</div>
<div class="paragraph data-line-364">
<p>Muitas transações de bitcoin incluirão saídas que fazem referência a um endereço do novo proprietário (quem recebe) e um endereço do proprietário atual (quem paga), chamado de endereço de <em>troco</em>. Isso ocorre porque as entradas de transação, assim como cédulas de uma moeda, não podem ser divididas. Se você compra um item de $5 dólares em uma loja, mas paga com uma nota de $20 dólares, você espera receber $15 dólares em troco. O mesmo conceito se aplica às entradas das transações do bitcoin. Se você comprasse um item que custa 5 bitcoins, mas só tivesse uma entrada de 20 bitcoins para usar, a sua carteira criaria uma transação única que enviaria duas saídas, uma saída de 5 bitcoins para o dono da loja e uma saída de 15 bitcoins de volta para você mesmo como troco (menos a taxa da transação). É importante ressaltar que o endereço de troco não precisa ser o mesmo endereço da entrada e, por motivos de privacidade, costuma ser um novo endereço da carteira do proprietário.</p>
</div>
<div class="paragraph data-line-366">
<p>Carteiras diferentes podem usar estratégias diferentes ao agregar entradas para fazer um pagamento solicitado pelo usuário. Elas podem usar diversas entradas pequenas juntas ou usar uma única entrada que seja maior ou igual ao valor de pagamento desejado. A menos que a carteira consiga agregar algumas entradas de forma que a soma delas corresponda exatamente ao valor de pagamento desejado somado à taxa da transação, a carteira precisará gerar um troco. Isso é muito semelhante ao modo como as pessoas lidam com o dinheiro em espécie. Se você sempre usar a nota de maior valor na sua carteira, a sua carteira ficará sempre cheia de moedas. Se você usar apenas as moedas que recebeu como troco, a sua carteira terá apenas notas de maior valor. As pessoas inconscientemente encontram um equilíbrio entre esses dois extremos, e os desenvolvedores de carteiras de bitcoin se esforçam para programar esse equilíbrio.</p>
</div>
<div class="paragraph data-line-368">
<p>In summary, <em>transactions</em> move value from <em>transaction inputs</em> to <em>transaction outputs</em>. An input is a reference to a previous transaction&#8217;s output, showing where the value is coming from. A transaction usually includes an output that directs a specific value to a new owner&#8217;s Bitcoin address and a change output back to the original owner. Outputs from one transaction can be used as inputs in a new transaction, thus creating a chain of ownership as the value is moved from owner to owner (see <a href="#blockchain-mnemonic">Uma cadeia de transações, onde a saída de uma transação é a entrada da próxima transação</a>).</p>
</div>
<div class="paragraph data-line-370">
<p>==== Formas Comuns de Transação</p>
</div>
<div class="paragraph data-line-372">
<p>A forma mais comum de transação é um pagamento simples de um endereço para outro, que geralmente inclui algum "troco" devolvido ao proprietário original. Este tipo de transação tem uma entrada e duas saídas, e é mostrado na <a href="#transaction-common">A forma mais comum de transação</a>.</p>
</div>
<div id="transaction-common" class="imageblock data-line-376">
<div class="content">
<img src="images/mbc2_0205.png" alt="Common Transaction">
</div>
<div class="title">Figure 7. A forma mais comum de transação</div>
</div>
<div class="paragraph data-line-378">
<p>Outra forma comum de transação é uma que agrega múltiplas entradas em uma única saída (ver <a href="#transaction-aggregating">Transação agregadora de fundos</a>). Isso seria o equivalente, na vida real, a trocar uma pilha de moedas e notas por uma nota de valor maior. As transações deste tipo às vezes são geradas pelos aplicativos de carteira com o objetivo de limpar vários valores pequenos que foram recebidos como troco em pagamentos anteriores.</p>
</div>
<div id="transaction-aggregating" class="imageblock data-line-382">
<div class="content">
<img src="images/mbc2_0206.png" alt="Aggregating Transaction">
</div>
<div class="title">Figure 8. Transação agregadora de fundos</div>
</div>
<div class="paragraph data-line-384">
<p>Finalmente, outra forma de transação frequentemente observada no livro-razão do bitcoin é uma transação em lote, que distribui uma única entrada para várias saídas, que representam vários destinatários, uma técnica conhecida como "agrupamento de transações", em inglês, "<em>transaction batching</em>" (ver <a href="#transaction-distributing">Transação distribuidora de fundos</a>). Como este tipo de transação é útil para economizar com taxas de transação, ele é comumente usado por entidades comerciais para distribuir fundos, como, por exemplo, quando uma empresa processa as folhas de pagamento para múltiplos funcionários, ou quando uma exchange de bitcoin processa os saques de múltiplos clientes em uma única transação.</p>
</div>
<div id="transaction-distributing" class="imageblock data-line-388">
<div class="content">
<img src="images/mbc2_0207.png" alt="Distributing Transaction">
</div>
<div class="title">Figure 9. Transação distribuidora de fundos</div>
</div>
<div class="paragraph data-line-390">
<p>=== Construindo uma Transação</p>
</div>
<div class="paragraph data-line-392">
<p>Alice&#8217;s wallet application contains all the logic for selecting appropriate inputs and outputs to build a transaction to Alice&#8217;s specification. Alice only needs to specify a destination and an amount, and the rest happens in the wallet application without her seeing the details. Importantly, a wallet application can construct transactions even if it is completely offline. Like writing a check at home and later sending it to the bank in an envelope, the transaction does not need to be constructed and signed while connected to the Bitcoin network.</p>
</div>
<div class="paragraph data-line-394">
<p>==== Obtendo as Entradas Certas</p>
</div>
<div class="paragraph data-line-396">
<p>O aplicativo de carteira da Alice terá primeiro que encontrar entradas que somem um valor suficiente para pagar a quantia que ela deseja enviar ao Bob. A maioria das carteiras mantém um registro de todas as saídas disponíveis pertencentes aos endereços na carteira. Portanto, a carteira da Alice contém uma cópia da saída da transação do Joe, que foi criada em troca pelo dinheiro em espécie (ver "&lt;getting_first_bitcoin&gt;"). Um aplicativo de carteira de bitcoin que é executado como um cliente de nó completo contém uma cópia de todas as saídas não gastas de todas as transações registradas na blockchain. Isso permite que uma carteira construa entradas de transação, bem como verifique rapidamente as transações que ela recebe, verificando se elas têm entradas corretas. No entanto, como um cliente de nó completo ocupa muito espaço em disco, a maioria das carteiras de usuários executa clientes "leves", que mantêm um registro apenas das saídas não gastas do próprio usuário.</p>
</div>
<div class="paragraph data-line-398">
<p>If the wallet application does not maintain a copy of unspent transaction outputs, it can query the Bitcoin network to retrieve this information using a variety of APIs available by different providers or by asking a full-node using an application programming interface (API) call. <a href="#example_2-2">Look up all the unspent outputs for Alice&#8217;s Bitcoin address</a> shows an API request, constructed as an HTTP GET command to a specific URL. This URL will return all the unspent transaction outputs for an address, giving any application the information it needs to construct transaction inputs for spending. We use the simple command-line HTTP client <em>cURL</em> to retrieve the response.</p>
</div>
<div id="example_2-2" class="exampleblock data-line-402">
<div class="title">Example 2. Look up all the unspent outputs for Alice&#8217;s Bitcoin address</div>
<div class="content">
<div class="listingblock data-line-404">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ curl https://blockchain.info/unspent?active=1Cdid9KFAaatwczBwBttQcwXYCpvK8h7FK</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock data-line-410">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{

	"unspent_outputs":[

		{
			"tx_hash":"186f9f998a5...2836dd734d2804fe65fa35779",
			"tx_index":104810202,
			"tx_output_n": 0,
			"script":"76a9147f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a888ac",
			"value": 10000000,
			"value_hex": "00989680",
			"confirmations":0
		}

	]
}</code></pre>
</div>
</div>
<div class="paragraph data-line-430">
<p>A resposta no <a href="#example_2-2">Look up all the unspent outputs for Alice&#8217;s Bitcoin address</a> mostra uma saída não gasta (uma que ainda não foi resgatada) sob a posse do endereço 1Cdid9KFAaatwczBwBttQcwXYCpvK8h7FK da Alice. A resposta inclui uma referência à transação na qual esse valor não gasto está contido (o pagamento do Joe) e seu valor em satoshis, 10 milhões, equivalente a 0,10 bitcoin. Com essa informação, o aplicativo de carteira da Alice pode construir uma transação para transferir esse valor para endereços de novos proprietários.</p>
</div>
<div class="admonitionblock tip data-line-433">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-434">
<p>Veja a <a href="https://www.blockchain.com/btc/tx/7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18" data-href="https://www.blockchain.com/btc/tx/7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18">transação do Joe para a Alice</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-437">
<p>Como você pode ver, a carteira da Alice contém em uma única saída não gasta uma quantidade de bitcoins suficiente para pagar a xícara de café. Caso não contivesse, o aplicativo de carteira da Alice teria que "vasculhar" várias outras saídas não gastas de menor valor, como se estivesse procurando moedas em uma carteira até encontrar a quantia suficiente para pagar o café. Em ambos os casos, quando o aplicativo de carteira cria as saídas da transação (os pagamentos), pode haver a necessidade de se receber algum troco de volta, conforme veremos na próxima sessão.</p>
</div>
<div class="paragraph data-line-440">
<p>==== Criando as Saídas</p>
</div>
<div class="paragraph data-line-442">
<p>Uma saída de transação é criada na forma de um script que coloca uma trava no valor, o qual só pode ser resgatado se uma solução for apresentada ao script. Em termos mais simples, a saída da transação da Alice conterá um script que diz algo como: "Esta saída é resgatável por qualquer pessoa que puder apresentar uma assinatura que tenha sido gerada a partir da chave correspondente ao endereço do Bob". Como apenas o Bob possui a carteira com as chaves correspondentes a esse endereço, apenas a carteira do Bob será capaz de apresentar a assinatura que é necessária para resgatar essa saída. Portanto, ao exigir uma assinatura do Bob, a Alice está "travando" o valor da saída para que ele só possa ser gasto pelo Bob.</p>
</div>
<div class="paragraph data-line-444">
<p>Essa transação também incluirá uma segunda saída, pois os fundos da Alice estão contidos em uma única saída de 0,10 BTC, que é dinheiro demais para uma simples xícara de café de 0,015 BTC. A Alice precisará de 0,085 BTC de troco. Para receber o troco, a carteira da Alice cria uma saída de troco na mesma transação que fará o pagamento para o Bob. Essencialmente, a carteira da Alice divide seus fundos em dois pagamentos: um para o Bob e outro de volta para ela mesma. Dessa maneira a Alice pode então usar (gastar) a saída do troco em uma transação no futuro.</p>
</div>
<div class="paragraph data-line-446">
<p>Finalmente, para que a transação seja processada pela rede em tempo hábil, o aplicativo de carteira da Alice adicionará uma pequena taxa. Esta taxa não está explícita na transação, ela está implícita na diferença de valor existente entre as entradas e as saídas. Se, ao invés de criar uma saída de troco de 0,085 BTC, a Alice criar uma saída com apenas 0,0845 BTC, sobrará 0,0005 BTC (meio milibitcoin). A entrada de 0,10 BTC não será totalmente gasta pelas duas saídas, pois elas somam menos de 0,10 BTC. A diferença resultante é a <em>taxa da transação</em>, que é coletada pelo minerador como um pagamento por validar e incluir a transação em um bloco a ser registrado na blockchain.</p>
</div>
<div class="paragraph data-line-448">
<p>A transação resultante pode ser vista usando um aplicativo web explorador de blockchain, como visto na <a href="#transaction-alice">Transação da Alice para a Cafeteria do Bob</a>.</p>
</div>
<div id="transaction-alice" class="imageblock smallerseventyfive data-line-453">
<div class="content">
<img src="images/mbc2_0208.png" alt="Alice Coffee Transaction">
</div>
<div class="title">Figure 10. Transação da Alice para a Cafeteria do Bob</div>
</div>
<div id="transaction-alice-url" class="admonitionblock tip data-line-457">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-458">
<p>Veja a <a href="https://www.blockchain.com/btc/tx/0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2" data-href="https://www.blockchain.com/btc/tx/0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2">transação da Alice para a Cafeteria do Bob</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-461">
<p>==== Adicionando uma Transação ao Registro</p>
</div>
<div class="paragraph data-line-463">
<p>The transaction created by Alice&#8217;s wallet application is 258 bytes long and contains everything necessary to confirm ownership of the funds and assign new owners. Now, the transaction must be transmitted to the Bitcoin network where it will become part of the blockchain. In the next section we will see how a transaction becomes part of a new block and how the block is "mined." Finally, we will see how the new block, once added to the blockchain, is increasingly trusted by the network as more blocks are added.</p>
</div>
<div class="paragraph data-line-465">
<p>===== Transmitindo a transação</p>
</div>
<div class="paragraph data-line-467">
<p>Because the transaction contains all the information necessary to process, it does not matter how or where it is transmitted to the Bitcoin network. The Bitcoin network is a peer-to-peer network, with each Bitcoin client participating by connecting to several other Bitcoin clients. The purpose of the Bitcoin network is to propagate transactions and blocks to all participants.</p>
</div>
<div class="paragraph data-line-469">
<p>===== Como ela se propaga</p>
</div>
<div class="paragraph data-line-471">
<p>Any system, such as a server, desktop application, or wallet, that participates in the Bitcoin network by "speaking" the Bitcoin protocol is called a <em>Bitcoin node</em>. Alice&#8217;s wallet application can send the new transaction to any Bitcoin node it is connected to over any type of connection: wired, WiFi, mobile, etc.  Her bitcoin wallet does not have to be connected to Bob&#8217;s bitcoin wallet directly and she does not have to use the internet connection offered by the cafe, though both those options are possible, too. Any Bitcoin node that receives a valid transaction it has not seen before will immediately forward it to all other nodes to which it is connected, a propagation technique known as <em>flooding</em>. Thus, the transaction rapidly propagates out across the peer-to-peer network, reaching a large percentage of the nodes within a few seconds.</p>
</div>
<div class="paragraph data-line-473">
<p>===== A visão do Bob</p>
</div>
<div class="paragraph data-line-475">
<p>Se o aplicativo de carteira do Bob estiver diretamente conectado ao aplicativo de carteira da Alice, ele pode ser o primeiro nó a receber a transação. Entretanto, mesmo que a carteira da Alice envie a transação através de outros nós, a transação chegará à carteira do Bob dentro de pouco segundos. A carteira do Bob identificará imediatamente a transação da Alice como um pagamento, pois ela contém saídas que são resgatáveis pelas chaves do Bob. A carteira do Bob também pode verificar independentemente que a transação é bem formada, utiliza saídas que ainda não foram gastas e contém uma taxa de transação suficiente para ser incluída no próximo bloco. Neste momento o Bob pode presumir, com um alto grau de probabilidade, que a transação em breve será incluída em um bloco (será confirmada).</p>
</div>
<div class="admonitionblock tip data-line-478">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-479">
<p>Uma ideia erroneamente difundida é a de que para serem "confirmadas", as transações de bitcoin exigem uma espera de 10 minutos por um novo bloco, ou de até 60 minutos por seis confirmações. Embora essas confirmações realmente sejam uma garantia de que a transação foi aceita por toda a rede, não é necessário esperar todo esse tempo para transações envolvendo itens de pequeno valor, como uma xícara de café. Um comerciante pode aceitar uma transação de pequeno valor ainda sem confirmações, correndo um risco semelhante ao que correria ao receber um pagamento com cartão de crédito sem assinatura ou identificação do cliente, algo que é rotineiramente feito pelos comerciantes hoje em dia.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-482">
<p>=== Mineração do Bitcoin</p>
</div>
<div class="paragraph data-line-484">
<p>Alice&#8217;s transaction is now propagated on the Bitcoin network. It does not become part of the <em>blockchain</em> until it is verified and included in a block by a process called <em>mining</em>. See <a href="#mining">[mining]</a> for a detailed explanation.</p>
</div>
<div class="paragraph data-line-486">
<p>The Bitcoin system of trust is based on computation. Transactions are bundled into <em>blocks</em>, which require an enormous amount of computation to prove, but only a small amount of computation to verify as proven. The mining process serves two purposes in bitcoin:</p>
</div>
<div class="ulist data-line-488">
<ul>
<li class="data-line-488">
<p>Os nós de mineração validam todas as transações de acordo com as <em>regras de consenso</em> do bitcoin. Portanto, ao rejeitar transações inválidas ou malformadas, a mineração fornece segurança para as transações do bitcoin.</p>
</li>
<li class="data-line-489">
<p>A mineração cria novos bitcoins em cada bloco, quase como se fosse um banco central imprimindo dinheiro novo. A quantidade de bitcoins criados por bloco é limitada e diminui com o tempo, seguindo um cronograma de emissão fixo.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-492">
<p>A mineração atinge um equilíbrio preciso entre o custo e a recompensa. A mineração usa a eletricidade para resolver um problema matemático. Um minerador bem-sucedido receberá uma <em>recompensa</em> na forma de novos bitcoins e taxas de transação. No entanto, a recompensa só será recolhida se o minerador tiver validado corretamente todas as transações, de acordo com as regras do <em>consenso</em>. Este delicado equilíbrio fornece segurança para o bitcoin, dispensando a necessidade de uma autoridade central.</p>
</div>
<div class="paragraph data-line-494">
<p>Uma boa maneira de descrever a mineração é como um jogo de sudoku gigantesco e competitivo, que reinicia cada vez que alguém encontra uma solução e cuja dificuldade se ajusta automaticamente, de maneira que leve cerca de 10 minutos para que uma solução seja encontrada. Imagine um sudoku gigantesco, com milhares de colunas e linhas. Se eu mostrar para você um sudoku completamente preenchido, você pode verificar rapidamente que ele está corretamente preenchido. No entanto, se o sudoku tiver apenas alguns quadrados preenchidos e o resto estiver vazio, isso exigirá muito trabalho para resolvê-lo! A dificuldade do sudoku pode ser ajustada ao mudar o seu tamanho (mais ou menos linhas ou colunas), mas o sudoku ainda pode ser verificado de maneira rápida, mesmo que ele seja muito grande. O "quebra-cabeças" usado no bitcoin é baseado em um hash criptográfico, que exibe características semelhantes: ele é assimetricamente difícil de resolver, mas fácil de verificar, e sua dificuldade pode ser ajustada.</p>
</div>
<div class="paragraph data-line-496">
<p>In <a href="#user-stories">Usos do Bitcoin, Usuários e Suas Histórias</a>, we introduced Jing, an entrepreneur in Shanghai. Jing runs a <em>mining farm</em>, which is a business that runs thousands of specialized mining computers, competing for the reward. Every 10 minutes or so, Jing&#8217;s mining computers compete against thousands of similar systems in a global race to find a solution to a block of transactions. Finding such a solution, the so-called <em>Proof-of-Work</em> (PoW), requires quadrillions of hashing operations per second across the entire Bitcoin network. The algorithm for Proof-of-Work involves repeatedly hashing the header of the block and a random number with the SHA256 cryptographic algorithm until a solution matching a predetermined pattern emerges. The first miner to find such a solution wins the round of competition and publishes that block into the blockchain.</p>
</div>
<div class="paragraph data-line-498">
<p>Jing started mining in 2010 using a very fast desktop computer to find a suitable Proof-of-Work for new blocks. As more miners started joining the Bitcoin network, the difficulty of the problem increased rapidly. Soon, Jing and other miners upgraded to more specialized hardware, with high-end dedicated graphical processing units (GPUs), often used in gaming desktops or consoles. At the time of this writing, the difficulty is so high that it is profitable only to mine with application-specific integrated circuits (ASIC), essentially hundreds of mining algorithms printed in hardware, running in parallel on a single silicon chip. Jing&#8217;s company also participates in a <em>mining pool</em>, which much like a lottery pool allows several participants to share their efforts and rewards. Jing&#8217;s company now runs a warehouse containing thousands of  ASIC miners to mine for bitcoin 24 hours a day. The company pays its electricity costs by selling the bitcoin it is able to generate from mining, creating some income from the profits.</p>
</div>
<div class="paragraph data-line-500">
<p>=== Minerando Transações em Blocos</p>
</div>
<div class="paragraph data-line-502">
<p>New transactions are constantly flowing into the network from user wallets and other applications. As these are seen by the Bitcoin network nodes, they get added to a temporary pool of unverified transactions maintained by each node. As miners construct a new block, they add unverified transactions from this pool to the new block and then attempt to prove the validity of that new block, with the mining algorithm (Proof-of-Work). The process of mining is explained in detail in <a href="#mining">[mining]</a>.</p>
</div>
<div class="paragraph data-line-504">
<p>Transactions are added to the new block, prioritized by the highest-fee transactions first and a few other criteria. Each miner starts the process of mining a new block of transactions as soon as they receive the previous block from the network, knowing they have lost that previous round of competition. They immediately create a new block, fill it with transactions and the fingerprint of the previous block, and start calculating the Proof-of-Work for the new block. Each miner includes a special transaction in their block, one that pays their own Bitcoin address the block reward (currently 6.25 newly created bitcoin) plus the sum of transaction fees from all the transactions included in the block. If they find a solution that makes that block valid, they "win" this reward because their successful block is added to the global blockchain and the reward transaction they included becomes spendable. Jing, who participates in a mining pool, has set up his software to create new blocks that assign the reward to a pool address. From there, a share of the reward is distributed to Jing and other miners in proportion to the amount of work they contributed in the last round.</p>
</div>
<div class="paragraph data-line-506">
<p>A transação da Alice foi captada pela rede e incluída na <em>pool</em> de transações não verificadas. Depois de validada pelo software de mineração, ela foi incluída em um novo bloco, denominado <em>bloco candidato</em>, gerado pela <em>pool</em> de mineração do Jing. Todos os mineradores que participam dessa <em>pool</em> de mineração começam imediatamente a calcular a Prova-de-Trabalho para o bloco candidato. Aproximadamente cinco minutos depois que a transação foi transmitida pela primeira vez pela carteira da Alice, um dos equipamentos de mineração ASIC do Jing encontrou uma solução para o bloco candidato e a anunciou para a rede. Assim que outros mineradores validaram o bloco vencedor, eles começaram a corrida para gerar o próximo bloco.</p>
</div>
<div class="paragraph data-line-508">
<p>O bloco vencedor do Jing tornou-se parte da <em>blockchain</em> como bloco nº277316, contendo 419 transações, incluindo a transação da Alice. O bloco que contém a transação da Alice é contado como sendo uma "confirmação" dessa transação.</p>
</div>
<div class="admonitionblock tip data-line-511">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-512">
<p>Você pode ver o bloco que inclui <a href="https://www.blockchain.com/btc/block/277316" data-href="https://www.blockchain.com/btc/block/277316">Alice&#39;s transaction</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-515">
<p>Aproximadamente 20 minutos mais tarde, um novo bloco, nº277317, é minerado por outro minerador. Como esse novo bloco foi construído sobre o bloco nº277316 que continha a transação da Alice, ele adicionou ainda mais computação à blockchain, fortalecendo assim a confiança nessas transações. Cada bloco minerado acima do bloco contendo a transação da Alice conta como uma confirmação adicional para a transação da Alice. À medida que os blocos se empilham uns sobre os outros, torna-se exponencialmente mais difícil de se reverter a transação, tornando-a cada vez mais confiável para a rede.</p>
</div>
<div class="paragraph data-line-517">
<p>No diagrama da <a href="#block-alice1">Transação da Alice incluída no bloco nº277316</a>, podemos ver o bloco nº277316, que contém a transação da Alice. Abaixo dele estão 277.316 blocos (incluindo o bloco nº0), ligados uns aos outros em uma cadeia de blocos (<em>blockchain</em>) até chegar ao bloco nº0, também conhecido como <em>bloco gênese</em>. Ao longo do tempo, à medida que a "altura" da pilha de blocos aumenta, também aumenta a dificuldade computacional de cada bloco e da cadeia como um todo. Os blocos minerados após aquele que contém a transação da Alice atuam como garantia adicional, pois acumulam mais computação em uma cadeia cada vez mais longa. Por convenção, qualquer bloco com mais de seis confirmações é considerado irrevogável, pois seria necessária uma quantidade imensa de computação para recalcular seis blocos, e, com isso, invalidá-los. No <a href="#mining">[mining]</a>, examinaremos em maiores detalhes o processo de mineração e a maneira como ele constrói confiança.</p>
</div>
<div id="block-alice1" class="imageblock data-line-521">
<div class="content">
<img src="images/mbc2_0209.png" alt="Alice&#8217;s transaction included in a block">
</div>
<div class="title">Figure 11. Transação da Alice incluída no bloco nº277316</div>
</div>
<div class="paragraph data-line-523">
<p>=== Gastando a Transação</p>
</div>
<div class="paragraph data-line-525">
<p>Now that Alice&#8217;s transaction has been embedded in the blockchain as part of a block, it is part of the distributed ledger of bitcoin and visible to all bitcoin applications. Each Bitcoin client can independently verify the transaction as valid and spendable. Full-node clients can track the source of the funds from the moment the bitcoin were first generated in a block, incrementally from transaction to transaction, until they reach Bob&#8217;s address. Lightweight clients can do what is called a simplified payment verification (see <a href="#spv_nodes">[spv_nodes]</a>) by confirming that the transaction is in the blockchain and has several blocks mined after it, thus providing assurance that the miners accepted it as valid.</p>
</div>
<div class="paragraph data-line-527">
<p>Agora o Bob pode gastar a saída dessa e de outras transações. Por exemplo, o Bob pode pagar um contratante ou fornecedor transferindo o valor do pagamento da xícara de café da Alice. Mais provavelmente, o software de bitcoin do Bob agregará vários pequenos pagamentos em um pagamento maior, talvez concentrando em uma única transação todos os pagamentos em bitcoin que a loja recebeu em um dia. Isso agregaria os vários pagamentos em uma única saída (e um único endereço). Na <a href="#transaction-aggregating">Transação agregadora de fundos</a>, você pode ver um diagrama de uma transação de agregação.</p>
</div>
<div class="paragraph data-line-529">
<p>À medida que o Bob gasta os pagamentos que recebeu da Alice e de outros clientes, ele estende a cadeia de transações. Vamos supor que o Bob tenha feito um pagamento para que seu webdesigner Gopesh em Bangalore desenvolva um novo site. Agora, a cadeia de transações ficará parecida com a exibida na <a href="#block-alice2">A transação da Alice como parte de uma cadeia de transações partindo do Joe até chegar ao Gopesh, onde a saída de uma transação é gasta como a entrada da próxima transação</a>.</p>
</div>
<div id="block-alice2" class="imageblock data-line-533">
<div class="content">
<img src="images/mbc2_0210.png" alt="Alice&#8217;s transaction as part of a transaction chain">
</div>
<div class="title">Figure 12. A transação da Alice como parte de uma cadeia de transações partindo do Joe até chegar ao Gopesh, onde a saída de uma transação é gasta como a entrada da próxima transação</div>
</div>
<div class="paragraph data-line-535">
<p>In this chapter, we saw how transactions build a chain that moves value from owner to owner. We also tracked Alice&#8217;s transaction, from the moment it was created in her wallet, through the Bitcoin network and to the miners who recorded it on the blockchain. In the rest of this book, we will examine the specific technologies behind wallets, addresses, signatures, transactions, the network, and finally mining. </p>
</div>
<div id="ch03_bitcoin_client" class="paragraph data-line-538">
<p>== Bitcoin Core: A Implementação de Referência</p>
</div>
<div class="paragraph data-line-540">
<p>O bitcoin é um projeto de <em>código aberto</em> e o seu código-fonte está disponível sob uma licença aberta (MIT), de download gratuito e que pode ser usada para qualquer finalidade. Ter código aberto significa mais do que simplesmente ser livre para usar. Isso também significa que o bitcoin é desenvolvido por uma comunidade aberta de voluntários. No início, essa comunidade era apenas o Satoshi Nakamoto. Em 2016, o código-fonte do bitcoin já tinha mais de 400 colaboradores, com cerca de uma dúzia de desenvolvedores trabalhando no código quase em tempo integral e dezenas de outros desenvolvedores trabalhando em tempo parcial. Qualquer pessoa pode contribuir com o código&#x2014;incluindo você!</p>
</div>
<div class="paragraph data-line-543">
<p>When bitcoin was created by Satoshi Nakamoto, the software was actually completed before the whitepaper reproduced in <a href="#satoshi_whitepaper">[satoshi_whitepaper]</a> was written. Satoshi wanted to make sure it worked before writing about it. That first implementation, then simply known as "Bitcoin" or "Satoshi client," has been heavily modified and improved. It has evolved into what is known as <em>Bitcoin Core</em>, to differentiate it from other compatible implementations. Bitcoin Core is the <em>reference implementation</em> of the Bitcoin system, meaning that it is the authoritative reference on how each part of the technology should be implemented. Bitcoin Core implements all aspects of bitcoin, including wallets, a transaction and block validation engine, and a full network node in the peer-to-peer Bitcoin network.</p>
</div>
<div class="admonitionblock warning data-line-546">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-547">
<p>Apesar de o Bitcoin Core incluir uma implementação de referência de uma carteira, ela não deve ser usada como uma carteira de produção para usuários ou aplicativos. Os desenvolvedores de aplicativos são aconselhados a construir carteiras usando padrões modernos, como os padrões BIP-39 e BIP-32 (ver <a href="#mnemonic_code_words">[mnemonic_code_words]</a> e <a href="#hd_wallets">[hd_wallets]</a>). BIP significa <em>Proposta de Melhoria ao Bitcoin</em> (em inglês, <em>Bitcoin Improvement Proposal</em>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-550">
<p>A <a href="#bitcoin_core_architecture">Arquitetura do Bitcoin Core (Fonte: Eric Lombrozo)</a> mostra a arquitetura do Bitcoin Core.</p>
</div>
<div id="bitcoin_core_architecture" class="imageblock data-line-554">
<div class="content">
<img src="images/mbc2_0301.png" alt="Bitcoin Core Architecture">
</div>
<div class="title">Figure 13. Arquitetura do Bitcoin Core (Fonte: Eric Lombrozo)</div>
</div>
<div class="paragraph data-line-557">
<p>=== Ambiente de Desenvolvimento do Bitcoin</p>
</div>
<div class="paragraph data-line-559">
<p>Se você for um desenvolvedor, você precisará configurar um ambiente de desenvolvimento com todas as ferramentas, bibliotecas e softwares de suporte para programar as aplicações do bitcoin. Neste capítulo altamente técnico, vamos percorrer esse processo passo a passo. Se o material ficar muito denso (e você não estiver realmente instalando um ambiente de desenvolvimento), fique à vontade para pular para o próximo capítulo, que é menos técnico.</p>
</div>
<div id="compiling_core" class="paragraph data-line-562">
<p>=== Compilando o Bitcoin Core a partir do Código-Fonte</p>
</div>
<div class="paragraph data-line-564">
<p>O código-fonte do Bitcoin Core pode ser baixado como um arquivo ou clonando-se o repositório oficial do GitHub. Na <a href="https://bitcoincore.org/bin/" data-href="https://bitcoincore.org/bin/">página de download do Bitcoin Core</a>, selecione a versão mais recente e baixe o arquivo compactado do código-fonte, por exemplo, bitcoin- 0.15.0.2.tar.gz. Como alternativa, use a linha de comando do git para criar uma cópia local do código-fonte do <a href="https://github.com/bitcoin/bitcoin" data-href="https://github.com/bitcoin/bitcoin">repositório do bitcoin no GitHub</a>.</p>
</div>
<div class="admonitionblock tip data-line-567">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-568">
<p>Em muitos dos exemplos neste capítulo, estaremos usando a interface de linha de comando do sistema operacional (também conhecida como "shell"), acessada por meio de um aplicativo de "terminal". O shell exibirá um prompt; você digita um comando; e o shell responde com algum texto e um novo prompt para seu próximo comando. O prompt pode ter uma aparência diferente em seu sistema, mas nos exemplos a seguir ele é denotado por um símbolo $. Nos exemplos do livro, ao ver um texto após um símbolo $, não digite o símbolo $, mas digite o comando imediatamente após ele e pressione Enter para executar o comando. Nos exemplos, as linhas abaixo de cada comando são as respostas do sistema operacional a esse comando. Ao ver o próximo prefixo $, você saberá que isso é um novo comando e que você deverá repetir o processo.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-571">
<p>Neste exemplo, estamos usando o comando git para criar uma cópia local (um "clone") do código-fonte:</p>
</div>
<div class="listingblock data-line-573">
<div class="content">
<pre>$ git clone https://github.com/bitcoin/bitcoin.git
Clonando para 'bitcoin'...
remoto: Contando objetos: 102071, pronto.
remoto: Comprimindo objetos: 100% (10/10), pronto.
Recebendo objetos: 100% (102071/102071), 86.38 MiB | 730.00 KiB/s, pronto.
remoto: Total 102071 (delta 4), reusados 5 (delta 1), pack-reusados 102060
Resolvendo deltas: 100% (76168/76168), pronto.
Verificando conectividade... pronto.
$</pre>
</div>
</div>
<div class="admonitionblock tip data-line-586">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-587">
<p>O git é o sistema de controle de versão distribuído mais amplamente usado, uma parte essencial do kit de ferramentas de qualuer desenvolvedor de software. Você pode precisar instalar em seu sistema operacional o comando git ou uma interface gráfica de usuário para git, caso o seu sistema operacional ainda não tenha.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-590">
<p>Quando a operação de clonagem do git for concluída, você terá no diretório <em>bitcoin</em> uma cópia local completa do repositório do código-fonte. Mude para este diretório digitando **cd bitcoin** no prompt:</p>
</div>
<div class="listingblock data-line-592">
<div class="content">
<pre>$ cd bitcoin</pre>
</div>
</div>
<div class="paragraph data-line-596">
<p>==== Escolhendo uma Versão do Bitcoin Core
Por padrão, a cópia local será sincronizada com o código mais recente, que pode ser uma versão instável ou beta do bitcoin. Antes de compilar o código, selecione a versão específica ao fazer um checkout de uma <em>tag</em> de lançamento. Isso sincronizará a cópia local com um instantâneo específico do repositório do código, o qual é identificado por uma tag. As tags são usadas pelos desenvolvedores para marcar lançamentos específicos do código através de um número de versão. Primeiro, para encontrar as tags disponíveis, usaremos o comando git tag:</p>
</div>
<div class="listingblock data-line-599">
<div class="content">
<pre>$ git tag
v0.1.5
v0.1.6test1
v0.10.0
...
v0.11.2
v0.11.2rc1
v0.12.0rc1
v0.12.0rc2
...</pre>
</div>
</div>
<div class="paragraph data-line-612">
<p>A lista de tags exibe todas as versões do bitcoin já lançadas. Por convenção, os <em>release candidates</em> (candidatos a lançamento), que são feitos para testes, têm o sufixo "rc". As versões estáveis, que podem ser executadas em sistemas de produção, não possuem sufixo. Nesta lista que foi exibida, selecione a versão mais recente, que até o momento em que esse livro foi escrito era a v0.15.0. Para sincronizar o código local com esta versão, use o comando git checkout.</p>
</div>
<div class="listingblock data-line-614">
<div class="content">
<pre>$ git checkout v0.15.0
HEAD está agora em 3751912... Merge #11295: doc: Old fee_estimates.dat are discarded by 0.15.0</pre>
</div>
</div>
<div class="paragraph data-line-619">
<p>Você pode confirmar que fez o "check out" da versão desejada ao executar o comando git status:</p>
</div>
<div class="listingblock data-line-621">
<div class="content">
<pre>$ git status
HEAD desanexado na v0.15.0
nada para fazer commit, diretório de trabalho limpo</pre>
</div>
</div>
<div class="paragraph data-line-627">
<p>==== Configurando a Compilação do Bitcoin Core</p>
</div>
<div class="paragraph data-line-629">
<p>The source code includes documentation, which can be found in a number of files. Review the main documentation located in <em>README.md</em> in the <em>bitcoin</em> directory by typing **more README.md** at the prompt and using the spacebar to progress to the next page. In this chapter, we will build the command-line Bitcoin client, also known as bitcoind on Linux. Review the instructions for compiling the bitcoind command-line client on your platform by typing **more doc/build-unix.md**. Alternative instructions for macOS and Windows can be found in the <em>doc</em> directory, as <em>build-osx.md</em> or <em>build-windows.md</em>, respectively.</p>
</div>
<div class="paragraph data-line-631">
<p>Analise cuidadosamente os pré-requisitos da versão, presentes na primeira parte da documentação do mesmo. Estas são as bibliotecas que devem estar presentes em seu sistema antes que você possa iniciar a compilação do bitcoin. Se estes pré-requisitos estiverem ausentes, o processo de compilação falhará. Se isso acontecer, você pode instalá-los e então continuar o processo de compilação de onde você parou. Assumindo que os pré-requisitos estão instalados, você inicia o processo de compilação gerando um conjunto de scripts de compilação que utilizam o script <em>autogen.sh</em>.</p>
</div>
<div class="listingblock data-line-633">
<div class="content">
<pre>$ ./autogen.sh
...
glibtoolize: copiando o arquivo 'build-aux/m4/libtool.m4'
glibtoolize: copiando o arquivo 'build-aux/m4/ltoptions.m4'
glibtoolize: copiando o arquivo 'build-aux/m4/ltsugar.m4'
glibtoolize: copiando o arquivo 'build-aux/m4/ltversion.m4'
...
configure.ac:10: instalando 'build-aux/compile'
configure.ac:5: instalando 'build-aux/config.guess'
configure.ac:5: instalando 'build-aux/config.sub'
configure.ac:9: instalando 'build-aux/install-sh'
configure.ac:9: instalando 'build-aux/missing'
Makefile.am: instalando 'build-aux/depcomp'
...</pre>
</div>
</div>
<div class="paragraph data-line-650">
<p>O script <em>autogen.sh</em> cria um conjunto de scripts de configuração automática que analisarão o seu sistema para descobrir as configurações corretas e garantir que você tenha todas as bibliotecas necessárias para compilar o código. O mais importante desses scripts é o script configure, que oferece várias opções diferentes para customizar o processo de compilação. Digite **./configure --help** para ver as várias opções:</p>
</div>
<div class="listingblock data-line-652">
<div class="content">
<pre>$ ./configure --help
`configure' configura o Bitcoin Core 0.15.0 para se adaptar a muitos tipos de sistemas.

Uso: ./configure [OPÇÃO]... [VAR=VALOR]...

...
Funções opcionais:
  --disable-option-checking  ignore unrecognized --enable/--with options
  --disable-FEATURE não incluir FEATURE (mesmo que --enable-FEATURE=no)
  --enable-FEATURE[=ARG]  incluir FEATURE [ARG=yes]

  --enable-wallet         ativa a carteira (o padrão é yes)

  --with-gui[=no|qt4|qt5|auto]
...</pre>
</div>
</div>
<div class="paragraph data-line-670">
<p>O script configure permite que você habilite ou desabilite certas funções do bitcoind através do uso das flags --enable-FEATURE e --disable-FEATURE, onde <span class="keep-together"><code>FEATURE</code></span> é substituída pelo nome da funcionalidade, como listada no output do help. Nesse capítulo, compilaremos o cliente bitcoind com todas as funções padrão. Não usaremos as flags de configuração, mas você deveria revisá-las para conhecer quais são as funcionalidades opcionais que fazem parte do cliente. Se você estiver em um ambiente acadêmico, as restrições do laboratório de informática podem exigir que você instale os aplicativos em seu diretório <em>home</em> (por exemplo, usando --prefix=$HOME).</p>
</div>
<div class="paragraph data-line-672">
<p>A seguir estão algumas opções úteis que substituem o comportamento padrão do script de configuração:</p>
</div>
<dl>
<dt><code>--prefix=$HOME</code></dt>
<dd><p>Essa opção substitui o local de instalação padrão (que é <em>/usr/local/</em>) do executável que será compilado. Use <code>$HOME</code> para instalar tudo em seu diretório _home_, ou use um caminho diferente.</p></dd>

<dt><code>--disable-wallet</code></dt>
<dd><p>Essa opção é usada para desativar a implementação de carteira de referência.</p></dd>

<dt><code>--with-incompatible-bdb</code></dt>
<dd><p>Se você estiver compilando uma carteira, essa opção permite o uso de uma versão incompatível da biblioteca Berkeley DB.</p></dd>

<dt><code>--with-gui=no</code></dt>
<dd><p>Essa opção faz com que a interface gráfica do usuário não seja compilada, o que requer a biblioteca Qt. Apenas o servidor e a linha de comando do bitcoin serão compilados.</p></dd>
</dl>
<div class="paragraph data-line-690">
<p>A seguir, execute o script configure para descobrir automaticamente todas as bibliotecas necessárias e crie um script de compilação personalizado para o seu sistema:</p>
</div>
<div class="listingblock data-line-692">
<div class="content">
<pre>$ ./configure
verificando o tipo de sistema de compilação... x86_64-unknown-linux-gnu
verificando o tipo de sistema host... x86_64-unknown-linux-gnu
verificando se há uma instalação compatível com BSD... /usr/bin/install -c
verificando se o ambiente de compilação é lógico... sim
verificando se há um mkdir -p thread-seguro... /bin/mkdir -p
verificando o gawk... gawk
verificando se o make define $(MAKE)... sim
...
[muitas páginas de configuração a seguir]
...
$</pre>
</div>
</div>
<div class="paragraph data-line-708">
<p>Se tudo der certo, o comando configure terminará criando os scripts de compilação customizados que nos permitirão compilar o bitcoind. Se houver bibliotecas faltando ou erros, o comando configure terminará com um erro ao invés de criar os script de compilação. Se um erro ocorrer, mais provavelmente será devido a uma biblioteca faltando ou incompatível. Revise a documentação da compilação novamente e certifique-se de que você instalou os pré-requisitos que estão em falta. Então execute o configure novamente e veja se isso corrige o erro.</p>
</div>
<div class="paragraph data-line-710">
<p>==== Compilando os Executáveis do Bitcoin Core</p>
</div>
<div class="paragraph data-line-712">
<p>Em seguida, você compilará o código-fonte, um processo que pode levar até uma hora para ser completado, dependendo da velocidade do seu processador e da memória disponível. Durante o processo de compilação, você deverá ver um output a cada poucos segundos ou minutos, ou um erro se algo der errado. Se ocorrer algum erro, ou o processo de compilação for interrompido, ele pode ser reiniciado digitando-se novamente make. Digite **make** para iniciar a compilação do aplicativo executável:</p>
</div>
<div class="listingblock data-line-714">
<div class="content">
<pre>$ make
Making all in src
  CXX      crypto/libbitcoinconsensus_la-hmac_sha512.lo
  CXX      crypto/libbitcoinconsensus_la-ripemd160.lo
  CXX      crypto/libbitcoinconsensus_la-sha1.lo
  CXX      crypto/libbitcoinconsensus_la-sha256.lo
  CXX      crypto/libbitcoinconsensus_la-sha512.lo
  CXX      libbitcoinconsensus_la-hash.lo
  CXX      primitives/libbitcoinconsensus_la-transaction.lo
  CXX      libbitcoinconsensus_la-pubkey.lo
  CXX      script/libbitcoinconsensus_la-bitcoinconsensus.lo
  CXX      script/libbitcoinconsensus_la-interpreter.lo

[... muitas outras mensagens de compilação ...]

$</pre>
</div>
</div>
<div class="paragraph data-line-733">
<p>Em um sistema rápido com mais de uma CPU, você pode querer definir o número de trabalhos de compilação paralela. Por exemplo, make -j 2 usará dois núcleos se estiverem disponíveis. Se tudo correr bem, o Bitcoin Core agora está compilado. Você deve executar o conjunto de testes de unidade com make check para garantir que as bibliotecas vinculadas não estão quebradas de maneiras óbvias. A etapa final é instalar os vários executáveis em seu sistema usando o comando make install. A sua senha de usuário pode ser solicitada, pois esta etapa requer privilégios administrativos:</p>
</div>
<div class="listingblock data-line-735">
<div class="content">
<pre>$ make check &amp;&amp; sudo make install
Senha:
Making install in src
 ../build-aux/install-sh -c -d '/usr/local/lib'
libtool: install: /usr/bin/install -c bitcoind /usr/local/bin/bitcoind
libtool: install: /usr/bin/install -c bitcoin-cli /usr/local/bin/bitcoin-cli
libtool: install: /usr/bin/install -c bitcoin-tx /usr/local/bin/bitcoin-tx
...
$</pre>
</div>
</div>
<div class="paragraph data-line-747">
<p>A instalação padrão do bitcoind o coloca em <em>/usr/local/bin</em>. Você pode confirmar que o Bitcoin Core está instalado corretamente solicitando ao sistema o caminho dos executáveis, da seguinte maneira:</p>
</div>
<div class="listingblock data-line-749">
<div class="content">
<pre>$ which bitcoind
/usr/local/bin/bitcoind

$ which bitcoin-cli
/usr/local/bin/bitcoin-cli</pre>
</div>
</div>
<div class="paragraph data-line-757">
<p>=== Executando um Nó do Bitcoin Core</p>
</div>
<div class="paragraph data-line-759">
<p>Bitcoin&#8217;s peer-to-peer network is composed of network "nodes," run mostly by volunteers and some of the businesses that build bitcoin applications. Those running Bitcoin nodes have a direct and authoritative view of the Bitcoin blockchain, with a local copy of all the transactions, independently validated by their own system. By running a node, you don&#8217;t have to rely on any third party to validate a transaction. Moreover, by running a Bitcoin node you contribute to the Bitcoin network by making it more robust.</p>
</div>
<div class="paragraph data-line-761">
<p>Running a node, however, requires a permanently connected system with enough resources to process all bitcoin transactions. Depending on whether you choose to index all transactions and keep a full copy of the blockchain, you may also need a lot of disk space and RAM. As of early 2021, a full-index node needs 2 GB of RAM and a minimum of 360 GB of disk space (see <a href="https://www.blockchain.com/charts/blocks-size" class="undefined" data-href="https://www.blockchain.com/charts/blocks-size">https://www.blockchain.com/charts/blocks-size</a>). Bitcoin nodes also transmit and receive bitcoin transactions and blocks, consuming internet bandwidth. If your internet connection is limited, has a low data cap, or is metered (charged by the gigabit), you should probably not run a Bitcoin node on it, or run it in a way that constrains its bandwidth (see <a href="#constrained_resources">Configuração de amostra de um sistema com recursos limitados</a>).</p>
</div>
<div class="admonitionblock tip data-line-764">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-765">
<p>Bitcoin Core keeps a full copy of the blockchain by default, with every transaction that has ever occurred on the Bitcoin network since its inception in 2009. This dataset is dozens of gigabytes in size and is downloaded incrementally over several days or weeks, depending on the speed of your CPU and internet connection. Bitcoin Core will not be able to process transactions or update account balances until the full blockchain dataset is downloaded. Make sure you have enough disk space, bandwidth, and time to complete the initial synchronization. You can configure Bitcoin Core to reduce the size of the blockchain by discarding old blocks (see <a href="#constrained_resources">Configuração de amostra de um sistema com recursos limitados</a>), but it will still download the entire dataset before discarding data.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-768">
<p>Despite these resource requirements, thousands of volunteers run Bitcoin nodes. Some are running on systems as simple as a Raspberry Pi (a $35 USD computer the size of a pack of cards). Many volunteers also run Bitcoin nodes on rented servers, usually some variant of Linux. A <em>Virtual Private Server</em> (VPS) or <em>Cloud Computing Server</em> instance can be used to run a Bitcoin node. Such servers can be rented for $25 to $50 USD per month from a variety of providers.</p>
</div>
<div class="paragraph data-line-770">
<p>Por que você desejaria executar um nó? Aqui estão alguns dos motivos mais comuns:</p>
</div>
<div class="ulist data-line-772">
<ul>
<li class="data-line-772">
<p>If you are developing bitcoin software and need to rely on a Bitcoin node for programmable (API) access to the network and blockchain.</p>
</li>
<li class="data-line-774">
<p>Se você estiver construindo aplicativos que devem validar as transações de acordo com as regras de consenso do bitcoin. Normalmente, as empresas de software de bitcoin executam vários nós.</p>
</li>
<li class="data-line-776">
<p>Se você deseja apoiar o bitcoin. Executar um nó torna a rede mais robusta e capaz de atender mais carteiras, mais usuários e mais transações.</p>
</li>
<li class="data-line-778">
<p>Se você não quiser depender de terceiros para processar ou validar suas transações.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-780">
<p>Se você está lendo este livro e está interessado em desenvolver um software de bitcoin, você deve executar o seu próprio nó.</p>
</div>
<div class="paragraph data-line-782">
<p>==== Configurando o Nó do Bitcoin Core</p>
</div>
<div class="paragraph data-line-784">
<p>O Bitcoin Core procurará um arquivo de configuração em seu diretório de dados a cada inicialização. Nesta seção, examinaremos as várias opções de configuração e definiremos um arquivo de configuração. Para localizar o arquivo de configuração, execute bitcoind -printtoconsole em seu terminal e observe as primeiras linhas.</p>
</div>
<div class="listingblock data-line-786">
<div class="content">
<pre>$ bitcoind -printtoconsole
Bitcoin versão v0.15.0
Usando a implementação SHA256 'padrão'
Usando o diretório de dados /home/ubuntu/.bitcoin/
Usando o arquivo de configuração /home/ubuntu/.bitcoin/bitcoin.conf
...
[muitos outros outputs de depuração]
...</pre>
</div>
</div>
<div class="paragraph data-line-797">
<p>Você pode pressionar Ctrl+C para desligar o nó depois de definir a localização do arquivo de configuração. Normalmente, o arquivo de configuração está dentro do diretório de dados <em>.bitcoin</em> no diretório <em>home</em> do usuário. Ele não é criado automaticamente, mas você pode criar um arquivo de configuração inicial copiando e colando do <a href="#full_index_node">Configuração de amostra de um nó de índice completo</a> abaixo. Você pode criar ou modificar o arquivo de configuração em seu editor preferido.</p>
</div>
<div class="paragraph data-line-799">
<p>O Bitcoin Core oferece mais de 100 opções de configuração que modificam o comportamento do nó da rede, o armazenamento da blockchain e muitos outros aspectos de sua operação. Para ver uma lista dessas opções, execute bitcoind  --help:</p>
</div>
<div class="listingblock data-line-801">
<div class="content">
<pre>$ bitcoind --help
Daemon do Bitcoin Core versão v0.15.0

Uso:
  bitcoind [opções]                     Inicia o Daemon do Bitcoin Core

Opções:

  -?
       Exibe essa mensagem de ajuda e sai

  -version
       Exibe a versão e sai

  -alertnotify=&lt;cmd&gt;
       Executa o comando quando um alerta relevante for recebido ou quando vemos um
       fork longo (%s no cmd é substituído pela mensagem)
...
[diversas outras opções]
...

  -rpcthreads=&lt;n&gt;
       Define o número de threads para atender chamadas RPC (padrão: 4)</pre>
</div>
</div>
<div class="paragraph data-line-827">
<p>Aqui estão algumas das opções mais importantes que você pode definir no arquivo de configuração, ou como parâmetros de linha de comando para o bitcoind:</p>
</div>
<div class="dlist data-line-829">
<dl>
<dt class="hdlist1">alertnotify</dt>
<dd>
<p>Executa um comando ou script especificado para enviar alertas de emergência ao proprietário deste nó, geralmente por e-mail.</p>
</dd>
<dt class="hdlist1">conf</dt>
<dd>
<p>Um local alternativo para o arquivo de configuração. Essa opção deve ser apenas utilizada como um parâmetro de linha de comando para o bitcoind, pois ela não pode estar dentro do arquivo de configuração ao qual se refere.</p>
</dd>
<dt class="hdlist1">datadir</dt>
<dd>
<p>Seleciona o diretório e o sistema de arquivos nos quais devem ser colocados todos os dados da blockchain. Por padrão, este é o subdiretório <em>.bitcoin</em> do seu diretório <em>home</em>. Certifique-se de que o sistema de arquivos tenha vários gigabytes de espaço livre.</p>
</dd>
<dt class="hdlist1">prune</dt>
<dd>
<p>Reduz os requisitos de espaço em disco para muitos megabytes, ao excluir blocos antigos. Use essa opção em um nó com recursos limitados, sem espaço para armazenar toda a blockchain.</p>
</dd>
<dt class="hdlist1">txindex</dt>
<dd>
<p>Manter um índice de todas as transações. Isso significa uma cópia completa da blockchain que permite recuperar programaticamente qualquer transação através do ID.</p>
</dd>
<dt class="hdlist1">dbcache</dt>
<dd>
<p>O tamanho do cache de UTXOs. O padrão é 450 MiB. Aumente-o, caso esteja usando um hardware de ponta. Reduza-o, caso esteja usando um hardware de baixo custo, para economizar memória, à custa de uma lentidão nas operações de entrada e saída (IO) do disco.</p>
</dd>
<dt class="hdlist1">maxconnections</dt>
<dd>
<p>Define o número máximo de nós dos quais se deve aceitar conexões. Reduzir esse valor reduzirá o consumo de dados da sua Internet. Use se você tiver um limite de dados ou pagar por gigabyte.</p>
</dd>
<dt class="hdlist1">maxmempool</dt>
<dd>
<p>Limita a <em>pool</em> de memória de transações a uma quantidade de megabytes. Use essa opção para reduzir o uso de memória em nós com restrição de memória.</p>
</dd>
<dt class="hdlist1">maxreceivebuffer/maxsendbuffer</dt>
<dd>
<p>Limita o buffer de memória por conexão para uma determinada quantidade de múltiplos de 1.000 bytes. Use essa opção em nós com restrição de memória.</p>
</dd>
<dt class="hdlist1">minrelaytxfee</dt>
<dd>
<p>Define a taxa mínima para que você retransmita uma transação. Abaixo desse valor, a transação é tratada como fora de padrão, sendo rejeitada pela pool de transações e não sendo retransmitida.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="paragraph data-line-317">
<p>Por padrão, o Bitcoin Core constrói um banco de dados contendo <em>apenas</em> as transações relacionadas à carteira do usuário. Se você deseja ser capaz de acessar <em>qualquer</em> transação com comandos como getrawtransaction (ver <a href="#exploring_and_decoding_transanctions">[exploring_and_decoding_transanctions]</a>), você precisará configurar o Bitcoin Core para construir um índice de transações completo, que pode ser feito com a opção txindex. Defina txindex=1 no arquivo de configuração do Bitcoin Core. Se você não definir esta opção inicialmente e depois quiser defini-la para ter uma indexação completa, você precisará reiniciar o bitcoind com a opção -reindex e esperar que ele reconstrua o índice.</p>
</div>
<div class="sidebarblock data-line-318">
<div class="content">
<div class="paragraph data-line-320">
<p>O <a href="#full_index_node">Configuração de amostra de um nó de índice completo</a> mostra como você pode combinar as opções anteriores, com um nó de índice completo, executando como um back-end de API para um aplicativo de bitcoin.</p>
</div>
<div id="full_index_node" class="exampleblock data-line-324">
<div class="title">Example 3. Configuração de amostra de um nó de índice completo</div>
<div class="content">
<div class="listingblock data-line-325">
<div class="content">
<pre>alertnotify=myemailscript.sh "Alerta: %s"
datadir=/diretoriocombastanteespaco/bitcoin
txindex=1</pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-332">
<p>O <a href="#constrained_resources">Configuração de amostra de um sistema com recursos limitados</a> mostra um nó com restrição de recursos em execução em um servidor menor.</p>
</div>
<div id="constrained_resources" class="exampleblock data-line-336">
<div class="title">Example 4. Configuração de amostra de um sistema com recursos limitados</div>
<div class="content">
<div class="listingblock data-line-337">
<div class="content">
<pre>alertnotify=myemailscript.sh "Alerta: %s"
maxconnections=15
prune=5000
dbcache=150
maxmempool=150
maxreceivebuffer=2500
maxsendbuffer=500</pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-348">
<p>Depois de editar o arquivo de configuração e definir as opções que melhor representam suas necessidades, você pode testar o bitcoind com esta configuração. Execute o Bitcoin Core com a opção printtoconsole para executá-lo em primeiro plano e com saída para o console:</p>
</div>
<div class="listingblock data-line-350">
<div class="content">
<pre>$ bitcoind -printtoconsole

Bitcoin versão v0.15.0
InitParameterInteraction: parameter interaction: -whitelistforcerelay=1 -&gt; setting -whitelistrelay=1
Assumindo que os ancestrais do bloco 0000000000000000003b9ce759c2a087d52abc4266f8f4ebd6d768b89defa50a possuem assinaturas válidas.
Usando a implementação SHA256 'padrão'
Diretório de dados padrão /home/ubuntu/.bitcoin
Usando o diretório de dados /lotsofspace/.bitcoin
Usando o arquivo de configuração /home/ubuntu/.bitcoin/bitcoin.conf
Usando no máximo 125 conexões automáticas (1048576 descritores de arquivo disponíveis)
Usando 16 MiB de 32/2 solicitados para o cache de assinatura, capaz de armazenar 524.288 elementos
Usando 16 MiB de 32/2 solicitados para o cache de execução de script, capaz de armazenar 524.288 elementos
Usando 2 threads para verificação de script
HTTP: criando fila de trabalho de profundidade 16
Nenhuma rpcpassword definida - usando autenticação de cookie aleatório
Cookie de autenticação RPC gerado /lotsofspace/.bitcoin/.cookie
HTTP: iniciando 4 threads de trabalho
mensagem init: Verificando carteira(s)...
Usando BerkeleyDB versão Berkeley DB 4.8.30: (9 de abril, 2010)
Usando a carteira wallet.dat
CDBEnv::Open: LogDir=/lotsofspace/.bitcoin/database ErrorFile=/lotsofspace/.bitcoin/db.log
scheduler thread start
Configuração do cache:
* Usando 250,0 MiB para banco de dados de índice de bloco
* Usando 8,0 MiB para banco de dados de estado da cadeia
* Usando 1742,0 MiB para o conjunto UTXO em memória (mais até 286,1 MiB de espaço de mempool não utilizado)
mensagem init: Carregando índice de blocos...
Abrindo LevelDB em /lotsofspace/.bitcoin/blocks/index
LevelDB aberto com sucesso

[... mais mensagens de inicialização ...]</pre>
</div>
</div>
<div class="paragraph data-line-384">
<p>Você pode pressionar Ctrl+C para interromper o processo assim que você estiver satisfeito que ele está carregando as configurações corretas e que está rodando conforme o esperado.</p>
</div>
<div class="paragraph data-line-386">
<p>Para executar o Bitcoin Core em segundo plano como um processo, inicie-o com a opção daemon, como bitcoind -daemon.</p>
</div>
<div class="paragraph data-line-388">
<p>To monitor the progress and runtime status of your Bitcoin node, use the command bitcoin-cli getblockchaininfo:</p>
</div>
<div class="listingblock data-line-390">
<div class="content">
<pre>$ bitcoin-cli getblockchaininfo</pre>
</div>
</div>
<div class="listingblock data-line-395">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "chain": "main",
  "blocks": 0,
  "headers": 83999,
  "bestblockhash": "000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f",
  "difficulty": 1,
  "mediantime": 1231006505,
  "verificationprogress": 3.783041623201835e-09,
  "chainwork": "0000000000000000000000000000000000000000000000000000000100010001",
  "pruned": false,
  [...]
}</code></pre>
</div>
</div>
<div class="paragraph data-line-410">
<p>O resultado do comando nos mostra um nó com uma altura de blockchain de 0 blocos e 83.999 cabeçalhos. Atualmente o nó primeiro busca todos os cabeçalhos de bloco da melhor cadeia e, depois disso, começa a baixar os blocos completos.</p>
</div>
<div class="paragraph data-line-412">
<p>Quando estiver satisfeito com as opções de configuração selecionadas, você deve adicionar o bitcoin aos scripts de inicialização do seu sistema operacional, para que seja executado continuamente e para que seja reinicializado quando o sistema operacional for reiniciado. Você encontrará vários exemplos de scripts de inicialização para vários sistemas operacionais no diretório do bitcoin em <em>contrib/init</em> e um arquivo <em>README.md</em> mostrando qual sistema usa cada script.</p>
</div>
<div class="paragraph data-line-414">
<p>=== A Interface de Programação de Aplicativo (API) do Bitcoin Core</p>
</div>
<div class="paragraph data-line-416">
<p>O cliente Bitcoin Core implementa uma interface JSON-RPC que também pode ser acessada ao se utilizar a ajuda da linha de comando do bitcoin-cli. A linha de comando nos permite experimentar interativamente com as capacidades que também estão disponíveis programaticamente através da API. Para iniciar, execute o comando help para ver uma lista dos comandos RPC disponíveis no bitcoin:</p>
</div>
<div id="bitcoind_commands" class="listingblock data-line-420">
<div class="content">
<pre>$ bitcoin-cli help
addmultisigaddress nrequired ["key",...] ( "account" )
addnode "node" "add|remove|onetry"
backupwallet "destination"
createmultisig nrequired ["key",...]
createrawtransaction [{"txid":"id","vout":n},...] {"address":amount,...}
decoderawtransaction "hexstring"
...
...
verifymessage "bitcoinaddress" "signature" "message"
walletlock
walletpassphrase "passphrase" timeout
walletpassphrasechange "oldpassphrase" "newpassphrase"</pre>
</div>
</div>
<div class="paragraph data-line-436">
<p>Cada um desses comandos pode ter vários parâmetros. Para obter ajuda adicional, uma descrição detalhada e informações sobre os parâmetros, adicione o nome do comando após help. Por exemplo, para ver ajuda sobre o comando RPC getblockhash:</p>
</div>
<div class="listingblock data-line-438">
<div class="content">
<pre>$ bitcoin-cli help getblockhash
getblockhash altura

Retorna o hash do bloco na melhor cadeia de blocos para a altura fornecida.

Argumentos:
1. altura         (numérico, obrigatório) O índice da altura

Resultado:
"hash"         (string) O hash do bloco

Exemplos:
&gt; bitcoin-cli getblockhash 1000
&gt; curl --user myusername --data-binary '{"jsonrpc": "1.0", "id":"curltest", "method": "getblockhash", "params": [1000] }' -H 'content-type: text/plain;' http://127.0.0.1:8332/</pre>
</div>
</div>
<div class="paragraph data-line-455">
<p>No final das informações de ajuda, você verá dois exemplos do comando RPC, usando a ajuda do bitcoin-cli ou o cliente HTTP curl. Esses exemplos demonstram como você pode chamar o comando. Copie o primeiro exemplo e veja o resultado:</p>
</div>
<div class="listingblock data-line-457">
<div class="content">
<pre>$ bitcoin-cli getblockhash 1000
00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09</pre>
</div>
</div>
<div class="paragraph data-line-462">
<p>O resultado é um hash de bloco, que será descrito em maiores detalhes nos próximos capítulos. Mas, por enquanto, este comando deve retornar o mesmo resultado em seu sistema, demonstrando que seu nó do Bitcoin Core está em execução, está aceitando comandos e tem informações sobre o bloco 1000 para retornar para você.</p>
</div>
<div class="paragraph data-line-464">
<p>Nas próximas seções, demonstraremos alguns comandos RPC muito úteis e a sua saída esperada.</p>
</div>
<div class="paragraph data-line-466">
<p>==== Obtendo Informações sobre o Status do Cliente Bitcoin Core</p>
</div>
<div class="paragraph data-line-468">
<p>O Bitcoin Core fornece relatórios sobre o status de diferentes módulos por meio da interface JSON-RPC. Os comandos mais importantes incluem getblockchaininfo, getmempoolinfo, getnetworkinfo e getwalletinfo.</p>
</div>
<div class="paragraph data-line-470">
<p>Bitcoin&#8217;s getblockchaininfo RPC command was introduced earlier. The getnetworkinfo command displays basic information about the status of the Bitcoin network node. Use bitcoin-cli to run it:</p>
</div>
<div class="listingblock data-line-472">
<div class="content">
<pre>$ bitcoin-cli getnetworkinfo</pre>
</div>
</div>
<div class="listingblock data-line-476">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "version": 150000,
  "subversion": "/Satoshi:0.15.0/",
  "protocolversion": 70015,
  "localservices": "000000000000000d",
  "localrelay": true,
  "timeoffset": 0,
  "networkactive": true,
  "connections": 8,
  "networks": [
    ...
    informações detalhadas sobre todas as redes (ipv4, ipv6 ou onion)
    ...
  ],
  "relayfee": 0.00001000,
  "incrementalfee": 0.00001000,
  "localaddresses": [
  ],
  "warnings": ""
}</code></pre>
</div>
</div>
<div class="paragraph data-line-500">
<p>The data is returned in JavaScript Object Notation (JSON), a format that can easily be "consumed" by all programming languages but is also quite human-readable. Among this data we see the version numbers for the bitcoin software client (150000) and Bitcoin protocol (70015).  We see the current number of connections (8) and various information about the Bitcoin network and the settings related to this client.</p>
</div>
<div class="admonitionblock tip data-line-503">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-504">
<p>It will take some time, perhaps more than a day, for the bitcoind client to "catch up" to the current blockchain height as it downloads blocks from other Bitcoin clients. You can check its progress using getblockchaininfo to see the number of known blocks.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="exploring_and_decoding_transanctions" class="paragraph data-line-508">
<p>==== Explorando e Decodificando as Transações</p>
</div>
<div class="paragraph data-line-510">
<p>Comandos: getrawtransaction, decoderawtransaction</p>
</div>
<div class="paragraph data-line-514">
<p>Em <a href="#cup_of_coffee">[cup_of_coffee]</a>, a Alice comprou uma xícara de café da Cafeteria do Bob. A sua transação foi registrada na blockchain com o ID de transação (txid) 0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2. Vamos usar a API para recuperar e examinar essa transação passando o ID da transação como um parâmetro:</p>
</div>
<pre data-type="programlisting">
$ bitcoin-cli getrawtransaction 0627052b6f28912f2703066a912ea577f2ce4da4caa5a&#x21b5;
5fbd8a57286c345c2f2

0100000001186f9f998a5aa6f048e51dd8419a14d8a0f1a8a2836dd734d2804fe65fa35779000&#x21b5;
000008b483045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4&#x21b5;
ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813014&#x21b5;
10484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc54123363767&#x21b5;
89d172787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adfffffffff0260e3160000000&#x21b5;
0001976a914ab68025513c3dbd2f7b92a94e0581f5d50f654e788acd0ef8000000000001976a9&#x21b5;
147f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a888ac00000000
</pre>
<div class="admonitionblock tip data-line-533">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-534">
<p>Um ID de transação não é "oficial" até que a transação tenha sido confirmada. A ausência de um hash de transação na blockchain não significa que a transação não foi processada. Isso é conhecido como "maleabilidade da transação", e refere-se ao fato de que os hashes de transação podem ser modificados antes de serem confirmados em um bloco. Após a confirmação, o txid é imutável e oficial.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-537">
<p>O comando getrawtransaction retorna uma transação serializada em notação hexadecimal. Para decodificá-la, usamos o comando decoderawtransaction, passando os dados hexadecimais como parâmetro. Você pode copiar o hexadecimal retornado pelo comando getrawtransaction e colá-lo como um parâmetro para o comando decoderawtransaction:</p>
</div>
<pre data-type="programlisting">
$ bitcoin-cli decoderawtransaction 0100000001186f9f998a5aa6f048e51dd8419a14d8&#x21b5;
a0f1a8a2836dd734d2804fe65fa35779000000008b483045022100884d142d86652a3f47ba474&#x21b5;
6ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298&#x21b5;
cad530a863ea8f53982c09db8f6e381301410484ecc0d46f1918b30928fa0e4ed99f16a0fb4fd&#x21b5;
e0735e7ade8416ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc17b4a10fa&#x21b5;
336a8d752adfffffffff0260e31600000000001976a914ab68025513c3dbd2f7b92a94e0581f5&#x21b5;
d50f654e788acd0ef8000000000001976a9147f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a8&#x21b5;
88ac00000000

</pre>
<pre data-type="programlisting" data-code-language="json">
{
  "txid": "0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2",
  "size": 258,
  "version": 1,
  "locktime": 0,
  "vin": [
    {
      "txid": "7957a35fe64f80d234d76d83a2...8149a41d81de548f0a65a8a999f6f18",
      "vout": 0,
      "scriptSig": {
        "asm":"3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1decc...",
        "hex":"483045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1de..."
      },
      "sequence": 4294967295
    }
  ],
  "vout": [
    {
      "value": 0.01500000,
      "n": 0,
      "scriptPubKey": {
        "asm": "OP_DUP OP_HASH160 ab68...5f654e7 OP_EQUALVERIFY OP_CHECKSIG",
        "hex": "76a914ab68025513c3dbd2f7b92a94e0581f5d50f654e788ac",
        "reqSigs": 1,
        "type": "pubkeyhash",
        "addresses": [
          "1GdK9UzpHBzqzX2A9JFP3Di4weBwqgmoQA"
        ]
      }
    },
    {
      "value": 0.08450000,
      "n": 1,
      "scriptPubKey": {
        "asm": "OP_DUP OP_HASH160 7f9b1a...025a8 OP_EQUALVERIFY OP_CHECKSIG",
        "hex": "76a9147f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a888ac",
        "reqSigs": 1,
        "type": "pubkeyhash",
        "addresses": [
          "1Cdid9KFAaatwczBwBttQcwXYCpvK8h7FK"
        ]
      }
    }
  ]
}

</pre>
<div class="paragraph data-line-604">
<p>A decodificação da transação mostra todos os componentes desta transação, incluindo as entradas e as saídas de transação. Nesse caso, vemos que a transação que creditou nosso novo endereço com 15 milibits usou uma entrada e gerou duas saídas. A entrada para essa transação foi a saída de uma transação previamente confirmada (exibida com o txid 7957a35fe... em vin). As duas saídas (exibidas em vout) correspondem a uma saída com o crédito de 15 milibit e a uma saída com o troco de volta ao remetente.</p>
</div>
<div class="paragraph data-line-606">
<p>Podemos explorar mais a fundo a blockchain ao examinarmos a transação anterior referenciada pelo seu txid nesta transação usando os mesmos comandos (ex: getrawtransaction). Saltando de transação em transação, podemos seguir uma cadeia de transações de trás para frente, conforme as moedas são transmitidas entre os endereços de seus donos.</p>
</div>
<div class="paragraph data-line-610">
<p>==== Explorando os Blocos</p>
</div>
<div class="paragraph data-line-612">
<p>Comandos: getblock, getblockhash</p>
</div>
<div class="paragraph data-line-614">
<p>Explorar blocos é semelhante a explorar transações. No entanto, os blocos podem ser referenciados pela <em>altura</em> do bloco ou pelo <em>hash</em> do bloco. Primeiro, vamos encontrar um bloco pela sua altura. Em <a href="#cup_of_coffee">[cup_of_coffee]</a>, vimos que a transação da Alice foi incluída no bloco 277316.</p>
</div>
<div class="paragraph data-line-616">
<p>Usaremos o comando getblockhash, que recebe a altura do bloco como parâmetro e retorna o hash do bloco para aquele bloco:</p>
</div>
<pre data-type="programlisting">
$ bitcoin-cli getblockhash 277316
0000000000000001b6b9a13b095e96db41c4a928b97ef2d944a9b31b2cc7bdc4
</pre>
<div class="paragraph data-line-625">
<p>Agora que sabemos em qual bloco a transação da Alice foi incluída, podemos consultar esse bloco. Usaremos o comando getblock com o hash do bloco como parâmetro:</p>
</div>
<pre data-type="programlisting">
$ bitcoin-cli getblock 0000000000000001b6b9a13b095e96db41c4a928b97ef2d944a9b3&#x21b5;
1b2cc7bdc4
</pre>
<pre data-type="programlisting" data-code-language="json">
{
  "hash": "0000000000000001b6b9a13b095e96db41c4a928b97ef2d944a9b31b2cc7bdc4",
  "confirmations": 37371,
  "size": 218629,
  "height": 277316,
  "version": 2,
  "merkleroot": "c91c008c26e50763e9f548bb8b2fc323735f73577effbc55502c51eb4cc7cf2e",
  "tx": [
    "d5ada064c6417ca25c4308bd158c34b77e1c0eca2a73cda16c737e7424afba2f",
    "b268b45c59b39d759614757718b9918caf0ba9d97c56f3b91956ff877c503fbe",
    "04905ff987ddd4cfe603b03cfb7ca50ee81d89d1f8f5f265c38f763eea4a21fd",
    "32467aab5d04f51940075055c2f20bbd1195727c961431bf0aff8443f9710f81",
    "561c5216944e21fa29dd12aaa1a45e3397f9c0d888359cb05e1f79fe73da37bd",
[... centenas de transações ...]
    "78b300b2a1d2d9449b58db7bc71c3884d6e0579617e0da4991b9734cef7ab23a",
    "6c87130ec283ab4c2c493b190c20de4b28ff3caf72d16ffa1ce3e96f2069aca9",
    "6f423dbc3636ef193fd8898dfdf7621dcade1bbe509e963ffbff91f696d81a62",
    "802ba8b2adabc5796a9471f25b02ae6aeee2439c679a5c33c4bbcee97e081196",
    "eaaf6a048588d9ad4d1c092539bd571dd8af30635c152a3b0e8b611e67d1a1af",
    "e67abc6bd5e2cac169821afc51b207127f42b92a841e976f9b752157879ba8bd",
    "d38985a6a1bfd35037cb7776b2dc86797abbb7a06630f5d03df2785d50d5a2ac",
    "45ea0a3f6016d2bb90ab92c34a7aac9767671a8a84b9bcce6c019e60197c134b",
    "c098445d748ced5f178ef2ff96f2758cbec9eb32cb0fc65db313bcac1d3bc98f"
  ],
  "time": 1388185914,
  "mediantime": 1388183675,
  "nonce": 924591752,
  "bits": "1903a30c",
  "difficulty": 1180923195.258026,
  "chainwork": "000000000000000000000000000000000000000000000934695e92aaf53afa1a",
  "previousblockhash": "0000000000000002a7bbd25a417c0374cc55261021e8a9ca74442b01284f0569",
  "nextblockhash": "000000000000000010236c269dd6ed714dd5db39d36b33959079d78dfd431ba7"
}
</pre>
<div class="paragraph data-line-672">
<p>O bloco contém 419 transações e a 64ª transação listada (0627052b...) é o pagamento da xícara de café da Alice. A entrada height nos diz que este é o 277.316º bloco na blockchain.</p>
</div>
<div class="paragraph data-line-674">
<p>==== Usando a Interface Programática do Bitcoin Core</p>
</div>
<div class="paragraph data-line-676">
<p>A ajuda do bitcoin-cli é muito útil para explorar a API do Bitcoin Core e testar funções. Mas uma interface de programação de aplicativo é feita para que as funções sejam acessadas programaticamente. Nesta seção, demonstraremos como acessar o Bitcoin Core a partir de outro programa.</p>
</div>
<div class="paragraph data-line-678">
<p>A API do Bitcoin Core é uma interface JSON-RPC. JSON significa Notação de Objetos JavaScript (em inglês, <em>JavaScript Object Notation</em>) e é uma maneira muito conveniente de apresentar dados que tanto humanos quanto programas podem ler facilmente. RPC significa Chamada de Procedimento Remoto (em inglês, <em>Remote Procedure Call</em>), o que significa que estamos chamando procedimentos (funções) que são remotos (estão no nó do Bitcoin Core) através de um protocolo de rede. Nesse caso, o protocolo de rede é o HTTP ou o HTTPS (para conexões criptografadas).</p>
</div>
<div class="paragraph data-line-680">
<p>Quando usamos o comando bitcoin-cli para obter ajuda em um comando, ele nos mostrou um exemplo usando o curl, o versátil cliente HTTP de linha de comando, para construir uma dessas chamadas JSON-RPC:</p>
</div>
<div class="listingblock data-line-682">
<div class="content">
<pre>$ curl --user myusername --data-binary '{"jsonrpc": "1.0", "id":"curltest", "method": "getblockchaininfo", "params": [] }' -H 'content-type: text/plain;' http://127.0.0.1:8332/</pre>
</div>
</div>
<div class="paragraph data-line-686">
<p>Este comando mostra que o curl submete uma solicitação HTTP ao host local (127.0.0.1), conectando-se à porta bitcoin padrão (8332) e enviando uma solicitação jsonrpc para o método getblockchaininfo usando a codificação text/plain.</p>
</div>
<div class="paragraph data-line-688">
<p>Você pode notar que o curl solicitará que as credenciais sejam enviadas junto com a solicitação. O Bitcoin Core criará uma senha aleatória em cada inicialização e a colocará no diretório de dados com o nome .cookie. O helper do bitcoin-cli pode ler este arquivo de senha no diretório de dados. Da mesma forma, você pode copiar a senha e passá-la para o curl (ou qualquer wrapper de RPC do Bitcoin Core de nível superior). Como alternativa, você pode criar uma senha estática com o script auxiliar fornecido no arquivo <em>./share/rpcauth/rpcauth.py</em> localizado no diretório do Bitcoin Core.</p>
</div>
<div class="paragraph data-line-690">
<p>Se você estiver implementando uma chamada JSON-RPC em seu próprio programa, você pode usar uma biblioteca HTTP genérica para construir a chamada, de maneira semelhante ao que é mostrado no exemplo anterior do curl.</p>
</div>
<div class="paragraph data-line-692">
<p>No entanto, existem bibliotecas em quase todas as linguagens de programação que "envolvem" a API do Bitcoin Core, simplificando muito o processo. Usaremos a biblioteca python-bitcoinlib para simplificar o acesso à API. Lembre-se de que isso requer uma instância do Bitcoin Core em execução, que será usada para fazer chamadas JSON-RPC.</p>
</div>
<div class="paragraph data-line-694">
<p>O script Python no <a href="#rpc_example">Executando o getblockchaininfo via API JSON-RPC do Bitcoin Core</a> faz uma chamada simples getblockchaininfo e imprime o parâmetro blocks dos dados retornados pelo Bitcoin Core (este exemplo requer um nó completo).</p>
</div>
<div id="rpc_example" class="exampleblock data-line-698">
<div class="title">Example 5. Executando o getblockchaininfo via API JSON-RPC do Bitcoin Core</div>
<div class="content">
<div class="listingblock data-line-700">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">Unresolved directive in for_use_mastering-bitcoin_chapter-3_pt_BR.adoc - include::code/rpc_example.py[]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-705">
<p>Ao executá-lo obtemos o seguinte resultado:</p>
</div>
<div class="listingblock data-line-707">
<div class="content">
<pre>$ python rpc_example.py
394075</pre>
</div>
</div>
<div class="paragraph data-line-712">
<p>Isso nos diz que nosso nó local do Bitcoin Core tem 394.075 blocos em sua blockchain. Não é um resultado espetacular, mas demonstra o uso básico da biblioteca como uma interface simplificada para a API JSON-RPC do Bitcoin Core.</p>
</div>
<div class="paragraph data-line-714">
<p>A seguir, vamos usar as chamadas getrawtransaction e decodetransaction para recuperar os detalhes do pagamento da xícara de café da Alice. No <a href="#rpc_transaction">Recuperando uma transação e iterando suas saídas</a>, recuperamos a transação da Alice e listamos as saídas da transação. Para cada saída, mostramos o endereço e o valor do destinatário. Como lembramos, a transação da Alice teve uma saída pagando a Cafeteria do Bob e uma saída de troco de volta para a Alice.</p>
</div>
<div id="rpc_transaction" class="exampleblock data-line-718">
<div class="title">Example 6. Recuperando uma transação e iterando suas saídas</div>
<div class="content">
<div class="listingblock data-line-720">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">Unresolved directive in for_use_mastering-bitcoin_chapter-3_pt_BR.adoc - include::code/rpc_transaction.py[]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-725">
<p>Executando este código, obtemos:</p>
</div>
<div class="listingblock data-line-727">
<div class="content">
<pre>$ python rpc_transaction.py
([u'1GdK9UzpHBzqzX2A9JFP3Di4weBwqgmoQA'], Decimal('0.01500000'))
([u'1Cdid9KFAaatwczBwBttQcwXYCpvK8h7FK'], Decimal('0.08450000'))</pre>
</div>
</div>
<div class="paragraph data-line-733">
<p>Ambos os exemplos anteriores são bastante simples. Você realmente não precisa de um programa para executá-los; você poderia facilmente usar a ajuda do bitcoin-cli. O próximo exemplo, entretanto, requer várias centenas de chamadas RPC e demonstra mais claramente o uso de uma interface programática.</p>
</div>
<div class="paragraph data-line-735">
<p>No <a href="#rpc_block">Recuperando um bloco e somando todas as saídas de transação</a>, primeiro recuperamos o bloco 277316, em seguida, recuperamos cada uma das 419 transações por referência a cada ID de transação. Em seguida, iteramos por meio de cada uma das saídas de transação e somamos o valor.</p>
</div>
<div id="rpc_block" class="exampleblock data-line-739">
<div class="title">Example 7. Recuperando um bloco e somando todas as saídas de transação</div>
<div class="content">
<div class="listingblock data-line-741">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">Unresolved directive in for_use_mastering-bitcoin_chapter-3_pt_BR.adoc - include::code/rpc_block.py[]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-746">
<p>Executando este código, obtemos:</p>
</div>
<div class="listingblock data-line-748">
<div class="content">
<pre>$ python rpc_block.py

('Valor total no bloco: ', Decimal('10322.07722534'))</pre>
</div>
</div>
<div class="paragraph data-line-754">
<p>Nosso código de exemplo calcula que o valor total transacionado neste bloco é 10.322,07722534 BTC (incluindo 25 BTC de recompensa e 0,0909 BTC em taxas). Compare isso com o valor relatado em um site explorador de blocos, procurando pelo hash ou pela altura do bloco. Alguns exploradores de blocos relatam o valor total excluindo a recompensa e as taxas. Veja se você consegue notar a diferença.</p>
</div>
<div id="alt_libraries" class="paragraph data-line-757">
<p>=== Clientes, Bibliotecas e Kits de Ferramentas Alternativos</p>
</div>
<div class="paragraph data-line-759">
<p>Existem diversos clientes, bibliotecas, kits de ferramentas e até implementações de nó completo alternativos no ecossistema do bitcoin. Eles são implementados em uma variedade de linguagens de programação, oferecendo aos programadores interfaces nativas em sua linguagem preferida.</p>
</div>
<div class="paragraph data-line-761">
<p>As seções a seguir listam algumas das melhores bibliotecas, clientes e kits de ferramentas, organizados por linguagens de programação.</p>
</div>
<div class="paragraph data-line-763">
<p>==== C/C
https://github.com/bitcoin/bitcoin[Bitcoin Core]:: A implementação de referência do bitcoin
https://github.com/libbitcoin/libbitcoin-system[libbitcoin]:: Kit de ferramentas de desenvolvimento, nó e biblioteca de consenso em C para múltiplas plataformas
<a href="https://github.com/libbitcoin/libbitcoin-explorer" data-href="https://github.com/libbitcoin/libbitcoin-explorer">bitcoin explorer</a>:: Ferramenta de linha de comando do Libbitcoin
<a href="https://github.com/jgarzik/picocoin" data-href="https://github.com/jgarzik/picocoin">picocoin</a>:: Biblioteca de linguagem C de cliente leve para o bitcoin, feita por Jeff Garzik</p>
</div>
<div class="paragraph data-line-769">
<p>==== JavaScript
<a href="https://bcoin.io/" data-href="https://bcoin.io/">bcoin</a>:: Uma implementação modular e escalonável de nó completo com API
<a href="https://bitcore.io/" data-href="https://bitcore.io/">Bitcore</a>:: Nó completo, API e biblioteca do Bitpay
<a href="https://github.com/bitcoinjs/bitcoinjs-lib" data-href="https://github.com/bitcoinjs/bitcoinjs-lib">BitcoinJS</a>:: Uma biblioteca de JavaScript puro para node.js e navegadores</p>
</div>
<div class="paragraph data-line-774">
<p>==== Java
<a href="https://bitcoinj.github.io" class="undefined" data-href="https://bitcoinj.github.io">https://bitcoinj.github.io</a> [bitcoinj]:: Uma biblioteca Java de cliente de nó completo</p>
</div>
<div class="paragraph data-line-777">
<p>==== PHP
<a href="https://github.com/bit-wasp/bitcoin-php" data-href="https://github.com/bit-wasp/bitcoin-php">bitwasp/bitcoin</a>:: Uma biblioteca PHP de bitcoin e projetos relacionados</p>
</div>
<div class="paragraph data-line-780">
<p>==== Python
<a href="https://github.com/petertodd/python-bitcoinlib" data-href="https://github.com/petertodd/python-bitcoinlib">python-bitcoinlib</a>:: Uma biblioteca de bitcoin, uma biblioteca de consenso e um nó em Python, feitos por Peter Todd
<a href="https://github.com/richardkiss/pycoin" data-href="https://github.com/richardkiss/pycoin">pycoin</a>:: Uma biblioteca Python de bitcoin feita por Richard Kiss
<a href="https://github.com/primal100/pybitcointools" data-href="https://github.com/primal100/pybitcointools">pybitcointools</a>:: Um fork arquivado de uma biblioteca Python mantido por Vitalik Buterin</p>
</div>
<div class="paragraph data-line-785">
<p>==== Ruby
<a href="https://github.com/sinisterchipmunk/bitcoin-client" data-href="https://github.com/sinisterchipmunk/bitcoin-client">bitcoin-client</a>:: Um wrapper de biblioteca em Ruby para a API JSON-RPC</p>
</div>
<div class="paragraph data-line-788">
<p>==== Go
<a href="https://github.com/btcsuite/btcd" data-href="https://github.com/btcsuite/btcd">btcd</a>:: A Go language full-node Bitcoin client</p>
</div>
<div class="paragraph data-line-791">
<p>==== Rust
<a href="https://github.com/rust-bitcoin/rust-bitcoin" data-href="https://github.com/rust-bitcoin/rust-bitcoin">rust-bitcoin</a>:: Biblioteca Rust de bitcoin para serialização, análise sintática e chamadas de API</p>
</div>
<div class="paragraph data-line-794">
<p>==== C#
<a href="https://github.com/MetacoSA/NBitcoin" data-href="https://github.com/MetacoSA/NBitcoin">NBitcoin</a>:: Biblioteca de bitcoin abrangente para a framework .NET</p>
</div>
<div class="paragraph data-line-797">
<p>==== Objective-C
<a href="https://github.com/oleganza/CoreBitcoin" data-href="https://github.com/oleganza/CoreBitcoin">CoreBitcoin</a>:: Kit de ferramentas Bitcoin para ObjC e Swift</p>
</div>
<div class="paragraph data-line-800">
<p>Muitas outras bibliotecas existem em várias outras linguagens de programação e novas bibliotecas estão constantemente sendo criadas.</p>
</div>
<div id="ch04_keys_addresses" class="paragraph data-line-803">
<p>== Chaves, Endereços</p>
</div>
<div class="paragraph data-line-805">
<p>Você já deve ter ouvido falar que o bitcoin é baseado em <em>criptografia</em>, um ramo da matemática usado extensivamente na segurança de computadores. A palavra criptografia significa "escrita secreta" em grego, mas a ciência da criptografia abrange mais do que apenas a escrita secreta, conhecida como encriptação. A criptografia também pode ser usada para provar o conhecimento de um segredo sem revelar esse segredo (assinatura digital) ou para provar a autenticidade de dados (impressão digital eletrônica). Esses tipos de provas criptográficas são ferramentas matemáticas essenciais para o bitcoin, sendo amplamente utilizadas em aplicações de bitcoin. Ironicamente, a encriptação não é uma parte importante do bitcoin, pois suas comunicações e dados de transação não são encriptados e não precisam ser encriptados para proteger os fundos. Neste capítulo, apresentaremos algumas das criptografias usadas no bitcoin para controlar a propriedade de fundos, na forma de chaves, endereços e carteiras.</p>
</div>
<div class="paragraph data-line-807">
<p>=== Introdução</p>
</div>
<div class="paragraph data-line-809">
<p>Ownership of bitcoin is established through <em>digital keys</em>, <em>Bitcoin addresses</em>, and <em>digital signatures</em>. The digital keys are not actually stored in the network, but are instead created and stored by users in a file, or simple database, called a <em>wallet</em>. The digital keys in a user&#8217;s wallet are completely independent of the Bitcoin protocol and can be generated and managed by the user&#8217;s wallet software without reference to the blockchain or access to the internet. Keys enable many of the interesting properties of bitcoin, including decentralized trust and control, ownership attestation, and the cryptographic-proof security model.</p>
</div>
<div class="paragraph data-line-811">
<p>A maioria das transações de bitcoin necessita de uma assinatura digital válida para ser incluída na <em>blockchain</em> (na cadeia de blocos), que só pode ser gerada com uma chave secreta; portanto, qualquer um com um cópia dessa chave tem o controle dos bitcoins. A assinatura digital usada para gastar os fundos também é chamada de <em>testemunha</em>, um termo utilizado na criptografia. Os dados de testemunha em uma transação de bitcoin atestam a verdadeira posse dos fundos que estão sendo gastos.</p>
</div>
<div class="paragraph data-line-813">
<p> As chaves vêm em pares que consistem em uma chave privada (secreta) e uma chave pública. Imagine que a chave pública é similar ao número de uma conta bancária e que a chave privada é similar a um PIN secreto ou uma assinatura em um cheque, que fornece controle sobre a conta. Estas chaves digitais são raramente vistas pelos usuários do bitcoin. Para a maioria dos usuários, elas ficam armazenadas dentro do arquivo de carteira e são gerenciadas por um software de carteira de bitcoin.</p>
</div>
<div class="paragraph data-line-815">
<p>In the payment portion of a bitcoin transaction, the recipient&#8217;s public key is represented by its digital fingerprint, called a <em>Bitcoin address</em>, which is used in the same way as the beneficiary name on a check (i.e., "Pay to the order of"). In most cases, a Bitcoin address is generated from and corresponds to a public key. However, not all Bitcoin addresses represent public keys; they can also represent other beneficiaries such as scripts, as we will see later in this chapter. This way, Bitcoin addresses abstract the recipient of funds, making transaction destinations flexible, similar to paper checks: a single payment instrument that can be used to pay into people&#8217;s accounts, pay into company accounts, pay for bills, or pay to cash. The Bitcoin address is the only representation of the keys that users will routinely see, because this is the part they need to share with the world.</p>
</div>
<div class="paragraph data-line-817">
<p>Primeiro, apresentaremos a criptografia e explicaremos a matemática usada no bitcoin. A seguir, veremos como as chaves são geradas, armazenadas e gerenciadas. Analisaremos os vários formatos de codificação usados para representar chaves privadas e públicas, endereços e endereços de script. Por fim, veremos o uso avançado de chaves e endereços: endereços personalizados, endereços multiassinatura, endereços de script e carteiras de papel.</p>
</div>
<div class="paragraph data-line-819">
<p>==== Criptografia de Chave Pública e Criptomoeda</p>
</div>
<div class="paragraph data-line-821">
<p>A criptografia de chave pública foi inventada nos anos 1970s e é uma base matemática fundamental para a segurança da computação e para a segurança da informação.</p>
</div>
<div class="paragraph data-line-823">
<p>Desde a invenção da criptografia de chave pública, muitas funções matemáticas úteis foram descobertas, como a exponenciação de números primos e a multiplicação de curva elíptica. Essas funções matemáticas são praticamente irreversíveis, o que significa que elas são fáceis de serem calculadas em uma direção e inviáveis de serem calculadas na direção oposta. Baseando-se nessas funções matemáticas, a criptografia permite a criação de segredos digitais e assinaturas digitais que não podem ser falsificadas. O bitcoin usa a multiplicação de curva elíptica como a base para sua criptografia.</p>
</div>
<div class="paragraph data-line-825">
<p>No bitcoin, usamos a criptografia de chave pública para criar um par de chaves que controla o acesso aos bitcoins. O par de chaves consiste em uma chave privada e uma chave pública única, que é derivada da chave privada. A chave pública é usada para receber os fundos, e a chave privada é usada para assinar transações que gastam os fundos.</p>
</div>
<div class="paragraph data-line-827">
<p>Existe uma relação matemática entre as chaves pública e privada que permite que a chave privada seja usada para gerar assinaturas em mensagens. Essas assinaturas podem ser validadas em relação à chave pública, sem a necessidade de se revelar a chave privada.</p>
</div>
<div class="paragraph data-line-829">
<p>When spending bitcoin, the current bitcoin owner presents her public key and a signature (different each time, but created from the same private key) in a transaction to spend those bitcoin. Through the presentation of the public key and signature, everyone in the Bitcoin network can verify and accept the transaction as valid, confirming that the person transferring the bitcoin owned them at the time of the transfer.</p>
</div>
<div class="admonitionblock tip data-line-832">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-833">
<p>Na maioria das implementações de carteira, as chaves privada e pública são armazenadas juntas, por conveniência, como um <em>par de chaves</em>. No entanto, a chave pública pode ser calculada a partir da chave privada, então também é possível se armazenar apenas a chave privada.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="private_public_keys" class="paragraph data-line-837">
<p>==== Chaves Privada e Pública</p>
</div>
<div class="paragraph data-line-839">
<p>A bitcoin wallet contains a collection of key pairs, each consisting of a private key and a public key. The private key (k) is a number, usually picked at random. From the private key, we use elliptic curve multiplication, a one-way cryptographic function, to generate a public key (K). From the public key (K), we use a one-way cryptographic hash function to generate a Bitcoin address (A). In this section, we will start with generating the private key, look at the elliptic curve math that is used to turn that into a public key, and finally, generate a Bitcoin address from the public key. The relationship between private key, public key, and Bitcoin address is shown in <a href="#k_to_K_to_A">Private key, public key, and Bitcoin address</a>.</p>
</div>
<div id="k_to_K_to_A" class="imageblock data-line-843">
<div class="content">
<img src="images/mbc2_0401.png" alt="privk_to_pubK_to_addressA">
</div>
<div class="title">Figure 14. Private key, public key, and Bitcoin address</div>
</div>
</div>
</div>
<div class="paragraph data-line-46">
<p>Por que a criptografia assimétrica é usada no bitcoin? Ela não é usada para "encriptar" (tornar secretas) as transações. Em vez disso, a utilidade da criptografia assimétrica é a capacidade de gerar <em>assinaturas digitais</em>. Uma chave privada pode ser aplicada à impressão digital de uma transação para produzir uma assinatura numérica. Essa assinatura só pode ser produzida por alguém que saiba a chave privada. No entanto, qualquer pessoa com acesso à chave pública e à impressão digital da transação pode usá-las para <em>verificar</em> a assinatura. Esta propriedade útil da criptografia assimétrica permite que qualquer pessoa possa verificar a assinatura de qualquer transação, enquanto garante que apenas os donos das chaves privadas possam produzir assinaturas válidas.</p>
</div>
<div class="sidebarblock data-line-47">
<div class="content">
<div id="private_keys" class="paragraph data-line-50">
<p>==== Chaves Privadas</p>
</div>
<div class="paragraph data-line-52">
<p>A private key is simply a number, picked at random. Ownership and control over the private key is the root of user control over all funds associated with the corresponding Bitcoin address. The private key is used to create signatures that are required to spend bitcoin by proving ownership of funds used in a transaction. The private key must remain secret at all times, because revealing it to third parties is equivalent to giving them control over the bitcoin secured by that key. The private key must also be backed up and protected from accidental loss, because if it&#8217;s lost it cannot be recovered and the funds secured by it are forever lost, too.</p>
</div>
<div class="admonitionblock tip data-line-55">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-56">
<p>A chave privada do bitcoin é apenas um número. Você pode escolher suas chaves privadas aleatoriamente usando apenas uma moeda, um lápis e um papel: jogue a moeda 256 vezes e você terá os dígitos binários de uma chave privada aleatória que você pode usar em uma carteira de bitcoin. Em seguida, a chave pública pode ser gerada a partir dessa chave privada.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-59">
<p>===== Gerando uma chave privada a partir de um número aleatório</p>
</div>
<div class="paragraph data-line-61">
<p>O primeiro e mais importante passo na geração de chaves é encontrar uma fonte segura de entropia, ou aleatoriedade. Criar uma chave de bitcoin é essencialmente a mesma coisa que pedir para que alguém "Escolha um número entre 1 e 2<sup>256</sup>". O método exato que você usa para escolher esse número não importa, contanto que não seja previsível ou repetível. O software do bitcoin baseia-se em geradores de número aleatório do sistema operacional para produzir 256 bits de entropia (aleatoriedade). Normalmente, o gerador de número aleatório do sistema operacional é inicializado por uma fonte humana de aleatoriedade, razão pela qual você pode ser solicitado a mexer o ponteiro do mouse aleatoriamente por alguns segundos.</p>
</div>
<div class="paragraph data-line-63">
<p>Mais precisamente, a chave privada pode ser qualquer número entre 0 e n - 1, onde n é uma constante (n = 1,158 * 10<sup>77</sup>, ligeiramente menor do que 2<sup>256</sup>) definida como a ordem da curva elíptica usada no bitcoin (ver <a href="#elliptic_curve">[elliptic_curve]</a>). Para criar tal chave, escolhemos aleatoriamente um número de 256 bits e verificamos se ele é menor do que n. Em termos de programação, isto é geralmente obtido fornecendo-se uma <em>string</em> maior de bits aleatórios, coletados a partir de uma fonte de aleatoriedade criptograficamente segura, ao algoritmo de hash SHA256, o qual produzirá convenientemente um número de 256 bits. Se o resultado for menor do que n, temos uma chave privada satisfatória. Caso contrário, simplesmente tentamos novamente com outro número aleatório.</p>
</div>
<div class="admonitionblock warning data-line-66">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-67">
<p>Não escreva o seu próprio código para criar um número aleatório, nem utilize um gerador de número aleatório "simples" oferecido pela sua linguagem de programação. Use um gerador de número pseudo-aleatório criptograficamente seguro (CSPRNG, na sigla em inglês) com uma semente derivada de uma fonte com entropia suficiente. Estude a documentação da biblioteca geradora de número aleatório que você escolher para se certificar de que ela é criptograficamente segura. A correta implementação do CSPRNG é crucial para a segurança das chaves.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-70">
<p>Abaixo vemos uma chave privada (k) gerada aleatoriamente, exibida em formato hexadecimal (256 bits exibidos como 64 dígitos hexadecimais, cada um com 4 bits):</p>
</div>
<div class="listingblock data-line-72">
<div class="content">
<pre>1E99423A4ED27608A15A2616A2B0E9E52CED330AC530EDCC32C8FFC6A526AEDD</pre>
</div>
</div>
<div class="admonitionblock tip data-line-78">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-79">
<p>O tamanho do número de chaves privadas que podem existir no bitcoin é tão grande (2^256), que chega a ser incompreensível. Isso é aproximadamente 10^77 na escala decimal. Para fins comparativos, estima-se que o universo visível contenha 10^80 átomos.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-82">
<p> Para gerar uma nova chave com o cliente Bitcoin Core (veja <a href="#ch03_bitcoin_client">[ch03_bitcoin_client]</a>), use o comando getnewaddress. Por motivos de segurança, ele exibe apenas o endereço, e não a chave privada. Para pedir ao bitcoind para expor a chave privada, use o comando dumpprivkey. O comando dumpprivkey mostra a chave privada em um formato codificado por checksum Base58 chamado <em>Wallet Import Format</em> (WIF), que examinaremos com mais detalhes em <a href="#priv_formats">[priv_formats]</a>. Aqui está um exemplo de geração e exibição de uma chave privada usando estes dois comandos:</p>
</div>
<div class="listingblock data-line-84">
<div class="content">
<pre>$ bitcoin-cli getnewaddress
1J7mdg5rbQyUHENYdx39WVWK7fsLpEoXZy
$ bitcoin-cli dumpprivkey 1J7mdg5rbQyUHENYdx39WVWK7fsLpEoXZy
KxFC1jmwwCoACiCAWZ3eXa96mBM6tb3TYzGmf6YwgdGWZgawvrtJ</pre>
</div>
</div>
<div class="paragraph data-line-91">
<p>O comando dumpprivkey abre a carteira e extrai a chave privada que foi gerada pelo comando getnewaddress. Não é possível para o bitcoind saber a chave privada a partir do endereço, a menos que ambos estejam armazenados na carteira.</p>
</div>
<div class="admonitionblock tip data-line-94">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-95">
<p>O comando dumpprivkey não gera uma chave privada a partir de um endereço, pois isso é impossível. O comando simplesmente revela a chave privada que já é conhecida pela carteira e que foi gerada pelo comando getnewaddress.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph pagebreak-before data-line-99">
<p>Você também pode usar a ferramenta de linha de comando Bitcoin Explorer (ver o <a href="#appdx_bx">[appdx_bx]</a>) para gerar e exibir chaves privadas com os comandos seed, ec-new e ec-to-wif:</p>
</div>
<div class="listingblock data-line-101">
<div class="content">
<pre>$ bx seed | bx ec-new | bx ec-to-wif
5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn</pre>
</div>
</div>
<div id="pubkey" class="paragraph data-line-107">
<p>==== Chaves Públicas</p>
</div>
<div class="paragraph data-line-109">
<p>A chave pública é calculada a partir da chave privada usando multiplicação de curva elíptica, que é irreversível: <em>K</em> = <em>k</em> * <em>G</em>, onde <em>k</em> é a chave privada, <em>G</em> é um ponto constante chamado de <em>ponto gerador</em> e <em>K</em> é a chave pública resultante. A operação inversa, também conhecida como "encontrar o logaritmo discreto"—calcular a chave privada <em>k</em>, se você conhece a chave pública <em>K</em>—é tão difícil quanto tentar todos os possíveis valores de <em>k</em>, ou seja, é uma busca de força bruta. Antes de demonstrarmos como gerar uma chave pública a partir de uma chave privada, vamos analisar a criptografia de curva elíptica em um pouco mais de detalhes.</p>
</div>
<div class="admonitionblock tip data-line-112">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-113">
<p>A multiplicação de curva elíptica é um tipo de função que os profissionais de criptografia chamam de função de "sentido único": ela é fácil de ser feita em uma direção (multiplicação) e impossível de ser feita na direção inversa ("divisão" ou encontrar o logaritmo discreto). O proprietário da chave privada pode facilmente criar a chave pública e depois compartilhá-la com outras pessoas, sabendo que ninguém conseguirá inverter a função e calcular a chave privada a partir da chave pública. Esse truque matemático é a base para as assinaturas digitais infalsificáveis e seguras que comprovam a posse de fundos no bitcoin.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="elliptic_curve" class="paragraph data-line-117">
<p>==== Explicando a Criptografia de Curva Elíptica</p>
</div>
<div class="paragraph data-line-119">
<p>A criptografia de curva elíptica é um tipo de criptografia assimétrica ou criptografia de chave pública baseada em um problema logarítmico discreto que é expressado por adição e multiplicação nos pontos de uma curva elíptica.</p>
</div>
<div class="paragraph data-line-121">
<p>A <a href="#ecc-curve">Uma curva elíptica</a> é um exemplo de uma curva elíptica, similar à utilizada pelo bitcoin.</p>
</div>
<div id="ecc-curve" class="imageblock smallerthirty data-line-126">
<div class="content">
<img src="images/mbc2_0402.png" alt="ecc-curve">
</div>
<div class="title">Figure 15. Uma curva elíptica</div>
</div>
<div class="paragraph data-line-128">
<p>O bitcoin usa uma curva elíptica específica e um conjunto específico de constantes matemáticas, conforme definidos em um padrão chamado secp256k1, estabelecido pelo Instituto Nacional de Padronização e Tecnologia (<em>Institute of Standards and Technology</em> ou NIST). A curva secp256k1 é definida pela seguinte função, que produz uma curva elíptica:</p>
</div>
<div class="stemblock data-line-131">
<div class="content">
\[\begin{equation}
{y^2 = (x^3 + 7)}~\text{over}~(\mathbb{F}_p)
\end{equation}\]
</div>
</div>
<div class="paragraph data-line-137">
<p>ou</p>
</div>
<div class="stemblock data-line-140">
<div class="content">
\[\begin{equation}
{y^2 \mod p = (x^3 + 7) \mod p}
\end{equation}\]
</div>
</div>
<div class="paragraph data-line-146">
<p>O <em>mod p</em> (módulo de número primo p) indica que essa curva está sobre um corpo finito de ordem prima <em>p</em>, também escrito como \(\( \mathbb{F}_p \)\), onde p = 2<sup>256</sup> – 2<sup>32</sup> – 2<sup>9</sup> – 2<sup>8</sup> – 2<sup>7</sup> – 2<sup>6</sup> – 2<sup>4</sup> – 1, um número primo muito grande.</p>
</div>
<div class="paragraph data-line-148">
<p>Como a curva é definida sobre um corpo finito de ordem prima ao invés de números reais, ela parece um padrão de pontos espalhados em duas dimensões, o que a torna difícil de ser visualizada. Contudo, a matemática é idêntica à matemática de uma curva elíptica sobre números reais. Como um exemplo, a <a href="#ecc-over-F17-math">Criptografia de curva elíptica: visualizando uma curva elíptica sobre F(p), com p=17</a> mostra a mesma curva elíptica sobre um corpo finito muito menor, de ordem prima 17, mostrando um padrão de pontos em uma grade. A curva elíptica secp256k1 do bitcoin pode ser imaginada como um padrão muito mais complexo de pontos em uma grade absurdamente grande.</p>
</div>
<div id="ecc-over-F17-math" class="imageblock smallersixty data-line-153">
<div class="content">
<img src="images/mbc2_0403.png" alt="ecc-over-F17-math">
</div>
<div class="title">Figure 16. Criptografia de curva elíptica: visualizando uma curva elíptica sobre F(p), com p=17</div>
</div>
<div class="paragraph data-line-155">
<p>Então, por exemplo, a seguir está um ponto P com coordenadas (x,y) que é um ponto na curva secp256k1:</p>
</div>
<div class="listingblock data-line-157">
<div class="content">
<pre>P = (55066263022277343669578718895168534326250603453777594175500187360389116729240, 32670510020758816978083085130507043184471273380659243275938904335757337482424)</pre>
</div>
</div>
<div class="paragraph data-line-161">
<p>O <a href="#example_4_1">Usando Python para confirmar que este ponto está na curva elíptica</a> mostra como você pode verificar isso por conta própria usando Python:</p>
</div>
<div id="example_4_1" class="exampleblock data-line-165">
<div class="title">Example 8. Usando Python para confirmar que este ponto está na curva elíptica</div>
<div class="content">
<div class="listingblock data-line-167">
<div class="content">
<pre class="highlight"><code class="language-pycon" data-lang="pycon">Python 3.4.0 (padrão, Mar 30 2014, 19:23:13)
[GCC 4.2.1 Compatível com Apple LLVM 5.1 (clang-503.0.38)] no darwin
Digite "help", "copyright", "credits" ou "license" para maiores informações.
&gt;&gt;&gt; p = 115792089237316195423570985008687907853269984665640564039457584007908834671663
&gt;&gt;&gt; x = 55066263022277343669578718895168534326250603453777594175500187360389116729240
&gt;&gt;&gt; y = 32670510020758816978083085130507043184471273380659243275938904335757337482424
&gt;&gt;&gt; (x ** 3 + 7 - y**2) % p
0</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-179">
<p>Na matemática de curva elíptica, existe um ponto chamado "ponto no infinito", que de certo modo corresponde ao papel do zero em uma adição. Em computadores, ele às vezes é representado por x = y = 0 (o que não satisfaz a equação da curva elíptica, mas é um caso isolado fácil, que pode ser verificado).</p>
</div>
<div class="paragraph data-line-181">
<p>Há também um operador +, chamado de "adição", que possui algumas propriedades similares à adição tradicional dos números reais que as crianças aprendem no ensino fundamental. Dados dois pontos P<sub>1</sub> e P<sub>2</sub> na curva elíptica, há um terceiro ponto P<sub>3</sub>= P<sub>1</sub> + P<sub>2</sub>, também na curva elíptica.</p>
</div>
<div class="paragraph data-line-183">
<p>Geometricamente, esse terceiro ponto P<sub>3</sub> é calculado ao desenhar-se uma linha entre os pontos P<sub>1</sub> e P<sub>2</sub>. Essa linha fará a intersecção com a curva elíptica exatamente em um lugar adicional. Chamaremos esse ponto de P<sub>3</sub>' = (x,y). Em seguida, faz-se uma reflexão no eixo x para obter-se o P<sub>3</sub> = (x, -y).</p>
</div>
<div class="paragraph data-line-185">
<p>Existem alguns casos especiais que explicam a necessidade de se ter um "ponto no infinito."</p>
</div>
<div class="paragraph data-line-187">
<p>Se P<sub>1</sub> e P<sub>2</sub> são o mesmo ponto, a linha "entre" P<sub>1</sub> e P<sub>2</sub> deveria estender para ser a tangente na curva no ponto P<sub>1</sub>. Essa tangente fará a intersecção com a curva em um novo ponto exato. Você pode usar técnicas de cálculo para determinar a inclinação da linha tangente. Essas técnicas curiosamente funcionam, mesmo que agora estejamos restringindo nosso interesse para pontos na curva com duas coordenadas de números inteiros!</p>
</div>
<div class="paragraph data-line-189">
<p>Em alguns casos (por exemplo, se P<sub>1</sub> e P<sub>2</sub> têm os mesmos valores x, mas diferentes valores y), a linha entre P<sub>1</sub> e P<sub>2</sub> será exatamente vertical, o que, neste caso, significa que P<sub>3</sub> = "ponto no infinito".</p>
</div>
<div class="paragraph data-line-191">
<p>Se P<sub>1</sub> é o "ponto no infinito", então P<sub>1</sub> + P<sub>2</sub> = P<sub>2</sub>. De modo similar, se P<sub>2</sub> é o ponto no infinito, então P<sub>1</sub> + P<sub>2</sub> = P<sub>1</sub>. Isso mostra como o ponto no infinito faz o papel do zero.</p>
</div>
<div class="paragraph data-line-193">
<p>Além disso, o operador + é associativo, o que significa que (A + B) + C = A + (B + C). Portanto, podemos escrever A + B + C sem parênteses e sem ambiguidade.</p>
</div>
<div class="paragraph data-line-195">
<p>Agora que definimos a adição, podemos definir a multiplicação no modo padrão que estende a adição. Para um ponto P na curva elíptica, se k é um número inteiro, então kP = P + P + P + &#8230;&#8203; + P (k vezes). Note que o k às vezes é confundido como um "expoente" nesse caso.</p>
</div>
<div id="public_key_derivation" class="paragraph data-line-198">
<p>==== Gerando uma Chave Pública</p>
</div>
<div class="paragraph data-line-200">
<p>Começando com uma chave privada na forma de um número <em>k</em> gerado aleatoriamente, o multiplicamos por um ponto predeterminado na curva, chamado de <em>ponto gerador</em> <em>G</em>, para produzir outro ponto em outro lugar na curva, que será a chave pública <em>K</em> correspondente. O ponto gerador é especificado como parte do padrão secp256k1 e é sempre o mesmo para todas as chaves no bitcoin:</p>
</div>
<div class="stemblock data-line-203">
<div class="content">
\[\begin{equation}
{K = k * G}
\end{equation}\]
</div>
</div>
<div class="paragraph data-line-209">
<p>where <em>k</em> is the private key, <em>G</em> is the generator point, and <em>K</em> is the resulting public key, a point on the curve. Because the generator point is always the same for all bitcoin users, a private key <em>k</em> multiplied with <em>G</em> will always result in the same public key <em>K</em>. The relationship between <em>k</em> and <em>K</em> is fixed, but can only be calculated in one direction, from <em>k</em> to <em>K</em>. That&#8217;s why a Bitcoin address (derived from <em>K</em>) can be shared with anyone and does not reveal the user&#8217;s private key (<em>k</em>).</p>
</div>
<div class="admonitionblock tip data-line-212">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-213">
<p>Uma chave privada pode ser convertida em uma chave pública, mas uma chave pública não pode ser convertida de volta em uma chave privada, pois a matemática só funciona em um único sentido.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-216">
<p>Implementando a multiplicação de curva elíptica, podemos usar a chave privada <em>k</em> que foi gerada anteriormente e multiplicá-la pelo ponto gerador G para encontrarmos a chave pública <em>K</em>:</p>
</div>
<div class="listingblock data-line-218">
<div class="content">
<pre>K = 1E99423A4ED27608A15A2616A2B0E9E52CED330AC530EDCC32C8FFC6A526AEDD * G</pre>
</div>
</div>
<div class="paragraph data-line-222">
<p>A chave pública <em>K</em> é definida como um ponto K = (x,y):</p>
</div>
<div class="listingblock data-line-224">
<div class="content">
<pre>K = (x, y)

onde,

x = F028892BAD7ED57D2FB57BF33081D5CFCF6F9ED3D3D7F159C2E2FFF579DC341A
y = 07CF33DA18BD734C600B96A72BBC4749D5141C90EC8AC328AE52DDFE2E505BDB</pre>
</div>
</div>
<div class="paragraph data-line-233">
<p>Para visualizar a multiplicação de um ponto por um número inteiro, usaremos uma curva elíptica mais simples sobre números reais&#x2014;lembre-se, a matemática é a mesma. Nosso objetivo é encontrar o múltiplo <em>kG</em> de um ponto gerador <em>G</em>. Isso é o mesmo que adicionar <em>G</em> a si mesmo, <em>k</em> vezes seguidas. Nas curvas elípticas, adicionar um ponto a si mesmo é o equivalente a desenhar uma linha tangente no ponto, encontrar onde ela intersecciona novamente a curva, e, em seguida, refletir o ponto no eixo x.</p>
</div>
<div class="paragraph data-line-235">
<p>A <a href="#ecc_illustrated">Criptografia de curva elíptica: visualizando a multiplicação de um ponto G por um número inteiro k em uma curva elíptica</a> mostra o processo usado para se derivar <em>G</em>, <em>2G</em>, <em>4G</em> e <em>8G</em> como uma operação geométrica na curva.</p>
</div>
<div class="admonitionblock tip data-line-238">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-239">
<p>O bitcoin usa a <a href="https://github.com/bitcoin-core/secp256k1" data-href="https://github.com/bitcoin-core/secp256k1">biblioteca C otimizada do secp256k1</a> para fazer a matemática de curva elíptica.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="ecc_illustrated" class="imageblock data-line-244">
<div class="content">
<img src="images/mbc2_0404.png" alt="ecc_illustrated">
</div>
<div class="title">Figure 17. Criptografia de curva elíptica: visualizando a multiplicação de um ponto G por um número inteiro k em uma curva elíptica</div>
</div>
<div class="paragraph data-line-246">
<p>=== Endereços de Bitcoin</p>
</div>
<div class="paragraph data-line-248">
<p>A Bitcoin address is a string of digits and characters that can be shared with anyone who wants to send you money. Addresses produced from public keys consist of a string of numbers and letters, beginning with the digit "1". Here&#8217;s an example of a Bitcoin address:</p>
</div>
<div class="listingblock data-line-250">
<div class="content">
<pre>1J7mdg5rbQyUHENYdx39WVWK7fsLpEoXZy</pre>
</div>
</div>
<div class="paragraph data-line-255">
<p>The Bitcoin address is what appears most commonly in a transaction as the "recipient" of the funds. If we compare a bitcoin transaction to a paper check, the Bitcoin address is the beneficiary, which is what we write on the line after "Pay to the order of." On a paper check, that beneficiary can sometimes be the name of a bank account holder, but can also include corporations, institutions, or even cash. Because paper checks do not need to specify an account, but rather use an abstract name as the recipient of funds, they are very flexible payment instruments. Bitcoin transactions use a similar abstraction, the Bitcoin address, to make them very flexible. A Bitcoin address can represent the owner of a private/public key pair, or it can represent something else, such as a payment script, as we will see in <a href="#p2sh">[p2sh]</a>. For now, let&#8217;s examine the simple case, a Bitcoin address that represents, and is derived from, a public key.</p>
</div>
<div class="paragraph data-line-257">
<p>The Bitcoin address is derived from the public key through the use of one-way cryptographic hashing. A "hashing algorithm" or simply "hash algorithm" is a one-way function that produces a fingerprint or "hash" of an arbitrary-sized input. Cryptographic hash functions are used extensively in bitcoin: in Bitcoin addresses, in script addresses, and in the mining Proof-of-Work algorithm. The algorithms used to make a Bitcoin address from a public key are the Secure Hash Algorithm (SHA) and the RACE Integrity Primitives Evaluation Message Digest (RIPEMD), specifically SHA256 and RIPEMD160.</p>
</div>
<div class="paragraph data-line-259">
<p>Iniciando com a chave pública <em>K</em>, computamos o hash SHA256, e depois computamos o hash RIPEMD160 do resultado, produzindo um número de 160 bits (20 bytes):</p>
</div>
<div class="stemblock data-line-262">
<div class="content">
\[\begin{equation}
{A = RIPEMD160(SHA256(K))}
\end{equation}\]
</div>
</div>
<div class="paragraph data-line-268">
<p>where <em>K</em> is the public key and <em>A</em> is the resulting Bitcoin address.</p>
</div>
<div class="admonitionblock tip data-line-272">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-273">
<p>A Bitcoin address is <em>not</em> the same as a public key. Bitcoin addresses are derived from a public key using a one-way function.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-276">
<p>Bitcoin addresses are almost always encoded as "Base58Check" (see <a href="#base58">[base58]</a>), which uses 58 characters (a Base58 number system) and a checksum to help human readability, avoid ambiguity, and protect against errors in address transcription and entry. Base58Check is also used in many other ways in bitcoin, whenever there is a need for a user to read and correctly transcribe a number, such as a Bitcoin address, a private key, an encrypted key, or a script hash. In the next section we will examine the mechanics of Base58Check encoding and decoding and the resulting representations. <a href="#pubkey_to_address">Public key to Bitcoin address: conversion of a public key into a Bitcoin address</a> illustrates the conversion of a public key into a Bitcoin address.</p>
</div>
<div id="pubkey_to_address" class="imageblock data-line-280">
<div class="content">
<img src="images/mbc2_0405.png" alt="pubkey_to_address">
</div>
<div class="title">Figure 18. Public key to Bitcoin address: conversion of a public key into a Bitcoin address</div>
</div>
<div id="base58" class="paragraph data-line-283">
<p>==== Codificação Base58 e Base58Check</p>
</div>
<div class="paragraph data-line-285">
<p>In order to represent long numbers in a compact way, using fewer symbols, many computer systems use mixed-alphanumeric representations with a base (or radix) higher than 10. For example, whereas the traditional decimal system uses the 10 numerals 0 through 9, the hexadecimal system uses 16, with the letters A through F as the six additional symbols. A number represented in hexadecimal format is shorter than the equivalent decimal representation. Even more compact, Base64 representation uses 26 lowercase letters, 26 capital letters, 10 numerals, and 2 more characters such as &#x201c;``&amp;#x201d; and "/" to transmit binary data over text-based media such as email. Base64 is most commonly used to add binary attachments to email. Base58 is a text-based binary-encoding format developed for use in bitcoin and used in many other cryptocurrencies. It offers a balance between compact representation, readability, and error detection and prevention. Base58 is a subset of Base64, using upper- and lowercase letters and numbers, but omitting some characters that are frequently mistaken for one another and can appear identical when displayed in certain fonts. Specifically, Base58 is Base64 without the 0 (number zero), O (capital o), l (lower L), I (capital i), and the symbols &amp;#x201c;``&#x201d; and "/". Or, more simply, it is a set of lowercase and capital letters and numbers without the four (0, O, l, I) just mentioned. <a href="#base58alphabet">Alfabeto Base58 do Bitcoin</a> shows the full Base58 alphabet.</p>
</div>
<div id="base58alphabet" class="exampleblock data-line-289">
<div class="title">Example 9. Alfabeto Base58 do Bitcoin</div>
<div class="content">
<div class="listingblock data-line-290">
<div class="content">
<pre>123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz</pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-296">
<p>To add extra security against typos or transcription errors, Base58Check is a Base58 encoding format, frequently used in bitcoin, which has a built-in error-checking code. The checksum is an additional four bytes added to the end of the data that is being encoded. The checksum is derived from the hash of the encoded data and can therefore be used to detect and prevent transcription and typing errors. When presented with Base58Check code, the decoding software will calculate the checksum of the data and compare it to the checksum included in the code. If the two do not match, an error has been introduced and the Base58Check data is invalid. This prevents a mistyped Bitcoin address from being accepted by the wallet software as a valid destination, an error that would otherwise result in loss of funds.</p>
</div>
<div class="paragraph data-line-298">
<p>To convert data (a number) into a Base58Check format, we first add a prefix to the data, called the "version byte," which serves to easily identify the type of data that is encoded. For example, in the case of a Bitcoin address the prefix is zero (0x00 in hex), whereas the prefix used when encoding a private key is 128 (0x80 in hex). A list of common version prefixes is shown in <a href="#base58check_versions">Prefixos de versão da Base58Check e exemplos de resultados codificados</a>.</p>
</div>
<div class="paragraph data-line-300">
<p>A seguir, computamos o <em>checksum</em> do "duplo-SHA", o que significa que aplicamos o algoritmo de hash SHA256 duas vezes no resultado anterior (prefixo e dados):</p>
</div>
<div class="listingblock data-line-302">
<div class="content">
<pre>checksum = SHA256(SHA256(prefixo+dados))</pre>
</div>
</div>
<div class="paragraph data-line-306">
<p>Pegamos apenas os primeiros quatro bytes do hash de 32 bytes resultante (hash do hash). Esses quatro bytes iniciais servem como código de verificação de erro, ou <em>checksum</em>. O <em>checksum</em> é concatenado (acrescentado) ao final.</p>
</div>
<div class="paragraph data-line-308">
<p>O resultado é composto de três itens: um prefixo, os dados e um <em>checksum</em>. Esse resultado é codificado usando o alfabeto Base58 descrito previamente. A <a href="#base58check_encoding">Codificação em Base58Check: um formato para codificar dados do bitcoin de maneira inequívoca, versionada e verificada.</a> ilustra o processo de codificação em Base58Check.</p>
</div>
<div id="base58check_encoding" class="imageblock data-line-312">
<div class="content">
<img src="images/mbc2_0406.png" alt="Base58CheckEncoding">
</div>
<div class="title">Figure 19. Codificação em Base58Check: um formato para codificar dados do bitcoin de maneira inequívoca, versionada e verificada.</div>
</div>
<div class="paragraph data-line-314">
<p>In bitcoin, most of the data presented to the user is Base58Check-encoded to make it compact, easy to read, and easy to detect errors. The version prefix in Base58Check encoding is used to create easily distinguishable formats, which when encoded in Base58 contain specific characters at the beginning of the Base58Check-encoded payload. These characters make it easy for humans to identify the type of data that is encoded and how to use it. This is what differentiates, for example, a Base58Check-encoded Bitcoin address that starts with a 1 from a Base58Check-encoded private key WIF that starts with a 5. Some example version prefixes and the resulting Base58 characters are shown in <a href="#base58check_versions">Prefixos de versão da Base58Check e exemplos de resultados codificados</a>.</p>
</div>
<table id="base58check_versions" class="tableblock frame-all grid-all stretch data-line-319">
<caption class="title">Table 1. Prefixos de versão da Base58Check e exemplos de resultados codificados</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tipo</th>
<th class="tableblock halign-left valign-top">Prefixo de versão (hex)</th>
<th class="tableblock halign-left valign-top">Prefixo em Base58 (resultado)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endereço de Bitcoin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endereço Pay-to-Script-Hash</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x05</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endereço da Testnet do Bitcoin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x6F</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">m ou n</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Chave Privada WIF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5, K ou L</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Chave Privada Criptografada da BIP-38</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0142</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6P</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Chave Pública Estendida da BIP-32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0488B21E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xpub</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-329">
<p>==== Formatos de Chave</p>
</div>
<div class="paragraph data-line-331">
<p>Both private and public keys can be represented in a number of different formats. These representations all encode the same number, even though they look different. These formats are primarily used to make it easy for people to read and transcribe keys without introducing errors.</p>
</div>
<div id="priv_formats" class="paragraph data-line-334">
<p>===== Formatos de chave privada</p>
</div>
<div class="paragraph data-line-336">
<p>A chave privada pode ser representada em vários formatos diferentes, todos correspondendo ao mesmo número de 256 bits. A <a href="#table_4-2">Representações de chave privada (formatos de codificação)</a> mostra três formatos comumente usados para representar chaves privadas. Diferentes formatos são usados em diferentes circunstâncias. Os formatos hexadecimal e binário bruto são usados internamente no software e raramente são exibidos aos usuários. O formato WIF é usado para importar/exportar chaves entre carteiras e é frequentemente usado em representações de chaves privadas em código QR (código de barras).</p>
</div>
<table id="table_4-2" class="tableblock frame-all grid-all stretch data-line-341">
<caption class="title">Table 2. Representações de chave privada (formatos de codificação)</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tipo</th>
<th class="tableblock halign-left valign-top">Prefixo</th>
<th class="tableblock halign-left valign-top">Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bruto (<em>raw</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nenhum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nenhum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 dígitos hexadecimais</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WIF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Codificação em Base58Check: Base58 com prefixo de versão 0x80 e <em>checksum</em> de 4 bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WIF-comprimida</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">K ou L</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Como acima, com a adição do sufixo 0x01 antes da codificação</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-349">
<p>A <a href="#table_4-3">Exemplo: A mesma chave, em diferentes formatos de codificação</a> demonstra a chave privada gerada nesses três formatos de codificação.</p>
</div>
<table id="table_4-3" class="tableblock frame-all grid-all stretch data-line-354">
<caption class="title">Table 3. Exemplo: A mesma chave, em diferentes formatos de codificação</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Formato</th>
<th class="tableblock halign-left valign-top">Chave privada</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WIF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WIF-comprimida</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KxFC1jmwwCoACiCAWZ3eXa96mBM6tb3TYzGmf6YwgdGWZgawvrtJ</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-361">
<p>Todas essas representações são diferentes maneiras de se exibir o mesmo número, a mesma chave privada. Elas aparentam ser diferentes, mas qualquer um desses formatos pode ser facilmente convertido para qualquer outro formato. Observe que o "binário bruto" não é mostrado na <a href="#table_4-3">Exemplo: A mesma chave, em diferentes formatos de codificação</a>, pois qualquer codificação para exibição aqui não seria considerada, por definição, um dado binário bruto.</p>
</div>
<div class="paragraph data-line-363">
<p>Usamos o comando wif-to-ec do Bitcoin Explorer (ver o <a href="#appdx_bx">[appdx_bx]</a>) para demonstrar que ambas as chaves WIF representam a mesma chave privada:</p>
</div>
<div class="listingblock data-line-365">
<div class="content">
<pre>$ bx wif-to-ec 5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn
1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd

$ bx wif-to-ec KxFC1jmwwCoACiCAWZ3eXa96mBM6tb3TYzGmf6YwgdGWZgawvrtJ
1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd</pre>
</div>
</div>
<div class="paragraph data-line-373">
<p>===== Decodificando do Base58Check</p>
</div>
<div class="paragraph data-line-375">
<p>Os comandos do Bitcoin Explorer (ver o <a href="#appdx_bx">[appdx_bx]</a>) tornam fácil a escrita de scripts em shell e <em>pipes</em> de linha de comando que manipulam chaves, endereços e transações de bitcoin. Você pode usar o Bitcoin Explorer para decodificar o formato Base58Check na linha de comando.</p>
</div>
<div class="paragraph data-line-377">
<p>Usamos o comando base58check-decode para decodificar a chave não comprimida:</p>
</div>
<div class="listingblock data-line-379">
<div class="content">
<pre>$ bx base58check-decode 5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn
wrapper
{
    checksum 4286807748
    payload 1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd
    version 128
}</pre>
</div>
</div>
<div class="paragraph data-line-389">
<p>O resultado contém a chave como corpo de dados (<em>payload</em>), o prefixo de versão 128 da WIF e um <em>checksum</em>.</p>
</div>
<div class="paragraph data-line-391">
<p>Note que o corpo de dados (<em>payload</em>) da chave privada comprimida é acrescido com o sufixo 01, sinalizando que a chave pública derivada deve ser comprimida:</p>
</div>
<div class="listingblock data-line-393">
<div class="content">
<pre>$ bx base58check-decode KxFC1jmwwCoACiCAWZ3eXa96mBM6tb3TYzGmf6YwgdGWZgawvrtJ
wrapper
{
    checksum 2339607926
    payload 1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd01
    version 128
}</pre>
</div>
</div>
<div class="paragraph data-line-403">
<p>====== Codificando de hex para Base58Check</p>
</div>
<div class="paragraph data-line-405">
<p>Para codificar em Base58Check (o oposto do comando anterior), usamos o comando base58check-encode do Bitcoin Explorer (ver <a href="#appdx_bx">[appdx_bx]</a>) e fornecemos a chave privada em hexadecimal, seguida pelo prefixo de versão 128 do WIF:</p>
</div>
<div class="listingblock data-line-407">
<div class="content">
<pre>bx base58check-encode 1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd --version 128
5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn</pre>
</div>
</div>
<div class="paragraph data-line-412">
<p>===== Codificando de hex (chave comprimida) para Base58Check</p>
</div>
<div class="paragraph data-line-414">
<p>Para codificar em Base58Check como uma chave privada "comprimida" (ver <a href="#comp_priv">[comp_priv]</a>), concatenamos o sufixo 01 à chave hexadecimal e em seguida codificamos conforme descrito na seção anterior:</p>
</div>
<div class="listingblock data-line-416">
<div class="content">
<pre>$ bx base58check-encode 1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd01 --version 128
KxFC1jmwwCoACiCAWZ3eXa96mBM6tb3TYzGmf6YwgdGWZgawvrtJ</pre>
</div>
</div>
<div class="paragraph data-line-421">
<p>O formato WIF-comprimida resultante começa com um "K". Isso denota que a chave privada contida tem um sufixo "01" e será usada para produzir apenas chaves públicas comprimidas (ver <a href="#comp_pub">[comp_pub]</a>).</p>
</div>
<div class="paragraph data-line-423">
<p>===== Formatos de chave pública</p>
</div>
<div class="paragraph data-line-425">
<p>As chaves públicas também são apresentadas de diferentes maneiras, geralmente como chaves públicas <em>comprimidas</em> ou <em>não comprimidas</em>.</p>
</div>
<div class="paragraph data-line-427">
<p>Conforme vimos anteriormente, a chave pública é um ponto na curva elíptica que consiste em um par de coordenadas (x,y). Ela geralmente é apresentada com o prefixo 04 seguido por dois números de 256 bits, um para a coordenada <em>x</em> do ponto, e o outro para a coordenada <em>y</em>. O prefixo 04 é usado para distinguir as chaves públicas não comprimidas das chaves públicas comprimidas que começam com 02 ou 03.</p>
</div>
<div class="paragraph data-line-429">
<p>Aqui está a chave pública gerada pela chave privada que criamos anteriormente, mostrada como as coordenadas x e y:</p>
</div>
<div class="listingblock data-line-431">
<div class="content">
<pre>x = F028892BAD7ED57D2FB57BF33081D5CFCF6F9ED3D3D7F159C2E2FFF579DC341A
y = 07CF33DA18BD734C600B96A72BBC4749D5141C90EC8AC328AE52DDFE2E505BDB</pre>
</div>
</div>
<div class="paragraph data-line-436">
<p>Aqui está a mesma chave pública mostrada como um número de 520 bits (130 dígitos hexadecimais) com o prefixo 04 seguido pelas coordenadas x e y, como 04 x y:</p>
</div>
<pre data-type="programlisting">
K = 04F028892BAD7ED57D2FB57BF33081D5CFCF6F9ED3D3D7F159C2E2FFF579DC341A&#x21b5;
07CF33DA18BD734C600B96A72BBC4749D5141C90EC8AC328AE52DDFE2E505BDB
</pre>
<div id="comp_pub" class="paragraph data-line-446">
<p>===== Chaves públicas comprimidas</p>
</div>
<div class="paragraph data-line-448">
<p>Compressed public keys were introduced to bitcoin to reduce the size of transactions and conserve disk space on nodes that store the Bitcoin blockchain database. Most transactions include the public key, which is required to validate the owner&#8217;s credentials and spend the bitcoin. Each public key requires 520 bits (prefix + x + y), which when multiplied by several hundred transactions per block, or tens of thousands of transactions per day, adds a significant amount of data to the blockchain.</p>
</div>
<div class="paragraph data-line-450">
<p>Conforme vimos na seção <a href="#pubkey">[pubkey]</a>, uma chave pública é um ponto (x,y) em uma curva elíptica. Como a curva expressa uma função matemática, um ponto na curva representa uma solução para a equação e, portanto, se soubermos a coordenada <em>x</em>, podemos calcular a coordenada <em>y</em> ao resolver a equação y<sup>2</sup> mod p = (x<sup>3</sup> + 7) mod p. Isso nos permite armazenar somente a coordenada <em>x</em> do ponto da chave pública, omitindo a coordenada <em>y</em> e reduzindo o tamanho da chave e o espaço necessário para armazená-la em 256 bits. Uma redução de quase 50% no tamanho de cada transação economiza a utilização de muito espaço ao longo do tempo!</p>
</div>
<div class="paragraph data-line-452">
<p>Enquanto as chaves públicas não comprimidas tem o prefixo 04, as chaves públicas comprimidas começam com os prefixos 02 ou 03. Existe um motivo pelo qual só existem dois prefixos possíveis: como o lado esquerdo da equação é <em>y</em><sup>2</sup>, a solução para <em>y</em> é uma raiz quadrada, que pode ter um valor positivo ou negativo. Visualmente, isso significa que a coordenada <em>y</em> resultante pode estar acima ou abaixo do eixo x. Como você pode ver no gráfico da curva elíptica na <a href="#ecc-curve">Uma curva elíptica</a>, a curva é simétrica, sendo refletida pelo eixo x, como se fosse um espelho. Então, embora podemos omitir a coordenada <em>y</em>, temos que armazenar o <em>sinal</em> do <em>y</em> (positivo ou negativo); ou, em outras palavras, temos que nos lembrar se ela estava acima ou abaixo do eixo x, pois cada uma dessas opções representa um ponto diferente e uma chave pública diferente. Quando se calcula a curva elíptica em aritmética binária no corpo finito de ordem prima p, a coordenada <em>y</em> ou é par ou é ímpar, o que corresponde ao sinal positivo/negativo como explicado anteriormente. Portanto, para distinguir entre os dois valores possíveis de <em>y</em>, armazenamos a chave pública comprimida com o prefixo 02 se o <em>y</em> for par, e 03 se ele for ímpar, permitindo que o software deduza corretamente a coordenada <em>y</em> a partir da coordenada <em>x</em> e descomprima a chave pública para as coordenadas completas do ponto. A compressão de chave pública é ilustrada na <a href="#pubkey_compression">Compressão de chave pública</a>.</p>
</div>
<div class="paragraph data-line-454">
<p>Aqui está a mesma chave pública gerada anteriormente, exibida como uma chave pública comprimida armazenada em 264 bits (66 dígitos hexadecimais) com o prefixo 03 indicando que a coordenada <em>y</em> é ímpar:</p>
</div>
<div class="listingblock data-line-456">
<div class="content">
<pre>K = 03F028892BAD7ED57D2FB57BF33081D5CFCF6F9ED3D3D7F159C2E2FFF579DC341A</pre>
</div>
</div>
<div class="paragraph data-line-460">
<p>This compressed public key corresponds to the same private key, meaning it is generated from the same private key. However, it looks different from the uncompressed public key. More importantly, if we convert this compressed public key to a Bitcoin address using the double-hash function (RIPEMD160(SHA256(K))) it will produce a <em>different</em> Bitcoin address. This can be confusing, because it means that a single private key can produce a public key expressed in two different formats (compressed and uncompressed) that produce two different Bitcoin addresses. However, the private key is identical for both Bitcoin addresses.</p>
</div>
<div id="pubkey_compression" class="imageblock smallerseventy data-line-465">
<div class="content">
<img src="images/mbc2_0407.png" alt="pubkey_compression">
</div>
<div class="title">Figure 20. Compressão de chave pública</div>
</div>
<div class="paragraph data-line-467">
<p>Compressed public keys are gradually becoming the default across Bitcoin clients, which is having a significant impact on reducing the size of transactions and therefore the blockchain. However, not all clients support compressed public keys yet. Newer clients that support compressed public keys have to account for transactions from older clients that do not support compressed public keys. This is especially important when a wallet application is importing private keys from another bitcoin wallet application, because the new wallet needs to scan the blockchain to find transactions corresponding to these imported keys. Which Bitcoin addresses should the bitcoin wallet scan for? The Bitcoin addresses produced by uncompressed public keys, or the Bitcoin addresses produced by compressed public keys? Both are valid Bitcoin addresses, and can be signed for by the private key, but they are different addresses!</p>
</div>
<div class="paragraph data-line-469">
<p>To resolve this issue, when private keys are exported from a wallet, the WIF that is used to represent them is implemented differently in newer bitcoin wallets, to indicate that these private keys have been used to produce <em>compressed</em> public keys and therefore <em>compressed</em> Bitcoin addresses. This allows the importing wallet to distinguish between private keys originating from older or newer wallets and search the blockchain for transactions with Bitcoin addresses corresponding to the uncompressed, or the compressed, public keys, respectively. Let&#8217;s look at how this works in more detail, in the next section.</p>
</div>
<div id="comp_priv" class="paragraph data-line-472">
<p>===== Chaves privadas comprimidas</p>
</div>
<div class="paragraph data-line-474">
<p>Ironicamente, o termo "chave privada comprimida" não é um nome muito preciso, pois quando uma chave privada é exportada como WIF-comprimida, ela é na verdade um byte <em>maior</em> do que uma chave privada "não comprimida". Isso acontece porque a chave privada tem um sufixo adicional de um byte (mostrado como 01 no hexadecimal na <a href="#table_4-4">Exemplo: A mesma chave, em diferentes formatos de codificação</a>), o que significa que a chave privada é de uma carteira moderna e só deve ser usada para produzir chaves públicas comprimidas. As chaves privadas em si não são comprimidas e não há como comprimi-las. O que o termo "chave privada comprimida" realmente significa é "chave privada a partir da qual somente chaves públicas comprimidas devem ser derivadas", enquanto o que o termo "chave privada não comprimida" realmente significa é "chave privada a partir da qual somente chaves públicas não comprimidas devem ser derivadas". É recomendado que você se refira ao formato de exportação apenas como "WIF-comprimida" ou "WIF" e, para evitar maiores confusões, que você evite se referir à chave privada em si como "comprimida".</p>
</div>
<div class="paragraph data-line-476">
<p>A <a href="#table_4-4">Exemplo: A mesma chave, em diferentes formatos de codificação</a> mostra a mesma chave, codificada nos formatos WIF e WIF-comprimida.</p>
</div>
<table id="table_4-4" class="tableblock frame-all grid-all stretch data-line-481">
<caption class="title">Table 4. Exemplo: A mesma chave, em diferentes formatos de codificação</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Formato</th>
<th class="tableblock halign-left valign-top">Chave privada</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1E99423A4ED27608A15A2616A2B0E9E52CED330AC530EDCC32C8FFC6A526AEDD</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WIF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hex-comprimida</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1E99423A4ED27608A15A2616A2B0E9E52CED330AC530EDCC32C8FFC6A526AEDD01</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WIF-comprimida</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KxFC1jmwwCoACiCAWZ3eXa96mBM6tb3TYzGmf6YwgdGWZgawvrtJ</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-489">
<p>Observe que a chave privada hex-comprimida tem um byte extra no final (01 em hexadecimal). Embora o prefixo de versão da Base58Check seja o mesmo (0x80) para os formatos WIF e WIF-comprimida, a adição de um byte no final do número faz com que o primeiro caractere da codificação Base58 mude de 5 para <em>K</em> ou <em>L</em>. Pense nisso como sendo o equivalente Base58 da diferença de codificação decimal entre o número 100 e o número 99. Embora 100 seja um dígito mais longo que 99, ele também tem um prefixo 1 ao invés de um prefixo 9. À medida que o comprimento muda, isso afeta o prefixo. Na Base58, o prefixo 5 muda para <em>K</em> ou <em>L</em> conforme o comprimento do número aumenta em um byte.</p>
</div>
<div class="paragraph data-line-491">
<p>Lembre-se de que esses formatos <em>não são</em> intercambiáveis. Em uma carteira moderna que implementa chaves públicas comprimidas, as chaves privadas só serão exportadas como WIF-comprimidas (com um prefixo <em>K</em> ou <em>L</em>). Se a carteira tiver uma implementação mais antiga e não usar chaves públicas comprimidas, as chaves privadas só serão exportadas como WIF (com um prefixo 5). O objetivo disso é sinalizar para a carteira que está importando essas chaves privadas se ela precisa pesquisar na blockchain por chaves públicas e endereços comprimidos ou não comprimidos.</p>
</div>
<div class="paragraph data-line-493">
<p>If a bitcoin wallet is able to implement compressed public keys, it will use those in all transactions. The private keys in the wallet will be used to derive the public key points on the curve, which will be compressed. The compressed public keys will be used to produce Bitcoin addresses and those will be used in transactions. When exporting private keys from a new wallet that implements compressed public keys, the WIF is modified, with the addition of a one-byte suffix 01 to the private key. The resulting Base58Check-encoded private key is called a "compressed WIF" and starts with the letter <em>K</em> or <em>L</em>, instead of starting with "5" as is the case with WIF-encoded (noncompressed) keys from older wallets.</p>
</div>
<div class="admonitionblock tip data-line-497">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-498">
<p>"Compressed private keys" is a misnomer! They are not compressed; rather, WIF-compressed signifies that the keys should only be used to derive compressed public keys and their corresponding Bitcoin addresses. Ironically, a "WIF-compressed" encoded private key is one byte longer because it has the added 01 suffix to distinguish it from an "uncompressed" one.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-501">
<p>=== Implementando Chaves e Endereços em C++</p>
</div>
<div class="paragraph data-line-503">
<p>Let&#8217;s look at the complete process of creating a Bitcoin address, from a private key, to a public key (a point on the elliptic curve), to a double-hashed address, and finally, the Base58Check encoding. The C++ code in <a href="#addr_example">Creating a Base58Check-encoded Bitcoin address from a private key</a> shows the complete step-by-step process, from private key to Base58Check-encoded Bitcoin address. The code example uses the libbitcoin library introduced in <a href="#alt_libraries">[alt_libraries]</a> for some helper functions.</p>
</div>
<div id="addr_example" class="exampleblock data-line-507">
<div class="title">Example 10. Creating a Base58Check-encoded Bitcoin address from a private key</div>
<div class="content">
<div class="listingblock c_less_space data-line-510">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">Unresolved directive in for_use_mastering-bitcoin_chapter-4_pt_BR.adoc - include::code/addr.cpp[]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-515">
<p>The code uses a predefined private key to produce the same Bitcoin address every time it is run, as shown in <a href="#addr_example_run">Compilando e executando o código addr.cpp</a>.</p>
</div>
<div id="addr_example_run" class="exampleblock data-line-519">
<div class="title">Example 11. Compilando e executando o código addr.cpp</div>
<div class="content">
<div class="listingblock data-line-521">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># Compila o código addr.cpp
$ g++ -o addr addr.cpp -std=c++11 $(pkg-config --cflags --libs libbitcoin)
# Roda o executável addr
$ ./addr
Chave pública: 0202a406624211f2abbdc68da3df929f938c3399dd79fac1b51b0e4ad1d26a47aa
Endereço: 1PRTTaJesdNovgne6Ehcdu1fpEdX7913CK</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip data-line-532">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-533">
<p>The code in <a href="#addr_example_run">Compilando e executando o código addr.cpp</a> produces a Bitcoin address (1PRTT...) from a <em>compressed</em> public key (see <a href="#comp_pub">[comp_pub]</a>). If you used the uncompressed public key instead, it would produce a different Bitcoin address (14K1y...).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-536">
<p>=== Implementando Chaves e Endereços em Python</p>
</div>
<div class="paragraph data-line-538">
<p>A biblioteca de bitcoin mais completa em Python é a <a href="https://github.com/vbuterin/pybitcointools" data-href="https://github.com/vbuterin/pybitcointools">pybitcointools</a> feita por Vitalik Buterin. No <a href="#key-to-address_script">Geração e formatação de chaves e endereços com a biblioteca pybitcointools</a>, usamos a biblioteca pybitcointools (importada como "bitcoin") para gerar e exibir chaves e endereços em vários formatos.</p>
</div>
<div id="key-to-address_script" class="exampleblock data-line-542">
<div class="title">Example 12. Geração e formatação de chaves e endereços com a biblioteca pybitcointools</div>
<div class="content">
<div class="listingblock data-line-544">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">Unresolved directive in for_use_mastering-bitcoin_chapter-4_pt_BR.adoc - include::code/key-to-address-ecc-example.py[]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-549">
<p>O <a href="#key-to-address_script_run">Executando key-to-address-ecc-example.py</a> mostra o output após executar esse código.</p>
</div>
<div id="key-to-address_script_run" class="exampleblock data-line-553">
<div class="title">Example 13. Executando key-to-address-ecc-example.py</div>
<div class="content">
<pre data-type="programlisting">
$ python key-to-address-ecc-example.py
A Chave Privada (hex) é:
 3aba4162c7251c891207b747840551a71939b0de081f85c4e44cf7c13e41daa6
A Chave Privada (decimal) é:
 26563230048437957592232553826663696440606756685920117476832299673293013768870
A Chave Privada (WIF) é:
 5JG9hT3beGTJuUAmCQEmNaxAuMacCTfXuw1R3FCXig23RQHMr4K
A Chave Privada Comprimida (hex) é:
 3aba4162c7251c891207b747840551a71939b0de081f85c4e44cf7c13e41daa601
A Chave Privada (WIF-Comprimida) é:
 KyBsPXxTuVD82av65KZkrGrWi5qLMah5SdNq6uftawDbgKa2wv6S
A Chave Pública em coordenadas (x,y) é:
 (41637322786646325214887832269588396900663353932545912953362782457239403430124L,
 16388935128781238405526710466724741593761085120864331449066658622400339362166L)
A Chave Pública (hex) é:
 045c0de3b9c8ab18dd04e3511243ec2952002dbfadc864b9628910169d9b9b00ec&#x21b5;
243bcefdd4347074d44bd7356d6a53c495737dd96295e2a9374bf5f02ebfc176
A Chave Pública Comprimida (hex) é:
 025c0de3b9c8ab18dd04e3511243ec2952002dbfadc864b9628910169d9b9b00ec
O Endereço de Bitcoin (b58check) é:
 1thMirt546nngXqyPEz532S8fLwbozud8
O Endereço de Bitcoin Comprimido (b58check) é:
 14cxpo3MBCYYWCgF74SWTdcmxipnGUsPw3
</pre>
</div>
</div>
<div class="paragraph data-line-584">
<p>O <a href="#ec_math">Um script demonstrado a matemática de curva elíptica usada para as chaves do bitcoin</a> é outro exemplo, que usa a biblioteca Python de ECDSA para a matemática de curva elíptica e não usa nenhuma biblioteca especializada de bitcoin.</p>
</div>
<div id="ec_math" class="exampleblock data-line-588">
<div class="title">Example 14. Um script demonstrado a matemática de curva elíptica usada para as chaves do bitcoin</div>
<div class="content">
<div class="listingblock data-line-590">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">Unresolved directive in for_use_mastering-bitcoin_chapter-4_pt_BR.adoc - include::code/ec-math.py[]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-595">
<p>O <a href="#ec_math_run">Instalando a biblioteca Python de ECDSA e executando o script ec_math.py</a> mostra a saída produzida ao executar-se esse script.</p>
</div>
<div class="admonitionblock warning data-line-598">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-599">
<p>O <a href="#ec_math">Um script demonstrado a matemática de curva elíptica usada para as chaves do bitcoin</a> usa o os.urandom, que reflete um gerador de número aleatório criptograficamente seguro (CSRNG) fornecido pelo sistema operacional subjacente. Cuidado: dependendo do sistema operacional, é possível que o os.urandom <em>não</em> seja implementado com segurança suficiente ou que ele não use uma semente aleatória adequada e, em função disso, pode ser que ele <em>não</em> seja apropriado para gerar chaves de bitcoin com qualidade suficiente para serem usadas em produção.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="ec_math_run" class="exampleblock data-line-604">
<div class="title">Example 15. Instalando a biblioteca Python de ECDSA e executando o script ec_math.py</div>
<div class="content">
<div class="listingblock data-line-605">
<div class="content">
<pre># Instala o administrador de pacotes Python PIP
$ sudo apt-get install python-pip
# Instala a biblioteca Python de ECDSA
$ sudo pip install ecdsa
# Executa o script
$ python ec-math.py
Segredo: 38090835015954358862481132628887443905906204995912378278060168703580660294000
Ponto na CE: (70048853531867179489857750497606966272382583471322935454624595540007269312627, 105262206478686743191060800263479589329920209527285803935736021686045542353380)
Chave pública do BTC: 029ade3effb0a67d5c8609850d797366af428f4a0d5194cb221d807770a1522873</pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-618">
<p>=== Chaves e Endereços Avançados</p>
</div>
<div class="paragraph data-line-620">
<p>Nas próximas seções, veremos as formas avançadas de chaves e endereços, como chaves privadas criptografadas, scripts e endereços multiassinatura, endereços personalizados e carteiras de papel.</p>
</div>
<div id="p2sh_addresses" class="paragraph data-line-623">
<p>==== Endereços Pay-to-Script Hash (P2SH) e Multiassinatura</p>
</div>
<div class="paragraph data-line-625">
<p>As we know, traditional Bitcoin addresses begin with the number “1” and are derived from the public key, which is derived from the private key.  Although anyone can send bitcoin to a “1” address, that bitcoin can only be spent by presenting the corresponding private key signature and public key.</p>
</div>
<div class="paragraph data-line-627">
<p>Bitcoin addresses that begin with the number “3” are pay-to-script hash (P2SH) addresses, sometimes erroneously called multisignature or multisig addresses. They designate the beneficiary of a bitcoin transaction as the hash of a script, instead of the owner of a public key. The feature was introduced in January 2012 with BIP-16 (see <a href="#appdxbitcoinimpproposals">[appdxbitcoinimpproposals]</a>), and is being widely adopted because it provides the opportunity to add functionality to the address itself. Unlike transactions that "send" funds to traditional “1” Bitcoin addresses, also known as a pay-to-public-key-hash (P2PKH), funds sent to “3” addresses require something more than the presentation of one public key and one private key signature as proof of ownership. The requirements are designated at the time the address is created, within the script, and all inputs to this address will be encumbered with the same requirements.</p>
</div>
<div class="paragraph data-line-629">
<p>A P2SH address is created from a transaction script, which defines who can spend a transaction output (for more details, see <a href="#p2sh">[p2sh]</a>). Encoding a P2SH address involves using the same double-hash function as used during creation of a Bitcoin address, only applied on the script instead of the public key:</p>
</div>
<div class="listingblock data-line-631">
<div class="content">
<pre>hash do script = RIPEMD160(SHA256(script))</pre>
</div>
</div>
<div class="paragraph data-line-635">
<p>O "hash de script" resultante é codificado em Base58Check com um prefixo de versão 5, que resulta em um endereço codificado que inicia com um 3. Um exemplo de endereço P2SH é 3F6i6kwkevjR7AsAd4te2YB2zZyASEm1HM, que pode ser derivado usando-se os comandos script-encode, sha256, ripemd160 e base58check-encode do Bitcoin Explorer (ver o <a href="#appdx_bx">[appdx_bx]</a>), como demonstrado a seguir:</p>
</div>
<div class="listingblock data-line-637">
<div class="content">
<pre>$ echo \
'DUP HASH160 [89abcdefabbaabbaabbaabbaabbaabbaabbaabba] EQUALVERIFY CHECKSIG' &gt; script
$ bx script-encode &lt; script | bx sha256 | bx ripemd160 \
| bx base58check-encode --version 5
3F6i6kwkevjR7AsAd4te2YB2zZyASEm1HM</pre>
</div>
</div>
<div class="admonitionblock tip data-line-646">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-647">
<p>P2SH não necessariamente é o mesmo que uma transação multiassinatura padrão. Um endereço P2SH <em>geralmente</em> representa um script multiassinatura, mas ele também pode representar um script codificando outros tipos de transações.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-650">
<p>===== Endereços multiassinatura e P2SH</p>
</div>
<div class="paragraph data-line-652">
<p>Atualmente, a implementação mais comum da função P2SH é o script de endereço multiassinatura. Como o nome sugere, o script subjacente exige um número mínimo de assinaturas para provar a posse e, portanto, gastar os fundos. A funcionalidade de multiassinatura do bitcoin é projetada para exigir M assinaturas (também conhecidas como o "limiar", em inglês, <em>threshold</em>) de um total de N chaves, o que é conhecido como uma multiassinatura M-de-N, onde M é igual ou menor do que N. Por exemplo, Bob, o dono da cafeteria do <a href="#ch01_intro_what_is_bitcoin">Introdução</a> poderia usar um endereço multiassinatura exigindo 1-de-2 assinaturas geradas a partir da chave que o pertence e de uma chave que pertence à sua esposa, garantindo que qualquer um deles poderia fazer uma assinatura para gastar uma saída de transação travada nesse endereço. Isso seria semelhante a uma "conta conjunta" em um banco tradicional, onde qualquer um dos cônjuges pode gastar sozinho com a sua própria assinatura. Ou o Gopesh, o web designer que o Bob contratou para criar um site, poderia ter um endereço multiassinatura 2-de-3 para o seu negócio, para garantir que nenhum fundo possa ser gasto a menos que dois de seus sócios assinem uma transação.</p>
</div>
<div class="paragraph data-line-654">
<p>Exploraremos como criar transações que gastam fundos de endereços P2SH (e multiassinatura) no <a href="#transactions">[transactions]</a>.</p>
</div>
<div class="paragraph data-line-656">
<p>==== Endereços Personalizados</p>
</div>
<div class="paragraph data-line-658">
<p>Vanity addresses are valid Bitcoin addresses that contain human-readable messages. For example, 1LoveBPzzD72PUXLzCkYAtGFYmK5vYNR33 is a valid address that contains the letters forming the word "Love" as the first four Base58 letters. Vanity addresses require generating and testing billions of candidate private keys, until a Bitcoin address with the desired pattern is found. Although there are some optimizations in the vanity generation algorithm, the process essentially involves picking a private key at random, deriving the public key, deriving the Bitcoin address, and checking to see if it matches the desired vanity pattern, repeating billions of times until a match is found.</p>
</div>
<div class="paragraph data-line-660">
<p>Assim que um endereço personalizado correspondendo ao padrão desejado for encontrado, a chave privada da qual ele foi derivado pode ser usada pelo dono para gastar os bitcoins da mesma maneira como se fosse qualquer outro endereço. Os endereços personalizados não são mais ou menos seguros do que qualquer outro endereço. Eles dependem da mesma Criptografia de Curva Elíptica (ECC) e do mesmo Algoritmo de Hash Seguro (SHA) como qualquer outro endereço. Não é mais fácil descobrir a chave privada de um endereço que começa com um padrão personalizado, em comparação com qualquer outro endereço.</p>
</div>
<div class="paragraph data-line-662">
<p>In <a href="#ch01_intro_what_is_bitcoin">Introdução</a>, we introduced Eugenia, a children&#8217;s charity director operating in the Philippines. Let&#8217;s say that Eugenia is organizing a bitcoin fundraising drive and wants to use a vanity Bitcoin address to publicize the fundraising. Eugenia will create a vanity address that starts with "1Kids" to promote the children&#8217;s charity fundraiser. Let&#8217;s see how this vanity address will be created and what it means for the security of Eugenia&#8217;s charity.</p>
</div>
<div class="paragraph data-line-664">
<p>===== Gerando endereços personalizados</p>
</div>
<div class="paragraph data-line-666">
<p>It&#8217;s important to realize that a Bitcoin address is simply a number represented by symbols in the Base58 alphabet. The search for a pattern like "1Kids" can be seen as searching for an address in the range from 1Kids11111111111111111111111111111 to 1Kidszzzzzzzzzzzzzzzzzzzzzzzzzzzzz. There are approximately 58<sup>29</sup> (approximately 1.4 * 10<sup>51</sup>) addresses in that range, all starting with "1Kids." <a href="#table_4-11">O intervalo de endereços personalizados iniciando com "1Kids"</a> shows the range of addresses that have the prefix 1Kids.</p>
</div>
<table id="table_4-11" class="tableblock frame-all grid-all stretch data-line-670">
<caption class="title">Table 5. O intervalo de endereços personalizados iniciando com "1Kids"</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>De</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1Kids11111111111111111111111111111</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1Kids11111111111111111111111111112</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1Kids11111111111111111111111111113</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">...</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Até</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1Kidszzzzzzzzzzzzzzzzzzzzzzzzzzzzz</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-678">
<p>Let&#8217;s look at the pattern "1Kids" as a number and see how frequently we might find this pattern in a Bitcoin address (see <a href="#table_4-12">A frequência de um padrão personalizado (1KidsCharity) e o tempo médio de busca em um computador desktop</a>). An average desktop computer PC, without any specialized hardware, can search approximately 100,000 keys per second.</p>
</div>
<table id="table_4-12" class="tableblock frame-all grid-all stretch data-line-683">
<caption class="title">Table 6. A frequência de um padrão personalizado (1KidsCharity) e o tempo médio de busca em um computador desktop</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Comprimento</th>
<th class="tableblock halign-left valign-top">Padrão</th>
<th class="tableblock halign-left valign-top">Frequência</th>
<th class="tableblock halign-left valign-top">Tempo médio de busca</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1K</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 em 58 chaves</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt; 1 milissegundo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1Ki</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 em 3.364</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">50 milissegundos</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1Kid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 em 195.000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt; 2 segundos</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1Kids</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 em 11 milhões</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 minuto</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1KidsC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 em 656 milhões</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 hora</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1KidsCh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 em 38 bilhões</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 dias</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1KidsCha</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 em 2,2 trilhões</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3–4 meses</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1KidsChar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 em 128 trilhões</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13–18 anos</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1KidsChari</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 em 7 quadrilhões</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">800 anos</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1KidsCharit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 em 400 quadrilhões</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">46.000 anos</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1KidsCharity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 em 23 quintilhões</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2,5 milhões de anos</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-699">
<p>Como você pode ver, a Eugênia não conseguirá criar o endereço personalizado "1KidsCharity" tão cedo, mesmo que ela tivesse acesso a milhares de computadores. Cada caractere adicional aumenta a dificuldade em um fator de 58. Os padrões de sete ou mais caracteres geralmente são encontrados utilizando-se hardware especializado, como desktops montados de maneira customizada com múltiplas placas de vídeo (GPUs). Esses hardwares frequentemente são equipamentos antigos que já foram usados para a mineração do bitcoin e que não são mais lucrativos para esse propósito, mas que ainda podem ser usados para buscar endereços personalizados. As buscas por endereços personalizados em sistemas usando placas de vídeo (GPUs) são várias ordens de magnitude mais rápidas do que as realizadas em sistemas usando processadores de propósito geral (CPUs).</p>
</div>
<div class="paragraph data-line-701">
<p>Outra maneira de encontrar um endereço personalizado é terceirizar o trabalho para uma pool vanity de mineradores, como a <a href="https://vanitypool.appspot.com" data-href="https://vanitypool.appspot.com">Vanity Pool</a>. Uma pool desse tipo é um serviço que permite que aqueles com hardware de GPU ganhem bitcoin procurando endereços personalizados para os outros. Por um pequeno pagamento (0,01 bitcoin ou aproximadamente USD $5 no momento da redação deste artigo), a Eugenia pode terceirizar a pesquisa por um endereço personalizado com padrão de sete caracteres e obter resultados em algumas horas, em vez que executar uma pesquisa usando uma CPU levaria meses.</p>
</div>
<div class="paragraph data-line-703">
<p>A geração de um endereço personalizado é um exercício de força bruta: crie uma chave aleatória, verifique se o endereço resultante corresponde ao padrão desejado e repita o processo até encontrar um endereço que corresponda. O <a href="#vanity_miner_code">Minerador de endereço personalizado</a> mostra um exemplo de um "minerador de endereço personalizado" (em inglês, <em>vanity miner</em>), um programa projetado para buscar endereços personalizados, escrito em C++. O exemplo usa a biblioteca libbitcoin, que apresentamos em <a href="#alt_libraries">[alt_libraries]</a>.</p>
</div>
<div id="vanity_miner_code" class="exampleblock data-line-707">
<div class="title">Example 16. Minerador de endereço personalizado</div>
<div class="content">
<div class="listingblock data-line-709">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">Unresolved directive in for_use_mastering-bitcoin_chapter-4_pt_BR.adoc - include::code/vanity-miner.cpp[]</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note data-line-715">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-716">
<p>O <a href="#vanity_miner_code">Minerador de endereço personalizado</a> usa o std::random_device. Dependendo da implementação, ele pode refletir um gerador de número aleatório criptograficamente seguro fornecido pelo sistema operacional subjacente. No caso de um sistema operacional do tipo Unix, como o Linux, ele é obtido a partir do /dev/urandom. O gerador de número aleatório utilizado aqui é usado apenas para fins de demonstração e <em>não</em> é apropriado para gerar chaves de bitcoin com qualidade para serem usadas em produção, pois ele não é implementado com segurança suficiente.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-719">
<p>O código de exemplo deve ser compilado usando um compilador C++ e vinculado à biblioteca libbitcoin (que deve ser previamente instalada no sistema). Para executar o exemplo, rode o executável vanity-miner sem nenhum parâmetro (ver o <a href="#vanity_miner_run">Compilando e executando o exemplo <em>vanity-miner</em></a>) e ele tentará encontrar um endereço personalizado que inicie com "1kid".</p>
</div>
<div id="vanity_miner_run" class="exampleblock data-line-723">
<div class="title">Example 17. Compilando e executando o exemplo <em>vanity-miner</em></div>
<div class="content">
<div class="listingblock data-line-725">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># Compila o código com g++
$ g++ -o vanity-miner vanity-miner.cpp $(pkg-config --cflags --libs libbitcoin)
# Executa o exemplo
$ ./vanity-miner
Endereço personalizado encontrado! 1KiDzkG4MxmovZryZRj8tK81oQRhbZ46YT
Segredo: 57cc268a05f83a23ac9d930bc8565bac4e277055f4794cbd1a39e5e71c038f3f
# Executa o exemplo novamente para se obter um resultado diferente
$ ./vanity-miner
Endereço personalizado encontrado! 1Kidxr3wsmMzzouwXibKfwTYs5Pau8TUFn
Segredo: 7f65bbbbe6d8caae74a0c6a0d2d7b5c6663d71b60337299a1a2cf34c04b2a623
# Usa "time" para ver quanto tempo demora para se encontrar um resultado
$ time ./vanity-miner
Endereço personalizado encontrado! 1KidPWhKgGRQWD5PP5TAnGfDyfWp5yceXM
Segredo: 2a802e7a53d8aa237cd059377b616d2bfcfa4b0140bc85fa008f2d3d4b225349

real	0m8.868s
user	0m8.828s
sys	0m0.035s</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-747">
<p>O código de exemplo levará alguns segundos para encontrar uma correspondência ao padrão de três caracteres "kid", como podemos ver quando usamos o comando time do Unix para medir o tempo de execução. Mude o padrão desejado alterando a <em>string</em> search no código-fonte e veja o quão demorado é para se conseguir encontrar padrões de quatro ou cinco caracteres!</p>
</div>
<div class="paragraph data-line-749">
<p>===== Segurança do endereço personalizado</p>
</div>
<div class="paragraph data-line-751">
<p>Os endereços personalizados podem ser usados tanto para melhorar <em>quanto</em> para burlar medidas de segurança; eles são uma verdadeira faca de dois gumes. Quando usado para melhorar a segurança, um endereço diferenciado torna mais difícil para que hackers substituam o seu endereço pelo endereço deles, o que faria com que seus clientes pagassem para os hackers, ao invés de pagarem para você. Infelizmente, os endereços personalizados também permitem que qualquer pessoa crie um endereço que se <em>pareça</em> com qualquer endereço aleatório, ou mesmo outro endereço personalizado, e com isso enganando seus clientes.</p>
</div>
<div class="paragraph data-line-753">
<p>A Eugênia poderia divulgar um endereço gerado aleatoriamente (por exemplo, 1J7mdg5rbQyUHENYdx39WVWK7fsLpEoXZy) para que as pessoas enviem suas doações. Ou ela poderia gerar um endereço personalizado que começa com 1Kids, para torná-lo mais atraente.</p>
</div>
<div class="paragraph data-line-755">
<p>Em ambos os casos, um dos riscos de se usar um endereço fixo único (em vez de usar um endereço dinâmico separado para cada doador) é que um ladrão pode conseguir invadir o seu site e substituir o seu endereço pelo endereço dele, desviando as doações que você receberia. Se você divulgou seu endereço de doação em vários lugares diferentes, seus usuários podem inspecionar visualmente o endereço antes de fazer um pagamento, para se assegurarem que ele é o mesmo que eles viram em seu site, e-mail ou flyer. No caso de um endereço aleatório como 1J7mdg5rbQyUHENYdx39WVWK7fsLpEoXZy, o usuário comum talvez inspecionará apenas os primeiros caracteres "1J7mdg" e ficará satisfeito se eles forem iguais. Usando um gerador de endereços personalizados, uma pessoa mal-intencionada pode criar rapidamente endereços que se pareçam com o verdadeiro, com apenas os primeiros caracteres iguais, como demonstrado na <a href="#table_4-13">Gerando endereços personalizados para corresponder a um endereço aleatório</a>.</p>
</div>
<table id="table_4-13" class="tableblock frame-all grid-all stretch data-line-759">
<caption class="title">Table 7. Gerando endereços personalizados para corresponder a um endereço aleatório</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Endereço Aleatório Original</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1J7mdg5rbQyUHENYdx39WVWK7fsLpEoXZy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Endereço Personalizado (4 caracteres)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1J7md1QqU4LpctBetHS2ZoyLV5d6dShhEy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Endereço Personalizado (5 caracteres)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1J7mdgYqyNd4ya3UEcq31Q7sqRMXw2XZ6n</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Endereço Personalizado (6 caracteres)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1J7mdg5WxGENmwyJP9xuGhG5KRzu99BBCX</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-766">
<p>Então um endereço personalizado aumenta a segurança? Se a Eugênia gerar o endereço personalizado 1Kids33q44erFfpeXrmDSz7zEqG2FesZEN, os usuários provavelmente olharão para a palavra com o padrão personalizado <em>e alguns caracteres além</em>, por exemplo, percebendo a parte "1Kids33" do endereço. Isso forçaria um hacker a gerar um endereço personalizado que tenha pelo menos seis caracteres iguais (dois a mais), tendo que se esforçar 3.364 vezes mais (58 &#x00D7; 58) do que a Eugênia teve que se esforçar para conseguir gerar o seu endereço personalizado de quatro caracteres. Essencialmente, o esforço que a Eugênia teve que fazer (ou pagar para uma pool de mineração fazer) acaba exigindo que o hacker produza um padrão personalizado mais longo. Se a Eugênia pagar para uma pool gerar um endereço personalizado de 8 caracteres, o hacker teria que fazer um esforço para produzir um endereço de 10 caracteres, algo que é inviável de ser feito em um computador pessoal e muito caro para ser obtido, até mesmo em equipamentos de mineração de endereços personalizados ou em uma pool de mineração. O que tem um preço acessível para a Eugênia acaba se tornando muito caro para o hacker, especialmente se a recompensa potencial pela fraude não é alta o suficiente para cobrir o custo da geração do endereço personalizado.</p>
</div>
<div id="paper_wallets" class="paragraph data-line-769">
<p>==== Carteiras de Papel</p>
</div>
<div class="paragraph data-line-771">
<p>Paper wallets are bitcoin private keys printed on paper. Often the paper wallet also includes the corresponding Bitcoin address for convenience, but this is not necessary because it can be derived from the private key.</p>
</div>
<div class="admonitionblock warning data-line-774">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-775">
<p>As carteiras de papel são uma tecnologia OBSOLETA e, portanto, são consideradas perigosas para a maioria dos usuários. Existem muitas armadilhas sutis que podem ser exploradas durante o processo de geração das carteiras, incluindo a possibilidade de que o código gerador seja comprometido por um "<em>back door</em>". Centenas de bitcoins já foram roubados dessa forma. As carteiras de papel são mostradas nesta seção apenas para fins informativos e não devem ser usadas para armazenar bitcoins. Use uma frase mnemônica do padrão BIP-39 para fazer backup de suas chaves. Use uma carteira de hardware para armazenar chaves e assinar transações. NÃO USE CARTEIRAS DE PAPEL.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-778">
<p>As carteiras de papel possuem muitos formatos, tamanhos e designs, mas basicamente elas são apenas uma chave privada e um endereço impressos em um papel. A <a href="#table_4-14">Simplest form of a paper wallet—a printout of the Bitcoin address and private key</a> mostra a forma mais simples de uma carteira de papel.</p>
</div>
<table id="table_4-14" class="tableblock frame-all grid-all stretch data-line-783">
<caption class="title">Table 8. Simplest form of a paper wallet—a printout of the Bitcoin address and private key</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Endereço público</th>
<th class="tableblock halign-left valign-top">Chave privada (WIF)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1424C2F4bC9JidNjjTUZCbUxv6Sa1Mt62x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-788">
<p>As carteiras de papel possuem muitos designs e tamanhos, com muitos recursos diferentes. A &lt;paper_wallet_simple&gt; mostra um exemplo de uma carteira de papel.</p>
</div>
<div id="paper_wallet_simple" class="imageblock data-line-792">
<div class="content">
<img src="images/mbc2_0408.png" alt="mbc2 0408">
</div>
<div class="title">Figure 21. Um exemplo de uma carteira de papel simples</div>
</div>
<div class="paragraph data-line-795">
<p>Algumas são feitas para serem dadas de presente e tem temas sazonais, como as de Natal e Ano Novo. Outras são projetadas para serem armazenadas em um cofre de banco com a chave privada escondida de alguma maneira, seja através de adesivos opacos com raspadinhas, ou dobradas e seladas com um lacre de fita adesiva inviolável.</p>
</div>
<div class="paragraph data-line-797">
<p>Outros designs apresentam cópias adicionais das chaves e dos endereços, na forma de canhotos destacáveis semelhantes a canhotos de ingressos, permitindo que você armazene múltiplas cópias para protegê-las de incêndios, enchentes e outros desastres naturais.</p>
</div>
<div id="paper_wallet_spw" class="imageblock data-line-801">
<div class="content">
<img src="images/mbc2_0412.png" alt="mbc2 0412">
</div>
<div class="title">Figure 22. Um exemplo de uma carteira de papel com um canhoto de backup contendo cópias adicionais das chaves</div>
</div>
<div id="ch05_wallets" class="paragraph data-line-804">
<p>== Carteiras</p>
</div>
<div class="paragraph data-line-806">
<p>A palavra "carteira" é usada para descrever diferentes coisas no bitcoin.</p>
</div>
<div class="paragraph data-line-808">
<p>De maneira geral, uma carteira é um aplicativo que serve como a interface de usuário principal. A carteira controla o acesso ao dinheiro do usuário ao gerenciar chaves e endereços, controlar o saldo, criar transações e assinar transações.</p>
</div>
<div class="paragraph data-line-810">
<p>Mais precisamente, do ponto de vista de um programador, a palavra "carteira" refere-se à estrutura de dados usada para armazenar e gerenciar as chaves de um usuário.</p>
</div>
<div class="paragraph data-line-812">
<p>Neste capítulo, veremos o segundo significado, em que as carteiras são lugares para armazenar chaves privadas, geralmente implementados como arquivos estruturados ou bancos de dados simples.</p>
</div>
<div class="paragraph data-line-814">
<p>=== Visão Geral da Tecnologia de Carteira</p>
</div>
<div class="paragraph data-line-816">
<p>Nesta seção, resumimos as várias tecnologias usadas para construir carteiras de bitcoin fáceis de usar, seguras e versáteis.</p>
</div>
<div class="paragraph data-line-818">
<p>A common misconception about bitcoin is that bitcoin wallets contain bitcoin. In fact, the wallet contains only keys. The "coins" are recorded in the blockchain on the Bitcoin network. Users control the coins on the network by signing transactions with the keys in their wallets. In a sense, a bitcoin wallet is a <em>keychain</em>.</p>
</div>
<div class="admonitionblock tip data-line-821">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-822">
<p>As carteiras de bitcoin contêm chaves, e não moedas. Cada usuário tem uma carteira que contém chaves. As carteiras, na verdade, são chaveiros que contêm pares de chaves privadas/públicas (veja <a href="#private_public_keys">[private_public_keys]</a>). Os usuários assinam transações com as suas chaves, provando que possuem as saídas de transação (provando que são donos de suas moedas). As moedas são armazenadas na blockchain na forma de saídas de transação (frequentemente denominadas como vout ou txout).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-825">
<p>Existem dois tipos principais de carteiras, que são distinguidas pelo fato de suas chaves estarem relacionadas entre si ou não.</p>
</div>
<div class="paragraph data-line-827">
<p>O primeiro tipo é uma <em>carteira não determinística</em>, em que cada chave é gerada independentemente a partir de um número aleatório. As chaves não estão relacionadas entre si. Este tipo de carteira também é conhecido como uma carteira JBOK, da frase em inglês "<em>Just a Bunch of Keys</em>" ("Apenas um Monte de Chaves").</p>
</div>
<div class="paragraph data-line-829">
<p>O segundo tipo de carteira é uma <em>carteira determinística</em>, em que todas as chaves são derivadas de uma única chave mestra, conhecida como a <em>semente</em>. Todas as chaves neste tipo de carteira estão relacionadas umas com as outras e podem ser geradas novamente por alguém que tiver a semente original. Existem vários métodos diferentes de <em>derivação de chaves</em> usados ​​em carteiras determinísticas. O método de derivação mais comumente usado utiliza uma estrutura semelhante a uma árvore e é conhecido como <em>carteira determinística hierárquica</em> ou carteira <em>HD</em>.</p>
</div>
<div class="paragraph data-line-831">
<p>As carteiras determinísticas são inicializadas a partir de uma sequência aleatória (uma entropia). Para facilitar o uso, as sequências aleatórias são codificadas como palavras em inglês, também conhecidas como <em>palavras de código mnemônico</em>.</p>
</div>
<div class="paragraph data-line-833">
<p>As próximas seções apresentarão uma visão geral de cada uma dessas tecnologias.</p>
</div>
<div id="random_wallet" class="paragraph data-line-836">
<p>==== Carteiras Não Determinísticas (Aleatórias)</p>
</div>
<div class="paragraph data-line-838">
<p>In the first bitcoin wallet (now called Bitcoin Core), wallets were collections of randomly generated private keys. For example, the original Bitcoin Core client pregenerates 100 random private keys when first started and generates more keys as needed, using each key only once.  Such wallets are being replaced with deterministic wallets because they are cumbersome to manage, back up, and import. The disadvantage of random keys is that if you generate many of them you must keep copies of all of them, meaning that the wallet must be backed up frequently. Each key must be backed up, or the funds it controls are irrevocably lost if the wallet becomes inaccessible. This conflicts directly with the principle of avoiding address reuse, by using each Bitcoin address for only one transaction. Address reuse reduces privacy by associating multiple transactions and addresses with each other. A Type-0 nondeterministic wallet is a poor choice of wallet, especially if you want to avoid address reuse because it means managing many keys, which creates the need for frequent backups. Although the Bitcoin Core client includes a Type-0 wallet, using this wallet is discouraged by developers of Bitcoin Core. <a href="#Type0_wallet">Carteira não determinística (aleatória) do tipo 0: uma coleção de chaves geradas aleatoriamente</a> shows a nondeterministic wallet, containing a loose collection of random keys.</p>
</div>
<div class="admonitionblock tip data-line-841">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-842">
<p>O uso de carteiras não determinísticas é desencorajado para qualquer uso que não seja para se fazer testes simples. Elas são simplesmente incômodas demais para fazer backup e para serem usadas. Em vez disso, use uma <em>carteira HD</em> baseada no padrão da indústria com uma sequência aleatória <em>mnemônica</em> (uma entropia ou "semente inicial") para backup.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="Type0_wallet" class="imageblock smallersixty data-line-848">
<div class="content">
<img src="images/mbc2_0501.png" alt="Non-Deterministic Wallet">
</div>
<div class="title">Figure 23. Carteira não determinística (aleatória) do tipo 0: uma coleção de chaves geradas aleatoriamente</div>
</div>
<div class="paragraph data-line-850">
<p>==== Carteiras Determinísticas (com Semente)</p>
</div>
<div class="paragraph data-line-852">
<p>As carteiras determinísticas, ou "carteiras com semente", são carteiras que contêm chaves privadas que são todas derivadas de uma semente comum, através do uso de uma função de hash de sentido único. A semente é um número gerado aleatoriamente que é combinado com outros dados, como um número índice ou "código de cadeia" (veja <a href="#hd_wallets">[hd_wallets]</a>), para derivar as chaves privadas. Em uma carteira determinística, a semente é a única informação necessária para se recuperar todas as chaves derivadas e, portanto, um único backup no momento da criação da carteira é suficiente. A semente também é a única informação necessária para se exportar ou importar a carteira, permitindo a fácil migração de todas as chaves do usuário entre diferentes implementações de carteira. A <a href="#Type1_wallet">Carteira determinística tipo 1 (com semente): uma sequência determinística de chaves derivadas a partir de uma semente</a> mostra um diagrama lógico de uma carteira determinística.</p>
</div>
<div id="Type1_wallet" class="imageblock smallersixty data-line-857">
<div class="content">
<img src="images/mbc2_0502.png" alt="Deterministic Wallet">
</div>
<div class="title">Figure 24. Carteira determinística tipo 1 (com semente): uma sequência determinística de chaves derivadas a partir de uma semente</div>
</div>
<div id="hd_wallets" class="paragraph data-line-860">
<p>==== Carteiras HD (BIP-32/BIP-44)</p>
</div>
<div class="paragraph data-line-862">
<p>As carteiras determinísticas foram desenvolvidas para facilitar a derivação de várias chaves a partir de uma única "semente". A forma mais avançada de carteira determinística é a carteira HD definida pelo padrão BIP-32. As carteiras HD contêm chaves derivadas em uma estrutura em forma de árvore, de tal forma que uma chave pai pode derivar uma sequência de chaves filhas, e cada uma das quais pode derivar uma sequência de chaves netas, e assim por diante, até uma profundidade infinita. Essa estrutura em forma de árvore é ilustrada na <a href="#Type2_wallet">Carteira HD tipo 2: uma árvore de chaves geradas a partir de uma única semente</a>.</p>
</div>
<div id="Type2_wallet" class="imageblock data-line-866">
<div class="content">
<img src="images/mbc2_0503.png" alt="HD wallet">
</div>
<div class="title">Figure 25. Carteira HD tipo 2: uma árvore de chaves geradas a partir de uma única semente</div>
</div>
<div class="paragraph data-line-868">
<p>As carteiras HD oferecem duas grandes vantagens em relação às chaves aleatórias (não determinísticas). Primeiro, a estrutura em forma de árvore pode ser usada para expressar significado organizacional adicional, por exemplo, quando um ramo específico de subchaves é usado para receber pagamentos e um ramo diferente é usado para receber trocos de pagamentos efetuados. Os ramos de chaves também podem ser usados em cenários corporativos, alocando diferentes ramos a diferentes departamentos, subsidiárias, funções específicas ou categorias contábeis.</p>
</div>
<div class="paragraph data-line-870">
<p>A segunda vantagem das carteiras HD é que os usuários podem criar uma sequência de chaves públicas sem precisar ter acesso às chaves privadas correspondentes. Isso permite que carteiras HD sejam utilizadas em um servidor inseguro, ou em uma aplicação que somente recebe pagamentos, emitindo uma chave pública diferente para cada transação. As chaves públicas não precisam ser previamente carregadas ou derivadas, apesar de o servidor não deter as chaves privadas que podem gastar os fundos.</p>
</div>
<div class="paragraph data-line-872">
<p>==== Sementes e Códigos Mnemônicos (BIP-39)</p>
</div>
<div class="paragraph data-line-874">
<p>As carteiras HD são um mecanismo muito poderoso para gerenciar várias chaves e endereços. Elas são ainda mais úteis se forem combinadas com uma maneira padronizada de se criar sementes a partir de uma sequência de palavras em inglês que sejam fáceis de transcrever, exportar e importar entre carteiras. Essa sequência de palavras é conhecida como <em>mnemônico</em>, e o padrão é definido pela BIP-39. Hoje, a maioria das carteiras de bitcoin (e das carteiras de outras criptomoedas) usa esse padrão, que permite a importação e a exportação de sementes para backup e recuperação usando mnemônicos interoperáveis.</p>
</div>
<div class="paragraph data-line-876">
<p>Vamos analisar isso sob um ponto de vista prático. Qual das seguintes sementes é mais fácil de ser transcrita, anotada em um papel, lida sem erros, exportada e importada para uma outra carteira?</p>
</div>
<div class="listingblock data-line-879">
<div class="title">Uma semente para uma carteira determinística, exibida no formato hexadecimal</div>
<div class="content">
<pre>0C1E24E5917779D297E14D45F14E1A1A</pre>
</div>
</div>
<div class="listingblock data-line-884">
<div class="title">Uma semente para uma carteira determinística, codificada em um mnemônico de 12 palavras</div>
<div class="content">
<pre>army van defense carry jealous true
garbage claim echo media make crunch</pre>
</div>
</div>
<div class="paragraph data-line-889">
<p>==== Melhores Práticas de Carteira</p>
</div>
<div class="paragraph data-line-891">
<p>Conforme a tecnologia das carteiras de bitcoin amadureceu, alguns padrões comuns da indústria foram surgindo, tornando as carteiras de bitcoin amplamente interoperáveis, fáceis de usar, seguras e flexíveis. Esses padrões comuns são:</p>
</div>
<div class="ulist data-line-893">
<ul>
<li class="data-line-893">
<p>Palavras de código mnemônico, com base na BIP-39</p>
</li>
<li class="data-line-894">
<p>Carteiras HD, com base na BIP-32</p>
</li>
<li class="data-line-895">
<p>Estrutura de carteira HD multifuncional, com base na BIP-43</p>
</li>
<li class="data-line-896">
<p>Carteiras multimoedas e multicontas, com base na BIP-44</p>
</li>
</ul>
</div>
<div class="paragraph data-line-898">
<p>Esses padrões podem mudar ou tornarem-se obsoletos por desenvolvimentos futuros, mas, por enquanto, eles formam um conjunto de tecnologias interligadas que se tornaram o padrão amplamente reconhecido de carteira para bitcoin.</p>
</div>
<div class="paragraph data-line-900">
<p>Os padrões foram adotados por uma ampla variedade de carteiras de bitcoin de software e hardware, tornando todas essas carteiras interoperáveis. Um usuário pode exportar um mnemônico gerado em uma dessas carteiras e importá-lo em outra carteira, recuperando todas as transações, chaves e endereços.</p>
</div>
<div class="paragraph data-line-902">
<p>Alguns exemplos de carteiras de software que suportam esses padrões incluem (listadas em ordem alfabética) a Breadwallet, a Copay e a Multibit HD. Exemplos de carteiras de hardware que suportam esses padrões incluem (listadas em ordem alfabética) a KeepKey, a Ledger e a Trezor.</p>
</div>
<div class="paragraph data-line-904">
<p>Nas seções a seguir examinaremos cada uma dessas tecnologias em maiores detalhes.</p>
</div>
<div class="admonitionblock tip data-line-907">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-908">
<p>Se você estiver implementando uma carteira de bitcoin, ela deve ser construída como uma carteira HD, com uma semente derivada de, e codificada como, um código mnemônico para backup, seguindo os padrões BIP-32, BIP-39, BIP-43 e BIP-44, conforme descrito nas próximas seções.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-911">
<p>==== Usando uma Carteira de Bitcoin</p>
</div>
<div class="paragraph data-line-913">
<p>Em <a href="#user-stories">Usos do Bitcoin, Usuários e Suas Histórias</a> apresentamos o Gabriel, um adolescente empreendedor do Rio de Janeiro, que gerencia uma pequena loja virtual que vende camisetas, canecas e adesivos com a marca bitcoin.</p>
</div>
<div class="paragraph data-line-915">
<p>Gabriel usa uma carteira de hardware da marca Trezor (<a href="#a_trezor_device">Um dispositivo Trezor: uma carteira HD de bitcoin em hardware</a>)  para gerenciar seus bitcoins com segurança. A Trezor é um dispositivo USB simples com dois botões que armazena chaves (na forma de uma carteira HD) e assina transações. As carteiras Trezor implementam todos os padrões da indústria discutidos neste capítulo, então o Gabriel não depende de nenhuma tecnologia proprietária ou solução de um único fornecedor.</p>
</div>
<div id="a_trezor_device" class="imageblock data-line-919">
<div class="content">
<img src="images/mbc2_0504.png" alt="alt">
</div>
<div class="title">Figure 26. Um dispositivo Trezor: uma carteira HD de bitcoin em hardware</div>
</div>
<div class="paragraph data-line-921">
<p>Quando o Gabriel usou a Trezor pela primeira vez, o dispositivo gerou uma sequência aleatória (uma entropia), o mnemônico associado e derivou uma semente a partir de um gerador de número aleatório embutido no próprio hardware. Durante esta fase de inicialização, a carteira exibiu na tela uma sequência de palavras numeradas, uma de cada vez (ver a <a href="#trezor_mnemonic_display">Trezor exibindo uma das palavras mnemônicas</a>).</p>
</div>
<div id="trezor_mnemonic_display" class="imageblock data-line-925">
<div class="content">
<img src="images/mbc2_0505.png" alt="Trezor wallet display of mnemonic word">
</div>
<div class="title">Figure 27. Trezor exibindo uma das palavras mnemônicas</div>
</div>
<div class="paragraph data-line-927">
<p>Ao anotar este mnemônico em um papel, Gabriel criou um backup (ver a <a href="#mnemonic_paper_backup">O backup em papel do mnemônico de Gabriel</a>) que pode ser usado para recuperação em caso de perda ou dano ao dispositivo Trezor. Este mnemônico pode ser usado para recuperação em uma nova Trezor ou em qualquer uma entre várias carteiras de software ou hardware compatíveis. Note que a ordem das palavras é importante, e por causa disso os papéis para backup de mnemônico têm lacunas numeradas que são reservadas para cada palavra. Gabriel teve que anotar cuidadosamente cada palavra na lacuna numerada, a fim de preservar a ordem correta das palavras.</p>
</div>
<table id="mnemonic_paper_backup" class="tableblock frame-all grid-all data-line-932" style="width: 80%;">
<caption class="title">Table 9. O backup em papel do mnemônico de Gabriel</caption>
<colgroup>
<col style="width: 0.9803%;">
<col style="width: 49.0196%;">
<col style="width: 0.9803%;">
<col style="width: 49.0198%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>1.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>army</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>7.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>garbage</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>2.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>van</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>8.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>claim</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>3.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>defense</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>9.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>echo</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>4.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>carry</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>10.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>media</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>5.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>jealous</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>11.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>make</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>6.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>true</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>12.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>crunch</em></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note data-line-942">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-943">
<p>Um mnemônico de 12 palavras é mostrado na <a href="#mnemonic_paper_backup">O backup em papel do mnemônico de Gabriel</a>, para simplificar. Na verdade, a maioria das carteiras de hardware gera um mnemônico de 24 palavras, que é mais seguro. O mnemônico é usado exatamente da mesma maneira, independentemente da quantidade de palavras que ele possui.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-946">
<p>For the first implementation of his web store, Gabriel uses a single Bitcoin address, generated on his Trezor device. This single address is used by all customers for all orders. As we will see, this approach has some drawbacks and can be improved upon with an HD wallet.</p>
</div>
<div class="paragraph data-line-948">
<p>=== Detalhes da Tecnologia de Carteira</p>
</div>
<div class="paragraph data-line-950">
<p>Vamos agora examinar detalhadamente cada um dos importantes padrões da indústria usados por muitas carteiras de bitcoin.</p>
</div>
<div id="mnemonic_code_words" class="paragraph data-line-953">
<p>==== Palavras de Código Mnemônico (BIP-39)</p>
</div>
<div class="paragraph data-line-955">
<p>As palavras de código mnemônico são sequências de palavras que representam (codificam) um número aleatório que é usado como uma semente para se derivar uma carteira determinística. A sequência de palavras é a única informação necessária para se recriar a semente e, a partir dela, recriar a carteira e todas as suas chaves derivadas. Um aplicativo de carteira que usa carteiras determinísticas com palavras mnemônicas exibirá ao usuário uma sequência de 12 a 24 palavras quando a carteira for criada pela primeira vez. Essa sequência de palavras é o backup da carteira e pode ser usada para recuperar e recriar todas as chaves no mesmo aplicativo ou em qualquer aplicativo de carteira compatível. As palavras mnemônicas facilitam a criação de backups de carteiras pelos usuários, pois elas são fáceis de serem lidas e de serem corretamente transcritas, quando comparadas a uma sequência de números aleatórios.</p>
</div>
<div class="admonitionblock tip data-line-958">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-959">
<p>As palavras mnemônicas costumam ser confundidas com as "carteiras cerebrais" (em inglês, <em>brainwallets</em>). Elas não são a mesma coisa. A principal diferença é que uma carteira cerebral consiste em palavras que são escolhidas pelo próprio usuário, enquanto as palavras mnemônicas são criadas aleatoriamente pela carteira e depois são apresentadas ao usuário. Essa importante diferença torna as palavras mnemônicas muito mais seguras, pois os humanos são fontes muito pobres de aleatoriedade.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-962">
<p>Os códigos mnemônicos são definidos na BIP-39 (consulte o <a href="#appdxbitcoinimpproposals">[appdxbitcoinimpproposals]</a>). Observe que a BIP-39 é uma implementação de um padrão de código mnemônico. Existe também um padrão diferente, com um conjunto diferente de palavras, usado pela carteira Electrum, mais antigo do que a BIP-39. O padrão BIP-39 foi proposto pela empresa responsável pela carteira de hardware Trezor e não é compatível com a implementação da Electrum. No entanto, o padrão BIP-39 já obteve amplo suporte da indústria em dezenas de implementações interoperáveis e, atualmente, deve ser considerado o padrão "oficial" da indústria.</p>
</div>
<div class="paragraph data-line-964">
<p>A BIP-39 define a criação de um código mnemônico e de uma semente, que descrevemos aqui em nove etapas. Para maior clareza, o processo é dividido em duas partes: as etapas de 1 a 6 são mostradas em <a href="#generating_mnemonic_words">[generating_mnemonic_words]</a> e as etapas de 7 a 9 são mostradas em <a href="#mnemonic_to_seed">[mnemonic_to_seed]</a>.</p>
</div>
<div id="generating_mnemonic_words" class="paragraph data-line-967">
<p>===== Gerando palavras mnemônicas</p>
</div>
<div class="paragraph data-line-969">
<p>As palavras mnemônicas são geradas automaticamente pela carteira usando o processo padronizado definido na BIP-39. A carteira começa a partir de uma fonte de entropia, adiciona uma soma de verificação (um <em>checksum</em>) e então mapeia a entropia para uma lista de palavras:</p>
</div>
<div class="olist arabic data-line-971">
<ol class="arabic">
<li class="data-line-971">
<p>Cria uma sequência aleatória (entropia) de 128 a 256 bits.</p>
</li>
<li class="data-line-972">
<p>Cria uma soma de verificação (<em>checksum</em>) da sequência aleatória tomando os primeiros (comprimento da entropia/32) bits de seu hash SHA256.</p>
</li>
<li class="data-line-973">
<p>Adiciona a soma de verificação (<em>checksum</em>) no final da sequência aleatória.</p>
</li>
<li class="data-line-974">
<p>Divide o resultado em segmentos com 11 bits de comprimento.</p>
</li>
<li class="data-line-975">
<p>Mapeia cada valor de 11 bits para uma palavra do dicionário predefinido de 2.048 palavras.</p>
</li>
<li class="data-line-976">
<p>O código mnemônico é a sequência de palavras.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-978">
<p>A <a href="#generating_entropy_and_encoding">Gerando entropia e codificando como palavras mnemônicas</a> mostra como a entropia é usada para gerar palavras mnemônicas.</p>
</div>
<div id="generating_entropy_and_encoding" class="imageblock smallerseventy data-line-983">
<div class="content">
<img src="images/mbc2_0506.png" alt="Generating entropy and encoding as mnemonic words">
</div>
<div class="title">Figure 28. Gerando entropia e codificando como palavras mnemônicas</div>
</div>
<div class="paragraph data-line-985">
<p>A <a href="#table_4-5">Códigos mnemônicos: entropia e comprimento da palavra</a> mostra a relação entre o tamanho dos dados de entropia e o comprimento em palavras dos códigos mnemônicos.</p>
</div>
<table id="table_4-5" class="tableblock frame-all grid-all stretch data-line-990">
<caption class="title">Table 10. Códigos mnemônicos: entropia e comprimento da palavra</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Entropia (bits)</th>
<th class="tableblock halign-left valign-top"><em>Checksum</em> (bits)</th>
<th class="tableblock halign-left valign-top">Entropia <strong>+</strong> <em>checksum</em> (bits)</th>
<th class="tableblock halign-left valign-top">Comprimento do mnemônico (palavras)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">132</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">160</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">165</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">192</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">198</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">18</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">224</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">231</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">21</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">264</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24</p></td>
</tr>
</tbody>
</table>
<div id="mnemonic_to_seed" class="paragraph data-line-1000">
<p>===== Do mnemônico à semente</p>
</div>
<div class="paragraph data-line-1002">
<p>As palavras mnemônicas representam uma entropia com um comprimento de 128 a 256 bits. A entropia é então usada para derivar uma semente mais longa (de 512 bits) através do uso da função de alongamento de chaves PBKDF2. A semente produzida é então usada para construir uma carteira determinística e derivar suas chaves.</p>
</div>
<div class="paragraph data-line-1004">
<p>A função de alongamento de chaves usa dois parâmetros: o mnemônico e um <em>sal</em> (em inglês, <em>salt</em>). O propósito de um sal em uma função de alongamento de chaves é dificultar a construção de uma tabela de pesquisa (em inglês, <em>lookup table</em>) que permita um ataque de força bruta. No padrão BIP-39, o sal tem outra finalidade&#x2014;ele permite a utilização de uma frase de senha (em inglês, <em>passphrase</em>) que serve como um fator de segurança adicional protegendo a semente, como descreveremos em mais detalhes em <a href="#mnemonic_passphrase">[mnemonic_passphrase]</a>.</p>
</div>
<div class="paragraph data-line-1006">
<p>O processo descrito nas etapas 7 a 9 é a continuação do processo descrito anteriormente em <a href="#generating_mnemonic_words">[generating_mnemonic_words]</a>:</p>
</div>
<ol start="7">
	<li>O primeiro parâmetro para a função de alongamento de chaves PBKDF2 é o <em>mnemônico</em> produzido na etapa 6.</li>
	<li>O segundo parâmetro para a função de alongamento de chaves PBKDF2 é um <em>sal</em>. O sal é composto pela _string_ constante "<code>mnemonic</code>" concatenada com uma _string_ opcional da frase de senha fornecida pelo usuário.</li>
	<li>A PBKDF2 estende os parâmetros mnemônico e sal usando 2.048 rodadas de hash com o algoritmo HMAC-SHA512, produzindo um valor de 512 bits como sua saída final. Esse valor de 512 bits é a semente.</li>
</ol>
<div class="paragraph data-line-1016">
<p>A <a href="#fig_5_7">Do mnemônico à semente</a> mostra como um mnemônico é usado para gerar uma semente.</p>
</div>
<div id="fig_5_7" class="imageblock data-line-1020">
<div class="content">
<img src="images/mbc2_0507.png" alt="From mnemonic to seed">
</div>
<div class="title">Figure 29. Do mnemônico à semente</div>
</div>
<div class="admonitionblock tip data-line-1023">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1024">
<p>A função de alongamento de chaves, com suas 2.048 rodadas de <em>hashing</em>, é uma proteção muito eficaz contra ataques de força bruta contra o mnemônico ou a frase de senha. Torna-se extremamente custoso (em termos de esforço computacional) tentar mais do que algumas milhares de frases de senha e combinações mnemônicas, visto que o número possível de sementes derivadas é imenso (2<sup>512</sup>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1027">
<p>As Tabelas <a data-type="xref" href="#mnemonic_128_no_pass" data-xrefstyle="select: labelnumber">#mnemonic_128_no_pass</a>, <a data-type="xref" href="#mnemonic_128_w_pass" data-xrefstyle="select: labelnumber">#mnemonic_128_w_pass</a> e <a data-type="xref" href="#mnemonic_256_no_pass" data-xrefstyle="select: labelnumber">#mnemonic_256_no_pass</a> demonstram alguns exemplos de códigos mnemônicos e as sementes que eles produzem (com ou sem uma frase de senha).</p>
</div>
<table id="mnemonic_128_no_pass" class="tableblock frame-all grid-all stretch data-line-1032">
<caption class="title">Table 11. Código mnemônico com entropia de 128 bits, sem frase de senha, e a semente resultante</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Input de entropia (128 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">0c1e24e5917779d297e14d45f14e1a1a</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Mnemônico (12 palavras)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">army van defense carry jealous true garbage claim echo media make crunch</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Frase de senha</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">(nenhuma)</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Semente (512 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">5b56c417303faa3fcba7e57400e120a0ca83ec5a4fc9ffba757fbe63fbd77a89a1a3be4c67196f57c39
a88b76373733891bfaba16ed27a813ceed498804c0570</p></td>
</tr>
</tbody>
</table>
<table id="mnemonic_128_w_pass" class="tableblock frame-all grid-all stretch data-line-1043">
<caption class="title">Table 12. Código mnemônico com entropia de 128 bits, com frase de senha, e a semente resultante</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Input de entropia (128 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">0c1e24e5917779d297e14d45f14e1a1a</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Mnemônico (12 palavras)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">army van defense carry jealous true garbage claim echo media make crunch</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Frase de senha</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">SuperDuperSecret</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Semente (512 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">3b5df16df2157104cfdd22830162a5e170c0161653e3afe6c88defeefb0818c793dbb28ab3ab091897d0
715861dc8a18358f80b79d49acf64142ae57037d1d54</p></td>
</tr>
</tbody>
</table>
<table id="mnemonic_256_no_pass" class="tableblock frame-all grid-all stretch data-line-1055">
<caption class="title">Table 13. Código mnemônico com entropia de 256 bits, sem frase de senha, e a semente resultante</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Input de entropia (256 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">2041546864449caff939d32d574753fe684d3c947c3346713dd8423e74abcf8c</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Mnemônico (24 palavras)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">cake apple borrow silk endorse fitness top denial coil riot stay wolf
luggage oxygen faint major edit measure invite love trap field dilemma oblige</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Frase de senha</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">(nenhuma)</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Semente (512 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">3269bce2674acbd188d4f120072b13b088a0ecf87c6e4cae41657a0bb78f5315b33b3a04356e53d062e5
5f1e0deaa082df8d487381379df848a6ad7e98798404</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip data-line-1065">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1066">
<p>Many wallets do not allow for the creation of wallets with more than a 12 word mnemonic phrase. You will notice from the tables above that despite the unique lengths of entropy input, the seed size remains the same (512 bits). From a security perspective, the amount of entropy actually used for the production of HD wallets is roughly 128 bits, which equals 12 words.  Providing more than 12 words produces additional entropy which is unnecessary, and this <em>unused</em> entropy is not used for the derivation of the seed in the way that one might initially suspect. From a usability perspective, 12 words is also easier to write down, back up, and store.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="mnemonic_passphrase" class="paragraph data-line-1070">
<p>===== Frase de senha (<em>passphrase</em>) opcional no padrão BIP-39</p>
</div>
<div class="paragraph data-line-1072">
<p>O padrão BIP-39 permite o uso de uma frase de senha (<em>passphrase</em>) opcional na derivação da semente. Se nenhuma frase de senha for usada, o mnemônico é alongado com um sal que consiste na <em>string</em> constante "mnemonic", produzindo uma semente específica de 512 bits a partir de qualquer mnemônico fornecido. Se uma frase de senha for usada, a função de alongamento produz uma semente <em>diferente</em> a partir desse mesmo mnemônico. Ou seja, dado um único mnemônico, cada frase de senha possível gera uma semente diferente. Em outras palavras, não existe uma frase de senha "errada". Todas as frases de senha são válidas e todas elas geram sementes diferentes, formando um imenso conjunto de possíveis carteiras não inicializadas. O número de carteiras possíveis é tão grande (2<sup>512</sup>) que não há a possibilidade prática de se utilizar força bruta ou de se adivinhar acidentalmente alguma semente que já esteja em uso.</p>
</div>
<div class="admonitionblock tip data-line-1075">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1076">
<p>Não há frases de senha "erradas" no padrão BIP-39. Cada frase de senha gera uma carteira, que, a menos que ela já tenha sido usada anteriormente, estará vazia.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1079">
<p>A frase de senha opcional cria dois recursos importantes:</p>
</div>
<div class="ulist data-line-1081">
<ul>
<li class="data-line-1081">
<p>Um segundo fator (algo memorizado) que torna um mnemônico inútil quando obtido isoladamente, protegendo os backups de mnemônicos de serem comprometidos por um ladrão.</p>
</li>
<li class="data-line-1083">
<p>Uma forma de negação plausível ou "carteira de coação", quando se usa uma frase de senha para abrir uma carteira com uma pequena quantidade de fundos, a qual é usada para distrair um criminoso da carteira "verdadeira", que contém a maioria dos fundos.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1085">
<p>No entanto, é importante observar que o uso de uma frase de senha também introduz o risco de perda:</p>
</div>
<div class="ulist data-line-1087">
<ul>
<li class="data-line-1087">
<p>Se o dono da carteira ficar incapacitado ou vier a óbito e ninguém mais souber a frase de senha, o código mnemônico será inútil, e todos os fundos armazenados na carteira serão perdidos para sempre.</p>
</li>
<li class="data-line-1089">
<p>Além disso, se o proprietário fizer o backup da frase de senha no mesmo lugar que o backup do código mnemônico, isso anulará o propósito de servir como um segundo fator.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1091">
<p>Embora as frases de senha sejam muito úteis, elas só devem ser usadas em combinação com um processo cuidadosamente planejado para backup e recuperação, que leve em consideração a possibilidade de que o proprietário venha a óbito no futuro, permitindo que sua família recupere as criptomoedas de herança.</p>
</div>
<div class="paragraph data-line-1093">
<p>===== Trabalhando com códigos mnemônicos</p>
</div>
<div class="paragraph data-line-1095">
<p>O padrão BIP-39 é implementado como uma biblioteca em muitas linguagens de programação diferentes:</p>
</div>
<div class="dlist data-line-1097">
<dl>
<dt class="hdlist1"><a href="https://github.com/trezor/python-mnemonic" data-href="https://github.com/trezor/python-mnemonic">python-mnemonic</a></dt>
<dd>
<p>A implementação de referência do padrão feita pela equipe da SatoshiLabs, que propôs o padrão BIP-39, em Python</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/bitcoinjs/bip39" data-href="https://github.com/bitcoinjs/bip39">bitcoinjs/bip39</a></dt>
<dd>
<p>Uma implementação do padrão BIP-39, como parte do popular framework bitcoinJS, em JavaScript</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/libbitcoin/libbitcoin/blob/master/src/wallet/mnemonic.cpp" data-href="https://github.com/libbitcoin/libbitcoin/blob/master/src/wallet/mnemonic.cpp">libbitcoin/mnemonic</a></dt>
<dd>
<p>Uma implementação do padrão BIP-39, como parte do popular framework Libbitcoin, em <span class="keep-together">C++</span></p>
</dd>
</dl>
</div>
<div class="paragraph data-line-1103">
<p>==== Criando uma Carteira HD a partir da Semente</p>
</div>
<div class="paragraph data-line-1105">
<p>As carteiras HD são criadas a partir de uma única <em>semente raiz</em>, que é um número aleatório de 128, 256 ou 512 bits. Mais comumente, essa semente é gerada a partir de um <em>mnemônico</em>, conforme detalhado na seção anterior.</p>
</div>
<div class="paragraph data-line-1107">
<p>Cada chave na carteira HD é derivada deterministicamente a partir dessa semente raiz, o que torna possível recriar toda a carteira HD a partir dessa semente em qualquer carteira HD compatível. Isso torna mais fácil fazer backup, restaurar, exportar e importar carteiras HD contendo milhares ou até mesmo milhões de chaves, simplesmente transferindo apenas o mnemônico a partir do qual a semente raiz é derivada.</p>
</div>
<div class="paragraph data-line-1109">
<p>O processo de criação das chaves mestras e do código de cadeia mestre para uma carteira HD é demonstrado na <a href="#HDWalletFromSeed">Criando as chaves mestras e o código de cadeia mestre a partir da semente raiz</a>.</p>
</div>
<div id="HDWalletFromSeed" class="imageblock data-line-1113">
<div class="content">
<img src="images/mbc2_0509.png" alt="HDWalletFromRootSeed">
</div>
<div class="title">Figure 30. Criando as chaves mestras e o código de cadeia mestre a partir da semente raiz</div>
</div>
<div class="paragraph data-line-1115">
<p>A semente raiz é usada como <em>input</em> no algoritmo HMAC-SHA512 e o hash resultante é usado para criar uma <em>chave privada mestra</em> (m) e um <em>código de cadeia mestre</em> (c).</p>
</div>
<div class="paragraph data-line-1117">
<p>A chave privada mestra (m) então gera uma chave pública mestra (M) correspondente usando o processo normal de multiplicação de curva elíptica m * G que vimos em <a href="#pubkey">[pubkey]</a>.</p>
</div>
<div class="paragraph data-line-1119">
<p>O código de cadeia (c) é usado para introduzir entropia na função que cria chaves filhas a partir de chaves pais, como veremos na próxima seção.</p>
</div>
<div class="paragraph data-line-1121">
<p>===== Derivação de chave privada filha</p>
</div>
<div class="paragraph data-line-1123">
<p>As carteiras HD usam uma função de <em>derivação de chaves filhas</em> (em inglês, <em>child key derivation</em> ou CKD) para derivar as chaves filhas a partir das chaves pais.</p>
</div>
<div class="paragraph data-line-1125">
<p>As funções de derivação de chaves filhas são baseadas em uma função de hash de sentido único, que combina:</p>
</div>
<div class="ulist data-line-1127">
<ul>
<li class="data-line-1127">
<p>Uma chave pai privada ou pública (chave ECDSA comprimida)</p>
</li>
<li class="data-line-1128">
<p>Uma semente chamada de código de cadeia (256 bits)</p>
</li>
<li class="data-line-1129">
<p>Um número índice (32 bits)</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1131">
<p>O código de cadeia é usado para introduzir dados aleatórios determinísticos ao processo, de forma que saber o índice e uma chave filha não é suficiente para se derivar outras chaves filhas. Saber uma chave filha não torna alguém capaz de descobrir suas chaves irmãs, a menos que a pessoa também tenha o código de cadeia. A semente inicial do código de cadeia (na raiz da árvore) é feita a partir da semente, enquanto os códigos de cadeia filhos subsequentes são derivados de cada código de cadeia pai.</p>
</div>
<div class="paragraph data-line-1133">
<p>Esses três itens (a chave pai, o código de cadeia e o índice) são combinados e depois submetidos a uma função de hash para gerar as chaves filhas, conforme abaixo descrito.</p>
</div>
<div class="paragraph data-line-1135">
<p>A chave pública pai, o código de cadeia pai e o número índice são combinados e são submetidos a uma função de hash com o algoritmo HMAC-SHA512 para produzir um hash de 512 bits. Esse hash de 512 bits é dividido em duas metades de 256 bits. Os 256 bits da metade direita do hash resultante tornam-se o código de cadeia filho. Os 256 bits da metade esquerda do hash são adicionados à chave pai para produzir a chave privada filha. Na <a href="#CKDpriv">Estendendo uma chave privada pai para criar uma chave privada filha</a>, vemos isso ilustrado com o índice definido como 0 para produzir a chave privada filha "zero" (a primeira chave privada filha) da chave privada pai.</p>
</div>
<div id="CKDpriv" class="imageblock data-line-1139">
<div class="content">
<img src="images/mbc2_0510.png" alt="ChildPrivateDerivation">
</div>
<div class="title">Figure 31. Estendendo uma chave privada pai para criar uma chave privada filha</div>
</div>
<div class="paragraph data-line-1141">
<p>Mudar o índice nos permite estender a chave pai e criar as outras chaves filhas na sequência, por exemplo, Filha 0, Filha 1, Filha 2, etc. Cada chave pai pode ter 2.147.483.647 (2<sup>31</sup>) chaves filhas (2<sup>31</sup> é metade de todo o intervalo de 2<sup>32</sup> chaves que está disponível, pois a outra metade é reservada para um tipo especial de derivação, sobre a qual falaremos mais adiante neste capítulo).</p>
</div>
<div class="paragraph data-line-1143">
<p>Repetindo o processo em um nível abaixo da árvore, cada chave filha pode virar uma chave pai e criar suas próprias filhas, em um número infinito de gerações.</p>
</div>
<div class="paragraph data-line-1145">
<p>===== Usando as chaves filhas derivadas</p>
</div>
<div class="paragraph data-line-1147">
<p>As chaves privadas filhas são indistinguíveis das chaves não determinísticas (aleatórias). Como a função de derivação é uma função de sentido único, a chave filha não pode ser usada para se encontrar a chave pai. A chave filha também não pode ser usada para se encontrar chaves irmãs. Se você tiver a nª (enésima) filha, você não será capaz de encontrar as suas irmãs, como a filha n&#x2013;1 ou a filha n + 1, ou quaisquer outras filhas que façam parte da sequência. Apenas a chave pai e o código de cadeia são capazes de derivar todas as chaves filhas. Sem o código de cadeia filho, a chave filha também não pode ser usada para derivar nenhuma chave neta. Você precisa ter ambos, tanto a chave privada filha quanto o código de cadeia filho, para poder iniciar um novo ramo e derivar as chaves netas.</p>
</div>
<div class="paragraph data-line-1149">
<p>So what can the child private key be used for on its own? It can be used to make a public key and a Bitcoin address. Then, it can be used to sign transactions to spend anything paid to that address.</p>
</div>
<div class="admonitionblock tip data-line-1152">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1153">
<p>A child private key, the corresponding public key, and the Bitcoin address are all indistinguishable from keys and addresses created randomly. The fact that they are part of a sequence is not visible outside of the HD wallet function that created them. Once created, they operate exactly as "normal" keys.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1156">
<p>===== Chaves estendidas</p>
</div>
<div class="paragraph data-line-1158">
<p>Conforme vimos anteriormente, a função de derivação de chaves pode ser usada para criar chaves filhas em qualquer nível da árvore, baseando-se em três entradas (inputs): uma chave, um código de cadeia e o índice da filha desejada. Os dois ingredientes essenciais são a chave e o código de cadeia, que combinados são chamados de <em>chave estendida</em>. O termo "chave estendida" também poderia ser considerado como "chave extensível", pois esse tipo de chave pode ser usado para derivar chaves filhas.</p>
</div>
<div class="paragraph data-line-1160">
<p>As chaves estendidas são armazenadas e representadas como uma simples concatenação da chave de 256 bits e do código de cadeia de 256 bits em uma sequência de 512 bits. Existem dois tipos de chaves estendidas. Uma chave privada estendida é a combinação de uma chave privada com um código de cadeia, e pode ser usada para derivar chaves privadas filhas (e, a partir delas, chaves públicas filhas). Uma chave pública estendida é a combinação de uma chave pública com um código de cadeia, e pode ser usada para criar chaves públicas filhas (<em>somente chaves públicas</em>), conforme descrito em <a href="#public_key_derivation">[public_key_derivation]</a>.</p>
</div>
<div class="paragraph data-line-1162">
<p>Imagine uma chave estendida como se fosse a raiz de um ramo na estrutura em forma de árvore da carteira HD. Tendo a raiz do ramo, você pode derivar o resto do ramo. A chave privada estendida pode criar um ramo completo, ao passo que a chave pública estendida pode criar um ramo que tenha <em>apenas</em> chaves públicas.</p>
</div>
<div class="admonitionblock tip data-line-1165">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1166">
<p>Uma chave estendida consiste em uma chave privada ou pública e um código de cadeia. Uma chave estendida pode criar chaves filhas, gerando o seu próprio ramo na estrutura em forma de árvore. Compartilhar uma chave estendida dá acesso a todo o ramo.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1169">
<p>As chaves estendidas são codificadas usando Base58Check, para facilitar a exportação e a importação entre diferentes carteiras compatíveis com a BIP-32. A codificação Base58Check para as chaves estendidas usa um número de versão especial que resulta nos prefixos "xprv" e "xpub" quando codificado em caracteres Base58, fazendo com que as chaves sejam mais facilmente reconhecíveis. Como a chave estendida tem 512 ou 513 bits, ela é muito mais longa do que qualquer uma das <em>strings</em> codificadas em Base58Check que vimos anteriormente.</p>
</div>
<div class="paragraph data-line-1171">
<p>Esse é um exemplo de uma chave <em>privada</em> estendida, codificada em Base58Check:</p>
</div>
<div class="listingblock data-line-1173">
<div class="content">
<pre>xprv9tyUQV64JT5qs3RSTJkXCWKMyUgoQp7F3hA1xzG6ZGu6u6Q9VMNjGr67Lctvy5P8oyaYAL9CAWrUE9i6GoNMKUga5biW6Hx4tws2six3b9c</pre>
</div>
</div>
<div class="paragraph data-line-1177">
<p>Essa é a chave <em>pública</em> estendida correspondente, codificada em Base58Check:</p>
</div>
<div class="listingblock data-line-1179">
<div class="content">
<pre>xpub67xpozcx8pe95XVuZLHXZeG6XWXHpGq6Qv5cmNfi7cS5mtjJ2tgypeQbBs2UAR6KECeeMVKZBPLrtJunSDMstweyLXhRgPxdp14sk9tJPW9</pre>
</div>
</div>
<div id="public__child_key_derivation" class="paragraph data-line-1184">
<p>===== Derivação de chave pública filha</p>
</div>
<div class="paragraph data-line-1186">
<p>Como mencionado anteriormente, uma característica muito útil das carteiras HD é a capacidade de derivar chaves públicas filhas a partir de chaves públicas pais, <em>sem</em> a necessidade das chaves privadas. Isso nos fornece duas maneiras de derivar uma chave pública filha: a partir da chave privada filha, ou diretamente a partir da chave pública pai.</p>
</div>
<div class="paragraph data-line-1188">
<p>Portanto, uma chave pública estendida pode ser usada para derivar todas as chaves <em>públicas</em> (e somente as chaves públicas) naquele ramo da estrutura da carteira HD.</p>
</div>
<div class="paragraph data-line-1190">
<p>This shortcut can be used to create very secure public key&#x2013;only deployments where a server or application has a copy of an extended public key and no private keys whatsoever. That kind of deployment can produce an infinite number of public keys and Bitcoin addresses, but cannot spend any of the money sent to those addresses. Meanwhile, on another, more secure server, the extended private key can derive all the corresponding private keys to sign transactions and spend the money.</p>
</div>
<div class="paragraph data-line-1192">
<p>One common application of this solution is to install an extended public key on a web server that serves an ecommerce application. The web server can use the public key derivation function to create a new Bitcoin address for every transaction (e.g., for a customer shopping cart). The web server will not have any private keys that would be vulnerable to theft. Without HD wallets, the only way to do this is to generate thousands of Bitcoin addresses on a separate secure server and then preload them on the ecommerce server. That approach is cumbersome and requires constant maintenance to ensure that the ecommerce server doesn&#8217;t "run out" of addresses.</p>
</div>
<div class="paragraph data-line-1194">
<p>Another common application of this solution is for cold-storage or hardware wallets. In that scenario, the extended private key can be stored on a paper wallet or hardware device (such as a Trezor hardware wallet), while the extended public key can be kept online. The user can create "receive" addresses at will, while the private keys are safely stored offline. To spend the funds, the user can use the extended private key on an offline signing Bitcoin client or sign transactions on the hardware wallet device (e.g., Trezor). <a href="#CKDpub">Estendendo uma chave pública pai para criar uma chave pública filha</a> illustrates the mechanism for extending a parent public key to derive child public keys.</p>
</div>
<div id="CKDpub" class="imageblock data-line-1198">
<div class="content">
<img src="images/mbc2_0511.png" alt="ChildPublicDerivation">
</div>
<div class="title">Figure 32. Estendendo uma chave pública pai para criar uma chave pública filha</div>
</div>
<div class="paragraph data-line-1200">
<p>===== Derivação endurecida da chave filha</p>
</div>
<div class="paragraph data-line-1202">
<p>A habilidade de derivar um ramo de chaves públicas a partir de uma xpub é muito útil, mas isso traz um risco em potencial. Ter acesso a uma xpub não dá acesso às chaves privadas filhas. No entanto, como a xpub contém o código de cadeia, se uma chave privada filha for descoberta ou vazar de alguma maneira, ela pode ser usada com o código de cadeia para derivar todas as outras chaves privadas filhas. Ou seja, basta que uma única chave privada filha vaze junto com um código de cadeia pai, para que todas chaves privadas de todas as chaves filhas sejam reveladas. Ou, pior ainda, a chave privada filha pode ser usada junto com um código de cadeia pai para deduzir a chave privada pai.</p>
</div>
<div class="paragraph data-line-1204">
<p>Para evitar esse risco, as carteiras HD usam uma função de derivação alternativa chamada <em>derivação endurecida</em> (em inglês, <em>hardened derivation</em>), que "desfaz" a relação entre a chave pública pai e o código de cadeia filho. A função de derivação endurecida usa a chave privada pai para derivar o código de cadeia filho, em vez de usar a chave pública pai. Isso cria um "firewall" na sequência pai/filho, com um código de cadeia que não pode ser usado para comprometer uma chave privada pai ou irmã. A função de derivação endurecida parece quase idêntica à derivação normal de chave privada filha, com a exceção de que a chave privada pai é usada como input da função de hash, ao invés da chave pública pai, como demonstrado no diagrama da <a href="#CKDprime">Derivação endurecida de uma chave filha; a chave pública pai é omitida</a>.</p>
</div>
<div id="CKDprime" class="imageblock data-line-1208">
<div class="content">
<img src="images/mbc2_0513.png" alt="ChildHardPrivateDerivation">
</div>
<div class="title">Figure 33. Derivação endurecida de uma chave filha; a chave pública pai é omitida</div>
</div>
<div class="paragraph pagebreak-before data-line-1211">
<p>Quando a função de derivação endurecida é utilizada, a chave privada filha e o código de cadeia filho resultantes são completamente diferentes do que resultariam a partir de uma função de derivação normal. O "ramo" de chaves resultante pode ser usado para produzir chaves públicas estendidas que não são vulneráveis, pois o código de cadeia que elas contêm, mesmo se for descoberto, não será capaz de revelar nenhuma das chaves privadas. A derivação endurecida é portanto usada para criar uma lacuna na árvore, localizada acima do nível onde as chaves públicas estendidas são usadas.</p>
</div>
<div class="paragraph data-line-1213">
<p>Em termos simples, se você quer usar a conveniência de uma xpub para derivar ramos de chaves públicas, sem se expor ao risco de vazar um código de cadeia, você deveria derivar o ramo a partir de uma chave pai endurecida, ao invés de uma chave pai normal (não endurecida). Como prática recomendada, as chaves filhas do nível 1 das chaves mestras são sempre derivadas por meio da derivação endurecida, para evitar o comprometimento das chaves mestras.</p>
</div>
<div class="paragraph data-line-1215">
<p>===== Números índice para a derivação normal e a endurecida</p>
</div>
<div class="paragraph data-line-1217">
<p>O número índice usado na função de derivação é um número inteiro de 32 bits. Para facilitar a diferenciação entre as chaves derivadas pela função de derivação normal e as chaves derivadas pela função de derivação endurecida, esse número índice é dividido em dois intervalos. Os números índice entre 0 e 2<sup>31</sup>&#x2013;1 (0x0 a 0x7FFFFFFF) são usados <em>apenas</em> para a derivação normal. Os números índice entre 2<sup>31</sup> e 2<sup>32</sup>&#x2013;1 (0x80000000 a 0xFFFFFFFF) são usados <em>apenas</em> para a derivação endurecida. Portanto, se o número índice for menor do que 2<sup>31</sup>, isso significa que a chave filha é normal, enquanto se o número índice for maior ou igual a 2<sup>31</sup>, isso significa que a chave filha é endurecida.</p>
</div>
<div class="paragraph data-line-1219">
<p>Para tornar o número índice mais fácil de ser lido e exibido, o número índice para as chaves filhas endurecidas é exibido iniciando do zero, mas com um apóstrofo. A primeira chave filha normal é portanto exibida como 0, enquanto a primeira chave filha endurecida (índice 0x80000000) é exibida como 0&amp;#x27;. Na sequência, a segunda chave endurecida teria o índice 0x80000001 e seria exibida como 1&amp;#x27;, e assim por diante. Quando você se deparar com um índice de carteira HD i&amp;#x27;, isso significa 2<sup>31</sup>+i.</p>
</div>
<div class="paragraph data-line-1221">
<p>===== Identificador (caminho) de chave de carteira HD</p>
</div>
<div class="paragraph data-line-1223">
<p>As chaves em uma carteira HD são identificadas a partir de uma convenção de nomenclatura de "caminho", com cada nível da árvore sendo separado por uma barra (/) (ver a <a href="#table_4-8">Exemplos de caminhos de carteira HD</a>). As chaves privadas derivadas a partir da chave privada mestra iniciam com "m". As chaves públicas derivadas a partir da chave pública mestra iniciam com "M". Portanto, a primeira chave privada filha da chave privada mestra é m/0. A primeira chave pública filha é M/0. A segunda neta da primeira filha é m/0/1, e assim por diante.</p>
</div>
<div class="paragraph data-line-1225">
<p>Os "antepassados" de uma chave são lidos da direita para a esquerda, até você chegar na chave mestra a partir da qual eles foram derivados. Por exemplo, o identificador m/x/y/z descreve a chave privada que é a zª filha da chave privada pai m/x/y, que é a yª filha da chave privada pai m/x, que é a xª filha da chave privada pai mestra m.</p>
</div>
<table id="table_4-8" class="tableblock frame-all grid-all stretch data-line-1230">
<caption class="title">Table 14. Exemplos de caminhos de carteira HD</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Caminho HD</th>
<th class="tableblock halign-left valign-top">Chave descrita</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A primeira (0) chave privada filha da chave privada mestra (m)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m/0/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A primeira (0) chave privada filha da primeira filha (m/0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m/0'/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A primeira (0) filha normal da primeira filha <em>endurecida</em> (m/0')</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m/1/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A primeira (0) chave privada filha da segunda filha (m/1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M/23/17/0/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A primeira (0) chave pública filha da primeira filha (M/23/17/0) da 18ª filha (M/23/17) da 24ª filha (M/23)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-1239">
<p>===== Navegando a estrutura em forma de árvore da carteira HD</p>
</div>
<div class="paragraph data-line-1241">
<p>A estrutura em forma de árvore da carteira HD oferece uma enorme flexibilidade. Cada chave estendida pai pode ter quatro bilhões de chaves filhas: dois bilhões de chaves filhas normais e dois bilhões de chaves filhas endurecidas. Cada uma dessas chaves filhas pode ter outras quatro bilhões de chaves filhas, e assim por diante. A árvore pode ter a profundidade que for necessária, com um número infinito de gerações. No entanto, com toda essa flexibilidade, torna-se bastante difícil navegar nessa árvore infinita. É especialmente difícil transferir carteiras HD entre diferentes implementações, pois as possibilidades de organização interna em ramos e subramos são infinitas.</p>
</div>
<div class="paragraph data-line-1243">
<p>Duas BIPs oferecem uma solução para essa complexidade, ao criar alguns padrões propostos para a estrutura das árvores das carteiras HD. A BIP-43 propõe o uso do índice da primeira filha endurecida como um identificador especial que representa o "propósito" da estrutura em forma de árvore. Baseando-se na BIP-43, uma carteira HD deveria usar apenas um ramo de nível 1 da árvore, com o número índice identificando a estrutura e o espaço de nomes do resto da árvore ao definir o seu propósito. Por exemplo, uma carteira HD usando apenas o ramo m/i&amp;#x27;/ se destina a um propósito específico, e esse propósito é identificado pelo número índice "i".</p>
</div>
<div class="paragraph data-line-1245">
<p>Estendendo essa especificação, a BIP-44 propõe uma estrutura multiconta como número de "propósito" 44' sob a BIP-43. Todas as carteiras HD que seguem a estrutura BIP-44 são identificadas pelo fato de usarem apenas um ramo da árvore: m/44'/.</p>
</div>
<div class="paragraph data-line-1247">
<p>A BIP-44 especifica a estrutura como consistindo em cinco níveis de árvore predefinidos:</p>
</div>
<div class="listingblock data-line-1249">
<div class="content">
<pre>m / purpose' / coin_type' / account' / change / address_index</pre>
</div>
</div>
<div class="paragraph data-line-1253">
<p>O primeiro nível, "purpose" (propósito) é sempre definido como 44'. O segundo nível, "coin_type" especifica o tipo da criptomoeda, permitindo a existência de carteiras HD com suporte a múltiplas moedas, onde cada moeda possui a sua própria subárvore sob o segundo nível. Existem três moedas definidas até o momento: o Bitcoin é m/44'/0', a Testnet do Bitcoin é m/44&amp;#x27;/1&amp;#x27; e a Litecoin é m/44&amp;#x27;/2&amp;#x27;.</p>
</div>
<div class="paragraph data-line-1255">
<p>O terceiro nível da árvore é o "account" (conta), que permite que os usuários subdividam suas carteiras em subcontas separadas de maneira lógica, para fins de contabilidade e organização. Por exemplo, uma carteira HD pode conter duas "contas" de bitcoin: m/44&amp;#x27;/0&amp;#x27;/0&amp;#x27; e m/44&amp;#x27;/0&amp;#x27;/1&amp;#x27;. Cada conta é a raiz de sua própria subárvore.</p>
</div>
<div class="paragraph data-line-1257">
<p>No quarto nível, "change" (troco), uma carteira HD tem duas subárvores, uma para criar endereços de recebimento e outra para criar endereços de troco. Note que enquanto os níveis anteriores usavam derivação endurecida, este nível usa derivação normal. Isso permite que este nível da árvore exporte chaves públicas estendidas para uso em um ambiente não seguro. Os endereços utilizáveis são derivados pela carteira HD como filhos do quarto nível, e o quinto nível da árvore, o "address_index", é usado para o índice do endereço. Por exemplo, o terceiro endereço de recebimento para pagamentos de bitcoin na conta principal seria M/44&amp;#x27;/0&amp;#x27;/0&amp;#x27;/0/2. A <a href="#table_4-9">Exemplos de estrutura de carteira HD da BIP-44</a> mostra mais alguns exemplos.</p>
</div>
<table id="table_4-9" class="tableblock frame-all grid-all stretch data-line-1262">
<caption class="title">Table 15. Exemplos de estrutura de carteira HD da BIP-44</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Caminho HD</th>
<th class="tableblock halign-left valign-top">Chave descrita</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M/44&amp;#x27;/0&amp;#x27;/0&amp;#x27;/0/2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A terceira chave pública para endereço de recebimento da primeira conta de bitcoin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M/44&amp;#x27;/0&amp;#x27;/3&amp;#x27;/1/14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A décima quinta chave pública para endereço de troco da quarta conta de bitcoin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m/44&amp;#x27;/2&amp;#x27;/0&amp;#x27;/0/1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A segunda chave privada na conta principal de Litecoin, usada para assinar transações</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-1269">
<p>==== Usando uma Chave Pública Estendida em uma Loja Virtual</p>
</div>
<div class="paragraph data-line-1271">
<p>Para vermos como as carteiras HD são usadas, vamos continuar a nossa história da loja virtual do Gabriel.</p>
</div>
<div class="paragraph data-line-1273">
<p>Gabriel first set up his web store as a hobby, based on a simple hosted Wordpress page. His store was quite basic with only a few pages and an order form with a single Bitcoin address.</p>
</div>
<div class="paragraph data-line-1275">
<p>Gabriel used the first Bitcoin address generated by his Trezor device as the main Bitcoin address for his store. This way, all incoming payments would be paid to an address controlled by his Trezor hardware wallet.</p>
</div>
<div class="paragraph data-line-1277">
<p>Customers would submit an order using the form and send payment to Gabriel&#8217;s published Bitcoin address, triggering an email with the order details for Gabriel to process. With just a few orders each week, this system worked well enough.</p>
</div>
<div class="paragraph data-line-1279">
<p>No entanto, a pequena loja virtual fez muito sucesso e acabou recebendo muitos pedidos da comunidade local. Em pouco tempo, Gabriel ficou sobrecarregado. Com todos os pedidos pagando no mesmo endereço, tornou-se difícil combinar corretamente os pedidos e as transações, especialmente quando vários pedidos de mesmo valor eram realizados em um curto intervalo de tempo.</p>
</div>
<div class="paragraph data-line-1281">
<p>A carteira HD do Gabriel oferece uma solução muito melhor, pois ela é capaz de derivar chaves públicas filhas sem conhecer as chaves privadas. Gabriel pode colocar uma chave pública estendida (xpub) em seu site, que pode ser usada para derivar um endereço único para cada pedido de cliente. Gabriel pode gastar o dinheiro de sua Trezor, mas a xpub carregada no site só é capaz de gerar endereços e receber fundos. Este recurso das carteiras HD é um ótimo recurso de segurança. Por não conter nenhuma chave privada, o site do Gabriel não precisa de altos níveis de segurança.</p>
</div>
<div class="paragraph data-line-1283">
<p>To export the xpub, Gabriel uses the Trezor Suite desktop app in conjunction with the Trezor hardware wallet. The Trezor device must be plugged in for the public keys to be exported. Note that hardware wallets will never export private keys&#x2014;those always remain on the device. <a href="#export_xpub">Exportando uma xpub de uma carteira de hardware Trezor</a> shows what Gabriel sees in Trezor Suite when exporting the xpub.</p>
</div>
<div id="export_xpub" class="imageblock data-line-1287">
<div class="content">
<img src="images/mbc2_0512.png" alt="Exporting the xpub from the Trezor">
</div>
<div class="title">Figure 34. Exportando uma xpub de uma carteira de hardware Trezor</div>
</div>
<div class="paragraph data-line-1289">
<p>Gabriel copia a xpub para o software de pagamento de bitcoin de sua loja online. Ele usa o <em>BTCPay Server</em>, que é uma plataforma de loja virtual de código aberto disponível para vários tipos de hospedagem e plataformas de conteúdo. O <em>BTCPay Server</em> usa a xpub para gerar um endereço único para cada compra. </p>
</div>
<div class="paragraph data-line-1291">
<p>===== Importação e Gerenciamento de Contas</p>
</div>
<div class="paragraph data-line-1293">
<p>Gabriel&#8217;s business is flourishing. He has provided his extended public key (xpub) to <em>BTCPay Server</em>, which is generating unique addresses for customers to his website. Every time a customer to Gabriel&#8217;s website clicks on the "Checkout" button with a specified payment modality (in this case, bitcoin), <em>BTCPay Server</em> generates a new address for that customer.  More specifically, <em>BTCPay Server</em> iterates on the <em>address_index</em> tree to create a new address to display to the customer, as defined by BIP-44. If the customer decides to switch payment methods or abandon the transaction entirely, this Bitcoin address goes unused and will not be used for another customer right away.</p>
</div>
<div class="paragraph data-line-1295">
<p>Em um determinado momento, o site de Gabriel pode ter um grande volume de endereços pendentes para clientes que estejam fazendo compras, alguns dos quais podem ficar inutilizados e, eventualmente, expirar. Assim que esses endereços expirarem, o <em>BTCPay Server</em> voltará a reutilizar esses endereços para preencher a lacuna na <em>address_index</em>, mas nosso exemplo demonstra como podem surgir lacunas entre as folhas da árvore determinística hierárquica, que é onde o dinheiro realmente está localizado.</p>
</div>
<div class="paragraph data-line-1297">
<p>Digamos que o Gabriel esteja interessado em ver a sua quantia total de bitcoins recebidos em uma carteira somente-leitura (uma carteira que permite que você visualize o histórico de transações, mas não permite que você gaste os fundos) separada do servidor <em>BTCPay</em>, mas que também está em conformidade com o padrão BIP-44. Como essa carteira separada deve proceder para procurar fundos nesta vasta árvore hierárquica, e quando ela deve parar de procurar? A maioria das carteiras seguirá um processo iterativo que utiliza um limite predefinido, o <em>limite de lacuna</em> (em inglês, <em>gap limit</em>). Se, enquanto estiver procurando por endereços usados, a carteira não encontrar endereços usados consecutivamente além desse número limite, ela parará de pesquisar a cadeia de endereços. O limite de lacuna padrão é normalmente definido como 20. Esse processo é detalhado na <a id="bip-44"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki">BIP-44</a>.</p>
</div>
<div class="admonitionblock tip data-line-1300">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1301">
<p>Os limites de gap explicam o fenômeno pelo qual a importação de uma carteira pode apresentar um saldo incorreto ou zero. Os fundos não são perdidos, mas, a função de importação de carteira, neste caso, não percorreu o suficiente para detectar totalmente os fundos. Muitas carteiras permitem que esse limite de lacuna padrão seja alterado, e Gabriel pode precisar aumentar esse limite para permitir que sua carteira importe totalmente seu histórico de transações.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="transactions" class="paragraph data-line-1306">
<p>== Transações</p>
</div>
<div id="ch06_intro" class="paragraph data-line-1309">
<p>=== Introdução</p>
</div>
<div class="paragraph data-line-1311">
<p>Transactions are the most important part of the Bitcoin system. Everything else in bitcoin is designed to ensure that transactions can be created, propagated on the network, validated, and finally added to the global ledger of transactions (the blockchain). Transactions are data structures that encode the transfer of value between participants in the Bitcoin system. Each transaction is a public entry in bitcoin&#8217;s blockchain, the global double-entry bookkeeping ledger.</p>
</div>
<div class="paragraph data-line-1313">
<p>Neste capítulo, examinaremos as várias formas de transações, o que elas contêm, como criá-las, como elas são verificadas e como elas se tornam parte do registro permanente de todas as transações. Quando usamos o termo "carteira" neste capítulo, estamos nos referindo ao software que constrói transações, e não apenas ao banco de dados de chaves.</p>
</div>
<div id="tx_structure" class="paragraph data-line-1316">
<p>=== Transações em Detalhe</p>
</div>
<div class="paragraph data-line-1318">
<p>No <a href="#ch02_bitcoin_overview">[ch02_bitcoin_overview]</a>, analisamos a transação que a Alice usou para pagar pelo café na cafeteria do Bob usando um explorador de blocos (<a href="#alices_transactions_to_bobs_cafe">Transação da Alice para a Cafeteria do Bob</a>).</p>
</div>
<div class="paragraph data-line-1320">
<p>O explorador de blocos mostra uma transação do "endereço" da Alice para o "endereço" do Bob. Esta é uma visão muito simplificada do que está contido em uma transação. Na verdade, como veremos neste capítulo, muitas das informações mostradas são construídas pelo explorador de blocos e não estão realmente na transação.</p>
</div>
<div id="alices_transactions_to_bobs_cafe" class="imageblock data-line-1324">
<div class="content">
<img src="images/mbc2_0208.png" alt="Alice Coffee Transaction">
</div>
<div class="title">Figure 35. Transação da Alice para a Cafeteria do Bob</div>
</div>
<div id="transactions_behind_the_scenes" class="paragraph data-line-1327">
<p>==== Transações&#x2014;Nos Bastidores</p>
</div>
<div class="paragraph data-line-1329">
<p>Behind the scenes, an actual transaction looks very different from a transaction provided by a typical block explorer. In fact, most of the high-level constructs we see in the various bitcoin application user interfaces <em>do not actually exist</em> in the Bitcoin system.</p>
</div>
<div class="paragraph data-line-1331">
<p>Podemos usar a interface de linha de comando do Bitcoin Core (getrawtransaction e decoderawtransaction) para recuperar a transação "bruta" da Alice, decodificá-la e ver o que ela contém. O resultado é o seguinte:</p>
</div>
<div id="alice_tx" class="listingblock data-line-1336">
<div class="title">Transação da Alice decodificada</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "version": 1,
  "locktime": 0,
  "vin": [
    {
      "txid": "7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18",
      "vout": 0,
      "scriptSig" : "3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813[ALL] 0484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adf",
      "sequence": 4294967295
    }
  ],
  "vout": [
    {
      "value": 0.01500000,
      "scriptPubKey": "OP_DUP OP_HASH160 ab68025513c3dbd2f7b92a94e0581f5d50f654e7 OP_EQUALVERIFY OP_CHECKSIG"
    },
    {
      "value": 0.08450000,
      "scriptPubKey": "OP_DUP OP_HASH160 7f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a8 OP_EQUALVERIFY OP_CHECKSIG",
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph data-line-1361">
<p>Você pode notar algumas coisas sobre esta transação, principalmente as coisas que estão faltando! Onde está o endereço da Alice? Onde está o endereço do Bob? Onde está a entrada de 0.1 "enviada" pela Alice? No bitcoin não há moedas, nem remetentes, nem destinatários, nem saldos, nem contas, nem endereços. Todas essas coisas são construídas em um nível superior para o benefício do usuário, para tornar as coisas mais fáceis de serem entendidas.</p>
</div>
<div class="paragraph data-line-1363">
<p>Você também pode notar muitos campos estranhos e indecifráveis, assim como <em>strings</em> hexadecimais. Não se preocupe, explicaremos cada campo mostrado aqui em detalhes neste capítulo.</p>
</div>
<div id="tx_inputs_outputs" class="paragraph data-line-1366">
<p>=== Saídas e Entradas de Transação</p>
</div>
<div class="paragraph data-line-1368">
<p>O que dá origem a uma transação de bitcoin é uma <em>saída de transação</em>. As saídas de transação (em inglês, <em>transaction outputs</em>) são partes indivisíveis da moeda bitcoin, registradas na blockchain e reconhecidas como válidas por toda a rede. Os nós completos do bitcoin rastreiam todas as saídas que estão disponíveis e podem ser gastas, conhecidas como <em>saídas de transação não gastas</em> (em inglês,  <em>unspent transaction outputs</em> ou UTXOs). A coleção de todas as UTXOs é conhecida como o <em>conjunto UTXO</em> e atualmente está na casa das milhões de UTXOs. O conjunto UTXO cresce quando uma nova UTXO é criada e diminui quando uma UTXO é consumida. Cada transação representa uma mudança (transição de estado) no conjunto UTXO.</p>
</div>
<div class="paragraph data-line-1370">
<p>Quando dizemos que a carteira de um usuário "recebeu" bitcoin, o que queremos dizer é que a carteira detectou na blockchain um UTXO que pode ser gasto com uma das chaves controladas por essa carteira. Assim, o "saldo" de bitcoin de um usuário é a soma de todo o UTXO que a carteira do usuário pode gastar e que pode estar espalhado entre centenas de transações e em centenas de blocos. O conceito de saldo é criado pela aplicação da carteira. A carteira calcula o saldo do usuário escaneando a blockchain e agregando o valor de qualquer UTXO que a carteira possa gastar com as chaves que ela controla. A maioria das carteiras mantém um banco de dados ou usa um serviço de banco de dados para armazenar um conjunto de referência rápida de todo o UTXO que podem gastar com as chaves que controlam.</p>
</div>
<div class="paragraph data-line-1372">
<p><a href="#utxo-stxo">Cadeia de transações entre Joe e Gopesh sendo construída na blockchain</a>exibe a blockchain em três momentos diferentes, conforme a cadeia de transações entre Joe e Gopesh que está sendo construída. Observe como cada transação gasta um UTXO que foi criado em uma transação anterior, transformando-o em uma <em>saída de transação gasta</em> ou <em>STXO</em>. Como a transação nº 1 (de Joe para Alice) gasta um único UTXO (de Joe) e cria um único UTXO (para Alice), ela não modifica o tamanho do conjunto do UTXO. Por outro lado, as transações 2 e 3 criam saídas de troco para o remetente, gastando um único UTXO e criando dois UTXO (o pagamento e a saída de troco). Portanto, cada um deles aumenta o tamanho do conjunto UTXO em 1.</p>
</div>
<div id="utxo-stxo" class="imageblock data-line-1376">
<div class="content">
<img src="images/mbc2_0609.png" alt="Cadeia de transação entre Joe e Gopesh sendo construída na blockchain">
</div>
<div class="title">Figure 36. Cadeia de transações entre Joe e Gopesh sendo construída na blockchain</div>
</div>
<div class="paragraph data-line-1378">
<p>A saída de uma transação pode ter um valor arbitrário (inteiro) denominado como um múltiplo de satoshis. Assim como os dólares podem ser divididos em até duas casas decimais como centavos, o bitcoin pode ser dividido em até oito casas decimais como satoshis. Embora uma saída possa ter qualquer valor arbitrário, uma vez criada, ela é indivisível. Esta é uma característica importante das saídas que precisa ser enfatizada: as saídas são unidades de valor <em>discretas</em> e <em>indivisíveis</em>, denominadas em satoshis inteiros. Uma saída não gasta só pode ser consumida em sua totalidade por uma transação.</p>
</div>
<div class="paragraph data-line-1380">
<p>Se uma UTXO é maior do que o valor desejado de uma transação, ela precisa ser totalmente consumida e um troco deve ser gerado na transação. Em outras palavras, se você possui uma UTXO que vale 20 bitcoins, e você quer pagar apenas 1 bitcoin, a sua transação precisa consumir toda a UTXO de 20 bitcoins e produzir duas saídas: uma que paga 1 bitcoin para o destinatário desejado e outra que paga 19 bitcoins em troco de volta para a sua carteira. Devido à natureza indivisível das saídas de transação, a maioria das transações de bitcoin precisa gerar troco.</p>
</div>
<div class="paragraph data-line-1382">
<p>Imagine uma cliente comprando uma bebida de $1,50, pegando sua carteira e tentando achar uma combinação de moedas e notas para atingir o valor de $1,50. A cliente poderá escolher pagar a quantia exata, se disponível, com uma nota de um dólar e duas moedas de 25 centavos, ou com uma combinação de pequenas denominações (6 moedas de 25 centavos), ou, se necessário, com uma unidade maior, como uma nota de 5 dólares. Se ela der dinheiro em excesso ao dono da loja, digamos $5, ela esperará um troco de $3,50, o qual ela guardará em sua carteira, onde ficará disponível para transações futuras.</p>
</div>
<div class="paragraph data-line-1384">
<p>De maneira semelhante, uma transação de bitcoin precisa ser criada a partir de uma UTXO do usuário em quaisquer denominações que o usuário tiver disponível. Os usuários não podem dividir uma UTXO pela metade, da mesma maneira que eles não podem cortar uma nota de um dólar pela metade e usá-la para fazer pagamentos. O aplicativo de carteira do usuário geralmente selecionará algumas UTXOs entre as UTXOs disponíveis do usuário, com o objetivo de juntar uma quantia maior ou igual ao valor desejado da transação.</p>
</div>
<div class="paragraph data-line-1386">
<p>Assim como na vida real, a aplicação de bitcoin possui várias estratégias para satisfazer a quantia de compra: combinar várias unidades menores, procurar pelo troco exato ou usar uma unidade única maior que o valor da transação e receber o troco. Toda essa complexa administração das UTXOs gastáveis é feita de maneira automática pela carteira do usuário, e os usuários sequer tomam conhecimento dela. A administração das UTXOs só é relevante se você for um programador e estiver construindo transações brutas a partir de UTXOs.</p>
</div>
<div class="paragraph data-line-1388">
<p>Uma transação consome saídas de transação não gastas registradas anteriormente e cria novas saídas de transação que podem ser consumidas por uma transação futura. Dessa forma, pedaços de valor de bitcoin passam de proprietário a proprietário em uma cadeia de transações que consome e cria UTXOs.</p>
</div>
<div class="paragraph data-line-1390">
<p>A exceção para a cadeia de entradas e saídas é um tipo especial de transação chamada de transação <em>coinbase</em>, que é a primeira transação em cada bloco. Essa transação é inserida no bloco pelo minerador "vencedor" e cria bitcoins novos, recém-criados, que serão pagos para o minerador como uma recompensa por ter conseguido minerar o bloco. Esta transação especial não consome UTXOs; em vez disso, ela tem um tipo especial de entrada chamada "coinbase". É assim que a oferta monetária do bitcoin é criada durante o processo de mineração, como veremos no <a href="#mining">[mining]</a>.</p>
</div>
<div class="admonitionblock tip data-line-1393">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1394">
<p>E o que vem primeiro? As entradas ou as saídas, a galinha ou o ovo? Falando estritamente, as saídas vem primeiro, pois as transações coinbase, que geram os novos bitcoins, não tem entradas e criam saídas a partir do nada.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="tx_outs" class="paragraph data-line-1398">
<p>==== Saídas de Transação</p>
</div>
<div class="paragraph data-line-1400">
<p>Toda transação de bitcoin cria saídas (em inglês, <em>outputs</em>), que são gravadas no livro-razão do bitcoin (a cadeia de blocos). Quase todas essas saídas, com uma exceção (ver <a href="#op_return">[op_return]</a>), criam partes de bitcoin gastáveis chamadas <em>saídas de transação não gastas</em> ou UTXO (em inglês, <em>Unspent Transaction Output</em>), que são então reconhecidas por toda a rede e se tornam disponíveis para que o dono gaste em uma transação futura.</p>
</div>
<div class="paragraph data-line-1402">
<p>UTXO are tracked by every full-node Bitcoin client in the UTXO set. New transactions consume (spend) one or more of these outputs from the UTXO set.</p>
</div>
<div class="paragraph data-line-1404">
<p>As saídas de transação consistem em duas partes:</p>
</div>
<div class="ulist data-line-1406">
<ul>
<li class="data-line-1406">
<p>Uma quantidade de bitcoin, denominada em <em>satoshis</em>, a menor unidade do bitcoin</p>
</li>
<li class="data-line-1407">
<p>Um quebra-cabeça criptográfico que determina as condições necessárias para se gastar a saída</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1409">
<p>O quebra-cabeça criptográfico também é conhecido como um <em>script de travamento</em> (em inglês, <em>locking script</em>), um <em>script de testemunha</em> (em inglês, <em>witness script</em>) ou um scriptPubKey.</p>
</div>
<div class="paragraph data-line-1411">
<p>A linguagem de script da transação, usada no script de travamento mencionado anteriormente, é discutida em detalhes em <a href="#tx_script">[tx_script]</a>.</p>
</div>
<div class="paragraph data-line-1413">
<p>Agora, vamos dar uma olhada na transação da Alice (mostrada anteriormente em <a href="#transactions_behind_the_scenes">[transactions_behind_the_scenes]</a>) e ver se conseguimos identificar as saídas. Na codificação JSON, as saídas estão em um array (uma lista) chamado vout:</p>
</div>
<div class="listingblock data-line-1416">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">"vout": [
  {
    "value": 0.01500000,
    "scriptPubKey": "OP_DUP OP_HASH160 ab68025513c3dbd2f7b92a94e0581f5d50f654e7 OP_EQUALVERIFY
    OP_CHECKSIG"
  },
  {
    "value": 0.08450000,
    "scriptPubKey": "OP_DUP OP_HASH160 7f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a8 OP_EQUALVERIFY OP_CHECKSIG",
  }
]</code></pre>
</div>
</div>
<div class="paragraph data-line-1430">
<p>Como você pode ver, a transação contém duas saídas. Cada saída é definida por um valor e um quebra-cabeça criptográfico. Na codificação mostrada pelo Bitcoin Core, o valor (em inglês, value) é mostrado em bitcoin, mas na transação em si ele é registrado como um número inteiro denominado em satoshis. A segunda parte de cada saída é o quebra-cabeça criptográfico que define as condições de gasto. O Bitcoin Core exibe-o como scriptPubKey e nos mostra uma representação legível do script.</p>
</div>
<div class="paragraph data-line-1432">
<p>O tópico sobre o travamento e o destravamento de UTXOs será discutido mais tarde, em <a href="#tx_lock_unlock">[tx_lock_unlock]</a>. A linguagem de script que é usada para o script em scriptPubKey é discutida em <a href="#tx_script">[tx_script]</a>. Mas antes de nos aprofundarmos nesses tópicos, precisamos entender a estrutura geral das entradas e saídas de transação.</p>
</div>
<div class="paragraph data-line-1434">
<p>===== Serialização da Transação&#x2014;saídas</p>
</div>
<div class="paragraph data-line-1436">
<p>Quando as transações são transmitidas pela rede ou trocadas entre aplicativos, elas são <em>serializadas</em>. Serialização é o processo de converter a representação interna de uma estrutura de dados em um formato que pode ser transmitido um byte por vez, também conhecido como um fluxo de bytes. A serialização é mais comumente usada para codificar estruturas de dados para transmissão em uma rede ou para armazenamento em um arquivo. O formato de serialização de uma saída de transação é mostrado na <a href="#tx_out_structure">Serialização da saída de transação</a>.</p>
</div>
<table id="tx_out_structure" class="tableblock frame-all grid-all stretch data-line-1441">
<caption class="title">Table 16. Serialização da saída de transação</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tamanho</th>
<th class="tableblock halign-left valign-top">Campo</th>
<th class="tableblock halign-left valign-top">Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 bytes (little-endian)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Quantia</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valor de bitcoin em satoshis (10<sup>-8</sup> bitcoin)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1&#x2013;9 bytes (VarInt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tamanho do Script de Travamento</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comprimento em bytes do Script de Travamento</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Variável</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Script de Travamento</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Um script definindo as condições necessárias para se gastar a saída</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-1448">
<p>A maioria das bibliotecas e frameworks de bitcoin não armazena transações internamente como fluxos de bytes, pois isso exigiria uma análise sintática complexa toda vez que você precisasse acessar um único campo. Por conveniência e legibilidade, as bibliotecas de bitcoin armazenam as transações internamente em estruturas de dados (geralmente estruturas orientadas a objetos).</p>
</div>
<div class="paragraph data-line-1450">
<p>O processo de conversão da representação em fluxo de bytes de uma transação em uma estrutura de dados da representação interna de uma biblioteca é chamada de <em>deserialização</em> ou <em>análise sintática da transação</em> (em inglês, <em>transaction parsing</em>). O processo de conversão de volta para um fluxo de bytes, a fim de ser transmitido pela rede, submetido a uma função de hash ou armazenado em disco, é chamado de <em>serialização</em>. A maioria das bibliotecas do bitcoin possui funções para fazer a serialização e a desserialização de transações.</p>
</div>
<div class="paragraph data-line-1452">
<p>Veja se você consegue decodificar manualmente a transação da Alice a partir da forma hexadecimal serializada, encontrando alguns dos elementos que vimos anteriormente. Para ajudá-lo, a seção que contém as duas saídas está destacada no <a href="#example_6_1">Transação da Alice, serializada e apresentada em notação hexadecimal</a>:</p>
</div>
<div id="example_6_1" class="exampleblock data-line-1456">
<div class="title">Example 18. Transação da Alice, serializada e apresentada em notação hexadecimal</div>
<div class="content">
<div class="paragraph data-line-1457">
<p>0100000001186f9f998a5aa6f048e51dd8419a14d8a0f1a8a2836dd73
4d2804fe65fa35779000000008b483045022100884d142d86652a3f47
ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039
ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813
01410484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade84
16ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc1
7b4a10fa336a8d752adfffffffff02<strong>60e31600000000001976a914ab6</strong>
<strong>8025513c3dbd2f7b92a94e0581f5d50f654e788acd0ef800000000000</strong>
<strong>1976a9147f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a888ac</strong>
00000000</p>
</div>
</div>
</div>
<div class="paragraph data-line-1469">
<p>Aqui estão algumas dicas:</p>
</div>
<div class="ulist data-line-1471">
<ul>
<li class="data-line-1471">
<p>Existem duas saídas na seção destacada, cada uma serializada conforme mostrado na <a href="#tx_out_structure">Serialização da saída de transação</a>.</p>
</li>
<li class="data-line-1472">
<p>O valor de 0,015 bitcoin equivale a 1.500.000 satoshis, que é 16 e3 60 em hexadecimal.</p>
</li>
<li class="data-line-1473">
<p>Na transação serializada, o valor 16 e3 60 é codificado na ordem de bytes <em>little-endian</em> (byte menos significativo primeiro), resultando em 60 e3 16.</p>
</li>
<li class="data-line-1474">
<p>O comprimento do scriptPubKey é 25 bytes, que é 19 em hexadecimal.</p>
</li>
</ul>
</div>
<div id="tx_inputs" class="paragraph data-line-1477">
<p>==== Entradas de Transação</p>
</div>
<div class="paragraph data-line-1479">
<p>As entradas de transação identificam (por referência) qual UTXO será consumida e fornecem uma prova de posse através de um script de destravamento.</p>
</div>
<div class="paragraph data-line-1481">
<p>Para construir uma transação, uma carteira seleciona, das UTXOs que ela controla, UTXOs com valor suficiente para fazer o pagamento solicitado. Às vezes, uma UTXO é suficiente, outras vezes, mais de uma é necessária. Para cada UTXO que será consumida para fazer este pagamento, a carteira cria uma entrada apontando para a UTXO e a destrava com um script de destravamento.</p>
</div>
<div class="paragraph data-line-1483">
<p>Vamos analisar os componentes de uma entrada em maiores detalhes. A primeira parte de uma entrada é um apontador para uma UTXO por referência ao hash da transação e um índice de saída, que identifica a UTXO específica naquela transação. A segunda parte é um script de destravamento, que a carteira constrói para atender às condições de gasto definidas na UTXO. Na maioria das vezes, o script de destravamento é uma assinatura digital e uma chave pública que provam a posse do bitcoin. No entanto, nem todos os scripts de destravamento contêm assinaturas. A terceira parte é um número de sequência, que será discutido posteriormente.</p>
</div>
<div class="paragraph data-line-1485">
<p>Considere nosso exemplo em <a href="#transactions_behind_the_scenes">[transactions_behind_the_scenes]</a>. As entradas da transação são um array (lista) chamado vin:</p>
</div>
<div id="vin" class="listingblock data-line-1490">
<div class="title">As entradas de transação na transação da Alice</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">"vin": [
  {
    "txid": "7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18",
    "vout": 0,
    "scriptSig" : "3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813[ALL] 0484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adf",
    "sequence": 4294967295
  }
]</code></pre>
</div>
</div>
<div class="paragraph data-line-1501">
<p>Como você pode ver, só existe uma entrada na lista (porque uma UTXO continha valor suficiente para fazer este pagamento). A entrada contém quatro elementos:</p>
</div>
<div class="ulist data-line-1503">
<ul>
<li class="data-line-1503">
<p>Um ID de transação, referenciando a transação que contém a UTXO sendo gasta</p>
</li>
<li class="data-line-1504">
<p>Um índice de saída (vout), identificando qual UTXO daquela transação é referenciada (a primeira tem índice igual a zero)</p>
</li>
<li class="data-line-1505">
<p>Um scriptSig, que satisfaz as condições colocadas na UTXO, destravando-a para ser gasta</p>
</li>
<li class="data-line-1506">
<p>Um número de sequência (que será discutido mais tarde)</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1508">
<p>Na transação da Alice, a entrada aponta para o ID de transação:</p>
</div>
<div class="listingblock data-line-1510">
<div class="content">
<pre>7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18</pre>
</div>
</div>
<div class="paragraph data-line-1514">
<p>e o índice de saída 0 (ou seja, a primeira UTXO criada por aquela transação). O script de destravamento é construído pela carteira de Alice primeiro recuperando a UTXO referenciada, depois examinando seu script de travamento e, em seguida, usando-o para construir o script de destravamento necessário para satisfazê-lo.</p>
</div>
<div class="paragraph data-line-1516">
<p>Olhando apenas para a entrada, você deve ter notado que não sabemos nada sobre esta UTXO, exceto uma referência à transação pai que a contém. Não sabemos seu valor (quantia em satoshis) e não conhecemos o script de travamento que define as condições para gastá-la. Para encontrar essas informações, devemos recuperar a UTXO referenciada recuperando a transação pai que a contém. Observe que, como o valor da entrada não é declarado explicitamente, também devemos usar a UTXO referenciada para calcular as taxas que serão pagas nesta transação (ver <a href="#tx_fees">[tx_fees]</a>).</p>
</div>
<div class="paragraph data-line-1518">
<p>Não é apenas a carteira da Alice que precisa recuperar as UTXOs referenciadas nas entradas. Uma vez que essa transação é transmitida para a rede, todos os nós validadores também precisarão recuperar as UTXOs referenciadas nas entradas da transação para poder validar a transação.</p>
</div>
<div class="paragraph data-line-1520">
<p>As transações por si sós parecem incompletas, pois elas não têm contexto. Elas fazem referência às UTXOs em suas entradas, mas, sem recuperar essas UTXOs, não podemos saber o valor das entradas ou suas condições de travamento. Ao escrever um software de bitcoin, sempre que você decodificar uma transação com a intenção de validá-la, ou para contar as taxas, ou para verificar o script de destravamento, seu código terá primeiro de recuperar a UTXO referenciada da blockchain para construir o contexto que está implícito, mas que não está presente nas referências de UTXO das entradas. Por exemplo, para calcular o valor pago em taxas, é necessário saber a soma dos valores das entradas e saídas. Mas sem recuperar as UTXOs referenciadas nas entradas, você não sabe o valor delas. Portanto, uma operação aparentemente simples, como calcular as taxas de uma única transação, na verdade envolve várias etapas e dados de múltiplas transações.</p>
</div>
<div class="paragraph data-line-1522">
<p>Podemos usar a mesma sequência de comandos do Bitcoin Core que usamos ao recuperar a transação da Alice (getrawtransaction e decoderawtransaction). Com isso, conseguimos obter a UTXO referenciada na entrada da transação da Alice e dar uma olhada:</p>
</div>
<div id="alice_input_tx" class="listingblock data-line-1527">
<div class="title">A UTXO da transação anterior, referenciada na entrada da transação da Alice</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">"vout": [
   {
     "value": 0.10000000,
     "scriptPubKey": "OP_DUP OP_HASH160 7f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a8 OP_EQUALVERIFY OP_CHECKSIG"
   }
 ]</code></pre>
</div>
</div>
<div class="paragraph data-line-1536">
<p>Vemos que esta UTXO tem um valor de 0,1 BTC e que ela possui um script de travamento (scriptPubKey) que contém "OP_DUP OP_HASH160&#8230;&#8203;".</p>
</div>
<div class="admonitionblock tip data-line-1539">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1540">
<p>Para entender completamente a transação da Alice, tivemos que recuperar a transação anterior referenciada como entrada. Uma função que recupera transações anteriores e saídas de transação não gastas é muito comum e existe em quase todas as bibliotecas e APIs do bitcoin.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1543">
<p>===== Serialização da Transação&#x2014;entradas</p>
</div>
<div class="paragraph data-line-1545">
<p>Quando as transações são serializadas para transmissão na rede, suas entradas são codificadas em um fluxo de bytes, conforme mostrado na <a href="#tx_in_structure">Serialização da entrada de transação</a>.</p>
</div>
<table id="tx_in_structure" class="tableblock frame-all grid-all stretch data-line-1550">
<caption class="title">Table 17. Serialização da entrada de transação</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tamanho</th>
<th class="tableblock halign-left valign-top">Campo</th>
<th class="tableblock halign-left valign-top">Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hash da Transação</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apontador para a transação contendo a UTXO a ser gasta</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Índice da Saída</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O número índice da UTXO a ser gasta; o primeiro é 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1&#x2013;9 bytes (VarInt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tamanho do Script de Destravamento</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comprimento em bytes do Script de Destravamento</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Variável</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Script de Destravamento</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Um script que preenche as condições necessárias para o script de travamento da UTXO</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Número de Sequência</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Usado para o locktime ou desabilitado (0xFFFFFFFF)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-1559">
<p>Assim como fizemos com as saídas, vamos ver se conseguimos encontrar as entradas da transação da Alice no formato serializado. Primeiro, as entradas decodificadas:</p>
</div>
<div class="listingblock data-line-1562">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">"vin": [
  {
    "txid": "7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18",
    "vout": 0,
    "scriptSig" : "3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813[ALL] 0484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adf",
    "sequence": 4294967295
  }
],</code></pre>
</div>
</div>
<div class="paragraph data-line-1573">
<p>Agora, vamos ver se conseguimos identificar esses campos na codificação hexadecimal serializada no <a href="#example_6_2">Transação da Alice, serializada e apresentada em notação hexadecimal</a>:</p>
</div>
<div id="example_6_2" class="exampleblock data-line-1577">
<div class="title">Example 19. Transação da Alice, serializada e apresentada em notação hexadecimal</div>
<div class="content">
<div class="paragraph data-line-1578">
<p>0100000001<strong>186f9f998a5aa6f048e51dd8419a14d8a0f1a8a2836dd73</strong>
<strong>4d2804fe65fa35779000000008b483045022100884d142d86652a3f47</strong>
<strong>ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039</strong>
<strong>ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813</strong>
<strong>01410484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade84</strong>
<strong>16ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc1</strong>
<strong>7b4a10fa336a8d752adfffffffff</strong>0260e31600000000001976a914ab6
8025513c3dbd2f7b92a94e0581f5d50f654e788acd0ef800000000000
1976a9147f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a888ac00000
000</p>
</div>
</div>
</div>
<div class="paragraph data-line-1590">
<p>Dicas:</p>
</div>
<div class="ulist data-line-1592">
<ul>
<li class="data-line-1592">
<p>O ID de transação é serializado em ordem de byte reversa, então começa com (hex) 18 e termina com 79</p>
</li>
<li class="data-line-1593">
<p>O índice da saída é um grupo de zeros de 4 bytes, que é fácil de identificar</p>
</li>
<li class="data-line-1594">
<p>O comprimento do scriptSig é 139 bytes, ou 8b em hexadecimal</p>
</li>
<li class="data-line-1595">
<p>O número de sequência é definido como FFFFFFFF, também fácil de ser identificado</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1597">
<p>O ScriptSig é um tipo específico de script de destravamento que, quando serializado para transmissão na rede, as entradas são codificadas em um fluxo de bytes, conforme mostrado na <a href="#scriptsig_in_structure">Serialização de entrada ScriptSig</a>. A serialização do campo de assinatura é detalhada em <a href="#seralization_of_signatures_der">[seralization_of_signatures_der]</a>. O campo de assinatura também inclui um tipo de hash de assinatura (SIGHASH), que é detalhado em <a href="#sighash_types">[sighash_types]</a>.</p>
</div>
<table id="scriptsig_in_structure" class="tableblock frame-all grid-all stretch data-line-1602">
<caption class="title">Table 18. Serialização de entrada ScriptSig</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tamanho</th>
<th class="tableblock halign-left valign-top">Campo</th>
<th class="tableblock halign-left valign-top">Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1&#x2013;9 bytes (VarInt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tamanho da Assinatura</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comprimento da assinatura em bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Variável</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assinatura</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uma assinatura que é produzida pela carteira do usuário a partir de sua chave privada, que inclui um SIGHASH</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1&#x2013;9 bytes (VarInt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tamanho da Chave Pública</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comprimento da chave pública em bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Variável</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Chave Pública</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A chave pública, não transformada em hash</p></td>
</tr>
</tbody>
</table>
<div id="tx_fees" class="paragraph data-line-1611">
<p>==== Taxas de Transação</p>
</div>
<div class="paragraph data-line-1613">
<p>A maioria das transações inclui taxas de transação, que compensam os mineradores de bitcoin por protegerem a rede. As taxas por si sós também servem como um mecanismo de segurança, tornando economicamente inviável para que atacantes inundem a rede com transações. A mineração, as taxas e as recompensas coletadas pelos mineradores são discutidas em maiores detalhes no <a href="#mining">[mining]</a>.</p>
</div>
<div class="paragraph data-line-1615">
<p>Esta seção examina como as taxas de transação são incluídas em uma transação típica. A maioria das carteiras calcula e inclui automaticamente as taxas de transação. No entanto, se você estiver criando transações através de programação ou usando uma interface de linha de comando, você deve contabilizar e incluir manualmente essas taxas.</p>
</div>
<div class="paragraph data-line-1617">
<p>As taxas de transação servem como um incentivo para incluir (minerar) uma transação no próximo bloco e também como um desincentivo ao abuso do sistema, ao imporem um pequeno custo em cada transação. As taxas de transação são coletadas pelo minerador que minera o bloco que registra a transação na blockchain.</p>
</div>
<div class="paragraph data-line-1619">
<p>Transaction fees are calculated based on the size of the transaction in kilobytes, not the value of the transaction in bitcoin. Overall, transaction fees are set based on market forces within the Bitcoin network. Miners prioritize transactions based on many different criteria, including fees, and might even process transactions for free under certain circumstances. Transaction fees affect the processing priority, meaning that a transaction with sufficient fees is likely to be included in the next block mined, whereas a transaction with insufficient or no fees might be delayed, processed on a best-effort basis after a few blocks, or not processed at all. Transaction fees are not mandatory, and transactions without fees might be processed eventually; however, including transaction fees encourages priority processing.</p>
</div>
<div class="paragraph data-line-1621">
<p>Ao longo do tempo, a forma como as taxas são calculadas e o efeito que elas tem na prioridade das transações evoluiu. Inicialmente, as taxas de transação eram fixas e constantes em toda a rede. Gradualmente, a estrutura de taxas foi flexibilizada, e agora as taxas podem ser influenciadas por forças do mercado, com base na capacidade da rede e no volume de transações. Desde, pelo menos, o início de 2016, os limites de capacidade no bitcoin criaram concorrência entre as transações, resultando em taxas mais altas e efetivamente tornando as transações gratuitas uma coisa do passado. Transações com taxa zero ou com taxa muito baixa raramente são mineradas e, às vezes, nem mesmo são propagadas pela rede.</p>
</div>
<div class="paragraph data-line-1623">
<p>No Bitcoin Core, as políticas de taxa para retransmissão são definidas pela opção minrelaytxfee. O valor padrão atual da minrelaytxfee é 0,00001 bitcoin ou um centésimo de milibitcoin por kilobyte. Portanto, por padrão, as transações com uma taxa inferior a 0,00001 bitcoin são tratadas como gratuitas e só serão retransmitidas se houver espaço na mempool; caso contrário, elas serão descartadas. Os nós de bitcoin podem substituir a política de taxa para retransmissão padrão ajustando o valor da minrelaytxfee.</p>
</div>
<div class="paragraph data-line-1625">
<p>Qualquer serviço de bitcoin que cria transações, incluindo carteiras, corretoras, aplicativos de varejo, etc., <em>deve</em> implementar taxas dinâmicas. As taxas dinâmicas podem ser implementadas por meio de um serviço de estimativa de taxa de terceiros ou com um algoritmo de estimativa de taxa integrado. Se você não tiver certeza, comece com um serviço de terceiros e, à medida que ganhar experiência, projete e implemente seu próprio algoritmo, caso você não queira mais ficar dependente de terceiros.</p>
</div>
<div class="paragraph data-line-1627">
<p>Os algoritmos de estimativa de taxa calculam a taxa apropriada, com base na capacidade e nas taxas oferecidas pelas transações que estão "competindo". Esses algoritmos variam dos mais simples (taxa média ou mediana no último bloco) aos mais sofisticados (análise estatística). Eles estimam a taxa necessária (em satoshis por byte) que dará a uma transação uma alta probabilidade de ser selecionada e incluída em um determinado número de blocos. A maioria dos serviços oferece aos usuários a opção de escolher taxas de prioridade alta, média ou baixa. Alta prioridade significa que os usuários pagam taxas mais altas, mas a transação provavelmente será incluída no próximo bloco. Prioridades média e baixa significam que os usuários pagam taxas de transação mais baixas, mas a confirmação das transações pode demorar muito mais.</p>
</div>
<div class="paragraph data-line-1629">
<p>Muitos aplicativos de carteira usam serviços de terceiros para cálculos de taxas. Um serviço popular é o <a href="https://bitcoinfees.earn.com/" data-href="https://bitcoinfees.earn.com/"><em>https://bitcoinfees.earn.com/</em></a>, que fornece uma API e um gráfico mostrando a taxa em satoshis/byte para diferentes prioridades.</p>
</div>
<div class="admonitionblock tip data-line-1632">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1633">
<p>Static fees are no longer viable on the Bitcoin network. Wallets that set static fees will produce a poor user experience as transactions will often get "stuck" and remain unconfirmed. Users who don&#8217;t understand bitcoin transactions and fees are dismayed by "stuck" transactions because they think they&#8217;ve lost their money.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1636">
<p>O gráfico na <a href="#bitcoinfeesearncom">Serviço de estimativa de taxa bitcoinfees.earn.com</a> mostra a estimativa em tempo real das taxas em incrementos de 10 satoshis/byte e o tempo de confirmação esperado (em minutos e número de blocos) para transações com taxas em cada faixa. Para cada faixa de taxa (por exemplo, 61&#x2013;70 satoshis/byte), duas barras horizontais mostram o número de transações não confirmadas (1.405) e o número total de transações com taxas nessa faixa nas últimas 24 horas (102.975). Com base no gráfico, a taxa de alta prioridade recomendada naquele momento era de 80 satoshis/byte, uma taxa que provavelmente faria com que a transação fosse minerada no bloco seguinte (com atraso de bloco zero). Para se ter uma idéia, o tamanho mediano de uma transação é de 226 bytes, então a taxa recomendada para esse tamanho de transação seria 18.080 satoshis (0,00018080 BTC).</p>
</div>
<div class="paragraph data-line-1638">
<p>Os dados de estimativa de taxa podem ser recuperados por meio de uma API HTTP REST simples, em <a href="https://bitcoinfees.earn.com/api/v1/fees/recommended" data-href="https://bitcoinfees.earn.com/api/v1/fees/recommended">https://bitcoinfees.earn.com/api/v1/fees/recommended</a>. Por exemplo, usando-se o comando curl na linha de comando:</p>
</div>
<div class="listingblock data-line-1641">
<div class="title">Usando a API de estimativa de taxa</div>
<div class="content">
<pre>$ curl https://bitcoinfees.earn.com/api/v1/fees/recommended

{"fastestFee":80,"halfHourFee":80,"hourFee":60}</pre>
</div>
</div>
<div class="paragraph data-line-1647">
<p>A API retorna um objeto JSON com a estimativa de taxa atual para a confirmação mais rápida (fastFee), para uma confirmação dentro de três blocos (halfHourFee) e para uma confirmação dentro de seis blocos (hourFee), em satoshis por byte.</p>
</div>
<div id="bitcoinfeesearncom" class="imageblock data-line-1651">
<div class="content">
<img src="images/mbc2_0602.png" alt="Fee Estimation Service bitcoinfees.earn.com">
</div>
<div class="title">Figure 37. Serviço de estimativa de taxa bitcoinfees.earn.com</div>
</div>
<div class="paragraph data-line-1653">
<p>==== Adicionando Taxas às Transações</p>
</div>
<div class="paragraph data-line-1655">
<p>A estrutura de dados das transações não tem um campo para as taxas. Em vez disso, infere-se que as taxas são a diferença entre a soma das entradas e a soma das saídas. Qualquer valor em excesso que permanece após todas as saídas terem sido deduzidas de todas as entradas é a taxa que é coletada pelos mineradores.</p>
</div>
<div id="tx_fee_equation" class="listingblock data-line-1659">
<div class="title">As taxas de transação são implicitamente consideradas como o resto da subtração das entradas pela saídas:</div>
<div class="content">
<pre>Taxas = Soma(Entradas) – Soma(Saídas)</pre>
</div>
</div>
<div class="paragraph data-line-1663">
<p>Isso é um elemento relativamente confuso das transações, e é um ponto importante para se compreender, pois se você está construindo as suas próprias transações, você deve se certificar de que você não incluiu uma taxa muito grande ao subutilizar as entradas. Isso significa que você deve contabilizar todas as entradas, e, se necessário, criar troco, caso contrário, você acabará dando uma gorjeta grande demais para os mineradores!</p>
</div>
<div class="paragraph data-line-1665">
<p>Por exemplo, se você consumir uma UTXO de 20 bitcoins para fazer um pagamento de 1 bitcoin, você precisa incluir uma saída de troco de 19 bitcoins de volta para a sua carteira. Caso contrário, os 19 bitcoins que sobrarem serão contados como uma taxa de transação e serão coletados pelo minerador que minerar a sua transação em um bloco. A sua transação vai receber alta prioridade e o minerador vai ficar muito feliz, mas provavelmente não era isso que você queria fazer.</p>
</div>
<div class="admonitionblock warning data-line-1668">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-1669">
<p>Se você se esquecer de adicionar uma saída de troco em uma transação construída manualmente, o seu troco será usado para pagar a taxa da transação. Provavelmente a sua real intenção não era dizer ao minerador "Pode ficar com troco!"</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1672">
<p>Vamos ver como isso funciona na prática, ao analisar novamente a compra da xícara de café da Alice. A Alice quer gastar 0,015 BTC para pagar pelo café. Para ter a certeza de que essa transação será processada prontamente, ela terá que incluir uma taxa de transação, que digamos que seja de 0,0005 BTC. Isso significa que o custo total da transação será de 0,0155 BTC. A carteira dela, portanto, precisará usar um conjunto de UTXOs cuja soma resulte em 0,0155 BTC ou mais e, se necessário, terá que criar o troco. Digamos que a carteira dela tem uma UTXO de 0,1 BTC disponível. Portanto ela precisará consumir essa UTXO, criando uma saída de 0,015 BTC para a Cafeteria do Bob e uma segunda saída de 0,0845 BTC de troco de volta para a própria carteira dela, deixando 0,0005 BTC não alocado, que é uma taxa implícita pela transação.</p>
</div>
<div class="paragraph data-line-1674">
<p>Agora vamos ver um cenário diferente. A Eugênia, nossa diretora da instituição de caridade para crianças nas Filipinas, completou uma campanha para arrecadação de fundos para comprar livros escolares para as crianças. Ela recebeu milhares de pequenas doações de pessoas de todos os lugares do mundo, totalizando 50 bitcoins, então sua carteira está cheia de pagamentos muito pequenos (UTXOs). Agora ela que comprar centenas de livros escolares da editora local, pagando em bitcoin.</p>
</div>
<div class="paragraph data-line-1676">
<p>Ao tentar construir uma única transação de pagamento com uma quantia maior, o aplicativo de carteira da Eugênia deve utilizar o conjunto UTXO disponível, que é composto por várias quantias menores. Isso significa que a transação resultante utilizará mais de uma centena de UTXOs de pequeno valor como entradas, e terá apenas uma única saída, que será o pagamento à editora do livro. Uma transação com tantas entradas terá mais do que um kilobyte, talvez vários kilobytes. Como resultado, ela exigirá uma taxa muito maior do que a transação de tamanho mediano.</p>
</div>
<div class="paragraph data-line-1678">
<p>O aplicativo de carteira da Eugênia calculará a taxa apropriada ao medir o tamanho da transação e multiplicá-lo pela taxa por kilobyte. Muitas carteiras pagarão taxas extras para transações de maior tamanho, a fim de garantir que a transação seja processada prontamente. A taxa não é maior pelo fato de a Eugênia estar gastando mais dinheiro, mas pelo fato de a transação dela ser mais complexa e ter um tamanho maior—a taxa é independente do valor da transação em bitcoins.</p>
</div>
<div id="tx_script" class="paragraph pagebreak-before less_space_h1 data-line-1682">
<p>=== Scripts de Transação e Linguagem de Script</p>
</div>
<div class="paragraph data-line-1684">
<p>A linguagem de script da transação do bitcoin, chamada <em>Script</em>, é uma linguagem de execução baseada em pilha de notação polonesa reversa, semelhante à linguagem Forth. Se isso soa como um jargão, você provavelmente não estudou as linguagens de programação dos anos 1960, mas tudo bem&#x2014;explicaremos tudo o que você precisa saber neste capítulo. Tanto o script de travamento colocado em uma UTXO quanto o script de destravamento são escritos nesta linguagem de script. Quando uma transação é validada, o script de destravamento em cada entrada é executado junto com o script de travamento correspondente para ver se ele satisfaz a condição de gasto.</p>
</div>
<div class="paragraph data-line-1686">
<p>A Script é uma linguagem muito simples que foi projetada para ser limitada em escopo e executável em uma variedade de hardwares, talvez tão simples quanto um dispositivo embutido. Ela requer processamento mínimo e não consegue fazer muitas das coisas extravagantes que as linguagens de programação modernas conseguem fazer. Para seu uso na validação de dinheiro programável, este é um recurso de segurança deliberado.</p>
</div>
<div class="paragraph data-line-1688">
<p>Today, most transactions processed through the Bitcoin network have the form "Payment to Bob&#8217;s Bitcoin address" and are based on a script called a Pay-to-Public-Key-Hash script.  However, bitcoin transactions are not limited to the "Payment to Bob&#8217;s Bitcoin address" script. In fact, locking scripts can be written to express a vast variety of complex conditions. In order to understand these more complex scripts, we must first understand the basics of transaction scripts and script language.</p>
</div>
<div class="paragraph data-line-1690">
<p>Nesta seção, demonstraremos os componentes básicos da linguagem de script da transação de bitcoin e mostraremos como ela pode ser usada para expressar condições simples para que o dinheiro seja gasto e como essas condições podem ser satisfeitas através de scripts de destravamento.</p>
</div>
<div class="admonitionblock tip data-line-1693">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1694">
<p>A validação da transação de bitcoin não é baseada em um padrão estático, em vez disso, ela é obtida através da execução de uma linguagem de script. Essa linguagem permite que uma variedade quase infinita de condições seja expressa. É dessa maneira que o bitcoin recebe o poder de ser um "dinheiro programável".</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1698">
<p>==== Incompletude de Turing</p>
</div>
<div class="paragraph data-line-1700">
<p>The bitcoin transaction script language contains many operators, but is deliberately limited in one important way&#8212;&#8203;there are no loops or complex flow control capabilities other than conditional flow control. This ensures that the language is not <em>Turing Complete</em>, meaning that scripts have limited complexity and predictable execution times. Script is not a general-purpose language. These limitations ensure that the language cannot be used to create an infinite loop or other form of "logic bomb" that could be embedded in a transaction in a way that causes a denial-of-service attack against the Bitcoin network. Remember, every transaction is validated by every full node on the Bitcoin network. A limited language prevents the transaction validation mechanism from being used as a vulnerability.</p>
</div>
<div class="paragraph data-line-1702">
<p>==== Verificação sem Estado</p>
</div>
<div class="paragraph data-line-1704">
<p>The bitcoin transaction script language is stateless, in that there is no state prior to execution of the script, or state saved after execution of the script. Therefore, all the information needed to execute a script is contained within the script. A script will predictably execute the same way on any system. If your system verifies a script, you can be sure that every other system in the Bitcoin network will also verify the script, meaning that a valid transaction is valid for everyone and everyone knows this. This predictability of outcomes is an essential benefit of the Bitcoin system.</p>
</div>
<div id="tx_lock_unlock" class="paragraph data-line-1707">
<p>==== Construção do Script (Travamento + Destravamento)</p>
</div>
<div class="paragraph data-line-1709">
<p>O mecanismo de validação de transações do bitcoin conta com dois tipos de scripts para validar transações: um script de travamento e um script de destravamento.</p>
</div>
<div class="paragraph data-line-1711">
<p>A locking script is a spending condition placed on an output: it specifies the conditions that must be met to spend the output in the future. Historically, the locking script was called a <em>scriptPubKey</em>, because it usually contained a public key or Bitcoin address (public key hash). In this book we refer to it as a "locking script" to acknowledge the much broader range of possibilities of this scripting technology. In most bitcoin applications, what we refer to as a locking script will appear in the source code as scriptPubKey. You will also see the locking script referred to as a <em>witness script</em> (see <a href="#segwit">[segwit]</a>) or more generally as a <em>cryptographic puzzle</em>. These terms all mean the same thing, at different levels of abstraction.</p>
</div>
<div class="paragraph data-line-1713">
<p>Um script de destravamento é um script que "resolve", ou satisfaz, as condições que foram colocadas em uma saída por um script de travamento, permitindo que a saída seja gasta. Os scripts de destravamento fazem parte de todas as entradas de transação. Na maioria das vezes, eles contêm uma assinatura digital produzida pela carteira do usuário a partir de sua chave privada. Historicamente, o script de destravamento era chamado de <em>scriptSig</em>, porque ele geralmente continha uma assinatura digital. Na maioria das aplicações de bitcoin, o código-fonte refere-se ao script de destravamento como scriptSig. Você também verá o script de destravamento sendo referido como uma <em>testemunha</em> (em inglês, <em>witness</em>) (ver <a href="#segwit">[segwit]</a>). Neste livro, nos referimos a ele como um "script de destravamento", para reconhecer a gama muito maior de exigências dos scripts de travamento, pois nem todos os scripts de destravamento precisam conter assinaturas.</p>
</div>
<div class="paragraph data-line-1715">
<p>Cada nó validador do bitcoin validará transações ao executar os scripts de travamento e destravamento juntos. Cada entrada contém um script de destravamento e refere-se a uma UTXO previamente existente. O software de validação copiará o script de destravamento, recuperará a UTXO referenciada pela entrada e copiará o script de travamento dessa UTXO. A seguir, os scripts de destravamento e travamento são executados em sequência. A entrada é considerada válida se o script de destravamento satisfizer as condições do script de travamento (ver <a href="#script_exec">[script_exec]</a>). Todas as entradas são validadas de forma independente, como parte da validação geral da transação.</p>
</div>
<div class="paragraph data-line-1717">
<p>Como a UTXO é armazenada permanentemente na blockchain, ela é invariável, não sendo afetada por tentativas fracassadas de gastá-la através de uma referência em uma nova transação. Somente uma transação válida, que satisfaça corretamente as condições da saída, fará com que uma saída seja considerada "gasta" e seja removida do conjunto de saídas de transação não gastas (conjunto UTXO).</p>
</div>
<div class="paragraph data-line-1719">
<p>A <a href="#scriptSig_and_scriptPubKey">Combinando o scriptSig e o scriptPubKey para avaliar um script de transação</a> é um exemplo de scripts de destravamento e travamento para o tipo mais comum de transação de bitcoin (um pagamento para um hash de endereço público), demonstrando o script combinado resultante da concatenação dos scripts de destravamento e travamento antes da validação do script.</p>
</div>
<div id="scriptSig_and_scriptPubKey" class="imageblock data-line-1723">
<div class="content">
<img src="images/mbc2_0603.png" alt="scriptSig_and_scriptPubKey">
</div>
<div class="title">Figure 38. Combinando o scriptSig e o scriptPubKey para avaliar um script de transação</div>
</div>
<div class="paragraph data-line-1725">
<p>===== O stack de execução do script</p>
</div>
<div class="paragraph data-line-1727">
<p>A linguagem de script do bitcoin é considerada uma linguagem baseada em stack, pois ela usa uma estrutura de dados chamada de <em>stack</em> (em português, <em>pilha</em>). Um stack é uma estrutura de dados muito simples, que pode ser imaginada como uma pilha de cartas de baralho. Um stack permite duas operações: adicionar ("push") e remover ("pop"). "Adicionar" ("push") adiciona um item no topo da pilha. "Remover" ("pop") retira o item que está no topo da pilha. As operações em uma pilha só podem agir no item que está no topo da pilha. Uma estrutura de dados em pilha também é chamada de Last-In-First-Out (o último a entrar é o primeiro a sair) ou fila "LIFO".</p>
</div>
<div class="paragraph data-line-1729">
<p>A linguagem de script executa o script ao processar cada item da esquerda para a direita. Os números (constantes de dados) são adicionados no stack. Os operadores adicionam (push) ou removem (pop) um ou mais parâmetros do stack, atuam neles e podem adicionar um resultado no stack. Por exemplo, o operador OP_ADD irá remover dois itens do stack, somá-los e adicionar o resultado da soma no stack.</p>
</div>
<div class="paragraph data-line-1731">
<p>Os operadores condicionais avaliam uma condição, produzindo um resultado booleano TRUE (VERDADEIRO) ou FALSE (FALSO). Por exemplo, OP_EQUAL remove (pop) dois itens do stack e adiciona TRUE (TRUE representado pelo número 1) se eles forem iguais ou FALSE (representado por zero) se eles não forem iguais. Os scripts de transação do bitcoin geralmente contêm um operador condicional, de maneira que eles possam produzir o resultado TRUE que significa uma transação válida.</p>
</div>
<div class="paragraph data-line-1733">
<p>===== Um script simples</p>
</div>
<div class="paragraph data-line-1735">
<p>Agora vamos aplicar o que aprendemos sobre scripts e stacks a alguns exemplos simples.</p>
</div>
<div class="paragraph data-line-1737">
<p>Na <a href="#simplemath_script">Script de validação do bitcoin fazendo uma conta matemática simples</a>, o script 2 3 OP_ADD 5 OP_EQUAL demonstra o operador de adição aritmética OP_ADD somando dois números e colocando o resultado no stack, seguido pelo operador condicional OP_EQUAL, que verifica se a soma resultante é igual a 5. Para simplificar, o prefixo OP_ é omitido no exemplo passo-a-passo. Para obter mais detalhes sobre os operadores de script e as funções disponíveis, consulte o <a href="#tx_script_ops">[tx_script_ops]</a>.</p>
</div>
<div class="paragraph data-line-1739">
<p>Although most locking scripts refer to a public key hash (essentially, a Bitcoin address), thereby requiring proof of ownership to spend the funds, the script does not have to be that complex. Any combination of locking and unlocking scripts that results in a TRUE value is valid. The simple arithmetic we used as an example of the scripting language is also a valid locking script that can be used to lock a transaction output.</p>
</div>
<div class="paragraph data-line-1741">
<p>Use parte do script de exemplo aritmético como sendo o script de travamento:</p>
</div>
<div class="listingblock data-line-1743">
<div class="content">
<pre>3 OP_ADD 5 OP_EQUAL</pre>
</div>
</div>
<div class="paragraph data-line-1747">
<p>que pode ser satisfeito através de uma transação contendo uma entrada com o script de destravamento:</p>
</div>
<div class="listingblock data-line-1749">
<div class="content">
<pre>2</pre>
</div>
</div>
<div class="paragraph data-line-1753">
<p>O software de validação combina os scripts de travamento e de destravamento e o script resultante é:</p>
</div>
<div class="listingblock data-line-1755">
<div class="content">
<pre>2 3 OP_ADD 5 OP_EQUAL</pre>
</div>
</div>
<div class="paragraph data-line-1759">
<p>Conforme vimos no exemplo passo-a-passo da <a href="#simplemath_script">Script de validação do bitcoin fazendo uma conta matemática simples</a>, quando o script é executado, o resultado é OP_TRUE, tornando a transação válida. Não apenas esse é um script de travamento válido, como também a UTXO resultante poderia ser gasta por qualquer pessoa que tivesse as habilidades aritméticas para saber que o número 2 satisfaz o script.</p>
</div>
<div class="admonitionblock tip data-line-1762">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1763">
<p>As transações são válidas se o resultado no topo do stack for TRUE (definido como &amp;#x7b;0x01&amp;#x7d;), qualquer valor diferente de zero, não OP_0, ou se o stack estiver vazio após a execução do script. As transações são inválidas se o valor do topo do stack for FALSE (um valor vazio de comprimento zero, definido como &amp;#x7b;&amp;#x7d;) ou se a execução do script for suspensa por um operador, como o OP_VERIFY, o OP_RETURN ou um terminador condicional como o OP_ENDIF. Veja o <a href="#tx_script_ops">[tx_script_ops]</a> para mais detalhes.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="simplemath_script" class="imageblock data-line-1768">
<div class="content">
<img src="images/mbc2_0604.png" alt="TxScriptSimpleMathExample">
</div>
<div class="title">Figure 39. Script de validação do bitcoin fazendo uma conta matemática simples</div>
</div>
<div class="paragraph pagebreak-before data-line-1771">
<p>O script a seguir é um pouco mais complexo, que calcula 2 + 7 - 3 + 1. Note que quando o script contém vários operadores em uma linha, o stack permite que os resultados de um operador sejam usados pelo próximo operador:</p>
</div>
<div class="listingblock data-line-1773">
<div class="content">
<pre>2 7 OP_ADD 3 OP_SUB 1 OP_ADD 7 OP_EQUAL</pre>
</div>
</div>
<div class="paragraph data-line-1777">
<p>Tente você mesmo validar o script anterior usando papel e caneta. Quando a execução do script terminar, você deve ficar com o valor TRUE no stack.</p>
</div>
<div id="script_exec" class="paragraph data-line-1780">
<p>===== Execução separada de scripts de destravamento e travamento</p>
</div>
<div class="paragraph data-line-1782">
<p>In the original Bitcoin client, the unlocking and locking scripts were concatenated and executed in sequence. For security reasons, this was changed in 2010, because of a vulnerability that allowed a malformed unlocking script to push data onto the stack and corrupt the locking script. In the current implementation, the scripts are executed separately with the stack transferred between the two executions, as described next.</p>
</div>
<div class="paragraph data-line-1784">
<p>Primeiro, o script de destravamento é executado, usando o mecanismo de execução do stack. Se o script de destravamento for executado sem erros (por exemplo, ele não possui ponteiros "pendentes" faltando), o stack principal é copiado e o script de travamento é executado. Se o resultado da execução do script de travamento com os dados do stack copiados a partir do script de destravamento for "TRUE", o script de destravamento teve sucesso em resolver as condições impostas pelo script de travamento e, portanto, a entrada é uma autorização válida para gastar a UTXO. Se qualquer resultado diferente de "TRUE" permanecer após a execução do script combinado, a entrada é inválida, pois ela não conseguiu satisfazer as condições de gasto impostas na UTXO.</p>
</div>
<div id="p2pkh" class="paragraph data-line-1788">
<p>==== Pay-to-Public-Key-Hash (P2PKH)</p>
</div>
<div class="paragraph data-line-1790">
<p>The vast majority of transactions processed on the Bitcoin network spend outputs locked with a Pay-to-Public-Key-Hash or "P2PKH" script. These outputs contain a locking script that locks the output to a public key hash, more commonly known as a Bitcoin address. An output locked by a P2PKH script can be unlocked (spent) by presenting a public key and a digital signature created by the corresponding private key (see <a href="#digital_sigs">[digital_sigs]</a>).</p>
</div>
<div class="paragraph data-line-1792">
<p>For example, let&#8217;s look at Alice&#8217;s payment to Bob&#8217;s Cafe again. Alice made a payment of 0.015 bitcoin to the cafe&#8217;s Bitcoin address. That transaction output would have a locking script of the form:</p>
</div>
<div class="listingblock data-line-1794">
<div class="content">
<pre>OP_DUP OP_HASH160 &lt;Hash da Chave Pública do Café&gt; OP_EQUALVERIFY OP_CHECKSIG</pre>
</div>
</div>
<div class="paragraph data-line-1798">
<p>The Cafe Public Key Hash is equivalent to the Bitcoin address of the cafe, without the Base58Check encoding. Most applications would show the <em>public key hash</em> in hexadecimal encoding and not the familiar Bitcoin address Base58Check format that begins with a "1."</p>
</div>
<div class="paragraph data-line-1800">
<p>O script de travamento anterior pode ser satisfeito com um script de destravamento com o seguinte formato:</p>
</div>
<div class="listingblock data-line-1802">
<div class="content">
<pre>&lt;Assinatura do Café&gt; &lt;Chave Pública do Café&gt;</pre>
</div>
</div>
<div class="paragraph data-line-1806">
<p>Os dois scripts juntos formariam o seguinte script de validação combinado:</p>
</div>
<div class="listingblock data-line-1808">
<div class="content">
<pre>&lt;Assinatura do Café&gt; &lt;Chave Pública do Café&gt; OP_DUP OP_HASH160
&lt;Hash da Chave Pública do Café&gt; OP_EQUALVERIFY OP_CHECKSIG</pre>
</div>
</div>
<div class="paragraph data-line-1813">
<p>Quando executado, esse script combinado resultará em TRUE se, e somente se, o script de destravamento preencher as condições definidas pelo script de travamento. Em outras palavras, o resultado será TRUE se o script de destravamento tiver uma assinatura válida da chave privada do café que corresponda ao hash de chave pública que foi definido como uma trava.</p>
</div>
<div class="paragraph data-line-1815">
<p>As Figuras <a data-type="xref" href="#P2PubKHash1" data-xrefstyle="select: labelnumber">#P2PubKHash1</a> e <a data-type="xref" href="#P2PubKHash2" data-xrefstyle="select: labelnumber">#P2PubKHash2</a> demonstram (em duas partes) uma execução passo-a-passo do script combinado, que provará que essa é uma transação válida.</p>
</div>
<div id="P2PubKHash1" class="imageblock data-line-1819">
<div class="content">
<img src="images/mbc2_0605.png" alt="Tx_Script_P2PubKeyHash_1">
</div>
<div class="title">Figure 40. Avaliando um script para uma transação P2PKH (parte 1 de 2)</div>
</div>
<div id="P2PubKHash2" class="imageblock data-line-1823">
<div class="content">
<img src="images/mbc2_0606.png" alt="Tx_Script_P2PubKeyHash_2">
</div>
<div class="title">Figure 41. Avaliando um script para uma transação P2PKH (parte 2 de 2)</div>
</div>
<div id="digital_sigs" class="paragraph data-line-1826">
<p>=== Assinaturas Digitais (ECDSA)</p>
</div>
<div class="paragraph data-line-1828">
<p>Até agora, não nos aprofundamos em detalhes sobre as "assinaturas digitais". Nesta seção, veremos como as assinaturas digitais funcionam e como elas podem apresentar uma prova de posse de uma chave privada sem revelar essa chave privada.</p>
</div>
<div class="paragraph data-line-1830">
<p>O algoritmo de assinatura digital usado no bitcoin é o <em>Algoritmo de Assinatura Digital de Curva Elíptica</em> (em inglês, <em>Elliptic Curve Digital Signature Algorithm</em> ou <em>ECDSA</em>). O ECDSA é o algoritmo usado para assinaturas digitais com base em pares de chaves privadas/públicas em curva elíptica, conforme descrito em <a href="#elliptic_curve">[elliptic_curve]</a>. O ECDSA é usado pelas funções de script OP_CHECKSIG, OP_CHECKSIGVERIFY, OP_CHECKMULTISIG e OP_CHECKMULTISIGVERIFY. Sempre que você encontrar essas funções em um script de travamento, o script de destravamento necessariamente precisa conter uma assinatura ECDSA.</p>
</div>
<div class="paragraph data-line-1832">
<p>Uma assinatura digital tem três finalidades no bitcoin. Primeiro, a assinatura prova que o proprietário da chave privada, que se subentende ser o proprietário dos fundos, <em>autorizou</em> o gasto desses fundos. Em segundo lugar, a prova de autorização é <em>inegável</em> (não repúdio). Em terceiro lugar, a assinatura prova que a transação (ou partes específicas da transação) não foi e <em>não pode ser modificada</em> por ninguém após ter sido assinada.</p>
</div>
<div class="paragraph data-line-1834">
<p>Observe que cada entrada de transação é assinada de forma independente. Isso é fundamental, pois nem as assinaturas nem as entradas precisam pertencer ou serem usadas pelos mesmos "donos". Um esquema específico de transação chamado "CoinJoin" usa esse fato para criar transações com entradas de diferentes usuários com o objetivo de se obter maior privacidade.</p>
</div>
<div class="admonitionblock note data-line-1837">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-1838">
<p>Cada entrada de transação e qualquer assinatura que ela possa conter é <em>completamente</em> independente de qualquer outra entrada ou assinatura. Vários usuários podem se unir para construir transações em que cada um assina apenas uma única entrada.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph data-line-541">
<p>Uma assinatura digital é um esquema matemático usado para demonstrar a autenticidade de uma mensagem ou documentos digitais. Uma assinatura digital válida dá ao destinatário motivos para acreditar que a mensagem foi criada por um remetente conhecido (autenticação), que o remetente não pode negar ter enviado da mensagem (não repúdio) e que a mensagem não foi alterada em trânsito (integridade).</p>
</div>
<div class="paragraph data-line-543">
<p><em>Fonte: <a href="https://en.wikipedia.org/wiki/Digital_signature" class="undefined" data-href="https://en.wikipedia.org/wiki/Digital_signature">https://en.wikipedia.org/wiki/Digital_signature</a></em></p>
</div>
<div class="sidebarblock data-line-544">
<div class="content">
<div class="paragraph data-line-546">
<p>==== Como Funcionam as Assinaturas Digitais</p>
</div>
<div class="paragraph data-line-548">
<p>Uma assinatura digital é um <em>esquema matemático</em> que consiste em duas partes. A primeira parte é um algoritmo usado para criar uma assinatura, usando uma chave privada (a chave de assinatura), a partir de uma mensagem (a transação). A segunda parte é um algoritmo que permite a qualquer pessoa verificar a assinatura, caso seja fornecida a mensagem e uma chave pública.</p>
</div>
<div class="paragraph data-line-550">
<p>===== Criando uma assinatura digital</p>
</div>
<div class="paragraph data-line-552">
<p>Na implementação do bitcoin do algoritmo ECDSA, a "mensagem" sendo assinada é a transação, ou, mais precisamente, um hash de um subconjunto específico dos dados incluídos na transação (ver <a href="#sighash_types">[sighash_types]</a>). A chave de assinatura é a chave privada do usuário. O resultado é a assinatura:</p>
</div>
<div class="paragraph data-line-554">
<p>\(\(Sig = F_{sig}(F_{hash}(m), dA)\)\)</p>
</div>
<div class="paragraph data-line-556">
<p>onde:</p>
</div>
<div class="ulist data-line-558">
<ul>
<li class="data-line-558">
<p><em>dA</em> é a chave privada que assina</p>
</li>
<li class="data-line-559">
<p><em>m</em> é a transação (ou partes dela)</p>
</li>
<li class="data-line-560">
<p><em>F</em><sub><em>hash</em></sub> é a função de hash</p>
</li>
<li class="data-line-561">
<p><em>F</em><sub><em>sig</em></sub> é o algoritmo de assinatura</p>
</li>
<li class="data-line-562">
<p><em>Sig</em> é a assinatura resultante</p>
</li>
</ul>
</div>
<div class="paragraph data-line-564">
<p>Mais detalhes sobre a matemática do Algoritmo de Assinatura Digital de Curva Elíptica (ECDSA) podem ser encontrados em <a href="#ecdsa_math">[ecdsa_math]</a>.</p>
</div>
<div class="paragraph data-line-566">
<p>A função <em>F</em><sub><em>sig</em></sub> produz uma assinatura Sig que é composta de dois valores, comumente referidos como R e S:</p>
</div>
<div class="listingblock data-line-568">
<div class="content">
<pre>Sig = (R, S)</pre>
</div>
</div>
<div class="paragraph data-line-572">
<p>Agora que os dois valores R e S foram calculados, eles são serializados em um fluxo de bytes usando um esquema de codificação padronizado internacional denominado <em>Regras de Codificação Distintas</em> (em inglês, <em>Distinguished Encoding Rules</em> ou <em>DER</em>).</p>
</div>
<div id="seralization_of_signatures_der" class="paragraph data-line-575">
<p>===== Serialização de assinaturas (DER)</p>
</div>
<div class="paragraph data-line-577">
<p>Vejamos novamente a transação que a Alice criou. Na entrada da transação, há um script de destravamento que contém a seguinte assinatura codificada em DER pela carteira da Alice:</p>
</div>
<div class="listingblock data-line-579">
<div class="content">
<pre>3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e381301</pre>
</div>
</div>
<div class="paragraph data-line-583">
<p>Essa assinatura é um stream de bytes serializado dos valores R e S produzidos pela carteira da Alice para provar que ela possui a chave privada autorizada a gastar aquela saída. O formato de serialização consiste em nove elementos, abaixo descritos:</p>
</div>
<div class="ulist data-line-585">
<ul>
<li class="data-line-585">
<p>0x30&#x2014;indicando o início de uma sequência DER</p>
</li>
<li class="data-line-586">
<p>0x45&#x2014;o comprimento da sequência (69 bytes)</p>
</li>
<li class="data-line-587">
<p>0x02&#x2014;segue-se um valor inteiro</p>
</li>
<li class="data-line-588">
<p>0x21&#x2014;o comprimento do número inteiro (33 bytes)</p>
</li>
<li class="data-line-589">
<p>R&#x2014;00884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb</p>
</li>
<li class="data-line-590">
<p>0x02&#x2014;segue-se um outro valor inteiro</p>
</li>
<li class="data-line-591">
<p>0x20&#x2014;o comprimento do número inteiro (32 bytes)</p>
</li>
<li class="data-line-592">
<p>S&#x2014;4b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813</p>
</li>
<li class="data-line-593">
<p>Um sufixo (0x01) indicando o tipo de hash utilizado (SIGHASH_ALL)</p>
</li>
</ul>
</div>
<div class="paragraph data-line-595">
<p>Veja se você consegue decodificar a assinatura serializada da Alice (codificada em DER) usando esta lista. Os números importantes são R e S; o restante dos dados faz parte do esquema de codificação DER.</p>
</div>
<div class="paragraph data-line-597">
<p>==== Verificando a Assinatura</p>
</div>
<div class="paragraph data-line-599">
<p>Para verificar a assinatura, deve-se ter a assinatura (R e S), a transação serializada e a chave pública (que corresponde à chave privada usada para criar a assinatura). Essencialmente, a verificação de uma assinatura significa "Apenas o proprietário da chave privada que gerou esta chave pública poderia ter produzido esta assinatura nesta transação".</p>
</div>
<div class="paragraph data-line-601">
<p>O algoritmo de verificação de assinatura pega a mensagem (um hash da transação ou partes dela), a chave pública do signatário e a assinatura (valores R e S) e retorna TRUE se a assinatura for válida para esta mensagem e esta chave pública.</p>
</div>
<div id="sighash_types" class="paragraph data-line-604">
<p>==== Tipos de Hash de Assinatura (SIGHASH)</p>
</div>
<div class="paragraph data-line-606">
<p>As assinaturas digitais são aplicadas às mensagens, que, no caso do bitcoin, são as próprias transações. A assinatura implica um <em>compromisso</em> (um comprometimento) por parte do signatário com dados de transação específicos. Na forma mais simples, a assinatura se aplica a toda a transação, comprometendo-se com todas as entradas, todas as saídas e todos os outros campos da transação. No entanto, uma assinatura pode comprometer-se com apenas um subconjunto dos dados em uma transação, o que é útil para vários cenários, como veremos nesta seção.</p>
</div>
<div class="paragraph data-line-608">
<p>Ao utilizar um sinalizador SIGHASH, as assinaturas do bitcoin têm uma maneira de indicar qual parte dos dados de uma transação está incluída no hash assinado pela chave privada. O sinalizador SIGHASH é um único byte que é anexado à assinatura. Cada assinatura tem um sinalizador SIGHASH e o sinalizador pode ser diferente de entrada para entrada. Uma transação com três entradas assinadas pode ter três assinaturas com diferentes sinalizadores SIGHASH, cada assinatura assinando (comprometendo-se com) diferentes partes da transação.</p>
</div>
<div class="paragraph data-line-610">
<p>Remember, each input may contain a signature in its unlocking script. As a result, a transaction that contains several inputs may have signatures with different SIGHASH flags that commit different parts of the transaction in each of the inputs. Note also that bitcoin transactions may contain inputs from different "owners," who may sign only one input in a partially constructed (and invalid) transaction, collaborating with others to gather all the necessary signatures to make a valid transaction. Many of the SIGHASH flag types only make sense if you think of multiple participants collaborating outside the Bitcoin network and updating a partially signed transaction.</p>
</div>
<div class="paragraph pagebreak-before data-line-613">
<p>Existem três sinalizadores SIGHASH: ALL, NONE e SINGLE, conforme mostrado na <a href="#sighash_types_and_their">Tipos de SIGHASH e seus significados</a>.</p>
</div>
<table id="sighash_types_and_their" class="tableblock frame-all grid-all stretch data-line-618">
<caption class="title">Table 19. Tipos de SIGHASH e seus significados</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sinalizador SIGHASH</th>
<th class="tableblock halign-left valign-top">Valor</th>
<th class="tableblock halign-left valign-top">Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A assinatura se aplica a todas as entradas e saídas</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NONE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A assinatura se aplica a todas as entradas e nenhuma das saídas</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SINGLE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A assinatura se aplica a todas as entradas, mas somente à saída com o mesmo número índice da entrada assinada</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-625">
<p>Além disso, há um sinalizador modificador SIGHASH_ANYONECANPAY, que pode ser combinado com cada um dos sinalizadores anteriores. Quando ANYONECANPAY é definido, apenas uma entrada é assinada, deixando o resto (e seus números de sequência) abertos para modificação. O ANYONECANPAY tem o valor 0x80 e é aplicado pelo operador bitwise OR, resultando nos sinalizadores combinados mostrados na <a href="#sighash_types_with_modifiers">Tipos de SIGHASH com modificadores e seus significados</a>.</p>
</div>
<table id="sighash_types_with_modifiers" class="tableblock frame-all grid-all stretch data-line-630">
<caption class="title">Table 20. Tipos de SIGHASH com modificadores e seus significados</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sinalizador SIGHASH</th>
<th class="tableblock halign-left valign-top">Valor</th>
<th class="tableblock halign-left valign-top">Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL|ANYONECANPAY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x81</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A assinatura se aplica a uma entrada e todas as saídas</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NONE|ANYONECANPAY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x82</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A assinatura se aplica a uma entrada e nenhuma das saídas</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SINGLE|ANYONECANPAY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x83</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A assinatura se aplica a uma entrada e à saída com o mesmo número índice</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-637">
<p>Essas combinações de sinalizadores estão resumidas na <a href="#sighash_combinations">Resumo das diferentes combinações de sighash</a>.</p>
</div>
<div id="sighash_combinations" class="imageblock data-line-641">
<div class="content">
<img src="images/sighash_combinations.png" alt="Summary of different SIGHASH flag combinations">
</div>
<div class="title">Figure 42. Resumo das diferentes combinações de sighash</div>
</div>
<div class="paragraph data-line-643">
<p>Os sinalizadores SIGHASH são aplicados durante a assinatura e a verificação de uma maneira que uma cópia da transação é feita e certos campos dentro dela são truncados (são definidos para comprimento zero e esvaziados). A transação resultante é serializada. O sinalizador SIGHASH é adicionado ao final da transação serializada e o resultado é transformado em um hash. O próprio hash é a "mensagem" que é assinada. Dependendo de qual sinalizador SIGHASH for usado, diferentes partes da transação são truncadas. O hash resultante depende de diferentes subconjuntos dos dados na transação. Ao incluir o SIGHASH na última etapa antes de transformar em hash, a assinatura também compromete-se com o tipo do SIGHASH, de maneira que ele não possa ser alterado no futuro (por exemplo, por um minerador).</p>
</div>
<div class="admonitionblock note data-line-646">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-647">
<p>Todos os tipos de SIGHASH assinam o campo nLocktime da transação (ver <a href="#transaction_locktime_nlocktime">[transaction_locktime_nlocktime]</a>). Além disso, o próprio tipo do SIGHASH é anexado à transação antes de ela ser assinada, de modo que ele não possa ser modificado depois de a transação ser assinada.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-650">
<p>No exemplo da transação da Alice (ver a lista em <a href="#seralization_of_signatures_der">[seralization_of_signatures_der]</a>), vimos que a última parte da assinatura codificada em DER era 01, que é o sinalizador SIGHASH_ALL. Isso trava os dados da transação, portanto a assinatura da Alice está comprometendo-se com o estado de todas as entradas e saídas. Esta é a forma de assinatura mais comum.</p>
</div>
<div class="paragraph data-line-652">
<p>Vejamos alguns dos outros tipos de SIGHASH e como eles podem ser usados na prática:</p>
</div>
<div class="dlist data-line-654">
<dl>
<dt class="hdlist1">ALL|ANYONECANPAY </dt>
<dd>
<p>Esta construção pode ser usada para fazer uma transação de "financiamento coletivo". Alguém tentando arrecadar fundos pode construir uma transação com uma única saída. A saída única da transação paga o valor da "meta" para a pessoa que está arrecadando os fundos. Essa transação obviamente não é válida, pois ela não tem entradas. No entanto, outras pessoas agora podem alterá-la adicionando suas próprias entradas, como uma doação. Elas assinam suas próprias entradas com ALL|ANYONECANPAY. A menos que entradas suficientes sejam coletadas para atingir o valor da saída, a transação é inválida. Cada doação serve como uma garantia de pagamento, que não pode ser coletada pela pessoa que está arrecadando os fundos até que todo o valor da meta tenha sido arrecadado.</p>
</dd>
<dt class="hdlist1">NONE </dt>
<dd>
<p>This construction can be used to create a "bearer check" or "blank check" of a specific amount. It commits to the input, but allows the output locking script to be changed. Anyone can write their own Bitcoin address into the output locking script and redeem the transaction. However, the output value itself is locked by the signature.</p>
</dd>
<dt class="hdlist1">NONE|ANYONECANPAY </dt>
<dd>
<p>Esta construção pode ser usada para construir um "coletor de pó". Os usuários que têm UTXOs minúsculas em suas carteiras não conseguem gastá-las, pois o custo em taxas é maior do que o valor dessas UTXOs pó. Com este tipo de assinatura, pode-se doar as UTXOs pó para qualquer pessoa agregá-las e gastá-las quando quiser.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-660">
<p>Existem algumas propostas para modificar ou expandir o sistema SIGHASH. Uma dessas propostas é a <em>Bitmask Sighash Modes</em> feita por Glenn Willen da Blockstream, como parte do projeto Elements. O objetivo é criar uma substituição flexível para os tipos de SIGHASH que permite a criação de "bitmasks de entradas e saídas que sejam arbitrários e regraváveis pelos mineradores" e que possam expressar "esquemas de pré-compromisso contratual mais complexos, como ofertas assinadas com troco em uma troca de ativos distribuída".</p>
</div>
<div class="admonitionblock note data-line-663">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-664">
<p>Você não verá os sinalizadores SIGHASH apresentados como uma opção no aplicativo de carteira do usuário. Com poucas exceções, as carteiras geralmente constroem scripts P2PKH e assinam com sinalizadores SIGHASH_ALL. Para usar um sinalizador SIGHASH diferente, você teria que escrever um software para construir e assinar transações. Ou seja, os sinalizadores SIGHASH geralmente são usados por aplicativos de bitcoin de propósito especial que permitem novos usos.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="ecdsa_math" class="paragraph data-line-668">
<p>==== Matemática do ECDSA</p>
</div>
<div class="paragraph data-line-670">
<p>Conforme mencionado anteriormente, as assinaturas são criadas por uma função matemática <em>F</em><sub><em>sig</em></sub> que produz uma assinatura composta de dois valores, o valor <em>R</em> e o valor <em>S</em>. Nesta seção, veremos a função <em>F</em><sub><em>sig</em></sub> em maiores detalhes.</p>
</div>
<div class="paragraph data-line-672">
<p>O algoritmo de assinatura primeiro gera um par de chaves públicas privadas <em>efêmeras</em> (temporárias). Este par de chaves temporárias é usado no cálculo dos valores <em>R</em> e <em>S</em>, após uma transformação envolvendo a chave privada de assinatura e o hash da transação.</p>
</div>
<div class="paragraph data-line-674">
<p>O par de chaves temporárias é baseado em um número aleatório <em>k</em>, que é usado como a chave privada temporária. A partir do <em>k</em>, geramos a chave pública temporária correspondente <em>P</em> (calculada como <em>P = k*G</em>, da mesma forma que as chaves públicas do bitcoin são derivadas; ver <a href="#pubkey">[pubkey]</a>). O valor <em>R</em> da assinatura digital é então a coordenada x da chave pública efêmera <em>P</em>.</p>
</div>
<div class="paragraph data-line-676">
<p>A partir daí, o algoritmo calcula o valor <em>S</em> da assinatura, de modo que:</p>
</div>
<div class="paragraph data-line-678">
<p><em>S</em> = <em>k</em><sup>-1</sup> (<em>Hash</em>(<em>m</em>) + <em>dA</em> * <em>R</em>) <em>mod n</em></p>
</div>
<div class="paragraph data-line-680">
<p>onde:</p>
</div>
<div class="ulist data-line-682">
<ul>
<li class="data-line-682">
<p><em>k</em> é a chave privada efêmera</p>
</li>
<li class="data-line-683">
<p><em>R</em> é a coordenada x da chave pública efêmera</p>
</li>
<li class="data-line-684">
<p><em>dA</em> é a chave privada que assina</p>
</li>
<li class="data-line-685">
<p><em>m</em> são os dados da transação</p>
</li>
<li class="data-line-686">
<p><em>n</em> é a ordem prima da curva elíptica</p>
</li>
</ul>
</div>
<div class="paragraph data-line-688">
<p>A verificação é o inverso da função de geração de assinatura, usando os valores <em>R</em>, <em>S</em> e a chave pública para calcular um valor <em>P</em>, que é um ponto na curva elíptica (a chave pública efêmera usada na criação da assinatura):</p>
</div>
<div class="paragraph data-line-690">
<p><em>P</em> = <em>S</em><sup>-1</sup> * <em>Hash</em>(<em>m</em>) * <em>G</em> + <em>S</em><sup>-1</sup> * <em>R</em> * <em>Qa</em></p>
</div>
<div class="paragraph data-line-692">
<p>onde:</p>
</div>
<div class="ulist data-line-694">
<ul>
<li class="data-line-694">
<p><em>R</em> e <em>S</em> são os valores da assinatura</p>
</li>
<li class="data-line-695">
<p><em>Qa</em> é a chave pública da Alice</p>
</li>
<li class="data-line-696">
<p><em>m</em> são os dados da transação que foram assinados</p>
</li>
<li class="data-line-697">
<p><em>G</em> é o ponto gerador da curva elíptica</p>
</li>
</ul>
</div>
<div class="paragraph data-line-699">
<p>Se a coordenada x do ponto calculado <em>P</em> for igual a <em>R</em>, então o verificador pode concluir que a assinatura é válida.</p>
</div>
<div class="paragraph data-line-701">
<p>Observe que, ao verificar a assinatura, a chave privada não é conhecida nem revelada.</p>
</div>
<div class="admonitionblock tip data-line-704">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-705">
<p>ECDSA é necessariamente uma peça matemática bastante complicada; uma explicação completa vai além do escopo deste livro. Existe uma série de ótimos guias na internet que podem o conduzir no passo a passo: pesquise por "ECDSA explicado" ou acesse este link: <a href="https://bit.ly/2r0HhGB" class="undefined" data-href="https://bit.ly/2r0HhGB">https://bit.ly/2r0HhGB</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-708">
<p>==== A Importância da Aleatoriedade nas Assinaturas</p>
</div>
<div class="paragraph data-line-710">
<p>Conforme vimos em <a href="#ecdsa_math">[ecdsa_math]</a>, o algoritmo de geração de assinatura usa uma chave aleatória <em>k</em>, que serve como a base para a geração de um par de chaves pública/privada efêmeras. O valor de <em>k</em> não é importante, <em>contanto que seja aleatório</em>. Se o mesmo valor <em>k</em> for usado para produzir duas assinaturas em diferentes mensagens (transações), a <em>chave privada</em> de assinatura poderá ser calculada por qualquer pessoa. Ou seja, a reutilização de um mesmo valor para <em>k</em> em um algoritmo de assinatura leva à exposição da chave privada!</p>
</div>
<div class="admonitionblock warning data-line-713">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-714">
<p>Se o mesmo valor <em>k</em> for usado no algoritmo de assinatura em duas transações diferentes, a chave privada poderá ser calculada e ser exposta por qualquer pessoa!</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-717">
<p>Esta não é apenas uma possibilidade teórica. Vimos esse problema levar à exposição de chaves privadas em algumas implementações diferentes de algoritmos de assinatura de transação no bitcoin. Algumas pessoas tiveram fundos roubados devido à reutilização inadvertida de um valor <em>k</em>. O motivo mais comum para a reutilização de um valor <em>k</em> é um gerador de número aleatório inicializado incorretamente.</p>
</div>
<div class="paragraph data-line-719">
<p>Para evitar essa vulnerabilidade, a prática recomendada pela indústria é não gerar <em>k</em> com um gerador de número aleatório semeado com entropia, mas, em vez disso, usar um processo determinístico-aleatório semeado com os dados da próprio transação. Isso garante que cada transação produza um <em>k</em> diferente. O algoritmo padrão da indústria para inicialização determinística de <em>k</em> é definido em <a href="https://tools.ietf.org/html/rfc6979" data-href="https://tools.ietf.org/html/rfc6979">RFC 6979</a>, publicado pela <em>Internet Engineering Task Force</em>.</p>
</div>
<div class="paragraph data-line-721">
<p>Se você estiver implementando um algoritmo para assinar transações no bitcoin, você <em>deve</em> usar o RFC 6979 ou um algoritmo determinístico-aleatório semelhante para garantir a geração de um <em>k</em> diferente para cada transação.</p>
</div>
<div class="paragraph data-line-723">
<p>=== Endereços, Saldos e Outras Abstrações do Bitcoin</p>
</div>
<div class="paragraph data-line-725">
<p>We began this chapter with the discovery that transactions look very different "behind the scenes" than how they are presented in wallets, blockchain explorers, and other user-facing applications. Many of the simplistic and familiar concepts from the earlier chapters, such as Bitcoin addresses and balances, seem to be absent from the transaction structure. We saw that transactions don&#8217;t contain Bitcoin addresses, per se, but instead operate through scripts that lock and unlock discrete values of bitcoin. Balances are not present anywhere in this system and yet every wallet application prominently displays the balance of the user&#8217;s wallet.</p>
</div>
<div class="paragraph data-line-727">
<p>Agora que exploramos o que realmente está incluído em uma transação de bitcoin, podemos examinar como as abstrações de nível superior são derivadas dos componentes aparentemente primitivos da transação.</p>
</div>
<div class="paragraph data-line-729">
<p>Vejamos novamente como a transação da Alice foi apresentada em um explorador de blocos popular (<a href="#alice_transaction_to_bobs_cafe">Transação da Alice para a Cafeteria do Bob</a>).</p>
</div>
<div id="alice_transaction_to_bobs_cafe" class="imageblock data-line-733">
<div class="content">
<img src="images/mbc2_0208.png" alt="Alice Coffee Transaction">
</div>
<div class="title">Figure 43. Transação da Alice para a Cafeteria do Bob</div>
</div>
<div class="paragraph data-line-735">
<p>On the left side of the transaction, the blockchain explorer shows Alice&#8217;s Bitcoin address as the "sender." In fact, this information is not in the transaction itself. When the blockchain explorer references the transaction it also references the previous transaction associated with the input and extracts the first output from that older transaction. Within that output is a locking script that locks the UTXO to Alice&#8217;s public key hash (a P2PKH script). The blockchain explorer extracted the public key hash and encoded it using Base58Check encoding to produce and display the Bitcoin address that represents that public key.</p>
</div>
<div class="paragraph data-line-737">
<p>Similarly, on the right side, the blockchain explorer shows the two outputs; the first to Bob&#8217;s Bitcoin address and the second to Alice&#8217;s Bitcoin address (as change). Once again, to create these Bitcoin addresses, the blockchain explorer extracted the locking script from each output, recognized it as a P2PKH script, and extracted the public-key-hash from within. Finally, the blockchain explorer reencoded each public key hash with Base58Check to produce and display the Bitcoin addresses.</p>
</div>
<div class="paragraph data-line-739">
<p>If you were to click on Bob&#8217;s Bitcoin address, the blockchain explorer would show you the view in <a href="#the_balance_of_bobs_bitcoin_address">The balance of Bob&#8217;s Bitcoin address</a>.</p>
</div>
<div id="the_balance_of_bobs_bitcoin_address" class="imageblock data-line-743">
<div class="content">
<img src="images/mbc2_0608.png" alt="The balance of Bob&#8217;s Bitcoin address">
</div>
<div class="title">Figure 44. The balance of Bob&#8217;s Bitcoin address</div>
</div>
<div class="paragraph data-line-745">
<p>The blockchain explorer displays the balance of Bob&#8217;s Bitcoin address. But nowhere in the Bitcoin system is there a concept of a "balance." Rather, the values displayed here are constructed by the blockchain explorer as follows.</p>
</div>
<div class="paragraph data-line-747">
<p>To construct the "Total Received" amount, the blockchain explorer first will decode the Base58Check encoding of the Bitcoin address to retrieve the 160-bit hash of Bob&#8217;s public key that is encoded within the address. Then, the blockchain explorer will search through the database of transactions, looking for outputs with P2PKH locking scripts that contain Bob&#8217;s public key hash. By summing up the value of all the outputs, the blockchain explorer can produce the total value received.</p>
</div>
<div class="paragraph data-line-749">
<p>Constructing the current balance (displayed as "Final Balance") requires a bit more work. The blockchain explorer keeps a separate database of the outputs that are currently unspent, the UTXO set. To maintain this database, the blockchain explorer must monitor the Bitcoin network, add newly created UTXO, and remove spent UTXO, in real time, as they appear in unconfirmed transactions. This is a complicated process that depends on keeping track of transactions as they propagate, as well as maintaining consensus with the Bitcoin network to ensure that the correct chain is followed. Sometimes, the blockchain explorer goes out of sync and its perspective of the UTXO set is incomplete or incorrect.</p>
</div>
<div class="paragraph data-line-751">
<p>A partir do conjunto UTXO, o explorador de blockchain soma o valor de todas as saídas não gastas que fazem referência ao hash da chave pública do Bob e produz o valor do "Saldo Final" que é exibido ao usuário.</p>
</div>
<div class="paragraph data-line-753">
<p>Para produzir apenas essa tela, contendo esses dois "saldos", o explorador de blockchain precisa indexar e pesquisar dezenas, centenas ou mesmo centenas de milhares de transações.</p>
</div>
<div class="paragraph data-line-755">
<p>Em resumo, as informações apresentadas aos usuários por meio de aplicativos de carteira, exploradores de blockchain e outras interfaces de usuário do bitcoin são frequentemente compostas de abstrações de nível superior que são derivadas ao se pesquisar muitas transações diferentes, ao se inspecionar seu conteúdo e ao  se manipular os dados contidos nelas. Ao apresentar essa visão simplista das transações de bitcoin, que se assemelham a cheques bancários de um remetente para um destinatário, esses aplicativos precisam abstrair muitos detalhes subjacentes. Eles se concentram principalmente nos tipos comuns de transações: P2PKH com assinaturas SIGHASH_ALL em todas as entradas. Portanto, embora os aplicativos de bitcoin possam apresentar mais de 80% de todas as transações em uma maneira fácil de ler, às vezes eles ficam perdidos quando se deparam com transações que fogem do normal. As transações que contêm scripts de travamento mais complexos, sinalizadores SIGHASH diferentes ou muitas entradas e saídas, acabam demonstrando a simplicidade e a fraqueza dessas abstrações.</p>
</div>
<div class="paragraph data-line-757">
<p>Todos os dias, centenas de transações que não contêm saídas P2PKH são confirmadas na blockchain. Os exploradores de blockchain frequentemente apresentam mensagens de advertência em vermelho dizendo que eles não conseguem decodificar um endereço.</p>
</div>
<div class="paragraph data-line-759">
<p>Como veremos no próximo capítulo, essas transações não são necessariamente estranhas. São transações que contêm scripts de travamento mais complexos do que o P2PKH comum. A seguir, aprenderemos a decodificar e compreender scripts mais complexos e as aplicações que eles suportam.</p>
</div>
<div id="adv_transactions" class="paragraph data-line-763">
<p>== Transações e Scripts Avançados</p>
</div>
<div id="ch07_intro" class="paragraph data-line-766">
<p>=== Introdução</p>
</div>
<div class="paragraph data-line-768">
<p>No capítulo anterior, apresentamos os elementos básicos das transações de bitcoin e vimos o tipo mais comum de script de transação, o script P2PKH. Neste capítulo, veremos scripts mais avançados e como podemos usá-los para construir transações com condições complexas.</p>
</div>
<div class="paragraph data-line-770">
<p>Primeiro, veremos os scripts <em>multiassinatura</em>. A seguir, examinaremos o segundo script de transação mais comum, o <em>Pay-to-Script-Hash</em> (em português, <em>Paga-para-Hash-de-Script</em>), que abre um novo mundo de scripts complexos. Em seguida, examinaremos novos operadores de script que adicionam uma dimensão de tempo ao bitcoin, por meio de <em>timelocks</em>. Por último, veremos a <em>Segregated Witness</em> (em português, <em>Testemunha Segregada</em>), uma mudança arquitetural na estrutura das transações.</p>
</div>
<div id="multisig" class="paragraph data-line-773">
<p>=== Multiassinatura</p>
</div>
<div class="paragraph data-line-775">
<p>Os scripts multiassinatura definem uma condição onde N chaves públicas são registradas no script e pelo menos M delas devem fornecer assinaturas para destravar os fundos. Isso também é conhecido como um esquema M-de-N, onde N é o número total de chaves e M é a quantidade mínima de assinaturas necessárias para validação. Por exemplo, uma multiassinatura 2-de-3 é aquela em que três chaves públicas são listadas como signatárias em potencial e pelo menos duas delas devem ser usadas para criar assinaturas para uma transação válida gastar os fundos.</p>
</div>
<div class="paragraph data-line-777">
<p>Atualmente, os scripts multiassinatura <em>padrão</em> são limitados a no máximo 3 chaves públicas listadas, o que significa que você pode fazer qualquer combinação partindo de 1-de-1 até 3-de-3 ou qualquer combinação dentro desse intervalo. A limitação de 3 chaves listadas pode já ter sido removida no momento em que este livro for publicado, portanto, verifique a função IsStandard() para ver o que é aceito atualmente pela rede. Observe que o limite de 3 chaves se aplica apenas a scripts multiassinatura padrão (também conhecidos como "<em>bare multisig</em>"), e não a scripts multiassinatura embrulhados em um script Pay-to-Script-Hash (P2SH). Os scripts multiassinatura P2SH são limitados a 15 chaves, permitindo multiassinaturas de até 15-de-15. Essa limitação é também imposta pela função IsStandard(). Aprenderemos sobre o P2SH em <a href="#p2sh">[p2sh]</a>.</p>
</div>
<div class="paragraph data-line-779">
<p>A forma geral usada por um script de travamento para definir uma condição multiassinatura M-de-N é</p>
</div>
<div class="listingblock data-line-781">
<div class="content">
<pre>M &lt;Chave Pública 1&gt; &lt;Chave Pública 2&gt; ... &lt;Chave Pública N&gt; N CHECKMULTISIG</pre>
</div>
</div>
<div class="paragraph data-line-785">
<p>onde N é o número total de chaves públicas listadas e M é a quantidade mínima de assinaturas necessárias para se gastar a saída.</p>
</div>
<div class="paragraph data-line-787">
<p>Um script de travamento definindo uma condição multiassinatura 2-de-3 fica dessa forma:</p>
</div>
<div class="listingblock data-line-789">
<div class="content">
<pre>2 &lt;Chave Pública A&gt; &lt;Chave Pública B&gt; &lt;Chave Pública C&gt; 3 CHECKMULTISIG</pre>
</div>
</div>
<div class="paragraph data-line-793">
<p>O script de travamento acima pode ser satisfeito com um script de destravamento contendo qualquer combinação de duas assinaturas obtidas a partir das chaves privadas que correspondem às três chaves públicas listadas:</p>
</div>
<div class="listingblock data-line-795">
<div class="content">
<pre>&lt;Assinatura B&gt; &lt;Assinatura C&gt;</pre>
</div>
</div>
<div class="paragraph data-line-799">
<p>Os dois scripts juntos formariam o seguinte script de validação combinado:</p>
</div>
<div class="listingblock data-line-801">
<div class="content">
<pre>&lt;Assinatura B&gt; &lt;Assinatura C&gt; 2 &lt;Chave Pública A&gt; &lt;Chave Pública B&gt; &lt;Chave Pública C&gt; 3 CHECKMULTISIG</pre>
</div>
</div>
<div class="paragraph data-line-805">
<p>Quando executado, o script combinado será avaliado como TRUE se, e somente se, o script de destravamento coincidir com as condições definidas pelo script de travamento. Neste caso, a condição é se o script de destravamento tem uma assinatura válida obtida a partir das duas chaves privadas que correspondem a duas das três chaves públicas definidas como uma trava.</p>
</div>
<div id="multisig_bug" class="paragraph data-line-808">
<p>===== Um bug na execução do CHECKMULTISIG</p>
</div>
<div class="paragraph data-line-810">
<p>Existe um bug na execução do CHECKMULTISIG que requer uma pequena solução alternativa. Quando o CHECKMULTISIG é executado, ele deveria consumir M+N+2 itens na pilha como parâmetros. No entanto, devido ao bug, o CHECKMULTISIG removerá um valor a mais do que o esperado.</p>
</div>
<div class="paragraph data-line-812">
<p>Vamos examinar isso em mais detalhes usando o exemplo de validação anterior:</p>
</div>
<div class="listingblock data-line-814">
<div class="content">
<pre>&lt;Assinatura B&gt; &lt;Assinatura C&gt; 2 &lt;Chave Pública A&gt; &lt;Chave Pública B&gt; &lt;Chave Pública C&gt; 3 CHECKMULTISIG</pre>
</div>
</div>
<div class="paragraph data-line-818">
<p>Primeiro, o CHECKMULTISIG remove o item do topo da pilha, que é o N (neste exemplo "3"). Em seguida, ele remove N itens, que são as chaves públicas que podem assinar. Neste exemplo, as chaves públicas A, B e C. Em seguida, ele remove um item da pilha, que é o M, o quórum (quantas assinaturas são necessárias). Aqui, M = 2. Neste ponto, o CHECKMULTISIG deve remover da pilha os M itens finais, que são as assinaturas, e ver se elas são válidas. No entanto, infelizmente, um bug na implementação faz com que o CHECKMULTISIG remova um item a mais do que deveria (M+1 no total). O item extra é desconsiderado na verificação das assinaturas, então ele não tem efeito direto no CHECKMULTISIG em si. No entanto, um valor extra deve estar presente, pois se ele não estiver presente, quando o CHECKMULTISIG tentar remover um item em uma pilha vazia, isso causará um erro de pilha e uma falha de script (marcando a transação como inválida). Como o item extra é desconsiderado, ele pode ser qualquer coisa, mas normalmente o valor 0 é usado.</p>
</div>
<div class="paragraph data-line-820">
<p>Como esse bug tornou-se parte das regras de consenso, agora ele precisa ser replicado para sempre. Portanto, a validação de script correta seria assim:</p>
</div>
<div class="listingblock data-line-822">
<div class="content">
<pre>0 &lt;Assinatura B&gt; &lt;Assinatura C&gt; 2 &lt;Chave Pública A&gt; &lt;Chave Pública B&gt; &lt;Chave Pública C&gt; 3 CHECKMULTISIG</pre>
</div>
</div>
<div class="paragraph data-line-826">
<p>Portanto, o script de destravamento que é de fato usado na multiassinatura não é:</p>
</div>
<div class="listingblock data-line-828">
<div class="content">
<pre>&lt;Assinatura B&gt; &lt;Assinatura C&gt;</pre>
</div>
</div>
<div class="paragraph data-line-832">
<p>mas, em vez disso, é:</p>
</div>
<div class="listingblock data-line-834">
<div class="content">
<pre>0 &lt;Assinatura B&gt; &lt;Assinatura C&gt;</pre>
</div>
</div>
<div class="paragraph data-line-838">
<p>De agora em diante, sempre que você se deparar com um script de destravamento multiassinatura, você já saberá para que serve o 0 extra no início do script, cujo único propósito é contornar um bug que acidentalmente se tornou uma regra de consenso.</p>
</div>
<div id="p2sh" class="paragraph data-line-841">
<p>=== Pay-to-Script-Hash (P2SH)</p>
</div>
<div class="paragraph data-line-843">
<p>O <em>Pay-to-Script-Hash</em> (em português, Paga-para-Hash-de-Script) ou P2SH foi introduzido em 2012 como um novo tipo poderoso de transação que simplifica muito o uso de scripts de transação complexos. Para explicar a necessidade do P2SH, vamos dar uma olhada em um exemplo prático.</p>
</div>
<div class="paragraph data-line-845">
<p>No <a href="#ch01_intro_what_is_bitcoin">Introdução</a> apresentamos o Mohammed, um importador de eletrônicos que mora em Dubai. A empresa do Mohammed usa extensivamente o recurso de multiassinatura do bitcoin para suas contas corporativas. Os scripts multiassinatura são um dos usos mais comuns das capacidades avançadas de script do bitcoin e são um recurso muito poderoso.  A empresa do Mohammed usa um script multiassinatura para todos os pagamentos de clientes, algo que é conhecido em termos contábeis como "contas a receber" (em inglês <em>"accounts receivable"</em> ou AR). Com o esquema multiassinatura, todos os pagamentos feitos pelos clientes são travados de forma que eles exijam pelo menos duas assinaturas para serem liberados, uma do Mohammed e uma de seus sócios ou uma de seu advogado que possui uma chave reserva. Um esquema multiassinatura como esse oferece controles de governança corporativa e protege contra roubo, apropriação indébita ou perda.</p>
</div>
<div class="paragraph data-line-847">
<p>O script resultante é bastante longo e tem a seguinte forma:</p>
</div>
<div class="listingblock data-line-849">
<div class="content">
<pre>2 &lt;Chave Pública do Mohammed&gt; &lt;Chave Pública do Sócio1&gt; &lt;Chave Pública do Sócio2&gt; &lt;Chave Pública do Sócio3&gt; &lt;Chave Pública do Advogado&gt; 5 CHECKMULTISIG</pre>
</div>
</div>
<div class="paragraph data-line-853">
<p>Embora os scripts multiassinatura sejam um recurso poderoso, eles são complicados de usar. Dado o script anterior, o Mohammed teria que comunicar esse script a todos os clientes antes do pagamento. Cada cliente teria que usar um software de carteira de bitcoin especial, com a capacidade de criar scripts de transação personalizados, e cada cliente teria que entender como criar uma transação usando scripts personalizados. Além disso, a transação resultante seria cerca de cinco vezes maior do que uma transação de pagamento simples, pois esse script contém chaves públicas muito longas. O ônus dessa transação extra-grande seria arcado pelo cliente na forma de taxas de transação mais elevadas. Finalmente, um script de transação grande como este seria carregado no conjunto UTXO contido na memória RAM de cada nó completo, até que ele fosse gasto. Todos esses problemas tornam o uso de scripts de travamento complexos difícil na prática.</p>
</div>
<div class="paragraph data-line-855">
<p>P2SH was developed to resolve these practical difficulties and to make the use of complex scripts as easy as a payment to a Bitcoin address. With P2SH payments, the complex locking script is replaced with its digital fingerprint, a cryptographic hash. When a transaction attempting to spend the UTXO is presented later, it must contain the script that matches the hash, in addition to the unlocking script. In simple terms, P2SH means "pay to a script matching this hash, a script that will be presented later when this output is spent."</p>
</div>
<div class="paragraph data-line-857">
<p>Nas transações P2SH, o script de travamento que é substituído por um hash é referido como o <em>script de resgate</em> (em inglês, <em>redeem script</em>), pois ele é apresentado ao sistema no momento do resgate, ao invés de ser apresentado como um script de travamento. A <a href="#without_p2sh">Script complexo sem P2SH</a> mostra o script sem P2SH e a <a href="#with_p2sh">Script complexo com P2SH</a> mostra o mesmo script codificado com P2SH.</p>
</div>
<table id="without_p2sh" class="tableblock frame-all grid-all stretch data-line-861">
<caption class="title">Table 21. Script complexo sem P2SH</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Script de Travamento</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 ChavePública1 ChavePública2 ChavePública3 ChavePública4 ChavePública5 5 CHECKMULTISIG</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Script de Destravamento</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 Assinatura1 Assinatura2</p></td>
</tr>
</tbody>
</table>
<table id="with_p2sh" class="tableblock frame-all grid-all stretch data-line-868">
<caption class="title">Table 22. Script complexo com P2SH</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Script de Resgate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 ChavePública1 ChavePública2 ChavePública3 ChavePública4 ChavePública5 5 CHECKMULTISIG</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Script de Travamento</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HASH160 &lt;hash de 20 bytes do script de resgate&gt; EQUAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Script de Destravamento</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 Assinatura1 Assinatura2 &lt;script de resgate&gt;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-874">
<p>Como você pode ver nas tabelas, com P2SH, o complexo script que detalha as condições para gastar a saída (o script de resgate) não é apresentado no script de travamento. Em vez disso, somente um hash do script de resgate é adicionado no script de travamento e o script de resgate em si é apresentado mais tarde, como parte do script de destravamento quando a saída for gasta. Isso transfere o fardo das taxas e da complexidade do remetente (quem cria a transação) para o destinatário (quem destrava e gasta a transação).</p>
</div>
<div class="paragraph data-line-876">
<p>Vamos dar uma olhada na empresa do Mohammed, o script multiassinatura complexo e os scripts P2SH resultantes.</p>
</div>
<div class="paragraph data-line-878">
<p>Primeiro, o script multiassinatura que a empresa do Mohammed usa para todos os pagamentos que recebe de seus clientes:</p>
</div>
<div class="listingblock data-line-880">
<div class="content">
<pre>2 &lt;Chave Pública do Mohammed&gt; &lt;Chave Pública do Sócio1&gt; &lt;Chave Pública do Sócio2&gt; &lt;Chave Pública do Sócio3&gt; &lt;Chave Pública do Advogado&gt; 5 CHECKMULTISIG</pre>
</div>
</div>
<div class="paragraph data-line-884">
<p>Se os marcadores forem substituídos pelas verdadeiras chaves públicas (demonstradas aqui como números de 520 bits começando com 04), você verá que esse script se torna muito longo:</p>
</div>
<div class="listingblock data-line-886">
<div class="content">
<pre>2
04C16B8698A9ABF84250A7C3EA7EEDEF9897D1C8C6ADF47F06CF73370D74DCCA01CDCA79DCC5C395D7EEC6984D83F1F50C900A24DD47F569FD4193AF5DE762C58704A2192968D8655D6A935BEAF2CA23E3FB87A3495E7AF308EDF08DAC3C1FCBFC2C75B4B0F4D0B1B70CD2423657738C0C2B1D5CE65C97D78D0E34224858008E8B49047E63248B75DB7379BE9CDA8CE5751D16485F431E46117B9D0C1837C9D5737812F393DA7D4420D7E1A9162F0279CFC10F1E8E8F3020DECDBC3C0DD389D99779650421D65CBD7149B255382ED7F78E946580657EE6FDA162A187543A9D85BAAA93A4AB3A8F044DADA618D087227440645ABE8A35DA8C5B73997AD343BE5C2AFD94A5043752580AFA1ECED3C68D446BCAB69AC0BA7DF50D56231BE0AABF1FDEEC78A6A45E394BA29A1EDF518C022DD618DA774D207D137AAB59E0B000EB7ED238F4D800 5 CHECKMULTISIG</pre>
</div>
</div>
<div class="paragraph data-line-891">
<p>Em vez disso, esse script inteiro pode ser representado por um hash criptográfico de 20 bytes, aplicando-se primeiro o algoritmo de hash SHA256 e, em seguida, aplicando-se o algoritmo RIPEMD160 no resultado.</p>
</div>
<div class="paragraph data-line-893">
<p>Usamos o libbitcoin-explorer (bx) na linha de comando para produzir o hash do script, da seguinte maneira:</p>
</div>
<div class="listingblock data-line-895">
<div class="content">
<pre>echo \
2 \
[04C16B8698A9ABF84250A7C3EA7EEDEF9897D1C8C6ADF47F06CF73370D74DCCA01CDCA79DCC5C395D7EEC6984D83F1F50C900A24DD47F569FD4193AF5DE762C587] \
[04A2192968D8655D6A935BEAF2CA23E3FB87A3495E7AF308EDF08DAC3C1FCBFC2C75B4B0F4D0B1B70CD2423657738C0C2B1D5CE65C97D78D0E34224858008E8B49] \
[047E63248B75DB7379BE9CDA8CE5751D16485F431E46117B9D0C1837C9D5737812F393DA7D4420D7E1A9162F0279CFC10F1E8E8F3020DECDBC3C0DD389D9977965] \
[0421D65CBD7149B255382ED7F78E946580657EE6FDA162A187543A9D85BAAA93A4AB3A8F044DADA618D087227440645ABE8A35DA8C5B73997AD343BE5C2AFD94A5] \
[043752580AFA1ECED3C68D446BCAB69AC0BA7DF50D56231BE0AABF1FDEEC78A6A45E394BA29A1EDF518C022DD618DA774D207D137AAB59E0B000EB7ED238F4D800] \
5 CHECKMULTISIG \
| bx script-encode | bx sha256 | bx ripemd160
54c557e07dde5bb6cb791c7a540e0a4796f5e97e</pre>
</div>
</div>
<div class="paragraph data-line-908">
<p>A série de comandos acima codifica primeiro o script de resgate multiassinatura do Mohammed como um Script do bitcoin codificado em hexadecimal e serializado. O próximo comando bx calcula o hash SHA256 do script. O próximo comando bx faz outro <em>hashing</em> com o RIPEMD160, produzindo o hash do script final:</p>
</div>
<div class="paragraph data-line-910">
<p>O hash de 20 bytes do script de resgate do Mohammed é:</p>
</div>
<div class="listingblock data-line-912">
<div class="content">
<pre>54c557e07dde5bb6cb791c7a540e0a4796f5e97e</pre>
</div>
</div>
<div class="paragraph data-line-916">
<p>Uma transação P2SH trava a saída para este hash, em vez do script de resgate mais longo, usando o script de travamento:</p>
</div>
<div class="listingblock data-line-918">
<div class="content">
<pre>HASH160 54c557e07dde5bb6cb791c7a540e0a4796f5e97e EQUAL</pre>
</div>
</div>
<div class="paragraph data-line-922">
<p>o qual, como você pode ver, é muito mais curto. Em vez de "pagar para este script multiassinatura de 5 chaves", a transação P2SH equivalente é "pagar para um script com este hash". Um cliente que faz um pagamento para a empresa do Mohammed só precisa incluir esse script de travamento muito mais curto em seu pagamento. Quando o Mohammed e seus sócios desejarem gastar esta UTXO, eles deverão apresentar o script de resgate original (aquele cujo hash travou a UTXO) e as assinaturas necessárias para destravá-lo, dessa maneira:</p>
</div>
<div class="listingblock data-line-924">
<div class="content">
<pre>&lt;Assinatura1&gt; &lt;Assinatura2&gt; &lt;2 CP1 CP2 CP3 CP4 CP5 5 CHECKMULTISIG&gt;</pre>
</div>
</div>
<div class="paragraph data-line-928">
<p>Os dois scripts são combinados em dois estágios. Primeiro, o script de resgate é verificado em relação ao script de travamento para garantir que o hash corresponda:</p>
</div>
<div class="listingblock data-line-930">
<div class="content">
<pre>&lt;2 CP1 CP2 CP3 CP4 CP5 5 CHECKMULTISIG&gt; HASH160 &lt;hash do script de resgate&gt; EQUAL</pre>
</div>
</div>
<div class="paragraph data-line-933">
<p>Se o hash do script de resgate corresponder, o script de destravamento será executado isoladamente, para destravar o script de resgate:</p>
</div>
<div class="listingblock data-line-935">
<div class="content">
<pre>&lt;Assinatura1&gt; &lt;Assinatura2&gt; 2 CP1 CP2 CP3 CP4 CP5 5 CHECKMULTISIG</pre>
</div>
</div>
<div class="paragraph data-line-939">
<p>Quase todos os scripts descritos neste capítulo só podem ser implementados como scripts P2SH. Por exemplo, um script de travamento multiassinatura padrão 2 de 5 não pode ser usado diretamente no script de travamento de uma UTXO, pois a função IsStandard() invalidaria a transação. Para estar em conformidade, um script de travamento P2SH pode ser usado em seu lugar, como visto acima. Uma transação que inclui um script de destravamento P2SH pode ser usada para resgatar essa UTXO e será válida desde que não contenha mais do que 15 chaves públicas. </p>
</div>
<div class="admonitionblock tip data-line-942">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-943">
<p>Lembre-se, por causa da política definida pela função IsStandard() no momento da redação deste livro, os scripts multiassinatura padrão são limitados a no máximo 3 chaves públicas listadas, enquanto os scripts P2SH são limitados a no máximo 15 chaves públicas listadas. Enquanto os scripts multiassinatura padrão podem invalidar transações por meio de seu script de travamento <em>ou</em> destravamento, os scripts P2SH podem invalidar transações <em>apenas</em> por meio de seu script de destravamento. Isso ocorre porque não há como a função IsStandard() saber se um hash de um script de resgate em um script de travamento inclui mais assinaturas do que a limitação de tamanho atualmente imposta, portanto, ela só pode observar os scripts de destravamento nas entradas de transação.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-946">
<p>==== Endereços P2SH</p>
</div>
<div class="paragraph data-line-948">
<p>Another important part of the P2SH feature is the ability to encode a script hash as an address, as defined in BIP-13. P2SH addresses are Base58Check encodings of the 20-byte hash of a script, just like Bitcoin addresses are Base58Check encodings of the 20-byte hash of a public key. P2SH addresses use the version prefix "5," which results in Base58Check-encoded addresses that start with a "3."</p>
</div>
<div class="paragraph data-line-950">
<p>Por exemplo, o script complexo do Mohammed, transformado em hash e codificado em Base58Check como um endereço P2SH, torna-se 39RF6JqABiHdYHkfChV6USGMe6Nsr66Gzw. Podemos confirmar isso com o comando bx:</p>
</div>
<div class="listingblock data-line-952">
<div class="content">
<pre>echo \
'54c557e07dde5bb6cb791c7a540e0a4796f5e97e'\
 | bx address-encode -v 5
39RF6JqABiHdYHkfChV6USGMe6Nsr66Gzw</pre>
</div>
</div>
<div class="paragraph data-line-960">
<p>Now, Mohammed can give this "address" to his customers and they can use almost any bitcoin wallet to make a simple payment, as if it were a Bitcoin address. The 3 prefix gives them a hint that this is a special type of address, one corresponding to a script instead of a public key, but otherwise it works in exactly the same way as a payment to a Bitcoin address.</p>
</div>
<div class="paragraph data-line-962">
<p>Os endereços P2SH escondem toda essa complexidade, de maneira que a pessoa que está fazendo o pagamento não enxergue o script.</p>
</div>
<div class="paragraph data-line-964">
<p>==== Benefícios do P2SH</p>
</div>
<div class="paragraph data-line-966">
<p>O recurso P2SH oferece os seguintes benefícios em comparação com o uso direto de scripts complexos para o travamento de saídas:</p>
</div>
<div class="ulist data-line-968">
<ul>
<li class="data-line-968">
<p>Os scripts complexos são substituídos por impressões digitais menores na saída da transação, tornando a transação menor.</p>
</li>
<li class="data-line-969">
<p>Os scripts podem ser codificados como um endereço, de maneira que o remetente e a carteira do remetente não precisem fazer modificações complexas para implementar o P2SH.</p>
</li>
<li class="data-line-970">
<p>O P2SH faz com que o fardo de se construir o script seja do recipiente, e não do remetente.</p>
</li>
<li class="data-line-971">
<p>O P2SH transfere a obrigação de armazenar o script longo da saída (que, além de ser armazenada na blockchain, também está no conjunto UTXO) para a entrada (que é armazenada apenas na blockchain).</p>
</li>
<li class="data-line-972">
<p>O P2SH faz com que o fardo do armazenamento do script longo deixe de estar no presente (pagamento) e passe a estar no futuro (quando ele é gasto).</p>
</li>
<li class="data-line-973">
<p>O P2SH faz com que os maiores custos com taxa de transação de um script longo deixem de ser do remetente e passem a ser do recipiente (destinatário), que tem que incluir o script longo de resgate para poder gastá-lo.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-975">
<p>==== Script de Resgate e Validação</p>
</div>
<div class="paragraph data-line-977">
<p>Antes da versão 0.9.2 do cliente Bitcoin Core, o Pay-to-Script-Hash era limitado aos tipos padrão de scripts de transação de bitcoin pela função IsStandard(). Isso significa que o script de resgate apresentado na transação de gasto só poderia ser um dos tipos padrão: P2PK, P2PKH ou multiassinatura.</p>
</div>
<div class="paragraph data-line-979">
<p>A partir da versão 0.9.2 do cliente Bitcoin Core, as transações P2SH podem conter qualquer script válido, tornando o padrão P2SH muito mais flexível e permitindo a experimentação de muitos tipos novos e complexos de transações.</p>
</div>
<div class="paragraph data-line-981">
<p>Você não pode colocar um P2SH dentro de um script de resgate P2SH, pois a especificação P2SH não é recursiva. Além disso, embora seja tecnicamente possível incluir um RETURN (ver <a href="#op_return">[op_return]</a>) em um script de resgate, já que nada nas regras impede que você faça isso, isso não tem uso prático, pois executar o RETURN durante a validação fará com que a transação seja marcada como inválida.</p>
</div>
<div class="paragraph data-line-983">
<p>Observe que, como o script de resgate não é apresentado à rede até que você tente gastar uma saída P2SH, se você travar uma saída com o hash de um script de resgate inválido, esse travamento será processado de qualquer forma. A UTXO será travada com sucesso. No entanto, você não poderá gastá-la porque a transação de gasto, que inclui o script de resgate, não será aceita, pois o script é inválido. Isso cria um risco, visto que você pode travar bitcoins em um P2SH que não poderá ser gasto posteriormente. A rede aceitará o script de travamento P2SH mesmo que ele corresponda a um script de resgate inválido, pois o hash do script não dá nenhuma indicação do script que ele representa.</p>
</div>
<div class="admonitionblock warning data-line-986">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-987">
<p>Os scripts de travamento P2SH contêm o hash de um script de resgate, que não fornece pistas quanto ao conteúdo do script de resgate em si. A transação P2SH será considerada válida e será aceita, mesmo que o script de resgate seja inválido. Você poderia travar acidentalmente os bitcoins, de modo que eles não possam mais ser gastos no futuro.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="op_return" class="paragraph data-line-993">
<p>=== Saída de Registro de Dados (RETURN)</p>
</div>
<div class="paragraph data-line-995">
<p>A blockchain do bitcoin, o seu livro-razão distribuído com carimbos de data e hora, tem usos potenciais muito além dos pagamentos. Muitos desenvolvedores tentaram usar a linguagem de script de transação para aproveitar a segurança e a resiliência do sistema em aplicações como serviços de cartório digital, certificados de ações e contratos inteligentes. As primeiras tentativas de usar a linguagem de script do bitcoin para esses fins envolviam a criação de saídas de transação que registravam dados na blockchain; por exemplo, para registrar uma impressão digital de um arquivo, de tal forma que qualquer pessoa pudesse estabelecer a prova de existência desse arquivo em uma data específica através de uma referência àquela transação.</p>
</div>
<div class="paragraph data-line-997">
<p>The use of bitcoin&#8217;s blockchain to store data unrelated to bitcoin payments is a controversial subject. Many developers consider such use abusive and want to discourage it. Others view it as a demonstration of the powerful capabilities of blockchain technology and want to encourage such experimentation. Those who object to the inclusion of nonpayment data argue that it causes "blockchain bloat," burdening those running full Bitcoin nodes with carrying the cost of disk storage for data that the blockchain was not intended to carry. Moreover, such transactions create UTXO that cannot be spent, using the destination Bitcoin address as a freeform 20-byte field. Because the address is used for data, it doesn&#8217;t correspond to a private key and the resulting UTXO can <em>never</em> be spent; it&#8217;s a fake payment. These transactions that can never be spent are therefore never removed from the UTXO set and cause the size of the UTXO database to forever increase, or "bloat."</p>
</div>
<div class="paragraph data-line-999">
<p>Na versão 0.9 do cliente Bitcoin Core, os ânimos foram apaziguados com a introdução do operador RETURN. O RETURN permite que os desenvolvedores adicionem 80 bytes de dados não relacionados a pagamento a uma saída de transação. No entanto, ao contrário do uso de UTXOs "falsas", o operador RETURN explicitamente cria uma saída que é <em>comprovadamente não gastável</em>, a qual não precisa ser armazenada no conjunto UTXO. As saídas com RETURN são registradas na blockchain, portanto, consomem espaço em disco e contribuem para o aumento no tamanho da blockchain, mas elas não são armazenadas no conjunto UTXO e, portanto, não incham a pool de memória de UTXOs e diminuem os gastos que os nós completos tem em memória RAM, que é cara.</p>
</div>
<div class="paragraph data-line-1001">
<p>Os scripts RETURN têm a seguinte forma:</p>
</div>
<div class="listingblock data-line-1003">
<div class="content">
<pre>RETURN &lt;dados&gt;</pre>
</div>
</div>
<div class="paragraph data-line-1007">
<p> A porção de dados é limitada a 80 bytes e na maioria das vezes representa um hash, como a saída do algoritmo SHA256 (32 bytes). Muitos aplicativos colocam um prefixo na frente dos dados para ajudar a identificar a aplicação. Por exemplo, o serviço de notas digitais de <a href="https://proofofexistence.com" data-href="https://proofofexistence.com">Prova de Existência</a> usa o prefixo de 8 bytes+DOCPROOF+, que é ASCII codificado como 44 4f 43 50 52 4f 4f 46 em hexadecimal.</p>
</div>
<div class="paragraph data-line-1009">
<p>Lembre-se de que não existe um "script de destravamento" que corresponda ao RETURN que possa ser usado para "gastar" uma saída RETURN. O motivo principal pelo qual o RETURN foi criado, é para que você não possa gastar o dinheiro travado nessa saída e, portanto, para que ela não precise ser mantida no conjunto UTXO como potencialmente gastável—o RETURN é <em>comprovadamente impossível de ser gasto</em>. O RETURN geralmente é uma saída com uma quantidade zero de bitcoin, pois qualquer bitcoin atribuído a essa saída é efetivamente perdido para sempre. Se um RETURN for referenciado como uma entrada em uma transação, o mecanismo de validação de script suspenderá a execução do script de validação e marcará a transação como inválida. A execução do RETURN essencialmente faz com que o script "retorne" com um FALSE e suspenda a execução. Portanto, se você acidentalmente referenciar uma saída RETURN como uma entrada em uma transação, essa transação será inválida.</p>
</div>
<div class="paragraph data-line-1011">
<p>Uma transação padrão (que esteja em conformidade com as verificações IsStandard()) só pode ter uma única saída RETURN. No entanto, uma saída RETURN única pode ser combinada em uma transação com saídas de qualquer outro tipo.</p>
</div>
<div class="paragraph data-line-1013">
<p>Duas novas opções de linha de comando foram adicionadas ao Bitcoin Core a partir da versão 0.10. A opção datacarrier controla a retransmissão e a mineração de transações RETURN, com o padrão definido como "1" para permiti-las. A opção datacarriersize recebe um argumento numérico especificando o tamanho máximo em bytes do script RETURN, 83 bytes por padrão, o que permite um máximo de 80 bytes de dados RETURN mais um byte do código operacional RETURN e dois bytes do código operacional PUSHDATA.</p>
</div>
<div class="admonitionblock note data-line-1016">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-1017">
<p>O RETURN foi inicialmente proposto com um limite de 80 bytes, mas o limite foi reduzido para 40 bytes quando o recurso foi lançado. Em fevereiro de 2015, na versão 0.10 do Bitcoin Core, o limite foi novamente aumentado para 80 bytes. Os nós podem decidir não retransmitir ou minerar o RETURN, ou apenas retransmitir e minerar os RETURN que contenham menos de 80 bytes de dados.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1020">
<p>=== Timelocks</p>
</div>
<div class="paragraph data-line-1022">
<p>Os timelocks são restrições em transações ou saídas que só permitem o gasto após um determinado momento no tempo. O bitcoin tem desde o seu início um recurso de timelock a nível de transação. Ele é implementado pelo campo nLocktime em uma transação. Dois novos recursos de timelock foram introduzidos no final de 2015 e em meados de 2016, que oferecem timelocks a nível de UTXO. Eles são o CHECKLOCKTIMEVERIFY e o CHECKSEQUENCEVERIFY.</p>
</div>
<div class="paragraph data-line-1024">
<p>Os timelocks são úteis para transações pré-datadas (com pagamento em data futura) e para travar fundos até uma data futura. Mais importante, os timelocks estendem o script do bitcoin para a dimensão do tempo, permitindo a criação de contratos inteligentes complexos de múltiplas etapas.</p>
</div>
<div id="transaction_locktime_nlocktime" class="paragraph data-line-1027">
<p>==== Locktime de Transação (nLocktime)</p>
</div>
<div class="paragraph data-line-1029">
<p>From the beginning, bitcoin has had a transaction-level timelock feature. Transaction locktime is a transaction-level setting (a field in the transaction data structure) that defines the earliest time that a transaction is valid and can be relayed on the network or added to the blockchain. Locktime is also known as nLocktime from the variable name used in the Bitcoin Core codebase. It is set to zero in most transactions to indicate immediate propagation and execution. If nLocktime is nonzero and below 500 million, it is interpreted as a block height, meaning the transaction is not valid and is not relayed or included in the blockchain prior to the specified block height. If it is greater than or equal to 500 million, it is interpreted as a Unix Epoch timestamp (seconds since Jan-1-1970) and the transaction is not valid prior to the specified time. Transactions with nLocktime specifying a future block or time must be held by the originating system and transmitted to the Bitcoin network only after they become valid. If a transaction is transmitted to the network before the specified nLocktime, the transaction will be rejected by the first node as invalid and will not be relayed to other nodes. The use of nLocktime is equivalent to postdating a paper check.</p>
</div>
<div id="locktime_limitations" class="paragraph data-line-1032">
<p>===== Limitações do locktime de transação</p>
</div>
<div class="paragraph data-line-1034">
<p>O nLocktime tem a limitação de que, embora ele torne possível gastar algumas saídas no futuro, ele não torna impossível gastá-las até aquele momento no futuro. Vamos explicar isso usando o exemplo a seguir.</p>
</div>
<div class="paragraph data-line-1036">
<p>A Alice assina uma transação gastando uma de suas saídas para o endereço do Bob e define o nLocktime da transação para 3 meses no futuro. A seguir, a Alice envia essa transação para o Bob para retê-la. Com esta transação, a Alice e o Bob sabem que:</p>
</div>
<div class="ulist data-line-1038">
<ul>
<li class="data-line-1038">
<p>O Bob não conseguirá transmitir a transação para resgatar os fundos antes de decorridos 3 meses.</p>
</li>
<li class="data-line-1039">
<p>O Bob conseguirá transmitir a transação após 3 meses.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1041">
<p>Entretanto:</p>
</div>
<div class="ulist data-line-1043">
<ul>
<li class="data-line-1043">
<p>A Alice conseguirá criar outra transação, fazendo um gasto duplo das mesmas entradas sem um locktime. Portanto, a Alice conseguirá gastar a mesma UTXO antes de decorridos os 3 meses.</p>
</li>
<li class="data-line-1044">
<p>Bob não tem garantia nenhuma de que a Alice não fará isso.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1046">
<p>É importante entender as limitações do nLocktime da transação. A única garantia é a de que o Bob não conseguirá resgatar os fundos da transação antes de decorridos 3 meses. Não há garantia de que o Bob receberá os fundos. Para obter tal garantia, a restrição do timelock deve ser colocada na própria UTXO e fazer parte do script de travamento, em vez de ser colocada na transação. Isso é obtido pela próxima forma de timelock que veremos, que se chama Check Lock Time Verify.</p>
</div>
<div class="paragraph data-line-1048">
<p>==== Check Lock Time Verify (CLTV)</p>
</div>
<div class="paragraph data-line-1050">
<p>Em dezembro de 2015, uma nova forma de timelock foi introduzida no bitcoin através de uma atualização de soft fork. Com base em uma especificação da BIP-65, um novo operador de script chamado <em>CHECKLOCKTIMEVERIFY</em> (<em>CLTV</em>) foi adicionado à linguagem de script. O CLTV é um timelock de saída, e não um timelock de transação, como é o caso do nLocktime. Isso permite uma flexibilidade muito maior na maneira como os timelocks são aplicados.</p>
</div>
<div class="paragraph data-line-1052">
<p>Em termos simples, ao adicionar o código operacional CLTV no script de resgate de uma saída, ele restringe a saída, de modo que ela só possa ser gasta após o tempo especificado ter decorrido.</p>
</div>
<div class="admonitionblock tip data-line-1055">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1056">
<p>Enquanto o nLocktime é um timelock a nível de transação, o CLTV é um timelock baseado na saída.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1059">
<p>O CLTV não substitui o nLocktime, mas restringe UTXOs específicas de forma que elas só possam ser gastas em uma transação futura que tenha um nLocktime definido com um valor maior ou igual ao CLTV.</p>
</div>
<div class="paragraph data-line-1061">
<p>O código operacional CLTV aceita um parâmetro como entrada, expresso como um número no mesmo formato que o nLocktime (uma altura de bloco ou um carimbo de data/hora da época Unix). Conforme indicado pelo sufixo VERIFY, o CLTV é o tipo de código operacional que suspende a execução do script se o resultado for FALSE. Se o resultado for TRUE, a execução continua.</p>
</div>
<div class="paragraph data-line-1063">
<p>Para travar uma saída com o CLTV, você deve inseri-lo script de resgate da saída, que fica na transação que cria a saída. Por exemplo, se a Alice estivesse pagando para o endereço do Bob, a saída normalmente conteria um script P2PKH como este:</p>
</div>
<div class="listingblock data-line-1065">
<div class="content">
<pre>DUP HASH160 &lt;Hash da Chave Pública do Bob&gt; EQUALVERIFY CHECKSIG</pre>
</div>
</div>
<div class="paragraph data-line-1069">
<p>Para travar a saída até um momento no futuro, digamos, daqui a três meses, seria usada uma transação P2SH com um script de resgate como este:</p>
</div>
<div class="listingblock data-line-1071">
<div class="content">
<pre>&lt;agora + 3 meses&gt; CHECKLOCKTIMEVERIFY DROP DUP HASH160 &lt;Hash da Chave Pública do Bob&gt; EQUALVERIFY CHECKSIG</pre>
</div>
</div>
<div class="paragraph data-line-1075">
<p>onde &lt;agora {plus} 3 meses&gt; é uma altura de bloco ou um valor de tempo estimado em 3 meses após a transação ter sido minerada: altura de bloco atual &#43; 12.960 (blocos) ou data/hora atual da época Unix &#43; 7.760.000 (segundos). Por enquanto, não se preocupe com o código operacional DROP que segue o CHECKLOCKTIMEVERIFY; ele será explicado em breve.</p>
</div>
<div class="paragraph data-line-1077">
<p>When Bob tries to spend this UTXO, he constructs a transaction that references the UTXO as an input. He uses his signature and public key in the unlocking script of that input and sets the transaction nLocktime to be equal to or greater than the timelock in the CHECKLOCKTIMEVERIFY Alice set. Bob then broadcasts the transaction on the Bitcoin network.</p>
</div>
<div class="paragraph data-line-1079">
<p>A transação do Bob é avaliada da seguinte maneira. Se o parâmetro CHECKLOCKTIMEVERIFY definido pela Alice for menor ou igual ao nLocktime da transação de gasto, a execução do script continua (age como se “nenhuma operação” ou um código operacional NOP tivesse sido executado). Caso contrário, a execução do script é suspensa e a transação é considerada inválida.</p>
</div>
<div class="paragraph data-line-1081">
<p>Mais precisamente, o CHECKLOCKTIMEVERIFY falha e suspende a execução, marcando a transação como inválida se: (fonte: BIP-65)</p>
</div>
<div class="olist arabic data-line-1083">
<ol class="arabic">
<li class="data-line-1083">
<p>a pilha estiver vazia; ou</p>
</li>
<li class="data-line-1084">
<p>o item no topo da pilha for menor que 0; ou</p>
</li>
<li class="data-line-1085">
<p>o tipo de timelock (altura vs. carimo de data/hora) do item no topo da pilha e o campo nLocktime não forem os mesmos; ou</p>
</li>
<li class="data-line-1086">
<p>o item no topo da pilha for maior que o campo nLocktime da transação; ou</p>
</li>
<li class="data-line-1087">
<p>o campo nSequence da entrada é 0xffffffff.</p>
</li>
</ol>
</div>
<div class="admonitionblock note data-line-1090">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-1091">
<p>O CLTV e o nLocktime usam o mesmo formato para descrever os timelocks, seja uma altura de bloco ou um tempo decorrido em segundos desde a época do Unix. É importante frisar que, quando usados juntos, o formato do nLocktime deve corresponder ao formato do CLTV usado nas saídas&#x2014;ambos devem fazer referência ou à altura do bloco ou à data/hora em segundos.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1094">
<p>Após a execução, se o CLTV for satisfeito, o parâmetro de tempo que o precedeu permanece como o item superior da pilha e pode precisar ser eliminado, com o DROP, para a correta execução dos códigos operacionais subsequentes. Por esse motivo, você frequentemente verá o CHECKLOCKTIMEVERIFY seguido de DROP nos scripts.</p>
</div>
<div class="paragraph data-line-1096">
<p>Ao usar o nLocktime em conjunto com o CLTV, o cenário descrito em <a href="#locktime_limitations">[locktime_limitations]</a> muda. A Alice não consegue mais gastar o dinheiro (pois ele está travado com a chave do Bob) e o Bob não consegue gastá-lo antes que o locktime de 3 meses tenha expirado.</p>
</div>
<div class="paragraph data-line-1098">
<p>Ao introduzir a funcionalidade de timelock diretamente na linguagem de script, o CLTV nos permite desenvolver alguns scripts complexos muito interessantes.</p>
</div>
<div class="paragraph data-line-1100">
<p>O padrão é definido na <a href="https://github.com/bitcoin/bips/blob/master/bip-0065.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0065.mediawiki">BIP-65 (CHECKLOCKTIMEVERIFY)</a>.</p>
</div>
<div class="paragraph data-line-1102">
<p>==== Timelocks Relativos</p>
</div>
<div class="paragraph data-line-1104">
<p>O nLocktime e o CLTV são ambos <em>timelocks absolutos</em> no sentido de que eles especificam um ponto absoluto no tempo. Os próximos dois recursos de timelock que examinaremos são <em>timelocks relativos</em>, pois eles especificam, como condição para se gastar uma saída, um tempo decorrido desde a confirmação da saída na blockchain.</p>
</div>
<div class="paragraph data-line-1106">
<p>Os timelocks relativos são úteis porque permitem que uma cadeia de duas ou mais transações interdependentes seja mantida <em>fora da cadeia</em> (em inglês, <em>off-chain</em>), enquanto impõem uma restrição de tempo em uma transação que depende do tempo decorrido desde a confirmação de uma transação anterior. Em outras palavras, o relógio não começa a contar até que a UTXO seja registrada na blockchain. Esta funcionalidade é especialmente útil em canais de estado bidirecionais e Lightning Networks, como veremos em <a href="#state_channels">[state_channels]</a>.</p>
</div>
<div class="paragraph data-line-1108">
<p>Os timelocks relativos, assim como os timelocks absolutos, são implementados tanto como um recurso a nível de transação quanto como um código operacional a nível de script. O timelock relativo a nível de transação é implementado como uma regra de consenso baseada no valor do nSequence, um campo de transação que é definido em cada entrada de transação. Os timelocks relativos a nível de script são implementados com o código operacional CHECKSEQUENCEVERIFY (CSV).</p>
</div>
<div class="paragraph data-line-1110">
<p>Os timelocks relativos são implementados de acordo com as especificações na <a href="https://github.com/bitcoin/bips/blob/master/bip-0068.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0068.mediawiki">BIP-68, Timelock relativo usando números de sequência impostos por consenso</a> e na <a href="https://github.com/bitcoin/bips/blob/master/bip-0112.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0112.mediawiki">BIP-112, CHECKSEQUENCEVERIFY</a>.</p>
</div>
<div class="paragraph data-line-1112">
<p>A BIP-68 e a BIP-112 foram ativadas em maio de 2016 como uma atualização de soft fork das regras de consenso.</p>
</div>
<div class="paragraph data-line-1114">
<p>==== Timelocks Relativos com nSequence</p>
</div>
<div class="paragraph data-line-1116">
<p>Os timelocks relativos podem ser definidos em cada entrada de uma transação, ao se definir o campo nSequence de cada entrada.</p>
</div>
<div class="paragraph data-line-1118">
<p>===== Significado original da nSequence</p>
</div>
<div class="paragraph data-line-1120">
<p>O campo nSequence foi originalmente planejado (mas nunca devidamente implementado) para permitir a modificação de transações na mempool. Nesse uso, uma transação contendo entradas com valor nSequence menor que 2<sup>32</sup> - 1 (0xFFFFFFFF) indicaria uma transação que ainda não havia sido "finalizada". Essa transação seria mantida na mempool até que fosse substituída por outra transação gastando as mesmas entradas com um valor nSequence maior. Uma vez recebida uma transação cujas entradas tivessem um valor nSequence de 0xFFFFFFFF, ela seria considerada "finalizada" e minerada.</p>
</div>
<div class="paragraph data-line-1122">
<p>O significado original do nSequence nunca foi devidamente implementado e o valor do nSequence geralmente é definido como 0xFFFFFFFF em transações que não utilizam timelocks. Para transações com nLocktime ou CHECKLOCKTIMEVERIFY, o nSequence deve ser definido para um valor menor que 2<sup>31</sup> para que as proteções do timelock tenham efeito, conforme explicado abaixo.</p>
</div>
<div class="paragraph data-line-1124">
<p>===== nSequence como um timelock relativo imposto por consenso</p>
</div>
<div class="paragraph data-line-1126">
<p>Desde a ativação da BIP-68, novas regras de consenso são aplicadas a qualquer transação contendo uma entrada cujo valor do nSequence seja menor que 2<sup>31</sup> (se o bit 1&lt;&lt;31 não for definido). Programaticamente, isso significa que se o bit mais significativo (bit 1&lt;&lt;31) não for definido, isso é um sinalizador que significa "timelock relativo". Caso contrário (se o bit 1&lt;&lt;31 for definido), o valor do nSequence é reservado para outros usos, como habilitar o CHECKLOCKTIMEVERIFY, o nLocktime, o Opt-In-Replace-By-Fee e outros desenvolvimentos futuros.</p>
</div>
<div class="paragraph data-line-1128">
<p>As entradas de transação com valores de nSequence menores que 2<sup>31</sup> são interpretadas como tendo um timelock relativo. Essa transação só será considerada válida depois que a entrada envelhecer o valor do timelock relativo. Por exemplo, uma transação com uma entrada com um nSequence definindo um timelock relativo de 30 blocos só será considerada válida quando pelo menos 30 blocos tiverem decorrido desde o momento em que a UTXO referenciada na entrada foi minerada. Visto que existe um campo nSequence em cada entrada, uma transação pode conter qualquer número de entradas com timelock, todas as quais devem ter envelhecido o suficiente para que a transação seja considerada válida. Uma transação pode incluir ao mesmo tempo entradas com timelock (nSequence &lt; 2<sup>31</sup>) e entradas sem um timelock relativo (nSequence &gt;= 2<sup>31</sup>).</p>
</div>
<div class="paragraph data-line-1130">
<p>O valor do nSequence é especificado em blocos ou segundos, mas em um formato ligeiramente diferente do que é usado no nLocktime. Um sinalizador de tipo é usado para diferenciar entre valores contando blocos e valores contando tempo em segundos. O sinalizador de tipo é definido no 23º bit menos significativo (ou seja, o valor 1&lt;&lt;22). Se o sinalizador de tipo for definido, o valor do nSequence será interpretado como um múltiplo de 512 segundos. Se o sinalizador de tipo não for definido, o valor do nSequence será interpretado como um número de blocos.</p>
</div>
<div class="paragraph data-line-1132">
<p>Ao interpretar o nSequence como um timelock relativo, apenas os 16 bits menos significativos são considerados. Uma vez que os sinalizadores (bits 32 e 23) são avaliados, o valor do nSequence é geralmente "mascarado" com uma máscara de 16 bits (por exemplo, nSequence e 0x0000FFFF).</p>
</div>
<div class="paragraph data-line-1134">
<p>A <a href="#bip_68_def_of_nseq">Definição da codificação nSequence na BIP-68 (Fonte: BIP-68)</a> mostra o layout binário do valor nSequence, conforme definido pela BIP-68.</p>
</div>
<div id="bip_68_def_of_nseq" class="imageblock data-line-1138">
<div class="content">
<img src="images/mbc2_0701.png" alt="BIP-68 definition of nSequence encoding">
</div>
<div class="title">Figure 45. Definição da codificação nSequence na BIP-68 (Fonte: BIP-68)</div>
</div>
<div class="paragraph data-line-1141">
<p>Os timelocks relativos baseados em imposição por consenso do valor nSequence são definidos na BIP-68.</p>
</div>
<div class="paragraph data-line-1143">
<p>O padrão é definido na <a href="https://github.com/bitcoin/bips/blob/master/bip-0068.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0068.mediawiki">BIP-68, Timelock relativo usando números de sequência impostos por consenso</a>.</p>
</div>
<div class="paragraph data-line-1145">
<p>==== Timelocks Relativos com CSV</p>
</div>
<div class="paragraph data-line-1147">
<p>Assim como o CLTV e o nLocktime, existe também um código operacional de script para timelocks relativos que aproveita o valor do nSequence contido em scripts. Esse código operacional é o CHECKSEQUENCEVERIFY, comumente referido como CSV.</p>
</div>
<div class="paragraph data-line-1149">
<p>O código operacional CSV, quando avaliado em um script de resgate de UTXO, permite que a UTXO seja gasta apenas em uma transação cujo valor nSequence da entrada seja maior ou igual ao parâmetro CSV. Essencialmente, isso restringe o gasto da UTXO até que um certo número de blocos ou segundos tenham decorrido em relação ao momento em que a UTXO foi minerada.</p>
</div>
<div class="paragraph data-line-1151">
<p>Tal como acontece com o CLTV, o valor no CSV deve corresponder ao formato usado no valor nSequence correspondente. Se o CSV for especificado em blocos, então o nSequence também deve ser especificado em blocos. Se o CSV for especificado em segundos, então o nSequence também deve ser especificado em segundos.</p>
</div>
<div class="paragraph data-line-1153">
<p>Os timelocks relativos com CSV são especialmente úteis quando várias transações (relacionadas entre si) são criadas e assinadas, mas não propagadas, sendo mantidas "fora da cadeia" (<em>off-chain</em>). Uma transação filha não pode ser usada até que a transação pai tenha sido propagada e minerada, e tenha envelhecido o tempo especificado no timelock relativo. Uma aplicação deste caso de uso pode ser vista em <a href="#state_channels">[state_channels]</a> e <a href="#lightning_network">[lightning_network]</a>.</p>
</div>
<div class="paragraph data-line-1155">
<p>O CSV é definido em detalhes na <a href="https://github.com/bitcoin/bips/blob/master/bip-0112.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0112.mediawiki">BIP-112, CHECKSEQUENCEVERIFY</a>.</p>
</div>
<div class="paragraph data-line-1158">
<p>==== Median-Time-Past</p>
</div>
<div class="paragraph data-line-1160">
<p>Como parte da ativação dos timelocks relativos, houve também uma mudança na forma como o tempo é calculado para os timelocks (absolutos e relativos). No bitcoin, há uma diferença sutil, mas muito significativa, entre o horário real (horário no relógio de parede) e o horário de consenso. O bitcoin é uma rede descentralizada, o que significa que cada participante tem sua própria perspectiva de tempo. Os eventos na rede não ocorrem instantaneamente em todos os lugares. A latência da rede deve ser levada em consideração na perspectiva de cada nó. No final, todas as informações são sincronizadas para criar um livro-razão comum. A cada 10 minutos, o bitcoin chega a um consenso sobre qual era o estado do livro-razão no <em>passado</em>.</p>
</div>
<div class="paragraph data-line-1162">
<p>Os carimbos de data e hora definidos nos cabeçalhos dos blocos são definidos pelos mineradores. As regras de consenso permitem um certo grau de liberdade para os mineradores, para considerar as diferenças que existem na precisão dos relógios dos nós descentralizados. No entanto, isso infelizmente cria um incentivo para os mineradores mentirem sobre o horário em que um bloco foi minerado, a fim de ganharem taxas extras ao incluírem transações com timelocks que ainda não amadureceram. Veja a seção a seguir para obter mais informações.</p>
</div>
<div class="paragraph data-line-1164">
<p>Para remover o incentivo que existe para os mineradores mentirem e para fortalecer a segurança dos timelocks, uma BIP foi proposta e ativada ao mesmo tempo que as BIPs para os timelocks relativos. Ela é a BIP-113, que define uma nova medida de consenso de horário, a chamada <em>Median-Time-Past</em>.</p>
</div>
<div class="paragraph data-line-1166">
<p>A <em>Median-Time-Past</em> (em português, <em>Mediana-do-Horário-do-Passado</em>) é calculada obtendo-se os registros de data e hora dos últimos 11 blocos e encontrando-se a mediana. Esse horário mediano então se torna o horário de consenso e é usado para todos os cálculos de timelock. Ao tomar o ponto médio de aproximadamente duas horas no passado, a influência do registro de data e hora de qualquer bloco isolado é reduzida. Ao incorporar 11 blocos, nenhum minerador consegue influenciar sozinho os registros de data e hora a fim de ganhar taxas de transações com timelocks que ainda não amadureceram.</p>
</div>
<div class="paragraph data-line-1168">
<p>A Median-Time-Past altera a implementação de cálculos de hora para o nLocktime, o CLTV, o nSequence e o CSV. O horário de consenso calculado pela Median-Time-Past está sempre aproximadamente uma hora atrasado em relação ao horário real (do relógio). Se você for criar transações com timelock, você deverá levar isso em consideração ao estimar o valor desejado para codificar no nLocktime, nSequence, CLTV e CSV.</p>
</div>
<div class="paragraph data-line-1170">
<p>A Median-Time-Past é especificada na <a href="https://github.com/bitcoin/bips/blob/master/bip-0113.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0113.mediawiki">BIP-113</a>.</p>
</div>
<div id="fee_sniping" class="paragraph data-line-1173">
<p>==== Timelock como Proteção contra Sniping de Taxas</p>
</div>
<div class="paragraph data-line-1175">
<p>O <em>sniping</em> de taxas é um cenário de ataque teórico, no qual mineradores tentando reescrever blocos anteriores incluem transações com taxas maiores de blocos futuros, com o objetivo de maximizar os seus lucros.</p>
</div>
<div class="paragraph data-line-1177">
<p>Por exemplo, digamos que o bloco mais alto existente seja o bloco nº100.000. Imagine que, em vez de tentar minerar o bloco nº100.001 para estender a cadeia, alguns mineradores tentem reminerar o bloco nº100.000. Esses mineradores podem decidir incluir qualquer transação válida (que ainda não foi minerada) em seu bloco candidato nº100.000. Eles não precisam refazer o bloco com as mesmas transações. Na verdade, eles têm um incentivo para escolher as transações mais lucrativas (com a maior taxa por KB) para incluir em seu bloco. Eles podem incluir quaisquer transações que estavam no bloco "antigo" nº100.000, bem como quaisquer transações que estejam na mempool atual. Essencialmente, ao recriarem o bloco nº100.000, eles têm a possibilidade de puxar as transações do "presente" para o "passado" reescrito.</p>
</div>
<div class="paragraph data-line-1179">
<p>Hoje, esse ataque não é muito lucrativo, pois a recompensa do bloco é muito maior do que as taxas totais por bloco. Mas, em algum momento no futuro, as taxas de transação constituirão a maior parte da recompensa da mineração (ou mesmo a totalidade da recompensa da mineração). Nesse momento, esse cenário se tornará inevitável.</p>
</div>
<div class="paragraph data-line-1181">
<p>Para prevenir o "<em>sniping</em> de taxas", quando o Bitcoin Core cria transações, ele usa o nLocktime para limitá-las ao "próximo bloco", por padrão. Em nosso cenário, o Bitcoin Core definiria o nLocktime como 100.001 em qualquer transação criada. Em circunstâncias normais, este nLocktime não tem efeito&#x2014; de qualquer maneira, as transações só poderiam ser incluídas no bloco nº100.001, pois ele é o próximo bloco.</p>
</div>
<div class="paragraph data-line-1183">
<p>Mas sob um ataque de fork/gasto duplo, os mineradores não seriam capazes de incluir as transações da mempool que tem taxas altas, pois todas essas transações teriam um <em>timelock</em> para o bloco nº100.001. Eles só conseguiriam reminerar o bloco nº100.000 com quaisquer transações que fossem válidas naquele momento no passado, ou seja, eles não ganhariam novas taxas.</p>
</div>
<div class="paragraph data-line-1185">
<p>Para obter essa proteção, o Bitcoin Core define o nLocktime em todas as novas transações como &lt;nº do bloco atual + 1&gt; e define o nSequence em todas as entradas como 0xFFFFFFFE para ativar o nLocktime.</p>
</div>
<div class="paragraph data-line-1187">
<p>=== Scripts com Controle de Fluxo (Cláusulas Condicionais)</p>
</div>
<div class="paragraph data-line-1189">
<p>Um dos recursos mais poderosos do Bitcoin Script é o controle de fluxo, também conhecido como cláusulas condicionais. Você provavelmente está familiarizado com o controle de fluxo em várias linguagens de programação que usam a construção IF...THEN...ELSE. As cláusulas condicionais do bitcoin podem parecer um pouco diferentes, mas são essencialmente a mesma construção.</p>
</div>
<div class="paragraph data-line-1191">
<p>Em um nível básico, os códigos operacionais condicionais do bitcoin nos permitem construir um script de resgate que tenha duas maneiras de ser destravado, dependendo de um resultado TRUE/FALSE (verdadeiro/falso) da avaliação de uma condição lógica. Por exemplo, se (IF) x for verdadeiro (TRUE), o script de resgate será A, caso contrário (ELSE), o script de resgate será B.</p>
</div>
<div class="paragraph data-line-1193">
<p>Além disso, as expressões condicionais do bitcoin podem ser "aninhadas" indefinidamente, o que significa que uma cláusula condicional pode conter outra dentro dela, que contém outra, etc. O controle de fluxo do Bitcoin Script pode ser usado para construir scripts muito complexos com centenas ou mesmo milhares de caminhos de execução possíveis. Não há limite para o aninhamento, mas as regras de consenso impõem um limite no tamanho máximo, em bytes, de um script.</p>
</div>
<div class="paragraph data-line-1195">
<p>O bitcoin implementa o controle de fluxo usando os códigos operacionais IF, ELSE, ENDIF e NOTIF. Além disso, as expressões condicionais podem conter operadores booleanos, como BOOLAND, BOOLOR e NOT.</p>
</div>
<div class="paragraph data-line-1197">
<p>À primeira vista, você pode achar os scripts de controle de fluxo do bitcoin confusos. Isso ocorre porque o Bitcoin Script é uma linguagem de pilha. Da mesma forma que 1 {plus} 1 parece "invertido" quando expresso como 1 1 ADD, as cláusulas de controle de fluxo do bitcoin também parecem que estão "invertidas".</p>
</div>
<div class="paragraph data-line-1199">
<p>Na maioria das linguagens de programação tradicionais (procedurais), o controle de fluxo tem a seguinte aparência:</p>
</div>
<div class="listingblock data-line-1202">
<div class="title">Pseudocódigo do controle de fluxo na maioria das linguagens de programação</div>
<div class="content">
<pre>if ("se", condição):
  código a ser executado quando a condição for verdadeira
else ("caso contrário"):
  código a ser executado quando a condição for falsa
código a ser executado em qualquer caso</pre>
</div>
</div>
<div class="paragraph data-line-1210">
<p>Em uma linguagem baseada em pilha como o Bitcoin Script, a condição lógica vem antes do IF, o que faz com que ela aparente estar "invertida", dessa maneira:</p>
</div>
<div class="listingblock data-line-1213">
<div class="title">Controle de fluxo no Bitcoin Script</div>
<div class="content">
<pre>condição
IF
  código a ser executado quando a condição for verdadeira
ELSE
  código a ser executado quando a condição for falsa
ENDIF
código a ser executado em qualquer caso</pre>
</div>
</div>
<div class="paragraph data-line-1223">
<p>Ao ler o Bitcoin Script, lembre-se de que a condição avaliada vem <em>antes</em> do código operacional IF.</p>
</div>
<div class="paragraph data-line-1225">
<p>==== Cláusulas Condicionais com Códigos Operacionais VERIFY</p>
</div>
<div class="paragraph data-line-1227">
<p>Outra forma de condicional no Bitcoin Script é qualquer código operacional que termina em VERIFY. O sufixo VERIFY significa que se a condição avaliada não for TRUE (verdadeira), a execução do script é imediatamente encerrada e a transação é considerada inválida.</p>
</div>
<div class="paragraph data-line-1229">
<p>Ao contrário de uma cláusula IF, que oferece caminhos de execução alternativos, o sufixo VERIFY atua como uma <em>cláusula de proteção</em>, continuando apenas se uma pré-condição for atendida.</p>
</div>
<div class="paragraph data-line-1231">
<p>Por exemplo, o script a seguir requer a assinatura do Bob e uma pré-imagem (um segredo) que produz um hash específico. Ambas as condições devem ser satisfeitas para destravá-lo:</p>
</div>
<div class="listingblock data-line-1234">
<div class="title">Um script de resgate com uma cláusula de proteção EQUALVERIFY.</div>
<div class="content">
<pre>HASH160 &lt;hash esperado&gt; EQUALVERIFY &lt;Chave Pública do Bob&gt; CHECKSIG</pre>
</div>
</div>
<div class="paragraph data-line-1238">
<p>Para resgatá-lo, o Bob deve construir um script de destravamento que apresente uma pré-imagem válida e uma assinatura:</p>
</div>
<div class="listingblock data-line-1241">
<div class="title">Um script de destravamento para satisfazer o script de resgate acima</div>
<div class="content">
<pre>&lt;Assinatura do Bob&gt; &lt;hash da pré-imagem&gt;</pre>
</div>
</div>
<div class="paragraph data-line-1245">
<p>Sem apresentar a pré-imagem, Bob não consegue chegar à parte do script que verifica sua assinatura.</p>
</div>
<div class="paragraph pagebreak-after data-line-1248">
<p>Este script também poderia ser escrito com um IF:</p>
</div>
<div class="listingblock data-line-1251">
<div class="title">Um script de resgate com uma cláusula de proteção IF</div>
<div class="content">
<pre>HASH160 &lt;hash esperado&gt; EQUAL
IF
   &lt;Chave pública do Bob&gt; CHECKSIG
ENDIF</pre>
</div>
</div>
<div class="paragraph data-line-1258">
<p>O script de destravamento do Bob é idêntico:</p>
</div>
<div class="listingblock data-line-1261">
<div class="title">Um script de destravamento para satisfazer o script de resgate acima</div>
<div class="content">
<pre>&lt;Assinatura do Bob&gt; &lt;hash da pré-imagem&gt;</pre>
</div>
</div>
<div class="paragraph data-line-1265">
<p>O script com o IF faz a mesma coisa que usar um código operacional com um sufixo VERIFY; ambos funcionam como cláusulas de proteção. No entanto, a construção com o VERIFY é mais eficiente, pois usa dois códigos operacionais a menos.</p>
</div>
<div class="paragraph data-line-1267">
<p>Então, quando devemos usar o VERIFY e quando devemos usar  o IF? Se tudo o que estamos tentando fazer é anexar uma pré-condição (uma cláusula de proteção), então é melhor usarmos o VERIFY. Se, entretanto, quisermos ter mais de um caminho de execução (um controle de fluxo), então precisamos de uma cláusula de controle de fluxo IF...ELSE.</p>
</div>
<div class="admonitionblock tip data-line-1270">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1271">
<p>Um código operacional como o EQUAL adicionará o resultado (TRUE/FALSE) na pilha, deixando-o lá para ser avaliado por códigos operacionais subsequentes. Em contraste, o sufixo de código operacional EQUALVERIFY não deixa nada na pilha. Os códigos operacionais que terminam em VERIFY não deixam o resultado na pilha.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1274">
<p>==== Usando Controle de Fluxo em Scripts</p>
</div>
<div class="paragraph data-line-1276">
<p>Um uso muito comum para o controle de fluxo no Bitcoin Script é construir um script de resgate que oferece vários caminhos de execução, cada um com uma maneira diferente de resgatar a UTXO.</p>
</div>
<div class="paragraph data-line-1278">
<p>Vejamos um exemplo simples, em que temos dois signatários, a Alice e o Bob, e qualquer um deles pode resgatar. Com a funcionalidade de multiassinatura, isso seria expresso como um script multiassinatura 1-de-2. Para fins de demonstração, faremos a mesma coisa com uma cláusula IF:</p>
</div>
<div class="listingblock data-line-1280">
<div class="content">
<pre>IF
 &lt;Chave Pública da Alice&gt; CHECKSIG
ELSE
 &lt;Chave pública do Bob&gt; CHECKSIG
ENDIF</pre>
</div>
</div>
<div class="paragraph data-line-1288">
<p>Olhando para este script de resgate, você pode estar se perguntando: "Onde está a condição? Não há nada antes da cláusula IF!"</p>
</div>
<div class="paragraph data-line-1290">
<p>A condição não faz parte do script de resgate. Em vez disso, a condição será oferecida no script de destravamento, permitindo que a Alice e o Bob "escolham" o caminho de execução que eles quiserem.</p>
</div>
<div class="paragraph data-line-1292">
<p>A Alice resgata a UTXO com o seguinte script de destravamento:</p>
</div>
<div class="listingblock data-line-1293">
<div class="content">
<pre>&lt;Assinatura da Alice&gt; 1</pre>
</div>
</div>
<div class="paragraph data-line-1297">
<p>O 1 no final serve como a condição (TRUE) que fará com que a cláusula IF execute o primeiro caminho de resgate, para o qual a Alice tem uma assinatura.</p>
</div>
<div class="paragraph data-line-1299">
<p>Para que o Bob resgatasse a UTXO, ele teria que escolher o segundo caminho de execução atribuindo um valor FALSE à cláusula IF:</p>
</div>
<div class="listingblock data-line-1301">
<div class="content">
<pre>&lt;Assinatura do Bob&gt; 0</pre>
</div>
</div>
<div class="paragraph data-line-1305">
<p>O script de destravamento do Bob coloca um 0 na pilha, fazendo com que a cláusula IF execute o segundo script (ELSE), que requer a assinatura de Bob.</p>
</div>
<div class="paragraph data-line-1307">
<p>Como as cláusulas IF podem ser aninhadas, podemos criar um "labirinto" de caminhos de execução. O script de destravamento pode fornecer um "mapa" selecionando qual caminho de execução é de fato executado:</p>
</div>
<div class="listingblock data-line-1309">
<div class="content">
<pre>IF
  script A
ELSE
  IF
    script B
  ELSE
    script C
  ENDIF
ENDIF</pre>
</div>
</div>
<div class="paragraph data-line-1321">
<p>Nesse cenário, há três caminhos de execução (script A, script B e script C). O script de destravamento fornece um caminho na forma de uma sequência de valores TRUE ou FALSE. Para selecionar o caminho script B, por exemplo, o script de destravamento deve terminar em 1 0 (TRUE, FALSE). Esses valores serão adicionados na pilha, de modo que o segundo valor (FALSE) termine no topo da pilha. A cláusula IF externa remove o valor FALSE da pilha e executa a primeira cláusula ELSE. Em seguida, o valor TRUE é movido para o topo da pilha e é avaliado pelo IF interno (aninhado), selecionando o caminho de execução B.</p>
</div>
<div class="paragraph data-line-1323">
<p>Usando essa construção, podemos fazer scripts de resgate com dezenas ou centenas de caminhos de execução, cada um oferecendo uma maneira diferente de resgatar a UTXO. Para gastar, construímos um script de destravamento que navega pelo caminho de execução, colocando os valores TRUE e FALSE apropriados na pilha em cada ponto de controle de fluxo. </p>
</div>
<div class="paragraph data-line-1325">
<p>=== Exemplo de Script Complexo</p>
</div>
<div class="paragraph data-line-1327">
<p>Nesta seção combinaremos muitos dos conceitos deste capítulo em um único exemplo.</p>
</div>
<div class="paragraph data-line-1329">
<p>Nosso exemplo usa a história do Mohammed, o proprietário da empresa de Dubai que opera um negócio de importação/exportação.</p>
</div>
<div class="paragraph data-line-1331">
<p>Neste exemplo, o Mohammed deseja construir uma conta de capital da empresa com regras flexíveis. O esquema que ele está criando requer diferentes níveis de autorização dependendo dos timelocks. Os participantes do esquema multiassinatura são o Mohammed, seus dois sócios Saeed e Zaira, e o advogado da empresa, o Abdul. Os três sócios tomam decisões com base na regra da maioria, portanto, dois dos três devem concordar. No entanto, caso haja algum problema com suas chaves, eles querem que seu advogado possa recuperar os fundos com uma assinatura dos três sócios. Finalmente, se todos os sócios estiverem indisponíveis ou incapacitados por um tempo, eles querem que o advogado possa administrar a conta diretamente.</p>
</div>
<div class="paragraph data-line-1333">
<p>A seguir está o script de resgate que o Mohammed desenvolveu para o seu esquema multiassinatura (os números no início de cada linha correspondem ao número da linha no script):</p>
</div>
<div class="listingblock data-line-1336">
<div class="title">Multiassinatura Variável com Timelock</div>
<div class="content">
<pre>01  IF
02    IF
03      2
04    ELSE
05      &lt;30 dias&gt; CHECKSEQUENCEVERIFY DROP
06      &lt;Chave Pública do Advogado Abdul&gt; CHECKSIGVERIFY
07      1
08    ENDIF
09    &lt;Chave Pública do Mohammed&gt; &lt;Chave Pública do Saeed&gt; &lt;Chave Pública da Zaira&gt; 3 CHECKMULTISIG
10  ELSE
11    &lt;90 dias&gt; CHECKSEQUENCEVERIFY DROP
12    &lt;Chave Pública do Advogado Abdul&gt; CHECKSIG
13  ENDIF</pre>
</div>
</div>
<div class="paragraph data-line-1352">
<p>O script do Mohammed implementa três caminhos de execução usando cláusulas de controle de fluxo IF...ELSE aninhadas.</p>
</div>
<div class="paragraph data-line-1354">
<p>No primeiro caminho de execução, este script opera como uma multiassinatura 2-de-3 simples com os três sócios. Este caminho de execução consiste nas linhas 3 e 9. A linha 3 define o quórum da multiassinatura para 2 (2-de-3). Este caminho de execução pode ser selecionado colocando-se TRUE TRUE no final do script de destravamento:</p>
</div>
<div class="listingblock data-line-1357">
<div class="title">Script de destravamento para o primeiro caminho de execução (multiassinatura 2-de-3)</div>
<div class="content">
<pre>0 &lt;Assinatura do Mohammed&gt; &lt;Assinatura da Zaira&gt; TRUE TRUE</pre>
</div>
</div>
<div class="admonitionblock tip data-line-1363">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1364">
<p>O 0 no início deste script de destravamento é devido a um bug no CHECKMULTISIG que remove um valor extra da pilha. O valor extra é desconsiderado pelo CHECKMULTISIG, mas ele deve estar presente, caso contrário o script falhará. Uma solução para contornar o bug geralmente consiste em adicionar um 0, conforme descrito em <a href="#multisig_bug">[multisig_bug]</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1367">
<p>O segundo caminho de execução só pode ser usado 30 dias após a criação da UTXO. Após passados esses 30 dias, ele exigirá a assinatura do advogado Abdul e a assinatura de um dos três sócios (uma multiassinatura 1-de-3). Isso é realizado na linha 7 do script, que define o quórum da multiassinatura para 1. Para selecionar este caminho de execução, o script de destravamento terminaria em FALSE TRUE:</p>
</div>
<div class="listingblock data-line-1370">
<div class="title">Script de destravamento para o segundo caminho de execução (advogado + 1-de-3)</div>
<div class="content">
<pre>0 &lt;Assinatura do Advogado Abdul&gt; &lt;Assinatura do Saeed&gt; FALSE TRUE</pre>
</div>
</div>
<div class="admonitionblock tip data-line-1375">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1376">
<p>Por que FALSE TRUE? Isso não está invertido? Isso acontece porque os dois valores são adicionados na pilha, o FALSE sendo adicionado primeiro e o TRUE sendo adicionado em seguida. O TRUE é, portanto, o <em>primeiro</em> valor a ser removido pelo primeiro código operacional IF.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1379">
<p>Por fim, o terceiro caminho de execução permite que o Abdul, o advogado, gaste os fundos sozinho, mas somente após 90 dias. Para selecionar este caminho de execução, o script de destravamento deve terminar em FALSE:</p>
</div>
<div class="listingblock data-line-1382">
<div class="title">Script de destravamento para o terceiro caminho de execução (apenas o advogado)</div>
<div class="content">
<pre>&lt;Assinatura do Advogado Abdul&gt; FALSE</pre>
</div>
</div>
<div class="paragraph data-line-1386">
<p>Tente executar o script no papel para ver como ele se comporta na pilha.</p>
</div>
<div class="paragraph data-line-1388">
<p>Mais algumas coisas a serem consideradas ao ler este exemplo. Veja se você consegue encontrar as respostas:</p>
</div>
<div class="ulist data-line-1390">
<ul>
<li class="data-line-1390">
<p>Por que o advogado não pode resgatar o terceiro caminho de execução a qualquer momento, selecionando-o com FALSE no script de destravamento?</p>
</li>
<li class="data-line-1392">
<p>Quantos caminhos de execução podem ser usados 5, 35 e 105 dias, respectivamente, após a UTXO ser minerada?</p>
</li>
<li class="data-line-1394">
<p>Os fundos são perdidos se o advogado perder a chave? Sua resposta mudaria caso 91 dias se passaram?</p>
</li>
<li class="data-line-1396">
<p>De que maneira os sócios "zeram" o relógio a cada 29 ou 89 dias para prevenir que o advogado acesse os fundos?</p>
</li>
<li class="data-line-1398">
<p>Por que alguns códigos operacionais CHECKSIG neste script têm o sufixo VERIFY e outros não?</p>
</li>
</ul>
</div>
<div id="segwit" class="paragraph data-line-1401">
<p>=== Segregated Witness (Testemunha Segregada)</p>
</div>
<div class="paragraph data-line-1403">
<p>A Segregated Witness ou segwit (em português, Testemunha Segregada) é uma atualização para as regras de consenso do bitcoin e para o protocolo da rede, que foi proposta e implementada como um soft-fork BIP-9, o qual foi ativado na rede principal do bitcoin em 1º de agosto de 2017.</p>
</div>
<div class="paragraph data-line-1405">
<p>Na criptografia, o termo "testemunha" (em inglês, <em>witness</em>) é usado para descrever uma solução para um quebra-cabeça criptográfico. Em termos de bitcoin, a testemunha satisfaz uma condição criptográfica colocada em uma saída de transação não gasta (UTXO).</p>
</div>
<div class="paragraph data-line-1407">
<p>No contexto do bitcoin, uma assinatura digital é <em>um tipo de testemunha</em>, mas uma testemunha é mais amplamente qualquer solução que seja capaz de satisfazer as condições impostas a uma UTXO e de destravar essa UTXO para ser gasta. O termo "testemunha" é um termo mais geral para um "script de destravamento" ou "scriptSig".</p>
</div>
<div class="paragraph data-line-1409">
<p>Antes da introdução da segwit, cada entrada em uma transação era seguida pelos dados de testemunha que a destravavam. Os dados de testemunha eram incorporados à transação como parte de cada entrada. Portanto, "<em>testemunha segregada</em>" nada mais é do que separar (segregar) a assinatura ou o script de destravamento de uma saída específica. Para simplificar, pense como se fosse um "scriptSig separado" ou uma "assinatura separada".</p>
</div>
<div class="paragraph data-line-1411">
<p>A Segregated Witness, portanto, é uma mudança arquitetônica para o bitcoin que visa mover os dados de testemunha do campo scriptSig (script de destravamento) de uma transação para uma estrutura separada de dados de <em>testemunha</em> que acompanha uma transação. Os clientes podem solicitar dados de transações com ou sem os dados de testemunha que as acompanham.</p>
</div>
<div class="paragraph data-line-1413">
<p>Nesta seção, veremos alguns dos benefícios da Segregated Witness, descreveremos o mecanismo usado para implantar e implementar essa mudança de arquitetura, assim como demonstraremos o uso da Segregated Witness em transações e endereços.</p>
</div>
<div class="paragraph data-line-1415">
<p>A Segregated Witness é definida pelas seguintes BIPs:</p>
</div>
<div class="dlist data-line-1417">
<dl>
<dt class="hdlist1"><a href="https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki">BIP-141</a> </dt>
<dd>
<p>A definição principal da Segregated Witness.</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/bitcoin/bips/blob/master/bip-0143.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0143.mediawiki">BIP-143</a> </dt>
<dd>
<p>Verificação de Assinatura de Transação para o Programa de Testemunha Versão 0</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/bitcoin/bips/blob/master/bip-0144.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0144.mediawiki">BIP-144</a> </dt>
<dd>
<p>Serviços de Par&#x2014;Novas mensagens de rede e formatos de serialização</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/bitcoin/bips/blob/master/bip-0145.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0145.mediawiki">BIP-145</a> </dt>
<dd>
<p>Atualizações do getblocktemplate para a Segregated Witness (para mineração)</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/bitcoin/bips/blob/master/bip-0173.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0173.mediawiki">BIP-173</a></dt>
<dd>
<p>Formato de endereço Base32 para saídas de testemunha v0-16 nativas</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-1428">
<p>==== Por que a Segregated Witness foi Implementada?</p>
</div>
<div class="paragraph data-line-1430">
<p>A Segregated Witness é uma mudança arquitetônica que tem vários efeitos sobre a escalabilidade, a segurança, os incentivos econômicos e o desempenho do bitcoin:</p>
</div>
<div class="dlist data-line-1432">
<dl>
<dt class="hdlist1">Maleabilidade de transação </dt>
<dd>
<p>Ao mover a testemunha para fora dos dados da transação, o hash de transação, que é usado como um identificador, deixa de incluir os dados de testemunha. Como os dados de testemunha são a única parte da transação que pode ser modificada por terceiros (ver <a href="#segwit_txid">[segwit_txid]</a>), removê-los também remove a oportunidade para ataques de maleabilidade de transação. Com a Segregated Witness, os hashes de transação tornam-se imutáveis para qualquer pessoa que não seja o criador da transação, o que representa um grande avanço na implementação de muitos outros protocolos que dependem da construção de transações de bitcoin avançadas, como canais de pagamento, transações encadeadas e redes lightning.</p>
</dd>
<dt class="hdlist1">Controle de Versão de Script </dt>
<dd>
<p>Com a introdução de scripts de Segregated Witness, cada script de travamento é precedido por um número de <em>versão de script</em>, semelhante à maneira como as transações e os blocos têm números de versão. A adição de um número de versão de script permite que a linguagem de script seja atualizada de maneira compatível com versões anteriores (ou seja, usando atualizações de soft fork) para introduzir novos operandos, sintaxe ou semântica de script. A capacidade de atualizar a linguagem de script de uma forma não disruptiva aumentará bastante a velocidade de inovação do bitcoin.</p>
</dd>
<dt class="hdlist1">Escalabilidade da Rede e do Armazenamento </dt>
<dd>
<p>Os dados de testemunha geralmente contribuem bastante para o tamanho total de uma transação. Scripts mais complexos, como aqueles usados para multiassinaturas ou canais de pagamento, são muito grandes. Em alguns casos, esses scripts respondem pela maioria (mais de 75%) dos dados em uma transação. Ao mover os dados de testemunha para fora dos dados da transação, a Segregated Witness melhora a escalabilidade do bitcoin. Os nós podem remover os dados de testemunha após validar as assinaturas ou ignorá-los completamente, caso eles façam a verificação de pagamento simplificada. Os dados de testemunha não precisam ser transmitidos para todos os nós e não precisam ser armazenados no disco por todos os nós.</p>
</dd>
<dt class="hdlist1">Otimização da Verificação de Assinatura </dt>
<dd>
<p>A Segregated Witness atualiza as funções de assinatura (CHECKSIG, CHECKMULTISIG, etc.) para reduzir a complexidade computacional do algoritmo. Antes da segwit, o algoritmo usado para produzir uma assinatura exigia um número de operações de hash que era proporcional ao tamanho da transação. Os cálculos de <em>hashing</em> dos dados aumentavam em O(n<sup>2</sup>) em relação ao número de operações de assinatura, introduzindo uma carga computacional substancial em todos os nós que verificam a assinatura. Com a segwit, o algoritmo foi alterado para reduzir a complexidade para O(n).</p>
</dd>
<dt class="hdlist1">Melhoria na Assinatura Offline </dt>
<dd>
<p>As assinaturas da Segregated Witness incorporam o valor (quantia) referenciado por cada entrada no hash que é assinado. Antes disso, um dispositivo de assinatura offline, como uma carteira de hardware, tinha que verificar a quantia de cada entrada antes de assinar uma transação. Isso geralmente era feito através de um streaming de uma grande quantidade de dados contendo informações sobre as transações prévias referenciadas como entradas. Como a quantia agora faz parte do hash de compromisso que é assinado, um dispositivo offline não precisa mais das transações prévias. Se as quantias não corresponderem (se elas forem adulteradas por um sistema online comprometido), a assinatura será inválida.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-1442">
<p>==== Como Funciona a Segregated Witness</p>
</div>
<div class="paragraph data-line-1444">
<p>À primeira vista, a Segregated Witness parece ser uma mudança na forma como as transações são construídas e, portanto, um recurso a nível de transação, mas ela não é. Em vez disso, a  Segregated Witness é uma mudança na forma como a UTXO individual é gasta e, portanto, é um recurso a nível de cada saída individual.</p>
</div>
<div class="paragraph data-line-1446">
<p>Uma transação pode gastar saídas da Segregated Witness, saídas tradicionais (testemunha em linha) ou ambas. Portanto, não faz muito sentido se referir a uma transação como uma "transação de Segregated Witness". Em vez disso, devemos nos referir a saídas de transação específicas como "saídas de Segregated Witness" ou "saídas com testmunha segregada".</p>
</div>
<div class="paragraph data-line-1448">
<p>Quando uma transação gasta uma UTXO, ela deve fornecer uma testemunha. Em uma UTXO tradicional, o script de travamento requer que os dados de testemunha sejam fornecidos <em>em linha</em> na entrada da transação que gasta a UTXO. Uma UTXO de Segregated Witness, entretanto, especifica um script de travamento que pode ser satisfeito com dados de testemunha que estejam fora da entrada (que estejam segregados da entrada).</p>
</div>
<div class="paragraph data-line-1450">
<p>==== Soft Fork (Retrocompatibilidade)</p>
</div>
<div class="paragraph data-line-1452">
<p>Segregated Witness is a significant change to the way outputs and transactions are architected. Such a change would normally require a simultaneous change in every Bitcoin node and wallet to change the consensus rules&#x2014;what is known as a hard fork. Instead, segregated witness is introduced with a much less disruptive change, which is backward compatible, known as a soft fork. This type of upgrade allows non-upgraded software to ignore the changes and continue to operate without any disruption.</p>
</div>
<div class="paragraph data-line-1454">
<p>As saídas de Segregated Witness são construídas de forma que elas ainda possam ser validadas por sistemas mais antigos que não reconhecem a segwit. Para uma carteira ou nó antigo, uma saída de Segregated Witness parece ser uma saída que <em>qualquer pessoa pode gastar</em>. Essas saídas podem ser gastas com uma assinatura vazia, portanto, o fato de não haver assinatura dentro da transação (a assinatura é segregada) não invalida a transação. Carteiras e nós de mineração mais novos, no entanto, veem a saída de Segregated Witness e esperam encontrar uma testemunha válida para ela nos dados de testemunha da transação.</p>
</div>
<div class="paragraph data-line-1456">
<p>==== Exemplos de Saída e de Transação com Segregated Witness</p>
</div>
<div class="paragraph data-line-1458">
<p>Vamos dar uma olhada em algumas de nossas transações de exemplo para ver como elas mudariam com a Segregated Witness. Veremos primeiro como um pagamento Pay-to-Public-Key-Hash (P2PKH) é transformado com o programa da Segregated Witness. Em seguida, veremos o equivalente da Segregated Witness para os scripts Pay-to-Script-Hash (P2SH). Finalmente, veremos como ambos os programas de Segregated Witness descritos acima podem ser incorporados a um script P2SH.</p>
</div>
<div id="p2wpkh" class="paragraph data-line-1461">
<p>===== Pay-to-Witness-Public-Key-Hash (P2WPKH)</p>
</div>
<div class="paragraph data-line-1463">
<p>Em <a href="#cup_of_coffee">[cup_of_coffee]</a>, a Alice criou uma transação para pagar ao Bob por uma xícara de café. Essa transação criou uma saída P2PKH com um valor de 0,015 BTC que poderia ser gasto pelo Bob. O script da saída é semelhante a este:</p>
</div>
<div class="listingblock data-line-1466">
<div class="title">Exemplo de script de saída P2PKH</div>
<div class="content">
<pre>DUP HASH160 ab68025513c3dbd2f7b92a94e0581f5d50f654e7 EQUALVERIFY CHECKSIG</pre>
</div>
</div>
<div class="paragraph data-line-1470">
<p>Com a Segregated Witness, a Alice criaria um script Pay-to-Witness-Public-Key-Hash (P2WPKH) (em português, Paga-para-Testemunha-de-Hash-de-Chave-Pública), que ficaria assim:</p>
</div>
<div class="listingblock data-line-1473">
<div class="title">Exemplo de script de saída P2WPKH</div>
<div class="content">
<pre>0 ab68025513c3dbd2f7b92a94e0581f5d50f654e7</pre>
</div>
</div>
<div class="paragraph data-line-1477">
<p>As you can see, a Segregated Witness output’s locking script is much simpler than a traditional output. It consists of two values that are pushed on to the script evaluation stack. To an old (nonsegwit-aware) Bitcoin client, the two pushes would look like an output that anyone can spend and does not require a signature (or rather, can be spent with an empty signature). To a newer, segwit-aware client, the first number (0) is interpreted as a version number (the <em>witness version</em>) and the second part (20 bytes) is the equivalent of a locking script known as a <em>witness program</em>. The 20-byte witness program is simply the hash of the public key, as in a P2PKH script.</p>
</div>
<div class="paragraph data-line-1479">
<p>Agora, vamos examinar a transação correspondente que o Bob usa para gastar essa saída. Para o script original (não segwit), a transação do Bob teria que incluir uma assinatura na entrada de transação:</p>
</div>
<div class="listingblock data-line-1482">
<div class="title">Transação decodificada mostrando uma saída P2PKH sendo gasta com uma assinatura</div>
<div class="content">
<pre>[...]
“Vin” : [
"txid": "0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2",
"vout": 0,
     	 "scriptSig": “&lt;scriptSig do Bob&gt;”,
]
[...]</pre>
</div>
</div>
<div class="paragraph data-line-1492">
<p>No entanto, para gastar a saída de Segregated Witness, a transação não tem uma assinatura na parte da entrada. Em vez disso, a transação do Bob tem um scriptSig vazio nos dados da transação (a primeira parte de uma transação, que inclui a parte da entrada) e inclui sua assinatura nos dados de testemunha (a segunda parte de uma transação, que é separada dos dados da transação):</p>
</div>
<div class="listingblock data-line-1495">
<div class="title">Transação decodificada mostrando uma saída P2WPKH sendo gasta com dados de testemunha separados</div>
<div class="content">
<pre>[...]
“Vin” : [
"txid": "0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2",
"vout": 0,
     	 "scriptSig": “”,
]
[...]
“witness”: “&lt;dados de testemunha do Bob&gt;”
[...]</pre>
</div>
</div>
<div class="paragraph data-line-1507">
<p>===== Construção do P2WPKH pela carteira</p>
</div>
<div class="paragraph data-line-1509">
<p>É extremamente importante observar que o P2WPKH só deve ser criado pelo beneficiário (destinatário) e que ele não deve ser convertido pelo remetente a partir de uma chave pública, um script P2PKH ou um endereço conhecido. O destinatário não tem como saber se a carteira do remetente tem a capacidade de construir transações segwit e de gastar saídas P2WPKH.</p>
</div>
<div class="paragraph data-line-1511">
<p>Além disso, as saídas P2WPKH devem ser construídas a partir do hash de uma chave pública <em>comprimida</em>. As chaves públicas não comprimidas não fazem parte do padrão segwit e podem ser explicitamente desabilitadas por um soft fork no futuro. Se o hash usado no P2WPKH vier de uma chave pública não comprimida, ele pode não ser gastável e você pode acabar perdendo os seus fundos. As saídas P2WPKH devem ser criadas pela carteira do beneficiário ao se derivar uma chave pública comprimida a partir de sua chave privada.</p>
</div>
<div class="admonitionblock warning data-line-1514">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-1515">
<p>P2WPKH should be constructed by the payee (recipient) by converting a compressed public key to a P2WPKH hash. You should never transform a P2PKH script, Bitcoin address, or uncompressed public key to a P2WPKH witness script.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="p2wsh" class="paragraph data-line-1519">
<p>===== Pay-to-Witness-Script-Hash (P2WSH)</p>
</div>
<div class="paragraph data-line-1521">
<p>O segundo tipo de programa de testemunha corresponde a um script Pay-to-Script-Hash (P2SH). Nós vimos esse tipo de script em <a href="#p2sh">[p2sh]</a>. Naquele exemplo, o P2SH foi usado pela empresa do Mohammed para expressar um script multiassinatura. Os pagamentos para a empresa do Mohammed foram codificados com um script de travamento como este:</p>
</div>
<div class="listingblock data-line-1524">
<div class="title">Exemplo de script de saída P2SH</div>
<div class="content">
<pre>HASH160 54c557e07dde5bb6cb791c7a540e0a4796f5e97e EQUAL</pre>
</div>
</div>
<div class="paragraph data-line-1528">
<p>Este script P2SH faz referência ao hash de um <em>script de resgate</em> que define uma exigência de uma multiassinatura 2-de-5 para se gastar os fundos. Para gastar essa saída, a empresa do Mohammed apresentaria o script de resgate (cujo hash corresponde ao hash de script contido na saída P2SH) e as assinaturas necessárias para satisfazer esse script de resgate, tudo dentro da entrada da transação:</p>
</div>
<div class="listingblock data-line-1531">
<div class="title">Transação decodificada mostrando uma saída P2SH sendo gasta</div>
<div class="content">
<pre>[...]
“Vin” : [
"txid": "abcdef12345...",
"vout": 0,
     	 "scriptSig": “&lt;AssA&gt; &lt;AssB&gt; &lt;2 CPubA CPubB CPubC CPubD CPubE 5 CHECKMULTISIG&gt;”,
]</pre>
</div>
</div>
<div class="paragraph data-line-1540">
<p>Agora, vamos ver como esse exemplo ficaria caso ele fosse atualizado para a segwit. Se os clientes do Mohammed estivessem usando uma carteira compatível com segwit, eles fariam um pagamento criando uma saída Pay-to-Witness-Script-Hash (P2WSH) (em português, Paga-para-Testemunha-de-Hash-de-Script) semelhante a esta:</p>
</div>
<div class="listingblock data-line-1543">
<div class="title">Exemplo de script de saída P2WSH</div>
<div class="content">
<pre>0 a9b7b38d972cabc7961dbfbcb841ad4508d133c47ba87457b4a0e8aae86dbb89</pre>
</div>
</div>
<div class="paragraph data-line-1547">
<p>Novamente, assim como no exemplo do P2WPKH, você pode ver que o script equivalente da Segregated Witness é muito mais simples e omite os vários operandos de script que são vistos nos scripts P2SH. Em vez disso, o programa de Segregated Witness consiste em dois valores que são adicionados na pilha: a versão da testemunha (0) e o hash SHA256 de 32 bytes do script de resgate.</p>
</div>
<div class="paragraph data-line-1549">
<p>A empresa do Mohammed pode gastar a saída P2WSH apresentando o script de resgate correto e um número suficiente de assinaturas para satisfazê-lo. Tanto o script de resgate quanto as assinaturas seriam segregados <em>fora</em> dos dados da transação de gasto como parte dos dados de testemunha. Na entrada da transação, a carteira do Mohammed colocaria um scriptSig vazio:</p>
</div>
<div class="listingblock data-line-1552">
<div class="title">Transação decodificada mostrando uma saída P2WSH sendo gasta com dados de testemunha separados</div>
<div class="content">
<pre>[...]
“Vin” : [
"txid": "abcdef12345...",
"vout": 0,
     	 "scriptSig": “”,
]
[...]
“witness”: “&lt;AssA&gt; &lt;AssB&gt; &lt;2 CPubA CPubB CPubC CPubD CPubE 5 CHECKMULTISIG&gt;”
[...]</pre>
</div>
</div>
<div class="admonitionblock tip data-line-1565">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1566">
<p>Enquanto o P2SH usa o hash de 20 bytes do RIPEMD160(SHA256(script)), o programa de testemunha P2WSH usa um hash de 32 bytes do SHA256(script). Esta diferença na escolha do algoritmo de hash é deliberada e fornece maior segurança para o P2WSH (128 bits de segurança no P2WSH versus 80 bits de segurança no P2SH). Ela também é usada para diferenciar entre os dois tipos de programas de testemunha (P2WPKH e P2WSH) através do comprimento do hash (ver abaixo).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1570">
<p>===== Diferenciando entre P2WPKH e P2WSH</p>
</div>
<div class="paragraph data-line-1572">
<p>Nas duas seções anteriores, demonstramos dois tipos de programas de testemunha: <a href="#p2wpkh">[p2wpkh]</a> e <a href="#p2wsh">[p2wsh]</a>. Ambos os tipos de programas de testemunha consistem em um número de versão de apenas um byte seguido por um hash mais longo. Eles são muito semelhantes, mas são interpretados de maneiras muito diferentes: um é interpretado como um hash de chave pública, que é satisfeito por uma assinatura e o outro é interpretado como um hash de script, que é satisfeito por um script de resgate. A diferença crucial entre eles é o comprimento do hash:</p>
</div>
<div class="ulist data-line-1574">
<ul>
<li class="data-line-1574">
<p>O hash de chave pública no P2WPKH tem 20 bytes</p>
</li>
<li class="data-line-1575">
<p>O hash de script no P2WSH tem 32 bytes</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1577">
<p>Essa diferença é o que permite que uma carteira diferencie os dois tipos de programa de testemunha. Observando o comprimento do hash, uma carteira pode determinar qual é o tipo do programa de testemunha, P2WPKH ou P2WSH.</p>
</div>
<div class="paragraph data-line-1579">
<p>==== Atualizando para a Segregated Witness</p>
</div>
<div class="paragraph data-line-1581">
<p>Como podemos ver nos exemplos anteriores, a atualização para a Segregated Witness é um processo de duas etapas. Primeiro, as carteiras devem criar saídas especiais do tipo segwit. Então, essas saídas podem ser gastas por carteiras que sabem como construir transações de Segregated Witness. Nos exemplos, a carteira da Alice era compatível com segwit e tinha a capacidade de criar saídas especiais com scripts de Segregated Witness. A carteira do Bob também é compatível com a segwit e tem a capacidade de gastar essas saídas. O que pode não ser óbvio a partir do exemplo é que, na prática, a carteira da Alice precisa <em>saber</em> que o Bob usa uma carteira que é compatível com segwit e consegue gastar essas saídas. Caso contrário, se a carteira de Bob não for atualizada e a Alice tentar fazer pagamentos de segwit para o Bob, a carteira do Bob não será capaz de detectar esses pagamentos.</p>
</div>
<div class="admonitionblock tip data-line-1584">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1585">
<p>Para os pagamentos dos tipos P2WPKH e P2WSH, ambas as carteiras (do remetente e do destinatário) precisam ser atualizadas para que elas possam usar a segwit. Além disso, a carteira do remetente precisa saber que a carteira do destinatário é compatível com a segwit.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1588">
<p>A Segregated Witness não será implementada simultaneamente em toda a rede. Em vez disso, a Segregated Witness é implementada como uma atualização compatível com versões anteriores (retrocompatível), onde <em>clientes antigos e clientes novos podem coexistir</em>. Os desenvolvedores de carteira atualizarão os seus aplicativos de carteira de forma independente para adicionar os recursos da segwit. Os pagamentos dos tipos P2WPKH e P2WSH serão usados quando tanto o remetente quanto o destinatário forem compatíveis com a segwit. Os pagamentos tradicionais, dos tipos P2PKH e o P2SH, continuarão a funcionar nas carteiras não atualizadas. Isso nos deixa com dois cenários importantes, que serão abordados na próxima seção:</p>
</div>
<div class="ulist data-line-1590">
<ul>
<li class="data-line-1590">
<p>Capacidade de uma carteira de remetente incompatível em fazer um pagamento para uma carteira de destinatário compatível com segwit.</p>
</li>
<li class="data-line-1592">
<p>Capacidade de uma carteira de remetente compatível em reconhecer e distinguir entre os destinatários que são compatíveis dos que são incompatíveis com segwit, por meio de seus <em>endereços</em>.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1594">
<p>===== Embutindo a Segregated Witness dentro do P2SH</p>
</div>
<div class="paragraph data-line-1596">
<p>Vamos supor, por exemplo, que a carteira da Alice não seja atualizada para a segwit, mas a carteira do Bob seja atualizada e consiga lidar com transações da segwit. A Alice e o Bob podem usar transações "antigas" não segwit. Mas o Bob provavelmente gostaria de usar a segwit para reduzir as taxas de transação, aproveitando o desconto que ele teria ao deixar de incluir os dados de testemunha.</p>
</div>
<div class="paragraph data-line-1598">
<p>Nesse caso, a carteira do Bob pode construir um endereço P2SH que contém um script segwit dentro dele. A carteira da Alice vê esse endereço como se fosse um endereço P2SH "normal" e consegue fazer pagamentos para ele sem sequer saber que a segwit existe. A carteira do Bob pode então gastar esse pagamento com uma transação de segwit, aproveitando ao máximo as vantagens da segwit e reduzindo as taxas de transação.</p>
</div>
<div class="paragraph data-line-1600">
<p>As duas formas de scripts de testemunha, o P2WPKH e o P2WSH, podem ser embutidas em um endereço P2SH. A primeira forma embutida é denominada P2SH(P2WPKH) e a segunda é denominada P2SH(P2WSH).</p>
</div>
<div class="paragraph data-line-1602">
<p>===== Pay-to-Witness-Public-Key-Hash dentro de um Pay-to-Script-Hash</p>
</div>
<div class="paragraph data-line-1604">
<p>A primeira forma de script de testemunha que examinaremos é a P2SH(P2WPKH). Ela é um programa de testemunha Pay-to-Witness-Public-Key-Hash, embutido em um script Pay-to-Script-Hash, para que possa ser usado por uma carteira que não tenha conhecimento da segwit.</p>
</div>
<div class="paragraph data-line-1606">
<p>Bob&#8217;s wallet constructs a P2WPKH witness program with Bob&#8217;s public key. This witness program is then hashed and the resulting hash is encoded as a P2SH script. The P2SH script is converted to a Bitcoin address, one that starts with a "3," as we saw in the <a href="#p2sh">[p2sh]</a> section.</p>
</div>
<div class="paragraph data-line-1608">
<p>A carteira do Bob começa com o programa de testemunha P2WPKH que vimos anteriormente:</p>
</div>
<div class="listingblock data-line-1611">
<div class="title">Programa de testemunha P2WPKH do Bob</div>
<div class="content">
<pre>0 ab68025513c3dbd2f7b92a94e0581f5d50f654e7</pre>
</div>
</div>
<div class="paragraph data-line-1615">
<p>O programa de testemunha P2WPKH consiste na versão da testemunha e no hash de chave pública de 20 bytes do Bob.</p>
</div>
<div class="paragraph data-line-1617">
<p>A carteira do Bob então faz o hash do programa de testemunha anterior, primeiro com o SHA256, depois com o RIPEMD160, produzindo outro hash de 20 bytes.</p>
</div>
<div class="paragraph data-line-1619">
<p>Vamos usar bx na linha de comando para replicar isso:</p>
</div>
<div class="listingblock data-line-1622">
<div class="title">HASH160 do programa de testemunha P2WPKH</div>
<div class="content">
<pre>echo \
'0 [ab68025513c3dbd2f7b92a94e0581f5d50f654e7]'\
 | bx script-encode | bx sha256 | bx ripemd160
3e0547268b3b19288b3adef9719ec8659f4b2b0b</pre>
</div>
</div>
<div class="paragraph data-line-1630">
<p>Next, the redeem script hash is converted to a Bitcoin address. Let&#8217;s use bx on the command-line again:</p>
</div>
<div class="listingblock data-line-1633">
<div class="title">Endereço P2SH</div>
<div class="content">
<pre>echo \
'3e0547268b3b19288b3adef9719ec8659f4b2b0b' \
| bx address-encode -v 5
37Lx99uaGn5avKBxiW26HjedQE3LrDCZru</pre>
</div>
</div>
<div class="paragraph data-line-1640">
<p>Now, Bob can display this address for customers to pay for their coffee. Alice&#8217;s wallet can make a payment to 37Lx99uaGn5avKBxiW26HjedQE3LrDCZru, just as it would to any other Bitcoin address.</p>
</div>
<div class="paragraph data-line-1642">
<p>Para pagar para o Bob, a carteira da Alice travaria a saída com um script P2SH:</p>
</div>
<div class="listingblock data-line-1643">
<div class="content">
<pre>HASH160 3e0547268b3b19288b3adef9719ec8659f4b2b0b EQUAL</pre>
</div>
</div>
<div class="paragraph data-line-1647">
<p>Mesmo que a carteira da Alice não tenha suporte para segwit, o pagamento que ela cria pode ser gasto pelo Bob através de uma transação com segwit.</p>
</div>
<div class="paragraph data-line-1649">
<p>===== Pay-to-Witness-Script-Hash dentro de um Pay-to-Script-Hash</p>
</div>
<div class="paragraph data-line-1651">
<p>Da mesma forma, um programa de testemunha P2WSH para um script multiassinatura ou outro script complicado pode ser embutido dentro de um script e endereço P2SH, permitindo que qualquer carteira faça pagamentos que são compatíveis com a segwit.</p>
</div>
<div class="paragraph data-line-1653">
<p>Conforme vimos em <a href="#p2wsh">[p2wsh]</a>, a empresa do Mohammed está usando pagamentos de Segregated Witness com scripts multiassinatura. Para possibilitar que qualquer cliente pague para sua empresa, independente se suas carteiras foram ou não atualizadas para a segwit, a carteira do Mohammed pode embutir o programa de testemunha P2WSH dentro de um script P2SH.</p>
</div>
<div class="paragraph data-line-1655">
<p>Primeiro, a carteira do Mohammed faz o hash do script de resgate com o SHA256 (apenas uma vez). Vamos usar bx na linha de comando para fazer isso :</p>
</div>
<div class="listingblock data-line-1658">
<div class="title">A carteira do Mohammed cria um programa de testemunha P2WSH</div>
<div class="content">
<pre>echo \
2 \ [04C16B8698A9ABF84250A7C3EA7EEDEF9897D1C8C6ADF47F06CF73370D74DCCA01CDCA79DCC5C395D7EEC6984D83F1F50C900A24DD47F569FD4193AF5DE762C587] \
[04A2192968D8655D6A935BEAF2CA23E3FB87A3495E7AF308EDF08DAC3C1FCBFC2C75B4B0F4D0B1B70CD2423657738C0C2B1D5CE65C97D78D0E34224858008E8B49] \
[047E63248B75DB7379BE9CDA8CE5751D16485F431E46117B9D0C1837C9D5737812F393DA7D4420D7E1A9162F0279CFC10F1E8E8F3020DECDBC3C0DD389D9977965] \
[0421D65CBD7149B255382ED7F78E946580657EE6FDA162A187543A9D85BAAA93A4AB3A8F044DADA618D087227440645ABE8A35DA8C5B73997AD343BE5C2AFD94A5] \
[043752580AFA1ECED3C68D446BCAB69AC0BA7DF50D56231BE0AABF1FDEEC78A6A45E394BA29A1EDF518C022DD618DA774D207D137AAB59E0B000EB7ED238F4D800] \
5 CHECKMULTISIG \
| bx script-encode | bx sha256
9592d601848d04b172905e0ddb0adde59f1590f1e553ffc81ddc4b0ed927dd73</pre>
</div>
</div>
<div class="paragraph data-line-1670">
<p>A seguir, o hash do script de resgate é transformado em um programa de testemunha P2WSH:</p>
</div>
<div class="listingblock data-line-1672">
<div class="content">
<pre>0 9592d601848d04b172905e0ddb0adde59f1590f1e553ffc81ddc4b0ed927dd73</pre>
</div>
</div>
<div class="paragraph data-line-1676">
<p>Em seguida, o próprio programa de testemunha é transformado em hash com o SHA256 e o RIPEMD160, produzindo um novo hash de 20 bytes, como usado no P2SH tradicional. Vamos usar bx na linha de comando para fazer isso:</p>
</div>
<div class="listingblock data-line-1679">
<div class="title">O HASH160 do programa de testemunha P2WSH</div>
<div class="content">
<pre> echo \
'0 [9592d601848d04b172905e0ddb0adde59f1590f1e553ffc81ddc4b0ed927dd73]'\
 | bx script-encode | bx sha256 | bx ripemd160
86762607e8fe87c0c37740cddee880988b9455b2</pre>
</div>
</div>
<div class="paragraph data-line-1686">
<p>Next, the wallet constructs a P2SH Bitcoin address from this hash. Again, we use bx to calculate on the command-line:</p>
</div>
<div class="listingblock data-line-1689">
<div class="title">P2SH Bitcoin address</div>
<div class="content">
<pre>echo \
'86762607e8fe87c0c37740cddee880988b9455b2'\
 | bx address-encode -v 5
3Dwz1MXhM6EfFoJChHCxh1jWHb8GQqRenG</pre>
</div>
</div>
<div class="paragraph data-line-1696">
<p>Agora, os clientes do Mohammed podem fazer pagamentos neste endereço, sem precisarem ter suporte à segwit. Para enviar um pagamento a Mohammed, uma carteira travaria a saída com o seguinte script P2SH:</p>
</div>
<div class="listingblock data-line-1699">
<div class="title">Script P2SH usado para travar os pagamentos para a multiassinatura do Mohammed</div>
<div class="content">
<pre>HASH160 86762607e8fe87c0c37740cddee880988b9455b2 EQUAL</pre>
</div>
</div>
<div class="paragraph data-line-1703">
<p>A empresa do Mohammed pode então construir transações com segwit para gastar esses pagamentos, aproveitando os recursos da segwit, incluindo taxas de transação mais baixas.</p>
</div>
<div class="paragraph data-line-1705">
<p>===== Endereços de Segregated Witness</p>
</div>
<div class="paragraph data-line-1707">
<p>Mesmo após a ativação da segwit, levará algum tempo até que a maioria das carteiras seja atualizada. Inicialmente, a segwit será embutida no P2SH, conforme vimos na seção anterior, para facilitar a compatibilidade entre as carteiras com suporte e as carteiras sem suporte à segwit.</p>
</div>
<div class="paragraph data-line-1709">
<p>No entanto, assim que as carteiras suportarem amplamente a segwit, fará sentido codificar os scripts de testemunha diretamente em um formato de endereço nativo projetado para a segwit, em vez de embuti-los no P2SH.</p>
</div>
<div class="paragraph data-line-1711">
<p>O formato de endereço segwit nativo é definido na BIP-173:</p>
</div>
<div class="dlist data-line-1713">
<dl>
<dt class="hdlist1"><a href="https://github.com/bitcoin/bips/blob/master/bip-0173.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0173.mediawiki">BIP-173</a></dt>
<dd>
<p>Formato de endereço Base32 para saídas de testemunha v0-16 nativas</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-1715">
<p>BIP-173 only encodes witness (P2WPKH and P2WSH) scripts. It is not compatible with non-segwit P2PKH or P2SH scripts. BIP-173 is a checksummed Base32 encoding, as compared to the Base58 encoding of a "traditional" Bitcoin address. BIP-173 addresses are also called <em>bech32</em> addresses, pronounced "beh-ch thirty two", alluding to the use of a "BCH" error detection algorithm and 32-character encoding set.</p>
</div>
<div class="paragraph data-line-1717">
<p>Os endereços da BIP-173 usam um conjunto de 32 caracteres alfanuméricos apenas em letras minúsculas, cuidadosamente selecionados para reduzir erros de leitura e de digitação. Por escolher um conjunto de caracteres apenas em letras minúsculas, o bech32 é mais fácil de ser lido e soletrado, além de ser 45% mais eficiente de ser codificado em códigos QR.</p>
</div>
<div class="paragraph data-line-1719">
<p>O algoritmo de detecção de erros BCH é uma grande melhoria em relação ao algoritmo de soma de verificação anterior (do Base58Check), permitindo não só a detecção, mas também a <em>correção</em> de erros. Ao detectar um erro, as interfaces de entrada de endereço (como campos de texto em formulários) podem detectar e destacar qual caractere provavelmente foi digitado incorretamente.</p>
</div>
<div class="paragraph data-line-1721">
<p>A partir da especificação da BIP-173, aqui estão alguns exemplos de endereços bech32:</p>
</div>
<div class="dlist data-line-1723">
<dl>
<dt class="hdlist1">Endereço P2WPKH da Mainnet</dt>
<dd>
<p>bc1qw508d6qejxtdg4y5r3zarvary0c5xw7kv8f3t4</p>
</dd>
<dt class="hdlist1">Endereço P2WPKH da Testnet</dt>
<dd>
<p>tb1qw508d6qejxtdg4y5r3zarvary0c5xw7kxpjzsx</p>
</dd>
<dt class="hdlist1">Endereço P2WSH da Mainnet</dt>
<dd>
<p>bc1qrp33g0q5c5txsp9arysrx4k6zdkfs4nce4xj0gdcccefvpysxf3qccfmv3</p>
</dd>
<dt class="hdlist1">Endereço P2WSH da Testnet</dt>
<dd>
<p>tb1qrp33g0q5c5txsp9arysrx4k6zdkfs4nce4xj0gdcccefvpysxf3q0sl5k7</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-1728">
<p>Como você pode ver nesses exemplos, uma <em>string</em> de um endereço bech32 da segwit tem até 90 caracteres e consiste em três partes:</p>
</div>
<div class="dlist data-line-1730">
<dl>
<dt class="hdlist1">A parte legível por humanos</dt>
<dd>
<p>O prefixo "bc" ou "tb", que identifica a mainnet ou a testnet</p>
</dd>
<dt class="hdlist1">O separador</dt>
<dd>
<p>O dígito "1", que não faz parte do conjunto de codificação de 32 caracteres e só pode aparecer nesta posição como um separador</p>
</dd>
<dt class="hdlist1">A parte de dados</dt>
<dd>
<p>Um mínimo de 6 caracteres alfanuméricos, que correspondem ao script de testemunha codificado e com soma de verificação (<em>checksum</em>)</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-1736">
<p>Atualmente, apenas algumas carteiras aceitam ou produzem endereços segwit bech32 nativos, mas à medida que a adoção da segwit aumenta, você os verá cada vez mais.</p>
</div>
<div class="paragraph data-line-1738">
<p>A <a href="#segwit_addresses">Endereços de bitcoin não segwit (legado) e endereços segwit</a> mostra os endereços de bitcoin não segwit (legado ou <em>legacy</em>) e segwit.</p>
</div>
<table id="segwit_addresses" class="tableblock frame-all grid-all stretch data-line-1742">
<caption class="title">Table 23. Endereços de bitcoin não segwit (legado) e endereços segwit</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tipo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Codificação</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prefixo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endereço Legado P2PKH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base58</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endereço Legado P2PKH Testnet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base58</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">m ou n</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endereço Legado P2SH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base58</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endereço Legado P2SH Testnet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base58</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endereço Segwit Aninhado/Embutido P2SH(P2WPKH)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base58</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endereço Segwit Aninhado/Embutido P2SH(P2WSH)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base58</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endereço Segwit Nativo P2WPKH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bech32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bc1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endereço Segwit Nativo P2WPKH Testnet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bech32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tb1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endereço Segwit Nativo P2WSH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bech32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bc1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endereço Segwit Nativo P2WSH Testnet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bech32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tb1</p></td>
</tr>
</tbody>
</table>
<div id="segwit_txid" class="paragraph data-line-1757">
<p>===== Identificadores de transação</p>
</div>
<div class="paragraph data-line-1759">
<p>Um dos maiores benefícios da Segregated Witness é que ela elimina a maleabilidade de transação por terceiros.</p>
</div>
<div class="paragraph data-line-1761">
<p>Antes da segwit, as transações podiam ter suas assinaturas sutilmente modificadas por terceiros, alterando seu ID (hash) de transação sem alterar nenhuma das propriedades fundamentais (entradas, saídas, quantias). Isso criou oportunidades para ataques de negação de serviço, bem como ataques contra softwares de carteira mal escritos que presumiam que os hashes de transações não confirmadas eram imutáveis.</p>
</div>
<div class="paragraph data-line-1763">
<p>Com a introdução da Segregated Witness, as transações agora têm dois identificadores, txid e wtxid. O ID de transação tradicional txid é o hash SHA256 duplo da transação serializada, sem os dados de testemunha. Um wtxid de transação é o hash SHA256 duplo do novo formato de serialização da transação com dados de testemunha.</p>
</div>
<div class="paragraph data-line-1765">
<p>O txid tradicional é calculado exatamente da mesma maneira que uma transação sem segwit. No entanto, como uma transação segwit pura (uma transação contendo apenas entradas com segwit) tem scriptSigs vazios em todas as entradas, nenhuma parte da transação pode ser modificada por terceiros. Portanto, em uma transação segwit pura, o txid é imutável por um terceiro, mesmo quando a transação ainda não foi confirmada.</p>
</div>
<div class="paragraph data-line-1767">
<p>O wtxid é como um ID "estendido", pois o hash também incorpora os dados de testemunha. Se uma transação for transmitida sem dados de testemunha, o wtxid e o txid serão idênticos. Observe que, uma vez que o wtxid inclui os dados de testemunha (as assinaturas) e como os dados de testemunha podem ser maleáveis, o wtxid deve ser considerado maleável até que a transação seja confirmada. Apenas o txid de uma transação segwit pura pode ser considerado imutável por terceiros.</p>
</div>
<div class="admonitionblock tip data-line-1770">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1771">
<p>As transações com Segregated Witness têm dois IDs: o txid e o wtxid. O txid é o hash da transação sem os dados de testemunha e o wtxid é o hash que inclui os dados de testemunha. Somente as transações segwit puras (transações que contêm apenas entradas segwit) possuem um txid que não é suscetível à maleabilidade de transação por terceiros.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1774">
<p>==== Novo Algoritmo de Assinatura da Segregated Witness</p>
</div>
<div class="paragraph data-line-1776">
<p>A Segregated Witness modifica a semântica das quatro funções de verificação de assinatura (CHECKSIG, CHECKSIGVERIFY, CHECKMULTISIG e CHECKMULTISIGVERIFY), mudando a maneira como um hash de compromisso de transação é calculado.</p>
</div>
<div class="paragraph data-line-1778">
<p>As assinaturas nas transações de bitcoin são aplicadas em um <em>hash de compromisso</em>, que é calculado a partir dos dados da transação, travando partes específicas dos dados que indicam o compromisso do signatário com esses valores. Por exemplo, em uma assinatura simples do tipo SIGHASH_ALL, o hash de compromisso inclui todas as entradas e saídas.</p>
</div>
<div class="paragraph data-line-1780">
<p>Unfortunately, the way the commitment hash was calculated introduced the possibility that a node verifying the signature can be forced to perform a significant number of hash computations. Specifically, the hash operations increase in O(n<sup>2</sup>) with respect to the number of signature operations in the transaction. An attacker could therefore create a transaction with a very large number of signature operations, causing the entire Bitcoin network to have to perform hundreds or thousands of hash operations to verify the transaction.</p>
</div>
<div class="paragraph data-line-1782">
<p>A segwit representou uma oportunidade de resolver esse problema ao alterar a maneira como o hash de compromisso é calculado. Para programas de testemunha da versão 0 da segwit, a verificação de assinatura ocorre usando um algoritmo de hash de compromisso aprimorado, conforme especificado na BIP-143.</p>
</div>
<div class="paragraph data-line-1784">
<p>O novo algoritmo atinge dois objetivos importantes. Em primeiro lugar, o número de operações de hash aumenta em uma proporção muito mais gradual (O(n)) em relação ao número de operações de assinatura, reduzindo a oportunidade de serem criados ataques de negação de serviço com transações excessivamente complexas. Em segundo lugar, o hash de compromisso agora também inclui os valores (as quantias) de cada entrada como parte do compromisso. Isso significa que um signatário pode se comprometer com um valor de entrada específico sem precisar "buscar" e verificar a transação anterior referenciada pela entrada. No caso de dispositivos off-line, como carteiras de hardware, isso simplifica muito a comunicação entre o host (o computador/celular/tablet) e a carteira de hardware, eliminando a necessidade de se transmitir transações anteriores para validação. Uma carteira de hardware pode aceitar o valor da entrada "conforme declarado" por um host que não seja de confiança. Como a assinatura é inválida se o valor da entrada não estiver correto, a carteira de hardware não precisa validar o valor antes de assinar a entrada.</p>
</div>
<div class="paragraph data-line-1786">
<p>==== Incentivos Econômicos para a Segregated Witness</p>
</div>
<div class="paragraph data-line-1788">
<p>Bitcoin mining nodes and full nodes incur costs for the resources used to support the Bitcoin network and the blockchain. As the volume of bitcoin transactions increases, so does the cost of resources (CPU, network bandwidth, disk space, memory). Miners are compensated for these costs through fees that are proportional to the size (in bytes) of each transaction. Nonmining full nodes are not compensated, so they incur these costs because they have a need to run an authoritative fully validating full-index node, perhaps because they use the node to operate a bitcoin business.</p>
</div>
<div class="paragraph data-line-1790">
<p>Sem as taxas de transação, o crescimento dos dados do bitcoin aumentaria dramaticamente. As taxas destinam-se a alinhar as necessidades dos usuários do bitcoin com a carga que suas transações impõem à rede, por meio de um mecanismo de descoberta de preço baseado no mercado.</p>
</div>
<div class="paragraph data-line-1792">
<p>The calculation of fees based on transaction size treats all the data in the transaction as equal in cost. But from the perspective of full nodes and miners, some parts of a transaction carry much higher costs. Every transaction added to the Bitcoin network affects the consumption of four resources on nodes:</p>
</div>
<div class="dlist data-line-1794">
<dl>
<dt class="hdlist1">Espaço em disco </dt>
<dd>
<p>Todas as transações são armazenadas na blockchain, o que acaba contribuindo para um aumento no tamanho total da blockchain. A blockchain é armazenada em disco, mas o armazenamento pode ser otimizado através da exclusão de transações mais antigas, também conhecida pelo termo “podagem” (em inglês, <em>pruning</em>).</p>
</dd>
<dt class="hdlist1">CPU</dt>
<dd>
<p>Cada transação deve ser validada, o que requer tempo de CPU.</p>
</dd>
<dt class="hdlist1">Largura de banda </dt>
<dd>
<p>Cada transação é transmitida (através da propagação de inundação) pela rede pelo menos uma vez. Sem qualquer otimização no protocolo de propagação dos blocos, as transações são transmitidas novamente como parte de um bloco, dobrando o impacto na capacidade da rede.</p>
</dd>
<dt class="hdlist1">Memória </dt>
<dd>
<p>Os nós que validam transações mantêm o índice UTXO ou todo o conjunto UTXO na memória para acelerar a validação. Como o armazenamento em memória é pelo menos uma ordem de magnitude mais caro do que o armazenamento em disco, o crescimento do conjunto UTXO contribui desproporcionalmente para o custo de execução de um nó.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-1802">
<p>Como você pode ver na lista, nem todas as partes de uma transação têm um impacto igual no custo de execução de um nó ou na capacidade do bitcoin de escalar para suportar mais transações. A parte mais cara de uma transação são as saídas recém-criadas, pois elas são adicionadas ao conjunto UTXO na memória. Em comparação, as assinaturas (também conhecidas como dados de testemunha) adicionam uma menor carga à rede e ao custo de execução de um nó, pois os dados de testemunha são validados apenas uma vez e depois nunca mais são usados. Além disso, imediatamente após receber uma nova transação e validar os dados de testemunha, os nós podem descartar esses dados de testemunha. Se as taxas forem calculadas com base no tamanho da transação, sem discriminar entre esses dois tipos de dados, os incentivos de mercado das taxas não estarão alinhados com os custos reais impostos por uma transação. Na verdade, a estrutura de taxas atual incentiva o comportamento oposto, pois os dados de testemunha constituem a maior parte de uma transação.</p>
</div>
<div class="paragraph data-line-1804">
<p>Os incentivos criados pelas taxas são importantes, pois eles afetam o comportamento das carteiras. Todas as carteiras devem implementar alguma estratégia para montar transações que leve em consideração uma série de fatores, como privacidade (reduzindo a reutilização de endereços), fragmentação (fazendo muitos trocos) e taxas. Se as taxas estão servindo como um forte incentivo para as carteiras usarem o mínimo de entradas possível nas transações, isso pode levar a estratégias de seleção de UTXO e de endereço de troco que inadvertidamente incham o conjunto UTXO.</p>
</div>
<div class="paragraph data-line-1806">
<p>As transações consomem UTXOs em suas entradas e criam novas UTXOs com suas saídas. Portanto, uma transação que tem mais entradas do que saídas resultará em uma diminuição no conjunto UTXO, enquanto uma transação que possui mais saídas do que entradas resultará em um aumento no conjunto UTXO. Vamos considerar a <em>diferença</em> entre as entradas e as saídas e chamá-la de “Nova-UTXO-líquida” (em inglês, <em>Net-new-UTXO</em>). Essa é uma métrica importante, pois nos diz qual impacto uma transação terá no recurso mais caro de toda a rede, o conjunto UTXO em memória. Uma transação com uma Nova-UTXO-líquida positiva aumenta esse fardo. Uma transação com uma Nova-UTXO-líquida negativa reduz o fardo. Portanto, o que queremos é encorajar as transações que tenham uma Nova-UTXO-líquida negativa ou as que sejam neutras e tenham uma Nova-UTXO-líquida zero.</p>
</div>
<div class="paragraph data-line-1808">
<p>Let’s look at an example of what incentives are created by the transaction fee calculation, with and without Segregated Witness. We will look at two different transactions. Transaction A is a 3-input, 2-output transaction, which has a Net-new-UTXO metric of &#x2013;1, meaning it consumes one more UTXO than it creates, reducing the UTXO set by one. Transaction B is a 2-input, 3-output transaction, which has a Net-new-UTXO metric of 1, meaning it adds one UTXO to the UTXO set, imposing additional cost on the entire Bitcoin network. Both transactions use multisignature (2-of-3) scripts to demonstrate how complex scripts increase the impact of segregated witness on fees. Let’s assume a transaction feerate of 30 satoshi per byte and a 75% fee discount on witness data:</p>
</div>
<dl>
<dt>Sem Segregated Witness</dt>
<dd>
<p>Taxa da Transação A: 28.590 satoshis</p>
<p>Taxa da Transação B: 20.760 satoshis</p>
</dd>

<dt>Com Segregated Witness</dt>
<dd>
<p>Taxa da Transação A: 12.255 satoshis</p>
<p>Taxa da Transação B: 10.425 satoshis</p>
</dd>
</dl>
<div class="paragraph data-line-1827">
<p>Ambas as transações são menos caras quando a Segregated Witness é implementada. Comparando os custos entre as duas transações, vemos que antes da Segregated Witness, a transação com a Nova-UTXO-líquida positiva tem economias de custo significativas. Com a Segregated Witness, a diferença de custo diminui significativamente em termos absolutos e relativos. Embora seria necessário que as entradas se tornassem mais baratas do que as saídaspara que a consolidação do conjunto UTXO fosse incentivada, esse desconto reduz o incentivo para se criar novas UTXOs com o intuito de se evitar o uso de mais entradas.</p>
</div>
<div class="paragraph data-line-1829">
<p>Segregated Witness therefore has two main effects on the fees paid by bitcoin users. Firstly, segwit reduces the overall cost of transactions by discounting witness data and increasing the capacity of the Bitcoin blockchain. Secondly, segwit’s discount on witness data partially mitigates a misalignment of incentives that may have inadvertently created more bloat in the UTXO set.</p>
</div>
<div id="bitcoin_network_ch08" class="paragraph data-line-1832">
<p>== A Rede Bitcoin</p>
</div>
<div class="paragraph data-line-1834">
<p>=== Arquitetura de Rede Par-a-Par</p>
</div>
<div class="paragraph data-line-1836">
<p>Bitcoin is structured as a peer-to-peer network architecture on top of the internet. The term peer-to-peer, or P2P, means that the computers that participate in the network are peers to each other, that they are all equal, that there are no "special" nodes, and that all nodes share the burden of providing network services. The network nodes interconnect in a mesh network with a "flat" topology. There is no server, no centralized service, and no hierarchy within the network. Nodes in a P2P network both provide and consume services at the same time with reciprocity acting as the incentive for participation. P2P networks are inherently resilient, decentralized, and open. A preeminent example of a P2P network architecture was the early internet itself, where nodes on the IP network were equal. Today&#8217;s internet architecture is more hierarchical, but the Internet Protocol still retains its flat-topology essence. Beyond bitcoin, the largest and most successful application of P2P technologies is file sharing, with Napster as the pioneer and BitTorrent as the most recent evolution of the architecture.</p>
</div>
<div class="paragraph data-line-1838">
<p>A arquitetura da rede P2P do bitcoin é muito mais do que uma escolha de topologia. O bitcoin é projetado para ser um sistema de dinheiro em espécie digital P2P, e a arquitetura da rede é tanto um reflexo quanto uma base fundamental dessa característica-chave. A descentralização do controle é um princípio-chave do projeto, e ela só pode ser obtida e mantida através de uma rede de consenso P2P descentralizada.</p>
</div>
<div class="paragraph data-line-1840">
<p>The term "Bitcoin network" refers to the collection of nodes running the bitcoin P2P protocol. In addition to the bitcoin P2P protocol, there are other protocols such as Stratum that are used for mining and lightweight or mobile wallets. These additional protocols are provided by gateway routing servers that access the Bitcoin network using the bitcoin P2P protocol and then extend that network to nodes running other protocols. For example, Stratum servers connect Stratum mining nodes via the Stratum protocol to the main Bitcoin network and bridge the Stratum protocol to the bitcoin P2P protocol. We use the term "extended Bitcoin network" to refer to the overall network that includes the bitcoin P2P protocol, pool-mining protocols, the Stratum protocol, and any other related protocols connecting the components of the Bitcoin system.</p>
</div>
<div class="paragraph data-line-1842">
<p>=== Tipos de Nó e suas Funções</p>
</div>
<div class="paragraph data-line-1844">
<p>Although nodes in the bitcoin P2P network are equal, they may take on different roles depending on the functionality they are supporting. A Bitcoin node is a collection of functions: routing, the blockchain database, mining, and wallet services. A full node with all four of these functions is shown in <a href="#full_node_reference">A Bitcoin network node with all four functions: wallet, miner, full blockchain database, and network routing</a>.</p>
</div>
<div id="full_node_reference" class="imageblock smallerfifty data-line-1849">
<div class="content">
<img src="images/mbc2_0801.png" alt="FullNodeReferenceClient_Small">
</div>
<div class="title">Figure 46. A Bitcoin network node with all four functions: wallet, miner, full blockchain database, and network routing</div>
</div>
<div class="paragraph data-line-1851">
<p>Todos os nós incluem a função de roteamento para participar na rede e podem incluir outras funcionalidades adicionais. Todos os nós validam e propagam as transações e os blocos, e descobrem e mantêm conexões com outros pares. No exemplo de nó completo da <a href="#full_node_reference">A Bitcoin network node with all four functions: wallet, miner, full blockchain database, and network routing</a>, a função de roteamento é indicada por um círculo com a letra "N", indicando um "Nó Roteador da Rede".</p>
</div>
<div class="paragraph data-line-1853">
<p>Alguns nós, chamados de nós completos, também mantêm uma cópia completa e atualizada da blockchain. Os nós completos conseguem verificar de maneira autônoma e confiável qualquer transação, sem depender de uma referência externa. Alguns nós mantêm somente uma parte da blockchain e verificam as transações utilizando um método conhecido como <em>verificação de pagamento simplificada</em> (em inglês, <em>simplified payment verification</em> ou SPV). Estes nós são conhecidos como nós de SPV ou nós leves (em inglês, <em>lightweight</em>). No exemplo de nó completo da figura, a função de banco de dados da blockchain de um nó completo está indicada por um círculo contendo a letra "B", indicando uma "Blockchain Completa". Na <a href="#bitcoin_network">The extended Bitcoin network showing various node types, gateways, and protocols</a>, os nós de SPV estão representados sem o círculo contendo a letra "B", indicando que eles não têm uma cópia completa da blockchain.</p>
</div>
<div class="paragraph data-line-1855">
<p>Mining nodes compete to create new blocks by running specialized hardware to solve the Proof-of-Work algorithm. Some mining nodes are also full nodes, maintaining a full copy of the blockchain, while others are lightweight nodes participating in pool mining and depending on a pool server to maintain a full node. The mining function is shown in the full node as a circle called "Miner" or the letter "M."</p>
</div>
<div class="paragraph data-line-1857">
<p>User wallets might be part of a full node, as is usually the case with desktop Bitcoin clients. Increasingly, many user wallets, especially those running on resource-constrained devices such as smartphones, are SPV nodes. The wallet function is shown in <a href="#full_node_reference">A Bitcoin network node with all four functions: wallet, miner, full blockchain database, and network routing</a> as a circle called "Wallet" or the letter "W."</p>
</div>
<div class="paragraph data-line-1859">
<p>Além dos tipos de nós principais no protocolo P2P do bitcoin, existem também servidores e nós executando outros protocolos, como protocolos especializados de mineração em pool e protocolos de acesso de clientes leves.</p>
</div>
<div class="paragraph data-line-1861">
<p><a href="#node_type_ledgend">Different types of nodes on the extended Bitcoin network</a> shows the most common node types on the extended Bitcoin network.</p>
</div>
<div class="paragraph data-line-1863">
<p>=== A Rede Bitcoin Estendida</p>
</div>
<div class="paragraph data-line-1865">
<p>The main Bitcoin network, running the bitcoin P2P protocol, consists of between 5,000 and 8,000 listening nodes running various versions of the bitcoin reference client (Bitcoin Core) and a few hundred nodes running various other implementations of the bitcoin P2P protocol, such as Bitcoin Classic, Bitcoin Unlimited, BitcoinJ, Libbitcoin, btcd, and bcoin. A small percentage of the nodes on the bitcoin P2P network are also mining nodes, competing in the mining process, validating transactions, and creating new blocks. Various large companies interface with the Bitcoin network by running full-node clients based on the Bitcoin Core client, with full copies of the blockchain and a network node, but without mining or wallet functions. These nodes act as network edge routers, allowing various other services (exchanges, wallets, block explorers, merchant payment processing) to be built on top.</p>
</div>
<div class="paragraph data-line-1867">
<p>The extended Bitcoin network includes the network running the bitcoin P2P protocol, described earlier, as well as nodes running specialized protocols. Attached to the main bitcoin P2P network are a number of pool servers and protocol gateways that connect nodes running other protocols. These other protocol nodes are mostly pool mining nodes (see <a href="#mining">[mining]</a>) and lightweight wallet clients, which do not carry a full copy of the blockchain.</p>
</div>
<div class="paragraph data-line-1869">
<p><a href="#bitcoin_network">The extended Bitcoin network showing various node types, gateways, and protocols</a> shows the extended Bitcoin network with the various types of nodes, gateway servers, edge routers, and wallet clients and the various protocols they use to connect to each other.</p>
</div>
<div id="node_type_ledgend" class="imageblock data-line-1873">
<div class="content">
<img src="images/mbc2_0802.png" alt="BitcoinNodeTypes">
</div>
<div class="title">Figure 47. Different types of nodes on the extended Bitcoin network</div>
</div>
<div id="bitcoin_network" class="imageblock data-line-1877">
<div class="content">
<img src="images/mbc2_0803.png" alt="BitcoinNetwork">
</div>
<div class="title">Figure 48. The extended Bitcoin network showing various node types, gateways, and protocols</div>
</div>
<div class="paragraph data-line-1879">
<p>=== Redes de Retransmissão do Bitcoin</p>
</div>
<div class="paragraph data-line-1881">
<p>While the bitcoin P2P network serves the general needs of a broad variety of node types, it exhibits too high network latency for the specialized needs of bitcoin mining nodes.</p>
</div>
<div class="paragraph data-line-1883">
<p>Os mineradores do bitcoin estão envolvidos em uma competição apertada no tempo para resolver o problema da Prova-de-Trabalho e estender a blockchain (ver o <a href="#mining">[mining]</a>). Ao participarem desta competição, os mineradores do bitcoin precisam minimizar o tempo entre a propagação de um bloco vencedor e o início da próxima rodada da competição. Na mineração, a latência da rede está diretamente relacionada às margens de lucro.</p>
</div>
<div class="paragraph data-line-1885">
<p>Uma <em>Rede de Transmissão de Bitcoin</em> (Bitcoin Relay Network) é uma rede que tenta minimizar a latência na transmissão de blocos entre os mineradores. A <a href="https://www.bitcoinrelaynetwork.org" data-href="https://www.bitcoinrelaynetwork.org">Bitcoin Relay Network</a> original foi criada pelo desenvolvedor principal Matt Corallo em 2015 para permitir a sincronização rápida dos blocos entre os mineradores com latência muito baixa. A rede consistia em vários nodes especializados hospedados na infraestrutura da Amazon Web Services em todo o mundo e servia para conectar a maioria dos mineradores e das pools de mineração.</p>
</div>
<div class="paragraph data-line-1887">
<p>  A Bitcoin Relay Network original foi substituída em 2016 com a introdução do <em>Fast Internet Bitcoin Relay Engine</em> (Motor de Rede de Transmissão Rápida de Bitcoin) ou <a href="https://bitcoinfibre.org" data-href="https://bitcoinfibre.org"><em>FIBRE</em></a>, também criado pelo desenvolvedor principal Matt Corallo. A FIBER é uma rede de retransmissão baseada em UDP que retransmite blocos dentro de uma rede de nodes. A FIBER implementa a otimização do <em>bloco compacto</em> para reduzir ainda mais a quantidade de dados transmitidos e a latência da rede.</p>
</div>
<div class="paragraph data-line-1889">
<p>As redes de retransmissão não são substitutos para a rede P2P do bitcoin. Em vez disso, são redes de sobreposição que fornecem conectividade adicional entre nós que possuem necessidades especializadas. Assim como as rodovias não substituem as estradas rurais, mas servem como atalhos entre dois pontos com tráfego intenso, você ainda precisará das estradas menores para poder chegar às rodovias.</p>
</div>
<div class="paragraph data-line-1891">
<p>=== Descoberta da Rede</p>
</div>
<div class="paragraph data-line-1893">
<p>When a new node boots up, it must discover other Bitcoin nodes on the network in order to participate. To start this process, a new node must discover at least one existing node on the network and connect to it. The geographic location of other nodes is irrelevant; the Bitcoin network topology is not geographically defined. Therefore, any existing Bitcoin nodes can be selected at random.</p>
</div>
<div class="paragraph data-line-1895">
<p>Para se conectar a um par conhecido, os nós estabelecem uma conexão TCP, geralmente na porta 8333 (a porta que geralmente é usada pelo bitcoin), ou a uma porta alternativa, caso tenha sido fornecida. Ao estabelecer uma conexão, o nó iniciará um "aperto de mão" (ver a <a href="#network_handshake">O aperto de mãos inicial entre os pares</a>) ao transmitir uma mensagem version, que contém informações de identificação básicas, descritas a seguir:</p>
</div>
<div class="dlist data-line-1897">
<dl>
<dt class="hdlist1">nVersion</dt>
<dd>
<p>A versão do protocolo P2P do bitcoin que o cliente "fala" (por exemplo, 70002)</p>
</dd>
<dt class="hdlist1">nLocalServices</dt>
<dd>
<p>Uma lista dos serviços locais suportados pelo nó, atualmente apenas NODE_NETWORK</p>
</dd>
<dt class="hdlist1">nTime</dt>
<dd>
<p>A hora atual</p>
</dd>
<dt class="hdlist1">addrYou</dt>
<dd>
<p>O endereço IP do nó remoto, da maneira que ele é visto a partir desse nó</p>
</dd>
<dt class="hdlist1">addrMe</dt>
<dd>
<p>O endereço IP do nó local, da maneira que ele é descoberto pelo nó local</p>
</dd>
<dt class="hdlist1">subver</dt>
<dd>
<p>Uma sub-versão mostrando o tipo de software sendo executado nesse nó (ex: <span class="keep-together"><code>/Satoshi:0.9.2.1/</code></span>)</p>
</dd>
<dt class="hdlist1">BestHeight</dt>
<dd>
<p>A altura de bloco da blockchain deste nó</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-1905">
<p>(Veja <a href="https://bit.ly/1qlsC7w" data-href="https://bit.ly/1qlsC7w">GitHub</a> para um exemplo de uma versão de mensagem da rede.)</p>
</div>
<div class="paragraph data-line-1907">
<p>A mensagem version é sempre a primeira mensagem a ser enviada de qualquer par para outro par. O par local que recebe uma mensagem version examinará a nVersion relatada pelo par remoto e decidirá se o par remoto é compatível. Se o par remoto for compatível, o par local reconhecerá a mensagem version e estabelecerá uma conexão enviando uma mensagem verack.</p>
</div>
<div class="paragraph data-line-1909">
<p>How does a new node find peers? The first method is to query DNS using a number of "DNS seeds," which are DNS servers that provide a list of IP addresses of Bitcoin nodes. Some of those DNS seeds provide a static list of IP addresses of stable bitcoin listening nodes. Some of the DNS seeds are custom implementations of BIND (Berkeley Internet Name Daemon) that return a random subset from a list of Bitcoin node addresses collected by a crawler or a long-running Bitcoin node.  The Bitcoin Core client contains the names of nine different DNS seeds. The diversity of ownership and diversity of implementation of the different DNS seeds offers a high level of reliability for the initial bootstrapping process. In the Bitcoin Core client, the option to use the DNS seeds is controlled by the option switch -dnsseed (set to 1 by default, to use the DNS seed).</p>
</div>
<div class="paragraph data-line-1911">
<p>Alternatively, a bootstrapping node that knows nothing of the network must be given the IP address of at least one Bitcoin node, after which it can establish connections through further introductions. The command-line argument -seednode can be used to connect to one node just for introductions using it as a seed. After the initial seed node is used to form introductions, the client will disconnect from it and use the newly discovered peers.</p>
</div>
<div id="network_handshake" class="imageblock data-line-1915">
<div class="content">
<img src="images/mbc2_0804.png" alt="NetworkHandshake">
</div>
<div class="title">Figure 49. O aperto de mãos inicial entre os pares</div>
</div>
<div class="paragraph data-line-1917">
<p>Assim que uma ou mais conexões são estabelecidas, o novo nó enviará uma mensagem addr contendo o seu próprio endereço IP para seus vizinhos. Seus vizinhos, por suas vezes, retransmitirão a mensagem addr para os vizinhos deles, garantindo que o nó recém-conectado se torne bem conhecido e melhor conectado. Adicionalmente, o nó recém-conectado pode enviar getaddr para os vizinhos, solicitando-lhes que retornem uma lista de endereços IP de outros pares. Dessa maneira, um nó pode encontrar pares para conectar-se e divulgar sua existência na rede para que outros nós o encontrem. A <a href="#address_propagation">Propagação e descoberta de endereço</a> demonstra o protocolo de descoberta de endereço.</p>
</div>
<div id="address_propagation" class="imageblock data-line-1922">
<div class="content">
<img src="images/mbc2_0805.png" alt="AddressPropagation">
</div>
<div class="title">Figure 50. Propagação e descoberta de endereço</div>
</div>
<div class="paragraph data-line-1924">
<p>A node must connect to a few different peers in order to establish diverse paths into the Bitcoin network. Paths are not persistent—nodes come and go—and so the node must continue to discover new nodes as it loses old connections as well as assist other nodes when they bootstrap. Only one connection is needed to bootstrap, because the first node can offer introductions to its peer nodes and those peers can offer further introductions. It&#8217;s also unnecessary and wasteful of network resources to connect to more than a handful of nodes. After bootstrapping, a node will remember its most recent successful peer connections, so that if it is rebooted it can quickly reestablish connections with its former peer network. If none of the former peers respond to its connection request, the node can use the seed nodes to bootstrap again.</p>
</div>
<div class="paragraph data-line-1926">
<p>Em um nó executando o cliente Bitcoin Core, você pode listar as conexões com os pares através do comando getpeerinfo:</p>
</div>
<div class="listingblock data-line-1929">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ bitcoin-cli getpeerinfo</code></pre>
</div>
</div>
<div class="listingblock data-line-1933">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
    {
        "addr" : "85.213.199.39:8333",
        "services" : "00000001",
        "lastsend" : 1405634126,
        "lastrecv" : 1405634127,
        "bytessent" : 23487651,
        "bytesrecv" : 138679099,
        "conntime" : 1405021768,
        "pingtime" : 0.00000000,
        "version" : 70002,
        "subver" : "/Satoshi:0.9.2.1/",
        "inbound" : false,
        "startingheight" : 310131,
        "banscore" : 0,
        "syncnode" : true
    },
    {
        "addr" : "58.23.244.20:8333",
        "services" : "00000001",
        "lastsend" : 1405634127,
        "lastrecv" : 1405634124,
        "bytessent" : 4460918,
        "bytesrecv" : 8903575,
        "conntime" : 1405559628,
        "pingtime" : 0.00000000,
        "version" : 70001,
        "subver" : "/Satoshi:0.8.6/",
        "inbound" : false,
        "startingheight" : 311074,
        "banscore" : 0,
        "syncnode" : false
    }
]</code></pre>
</div>
</div>
<div class="paragraph data-line-1970">
<p>Para desativar o gerenciamento automático dos pares e especificar uma lista de endereços IP, os usuários podem usar a opção -connect=&lt;EndereçoIP&gt; e especificar um ou mais endereços IP. Se essa opção for utilizada, o nó irá conectar-se somente aos endereços IP selecionados, ao invés de automaticamente descobrir e manter conexões com os pares.</p>
</div>
<div class="paragraph data-line-1972">
<p>Se não houver tráfego em uma conexão, os nós periodicamente enviarão uma mensagem para manter a conexão ativa. Se um nó não se comunicar em uma conexão por mais de 90 minutos, assume-se que ele esteja desconectado e um novo par será procurado. Logo, a rede ajusta-se dinamicamente aos nós transitórios e aos problemas da rede, e pode crescer e diminuir organicamente conforme a necessidade, sem precisar de um controle central.</p>
</div>
<div class="paragraph data-line-1974">
<p>=== Nós completos</p>
</div>
<div class="paragraph data-line-1976">
<p>Full nodes are nodes that maintain a full blockchain with all transactions. More accurately, they probably should be called "full blockchain nodes." In the early years of bitcoin, all nodes were full nodes and currently the Bitcoin Core client is a full blockchain node. In the past two years, however, new forms of Bitcoin clients have been introduced that do not maintain a full blockchain but run as lightweight clients. We&#8217;ll examine these in more detail in the next section.</p>
</div>
<div class="paragraph data-line-1978">
<p>Full blockchain nodes maintain a complete and up-to-date copy of the Bitcoin blockchain with all the transactions, which they independently build and verify, starting with the very first block (genesis block) and building up to the latest known block in the network. A full blockchain node can independently and authoritatively verify any transaction without recourse or reliance on any other node or source of information. The full blockchain node relies on the network to receive updates about new blocks of transactions, which it then verifies and incorporates into its local copy of the blockchain.</p>
</div>
<div class="paragraph data-line-1980">
<p>Running a full blockchain node gives you the pure bitcoin experience: independent verification of all transactions without the need to rely on, or trust, any other systems. It&#8217;s easy to tell if you&#8217;re running a full node because it requires more than one hundred gigabytes of persistent storage (disk space) to store the full blockchain. If you need a lot of disk and it takes two to three days to sync to the network, you are running a full node. That is the price of complete independence and freedom from central authority.</p>
</div>
<div class="paragraph data-line-1982">
<p>There are a few alternative implementations of full blockchain Bitcoin clients, built using different programming languages and software architectures. However, the most common implementation is the reference client Bitcoin Core, also known as the Satoshi client. More than 75% of the nodes on the Bitcoin network run various versions of Bitcoin Core. It is identified as "Satoshi" in the sub-version string sent in the version message and shown by the command getpeerinfo as we saw earlier; for example, /Satoshi:0.8.6/.</p>
</div>
<div class="paragraph data-line-1984">
<p>=== Trocando o "Inventário"</p>
</div>
<div class="paragraph data-line-1986">
<p>The first thing a full node will do once it connects to peers is try to construct a complete blockchain. If it is a brand-new node and has no blockchain at all, it only knows one block, the genesis block, which is statically embedded in the client software. Starting with block #0 (the genesis block), the new node will have to download hundreds of thousands of blocks to synchronize with the network and reestablish the full blockchain.</p>
</div>
<div class="paragraph data-line-1988">
<p>O processo de sincronização da blockchain é iniciado a partir da mensagem version, pois ela contém a BestHeight, que é a altura atual (o número de blocos) da blockchain de um nó. Ao ver a mensagem version de seus pares, um nó saberá quantos blocos cada um deles tem e será capaz de comparar com o número de blocos que existem em sua própria blockchain. Os nós pareados trocarão uma mensagem getblocks, a qual contém o hash (a impressão digital) do bloco mais alto de suas blockchains locais. A seguir, um dos pares será capaz de identificar que o hash recebido pertence a um bloco que não está no topo, mas que pertence a um bloco antigo, logo deduzindo que sua blockchain local é mais comprida do que a de seu par.</p>
</div>
<div class="paragraph data-line-1990">
<p>O par com a blockchain mais comprida possui mais blocos que o outro nó e consegue identificar quais blocos o outro nó precisa para ficar "em dia". Ele identificará os primeiros 500 blocos para serem compartilhados e transmitirá seus hashes usando uma mensagem inv (<em>inventory</em>). O nó que estiver com esses blocos em falta irá então recebê-los, ao emitir uma série de mensagens getdata solicitando os dados completos dos blocos, identificando os blocos solicitados usando os hashes da mensagem inv.</p>
</div>
<div class="paragraph data-line-1992">
<p>Vamos assumir, por exemplo, que um nó tenha apenas o bloco gênese. Ele então receberá uma mensagem inv de seus pares contendo os hashes dos próximos 500 blocos na cadeia. Ele começará a solicitar blocos de todos os seus pares conectados, distribuindo o serviço, de maneira que ele não sobrecarregue nenhum de seus pares com requisições. O nó mantém um registro de quantos blocos estão "em trânsito" por conexão com par, que são os blocos que ele solicitou mas não recebeu, certificando-se de que ele não exceda um limite (MAX_BLOCKS_IN_TRANSIT_PER_PEER). Dessa maneira, se ele precisar de muitos blocos, ele só irá solicitar novos blocos quando as solicitações prévias forem completadas, permitindo que os pares controlem o ritmo de updates e não sobrecarregando a rede. À medida que cada bloco é recebido, ele é adicionado à blockchain, conforme veremos no <a href="#blockchain">[blockchain]</a>. À medida que a blockchain local é gradualmente construída, mais blocos são solicitados e recebidos, e o processo continua até que o nó alcance o resto da rede.</p>
</div>
<div class="paragraph data-line-1994">
<p>Esse processo—de comparar a blockchain local com as blockchains dos pares e de adquirir os blocos que estão em falta—acontece sempre que um nó fica offline por algum período de tempo. Seja porque um nó ficou apenas alguns minutos offline e está com apenas alguns blocos em falta, seja porque ficou um mês inteiro offline e está com milhares de blocos em falta, o nó sempre enviará inicialmente uma mensagem getblocks, receberá uma resposta inv e, em seguida, começará a baixar os blocos que faltam. A <a href="#inventory_synchronization">Nó sincronizando a blockchain ao adquirir blocos de um par</a> demonstra o inventário e o protocolo de propagação dos blocos.</p>
</div>
<div id="inventory_synchronization" class="imageblock smallerfifty data-line-1999">
<div class="content">
<img src="images/mbc2_0806.png" alt="InventorySynchronization">
</div>
<div class="title">Figure 51. Nó sincronizando a blockchain ao adquirir blocos de um par</div>
</div>
<div id="spv_nodes" class="paragraph data-line-2002">
<p>=== Nós de Verificação de Pagamento Simplificada (SPV)</p>
</div>
<div class="paragraph data-line-2004">
<p>Not all nodes have the ability to store the full blockchain. Many Bitcoin clients are designed to run on space- and power-constrained devices, such as smartphones, tablets, or embedded systems. For such devices, a <em>simplified payment verification</em> (SPV) method is used to allow them to operate without storing the full blockchain. These types of clients are called SPV clients or lightweight clients. As bitcoin adoption surges, the SPV node is becoming the most common form of Bitcoin node, especially for bitcoin wallets.</p>
</div>
<div class="paragraph data-line-2006">
<p>Os nós de SPV fazem o download apenas dos cabeçalhos dos blocos, eles não baixam as transações incluídas em cada bloco. A cadeia de blocos resultante, sem as transações, é 1.000 vezes menor do que a blockchain completa. Os nós de SPV não são capazes de construir uma imagem completa de todas as UTXOs que estão disponíveis para serem gastas, visto que eles não conhecem todas as transações da rede. Os nós de SPV verificam as transações usando um método levemente diferente, que depende dos pares para fornecerem, sob demanda, visualizações parciais de partes relevantes da blockchain.</p>
</div>
<div class="paragraph data-line-2008">
<p>Como uma analogia, um nó completo é como se fosse um turista em uma cidade estranha, equipado com um mapa detalhado incluindo todas as ruas e todos os endereços da cidade. Em comparação, um nó de SPV é como se fosse um turista em uma cidade estranha, pedindo a pessoas aleatórias na rua orientações de como chegar a um lugar, enquanto ele sabe apenas o nome de uma avenida principal. Embora ambos os turistas possam verificar que uma rua existe ao visitá-la, o turista sem o mapa não sabe o que se passa em cada rua colateral e não sabe quais outras ruas existem na cidade. Ao chegar na frente da Avenida da Igreja, nº23, o turista sem o mapa não tem como saber se existem outros endereços "Avenida da Igreja, nº23" na cidade ou se ele realmente está no endereço correto. A melhor solução para o turista sem mapa é pedir orientações para um número suficiente de pessoas e torcer para que algumas delas não estejam tentando lhe passar a perna.</p>
</div>
<div class="paragraph data-line-2010">
<p>A verificação de pagamento simplificada (SPV) verifica as transações através de referências à <em>profundidade</em> delas na blockchain, em vez da <em>altura</em>. Enquanto um nó com a blockchain completa construirá uma cadeia totalmente verificada contendo milhares de blocos e transações que podem ser seguidas na blockchain (retrospectivamente no tempo) até o bloco gênese, um nó de SPV verificará a cadeia de todos os blocos (mas não todas as transações) e ligará essa cadeia à transação de interesse.</p>
</div>
<div class="paragraph data-line-2012">
<p>Por exemplo, ao examinar uma transação no bloco 300.000, um nó completo segue todos os 300.000 blocos até o bloco gênese e constrói um banco de dados completo de UTXOs, estabelecendo a validade da transação ao confirmar que a UTXO ainda não foi gasta. Um nó de SPV não consegue validar se a UTXO ainda não foi gasta. Ao invés disso, o nó de SPV estabelecerá uma ligação entre a transação e o bloco que a contém, usando um <em>caminho de merkle</em> (ver <a href="#merkle_trees">[merkle_trees]</a>). Então, o nó de SPV aguarda até ver os seis blocos, do 300.001 até o 300.006, empilhados em cima do bloco contendo a transação e verifica-a ao estabelecer sua profundidade sob os blocos 300.006 a 300.001. O fato de que outros nós na rede aceitaram o bloco 300.000 e então fizeram o trabalho necessário para produzir mais seis blocos em cima dele é a prova, ainda que indireta, de que a transação não foi um gasto duplo.</p>
</div>
<div class="paragraph data-line-2014">
<p>An SPV node cannot be persuaded that a transaction exists in a block when the transaction does not in fact exist. The SPV node establishes the existence of a transaction in a block by requesting a merkle path proof and by validating the Proof-of-Work in the chain of blocks. However, a transaction&#8217;s existence can be "hidden" from an SPV node. An SPV node can definitely prove that a transaction exists but cannot verify that a transaction, such as a double-spend of the same UTXO, doesn&#8217;t exist because it doesn&#8217;t have a record of all transactions. This vulnerability can be used in a denial-of-service attack or for a double-spending attack against SPV nodes. To defend against this, an SPV node needs to connect randomly to several nodes, to increase the probability that it is in contact with at least one honest node. This need to randomly connect means that SPV nodes also are vulnerable to network partitioning attacks or Sybil attacks, where they are connected to fake nodes or fake networks and do not have access to honest nodes or the real Bitcoin network.</p>
</div>
<div class="paragraph data-line-2016">
<p>Para a maioria dos fins práticos, os nós de SPV bem conectados são seguros o suficiente, alcançando um equilíbrio entre necessidade de recursos, praticidade e segurança. Para uma segurança infalível, no entanto, nada é melhor do que executar um nó com a blockchain completa.</p>
</div>
<div class="admonitionblock tip data-line-2019">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-2020">
<p>Um nó com a blockchain completa verifica uma transação ao checar toda a cadeia de milhares de blocos abaixo dela, para ter a certeza de que a UTXO já não foi gasta anteriormente, enquanto um nó de SPV verifica uma transação ao checar quão profundo o bloco da transação está enterrado sob uma porção de blocos acima dele.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-2023">
<p>Para receber os cabeçalhos dos blocos, os nós de SPV usam uma mensagem getheaders, em vez da mensagem getblocks. O par que responder enviará até 2.000 cabeçalhos de blocos usando uma única mensagem headers. O processo é o mesmo que um nó completo utiliza para receber blocos completos. Os nós de SPV também definem um filtro na conexão com os pares, para filtrar a transmissão de blocos futuros e transações enviadas pelos pares. Quaisquer transações de interesse são recebidas usando uma requisição getdata. Em resposta, o par gera uma mensagem tx contendo as transações. A <a href="#spv_synchronization">Nó de SPV sincronizando os cabeçalhos dos blocos</a> mostra a sincronização dos cabeçalhos dos blocos.</p>
</div>
<div class="paragraph data-line-2025">
<p>Because SPV nodes need to retrieve specific transactions in order to selectively verify them, they also create a privacy risk. Unlike full blockchain nodes, which collect all transactions within each block, the SPV node&#8217;s requests for specific data can inadvertently reveal the addresses in their wallet. For example, a third party monitoring a network could keep track of all the transactions requested by a wallet on an SPV node and use those to associate Bitcoin addresses with the user of that wallet, destroying the user&#8217;s privacy.</p>
</div>
<div id="spv_synchronization" class="imageblock data-line-2029">
<div class="content">
<img src="images/mbc2_0807.png" alt="SPVSynchronization">
</div>
<div class="title">Figure 52. Nó de SPV sincronizando os cabeçalhos dos blocos</div>
</div>
<div class="paragraph data-line-2031">
<p>Logo após a introdução dos nós de SPV e dos nós leves, os desenvolvedores do bitcoin adicionaram uma funcionalidade conhecida como <em>filtros de bloom</em>, com o objetivo de resolver os problemas de privacidade dos nós de SPV. Os filtros de bloom permitem que os nós de SPV recebam um subconjunto de transações sem precisarem revelar em quais endereços eles estão interessados, através de um mecanismo de filtragem que utiliza probabilidades ao invés de padrões fixos.</p>
</div>
<div id="bloom_filters" class="paragraph data-line-2034">
<p>=== Filtros de Bloom</p>
</div>
<div class="paragraph data-line-2036">
<p>A bloom filter is a probabilistic search filter that offers an efficient way to express a search pattern while protecting privacy. They are used by SPV nodes to ask their peers for transactions matching a specific pattern, without revealing exactly which addresses, keys, or transactions they are searching for.</p>
</div>
<div class="paragraph data-line-2038">
<p>Na nossa analogia anterior, uma turista sem um mapa está pedindo orientações para um endereço específico, "Rua da Igreja, 23". Se ela pedir orientações para estranhos nessa rua, ela inadvertidamente revelará seu destino. Um filtro de bloom seria como se ela perguntasse, "Existem ruas nessa vizinhança cujo nome termina em E-J-A?" Uma pergunta como essa revela um pouco menos sobre o destino desejado do que se ela perguntasse especificamente pela "Rua da Igreja, 23". Usando essa técnica, a turista poderia especificar o endereço desejado em mais detalhes, como "termina em R-E-J-A", ou em menos detalhes, como "termina em A". Ao variar a precisão de sua busca, a turista revela mais ou menos informações, à custa de resultados mais ou menos específicos. Se ela pedir orientações com um padrão de busca menos específico, ela receberá muito mais endereços possíveis e terá uma privacidade maior, mas muitos dos resultados serão irrelevantes. Se ela pedir orientações com um padrão de busca muito específico, ela receberá poucos resultados, mas perderá em privacidade.</p>
</div>
<div class="paragraph data-line-2040">
<p>Os filtros de bloom cumprem essa função ao permitir que um nó de SPV especifique um padrão de busca para transações que possa ser refinado de acordo com precisão ou privacidade. Um filtro de bloom mais específico produzirá resultados precisos, mas à custa de revelar quais endereços estão na carteira do usuário. Um filtro de bloom menos específico produzirá mais dados sobre mais transações, muitas delas irrelevantes para o nó, mas permitirá que o nó mantenha uma melhor privacidade.</p>
</div>
<div class="paragraph data-line-2042">
<p>==== Como Funcionam os Filtros de Bloom</p>
</div>
<div class="paragraph data-line-2044">
<p>Os filtros de bloom são implementados como um array (uma lista) de tamanho variável de N dígitos binários (um campo de bits) e um número variável de M funções de hash. As funções de hash são projetadas para sempre produzir um output entre 1 e N, correspondendo ao array de dígitos binários. As funções de hash são geradas deterministicamente, de maneira que qualquer nó implementando um filtro de bloom sempre usará as mesmas funções de hash e sempre receberá os mesmos resultados para um input específico. Ao escolher filtros de bloom de diferentes comprimentos (N) e um número diferente (M) de funções de hash, o filtro de bloom pode ser melhorado, variando o nível de acurácia, e, portanto, de privacidade.</p>
</div>
<div class="paragraph data-line-2046">
<p>Na <a href="#bloom1">Um exemplo de um filtro de bloom simples, com um campo de 16 bits e três funções de hash</a>, usamos um array muito pequeno de 16 bits e um conjunto de três funções de hash para demonstrar como os filtros de bloom funcionam.</p>
</div>
<div id="bloom1" class="imageblock data-line-2050">
<div class="content">
<img src="images/mbc2_0808.png" alt="Bloom1">
</div>
<div class="title">Figure 53. Um exemplo de um filtro de bloom simples, com um campo de 16 bits e três funções de hash</div>
</div>
<div class="paragraph data-line-2052">
<p>O filtro de bloom é inicializado de maneira que o array de bits seja todo de zeros. Para adicionar um padrão ao filtro de bloom, o padrão é transformado em hash por cada função de hash, uma depois da outra. A aplicação da primeira função de hash no input resulta em um número entre 1 e N. O bit correspondente no array (indexada de 1 a N) é encontrado e definido como 1, registrando o output da função de hash. A seguir, a próxima função de hash é usada para definir outro bit, e assim por diante. Uma vez que todas as M funções de hash forem aplicadas, o padrão de busca será "registrado" no filtro de bloom como M bits que mudaram de 0 para 1.</p>
</div>
<div class="paragraph data-line-2054">
<p>A <a href="#bloom2">Adicionando um padrão "A" para o nosso filtro de bloom simples</a> é um exemplo da adição de um padrão "A" para o filtro de bloom simples mostrado na <a href="#bloom1">Um exemplo de um filtro de bloom simples, com um campo de 16 bits e três funções de hash</a>.</p>
</div>
<div class="paragraph data-line-2056">
<p>Adicionar um segundo padrão é tão simples quanto repetir esse processo. O padrão é transformado em hash por cada função de hash de cada vez e o resultado é registrado ao se definir os bits como 1. Observe que à medida que o filtro de bloom é preenchido com mais padrões, um resultado de função de hash pode coincidir com um bit que já esteja definido como 1, neste caso o bit não é modificado. Em essência, à medida que mais padrões gravam em bits sobreponentes, o filtro de bloom começa a se tornar saturado com mais bits definidos como 1 e a acurácia do filtro diminui. É por isso que o filtro é uma estrutura de dados probabilística—ele se torna menos preciso à medida que mais padrões são adicionados. A acurácia depende do número de padrões adicionados versus o tamanho do array de bits (N) e o número de funções de hash (M). Um array de bits maior e mais funções de hash podem registrar mais padrões com maior acurácia. Um array de bits menor ou menos funções de hash registrarão menos padrões e terão menor acurácia.</p>
</div>
<div id="bloom2" class="imageblock data-line-2060">
<div class="content">
<img src="images/mbc2_0809.png" alt="Bloom2">
</div>
<div class="title">Figure 54. Adicionando um padrão "A" para o nosso filtro de bloom simples</div>
</div>
<div class="paragraph data-line-2062">
<p>A <a href="#bloom3">Adicionando um segundo padrão "B" para o nosso filtro de bloom simples</a> é um exemplo da adição de um segundo padrão "B" para o filtro de bloom simples.</p>
</div>
<div id="bloom3" class="imageblock smallereighty data-line-2067">
<div class="content">
<img src="images/mbc2_0810.png" alt="Bloom3">
</div>
<div class="title">Figure 55. Adicionando um segundo padrão "B" para o nosso filtro de bloom simples</div>
</div>
<div class="paragraph data-line-2069">
<p>Para testar se um padrão faz parte de um filtro de bloom, o padrão é transformado em hash por cada função de hash e o padrão de bits resultante é testado contra o array de bits. Se todos os bits indexados pelas funções de hash forem definidos como 1, então o padrão é <em>provavelmente</em> registrado no filtro de bloom. Como os bits podem ser definidos devido à sobreposição de múltiplos padrões, a resposta não é uma certeza, ela é probabilística. Em outras palavras, uma correspondência positiva no filtro de bloom é um "Talvez, Sim".</p>
</div>
<div class="paragraph data-line-2071">
<p>A <a href="#bloom4">Testando a existência de um padrão "X" no filtro de bloom. O resultado é uma correspondência positiva probabilística, significando "Talvez".</a> é um exemplo que testa a existência do padrão "X" no filtro de bloom simples. Os bits correspondentes estão definidos como 1, então o padrão é provavelmente uma correspondência.</p>
</div>
<div id="bloom4" class="imageblock smallereighty data-line-2076">
<div class="content">
<img src="images/mbc2_0811.png" alt="Bloom4">
</div>
<div class="title">Figure 56. Testando a existência de um padrão "X" no filtro de bloom. O resultado é uma correspondência positiva probabilística, significando "Talvez".</div>
</div>
<div class="paragraph data-line-2078">
<p>Por outro lado, se um padrão for testado contra um filtro de bloom e qualquer um dos bits estiver definido como 0, isso prova que o padrão não foi registrado no filtro de bloom. O resultado negativo não é uma probabilidade, ele é uma certeza. Em outras palavras, uma correspondência negativa no filtro de bloom é um "Definitivamente Não!".</p>
</div>
<div class="paragraph data-line-2080">
<p>A <a href="#bloom5">Testando a existência do padrão "Y" no filtro de bloom. O resultado é uma correspondência negativa definitiva, significando "Definitivamente Não!"</a> é um exemplo que testa a existência do padrão "Y" no filtro de bloom simples. Um dos bits correspondentes está definido como 0, então o padrão definitivamente não é uma correspondência.</p>
</div>
<div id="bloom5" class="imageblock data-line-2084">
<div class="content">
<img src="images/mbc2_0812.png" alt="mbc2 0812">
</div>
<div class="title">Figure 57. Testando a existência do padrão "Y" no filtro de bloom. O resultado é uma correspondência negativa definitiva, significando "Definitivamente Não!"</div>
</div>
<div class="paragraph data-line-2086">
<p>=== Como os Nós de SPV usam os Filtros de Bloom</p>
</div>
<div class="paragraph data-line-2088">
<p>Os filtros de bloom são usados para filtrar as transações (e os blocos que as contêm) que um nó de SPV recebe de seus pares, selecionando apenas as transações de interesse para o nó de SPV, sem revelar em quais endereços ou chaves ele está interessado.</p>
</div>
<div class="paragraph data-line-2090">
<p>Um nó de SPV inicializará um filtro de bloom como "vazio"; nesse estado, o filtro de bloom não corresponderá a nenhum padrão. A seguir, o nó de SPV fará uma lista de todos os endereços, chaves e hashes nos quais ele está interessado. Ele fará isso extraindo o hash da chave pública, o hash do script e os IDs de transação de qualquer UTXO controlada por sua carteira. O nó de SPV então adiciona cada um deles ao filtro de bloom, de modo que o filtro de bloom irá "encontrar uma correspondência" caso esses padrões estiverem presentes em uma transação, sem revelar os padrões.</p>
</div>
<div class="paragraph data-line-2092">
<p>The SPV node will then send a filterload message to the peer, containing the bloom filter to use on the connection. On the peer, bloom filters are checked against each incoming transaction. The full node checks several parts of the transaction against the bloom filter, looking for a match including:</p>
</div>
<div class="ulist data-line-2094">
<ul>
<li class="data-line-2094">
<p>O ID da transação</p>
</li>
<li class="data-line-2095">
<p>Os componentes de dados dos scripts de travamento de cada uma das saídas da transação (cada chave e cada hash no script)</p>
</li>
<li class="data-line-2096">
<p>Cada uma das entradas da transação</p>
</li>
<li class="data-line-2097">
<p>Cada um dos componentes de dados de assinatura de entrada (ou scripts de testemunha)</p>
</li>
</ul>
</div>
<div class="paragraph data-line-2099">
<p>Ao serem verificados contra todos esses componentes, os filtros de bloom podem ser usados para buscar correspondências de hashes de chave pública, scripts, valores de OP_RETURN, chaves públicas em assinaturas ou qualquer componente futuro de um contrato inteligente ou de um script complexo.</p>
</div>
<div class="paragraph data-line-2101">
<p>Depois que um filtro é estabelecido, o par testará cada saída da transação com o filtro de bloom. Apenas as transações que correspondem ao filtro são enviadas para o nó.</p>
</div>
<div class="paragraph data-line-2103">
<p>Em resposta a uma mensagem getdata vindo do nó, os pares enviarão uma mensagem merkleblock que contém somente os cabeçalhos de bloco para os blocos correspondentes ao filtro e um caminho de merkle (ver <a href="#merkle_trees">[merkle_trees]</a>) para cada transação correspondente. O par também enviará mensagens tx contendo as transações que correspondem ao filtro.</p>
</div>
<div class="paragraph data-line-2105">
<p>À medida que o nó completo envia transações para o nó de SPV, o nó de SPV descarta todos os falsos positivos e usa as transações correspondentes corretas para atualizar o seu conjunto UTXO e o saldo da carteira. Ao atualizar sua própria visão do conjunto UTXO, ele também modifica o filtro de bloom para filtrar quaisquer transações futuras que façam referência à UTXO que ele acabou de encontrar. O nó completo então usa o novo filtro de bloom para filtrar as novas transações e todo o processo se repete.</p>
</div>
<div class="paragraph data-line-2107">
<p>O nó definindo o filtro de bloom pode adicionar padrões ao filtro de maneira interativa ao enviar uma mensagem filteradd. Para limpar o filtro de bloom, o nó pode enviar uma mensagem filterclear. Como não é possível remover um padrão de um filtro de bloom, caso um padrão não seja mais desejado, um nó deverá limpar o filtro atual e reenviar um novo filtro de bloom.</p>
</div>
<div class="paragraph data-line-2109">
<p>O protocolo de rede e o mecanismo de filtro de bloom para nodes SPV são definidos em <a href="https://bit.ly/1x6qCiO" data-href="https://bit.ly/1x6qCiO">BIP-37(Peer Services)</a>.</p>
</div>
<div class="paragraph data-line-2112">
<p>=== Nós de SPV e Privacidade</p>
</div>
<div class="paragraph data-line-2114">
<p>Os nós que implementam a verificação de pagamento simplificada têm uma privacidade mais fraca do que um nó completo. Um nó completo recebe todas as transações e, portanto, não revela se está usando algum endereço de sua carteira. Por outro lado, um nó de SPV recebe uma lista filtrada de transações relacionadas aos endereços que estão em sua carteira. Como resultado, ele reduz a privacidade do proprietário.</p>
</div>
<div class="paragraph data-line-2116">
<p>Os filtros de bloom são uma maneira de reduzir a perda de privacidade. Sem eles, um nó de SPV teria que listar explicitamente os endereços nos quais ele estivesse interessado, criando uma grave violação de privacidade. No entanto, mesmo com os filtros de bloom, um adversário pode coletar informações suficientes ao longo do tempo, descobrindo quais são os endereços que estão contidos na carteira do cliente de SPV. Para fazer isso, ele pode monitorar o tráfego de um cliente de SPV ou conectar-se diretamente a ele como um nó na rede P2P.</p>
</div>
<div class="paragraph data-line-2118">
<p>=== Conexões Criptografadas e Autenticadas</p>
</div>
<div class="paragraph data-line-2120">
<p>Most new users of bitcoin assume that the network communications of a Bitcoin node are encrypted. In fact, the original implementation of bitcoin communicates entirely in the clear. While this is not a major privacy concern for full nodes, it is a big problem for SPV nodes.</p>
</div>
<div class="paragraph data-line-2122">
<p>Como forma de aumentar a privacidade e a segurança da rede P2P do bitcoin, existem duas soluções que fornecem criptografia das comunicações: <em>Transporte Tor</em> e <em>Autenticação e Criptografia P2P</em> com a BIP-150 e a BIP-151.</p>
</div>
<div class="paragraph data-line-2124">
<p>==== Transporte Tor</p>
</div>
<div class="paragraph data-line-2126">
<p>O Tor, que significa <em>A Rede de Roteamento Cebola</em> (em inglês, <em>The Onion Routing network</em>), é um projeto de software e de rede que oferece criptografia e encapsulamento de dados por meio de caminhos de rede randomizados que oferecem anonimato, irrastreabilidade e privacidade.</p>
</div>
<div class="paragraph data-line-2128">
<p>Bitcoin Core offers several configuration options that allow you to run a Bitcoin node with its traffic transported over the Tor network. In addition, Bitcoin Core can also offer a Tor hidden service allowing other Tor nodes to connect to your node directly over Tor.</p>
</div>
<div class="paragraph data-line-2130">
<p>A partir da versão 0.12 do Bitcoin Core, um nó oferecerá um serviço oculto do Tor automaticamente se ele for capaz de se conectar a um serviço Tor local. Se você tiver o Tor instalado e o processo do Bitcoin Core for executado como um usuário com permissões adequadas para acessar o cookie de autenticação do Tor, ele deve funcionar automaticamente. Use a flag debug para ativar a depuração do Bitcoin Core para o serviço do Tor, dessa maneira:</p>
</div>
<div class="listingblock data-line-2132">
<div class="content">
<pre>$ bitcoind --daemon --debug=tor</pre>
</div>
</div>
<div class="paragraph data-line-2136">
<p>Você deverá ver a mensagem "tor: ADD_ONION successful" nos logs, indicando que o Bitcoin Core adicionou um serviço oculto à rede Tor.</p>
</div>
<div class="paragraph data-line-2138">
<p>Você pode encontrar mais instruções sobre como executar o Bitcoin Core como um serviço oculto do Tor na documentação do Bitcoin Core (<em>docs / tor.md</em>) e em vários tutoriais online.</p>
</div>
<div class="paragraph data-line-2140">
<p>==== Autenticação e Criptografia Par-a-Par</p>
</div>
<div class="paragraph data-line-2142">
<p>Two Bitcoin Improvement Proposals, BIP-150 and BIP-151, add support for P2P authentication and encryption in the bitcoin P2P network. These two BIPs define optional services that may be offered by compatible Bitcoin nodes. BIP-151 enables negotiated encryption for all communications between two nodes that support BIP-151. BIP-150 offers optional peer authentication that allows nodes to authenticate each other&#8217;s identity using ECDSA and private keys. BIP-150 requires that prior to authentication the two nodes have established encrypted communications as per BIP-151.</p>
</div>
<div class="paragraph data-line-2144">
<p>As of February 2021, BIP-150 and BIP-151 are not implemented in Bitcoin Core. However, the two proposals have been implemented by at least one alternative Bitcoin client named bcoin.</p>
</div>
<div class="paragraph data-line-2146">
<p>A BIP-150 e a BIP-151 permitem que os usuários executem clientes de SPV que se conectam a um nó completo de confiança, usando criptografia e autenticação para proteger a privacidade do cliente de SPV.</p>
</div>
<div class="paragraph data-line-2148">
<p>Additionally, authentication can be used to create networks of trusted Bitcoin nodes and prevent Man-in-the-Middle attacks. Finally, P2P encryption, if deployed broadly, would strengthen the resistance of bitcoin to traffic analysis and privacy-eroding surveillance, especially in totalitarian countries where internet use is heavily controlled and monitored.</p>
</div>
<div class="paragraph data-line-2150">
<p>O padrão é definido na <a href="https://github.com/bitcoin/bips/blob/master/bip-0150.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0150.mediawiki">BIP-150 (Autenticação de Par)</a> e na <a href="https://github.com/bitcoin/bips/blob/master/bip-0151.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0151.mediawiki">BIP-151 (Criptografia de Comunicação Par-a-Par)</a>.</p>
</div>
<div class="paragraph data-line-2152">
<p>=== Pools de Transações</p>
</div>
<div class="paragraph data-line-2154">
<p>Almost every node on the Bitcoin network maintains a temporary list of unconfirmed transactions called the <em>memory pool</em>, <em>mempool</em>, or <em>transaction pool</em>. Nodes use this pool to keep track of transactions that are known to the network but are not yet included in the blockchain. For example, a wallet node will use the transaction pool to track incoming payments to the user&#8217;s wallet that have been received on the network but are not yet confirmed.</p>
</div>
<div class="paragraph data-line-2156">
<p>À medida que as transações são recebidas e verificadas, elas vão sendo adicionadas ao pool de transações e retransmitidas aos nós vizinhos para serem propagadas para a rede.</p>
</div>
<div class="paragraph data-line-2158">
<p>Algumas implementações de nós também mantêm uma pool separada de transações órfãs. Caso uma entrada de transação referir-se a uma transação que ainda não seja conhecida, como, por exemplo, uma transação pai desconhecida, a transação órfã será armazenada temporariamente na pool de transações órfãs até que a transação pai seja recebida.</p>
</div>
<div class="paragraph data-line-2160">
<p>Quando uma transação é adicionada à pool de transações, verifica-se na pool de transações órfãs se há quaisquer transações órfãs com referências para as saídas dessa transação recém-adicionada, em outras palavras, verifica-se se há transações que sejam filhas dessa transação. Quaisquer transações órfãs correspondentes são então validadas. Se elas forem válidas, elas são removidas da pool de transações órfãs e são adicionadas à pool de transações, completando a cadeia que iniciou com a transação pai. Na presença de uma transação recém-adicionada, que não é mais uma transação órfã, o processo é repetido recursivamente em busca de quaisquer outras transações descendentes, até que não se encontre mais nenhuma descendente. Através desse processo, a chegada de uma transação pai desencadeia uma reconstrução em cascata de uma cadeia completa de transações interdependentes ao reunir as transações órfãs com suas transações pais ao longo de toda a cadeia.</p>
</div>
<div class="paragraph data-line-2162">
<p>Tanto a pool de transações quanto a pool de transações órfãs (quando implementada) são armazenadas na memória local e não são salvas em um armazenamento persistente; em vez disso, elas são preenchidas dinamicamente a partir das mensagens recebidas da rede. Quando um nó é iniciado, ambas as pools estão vazias e passam a ser gradualmente preenchidas com as novas transações que são recebidas da rede.</p>
</div>
<div class="paragraph data-line-2164">
<p>Some implementations of the Bitcoin client also maintain an UTXO database or pool, which is the set of all unspent outputs on the blockchain. Bitcoin Core users will find it in the chainstate/ folder of their client&#8217;s data directory. Although the name "UTXO pool" sounds similar to the transaction pool, it represents a different set of data. Unlike the transaction and orphan pools, the UTXO pool is not initialized empty but instead contains millions of entries of unspent transaction outputs, everything that is unspent from all the way back to the genesis block. The UTXO pool may be housed in local memory or as an indexed database table on persistent storage.</p>
</div>
<div class="paragraph data-line-2166">
<p>Enquanto a pool de transações e a pool de transações órfãs representam uma perspectiva local de um nó isolado, e podem variar significativamente de nó para nó dependendo de quando o nó foi iniciado ou reiniciado, a pool de UTXOs representa o consenso emergente da rede e, portanto, apresentará pouca variação entre os nós. Além disso, a pool de transações e a pool de transações órfãs contêm somente transações não confirmadas, enquanto a pool de UTXOs contém somente saídas confirmadas.</p>
</div>
<div id="blockchain" class="paragraph data-line-2169">
<p>== A Blockchain</p>
</div>
<div class="paragraph data-line-2171">
<p>=== Introdução</p>
</div>
<div class="paragraph data-line-2173">
<p>A estrutura de dados da blockchain é uma lista ordenada de blocos de transações, onde cada bloco está ligado ao bloco anterior. A blockchain pode ser armazenada como um arquivo simples ou em um banco de dados simples. O cliente Bitcoin Core armazena os metadados da blockchain usando o banco de dados LevelDB do Google. Os blocos são interligados de trás para frente, ou seja, cada bloco se refere ao bloco anterior na cadeia. A blockchain é frequentemente visualizada como uma pilha vertical de blocos, com os blocos empilhados uns sobre os outros e com o primeiro bloco servindo como a fundação (o alicerce) que suporta a pilha de blocos. A visualização dos blocos empilhados uns sobre os outros resulta no uso de termos como "altura" para se referir à distância em relação ao primeiro bloco, e "topo" ou "ponta" para se referir ao bloco que foi adicionado mais recentemente.</p>
</div>
<div class="paragraph data-line-2175">
<p>Cada bloco contido na blockchain é identificado por um hash, que é gerado utilizando-se o algoritmo de hash criptográfico SHA256 no cabeçalho do bloco. Cada bloco também contém uma referência ao bloco anterior, conhecido como bloco <em>pai</em>, através do campo "hash do bloco anterior" que existe no cabeçalho do bloco. Em outras palavras, cada bloco contém o hash de seu bloco pai dentro de seu próprio cabeçalho. A sequência de hashes ligando cada bloco ao seu bloco pai cria uma cadeia que pode ser seguida retrogradamente até o primeiro bloco que já foi criado, que é conhecido como o <em>bloco gênese</em>.</p>
</div>
<div class="paragraph data-line-2177">
<p>Embora um bloco tenha apenas um bloco pai, ele pode temporariamente ter múltiplos blocos filhos. Cada um dos blocos filhos refere-se ao mesmo bloco pai e contém o mesmo hash (o hash do bloco pai) no campo "hash do bloco anterior". Múltiplos blocos filhos surgem quando há uma "bifurcação" da blockchain, uma situação temporária que ocorre quando diferentes blocos são descobertos quase que simultaneamente por diferentes mineradores (ver <a href="#forks">[forks]</a>). No final, somente um bloco filho será incluído na blockchain e a "bifurcação" deixará de existir. Apesar de cada bloco poder ter mais do que um filho, cada bloco pode ter somente um pai. Isso ocorre porque um bloco possui apenas um único campo "hash do bloco anterior", que é uma referência ao seu bloco pai único.</p>
</div>
<div class="paragraph data-line-2179">
<p>O campo "hash do bloco anterior" está dentro do cabeçalho do bloco e, portanto, afeta o hash do bloco <em>atual</em>. Se a identidade de um pai muda, a identidade de um filho muda também. Quando o bloco pai é modificado de qualquer maneira, o hash do bloco pai muda. O hash modificado do bloco pai exige uma mudança no campo "hash do bloco anterior" do bloco filho. Isso, por sua vez, faz com que o hash do bloco filho mude, o que requer uma mudança no campo "hash do bloco anterior" do bloco neto, que, por sua vez, muda o hash do bloco neto, e assim por diante. Esse efeito dominó garante que, assim que um bloco tiver muitas gerações o sucedendo, ele não possa ser modificado sem que a pessoa que modificou seja forçada a calcular novamente todos os blocos subsequentes. Como esse novo cálculo exigiria um enorme processamento computacional (e, portanto, um enorme consumo de energia), a existência de uma longa cadeia de blocos faz com que a história profunda da blockchain seja imutável, o que é uma característica-chave para a segurança do bitcoin.</p>
</div>
<div class="paragraph data-line-2181">
<p>Uma maneira de imaginar a blockchain seria como um solo, onde os blocos seriam camadas de uma formação geológica, ou como uma amostra do núcleo de uma geleira. As camadas da superfície podem mudar com as estações, ou mesmo serem destruídas antes de terem tempo para se assentarem. Mas quanto mais profundo escavarmos, veremos que maior será a estabilidade das camadas geológicas. Quando você escavar algumas centenas de metros de profundidade, você estará olhando para uma fotografia do passado que permaneceu intocada por milhões de anos. Na blockchain, pode acontecer que os poucos blocos mais recentes tenham que ser revisados, caso haja um novo cálculo da cadeia devido a uma bifurcação. Os seis blocos do topo são como os centímetros mais superficiais do solo. Mas quanto mais fundo você penetrar na blockchain, além dos seis blocos, cada vez menor se torna a probabilidade desses blocos se modificarem. Após 100 blocos de profundidade, há tanta estabilidade que uma transação coinbase—uma transação contendo bitcoins recém-minerados—pode ser gasta. Após alguns milhares de blocos de profundidade (cerca de um mês), a blockchain já é considerada uma história estabelecida, para todos os fins práticos. Apesar de o protocolo sempre permitir que uma cadeia seja desfeita por uma cadeia mais longa, e apesar de sempre existir a possibilidade de qualquer bloco ser revertido, a probabilidade de ocorrência de um evento como esse diminui à medida que o tempo passa, até que ela se torne ínfima.</p>
</div>
<div class="paragraph data-line-2183">
<p>=== Estrutura de um Bloco</p>
</div>
<div class="paragraph data-line-2185">
<p>Um bloco é uma estrutura de dados <em>container</em> que agrega as transações para inclusão no livro-razão público, a blockchain. O bloco é composto por um cabeçalho, contendo metadados, seguido por uma longa lista de transações que constituem a maior parte de seu tamanho. O cabeçalho do bloco tem 80 bytes, enquanto uma transação tem, em média, pelo menos 400 bytes e um bloco contém, em média, mais de 1.900 transações. Um bloco completo, com todas as transações, é portanto 10.000 vezes maior do que o cabeçalho do bloco. A <a href="#block_structure1">A estrutura de um bloco</a> descreve a estrutura de um bloco.</p>
</div>
<table id="block_structure1" class="tableblock frame-all grid-all stretch pagebreak-before data-line-2191">
<caption class="title">Table 24. A estrutura de um bloco</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tamanho</th>
<th class="tableblock halign-left valign-top">Campo</th>
<th class="tableblock halign-left valign-top">Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tamanho do Bloco</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O tamanho do bloco, em bytes, após esse campo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">80 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cabeçalho do Bloco</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vários campos formam o cabeçalho do bloco</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1&#x2013;9 bytes (VarInt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contador de Transações</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Número de transações que o bloco contém</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Variável</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transações</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">As transações registradas nesse bloco</p></td>
</tr>
</tbody>
</table>
<div id="block_header" class="paragraph data-line-2200">
<p>=== Cabeçalho do Bloco</p>
</div>
<div class="paragraph data-line-2202">
<p>O cabeçalho do bloco consiste em três conjuntos de metadados de bloco. Primeiro, existe uma referência ao hash do bloco anterior, que conecta esse bloco ao bloco anterior na blockchain. O segundo conjunto de metadados, a <em>dificuldade</em>, a <em>data e hora (timestamp)</em> e o <em>nonce</em>, está relacionado à competição da mineração, conforme detalhado no <a href="#mining">[mining]</a>. A terceira parte dos metadados é a raiz da árvore de merkle, uma estrutura de dados usada para resumir de maneira eficiente todas as transações contidas no bloco. A <a href="#block_header_structure_ch09">A estrutura do cabeçalho do bloco</a> descreve a estrutura de um cabeçalho de bloco.</p>
</div>
<table id="block_header_structure_ch09" class="tableblock frame-all grid-all stretch data-line-2208">
<caption class="title">Table 25. A estrutura do cabeçalho do bloco</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tamanho</th>
<th class="tableblock halign-left valign-top">Campo</th>
<th class="tableblock halign-left valign-top">Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Versão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Um número de versão para servir como referência nas atualizações de software/protocolo.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hash do Bloco Anterior</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uma referência ao hash do bloco anterior (bloco pai) na cadeia</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Raiz de Merkle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Um hash da raiz da árvore de merkle das transações desse bloco</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data e Hora (timestamp)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O momento aproximado em que este bloco foi criado (em segundos decorridos desde a Época Unix)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alvo de Dificuldade</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O alvo de dificuldade do algoritmo de Prova-de-Trabalho para esse bloco</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nonce</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Um contador usado para o algoritmo de Prova-de-Trabalho</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-2218">
<p>O nonce, o alvo de dificuldade e a data e hora (<em>timestamp</em>) são usados no processo de mineração e serão discutidos em maiores detalhes no <a href="#mining">[mining]</a>.</p>
</div>
<div id="block_hash" class="paragraph data-line-2221">
<p>=== Identificadores dos Blocos: Hash do Cabeçalho e Altura do Bloco</p>
</div>
<div class="paragraph data-line-2223">
<p>O identificador primário de um bloco é o seu hash criptográfico, uma impressão digital que é criada ao se fazer um <em>hashing</em> duplo do cabeçalho do bloco usando o algoritmo SHA256. O hash resultante tem 32 bytes e é chamado de <em>hash do bloco</em>, entretanto, seria mais preciso chamá-lo de <em>hash do cabeçalho do bloco</em>, <span role="keep-together">pois apenas o cabeçalho do bloco é usado para computá-lo. Por exemplo,</span> 000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f é o hash do bloco do primeiro bloco criado na história do bitcoin. O hash do bloco identifica o bloco de maneira única e sem ambiguidades, e pode ser derivado de maneira independente por qualquer nó, basta fazer um <em>hashing</em> duplo do cabeçalho do bloco com o algoritmo SHA256.</p>
</div>
<div class="paragraph data-line-2225">
<p>Note que o hash do bloco não está incluído no interior da estrutura de dados do bloco, nem quando o bloco é transmitido na rede, nem quando ele é armazenado como parte da blockchain no armazenamento persistente de um nó. Ao invés disso, o hash do bloco é processado por cada nó assim que o bloco é recebido da rede. O hash do bloco pode ser armazenado em uma tabela de banco de dados separada como parte dos metadados do bloco, para facilitar a indexação e uma aquisição mais rápida de blocos a partir do disco.</p>
</div>
<div class="paragraph data-line-2227">
<p>Uma segunda maneira de se identificar um bloco é através da sua posição na blockchain, que é chamada de <span role="keep-together"><em>altura do bloco</em> (em inglês, _block height_). O primeiro bloco criado no bitcoin está na altura de bloco 0 (zero) e é o</span> <span role="keep-together">mesmo bloco que foi referenciado anteriomente com o seguinte hash de bloco:</span>  000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f. Logo, um bloco pode ser identificado de duas maneiras diferentes: através da referência ao hash do bloco ou através da referência à altura do bloco. Cada bloco subsequente que é adicionado "em cima" daquele bloco inicial está uma posição "mais alta" na blockchain, como se fossem caixas empilhadas umas sobre as outras.</p>
</div>
<div class="paragraph data-line-2229">
<p>Além disso, o termo <em>altura de bloco atual</em> (em inglês, <em>current block height</em>) indica o tamanho da blockchain em blocos em um dado momento. Por exemplo, a altura de bloco atual em 1º de março de 2021 era de aproximadamente 672.722, o que significa que havia 672.722 blocos empilhados sobre o primeiro bloco que foi criado em janeiro de 2009.</p>
</div>
<div class="paragraph data-line-2231">
<p>Unlike the block hash, the block height is not a unique identifier. Although a single block will always have a specific and invariant block height, the reverse is not true—the block height does not always identify a single block. Two or more blocks might have the same block height, competing for the same position in the blockchain. This scenario is discussed in detail in the section <a href="#forks">[forks]</a>. The block height is also not a part of the block&#8217;s data structure; it is not stored within the block. Each node dynamically identifies a block&#8217;s position (height) in the blockchain when it is received from the Bitcoin network. The block height might also be stored as metadata in an indexed database table for faster retrieval.</p>
</div>
<div class="admonitionblock tip data-line-2234">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-2235">
<p>O <em>hash do bloco</em> de um determinado bloco sempre identifica um único bloco individualmente. Um bloco também sempre tem uma <em>altura de bloco</em> específica. Entretanto, nem sempre uma altura de bloco específica pode identificar um bloco único. Na verdade, dois ou mais blocos podem competir por uma mesma posição na blockchain.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-2238">
<p>=== O Bloco Gênese</p>
</div>
<div class="paragraph data-line-2240">
<p>O primeiro bloco na blockchain é chamado de bloco gênese e foi criado em 2009. Ele é o ancestral comum de todos os blocos na blockchain, o que significa que se você escolher qualquer bloco e seguir a cadeia retrogradamente no tempo, você sempre acabará chegando no bloco gênese.</p>
</div>
<div class="paragraph data-line-2242">
<p>Every node always starts with a blockchain of at least one block because the genesis block is statically encoded within the Bitcoin client software, such that it cannot be altered. Every node always "knows" the genesis block&#8217;s hash and structure, the fixed time it was created, and even the single transaction within. Thus, every node has the starting point for the blockchain, a secure "root" from which to build a trusted blockchain.</p>
</div>
<div class="paragraph data-line-2244">
<p>Veja o bloco gênese codificado estaticamente dentro do cliente do Bitcoin Core, em <a href="https://bit.ly/1x6rcwP" data-href="https://bit.ly/1x6rcwP"><em>chainparams.cpp</em></a>.</p>
</div>
<div class="paragraph data-line-2246">
<p>O seguinte hash identificador pertence ao bloco gênese:</p>
</div>
<div class="listingblock data-line-2248">
<div class="content">
<pre>000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f</pre>
</div>
</div>
<div class="paragraph data-line-2252">
<p>Você pode pesquisar esse hash de bloco em qualquer site do explorador de bloco, como <em>Blockchain.com</em>, e encontrará uma página que descreve o conteúdo desse bloco, com um URL contendo esse hash:</p>
</div>
<div class="paragraph data-line-2254">
<p><a href="https://www.blockchain.com/btc/block/000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f" class="undefined" data-href="https://www.blockchain.com/btc/block/000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f">https://www.blockchain.com/btc/block/000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f</a></p>
</div>
<div class="paragraph data-line-2256">
<p>Usando o cliente de referência Bitcoin Core na linha de comando:</p>
</div>
<div class="listingblock data-line-2258">
<div class="content">
<pre>$ bitcoin-cli getblock 000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f</pre>
</div>
</div>
<div class="listingblock data-line-2262">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "hash" : "000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f",
    "confirmations" : 308321,
    "size" : 285,
    "height" : 0,
    "version" : 1,
    "merkleroot" : "4a5e1e4baab89f3a32518a88c31bc87f618f76673e2cc77ab2127b7afdeda33b",
    "tx" : [
        "4a5e1e4baab89f3a32518a88c31bc87f618f76673e2cc77ab2127b7afdeda33b"
    ],
    "time" : 1231006505,
    "nonce" : 2083236893,
    "bits" : "1d00ffff",
    "difficulty" : 1.00000000,
    "nextblockhash" : "00000000839a8e6886ab5951d76f411475428afc90947ee320161bbf18eb6048"
}</code></pre>
</div>
</div>
<div class="paragraph data-line-2281">
<p>O bloco gênese contém uma mensagem escondida em seu interior. A entrada da transação coinbase contém o texto "<em>The Times 03/Jan/2009 Chancellor on brink of second bailout for banks</em>" (em português, "The Times 03/Jan/2009 Chanceler prestes a realizar um segundo resgate aos bancos"). Essa mensagem tinha como objetivo servir como prova da data mais precoce em que esse bloco foi criado, ao usar como referência a manchete de um jornal britânico, o <em>The Times</em>. Ela também serve como um lembrete da importância de um sistema monetário independente, com o lançamento do bitcoin ocorrendo ao mesmo tempo em que ocorria uma crise monetária internacional sem precedentes. A mensagem foi embutida no primeiro bloco por Satoshi Nakamoto, o criador do bitcoin.</p>
</div>
<div class="paragraph data-line-2283">
<p>=== Ligando os Blocos na Blockchain</p>
</div>
<div class="paragraph data-line-2285">
<p>Os nós completos do bitcoin mantêm uma cópia local da blockchain, que inicia no bloco gênese. A cópia local da blockchain é constantemente atualizada à medida que novos blocos são encontrados e são usados para estender a cadeia. Assim que um nó recebe os blocos vindo da rede, ele validará esses blocos e depois irá ligá-los à blockchain existente. Para estabelecer essa ligação, o nó examinará o cabeçalho do bloco recebido da rede e procurará pelo "hash do bloco anterior".</p>
</div>
<div class="paragraph data-line-2287">
<p>Vamos supor, por exemplo, que um nó tenha 277.314 blocos na cópia local da blockchain. O último bloco que o nó conhece é o bloco 277.314, que tem o seguinte hash de cabeçalho de bloco:</p>
</div>
<div class="listingblock data-line-2289">
<div class="content">
<pre>00000000000000027e7ba6fe7bad39faf3b5a83daed765f05f7d1b71a1632249</pre>
</div>
</div>
<div class="paragraph data-line-2293">
<p>The Bitcoin node then receives a new block from the network, which it parses as follows:</p>
</div>
<div class="listingblock data-line-2296">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "size" : 43560,
    "version" : 2,
    "previousblockhash" :
        "00000000000000027e7ba6fe7bad39faf3b5a83daed765f05f7d1b71a1632249",
    "merkleroot" :
        "5e049f4030e0ab2debb92378f53c0a6e09548aea083f3ab25e1d94ea1155e29d",
    "time" : 1388185038,
    "difficulty" : 1180923195.25802612,
    "nonce" : 4215469401,
    "tx" : [
        "257e7497fb8bc68421eb2c7b699dbab234831600e7352f0d9e6522c7cf3f6c77",

 #[... muitas outras transações omitidas ...]

        "05cfd38f6ae6aa83674cc99e4d75a1458c165b7ab84725eda41d018a09176634"
    ]
}</code></pre>
</div>
</div>
<div class="paragraph data-line-2317">
<p>Olhando para esse novo bloco, o nó encontra o campo previousblockhash (hash do bloco anterior), que contém o hash do seu bloco pai. Ele é um hash que o nó já conhece, que corresponde ao hash do último bloco na cadeia, que está na altura 277.314. Logo, esse novo bloco é um bloco filho do último bloco na cadeia e estende a blockchain existente. O nó adiciona esse novo bloco ao fim da cadeia, aumentando o comprimento da blockchain, que agora tem uma nova altura de 277.315. A <a href="#chain_of_blocks">Blocos ligados em uma cadeia, através da referência ao hash do cabeçalho do bloco anterior</a> mostra a cadeia de três blocos, ligados através das referências contidas no campo previousblockhash (hash do bloco anterior).</p>
</div>
<div id="merkle_trees" class="paragraph data-line-2321">
<p>=== Árvores de Merkle</p>
</div>
<div class="paragraph data-line-2323">
<p>Each block in the Bitcoin blockchain contains a summary of all the transactions in the block using a <em>merkle tree</em>.</p>
</div>
<div class="paragraph data-line-2325">
<p>Uma <em>árvore de merkle</em>, também conhecida como <em>árvore de hash binária</em>, é uma estrutura de dados usada para resumir e verificar a integridade de grandes conjuntos de dados de maneira eficiente. As árvores de merkle são árvores binárias que contêm hashes criptográficos. O termo "árvore" é usado na ciência da computação para descrever uma estrutura de dados ramificada, mas essas árvores geralmente são exibidas de cabeça para baixo, com a "raiz" no topo e as "folhas" na porção inferior de um diagrama, como você verá nos exemplos a seguir.</p>
</div>
<div id="chain_of_blocks" class="imageblock smallerfourtyfive data-line-2330">
<div class="content">
<img src="images/mbc2_0901.png" alt="mbc2 0901">
</div>
<div class="title">Figure 58. Blocos ligados em uma cadeia, através da referência ao hash do cabeçalho do bloco anterior</div>
</div>
<div class="paragraph data-line-2332">
<p>As árvores de merkle são usadas no bitcoin para resumir todas as transações contidas em um bloco, produzindo uma impressão digital geral de todo o conjunto de transações, fornecendo um processo muito eficiente para verificar se uma transação foi incluída em um bloco. Uma árvore de merkle é construída através do <em>hashing</em> recursivo de pares de nós até que só haja um único hash, que é conhecido como a <em>raiz</em> ou <em>raiz de merkle</em>. O algoritmo de hash criptográfico usado nas árvores de merkle do bitcoin é o SHA256 aplicado duas vezes, também conhecido como SHA256 duplo.</p>
</div>
<div class="paragraph data-line-2334">
<p>Quando N elementos de dados são submetidos a <em>hashing</em> e são resumidos em uma árvore de merkle, você precisa de no máximo 2*log~2~(N) cálculos para verificar se um elemento foi incluído na árvore, o que demonstra que a árvore de merkle é uma estrutura de dados muito eficiente.</p>
</div>
<div class="paragraph data-line-2336">
<p>A árvore de merkle é construída de baixo para cima. No exemplo a seguir, iniciamos com quatro transações, A, B, C e D, que formam as <em>folhas</em> da árvore de merkle, como demonstrado na <a href="#simple_merkle">Calculando os nós em uma árvore de merkle</a>. As transações não são armazenadas na árvore de merkle; em vez disso, seus dados são transformados em hash, e o hash resultante é armazenado em cada nó folha como H<sub>A</sub>, H<sub>B</sub>, H<sub>C</sub> e H<sub>D</sub>:</p>
</div>
<pre data-type="codelisting">
H<sub>A</sub> = SHA256(SHA256(Transação A))
</pre>
<div class="paragraph data-line-2344">
<p>Os pares consecutivos de nós folhas são então resumidos em um nó pai, ao se concatenar dois hashes e fazendo um <em>hashing</em> dos dois juntos. Por exemplo, para construir um nó pai H<sub>AB</sub>, os dois hashes de 32 bytes dos filhos são concatenados para criar uma <em>string</em> de 64 bytes. Essa <em>string</em> é submetida então a um <em>hashing</em> duplo para produzir o hash do nó pai:</p>
</div>
<pre data-type="codelisting">
H<sub>AB</sub> = SHA256(SHA256(H<sub>A</sub> + H<sub>B</sub>))
</pre>
<div class="paragraph data-line-2352">
<p>O processo continua até que haja apenas um único nó no topo, o nó que é conhecido como a raiz de merkle. Esse hash de 32 bytes é armazenado no cabeçalho do bloco e resume todos os dados contidos em todas as quatro transações. A <a href="#simple_merkle">Calculando os nós em uma árvore de merkle</a> mostra como a raiz é calculada através de hashes dos nós agrupados em pares.</p>
</div>
<div id="simple_merkle" class="imageblock data-line-2356">
<div class="content">
<img src="images/mbc2_0902.png" alt="merkle_tree">
</div>
<div class="title">Figure 59. Calculando os nós em uma árvore de merkle</div>
</div>
<div class="paragraph data-line-2358">
<p>Como a árvore de merkle é uma árvore binária, ela precisa de um número par de nós folha. Se houver um número ímpar de transações para serem resumidas, o hash da última transação será duplicado para criar uma <em>árvore balanceada</em>, ou seja, uma árvore que contém um número par de nós folhas. Isso é demonstrado na <a href="#merkle_tree_odd">A duplicação de um elemento de dados gera um número par de elementos de dados</a>, onde a transação C é duplicada.</p>
</div>
<div id="merkle_tree_odd" class="imageblock data-line-2362">
<div class="content">
<img src="images/mbc2_0903.png" alt="merkle_tree_odd">
</div>
<div class="title">Figure 60. A duplicação de um elemento de dados gera um número par de elementos de dados</div>
</div>
<div class="paragraph data-line-2364">
<p>O mesmo método que é usado para construir uma árvore a partir de quatro transações pode ser generalizado para construir árvores de qualquer tamanho. No bitcoin é comum existirem centenas a milhares de transações em um único bloco, que podem ser resumidas exatamente da mesma maneira, ao produzir uma única raiz de merkle com apenas 32 bytes de dados. Na <a href="#merkle_tree_large">Uma árvore de merkle resumindo muitos elementos de dados</a>, você verá uma árvore construída a partir de 16 transações. Note que embora a raiz aparente ser maior do que os nós folhas no diagrama, ela tem exatamente o mesmo tamanho, apenas 32 bytes. Não importa se um bloco tem apenas uma ou centenas de milhares de transações, a raiz de merkle sempre as resumirá em 32 bytes.</p>
</div>
<div class="paragraph data-line-2366">
<p>To prove that a specific transaction is included in a block, a node only needs to produce log~2~(N) 32-byte hashes, constituting an <em>authentication path</em> or <em>merkle path</em> connecting the specific transaction to the root of the tree. This is especially important as the number of transactions increases, because the base-2 logarithm of the number of transactions increases much more slowly. This allows Bitcoin nodes to efficiently produce paths of 10 or 12 hashes (320–384 bytes), which can provide proof of a single transaction out of more than a thousand transactions in a megabyte-sized block.</p>
</div>
<div id="merkle_tree_large" class="imageblock data-line-2370">
<div class="content">
<img src="images/mbc2_0904.png" alt="merkle_tree_large">
</div>
<div class="title">Figure 61. Uma árvore de merkle resumindo muitos elementos de dados</div>
</div>
<div class="paragraph data-line-2372">
<p>Na <a href="#merkle_tree_path">Um caminho de merkle sendo usado para provar a inclusão de um elemento de dados</a>, um nó pode provar que uma transação K foi incluída no bloco ao produzir um caminho de merkle que tenha um comprimento de apenas quatro hashes de 32 bytes (128 bytes no total). O caminho consiste em quatro hashes (os retângulos com fundo escurecido na <a href="#merkle_tree_path">Um caminho de merkle sendo usado para provar a inclusão de um elemento de dados</a>) H<sub>L</sub>, H<sub>IJ</sub>, H<sub>MNOP</sub> e H<sub>ABCDEFGH</sub>. Com esses quatro hashes fornecidos como um caminho de autenticação, qualquer nó consegue provar que o H<sub>K</sub> (o retângulo com fundo preto na parte inferior do diagrama) está incluso na raiz de merkle ao computar quatro hashes pareados adicionais: H<sub>KL</sub>, H<sub>IJKL</sub>, H<sub>IJKLMNOP</sub> e a raiz da árvore de merkle (os quatro retângulos com contorno tracejado no diagrama).</p>
</div>
<div id="merkle_tree_path" class="imageblock data-line-2376">
<div class="content">
<img src="images/mbc2_0905.png" alt="merkle_tree_path">
</div>
<div class="title">Figure 62. Um caminho de merkle sendo usado para provar a inclusão de um elemento de dados</div>
</div>
<div class="paragraph data-line-2379">
<p>O código no <a href="#merkle_example">Construindo uma árvore de merkle</a> demonstra o processo de criação de uma árvore de merkle desde os hashes dos nós folhas até a raiz, usando a biblioteca libbitcoin para algumas funções auxiliares.</p>
</div>
<div id="merkle_example" class="exampleblock pagebreak-before data-line-2384">
<div class="title">Example 20. Construindo uma árvore de merkle</div>
<div class="content">
<div class="listingblock data-line-2386">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">Unresolved directive in for_use_mastering-bitcoin_chapter-9_pt_BR.adoc - include::code/merkle.cpp[]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-2391">
<p>O <a href="#merkle_example_run">Compilando e executando o código de exemplo merkle.cpp</a> mostra o resultado da compilação e da execução do código de merkle.</p>
</div>
<div id="merkle_example_run" class="exampleblock data-line-2395">
<div class="title">Example 21. Compilando e executando o código de exemplo merkle.cpp</div>
<div class="content">
<div class="listingblock data-line-2397">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># Compilar o código merkle.cpp
$ g++ -o merkle merkle.cpp $(pkg-config --cflags --libs libbitcoin)
# Rodar o executável merkle
$ ./merkle
Lista de hashes da merkle atual:
  32650049a0418e4380db0af81788635d8b65424d397170b8499cdc28c4d27006
  30861db96905c8dc8b99398ca1cd5bd5b84ac3264a4e1b3e65afa1bcee7540c4

Lista de hashes da merkle atual:
  d47780c084bad3830bcdaf6eace035e4c6cbf646d103795d22104fb105014ba3

Resultado: d47780c084bad3830bcdaf6eace035e4c6cbf646d103795d22104fb105014ba3</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-2414">
<p>A eficiência da árvore de merkle torna-se óbvia à medida que ela cresce em escala. A <a href="#block_structure2">Eficiência da árvore de merkle</a> mostra a quantidade de dados que precisam ser trocados na forma de um caminho de merkle para se provar que uma transação faz parte de um bloco.</p>
</div>
<table id="block_structure2" class="tableblock frame-all grid-all stretch data-line-2419">
<caption class="title">Table 26. Eficiência da árvore de merkle</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Nº de transações</th>
<th class="tableblock halign-left valign-top">Tamanho aprox. do bloco</th>
<th class="tableblock halign-left valign-top">Tamanho do caminho (em hashes)</th>
<th class="tableblock halign-left valign-top">Tamanho do caminho (em bytes)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 transações</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 kilobytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 hashes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">128 bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">512 transações</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">128 kilobytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9 hashes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">288 bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.048 transações</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">512 kilobytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11 hashes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">352 bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">65.535 transações</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 megabytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 hashes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">512 bytes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-2427">
<p>Como você pode ver na tabela, enquanto o tamanho do bloco aumenta rapidamente, de 4 KB com 16 transações até um tamanho de bloco de 16 MB para comportar 65.535 transações, o caminho de merkle necessário para provar a inclusão de uma transação cresce muito mais lentamente, de 128 bytes até somente 512 bytes. Com as árvores de merkle, um nó pode fazer apenas o download dos cabeçalhos dos blocos (80 bytes por bloco) e ainda ser capaz de identificar a inclusão de uma transação em um bloco ao adquirir um pequeno caminho de merkle de um nó completo, sem precisar armazenar ou transmitir a vasta maioria da blockchain, que pode ter vários gigabytes de tamanho. Os nós que não mantêm uma blockchain completa, conhecidos como nós de verificação de pagamento simplificada (SPV), usam caminhos de merkle para verificar as transações sem ter que fazer o download dos blocos completos.</p>
</div>
<div class="paragraph data-line-2429">
<p>=== Árvores de Merkle e Verificação de Pagamento Simplificada (SPV)</p>
</div>
<div class="paragraph data-line-2431">
<p>Merkle trees are used extensively by SPV nodes. SPV nodes don&#8217;t have all transactions and do not download full blocks, just block headers. In order to verify that a transaction is included in a block, without having to download all the transactions in the block, they use an authentication path, or merkle path.</p>
</div>
<div class="paragraph data-line-2433">
<p>Considere, por exemplo, que um nó de SPV esteja interessado em receber pagamentos para um endereço contido em sua carteira. O nó de SPV estabelecerá um filtro de bloom (ver <a href="#bloom_filters">[bloom_filters]</a>) em suas conexões com os outros pares (nós), limitando-se a receber somente aquelas transações que contiverem os endereços de interesse. Quando um par (nó) vizinho enxergar uma transação que corresponde ao filtro de bloom do nó de SPV, ele enviará aquele bloco usando uma mensagem merkleblock. A mensagem merkleblock contém o cabeçalho do bloco e o caminho de merkle que liga a transação de interesse à raiz de merkle do bloco. O nó de SPV usa esse caminho de merkle para ligar a transação ao bloco e verificar que a transação foi incluída no bloco. O nó de SPV também usa o cabeçalho do bloco para ligar o bloco ao resto da blockchain. A combinação dessas duas ligações, entre a transação e o bloco, e entre o bloco e a blockchain, comprova que a transação foi registrada na blockchain. No final, o nó de SPV terá recebido menos que um kilobyte de dados para o cabeçalho do bloco e o caminho de merkle, uma quantidade de dados que é mais do que mil vezes menor do que um bloco completo (cerca de 1 megabyte atualmente).</p>
</div>
<div class="paragraph data-line-2435">
<p>=== Blockchains de Testes do Bitcoin</p>
</div>
<div class="paragraph data-line-2437">
<p>You might be surprised to learn that there is more than one Bitcoin blockchain. The "main" Bitcoin blockchain, the one created by Satoshi Nakamoto on January 3rd, 2009, the one with the genesis block we studied in this chapter, is called <em>mainnet</em>.  There are other Bitcoin blockchains that are used for testing purposes: at this time <em>testnet</em>, <em>segnet</em>, and <em>regtest</em>. Let&#8217;s look at each in turn.</p>
</div>
<div class="paragraph data-line-2440">
<p>==== Testnet&#x2014;O Playground de Testes do Bitcoin</p>
</div>
<div class="paragraph data-line-2442">
<p>Testnet é o nome da blockchain, da rede e da moeda que são usadas para fins de teste. A testnet é uma rede P2P ativa com recursos completos, com carteiras, bitcoins de teste (moedas da testnet), mineração e todos os outros recursos da mainnet. Na verdade, existem apenas duas diferenças: as moedas da testnet não têm valor e a dificuldade de mineração deve ser baixa o suficiente para que qualquer pessoa possa minerar moedas da testnet com relativa facilidade (mantendo-as sem valor).</p>
</div>
<div class="paragraph data-line-2444">
<p>Qualquer desenvolvimento de software destinado para uso em produção na rede principal (mainnet) do bitcoin deve primeiro ser testado na testnet com moedas de teste (test coins). Isso protege os desenvolvedores de perdas monetárias devido a bugs e protege a rede de comportamento não intencional devido a bugs.</p>
</div>
<div class="paragraph data-line-2446">
<p>Manter as moedas sem valor e a mineração fácil, entretanto, é uma tarefa difícil. Apesar dos apelos dos desenvolvedores, algumas pessoas usam equipamentos avançados de mineração (GPUs e ASICs) para minerar na testnet. Isso aumenta a dificuldade, torna impossível minerar com uma CPU e, eventualmente, dificulta tanto a obtenção de moedas de teste, que as pessoas começam a valorizá-las. Como resultado, de tempos em tempos, a testnet precisa ser descartada e reiniciada a partir de um novo bloco gênese, reiniciando a dificuldade.</p>
</div>
<div class="paragraph data-line-2448">
<p>A testnet atual é chamada de <em>testnet3</em>, a terceira iteração de testnet, reiniciada em fevereiro de 2011 para redefinir a dificuldade da testnet anterior.</p>
</div>
<div class="paragraph data-line-2450">
<p>Tenha em mente que a testnet3 é uma blockchain pesada, que já tinha mais de 25 GB no ano de 2021. Ela levará um dia ou mais para ser totalmente sincronizada e usará recursos do seu computador. Não tanto quanto a mainnet usará, mas não se pode dizer que ela é uma blockchain "leve". Uma boa maneira de se executar um nó da testnet é através de uma imagem de máquina virtual (por exemplo, VirtualBox, Docker, Cloud Server, etc.) dedicada a esse propósito.</p>
</div>
<div class="paragraph data-line-2452">
<p>===== Usando a testnet</p>
</div>
<div class="paragraph data-line-2454">
<p>O Bitcoin Core, como quase todos os outros softwares do bitcoin, tem suporte total para operações na testnet. Todas as funções do Bitcoin Core também funcionam na testnet, incluindo a carteira, a mineração de moedas da testnet e a sincronização de um nó completo na testnet.</p>
</div>
<div class="paragraph data-line-2456">
<p>Para iniciar o Bitcoin Core na testnet em vez da mainnet, use o <em>switch</em> testnet:</p>
</div>
<div class="listingblock data-line-2458">
<div class="content">
<pre>$ bitcoind -testnet</pre>
</div>
</div>
<div class="paragraph data-line-2462">
<p>Nos logs, você verá que o bitcoind está construindo uma nova blockchain no subdiretório testnet3 do diretório padrão bitcoind:</p>
</div>
<div class="listingblock data-line-2464">
<div class="content">
<pre>bitcoind: Usando o diretório de dados /home/nomedousuario/.bitcoin/testnet3</pre>
</div>
</div>
<div class="paragraph data-line-2468">
<p>Para conectar-se ao bitcoind, use a ferramenta de linha de comando bitcoin-cli, mas também é necessário alterná-la para o modo testnet:</p>
</div>
<div class="listingblock data-line-2470">
<div class="content">
<pre>$ bitcoin-cli -testnet getblockchaininfo
{
  "chain": "test",
  "blocks": 1088,
  "headers": 139999,
  "bestblockhash": "0000000063d29909d475a1c4ba26da64b368e56cce5d925097bf3a2084370128",
  "difficulty": 1,
  "mediantime": 1337966158,
  "verificationprogress": 0.001644065914099759,
  "chainwork": "0000000000000000000000000000000000000000000000000000044104410441",
  "pruned": false,
  "softforks": [

  [...]</pre>
</div>
</div>
<div class="paragraph data-line-2487">
<p>Você também pode usar a testnet3 em outras implementações de nó completo, como a btcd (escrita em Go) e a bcoin (escrita em JavaScript), para experimentar e aprender em outras linguagens de programação e outros <em>frameworks</em>.</p>
</div>
<div class="paragraph data-line-2489">
<p>Em 2021, a testnet3 oferece suporte a todos os recursos da mainnet, incluindo a Segregated Witness (ver <a href="#segwit">[segwit]</a>). Portanto, a testnet3 também pode ser usada para testar os recursos da Segregated Witness.</p>
</div>
<div class="paragraph data-line-2491">
<p>==== Segnet&#x2014;A Testnet da Segregated Witness</p>
</div>
<div class="paragraph data-line-2494">
<p>Em 2016, uma testnet de propósito especial foi lançada para auxiliar no desenvolvimento e nos testes da Segregated Witness (também conhecida como segwit; ver <a href="#segwit">[segwit]</a>). Esta blockchain de testes é chamada de segnet e pode ser utilizada executando-se uma versão especial (um <em>branch</em>) do Bitcoin Core.</p>
</div>
<div class="paragraph data-line-2496">
<p>Como a segwit foi adicionada à testnet3, não é mais necessário usar a segnet para se testar os recursos da segwit.</p>
</div>
<div class="paragraph data-line-2498">
<p>No futuro, é provável que vejamos outras blockchains de testnet que serão projetadas especificamente para testar um único recurso ou uma grande mudança arquitetural, como a segnet.</p>
</div>
<div class="paragraph data-line-2500">
<p>==== Regtest&#x2014;A Blockchain Local</p>
</div>
<div class="paragraph data-line-2502">
<p> A regtest, que significa "Teste de Regressão", é um recurso do Bitcoin Core que permite criar uma blockchain local para fins de teste. Ao contrário da testnet3, que é uma blockchain de testes pública e compartilhada, as blockchains de regtest foram feitas para serem executadas como sistemas fechados usados para testes locais. Você lança uma blockchain regtest do zero, criando um bloco gênese local. Você pode adicionar outros nós à rede, ou executá-la com um único nó apenas para testar o software Bitcoin Core.</p>
</div>
<div class="paragraph data-line-2504">
<p>Para iniciar o Bitcoin Core no modo regtest, use a <em>flag</em> regtest:</p>
</div>
<div class="listingblock data-line-2506">
<div class="content">
<pre>$ bitcoind -regtest</pre>
</div>
</div>
<div class="paragraph data-line-2510">
<p>Assim como acontece com a testnet, o Bitcoin Core inicializará uma nova blockchain no subdiretório <em>regtest</em> do seu diretório padrão bitcoind:</p>
</div>
<div class="listingblock data-line-2512">
<div class="content">
<pre>bitcoind: Usando o diretório de dados /home/nomedousuario/.bitcoin/regtest</pre>
</div>
</div>
<div class="paragraph data-line-2516">
<p>Para usar a ferramenta de linha de comando, você também precisa especificar a <em>flag</em> regtest. Vamos usar o comando getblockchaininfo para inspecionar a blockchain da regtest:</p>
</div>
<div class="listingblock data-line-2518">
<div class="content">
<pre>$ bitcoin-cli -regtest getblockchaininfo
{
  "chain": "regtest",
  "blocks": 0,
  "headers": 0,
  "bestblockhash": "0f9188f13cb7b2c71f2a335e3a4fc328bf5beb436012afca590b1a11466e2206",
  "difficulty": 4.656542373906925e-10,
  "mediantime": 1296688602,
  "verificationprogress": 1,
  "chainwork": "0000000000000000000000000000000000000000000000000000000000000002",
  "pruned": false,
  [...]</pre>
</div>
</div>
<div class="paragraph data-line-2533">
<p>Como você pode ver, ainda não há nenhum bloco. Vamos minerar alguns (500 blocos) e ganhar a recompensa:</p>
</div>
<div class="listingblock data-line-2535">
<div class="content">
<pre>$ bitcoin-cli -regtest generate 500
[
  "7afed70259f22c2bf11e406cb12ed5c0657b6e16a6477a9f8b28e2046b5ba1ca",
  "1aca2f154a80a9863a9aac4c72047a6d3f385c4eec5441a4aafa6acaa1dada14",
  "4334ecf6fb022f30fbd764c3ee778fabbd53b4a4d1950eae8a91f1f5158ed2d1",
  "5f951d34065efeaf64e54e91d00b260294fcdfc7f05dbb5599aec84b957a7766",
  "43744b5e77c1dfece9d05ab5f0e6796ebe627303163547e69e27f55d0f2b9353",
   [...]
  "6c31585a48d4fc2b3fd25521f4515b18aefb59d0def82bd9c2185c4ecb754327"
]</pre>
</div>
</div>
<div class="paragraph data-line-2548">
<p>A mineração de todos esses blocos levará apenas alguns segundos, o que certamente facilita a realização de testes. Se você verificar o saldo da sua carteira, você verá que ganhou recompensas pelos primeiros 400 blocos (as recompensas das transações coinbase precisam ter 100 blocos de profundidade para que você possa gastá-las):</p>
</div>
<div class="listingblock data-line-2550">
<div class="content">
<pre>$ bitcoin-cli -regtest getbalance
12462.50000000</pre>
</div>
</div>
<div class="paragraph data-line-2555">
<p>=== Usando Blockchains de Testes para Desenvolvimento</p>
</div>
<div class="paragraph data-line-2557">
<p>As várias blockchains do bitcoin (regtest, segnet, testnet3 e mainnet) oferecem uma variedade de ambientes de testes para o desenvolvimento bitcoin. Use as blockchains de testes se você estiver desenvolvendo para o Bitcoin Core ou outro cliente de consenso de nó completo; um aplicativo como uma carteira, exchange ou site de comércio eletrônico; ou até mesmo se estiver desenvolvendo novos contratos inteligentes e scripts complexos.</p>
</div>
<div class="paragraph data-line-2559">
<p>Você pode usar as blockchains de testes para estabelecer uma sequência de desenvolvimento. Teste seu código localmente na regtest enquanto você o desenvolve. Quando estiver pronto para experimentá-lo em uma rede pública, mude para a testnet para expor seu código a um ambiente mais dinâmico, com mais diversidade de códigos e aplicativos. Finalmente, quando você estiver confiante de que seu código funciona conforme o esperado, mude para a mainnet para colocá-lo em produção. Conforme você faz alterações, melhorias, correções de bugs, etc., inicie a sequência de desenvolvimento novamente, implementando cada alteração primeiro na regtest, depois na testnet e, finalmente, colocando em produção na mainnet.</p>
</div>
<div id="mineração" class="paragraph data-line-2562">
<p>== Mineração e Consenso</p>
</div>
<div class="paragraph data-line-2565">
<p>=== Introdução</p>
</div>
<div class="paragraph data-line-2567">
<p>A palavra "mineração" pode causar confusão. Como ela nos remete à semelhança com a extração de metais preciosos, ela foca nossa atenção na recompensa que é paga pela mineração, que são os novos bitcoins gerados em cada bloco. Embora a mineração seja incentivada por essa recompensa, o propósito principal da mineração não é a recompensa ou a geração de novas moedas. Se você enxerga a mineração como sendo apenas o processo através do qual as moedas são criadas, você está confundindo os meios (os incentivos) com o objetivo do processo. A mineração é o mecanismo que sustenta a câmara de compensação descentralizada, através da qual as transações são validadas e compensadas. A mineração é a invenção que torna o bitcoin especial, um mecanismo de segurança descentralizado que é a base para o dinheiro em espécie digital P2P.</p>
</div>
<div class="paragraph data-line-2569">
<p>Mining <em>secures the Bitcoin system</em> and enables the emergence of network-wide <em>consensus without a central authority</em>. The reward of newly minted coins and transaction fees is an incentive scheme that aligns the actions of miners with the security of the network, while simultaneously implementing the monetary supply.</p>
</div>
<div class="admonitionblock tip data-line-2572">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-2573">
<p>O propósito da mineração não é a criação de novos bitcoins. Isso é apenas o sistema de incentivos usado pela mineração. O verdadeiro propósito da mineração é servir como um mecanismo que mantém a <em>segurança</em> do bitcoin <em>decentralizada</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-2576">
<p>Os mineradores validam novas transações e as registram no livro-razão global. Um novo bloco, contendo transações que ocorreram desde o último bloco, é "minerado", em média, a cada 10 minutos, fazendo com que estas transações sejam adicionadas à blockchain (cadeia de blocos). As transações que foram incluídas em um bloco que foi adicionado à blockchain são consideradas "confirmadas", o que permite que os novos proprietários possam gastar os bitcoins recebidos nestas transações.</p>
</div>
<div class="paragraph data-line-2578">
<p>Os mineradores recebem dois tipos de recompensa como pagamento pela segurança fornecida pela mineração: as novas moedas que são criadas a cada novo bloco, também conhecida como a <em>recompensa do bloco</em> ou <em>recompensa coinbase</em>, e as taxas de transação presentes em todas as transações incluídas no bloco. Para ganhar essa recompensa, os mineradores competem entre si para resolver um difícil problema matemático baseado em um algoritmo de hash criptográfico. A solução para o problema, chamada de Prova-de-Trabalho, é incluída no novo bloco e serve como prova de que o minerador gastou uma significativa quantidade de esforço computacional. A competição para resolver o algoritmo de Prova-de-Trabalho, a fim de obter a recompensa e o direito de registrar transações na blockchain, é a base do modelo de segurança da rede bitcoin.</p>
</div>
<div class="paragraph data-line-2580">
<p>O processo é chamado de mineração porque a recompensa (a geração de novas moedas) é projetada para simular rendimentos decrescentes, semelhante ao que ocorre com a mineração de metais preciosos. A oferta monetária do bitcoin é aumentada através da mineração, semelhante à forma como um banco central emite dinheiro ao imprimir cédulas. A quantidade máxima de bitcoins recém-criados que um minerador pode adicionar a um bloco diminui, em média, a cada quatro anos (ou exatamente a cada 210.000 blocos). Essa quantidade máxima iniciou com 50 bitcoins por bloco em janeiro de 2009 e caiu pela metade, para 25 bitcoins por bloco, em novembro de 2012. Ela caiu de novo pela metade, para 12,5 bitcoins por bloco, em julho de 2016 e mais uma vez, para 6,25 bitcoins por bloco, em maio de 2020. Com base nesta fórmula, as recompensas de mineração do bitcoin diminuem exponencialmente até aproximadamente o ano de 2140, quando todos os bitcoins (20,99999998 milhões) terão sido emitidos. Após 2140, novas unidades de bitcoin não serão mais emitidas.</p>
</div>
<div class="paragraph data-line-2582">
<p>Os mineradores de bitcoin também ganham as taxas das transações. Cada transação geralmente inclui uma taxa de transação, que corresponde à diferença do número de bitcoins contidos nas entradas e nas saídas da transação. O minerador de bitcoin vencedor recebe as taxas das transações que foram incluídas no bloco que ele minerou. Atualmente, as taxas representam 0,5% ou menos da renda de um minerador de bitcoin, ou seja, a maior parte da renda dos mineradores vem dos bitcoins recém-criados. No entanto, à medida que a recompensa do bloco diminui ao longo do tempo e o número de transações por bloco aumenta, uma proporção maior da renda dos mineradores virá das taxas das transações. Gradualmente, a recompensa da mineração será dominada pelas taxas de transação, que se tornarão o principal incentivo para os mineradores. Após 2140, a quantia de novos bitcoins gerados em cada bloco cairá para zero e a mineração do bitcoin será incentivada exclusivamente pelas taxas das transações.</p>
</div>
<div class="paragraph data-line-2584">
<p>Neste capítulo, examinaremos primeiro a mineração como um mecanismo de oferta monetária e, em seguida, examinaremos a função mais importante da mineração: o mecanismo de consenso descentralizado que garante a segurança do bitcoin.</p>
</div>
<div class="paragraph data-line-2586">
<p>To understand mining and consensus, we will follow Alice&#8217;s transaction as it is received and added to a block by Jing&#8217;s mining equipment. Then we will follow the block as it is mined, added to the blockchain, and accepted by the Bitcoin network through the process of emergent consensus.</p>
</div>
<div class="paragraph data-line-2588">
<p>==== A Economia do Bitcoin e a Criação de Moedas</p>
</div>
<div class="paragraph data-line-2590">
<p>Os bitcoins são "cunhados" durante a criação de cada bloco em uma taxa fixa e decrescente. Cada bloco é gerado, em média, a cada 10 minutos, e contém bitcoins completamente novos, que foram criados a partir do nada. A cada 210.000 blocos, ou aproximadamente a cada quatro anos, a taxa de emissão da moeda é diminuída em 50%. Nos primeiros quatro anos de operação da rede, cada bloco continha 50 novos bitcoins.</p>
</div>
<div class="paragraph data-line-2592">
<p>Em novembro de 2012, a taxa de emissão de novos bitcoins foi reduzida para 25 bitcoins por bloco. Em julho de 2016, foi reduzida para 12,5 bitcoins por bloco e, em maio de 2020, foi reduzida novamente para 6,25 bitcoins por bloco. A taxa de emissão de novas moedas diminuirá dessa maneira, exponencialmente, através de 32 "reduções pela metade" (em inglês, <em>halvings</em>), até o bloco nº6.720.000 (que será minerado aproximadamente no ano de 2137), quando a unidade monetária mínima de 1 satoshi será atingida. Finalmente, após 6,93 milhões de blocos, aproximadamente no ano de 2140, quase 2.099.999.997.690.000 de satoshis, ou quase 21 milhões de bitcoins, terão sido emitidos. Depois disso, os blocos não conterão nenhum bitcoin novo e os mineradores serão recompensados apenas por meio das taxas de transação. A <a href="#bitcoin_money_supply">Oferta monetária do bitcoin ao longo do tempo, baseada em uma taxa de emissão com progressão geométrica decrescente</a> mostra o total de bitcoins em circulação ao longo do tempo, à medida que a emissão da moeda diminui.</p>
</div>
<div id="bitcoin_money_supply" class="imageblock data-line-2596">
<div class="content">
<img src="images/mbc2_1001.png" alt="BitcoinMoneySupply">
</div>
<div class="title">Figure 63. Oferta monetária do bitcoin ao longo do tempo, baseada em uma taxa de emissão com progressão geométrica decrescente</div>
</div>
<div class="admonitionblock note data-line-2599">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-2600">
<p>O número máximo de moedas mineradas no bitcoin é o <em>limite superior</em> do total de recompensas de mineração possíveis. Na prática, um minerador pode intencionalmente minerar um bloco que recebe menos do que a recompensa completa a que tem direito. Blocos desse tipo já foram minerados no passado e mais poderão ser minerados no futuro, resultando em uma emissão total de moedas menor do que a esperada.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-2603">
<p>No código do <a href="#max_money">Um script para calcular o total de bitcoins que serão emitidos</a>, calculamos a quantidade total de bitcoins que será emitida.</p>
</div>
<div id="max_money" class="exampleblock data-line-2607">
<div class="title">Example 22. Um script para calcular o total de bitcoins que serão emitidos</div>
<div class="content">
<div class="listingblock data-line-2609">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">Unresolved directive in for_use_mastering-bitcoin_chapter-10_pt_BR.adoc - include::code/max_money.py[]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-2614">
<p>O <a href="#max_money_run">Executando o script max_money.py</a> mostra o output produzido ao executar-se esse script.</p>
</div>
<div id="max_money_run" class="exampleblock data-line-2618">
<div class="title">Example 23. Executando o script max_money.py</div>
<div class="content">
<div class="listingblock data-line-2620">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ python max_money.py
Total de bitcoins que serão criados: 2100000000000000.0 satoshis</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-2626">
<p>A emissão decrescente e finita cria uma oferta monetária fixa que resiste à inflação. Ao contrário das moedas fiduciárias, que podem ser infinitamente impressas por um banco central, o bitcoin jamais poderá ser inflacionado através de uma impressão de moedas.</p>
</div>
</div>
</div>
<div class="paragraph data-line-70">
<p>A consequência mais importante e debatida da emissão monetária fixa e descrescente é que a moeda tende a ser inerentemente <em>deflacionária</em>. A deflação é o fenômeno em que há apreciação (aumento de valor) devido a um descasamento entre a oferta e a demanda, o que faz com que uma moeda ganhe valor (e a taxa de câmbio aumente). Em um cenário de deflação de preços (o oposto da inflação de preços), o dinheiro vai ganhando mais poder de compra com o passar do tempo.</p>
</div>
<div class="paragraph data-line-72">
<p>Muitos economistas argumentam que uma economia deflacionária é um desastre e deveria ser evitada a todo custo. Isso porque em um período de rápida deflação, as pessoas tendem a acumular dinheiro ao invés de gastá-lo, na esperança de que os preços cairão no futuro. Esse fenômeno ocorreu durante a "Década Perdida" do Japão, quando um colapso completo da demanda levou a moeda a uma espiral deflacionária.</p>
</div>
<div class="paragraph data-line-74">
<p>Os especialistas em bitcoin argumentam que a deflação não é algo ruim por si só. Segundo eles, a deflação é associada a um colapso na demanda porque este foi o único exemplo de deflação que nós temos disponível para estudar. Em uma moeda fiduciária com a possibilidade de impressão ilimitada, é muito difícil de se entrar em uma espiral deflacionária, a menos que exista um colapso completo na demanda e um desinteresse em imprimir dinheiro. A deflação do bitcoin não é causada por um colapso na demanda, mas sim por uma oferta restrita previsível.</p>
</div>
<div class="paragraph data-line-76">
<p>O aspecto positivo da deflação, é claro, é que ela é o oposto da inflação. A inflação causa uma desvalorização lenta, mas inevitável, da moeda, resultando em uma forma de tributação oculta que pune os poupadores para resgatar os devedores (incluindo os maiores devedores de todos, que são os próprios governos). As moedas sob controle governamental sofrem com o risco moral da fácil emissão de dívidas, que mais tarde podem ser apagadas através da desvalorização da moeda à custa dos poupadores.</p>
</div>
<div class="paragraph data-line-78">
<p>Resta saber se o aspecto deflacionário da moeda é um problema quando ele não é impulsionado por uma rápida retração econômica, ou se ele é uma vantagem, caso os benefícios da proteção contra a inflação e a perda do poder de compra superem em muito os riscos da deflação.</p>
</div>
<div class="sidebarblock data-line-79">
<div class="content">
<div class="paragraph data-line-81">
<p>=== Consenso Descentralizado</p>
</div>
<div class="paragraph data-line-83">
<p>In the previous chapter we looked at the blockchain, the global public ledger (list) of all transactions, which everyone in the Bitcoin network accepts as the authoritative record of ownership.</p>
</div>
<div class="paragraph data-line-85">
<p>But how can everyone in the network agree on a single universal "truth" about who owns what, without having to trust anyone? All traditional payment systems depend on a trust model that has a central authority providing a clearinghouse service, basically verifying and clearing all transactions. Bitcoin has no central authority, yet somehow every full node has a complete copy of a public ledger that it can trust as the authoritative record. The blockchain is not created by a central authority, but is assembled independently by every node in the network. Somehow, every node in the network, acting on information transmitted across insecure network connections, can arrive at the same conclusion and assemble a copy of the same public ledger as everyone else. This chapter examines the process by which the Bitcoin network achieves global consensus without central authority.</p>
</div>
<div class="paragraph data-line-87">
<p>A principal invenção de Satoshi Nakamoto foi o mecanismo descentralizado usado para se atingir o <em>consenso emergente</em>. Diz-se emergente, pois o consenso não é atingido de maneira explícita—não existe uma eleição ou um momento fixo no qual o consenso ocorre. Ao invés disso, o consenso é um artefato que emerge da interação assíncrona de milhares de nós independentes, todos seguindo regras simples. Todas as propriedades do bitcoin derivam dessa invenção, incluindo a moeda, as transações, os pagamentos e o modelo de segurança que não depende de confiança ou de uma autoridade central.</p>
</div>
<div class="paragraph data-line-89">
<p>O consenso descentralizado do bitcoin emerge da interação de quatro processos que ocorrem independentemente nos nós distribuídos em toda a rede:</p>
</div>
<div class="ulist pagebreak-before data-line-92">
<ul>
<li class="data-line-92">
<p>Verificação independente de cada transação, realizada por cada nó completo, com base em uma extensa lista de critérios</p>
</li>
<li class="data-line-93">
<p>Agregação independente dessas transações em novos blocos, realizada pelos nós de mineração, juntamente com computação demonstrada através de um algoritmo de Prova-de-Trabalho</p>
</li>
<li class="data-line-94">
<p>Verificação independente dos novos blocos por cada nó e inclusão deles em uma cadeia</p>
</li>
<li class="data-line-95">
<p>Seleção independente, por cada nó, da cadeia de blocos com a maior computação acumulada demonstrada através da Prova-de-Trabalho</p>
</li>
</ul>
</div>
<div class="paragraph data-line-97">
<p>In the next few sections we will examine these processes and how they interact to create the emergent property of network-wide consensus that allows any Bitcoin node to assemble its own copy of the authoritative, trusted, public, global ledger.</p>
</div>
<div id="tx_verification" class="paragraph data-line-100">
<p>=== Verificação Independente de Transações</p>
</div>
<div class="paragraph data-line-102">
<p>In <a href="#transactions">[transactions]</a>, we saw how wallet software creates transactions by collecting UTXO, providing the appropriate unlocking scripts, and then constructing new outputs assigned to a new owner. The resulting transaction is then sent to the neighboring nodes in the Bitcoin network so that it can be propagated across the entire Bitcoin network.</p>
</div>
<div class="paragraph data-line-104">
<p>However, before forwarding transactions to its neighbors, every Bitcoin node that receives a transaction will first verify the transaction. This ensures that only valid transactions are propagated across the network, while invalid transactions are discarded at the first node that encounters them.</p>
</div>
<div class="paragraph data-line-106">
<p>Cada nó verifica cada transação usando uma <em>checklist</em> contendo vários critérios:</p>
</div>
<div class="ulist data-line-108">
<ul>
<li class="data-line-108">
<p>A sintaxe da transação e a estrutura de dados devem estar corretas.</p>
</li>
<li class="data-line-109">
<p>Nem a lista de entradas, nem a lista de saídas estão vazias.</p>
</li>
<li class="data-line-110">
<p>O tamanho da transação é menor que o tamanho máximo permitido para um bloco, excluindo dados de testemunha, conforme mostrado em <a href="https://bit.ly/3t623VL" data-href="https://bit.ly/3t623VL"><em>tx_check.cpp</em></a>.</p>
</li>
<li class="data-line-111">
<p>Cada valor de saída, assim como o total, deve estar dentro da faixa de valores permitida (menos do que 21 milhões de moedas, mais do que o valor mínimo considerado como <em>pó</em>).</p>
</li>
<li class="data-line-112">
<p>Nenhuma das entradas tem hash=0, N=–1 (transações coinbase não devem ser retransmitidas).</p>
</li>
<li class="data-line-113">
<p>nLocktime é igual a INT_MAX, ou os valores de nLocktime e nSequence são satisfeitos de acordo com a MedianTimePast (mediana do horário do passado).</p>
</li>
<li class="data-line-114">
<p>O tamanho da transação em bytes é maior ou igual a 82.</p>
</li>
<li class="data-line-115">
<p>O número de operações de assinatura (SIGOPS) contidas na transação é menor do que o limite de operações de assinatura.</p>
</li>
<li class="data-line-116">
<p>O script de destravamento (scriptSig) só pode adicionar números no stack, e o script de travamento (scriptPubkey) deve coincidir com as formas IsStandard (isso rejeita transações que sejam "fora do padrão").</p>
</li>
<li class="data-line-117">
<p>Deve existir uma transação correspondente na pool ou em um bloco na cadeia principal.</p>
</li>
<li class="data-line-118">
<p>Para cada entrada, se a saída referenciada existir em qualquer outra transação na pool, a transação deve ser rejeitada.</p>
</li>
<li class="data-line-119">
<p>Para cada entrada, buscar pela transação pai no ramo principal e na pool de transações. Se a transação pai estiver faltando para qualquer entrada, essa será uma transação órfã. Adicionar à pool de transações órfãs, caso uma transação correspondente já não estiver na pool.</p>
</li>
<li class="data-line-120">
<p>Para cada entrada, se a transação pai for uma transação coinbase, ela deve ter uma COINBASE_MATURITY de pelo menos 100 confirmações.</p>
</li>
<li class="data-line-121">
<p>Para cada entrada, a saída referenciada deve existir e não pode ter sido gasta previamente.</p>
</li>
<li class="data-line-122">
<p>Usando as transações pai para adquirir os valores de entrada, verificar se cada valor de entrada, assim como a soma dos valores, estão dentro do intervalo permitido de valores (menor do que 21 milhões de moedas, maior do que 0).</p>
</li>
<li class="data-line-123">
<p>Rejeitar se a soma dos valores das entradas for menor do que a soma dos valores das saídas.</p>
</li>
<li class="data-line-124">
<p>Rejeitar se a taxa de transação seria muito baixa (minRelayTxFee) para entrar em um bloco vazio.</p>
</li>
<li class="data-line-125">
<p>Os scripts de destravamento para cada entrada devem ser validados em relação aos scripts de travamento das saídas correspondentes.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-127">
<p>Essas condições podem ser vistas em detalhes nas funções AcceptToMemoryPool, CheckTransaction e CheckInputs do Bitcoin Core. Note que as condições mudam ao longo do tempo, para lidar com novos tipos de ataques de negação de serviço ou, às vezes, para relaxar as regras de modo a incluir mais tipos de transações.</p>
</div>
<div class="paragraph data-line-129">
<p>Ao verificar independentemente cada transação à medida que ela é recebida e antes de propagá-la, cada nó constrói uma pool de transações válidas (mas não confirmadas), que é conhecida como <em>pool de transações</em>, <em>pool de memória</em> ou <em>mempool</em>.</p>
</div>
<div class="paragraph data-line-131">
<p>=== Nós Mineradores</p>
</div>
<div class="paragraph data-line-133">
<p>Some of the nodes on the Bitcoin network are specialized nodes called <em>miners</em>. In <a href="#ch01_intro_what_is_bitcoin">Introdução</a> we introduced Jing, a computer engineering student in Shanghai, China, who is a bitcoin miner. Jing earns bitcoin by running a "mining rig," which is a specialized computer-hardware system designed to mine bitcoin. Jing&#8217;s specialized mining hardware is connected to a server running a full Bitcoin node. Unlike Jing, some miners mine without a full node, as we will see in <a href="#mining_pools">[mining_pools]</a>. Like every other full node, Jing&#8217;s node receives and propagates unconfirmed transactions on the Bitcoin network. Jing&#8217;s node, however, also aggregates these transactions into new blocks.</p>
</div>
<div class="paragraph data-line-135">
<p>Jing&#8217;s node is listening for new blocks, propagated on the Bitcoin network, as do all nodes. However, the arrival of a new block has special significance for a mining node. The competition among miners effectively ends with the propagation of a new block that acts as an announcement of a winner. To miners, receiving a valid new block means someone else won the competition and they lost. However, the end of one round of a competition is also the beginning of the next round. The new block is not just a checkered flag, marking the end of the race; it is also the starting pistol in the race for the next block.</p>
</div>
<div class="paragraph data-line-137">
<p>=== Agregando Transações em Blocos</p>
</div>
<div class="paragraph data-line-139">
<p>After validating transactions, a Bitcoin node will add them to the <em>memory pool</em>, or <em>transaction pool</em>, where transactions await until they can be included (mined) into a block. Jing&#8217;s node collects, validates, and relays new transactions just like any other node. Unlike other nodes, however, Jing&#8217;s node will then aggregate these transactions into a <em>candidate block</em>.</p>
</div>
<div class="paragraph data-line-141">
<p>Vamos seguir os blocos que foram criados durante o período em que a Alice comprou uma xícara de café da Cafeteria do Bob (ver <a href="#cup_of_coffee">[cup_of_coffee]</a>). A transação da Alice foi incluída no bloco 277.316. Para demonstrar os conceitos nesse capítulo, assumiremos que o bloco foi minerado pelo sistema de mineração do Jing e seguiremos a transação da Alice à medida que ela é incluída nesse novo bloco.</p>
</div>
<div class="paragraph data-line-143">
<p>Jing&#8217;s mining node maintains a local copy of the blockchain. By the time Alice buys the cup of coffee, Jing&#8217;s node has assembled a chain up to block 277,314. Jing&#8217;s node is listening for transactions, trying to mine a new block and also listening for blocks discovered by other nodes. As Jing&#8217;s node is mining, it receives block 277,315 through the Bitcoin network. The arrival of this block signifies the end of the competition for block 277,315 and the beginning of the competition to create block 277,316.</p>
</div>
<div class="paragraph data-line-145">
<p>Durante os últimos 10 minutos, enquanto o nó do Jing procurava uma solução para o bloco 277.315, ele também estava coletando transações para preparar para o próximo bloco. Agora ele já coletou algumas centenas de transações na pool de memória. Ao receber o bloco 277.315 e validá-lo, o nó do Jing também irá compará-lo com todas as transações na pool de memória e removerá qualquer transação que já tiver sido incluída no bloco 277.315. As transações que permanecem na pool de memória são transações não confirmadas e estão aguardando para serem registradas em um novo bloco.</p>
</div>
<div class="paragraph data-line-147">
<p>O nó do Jing imediatamente constrói um novo bloco vazio, um candidato para o bloco 277.316. Esse bloco é chamado de <em>bloco candidato</em>, pois ele ainda não é um bloco válido, visto que ele não contém uma Prova-de-Trabalho válida. O bloco só se torna válido se o minerador conseguir encontrar uma solução para o algoritmo de Prova-de-Trabalho.</p>
</div>
<div class="paragraph data-line-149">
<p>Quando o nó do Jing agrega todas as transações da pool de memória, o novo bloco candidato tem 418 transações com um total de taxas de transação de 0,09094928 bitcoin. Você pode ver este bloco na blockchain usando a interface em linha de comando do cliente Bitcoin Core, como demonstrado no <a href="#block277316">Usando a linha de comando para recuperar o bloco 277.316</a>.</p>
</div>
<div id="block277316" class="exampleblock data-line-153">
<div class="title">Example 24. Usando a linha de comando para recuperar o bloco 277.316</div>
<div class="content">
<div class="listingblock data-line-155">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ bitcoin-cli getblockhash 277316

0000000000000001b6b9a13b095e96db41c4a928b97ef2d944a9b31b2cc7bdc4

$ bitcoin-cli getblock 0000000000000001b6b9a13b095e96db41c4a928b97ef2d9\
44a9b31b2cc7bdc4</code></pre>
</div>
</div>
<div class="listingblock data-line-166">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "hash" : "0000000000000001b6b9a13b095e96db41c4a928b97ef2d944a9b31b2cc7bdc4",
    "confirmations" : 35561,
    "size" : 218629,
    "height" : 277316,
    "version" : 2,
    "merkleroot" : "c91c008c26e50763e9f548bb8b2fc323735f73577effbc55502c51eb4cc7cf2e",
    "tx" : [
        "d5ada064c6417ca25c4308bd158c34b77e1c0eca2a73cda16c737e7424afba2f",
        "b268b45c59b39d759614757718b9918caf0ba9d97c56f3b91956ff877c503fbe",

        ... 417 outras transações ...

       ],
    "time" : 1388185914,
    "nonce" : 924591752,
    "bits" : "1903a30c",
    "difficulty" : 1180923195.25802612,
    "chainwork" : "000000000000000000000000000000000000000000000934695e92aaf53afa1a",
    "previousblockhash" : "0000000000000002a7bbd25a417c0374cc55261021e8a9ca74442b01284f0569"
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-191">
<p>==== A Transação Coinbase</p>
</div>
<div class="paragraph data-line-193">
<p>A primeira transação de qualquer bloco é uma transação especial, chamada de <em>transação coinbase</em>. Essa transação é construída pelo nó do Jing e contém a <em>recompensa</em> pelos seus esforços de mineração.</p>
</div>
<div class="admonitionblock note data-line-196">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-197">
<p>Quando o bloco 277.316 foi minerado, a recompensa era de 25 bitcoins por bloco. Desde então, já se passaram dois períodos de "redução pela metade" (em inglês, <em>halvings</em>). A recompensa do bloco mudou para 12,5 bitcoins em julho de 2016 e depois para 6,25 bitcoins em maio de 2020.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-200">
<p>O nó do Jing cria a transação coinbase como um pagamento para a sua própria carteira: "Pague ao endereço do Jing 25,09094928 bitcoins". O valor total da recompensa que o Jing coleta por minerar um bloco é a soma da recompensa coinbase (25 novos bitcoins) com as taxas de transação (0,09094928) de todas as transações incluídas no bloco, como demonstrado no <a href="#generation_tx_example">Transação coinbase</a>.</p>
</div>
<div id="generation_tx_example" class="exampleblock data-line-205">
<div class="title">Example 25. Transação coinbase</div>
<div class="content">
<div class="listingblock data-line-206">
<div class="content">
<pre>$ bitcoin-cli getrawtransaction d5ada064c6417ca25c4308bd158c34b77e1c0eca2a73cda16c737e7424afba2f 1</pre>
</div>
</div>
<div class="listingblock c_less_space data-line-212">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "hex" : "01000000010000000000000000000000000000000000000000000000000000000000000000ffffffff0f03443b0403858402062f503253482fffffffff0110c08d9500000000232102aa970c592640d19de03ff6f329d6fd2eecb023263b9ba5d1b81c29b523da8b21ac00000000",
    "txid" : "d5ada064c6417ca25c4308bd158c34b77e1c0eca2a73cda16c737e7424afba2f",
    "version" : 1,
    "locktime" : 0,
    "vin" : [
        {
            "coinbase" : "03443b0403858402062f503253482f",
            "sequence" : 4294967295
        }
    ],
    "vout" : [
        {
            "value" : 25.09094928,
            "n" : 0,
            "scriptPubKey" : {
                "asm" : "02aa970c592640d19de03ff6f329d6fd2eecb023263b9ba5d1b81c29b523da8b21OP_CHECKSIG",
                "hex" : "2102aa970c592640d19de03ff6f329d6fd2eecb023263b9ba5d1b81c29b523da8b21ac",
                "reqSigs" : 1,
                "type" : "pubkey",
                "addresses" : [
                    "1MxTkeEP2PmHSMze5tUZ1hAV3YTKu2Gh1N"
                ]
            }
        }
    ]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-243">
<p>Unlike regular transactions, the coinbase transaction does not consume (spend) UTXO as inputs. Instead, it has only one input, called the <em>coinbase</em>, which creates bitcoin from nothing. The coinbase transaction has one output, payable to the miner&#8217;s own Bitcoin address. The output of the coinbase transaction sends the value of 25.09094928 bitcoin to the miner&#8217;s Bitcoin address; in this case it is 1MxTkeEP2PmHSMze5tUZ1hAV3YTKu2Gh1N.</p>
</div>
<div class="paragraph data-line-245">
<p>==== Recompensa da Coinbase e Taxas</p>
</div>
<div class="paragraph data-line-247">
<p>Para construir a transação coinbase, o nó do Jing primeiro calcula a quantia total de taxas de transação ao somar todas as entradas e saídas das 418 transações que foram adicionadas ao bloco. As taxas são calculadas da seguinte forma:</p>
</div>
<div class="listingblock data-line-249">
<div class="content">
<pre>Total de Taxas = Soma(Entradas) – Soma(Saídas)</pre>
</div>
</div>
<div class="paragraph data-line-253">
<p>No bloco 277.316, o total de taxas de transação é de 0,09094928 bitcoin.</p>
</div>
<div class="paragraph data-line-255">
<p>A seguir, o nó do Jing calcula a recompensa correta para o novo bloco. A recompensa é calculada com base na altura do bloco, iniciando em 50 bitcoins por bloco e reduzindo-a pela metade a cada 210.000 blocos. Como esse bloco está na altura 277.316, a recompensa correta é de 25 bitcoins.</p>
</div>
<div class="paragraph data-line-257">
<p>O cálculo pode ser visto na função GetBlockSubsidy no cliente Bitcoin Core, como demonstrado no <a href="#getblocksubsidy_source">Calculando a recompensa do bloco&#x2014;Função GetBlockSubsidy, Cliente Bitcoin Core, main.cpp</a>.</p>
</div>
<div id="getblocksubsidy_source" class="exampleblock data-line-261">
<div class="title">Example 26. Calculando a recompensa do bloco&#x2014;Função GetBlockSubsidy, Cliente Bitcoin Core, main.cpp</div>
<div class="content">
<div class="listingblock c_less_space data-line-264">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">CAmount GetBlockSubsidy(int nHeight, const Consensus::Params&amp; consensusParams)
{
    int halvings = nHeight / consensusParams.nSubsidyHalvingInterval;
    // Força a recompensa do bloco para zero quando o deslocamento para a direita for indefinido
    if (halvings &gt;= 64)
        return 0;

    CAmount nSubsidy = 50 * COIN;
    // O subsídio é cortado pela metade a cada 210.000 blocos, o que acontecerá, em média, a cada 4 anos.
    nSubsidy &gt;&gt;= halvings;
    return nSubsidy;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-280">
<p>O subsídio inicial é calculado em satoshis ao se multiplicar 50 pela constante COIN (100.000.000 satoshis). Isso define a recompensa inicial (nSubsidy) como 5 bilhões de satoshis.</p>
</div>
<div class="paragraph data-line-282">
<p>Em seguida, a função calcula o número de halvings  (reduções pela metade no subsídio) que ocorreram dividindo a altura do bloco atual pelo intervalo de <em>halving</em> (SubsidyHalvingInterval). No caso do bloco 277.316, com um intervalo de <em>halving</em> a cada 210.000 blocos, o resultado é 1 <em>halving</em> (uma redução pela metade).</p>
</div>
<div class="paragraph data-line-284">
<p>O número máximo permitido de <em>halvings</em> é de 64, então o código impõe uma recompensa zero (retorna apenas as taxas) se as 64 <em>halvings</em> forem excedidas.</p>
</div>
<div class="paragraph data-line-286">
<p>Em seguida, a função usa o operador de deslocamento binário à direita para dividir a recompensa (nSubsidy) por dois a cada rodada de <em>halving</em>. No caso do bloco 277.316, isso faria um deslocamento binário à direita da recompensa de 5 bilhões de satoshis uma vez (um <em>halving</em>), o que resultaria em 2,5 bilhões de satoshis, ou 25 bitcoins. O operador de deslocamento binário à direita é usado porque ele é mais eficiente do que se fazer várias divisões repetidas. Para evitar um bug potencial, a operação de deslocamento é pulada após 63 <em>halvings</em>, e a recompensa passa a ser definida como 0.</p>
</div>
<div class="paragraph data-line-288">
<p>Finalmente, a recompensa coinbase (nSubsidy) é adicionada às taxas de transação (nFees), e retorna-se o valor da soma.</p>
</div>
<div class="admonitionblock tip data-line-291">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-292">
<p>Se o nó de mineração do Jing cria a transação coinbase, o que impede o Jing de se "auto-recompensar" com 100 ou 1.000 bitcoins? A resposta é que uma recompensa incorreta resultaria no bloco sendo considerado inválido por todos os outros nós da rede, o que acabaria desperdiçando toda a eletricidade que o Jing usou para a Prova-de-Trabalho. O Jing só consegue gastar a recompensa se o seu bloco for aceito por todos os nós da rede.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-295">
<p>==== Estrutura da Transação Coinbase</p>
</div>
<div class="paragraph data-line-297">
<p>Com esses cálculos, o nó do Jing constrói então a transação coinbase para pagar a si próprio 25,09094928 bitcoins.</p>
</div>
<div class="paragraph data-line-299">
<p>Como você pode ver no <a href="#generation_tx_example">Transação coinbase</a>, a transação coinbase possui um formato especial. Ao invés de ter uma entrada de transação especificando uma UTXO prévia para ser gasta, ela possui uma entrada "coinbase". Já examinamos as entradas de transação na <a href="#tx_in_structure">Serialização da entrada de transação</a>. Agora vamos comparar uma entrada de uma transação comum com uma entrada de uma transação coinbase. A <a href="#table_8-1">A estrutura de uma entrada de uma transação "normal"</a> demonstra a estrutura de uma entrada de uma transação comum, enquanto a <a href="#table_8-2">A estrutura de uma entrada de uma transação coinbase</a> demonstra a estrutura de uma entrada de uma transação coinbase.</p>
</div>
<table id="table_8-1" class="tableblock frame-all grid-all stretch data-line-304">
<caption class="title">Table 27. A estrutura de uma entrada de uma transação "normal"</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tamanho</th>
<th class="tableblock halign-left valign-top">Campo</th>
<th class="tableblock halign-left valign-top">Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hash da Transação</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apontador para a transação contendo a UTXO a ser gasta</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Índice da Saída</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O número índice da UTXO a ser gasta, o primeiro é 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1&#x2013;9 bytes (VarInt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tamanho do Script de Destravamento</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comprimento em bytes do Script de Destravamento</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Variável</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Script de Destravamento</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Um script que preenche as condições necessárias para o script de travamento da UTXO</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Número Sequencial</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Geralmente definido como 0xFFFFFFFF para excluir a BIP-125 e a BIP-68</p></td>
</tr>
</tbody>
</table>
<table id="table_8-2" class="tableblock frame-all grid-all stretch data-line-316">
<caption class="title">Table 28. A estrutura de uma entrada de uma transação coinbase</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tamanho</th>
<th class="tableblock halign-left valign-top">Campo</th>
<th class="tableblock halign-left valign-top">Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hash da Transação</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Todos os bits são "0": Não é uma referência a um hash de transação</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Índice da Saída</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Todos os bits são "1": 0xFFFFFFFF</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1&#x2013;9 bytes (VarInt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tamanho dos Dados Coinbase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comprimento dos dados coinbase, de 2 a 100 bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Variável</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dados Coinbase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dados arbitrários usados para o nonce extra e tags de mineração. Em blocos da v2, deve começar com a altura do bloco</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Número Sequencial</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definido como 0xFFFFFFFF</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-325">
<p>Em uma transação coinbase, os dois primeiros campos são definidos para valores que não representam uma referência a uma UTXO. Ao invés de ter um "hash da transação", o primeiro campo é preenchido com 32 bytes, todos definidos como zero. O "índice da saída" é preenchido com 4 bytes, todos definidos como 0xFF (255 em decimais). O "Script de Destravamento" (scriptSig) é substituído pelos dados coinbase, que é um campo de dados usado pelos mineradores, como veremos a seguir.</p>
</div>
<div class="paragraph data-line-327">
<p>==== Dados Coinbase</p>
</div>
<div class="paragraph data-line-329">
<p>As transações coinbase não têm um campo de script de destravamento (também conhecido como scriptSig). Em vez disso, este campo é substituído pelos dados coinbase, que devem ter entre 2 e 100 bytes. Exceto pelos primeiros bytes, os demais bytes dos dados coinbase podem ser usados pelos mineradores da maneira que quiserem; são dados arbitrários.</p>
</div>
<div class="paragraph data-line-331">
<p>No bloco gênese, por exemplo, Satoshi Nakamoto adicionou nos dados coinbase o texto "<em>The Times 03/Jan/2009 Chancellor on brink of second bailout for banks</em>" (em português, "The Times 03/Jan/2009 Chanceler prestes a conceder segundo resgate aos bancos"), usando isso como prova da data em que o primeiro bloco foi gerado, e também para passar uma mensagem. Atualmente os mineradores usam os dados coinbase para incluir valores extras de nonce e <em>strings</em> identificando a pool de mineração.</p>
</div>
<div class="paragraph data-line-333">
<p>Antigamente os primeiros bytes da coinbase costumavam ser arbitrários. Atualmente, desde a BIP-34, os blocos da versão 2 (blocos com o campo de versão definido como 2) devem conter o índice da altura do bloco como uma operação "push" de script no início do campo dos dados coinbase.</p>
</div>
<div class="paragraph data-line-335">
<p>No bloco 277.316, vemos que a coinbase (ver o <a href="#generation_tx_example">Transação coinbase</a>), que está no script de destravamento ou no campo scriptSig da entrada da transação, contém o valor hexadecimal 03443b0403858402062f503253482f. Vamos decodificar esse valor.</p>
</div>
<div class="paragraph data-line-337">
<p>O primeiro byte, 03, instrui o motor de execução do script a adicionar os próximos três bytes no stack do script (ver a <a href="#tx_script_ops_table_pushdata">Operadores que adicionam valores no stack</a>). Os próximos três bytes, 0x443b04, são a altura do bloco codificada no formato little-endian (em sentido contrário, com o byte menos significativo primeiro). Inverta a ordem dos bytes e o resultado será 0x043b44, que é 277.316 em decimais.</p>
</div>
<div class="paragraph data-line-339">
<p>Os próximos poucos dígitos hexadecimais (03858402062) são usados para codificar um <em>nonce</em> extra (ver <a href="#extra_nonce">[extra_nonce]</a>), ou um valor aleatório, usado para achar uma solução adequada para a Prova-de-Trabalho.</p>
</div>
<div class="paragraph data-line-341">
<p>A parte final dos dados coinbase (2f503253482f) é a <em>string</em> codificada em ASCII <span class="keep-together"><code>/P2SH/</code></span>, que indica que o nó minerador que minerou esse bloco oferece suporte para a melhoria P2SH definida na BIP-16. Na época em que a funcionalidade P2SH foi introduzida, os mineradores tiveram que sinalizar se eles estavam apoiando a BIP-16 ou a BIP-17. Aqueles que apoiavam a implementação da BIP-16 deveriam incluir a <em>string</em> /P2SH/ nos seus dados coinbase. Aqueles que apoiavam a implementação da BIP-17 deveriam incluir a <em>string</em> p2sh/CHV nos seus dados coinbase. Por fim, a BIP-16 acabou sendo eleita como a vencedora, e muitos mineradores continuaram a incluir a <em>string</em> /P2SH/ em seus dados coinbase para indicar que eles oferecem suporte para essa funcionalidade.</p>
</div>
<div class="paragraph data-line-343">
<p>O <a href="#satoshi_words">Extração dos dados coinbase do bloco gênese</a> usa a biblioteca libbitcoin apresentada em <a href="#alt_libraries">[alt_libraries]</a> para extrair os dados coinbase do bloco gênese, exibindo a mensagem do Satoshi. Como a biblioteca libbitcoin contém uma cópia estática do bloco gênese, o código de exemplo pode adquirir o bloco gênese diretamente da biblioteca.</p>
</div>
<div id="satoshi_words" class="exampleblock data-line-347">
<div class="title">Example 27. Extração dos dados coinbase do bloco gênese</div>
<div class="content">
<div class="listingblock data-line-349">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">Unresolved directive in for_use_mastering-bitcoin_chapter-10_pt_BR.adoc - include::code/satoshi-words.cpp[]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-354">
<p>Compilamos o código com o compilador GNU de C++ e rodamos o executável resultante, como demonstrado no <a href="#satoshi_words_run">Compilando e executando o código de exemplo satoshi-words</a>.</p>
</div>
<div id="satoshi_words_run" class="exampleblock data-line-358">
<div class="title">Example 28. Compilando e executando o código de exemplo satoshi-words</div>
<div class="content">
<div class="listingblock data-line-360">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># Compila o código
$  g++ -o satoshi-words satoshi-words.cpp $(pkg-config --cflags --libs libbitcoin)
# Roda o executável
$ ./satoshi-words
^D��&lt;GS&gt;^A^DEThe Times 03/Jan/2009 Chancellor on brink of second bailout for banks</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-369">
<p>=== Construindo o Cabeçalho do Bloco</p>
</div>
<div class="paragraph data-line-371">
<p>Para construir o cabeçalho do bloco, o nó minerador precisa preenchê-lo em seis campos, conforme listados na <a href="#block_header_structure_ch10">A estrutura do cabeçalho do bloco</a>.</p>
</div>
<table id="block_header_structure_ch10" class="tableblock frame-all grid-all stretch data-line-376">
<caption class="title">Table 29. A estrutura do cabeçalho do bloco</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tamanho</th>
<th class="tableblock halign-left valign-top">Campo</th>
<th class="tableblock halign-left valign-top">Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Versão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Um número de versão para monitorar atualizações de software/protocolo.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hash do Bloco Anterior</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uma referência ao hash do bloco anterior (bloco pai) na blockchain</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Raiz de Merkle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Um hash da raiz da árvore de merkle das transações desse bloco</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data e Hora (timestamp)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O momento aproximado em que este bloco foi criado (em segundos decorridos desde a Época Unix)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alvo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O alvo do algoritmo de Prova-de-Trabalho para este bloco</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nonce</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Um contador usado para o algoritmo de Prova-de-Trabalho</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-386">
<p>No momento em que o bloco 277.316 foi minerado, o número de versão descrevendo a estrutura do bloco era a versão 2, que é codificada no formato <em>little-endian</em> em 4 bytes como 0x02000000.</p>
</div>
<div class="paragraph data-line-388">
<p>A seguir, o nó de mineração precisa adicionar o "Hash do Bloco Anterior" (também conhecido como prevhash). Esse é o hash do cabeçalho do bloco 277.315, o bloco previamente recebido da rede, que o nó do Jing aceitou e selecionou como sendo o bloco <em>pai</em> do bloco candidato 277.316. O hash do cabeçalho do bloco para o bloco 277.315 é:</p>
</div>
<div class="listingblock data-line-390">
<div class="content">
<pre>0000000000000002a7bbd25a417c0374cc55261021e8a9ca74442b01284f0569</pre>
</div>
</div>
<div class="admonitionblock tip data-line-395">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-396">
<p>Ao selecionar o bloco <em>pai</em> específico, indicado pelo campo Hash do Bloco Anterior no cabeçalho do bloco candidato, o Jing está dedicando seu poder de mineração para estender a cadeia que termina naquele bloco específico. Em essência, é assim que o Jing "vota", usando seu poder de mineração, na cadeia válida de maior dificuldade.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-399">
<p>O próximo passo é fazer um resumo de todas as transações com uma árvore de merkle, para adicionar a raiz de merkle ao cabeçalho do bloco. A transação coinbase é listada como a primeira transação no bloco. A seguir, mais 418 transações são adicionadas após a transação coinbase, totalizando 419 transações no bloco. Conforme vimos em <a href="#merkle_trees">[merkle_trees]</a>, deve haver um número par de nós "folhas" na árvore, portanto, a última transação é duplicada, criando 420 nós, cada um contendo o hash de uma transação. Os hashes das transações são então combinados, em pares, criando cada nível da árvore, até que todas as transações sejam resumidas em um nó único na "raiz" da árvore. A raiz da árvore de merkle resume todas as transações em um valor único de 32 bytes, que você pode ver listado como "raiz de merkle" ("<em>merkle root</em>") em <a href="#block277316">Usando a linha de comando para recuperar o bloco 277.316</a>, e abaixo:</p>
</div>
<div class="listingblock data-line-401">
<div class="content">
<pre>c91c008c26e50763e9f548bb8b2fc323735f73577effbc55502c51eb4cc7cf2e</pre>
</div>
</div>
<div class="paragraph data-line-405">
<p>Depois disso, o nó de mineração do Jing adicionará um carimbo de data e hora de 4 bytes, codificado como um <em>timestamp</em> de Época Unix, que é baseado no número de segundos decorridos desde a meia-noite UTC de quinta-feira, 1º de janeiro de 1970. O valor 1388185914 corresponde a sexta-feira, 27 de dezembro de 2013, 23:11:54 UTC.</p>
</div>
<div class="paragraph data-line-407">
<p>A seguir, o nó do Jing preenche o alvo, que define a Prova-de-Trabalho necessária para tornar esse bloco válido. O alvo é armazenado no bloco utilizando-se a métrica "bits alvo" ("<em>target bits</em>"), que é uma codificação mantissa-expoente do alvo. A codificação tem um expoente de 1 byte, seguido por uma mantissa (um coeficiente) de 3 bytes. No bloco 277.316, por exemplo, o valor dos bits alvo é 0x1903a30c. A primeira parte 0x19 é um expoente hexadecimal, enquanto a segundo parte, 0x03a30c, é o coeficiente. O conceito de um alvo é explicado em <a href="#target">[target]</a> e a representação "bits alvo" é explicada em <a href="#target_bits">[target_bits]</a>.</p>
</div>
<div class="paragraph data-line-409">
<p>O último campo é o nonce, que é inicializado em zero.</p>
</div>
<div class="paragraph data-line-411">
<p>Com todos os outros campos preenchidos, o cabeçalho do bloco agora está completo e o processo de mineração pode começar. O objetivo agora é encontrar um valor para o nonce que resulte em um hash de cabeçalho de bloco menor ou igual ao alvo. O nó de mineração terá que testar bilhões ou trilhões de valores de nonce até encontrar um nonce que satisfaça essa exigência.</p>
</div>
<div class="paragraph data-line-413">
<p>=== Minerando o Bloco</p>
</div>
<div class="paragraph data-line-415">
<p>Now that a candidate block has been constructed by Jing&#8217;s node, it is time for Jing&#8217;s hardware mining rig to "mine" the block, to find a solution to the Proof-of-Work algorithm that makes the block valid. Throughout this book we have studied cryptographic hash functions as used in various aspects of the Bitcoin system. The hash function SHA256 is the function used in bitcoin&#8217;s mining process.</p>
</div>
<div class="paragraph data-line-417">
<p>Explicando de maneira simples, a mineração é o processo no qual se submete o cabeçalho do bloco a uma função de hash de maneira repetida, até que o hash resultante corresponda a um alvo específico. Os resultados da função de hash não podem ser determinados com antecedência, e não é possível criar um padrão que produzirá um valor de hash específico. Essa característca das funções de hash faz com que a única maneira de se produzir um resultado de hash que corresponde a um alvo específico seja através de sucessivas tentativas, modificando aleatoriamente os dados que alimentam a função (conhecidos como a entrada ou <em>input</em> da função) até que o hash resultante desejado apareça por acaso.</p>
</div>
<div class="paragraph data-line-419">
<p>==== Algoritmo de Prova-de-Trabalho</p>
</div>
<div class="paragraph data-line-421">
<p>Um algoritmo de hash pega uma entrada (um <em>input</em>) de dados de comprimento arbitrário e produz como saída um resultado determinístico de comprimento fixo, que é uma impressão digital da entrada. Para cada entrada específica, o hash resultante sempre será o mesmo e pode ser facilmente calculado e verificado por qualquer pessoa que implementar o mesmo algoritmo de hash. A característica-chave de um algoritmo de hash criptográfico é que é computacionalmente inviável encontrar duas entradas diferentes que produzam a mesma impressão digital (o que é conhecido como uma <em>colisão</em>). Consequentemente, também é virtualmente impossível selecionar-se uma entrada de uma maneira a produzir uma impressão digital desejada, a menos que se fique tentando usar entradas aleatórias.</p>
</div>
<div class="paragraph data-line-423">
<p>Com a função de hash SHA256, a saída (o resultado) da função sempre tem 256 bits de comprimento, independente do tamanho da entrada. No <a href="#sha256_example1">Exemplo de SHA256</a>, usaremos o intérprete Python para calcular o hash SHA256 da frase, "I am Satoshi Nakamoto".</p>
</div>
<div id="sha256_example1" class="exampleblock data-line-427">
<div class="title">Example 29. Exemplo de SHA256</div>
<div class="content">
<div class="listingblock data-line-429">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ python</code></pre>
</div>
</div>
<div class="listingblock data-line-433">
<div class="content">
<pre class="highlight"><code class="language-pycon" data-lang="pycon">Python 3.7.3
&gt;&gt;&gt; import hashlib
&gt;&gt;&gt; hashlib.sha256(b"I am Satoshi Nakamoto").hexdigest()
'5d7c7ba21cbbcd75d14800b100252d5b428e5b1213d27c385bc141ca6b47989e'</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-441">
<p>O <a href="#sha256_example1">Exemplo de SHA256</a> demonstra o resultado ao se calcular o hash da frase "I am Satoshi Nakamoto": 5d7c7ba21cbbcd75d14800b100252d5b428e5b1213d27c385bc141ca6b47989e. Esse número de 256 bits é o <em>hash</em> ou o "<em>digest</em>" da frase e ele é dependente de cada parte da frase. A adição de uma única letra, uma pontuação ou qualquer outro caractere produzirá um hash diferente.</p>
</div>
<div class="paragraph data-line-443">
<p>Agora, se mudarmos a frase, deveríamos ver hashes completamente diferentes. Vamos experimentar isso ao adicionar um número ao final de nossa frase, usando o script Python simples no <a href="#sha256_example_generator">Script SHA256 para gerar muitos hashes através de iteração com um nonce</a>.</p>
</div>
<div id="sha256_example_generator" class="exampleblock data-line-447">
<div class="title">Example 30. Script SHA256 para gerar muitos hashes através de iteração com um nonce</div>
<div class="content">
<div class="listingblock c_less_space data-line-450">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">Unresolved directive in for_use_mastering-bitcoin_chapter-10_pt_BR.adoc - include::code/hash_example.py[]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-455">
<p>A execução desse exemplo produzirá os hashes de várias frases, que serão diferentes devido à adição de um número no final do texto. Ao incrementar o número, podemos obter hashes diferentes, como demonstrado no <a href="#sha256_example_generator_output">Saídas SHA256 de um script usado para gerar muitos hashes através de iteração com um nonce</a>.</p>
</div>
<div id="sha256_example_generator_output" class="exampleblock data-line-459">
<div class="title">Example 31. Saídas SHA256 de um script usado para gerar muitos hashes através de iteração com um nonce</div>
<div class="content">
<div class="listingblock data-line-461">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ python hash_example.py</code></pre>
</div>
</div>
<div class="listingblock data-line-465">
<div class="content">
<pre>I am Satoshi Nakamoto0 =&gt; a80a81401765c8eddee25df36728d732...
I am Satoshi Nakamoto1 =&gt; f7bc9a6304a4647bb41241a677b5345f...
I am Satoshi Nakamoto2 =&gt; ea758a8134b115298a1583ffb80ae629...
I am Satoshi Nakamoto3 =&gt; bfa9779618ff072c903d773de30c99bd...
I am Satoshi Nakamoto4 =&gt; bce8564de9a83c18c31944a66bde992f...
I am Satoshi Nakamoto5 =&gt; eb362c3cf3479be0a97a20163589038e...
I am Satoshi Nakamoto6 =&gt; 4a2fd48e3be420d0d28e202360cfbaba...
I am Satoshi Nakamoto7 =&gt; 790b5a1349a5f2b909bf74d0d166b17a...
I am Satoshi Nakamoto8 =&gt; 702c45e5b15aa54b625d68dd947f1597...
I am Satoshi Nakamoto9 =&gt; 7007cf7dd40f5e933cd89fff5b791ff0...
I am Satoshi Nakamoto10 =&gt; c2f38c81992f4614206a21537bd634a...
I am Satoshi Nakamoto11 =&gt; 7045da6ed8a914690f087690e1e8d66...
I am Satoshi Nakamoto12 =&gt; 60f01db30c1a0d4cbce2b4b22e88b9b...
I am Satoshi Nakamoto13 =&gt; 0ebc56d59a34f5082aaef3d66b37a66...
I am Satoshi Nakamoto14 =&gt; 27ead1ca85da66981fd9da01a8c6816...
I am Satoshi Nakamoto15 =&gt; 394809fb809c5f83ce97ab554a2812c...
I am Satoshi Nakamoto16 =&gt; 8fa4992219df33f50834465d3047429...
I am Satoshi Nakamoto17 =&gt; dca9b8b4f8d8e1521fa4eaa46f4f0cd...
I am Satoshi Nakamoto18 =&gt; 9989a401b2a3a318b01e9ca9a22b0f3...
I am Satoshi Nakamoto19 =&gt; cda56022ecb5b67b2bc93a2d764e75f...</pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-489">
<p>Cada frase produz um resultado de hash completamente diferente. Eles parecem ser completamente aleatórios, mas você é capaz de reproduzir exatamente os mesmos resultados desse exemplo em qualquer computador com Python e ver exatamente os mesmos hashes.</p>
</div>
<div class="paragraph data-line-491">
<p>O número usado como uma variável em um cenário deste tipo é chamado de <em>nonce</em>. O nonce é usado para variar o output de uma função criptográfica, nesse caso para variar a impressão digital da frase ao ser submetida ao algoritmo SHA256.</p>
</div>
<div class="paragraph data-line-493">
<p>Para fazer um desafio com esse algoritmo, vamos definir um alvo: encontrar uma frase que produza um hash hexadecimal que começa com um zero. Felizmente, isso não é difícil! O <a href="#sha256_example_generator_output">Saídas SHA256 de um script usado para gerar muitos hashes através de iteração com um nonce</a> demonstra que a frase "I am Satoshi Nakamoto13" produz o hash 0ebc56d59a34f5082aaef3d66b37a661696c2b618e62432727216ba9531041a5, que preenche nossos critérios. Levamos 13 tentativas até encontrá-lo. Em termos de probabilidades, se a saída da função de hash for distribuída igualmente, esperaríamos encontrar um resultado com um zero como prefixo hexadecimal uma vez a cada 16 hashes (um em cada 16 dígitos hexadecimais, do 0 ao F). Em termos numéricos, isso significa encontrar um valor de hash que é menor que 0x1000000000000000000000000000000000000000000000000000000000000000. Chamamos esse limiar de <em>alvo</em> e o objetivo é encontrar um hash que é numericamente menor ou igual ao alvo. Se diminuirmos o alvo, torna-se cada vez mais difícil a tarefa de encontrar um hash que é menor que o alvo.</p>
</div>
<div class="paragraph data-line-495">
<p>Para fazer uma analogia simples, imagine um jogo onde os jogadores lançam um par de dados repetidamente, tentando obter uma soma que seja menor ou igual a um alvo especificado. Na primeira rodada, o alvo da soma é 11. A menos que você tire seis em ambos os dados, você ganha. Na próxima rodada o alvo é 10. Os jogadores devem obter uma soma que seja menor ou igual a 10 para ganhar, o que também é uma tarefa fácil. Digamos que algumas rodadas mais tarde o alvo é 5. Agora, mais da metade dos lançamentos excederá o alvo e, portanto, serão inválidos. O número de lançamentos necessários para se ganhar aumenta exponencialmente, quanto menor for o alvo. Por fim, quando o alvo for 2 (o menor possível), somente um em cada 36 lançamentos, ou 2% deles, produzirá um resultado vencedor.</p>
</div>
<div class="paragraph data-line-497">
<p>Do ponto de vista de um observador que sabe que o alvo do jogo de dados é 2, se alguém conseguiu obter um resultado vencedor ao lançar os dados, pode-se presumir que a pessoa teve que lançar os dados, em média, 36 vezes. Em outras palavras, é possível estimar-se a quantidade de trabalho necessária para se ter sucesso a partir da dificuldade imposta pelo alvo. Quando o algoritmo é baseado em uma função determinística como a SHA256, o próprio input constitui uma <em>prova</em> de que uma certa quantidade de <em>trabalho</em> foi realizada para produzir um resultado menor ou igual ao alvo. Portanto, Prova-de-Trabalho (em inglês, <em>Proof-of-Work</em>).</p>
</div>
<div class="admonitionblock tip data-line-500">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-501">
<p>Mesmo que cada tentativa produza um resultado aleatório, a probabilidade de se conseguir obter um resultado pode ser calculada antecipadamente. Portanto, um resultado com uma determinada dificuldade constitui prova de que uma determinada quantidade de trabalho foi realizada.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-504">
<p>No <a href="#sha256_example_generator_output">Saídas SHA256 de um script usado para gerar muitos hashes através de iteração com um nonce</a>, o "nonce" vencedor é 13 e esse resultado pode ser confirmado por qualquer pessoa de maneira independente. Qualquer um pode adicionar o número 13 como sufixo da frase "I am Satoshi Nakamoto" e computar o hash, verificando que ele é menor do que o alvo. A confirmação desse resultado também é uma Prova-de-Trabalho, pois ela serve como prova de que nós trabalhamos para encontrar esse nonce. Enquanto a verificação exige a computação de apenas um único hash, foi necessária a computação de 13 hashes até que encontrássemos um nonce que funcionasse. Se tivéssemos um alvo menor (uma dificuldade maior), muitos mais hashes precisariam ser computados até se encontrar um nonce válido, mas continuaria sendo necessária a computação de apenas um único hash para verificá-lo. Além disso, qualquer pessoa que souber o alvo poderá estimar a dificuldade usando estatísticas, e, portanto, poderá saber quanto de trabalho foi necessário para se descobrir o "nonce" vencedor.</p>
</div>
<div class="admonitionblock tip data-line-507">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-508">
<p>A Prova-de-Trabalho deve produzir um hash <em>menor ou igual</em> ao alvo. Um alvo mais alto significa que é menos difícil encontrar um hash que é menor ou igual ao alvo. Um alvo mais baixo significa que é mais difícil encontrar um hash que é menor ou igual ao alvo. O alvo e a dificuldade estão inversamente relacionados.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-512">
<p>Bitcoin&#8217;s Proof-of-Work is very similar to the challenge shown in <a href="#sha256_example_generator_output">Saídas SHA256 de um script usado para gerar muitos hashes através de iteração com um nonce</a>. The miner constructs a candidate block filled with transactions. Next, the miner calculates the hash of this block&#8217;s header and sees if it is equal to or smaller than the current <em>target</em>. If the hash is greater than the target, the miner will modify the nonce (usually just incrementing it by one) and try again. At the current difficulty in the Bitcoin network, miners have to try quadrillions of times before finding a nonce that results in a low enough block header hash.</p>
</div>
<div class="paragraph data-line-514">
<p>Um algoritmo muito simplificado de Prova-de-Trabalho é implementado em Python no <a href="#pow_example1">Implementação de uma Prova-de-Trabalho simplificada</a>.</p>
</div>
<div id="pow_example1" class="exampleblock data-line-518">
<div class="title">Example 32. Implementação de uma Prova-de-Trabalho simplificada</div>
<div class="content">
<div class="listingblock data-line-520">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">Unresolved directive in for_use_mastering-bitcoin_chapter-10_pt_BR.adoc - include::code/proof-of-work-example.py[]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-525">
<p>Ao executar esse código, você pode definir a dificuldade desejada (em bits, a quantidade de bits iniciais que devem ser zero) e ver quanto tempo leva para seu computador encontrar uma solução. No <a href="#pow_example_outputs">Executando o exemplo de Prova-de-Trabalho em diferentes dificuldades</a>, você pode ver como isso funciona em um laptop comum.</p>
</div>
<div id="pow_example_outputs" class="exampleblock data-line-529">
<div class="title">Example 33. Executando o exemplo de Prova-de-Trabalho em diferentes dificuldades</div>
<div class="content">
<div class="listingblock data-line-531">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ python proof-of-work-example.py*</code></pre>
</div>
</div>
<div class="listingblock data-line-535">
<div class="content">
<pre>Dificuldade: 1 (0 bits)

[...]

Dificuldade: 8 (3 bits)
Iniciando a busca...
Sucesso com o nonce 9
O hash é 1c1c105e65b47142f028a8f93ddf3dabb9260491bc64474738133ce5256cb3c1
Tempo Decorrido: 0.0004 segundos
Poder de Hashing: 25065 hashes por segundo
Dificuldade: 16 (4 bits)
Iniciando a busca...
Sucesso com o nonce 25
O hash é 0f7becfd3bcd1a82e06663c97176add89e7cae0268de46f94e7e11bc3863e148
Tempo Decorrido: 0.0005 segundos
Poder de Hashing: 52507 hashes por segundo
Dificuldade: 32 (5 bits)
Iniciando a busca...
Sucesso com o nonce 36
O hash é 029ae6e5004302a120630adcbb808452346ab1cf0b94c5189ba8bac1d47e7903
Tempo Decorrido: 0.0006 segundos
Poder de Hashing: 58164 hashes por segundo

[...]

Dificuldade: 4194304 (22 bits)
Iniciando a busca...
Sucesso com o nonce 1759164
O hash é 0000008bb8f0e731f0496b8e530da984e85fb3cd2bd81882fe8ba3610b6cefc3
Tempo Decorrido: 13.3201 segundos
Poder de Hashing: 132068 hashes por segundo
Dificuldade: 8388608 (23 bits)
Iniciando a busca...
Sucesso com o nonce 14214729
O hash é 000001408cf12dbd20fcba6372a223e098d58786c6ff93488a9f74f5df4df0a3
Tempo Decorrido: 110.1507 segundos
Poder de Hashing: 129048 hashes por segundo
Dificuldade: 16777216 (24 bits)
Iniciando a busca...
Sucesso com o nonce 24586379
O hash é 0000002c3d6b370fccd699708d1b7cb4a94388595171366b944d68b2acce8b95
Tempo Decorrido: 195.2991 segundos
Poder de Hashing: 125890 hashes por segundo

[...]

Dificuldade: 67108864 (26 bits)
Iniciando a busca...
Sucesso com o nonce 84561291
O hash é 0000001f0ea21e676b6dde5ad429b9d131a9f2b000802ab2f169cbca22b1e21a
Tempo Decorrido: 665.0949 segundos
Poder de Hashing: 127141 hashes por segundo</pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-591">
<p>Como você pode ver, aumentar a dificuldade em um bit aumenta em duas vezes o tempo necessário para se encontrar uma solução. Se você pensar em todo o espaço numérico de 256 bits, cada vez que você restringe mais um bit a zero, você diminui o espaço de busca pela metade. No <a href="#pow_example_outputs">Executando o exemplo de Prova-de-Trabalho em diferentes dificuldades</a>, são necessárias 84 milhões de tentativas de hash para se encontrar um nonce que produza um hash cujos 26 bits iniciais sejam zero. Mesmo a uma velocidade de mais de 120.000 hashes por segundo, ainda são necessários 10 minutos para se encontrar essa solução em um notebook.</p>
</div>
<div class="paragraph data-line-593">
<p>No momento em que este livro estava sendo escrito, a rede estava tentando encontrar um bloco cujo hash do cabeçalho fosse menor ou igual a:</p>
</div>
<div class="listingblock data-line-595">
<div class="content">
<pre>0000000000000000029AB9000000000000000000000000000000000000000000</pre>
</div>
</div>
<div class="paragraph data-line-599">
<p>Como você pode ver, há muitos zeros no início desse alvo, o que significa que o intervalo de hashes aceitos é muito menor, e, portanto, é mais difícil encontrar um hash válido. Levará em média mais de 1,8 zetahashes (1,8 sextilhões de hashes) para a rede descobrir o próximo bloco. Parece uma tarefa impossível, mas felizmente a rede atualmente tem um poder de processamento de 3 exahashes por segundo (EH/s) (3 quintilhões de hashes/segundo), o que é suficiente para encontrar um bloco a cada 10 minutos em média. </p>
</div>
<div id="target_bits" class="paragraph data-line-602">
<p>==== Representação do Alvo</p>
</div>
<div class="paragraph data-line-604">
<p>No <a href="#block277316">Usando a linha de comando para recuperar o bloco 277.316</a>, vimos que o bloco contém o alvo, em uma notação chamada "bits alvo" ou simplesmente "bits", que no bloco 277.316 tinha o valor de 0x1903a30c. Essa notação expressa o alvo da Prova-de-Trabalho em um formato coeficiente/expoente, com os primeiros dois dígitos hexadecimais sendo o expoente e os próximos seis dígitos hexadecimais sendo o coeficiente. Nesse bloco, portanto, o expoente é 0x19 e o coeficiente é 0x03a30c.</p>
</div>
<div class="paragraph data-line-606">
<p>A fórmula para calcular o alvo de dificuldade a partir dessa representação é:</p>
</div>
<ul class="simplelist">
  <li>alvo = coeficiente * 2<sup>(8*(expoente–3))</sup></li>
</ul>
<div class="paragraph data-line-614">
<p>Usando essa fórmula, e o valor 0x1903a30c para os bits de dificuldade, obtemos:</p>
</div>
<ul class="simplelist">
  <li>alvo = 0x03a30c * 2<sup>0x08*(0x19-0x03)</sup></li>
  <li>=> alvo = 0x03a30c * 2<sup>(0x08*0x16)</sup></li>
  <li>=> alvo = 0x03a30c * 2<sup>0xB0</sup></li>
</ul>
<div class="paragraph data-line-624">
<p>que em decimal é:</p>
</div>
<ul class="simplelist">
  <li>=> alvo = 238,348 * 2<sup>176</sup></li>
  <li>=> alvo = <br/>22,829,202,948,393,929,850,749,706,076,701,368,331,072,452,018,388,575,715,328</li>
</ul>
<div class="paragraph data-line-633">
<p>transformando de volta para hexadecimal:</p>
</div>
<ul class="simplelist">
  <li>=> alvo = <br/>0x0000000000000003A30C00000000000000000000000000000000000000000000</li>
</ul>
<div class="paragraph data-line-641">
<p>Isso significa que um bloco válido para a altura 277.316 é um bloco que tem um hash de cabeçalho de bloco que é menor do que esse alvo. Em binários, esse número deve ter mais do que 60 bits iniciais definidos como zero. Com esse nível de dificuldade, um único minerador processando 1 trilhão de hashes por segundo (1 terahash por segundo ou 1 TH/s) encontraria uma solução, em média, somente uma vez a cada 8.496 blocos ou uma vez a cada 59 dias.</p>
</div>
<div id="target" class="paragraph data-line-644">
<p>==== Reajustando o Alvo para Ajustar a Dificuldade</p>
</div>
<div class="paragraph data-line-646">
<p>Conforme vimos anteriormente, o alvo determina a dificuldade e, portanto, afeta o quão demorado será necessário para encontrar uma solução para o algoritmo de Prova-de-Trabalho. Isso nos levanta algumas questões óbvias: por que a dificuldade é ajustável? Quem a ajusta? Como ela é ajustada?</p>
</div>
<div class="paragraph data-line-648">
<p>Os blocos do bitcoin são gerados, em média, a cada 10 minutos. Essa é a "frequência cardíaca" do bitcoin, que sustenta a frequência da emissão de moedas e a velocidade de confirmação das transações. Ela tem que permanecer constante não apenas a curto prazo, mas também a prazos muito longos, como décadas. Ao longo desse tempo, espera-se que o poder de processamento computacional continuará aumentando em um ritmo rápido. Além disso, o número de participantes na mineração e os computadores que eles usam também mudarão constantemente. Para manter o tempo de geração de blocos em 10 minutos, a dificuldade da mineração precisa ser ajustada para contabilizar essas mudanças. De fato, o alvo da Prova-de-Trabalho é um parâmetro dinâmico que é ajustado periodicamente para atingir a meta de um intervalo de 10 minutos entre cada bloco. Simplificando, o alvo é definido de forma que o poder de mineração atual resulte em um intervalo de 10 minutos entre a geração dos blocos.</p>
</div>
<div class="paragraph data-line-650">
<p>Como, então, tal ajuste é feito em uma rede completamente descentralizada? O reajuste do alvo ocorre automaticamente e em cada nó completo de maneira independente. A cada 2.016 blocos, todos os nós reajustam o alvo da Prova-de-Trabalho. A equação para reajustar o alvo mede o tempo que foi necessário para serem encontrados os últimos 2.016 blocos e o compara com o tempo esperado de 20.160 minutos (2.016 blocos vezes o intervalo de bloco desejado de 10 minutos). A razão entre os períodos de tempo atual e o desejado é calculada, e um ajuste proporcional (para cima ou para baixo) é feito ao alvo. Simplificando: se a rede estiver encontrando blocos em um ritmo mais rápido do que a cada 10 minutos, a dificuldade irá aumentar (o alvo irá diminuir). E se a descoberta de blocos estiver mais lenta do que o esperado, a dificuldade irá diminuir (o alvo irá aumentar).</p>
</div>
<div class="paragraph data-line-652">
<p>A equação pode ser resumida como:</p>
</div>
<div class="listingblock data-line-654">
<div class="content">
<pre>Novo Alvo = Alvo Antigo * (Tempo Necessário para Encontrar os Últimos 2.016 Blocos / 20.160 min.)</pre>
</div>
</div>
<div class="paragraph data-line-658">
<p>O <a href="#retarget_code">Reajustando o alvo da Prova-de-Trabalho&#x2014;CalculateNextWorkRequired() em pow.cpp</a> demonstra o código usado no cliente Bitcoin Core.</p>
</div>
<div id="retarget_code" class="exampleblock data-line-662">
<div class="title">Example 34. Reajustando o alvo da Prova-de-Trabalho&#x2014;CalculateNextWorkRequired() em pow.cpp</div>
<div class="content">
<div class="listingblock data-line-664">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">   // Limita o passo de ajuste
    int64_t nActualTimespan = pindexLast-&gt;GetBlockTime() - nFirstBlockTime;
    LogPrintf("  nActualTimespan = %d  before bounds\n", nActualTimespan);
    if (nActualTimespan &lt; params.nPowTargetTimespan/4)
        nActualTimespan = params.nPowTargetTimespan/4;
    if (nActualTimespan &gt; params.nPowTargetTimespan*4)
        nActualTimespan = params.nPowTargetTimespan*4;

    //Reajusta o alvo
    const arith_uint256 bnPowLimit = UintToArith256(params.powLimit);
    arith_uint256 bnNew;
    arith_uint256 bnOld;
    bnNew.SetCompact(pindexLast-&gt;nBits);
    bnOld = bnNew;
    bnNew *= nActualTimespan;
    bnNew /= params.nPowTargetTimespan;

    if (bnNew &gt; bnPowLimit)
        bnNew = bnPowLimit;</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note data-line-690">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-691">
<p>Enquanto a calibragem do alvo acontece a cada 2.016 blocos, a existência de um erro <em>off-by-one</em> (OBOE, "erro por um") no cliente Bitcoin Core original faz com que ela seja baseada no tempo total dos 2.015 blocos anteriores (e não 2.016, como deveria ser), o que resulta em uma dificuldade 0,05% maior no reajuste do alvo.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-695">
<p>Os parâmetros Interval (2.016 blocos) e TargetTimespan (duas semanas ou 1.209.600 segundos) são definidos no arquivo <em>chainparams.cpp</em>.</p>
</div>
<div class="paragraph data-line-697">
<p>Para evitar uma volatilidade extrema na dificuldade, o reajuste do alvo deve ser menor do que um fator de quatro (4) por ciclo. Se o ajuste de alvo necessário é maior do que um fator de quatro, ele será ajustado pelo fator de quatro, e não mais do que isso. Qualquer ajuste adicional será realizado no próximo período de reajuste do alvo, pois o desequilíbrio persistirá durante os próximos 2.016 blocos. Portanto, grandes discrepâncias entre o poder de <em>hashing</em> e a dificuldade podem levar vários ciclos de 2.016 blocos para se equilibrarem.</p>
</div>
<div class="admonitionblock tip data-line-700">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-701">
<p>A dificuldade de se minerar um bloco de bitcoin é de aproximadamente "10 minutos de processamento" para toda a rede, e baseia-se no tempo que foi necessário para serem encontrados os últimos 2.016 blocos, sendo ajustada a cada 2.016 blocos. E esse ajuste da dificuldade é feito através da redução ou da elevação do alvo.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-704">
<p>Perceba que o alvo é independente do número de transações ou do valor das transações. Isso significa que tanto o alvo do poder de <em>hashing</em> quanto a eletricidade gasta para manter a segurança da rede bitcoin também são totalmente independentes do número de transações. O bitcoin pode acomodar mais transações, atingir uma adoção maior e se manter seguro sem que seja necessário nenhum aumento no poder de <em>hashing</em> que já existe hoje. O aumento no poder de <em>hashing</em> representa as forças do mercado à medida que novos mineradores entram no mercado para competir pela recompensa. Enquanto houver um poder de <em>hashing</em> suficiente sob o controle de mineradores agindo honestamente em busca da recompensa, ele será suficiente para prevenir ataques de "tomada de controle" ("<em>takeover</em>") e, portanto, será suficiente para manter o bitcoin seguro.</p>
</div>
<div class="paragraph data-line-706">
<p>A dificuldade de mineração está intimamente relacionada com o custo da eletricidade e a taxa de câmbio do bitcoin na moeda usada para pagar pela eletricidade. Os sistemas de mineração de alto desempenho tem a maior eficiência possível da geração atual de fabricação de silício, convertendo a eletricidade em computação de hashes na taxa mais alta possível. A principal influência no mercado de mineração é o preço de um kilowatt-hora de eletricidade em bitcoin, porque ele determina a rentabilidade da mineração e, portanto, os incentivos para se entrar ou sair do mercado de mineração.</p>
</div>
<div class="paragraph data-line-708">
<p>=== Minerando um Bloco com Sucesso</p>
</div>
<div class="paragraph data-line-710">
<p>Conforme vimos anteriormente, o nó do Jing construiu um bloco candidato e preparou-o para ser minerado. O Jing possui vários equipamentos de mineração em hardware com circuitos integrados de aplicação específica (ASICs), nos quais centenas de milhares de circuitos integrados executam em paralelo o algoritmo SHA256 a velocidades incríveis. Muitas dessas máquinas especializadas são conectadas ao seu nó de mineração através de uma porta USB ou de uma rede local. A seguir, o nó de mineração sendo executado no desktop do Jing transmite o cabeçalho do bloco para seu hardware de mineração, que começa a testar trilhões de nonces por segundo. Como o nonce tem apenas 32 bits, depois de esgotar todos os nonces possíveis (cerca de 4 bilhões), o hardware de mineração altera o cabeçalho do bloco (ajustando o espaço extra do nonce ou o <em>timestamp</em> da coinbase) e reinicia o contador de nonces, testando novas combinações.</p>
</div>
<div class="paragraph data-line-712">
<p>Quase 11 minutos depois de começar a minerar o bloco 277.316, uma das máquinas de mineração encontra uma solução e a envia de volta ao nó de mineração.</p>
</div>
<div class="paragraph data-line-714">
<p>Quando inserido no cabeçalho do bloco, o nonce 924.591.752 produz o seguinte hash de bloco:</p>
</div>
<div class="listingblock data-line-716">
<div class="content">
<pre>0000000000000001b6b9a13b095e96db41c4a928b97ef2d944a9b31b2cc7bdc4</pre>
</div>
</div>
<div class="paragraph data-line-720">
<p>que é menor do que o alvo:</p>
</div>
<div class="listingblock data-line-722">
<div class="content">
<pre>0000000000000003A30C00000000000000000000000000000000000000000000</pre>
</div>
</div>
<div class="paragraph data-line-726">
<p>Imediatamente, o nó de mineração do Jing transmite o bloco para todos os seus pares (nós com os quais ele está conectado). Eles recebem, validam e então propagam o novo bloco. À medida que o bloco é disseminado na rede, cada nó o adiciona à sua própria cópia da blockchain, estendendo-a para uma nova altura de 277.316 blocos. Conforme os nós de mineração vão recebendo e validando o bloco, eles deixam de tentar encontrar um bloco com a mesma altura e imediatamente passam a computar o próximo bloco na cadeia, usando o bloco do Jing como bloco "pai". Ao trabalharem para acrescentar um bloco sobre o bloco recém-descoberto do Jing, os outros mineradores estão essencialmente "votando" com seu poder de mineração, endossando o bloco do Jing e a cadeia que ele estende.</p>
</div>
<div class="paragraph data-line-728">
<p>Na próxima seção, aprenderemos sobre o processo que cada nó usa para validar um bloco e selecionar a cadeia mais longa, criando o consenso que forma a cadeia de blocos (blockchain) descentralizada.</p>
</div>
<div class="paragraph data-line-730">
<p>=== Validando um Novo Bloco</p>
</div>
<div class="paragraph data-line-732">
<p>O terceiro passo no mecanismo de consenso do bitcoin é a validação independente de cada bloco novo, que é realizada por cada nó da rede. À medida que os blocos recém-criados são propagados pela rede, cada nó realiza uma série de testes para validá-los antes de propagá-los para seus pares. Isso garante que somente blocos válidos serão propagados na rede. A validação independente também garante que os mineradores que agirem honestamente terão seus blocos incorporados na blockchain, e, portanto, receberão sua recompensa. Os mineradores que agirem desonestamente terão seus blocos rejeitados e não apenas perderão sua recompensa, como também terão desperdiçado o esforço despendido para encontrar uma solução de Prova-de-Trabalho, ou seja, terão gasto com energia elétrica sem obter nenhuma compensação.</p>
</div>
<div class="paragraph data-line-734">
<p>Quando um nó recebe um bloco novo, ele validará o bloco ao verificá-lo contra uma longa lista de critérios que precisam ser preenchidos; caso contrário, o bloco será rejeitado. Esses critérios podem ser vistos nas funções CheckBlock e CheckBlockHeader do cliente Bitcoin Core, e incluem:</p>
</div>
<div class="ulist data-line-736">
<ul>
<li class="data-line-736">
<p>A estrutura de dados do bloco é sintaticamente válida</p>
</li>
<li class="data-line-737">
<p>O hash do cabeçalho do bloco é menor ou igual ao alvo (impõe a Prova-de-Trabalho)</p>
</li>
<li class="data-line-738">
<p>A data e hora no timestamp do bloco é menor do que duas horas no futuro (permitindo erros de horário)</p>
</li>
<li class="data-line-739">
<p>O tamanho do bloco está dentro dos limites aceitáveis</p>
</li>
<li class="data-line-740">
<p>A primeira transação (e somente a primeira) é uma transação coinbase</p>
</li>
<li class="data-line-741">
<p>Todas as transações contidas no bloco são válidas usando o <em>checklist</em> de transações discutido em <a href="#tx_verification">[tx_verification]</a></p>
</li>
</ul>
</div>
<div class="paragraph data-line-743">
<p>A validação independente de cada bloco novo feita por todos os nós da rede garante que os mineradores não possam trapacear. Nas seções anteriores, vimos como os mineradores conseguem criar uma transação que os recompensa com os novos bitcoins criados no bloco e como eles recebem as taxas de transação. Mas por que os mineradores não criam para eles próprios uma transação com mil bitcoins de recompensa, ao invés de usar a recompensa correta? Porque todos os nós validam os blocos de acordo com as mesmas regras. Uma transação coinbase inválida tornaria inválido todo o bloco, o que resultaria em um bloco sendo rejeitado e, portanto, a transação jamais seria incluída na blockchain. Os mineradores tem que construir um bloco perfeito, baseado nas regras compartilhadas que todos os nós seguem, e minerá-lo com uma solução correta para a Prova-de-Trabalho. Para fazer isso, eles gastam muita energia elétrica na mineração, e se eles trapacearem, todos os seus gastos com energia elétrica e todos os seus esforços serão desperdiçados. Esse é o motivo pelo qual a validação independente é um componente-chave do consenso descentralizado.</p>
</div>
<div class="paragraph data-line-745">
<p>=== Montando e Selecionando Cadeias de Blocos</p>
</div>
<div class="paragraph data-line-747">
<p>A etapa final no mecanismo de consenso descentralizado do bitcoin é a união dos blocos em cadeias e a seleção da cadeia que tem a maior Prova-de-Trabalho. Assim que um nó validar um novo bloco, ele tentará montar uma cadeia conectando o bloco à blockchain existente.</p>
</div>
<div class="paragraph data-line-749">
<p>Os nós mantêm três conjuntos de blocos: aqueles conectados à blockchain principal, aqueles que formam ramificações da blockchain principal (cadeias secundárias), e, por último, os blocos que não tem um bloco pai conhecido nas cadeias conhecidas (blocos órfãos). Os blocos inválidos são rejeitados assim que qualquer critério de validação falhar e, portanto, não são incluídos em nenhuma cadeia.</p>
</div>
<div class="paragraph data-line-751">
<p>A qualquer momento, a "cadeia principal" é a cadeia de blocos <em>válida</em> que tiver a maior quantidade acumulada de Prova-de-Trabalho associada a ela. Na maioria dos casos, ela também será a cadeia que tem o maior número de blocos, a menos que existam duas cadeias de comprimento semelhante e uma delas tiver mais Prova-de-Trabalho. A cadeia principal também terá ramos com blocos que são "irmãos" dos blocos que estão na cadeia principal. Esses blocos são válidos, mas não fazem parte da cadeia principal. Eles são mantidos para referência futura, caso uma dessas cadeias secundárias for estendida e passar a apresentar maior quantidade de trabalho do que a cadeia principal. Na próxima seção (<a href="#forks">[forks]</a>), veremos como as cadeias secundárias surgem como resultado de uma mineração quase simultânea de blocos em uma mesma altura.</p>
</div>
<div class="paragraph data-line-753">
<p>Quando um bloco novo é recebido, um nó tentará incluí-lo na blockchain existente. O nó verificará neste bloco o campo "hash do bloco anterior", que é a referência ao pai do bloco. Em seguida, o nó tentará encontrar esse pai na blockchain existente. Na maioria das vezes, o pai será o bloco no "topo" da cadeia principal, ou seja, esse bloco novo estenderá a cadeia principal. Por exemplo, o novo bloco 277.316 possui uma referência ao hash de seu bloco pai 277.315. A maioria dos nós que recebem o 277.316 já terão o bloco 277.315 como o topo de suas cadeias principais e, portanto, incluirão o bloco novo e estenderão essa cadeia.</p>
</div>
<div class="paragraph data-line-755">
<p>Às vezes, como veremos em <a href="#forks">[forks]</a>, o bloco novo estende uma cadeia que não é a cadeia principal. Nesse caso, o nó anexará o bloco novo à cadeia secundária que ele estende e, a seguir, comparará o trabalho da cadeia secundária com o trabalho da cadeia principal. Se a cadeia secundária possuir uma quantidade de trabalho acumulado maior do que a da cadeia principal, o nó irá <em>reconvergir</em> para a cadeia secundária, ou seja, ele selecionará a cadeia secundária como sendo a sua nova cadeia principal, fazendo com que a cadeia principal anterior se torne uma cadeia secundária. Se o nó for um minerador, ele passará a construir um bloco que estende essa cadeia nova, que é mais longa.</p>
</div>
<div class="paragraph data-line-757">
<p>Se um bloco válido é recebido e nenhum bloco pai é encontrado nas cadeias existentes, o bloco é considerado um "órfão". Os blocos órfãos são salvos na pool de blocos órfãos, onde eles ficam até que os seus blocos pais sejam recebidos. Assim que o bloco pai é recebido e vinculado às cadeias existentes, o bloco órfão pode então ser retirado da pool e ser vinculado a seu bloco pai, passando a fazer parte de uma cadeia. Os blocos órfãos geralmente surgem quando dois blocos que foram minerados em um curto espaço de tempo são recebidos em ordem inversa, ou seja, o bloco filho é recebido antes do bloco pai.</p>
</div>
<div class="paragraph data-line-759">
<p>Ao selecionar a cadeia com maior quantidade de trabalho acumulado, todos os nós acabam atingindo um consenso disseminado em toda a rede. As discrepâncias temporárias entre as cadeias acabam sendo resolvidas à medida que uma maior quantidade de trabalho é adicionada, estendendo uma das possíveis cadeias. Os nós mineradores "votam" com seu poder de mineração ao escolher qual cadeia eles estenderão ao minerarem o próximo bloco. Quando os mineradores mineram um bloco novo e estendem a cadeia, o bloco novo representa o voto deles.</p>
</div>
<div class="paragraph data-line-761">
<p>Na próxima seção, veremos como discrepâncias entre cadeias concorrentes (forks) são resolvidas através da seleção independente da cadeia com a maior quantidade de trabalho acumulado.</p>
</div>
<div id="forks" class="paragraph data-line-764">
<p>==== Forks da Blockchain</p>
</div>
<div class="paragraph data-line-766">
<p>Because the blockchain is a decentralized data structure, different copies of it are not always consistent. Blocks might arrive at different nodes at different times, causing the nodes to have different perspectives of the blockchain. To resolve this, each node always selects and attempts to extend the chain of blocks that represents the most Proof-of-Work, also known as the longest chain or greatest cumulative work chain. By summing the work recorded in each block in a chain, a node can calculate the total amount of work that has been expended to create that chain. As long as all nodes select the greatest-cumulative-work chain, the global Bitcoin network eventually converges to a consistent state. Forks occur as temporary inconsistencies between versions of the blockchain, which are resolved by eventual reconvergence as more blocks are added to one of the forks.</p>
</div>
<div class="admonitionblock tip data-line-769">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-770">
<p>As bifurcações de blockchain descritas nesta seção ocorrem naturalmente (acidentalmente) como resultado de atrasos de transmissão na rede global. Mais adiante neste capítulo, também examinaremos as bifurcações que são induzidas deliberadamente (hard forks e soft forks), que são usadas para modificar as regras de consenso.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-773">
<p>In the next few diagrams, we follow the progress of a "fork" event across the network. The diagram is a simplified representation of the Bitcoin network. For illustration purposes, different blocks are shown as different shapes (star, triangle, upside-down triangle, rhombus), spreading across the network. Each node in the network is represented as a circle.</p>
</div>
<div class="paragraph data-line-775">
<p>Cada nó tem sua própria perspectiva da blockchain global. À medida que cada nó recebe blocos de seus vizinhos, ele atualiza sua própria cópia da blockchain, selecionando a cadeia com a maior quantidade de trabalho acumulado. Para fins de ilustração, cada nó contém uma figura que representa o bloco que ele acredita ser a atual ponta da cadeia principal. Portanto, a figura de uma estrela em um nó significa que o bloco estrela é a ponta da cadeia principal para esse nó.</p>
</div>
<div class="paragraph data-line-777">
<p>No primeiro diagrama (<a href="#fork1">Antes da bifurcação&#x2014;todos os nós tem a mesma perspectiva</a>), a rede tem uma perspectiva unificada da blockchain, com o bloco estrela sendo a ponta da cadeia principal.</p>
</div>
<div id="fork1" class="imageblock smallereighty data-line-782">
<div class="content">
<img src="images/mbc2_1002.png" alt="Before the fork - all nodes have the same perspective">
</div>
<div class="title">Figure 64. Antes da bifurcação&#x2014;todos os nós tem a mesma perspectiva</div>
</div>
<div class="paragraph data-line-784">
<p>Uma "bifurcação" ocorre sempre quando há dois blocos válidos diferentes na mesma altura de bloco competindo para formar a blockchain mais longa. Em condições normais, isso ocorre sempre que dois mineradores resolvem o algoritmo de Prova-de-Trabalho em um intervalo de tempo muito curto. Quando ambos os mineradores descobrem uma solução para seus respectivos blocos candidatos, eles imediatamente transmitem os seus respectivos blocos "vencedores" para seus vizinhos imediatos, que, por suas vezes, começam a propagar o bloco pela rede. Cada nó que receber um bloco válido irá incorporá-lo à sua blockchain, estendendo a blockchain em um bloco. Se mais tarde o nó descobrir outro bloco válido estendendo o mesmo bloco pai (na mesma altura de bloco), ele conectará o segundo bloco em uma cadeia secundária, bifurcando a sua cadeia principal. Como resultado, alguns nós irão "enxergar" um bloco vencedor primeiro, enquanto outros nós irão "enxergar" o outro bloco vencedor primeiro, o que levará ao surgimento de duas versões concorrentes da mesma blockchain.</p>
</div>
<div class="paragraph data-line-786">
<p>Na <a href="#fork2">Visualização de um evento de bifurcação da blockchain: dois blocos são encontrados simultaneamente</a>, podemos ver dois mineradores (Nó X e Nó Y) que mineram dois blocos diferentes quase que simultaneamente. Esses dois blocos são filhos do bloco estrela, e estendem a cadeia ao serem acrescentados no topo do bloco estrela. Para facilitar o nosso acompanhamento, um deles é representado como um bloco triângulo originando-se do Nó X, e o outro é representado como um bloco triângulo invertido originando-se do Nó Y.</p>
</div>
<div id="fork2" class="imageblock smallersixty data-line-791">
<div class="content">
<img src="images/mbc2_1003.png" alt="Visualization of a blockchain fork event: two blocks found simultaneously">
</div>
<div class="title">Figure 65. Visualização de um evento de bifurcação da blockchain: dois blocos são encontrados simultaneamente</div>
</div>
<div class="paragraph data-line-793">
<p>Vamos assumir, por exemplo, que o minerador Nó X encontra uma solução de Prova-de-Trabalho para um bloco "triângulo" que estende a blockchain, sendo acrescentado no topo do bloco pai "estrela". Quase simultaneamente, o minerador Nó Y, que também está estendendo a cadeia do bloco "estrela", encontra uma solução para o bloco "triângulo invertido", o seu bloco candidato. Agora, existem dois blocos possíveis; um iremos chamá-lo de bloco "triângulo", que se origina no Nó X; e o outro iremos chamá-lo de bloco "triângulo invertido", que se origina no Nó Y. Ambos os blocos foram minerados com sucesso, ambos são válidos (contêm uma solução válida para a Prova-de-Trabalho) e ambos estendem o mesmo bloco pai (o bloco "estrela"). Ambos os blocos provavelmente contêm quase as mesmas transações, com apenas algumas diferenças na ordem delas.</p>
</div>
<div class="paragraph data-line-795">
<p>À medida que os dois blocos são propagados, alguns nós recebem o bloco "triângulo" primeiro, enquanto outros recebem o bloco "triângulo invertido" primeiro. Como demonstrado na <a href="#fork3">Visualização de um evento de bifurcação da blockchain: dois blocos são propagados, dividindo a rede</a>, a rede se divide em duas perspectivas diferentes da blockchain, um lado cujo topo é o bloco triângulo, e um outro lado cujo topo é o bloco triângulo invertido.</p>
</div>
<div id="fork3" class="imageblock smallersixty data-line-800">
<div class="content">
<img src="images/mbc2_1004.png" alt="Visualization of a blockchain fork event: two blocks propagate, splitting the network">
</div>
<div class="title">Figure 66. Visualização de um evento de bifurcação da blockchain: dois blocos são propagados, dividindo a rede</div>
</div>
<div class="paragraph data-line-802">
<p>Na <a href="#fork3">Visualização de um evento de bifurcação da blockchain: dois blocos são propagados, dividindo a rede</a>, o minerador "Nó X" minerou (criou) o bloco triângulo e estendeu a cadeia estrela com ele. Logo, o Nó X inicialmente considera a cadeia com o bloco "triângulo" como sendo a cadeia principal. Mais tarde, o Nó X também recebeu o bloco "triângulo invertido" que foi minerado pelo Nó Y. Como ele foi recebido depois do bloco "triângulo", presume-se que ele "perdeu" a corrida. No entanto, o bloco "triângulo invertido" não é descartado. Ele está vinculado ao bloco pai "estrela" e forma uma cadeia secundária. Enquanto o Nó X assume a sua cadeia como sendo a cadeia vencedora, ele mantém a cadeia "perdedora" para que tenha as informações necessárias para reconvergir caso a cadeia "perdedora" venha a se tornar a cadeia "vencedora" no futuro.</p>
</div>
<div class="paragraph data-line-804">
<p>No outro lado da rede, o minerador Nó Y constrói uma blockchain com base em sua própria perspectiva da sequência de eventos. O minerador Nó Y minerou (criou) o "triângulo invertido" e inicialmente considera essa cadeia como sendo a cadeia principal (a cadeia "vencedora"). Mais tarde, quando ele recebeu o bloco "triângulo" que foi minerado pelo Nó X, ele o conectou ao bloco pai "estrela", formando uma cadeia secundária.</p>
</div>
<div class="paragraph data-line-806">
<p>Nenhum dos lados da rede está "certo" ou "errado". Ambos os lados são perspectivas válidas da blockchain. No futuro apenas um dos lados prevalecerá, e isso dependerá de como essas duas cadeias concorrentes serão estendidas por trabalho adicional.</p>
</div>
<div class="paragraph data-line-808">
<p>Cada nó de mineração com perspectiva semelhante à do Nó X imediatamente começará a minerar um bloco candidato que estende a cadeia com o bloco "triângulo" na ponta. Ao vincular o bloco "triângulo" como sendo o bloco pai de seus blocos candidatos, os mineradores estão votando usando o seu poder de <em>hashing</em>. O voto dos mineradores apóia a cadeia que eles elegeram como sendo a cadeia principal.</p>
</div>
<div class="paragraph data-line-810">
<p>Qualquer nó de mineração cuja perspectiva se assemelhe com a do nó Y começará a construir um bloco candidato com o bloco "triângulo invertido" como pai, estendendo a cadeia que eles acreditam ser a cadeia principal. E assim, a corrida começa novamente.</p>
</div>
<div class="paragraph data-line-812">
<p>As bifurcações quase sempre são resolvidas no intervalo de um bloco (10 minutos em média). Enquanto parte do poder de <em>hashing</em> da rede está tentando acrescentar um bloco no topo do bloco pai "triângulo", outra parte do poder de <em>hashing</em> está tentando acrescentar um bloco no topo do bloco pai "triângulo invertido". Mesmo que o poder de mineração esteja dividido quase igualmente, provavelmente um grupo de mineradores encontrará uma solução e propagá-la antes que outro grupo de mineradores tenha encontrado qualquer solução. Digamos que, por exemplo, os mineradores tentando acrescentar um bloco no topo do bloco pai "triângulo" encontram um novo bloco "losango" que estende a cadeia (por exemplo, estrela-triângulo-losango). Eles imediatamente propagam esse bloco novo e toda a rede o enxerga como uma solução válida, como demonstrado em <a href="#fork4">Visualização de um evento de bifurcação da blockchain: um novo bloco estende uma das cadeias, reconvergindo a rede. O Nó X e o Nó Y agora consideram o bloco "triângulo invertido" como sendo um bloco obsoleto.</a>.</p>
</div>
<div class="paragraph data-line-814">
<p>Todos os nós que haviam escolhido o "triângulo" como vencedor na rodada anterior simplesmente estenderão a cadeia em mais um bloco. Os nós que escolheram o "triângulo invertido" como vencedor, no entanto, enxergarão agora duas cadeias: estrela-triângulo-losango e estrela-triângulo invertido. A cadeia estrela-triângulo-losango agora é maior (possui mais trabalho acumulado) do que a outra cadeia. Como resultado, aqueles nós definirão a cadeia estrela-triângulo-losango como sendo a cadeia principal e passarão a considerar a cadeia estrela-triângulo invertido como sendo a cadeia secundária, como demonstrado na <a href="#fork5">Visualização de um evento de bifurcação da blockchain: a rede reconverge em uma nova cadeia mais longa</a>. Esse processo chama-se reconvergência da cadeia, pois aqueles nós são forçados a revisar sua visão da blockchain para incorporar a nova evidência de uma cadeia mais longa. Qualquer minerador que estiver trabalhando em estender a cadeia estrela-triângulo invertido terá que parar o trabalho, pois o seu bloco candidato agora é considerado filho de um <em>bloco obsoleto</em> (em inglês, <em>stale block</em>), já que o seu bloco pai "triângulo invertido" não está mais na cadeia mais longa. Como o bloco triângulo invertido agora está obsoleto, o minerador Nó Y (que minerou esse bloco) não será capaz de gastar a recompensa de mineração desse bloco, apesar de esse bloco ser válido e ter sido minerado com sucesso. As transações contidas no "triângulo invertido" que não estão no "triângulo" são re-inseridas na mempool para serem incluídas no próximo bloco, tornando-se parte da cadeia principal. Toda a rede reconverge para uma única blockchain estrela-triângulo-losango, com o "losango" sendo o último bloco na cadeia. Todos os mineradores imediatamente começam a trabalhar nos blocos candidatos que referenciam o "losango" como seu pai, estendendo a cadeia estrela-triângulo-losango.</p>
</div>
<div id="fork4" class="imageblock smallereighty data-line-819">
<div class="content">
<img src="images/mbc2_1005.png" alt="Visualization of a blockchain fork event: a new block extends one fork">
</div>
<div class="title">Figure 67. Visualização de um evento de bifurcação da blockchain: um novo bloco estende uma das cadeias, reconvergindo a rede. O Nó X e o Nó Y agora consideram o bloco "triângulo invertido" como sendo um bloco obsoleto.</div>
</div>
<div id="fork5" class="imageblock smallereighty data-line-824">
<div class="content">
<img src="images/mbc2_1006.png" alt="Visualization of a blockchain fork event: the network reconverges on a new longest chain">
</div>
<div class="title">Figure 68. Visualização de um evento de bifurcação da blockchain: a rede reconverge em uma nova cadeia mais longa</div>
</div>
<div class="paragraph data-line-826">
<p>Teoricamente é possível que uma bifurcação se estenda em dois blocos, caso dois blocos forem encontrados quase que simultaneamente por mineradores em "lados" opostos de uma bifurcação anterior. Entretanto, a chance disso acontecer é muito baixa. Enquanto uma bifurcação com um bloco de extensão pode ocorrer quase que diariamente, uma bifurcação com dois blocos de extensão ocorre no máximo uma vez no intervalo de algumas semanas.</p>
</div>
<div class="paragraph data-line-828">
<p>O intervalo de bloco de 10 minutos do bitcoin foi planejado para ser um ajuste equilibrado entre tempos de confirmação rápidos (liquidação das transações) e a probabilidade de uma bifurcação. Um intervalo de tempo menor entre os blocos faria com que as transações fossem liquidadas mais rapidamente, mas causaria bifurcações mais frequentes da blockchain, enquanto um intervalo de tempo maior entre os blocos diminuiria o número de bifurcações, mas faria com que as transações fossem liquidadas mais lentamente.</p>
</div>
<div class="paragraph data-line-830">
<p>=== Mineração e a Corrida do <em>Hashing</em></p>
</div>
<div class="paragraph data-line-832">
<p>Bitcoin mining is an extremely competitive industry. The hashing power has increased exponentially every year of bitcoin&#8217;s existence. Some years the growth has reflected a complete change of technology, such as in 2010 and 2011 when many miners switched from using CPU mining to GPU mining and field programmable gate array (FPGA) mining. In 2013 the introduction of ASIC mining lead to another giant leap in mining power, by placing the SHA256 function directly on silicon chips specialized for the purpose of mining. The first such chips could deliver more mining power in a single box than the entire Bitcoin network in 2010.</p>
</div>
<div class="paragraph data-line-834">
<p>The following list shows the total hashing power of the Bitcoin network in terahashes/sec (TH/sec), since its inception in 2009 (source: Blockchain.com):</p>
</div>
<div class="dlist data-line-836">
<dl>
<dt class="hdlist1">2009</dt>
<dd>
<p>0,000004 – 0,00001 TH/s (crescimento de 2,40&#x00D7;)</p>
</dd>
<dt class="hdlist1">2010</dt>
<dd>
<p>0,00001 – 0,14 TH/s (crescimento de 14.247&#x00D7;)</p>
</dd>
<dt class="hdlist1">2011</dt>
<dd>
<p>0,14 – 9,49 TH/s (crescimento de 63,92&#x00D7;)</p>
</dd>
<dt class="hdlist1">2012</dt>
<dd>
<p>9,49 – 22 TH/s (crescimento de 2,32&#x00D7;)</p>
</dd>
<dt class="hdlist1">2013</dt>
<dd>
<p>22 – 15.942 TH/s (crescimento de 723,32&#x00D7;)</p>
</dd>
<dt class="hdlist1">2014</dt>
<dd>
<p>15.942 – 306.333 TH/s (crescimento de 19,21&#x00D7;)</p>
</dd>
<dt class="hdlist1">2015</dt>
<dd>
<p>306.333 – 881.232 TH/s (crescimento de 2,87&#x00D7;)</p>
</dd>
<dt class="hdlist1">2016</dt>
<dd>
<p>881.232 – 2.807.540 TH/s (crescimento de 3,18&#x00D7;)</p>
</dd>
<dt class="hdlist1">2017</dt>
<dd>
<p>2.807.540 – 18.206.558 TH/s (crescimento de 6,48&#x00D7;)</p>
</dd>
<dt class="hdlist1">2018</dt>
<dd>
<p>18.206.558 – 41.801.528 TH/s (crescimento de 2,29&#x00D7;)</p>
</dd>
<dt class="hdlist1">2019</dt>
<dd>
<p>41.801.528 – 109.757.127 TH/s (crescimento de 2,62&#x00D7;)</p>
</dd>
<dt class="hdlist1">2020</dt>
<dd>
<p>109.757.127 – 149.064.869 TH/s (crescimento de 1,35&#x00D7;)</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-849">
<p>In the chart in <a href="#network_hashing_power">Poder de hashing total, em terahashes por segundo (TH/s) (gráfico em escala linear)</a>, we can see that Bitcoin network&#8217;s hashing power increased over the past two years. As you can see, the competition between miners and the growth of bitcoin has resulted in an exponential increase in the hashing power (total hashes per second across the network).</p>
</div>
<div id="network_hashing_power" class="imageblock data-line-853">
<div class="content">
<img src="images/mbc2_1007.png" alt="NetworkHashingRate">
</div>
<div class="title">Figure 69. Poder de hashing total, em terahashes por segundo (TH/s) (gráfico em escala linear)</div>
</div>
<div class="paragraph data-line-855">
<p>Como a quantidade de poder de <em>hashing</em> aplicada à mineração de bitcoin explodiu, a dificuldade aumentou para igualá-la. A dificuldade mostrada no gráfico da <a href="#bitcoin_difficulty">Dificuldade de mineração do bitcoin (gráfico em escala logarítmica)</a> é medida como uma razão entre a dificuldade atual e a dificuldade mínima (a dificuldade do primeiro bloco).</p>
</div>
<div id="bitcoin_difficulty" class="imageblock data-line-859">
<div class="content">
<img src="images/mbc2_1008.png" alt="BitcoinDifficulty">
</div>
<div class="title">Figure 70. Dificuldade de mineração do bitcoin (gráfico em escala logarítmica)</div>
</div>
<div class="paragraph data-line-861">
<p>Nos últimos dois anos, os chips de mineração ASIC tornaram-se cada vez mais densos, aproximando-se da tecnologia de ponta na fabricação em silício, com um tamanho de recurso (resolução) de 7 nanômetros (nm). Atualmente, os fabricantes de ASICs estão tentando superar os fabricantes de chips de CPU, projetando chips com 5 nm, pois a rentabilidade da mineração está fazendo com que essa indústria evolua até mais rapidamente do que a indústria de processadores de propósito geral. Não existem mais passos gigantes para se dar na mineração no bitcoin, pois a indústria atingiu o limite da Lei de Moore, que estipula que a densidade computacional dobrará aproximadamente a cada 18 meses. Entretanto, o poder de mineração da rede continua a avançar em um ritmo exponencial, à medida que a corrida por chips de maior densidade é combinada com uma corrida por <em>data centers</em> de maior densidade, onde milhares desses chips podem ser empregados. Agora não é mais uma questão de quanta mineração pode ser feita em um chip, mas quantos chips podem ser espremidos em um prédio, enquanto ainda se dissipa o calor e se fornece energia adequada.</p>
</div>
<div id="extra_nonce" class="paragraph data-line-864">
<p>==== A Solução do Nonce Extra</p>
</div>
<div class="paragraph data-line-866">
<p>Desde 2012, a mineração do bitcoin evoluiu para resolver uma limitação fundamental na estrutura do cabeçalho do bloco. No início do bitcoin, um minerador podia encontrar um bloco ao ficar testando os valores de nonce até que o hash resultante fosse menor ou igual ao alvo. À medida que a dificuldade cresceu, os mineradores frequentemente ciclavam por todos os 4 bilhões de valores do nonce sem encontrar nenhum bloco. Entretanto, isso foi facilmente resolvido ao se atualizar o <em>timestamp</em> (carimbo de data e hora) do bloco para contabilizar pelo tempo decorrido. Como o <em>timestamp</em> faz parte do cabeçalho do bloco, essa mudança permitiu que os mineradores fizessem suas buscas pelo valor do nonce novamente com resultados diferentes. No entanto, quando o hardware de mineração excedeu 4 GH/s, essa abordagem tornou-se cada vez mais difícil, pois os valores do nonce esgotavam-se em menos de um segundo. À medida que os equipamentos de mineração ASIC começaram a aumentar e exceder a taxa de terahashes por segundo (TH/s), o software de mineração precisou de mais espaço para os valores de nonce. O <em>timestamp</em> podia ser estendido mais um pouco, mas ficar empurrando-o para o futuro uma hora faria com que o bloco se tornasse inválido. O cabeçalho do bloco precisava de um novo lugar nele para ser usado como fonte para os valores de nonce. A solução foi usar a transação coinbase como uma fonte para valores extra de nonce. Como o script da coinbase pode armazenar entre 2 e 100 bytes de dados, os mineradores começaram a usar esse espaço como espaço extra para o nonce, o que permitiu que eles explorassem uma faixa muito maior de valores de cabeçalhos de blocos para encontrar blocos válidos. A transação coinbase é incluída na árvore de merkle, ou seja, qualquer mudança no script coinbase faz com que a raiz de merkle mude. Os 8 bytes extras do nonce, mais os 4 bytes do nonce "padrão" permitem aos mineradores explorarem um total de 2<sup>96</sup> (o número 8 seguido de 28 zeros) possibilidades <em>por segundo</em> sem ter que modificar o <em>timestamp</em>. Se, no futuro, os mineradores conseguirem ciclar através de todas essas possibilidades, eles poderão então modificar o <em>timestamp</em>. Também há mais espaço no script da coinbase para futuras expansões do espaço extra de nonce.</p>
</div>
<div id="mining_pools" class="paragraph data-line-869">
<p>==== Pools de Mineração</p>
</div>
<div class="paragraph data-line-871">
<p>Nesse ambiente altamente competitivo, os mineradores individuais que trabalham sozinhos (também conhecidos como mineradores solo) não tem chances de vencer. A probabilidade de um deles encontrar um bloco e compensar os custos com eletricidade e hardware é tão baixa, que acaba virando uma aposta, como jogar em uma loteria. Nem mesmo o sistema de mineração ASIC mais rápido é capaz de competir com os sistemas comerciais que empilham dezenas de milhares desses chips em enormes galpões próximos de estações de energia hidrelétrica. Em função disso, os mineradores agora reúnem-se para formar associações conhecidas como pools de mineração, agrupando o seu poder de <em>hashing</em> e compartilhando as recompensas entre os milhares de participantes da pool. Ao participar de uma pool, os mineradores recebem uma pequena cota da recompensa total, mas tipicamente são recompensados diariamente, reduzindo as incertezas.</p>
</div>
<div class="paragraph data-line-873">
<p>Vejamos um exemplo específico. Suponha que um minerador comprou um hardware de mineração com uma taxa de hashing combinada de 14.000 gigahashes por segundo (GH/s), ou 14 TH/s. Em 2017, esse equipamento custava cerca de US$2.500. O hardware em funcionamento consome 1.375 watts (1,3 kW) de eletricidade, 33 kW-hora por dia, a um custo de US$1 a US$2 por dia em uma cidade com tarifa de energia elétrica muito baixa. Na dificuldade atual do bitcoin, o minerador será capaz de minerar sozinho um bloco aproximadamente uma vez a cada quatro anos. Como calculamos essa probabilidade? Ela é baseada em uma taxa de hashing global da rede de 3 EH/s (em 2017) e na taxa de hashing do minerador de 14 TH/s:</p>
</div>
<ul class="simplelist">
  <li>P = (14 * 10<sup>12</sup> / 3 * 10<sup>18</sup>) * 210.240 = 0,98</li>
</ul>
<div class="paragraph data-line-881">
<p>&#8230;&#8203;onde 210.240 é o número de blocos em quatro anos. O minerador tem 98% de probabilidade de encontrar um bloco em quatro anos, com base na taxa de hash global no início do período.</p>
</div>
<div class="paragraph data-line-883">
<p>Se o minerador encontrar um único bloco nesse período de tempo, o pagamento de 6,25 bitcoins, a aproximadamente 1.000 dólares por bitcoin, resultará em um único pagamento de 6.250 dólares, que produzirá um lucro líquido de cerca de 750 dólares. No entanto, a chance de encontrar um bloco em um período de 4 anos depende da sorte do minerador. Ele pode encontrar dois blocos em 4 anos e ter um lucro maior. Ou ele pode não encontrar nenhum bloco durante 5 anos e, com isso, sofrer um grande prejuízo financeiro. Pior ainda, a dificuldade do algoritmo de Prova-de-Trabalho do bitcoin provavelmente aumentará significativamente ao longo desse período. Se a atual taxa de crescimento do poder de <em>hashing</em> permanecer estável, isso significa que o minerador tem, no máximo, um ano para recuperar o seu investimento inicial antes de o seu equipamento de mineração ficar obsoleto e precisar ser substituído por outro equipamento mais poderoso. Em função disso, do ponto de vista financeiro, só faz sentido minerar bitcoin em lugares com um custo de eletricidade muito baixo (menos de 1 centavo de dólar por kW-hora) e apenas em uma escala muito grande.</p>
</div>
<div class="paragraph data-line-885">
<p>Mining pools coordinate many hundreds or thousands of miners, over specialized pool-mining protocols. The individual miners configure their mining equipment to connect to a pool server, and specify a Bitcoin address, which will receive their share of the rewards. Their mining hardware remains connected to the pool server while mining, synchronizing their efforts with the other miners. Thus, the pool miners share the effort to mine a block and then share in the rewards.</p>
</div>
<div class="paragraph data-line-887">
<p>Successful blocks pay the reward to a pool Bitcoin address, rather than individual miners. The pool server will periodically make payments to the miners' Bitcoin addresses, once their share of the rewards has reached a certain threshold. Typically, the pool server charges a percentage fee of the rewards for providing the pool-mining service.</p>
</div>
<div class="paragraph data-line-889">
<p>Miners participating in a pool split the work of searching for a solution to a candidate block, earning "shares" for their mining contribution. The mining pool sets a higher target (lower difficulty) for earning a share, typically more than 1,000 times easier than the Bitcoin network&#8217;s target. When someone in the pool successfully mines a block, the reward is earned by the pool and then shared with all miners in proportion to the number of shares they contributed to the effort.</p>
</div>
<div class="paragraph data-line-891">
<p>Pools are open to any miner, big or small, professional or amateur. A pool will therefore have some participants with a single small mining machine, and others with a garage full of high-end mining hardware. Some will be mining with a few tens of a kilowatt of electricity, others will be running a data center consuming a megawatt of power. How does a mining pool measure the individual contributions, so as to fairly distribute the rewards, without the possibility of cheating? The answer is to use bitcoin&#8217;s Proof-of-Work algorithm to measure each pool miner&#8217;s contribution, but set at a lower difficulty so that even the smallest pool miners win a share frequently enough to make it worthwhile to contribute to the pool. By setting a lower difficulty for earning shares, the pool measures the amount of work done by each miner. Each time a pool miner finds a block header hash that is equal to or less than the pool target, she proves she has done the hashing work to find that result. More importantly, the work to find shares contributes, in a statistically measurable way, to the overall effort to find a hash equal to or lower than the Bitcoin network&#8217;s target. Thousands of miners trying to find low-value hashes will eventually find one low enough to satisfy the Bitcoin network target.</p>
</div>
<div class="paragraph data-line-893">
<p>Vamos voltar à analogia do jogo de dados. Se os jogadores estiverem lançando os dados com o objetivo de obter um resultado menor ou igual a quatro (a dificuldade geral da rede), uma pool definiria um alvo mais fácil, contando quantas vezes os jogadores da pool conseguiram obter um resultado menor ou igual a oito. Quando os jogadores da pool obtiverem um resultado menor ou igual a oito (o alvo da cota da pool), mas maior do que quatro (maior que a dificuldade geral da rede), eles ganham cotas, mas nem eles nem a pool ganham o jogo, pois eles não atingiram o alvo do jogo (menor ou igual a quatro). Os jogadores da pool atingirão o alvo mais fácil da pool muito mais frequentemente, ganhando cotas com bastante regularidade, mesmo que eles não atinjam o alvo mais difícil que é necessário para se ganhar o jogo. De vez em quando, um dos jogadores da pool lançará dois dados combinados e obterá um resultado menor ou igual a quatro, com isso, o jogador da pool ganha uma cota e toda a pool ganha o jogo. Então, os ganhos podem ser distribuídos para os jogadores da pool com base na quantidade de cotas que cada um ganhou. Apesar de o alvo da pool (menor ou igual a oito) não ser uma vitória, ele é uma maneira justa de se medir os lançamentos de dados dos jogadores, e isso ocasionalmente produz um lançamento com um resultado menor ou igual a quatro.</p>
</div>
<div class="paragraph data-line-895">
<p>Similarly, a mining pool will set a (higher and easier) pool target that will ensure that an individual pool miner can find block header hashes that are equal to or less than the pool target often, earning shares. Every now and then, one of these attempts will produce a block header hash that is equal to or less than the Bitcoin network target, making it a valid block and the whole pool wins.</p>
</div>
<div class="paragraph data-line-897">
<p>===== Pools gerenciadas</p>
</div>
<div class="paragraph data-line-899">
<p>A maioria das pools de mineração são "gerenciadas", ou seja, existe uma empresa ou um indivíduo executando um servidor de pool. O proprietário do servidor de pool é chamado de <em>operador da pool</em>, e ele cobra dos mineradores da pool uma taxa percentual dos ganhos.</p>
</div>
<div class="paragraph data-line-901">
<p>The pool server runs specialized software and a pool-mining protocol that coordinate the activities of the pool miners. The pool server is also connected to one or more full Bitcoin nodes and has direct access to a full copy of the blockchain database. This allows the pool server to validate blocks and transactions on behalf of the pool miners, relieving them of the burden of running a full node. For pool miners, this is an important consideration, because a full node requires a dedicated computer with at least 300 to 350 GB of persistent storage (disk) and at least 2 to 4 GB of memory (RAM). Furthermore, the bitcoin software running on the full node needs to be monitored, maintained, and upgraded frequently. Any downtime caused by a lack of maintenance or lack of resources will hurt the miner&#8217;s profitability. For many miners, the ability to mine without running a full node is another big benefit of joining a managed pool.</p>
</div>
<div class="paragraph data-line-903">
<p>Pool miners connect to the pool server using a mining protocol such as Stratum (STM) or GetBlockTemplate (GBT). An older standard called GetWork (GWK) has been mostly obsolete since late 2012, because it does not easily support mining at hash rates above 4 GH/s. Both the STM and GBT protocols create block <em>templates</em> that contain a template of a candidate block header. The pool server constructs a candidate block by aggregating transactions, adding a coinbase transaction (with extra nonce space), calculating the merkle root, and linking to the previous block hash. The header of the candidate block is then sent to each of the pool miners as a template. Each pool miner then mines using the block template, at a higher (easier) target than the Bitcoin network target, and sends any successful results back to the pool server to earn shares.</p>
</div>
<div class="paragraph data-line-905">
<p>===== Pool de mineração par-a-par (P2Pool)</p>
</div>
<div class="paragraph data-line-907">
<p>As pools gerenciadas criam uma oportunidade para que o operador da pool possa trapacear, seja direcionando os esforços da pool para transações de gasto duplo, seja minerando blocos inválidos (ver <a href="#consensus_attacks">[consensus_attacks]</a>). Além disso, os servidores de pool centralizados representam um ponto único de falha. Se o servidor da pool cair ou tornar-se lento devido a ataques de negação de serviço, os mineradores da pool não serão capazes de minerar. Em 2011, para resolver esses problemas causados pela centralização, um novo método de mineração em pool foi proposto e implementado: o P2Pool, que é uma pool de mineração par-a-par, sem um operador central.</p>
</div>
<div class="paragraph data-line-909">
<p>P2Pool works by decentralizing the functions of the pool server, implementing a parallel blockchain-like system called a <em>share chain</em>. A share chain is a blockchain running at a lower difficulty than the Bitcoin blockchain. The share chain allows pool miners to collaborate in a decentralized pool by mining shares on the share chain at a rate of one share block every 30 seconds. Each of the blocks on the share chain records a proportionate share reward for the pool miners who contribute work, carrying the shares forward from the previous share block. When one of the share blocks also achieves the Bitcoin network target, it is propagated and included on the Bitcoin blockchain, rewarding all the pool miners who contributed to all the shares that preceded the winning share block. Essentially, instead of a pool server keeping track of pool miner shares and rewards, the share chain allows all pool miners to keep track of all shares using a decentralized consensus mechanism like bitcoin&#8217;s blockchain consensus mechanism.</p>
</div>
<div class="paragraph data-line-911">
<p>P2Pool mining is more complex than pool mining because it requires that the pool miners run a dedicated computer with enough disk space, memory, and internet bandwidth to support a full Bitcoin node and the P2Pool node software. P2Pool miners connect their mining hardware to their local P2Pool node, which simulates the functions of a pool server by sending block templates to the mining hardware. On P2Pool, individual pool miners construct their own candidate blocks, aggregating transactions much like solo miners, but then mine collaboratively on the share chain. P2Pool is a hybrid approach that has the advantage of much more granular payouts than solo mining, but without giving too much control to a pool operator like managed pools.</p>
</div>
<div class="paragraph data-line-914">
<p>Apesar de o P2Pool reduzir a concentração de poder dos operadores das pools de mineração, ele teoricamente é vulnerável a ataques de 51% contra a própria cadeia de cotas. Uma adoção muito maior do P2Pool não elimina o risco de o bitcoin sofrer um ataque de 51%. No entanto, o P2Pool torna o bitcoin mais robusto de uma maneira geral, como parte de um ecossistema de mineração diversificado.</p>
</div>
<div id="consensus_attacks" class="paragraph data-line-917">
<p>=== Ataques de Consenso</p>
</div>
<div class="paragraph data-line-919">
<p>Bitcoin&#8217;s consensus mechanism is, at least theoretically, vulnerable to attack by miners (or pools) that attempt to use their hashing power to dishonest or destructive ends. As we saw, the consensus mechanism depends on having a majority of the miners acting honestly out of self-interest. However, if a miner or group of miners can achieve a significant share of the mining power, they can attack the consensus mechanism so as to disrupt the security and availability of the Bitcoin network.</p>
</div>
<div class="paragraph data-line-921">
<p>É importante observar que os ataques de consenso só podem afetar consensos no futuro, ou, no máximo, no passado mais recente (dezenas de blocos). O livro-razão do bitcoin torna-se cada vez mais imutável à medida que o tempo passa. Embora, em teoria, uma bifurcação possa ocorrer em qualquer profundidade, na prática, o poder computacional necessário para se forçar uma bifurcação muito profunda é imenso, o que faz com que os blocos antigos sejam considerados praticamente imutáveis. Os ataques de consenso também não afetam a segurança das chaves privadas e do algoritmo de assinatura (ECDSA). Um ataque de consenso não é capaz de roubar bitcoins, gastar bitcoins sem assinaturas ou redirecionar bitcoins, nem de modificar transações antigas ou registros de posse. Os ataques de consenso só são capazes de afetar os blocos mais recentes e de causar negações de serviço na criação de blocos futuros.</p>
</div>
<div class="paragraph data-line-923">
<p>Um cenário de ataque contra o mecanismo de consenso é o chamado "ataque de 51%". Nesse cenário, um grupo de mineradores, controlando uma maioria (51%) do poder de <em>hashing</em> total da rede, conspira para atacar o bitcoin. Com a capacidade de minerar a maioria dos blocos, os mineradores atacantes podem gerar bifurcações (forks) deliberadas na blockchain, gerar transações de gasto duplo ou executar ataques de negação de serviço (DoS) contra endereços ou transações específicas. Um ataque de bifurcação/gasto duplo é um ataque onde o atacante faz com que blocos já confirmados sejam invalidados ao fazer uma bifurcação em um nível abaixo deles, com uma posterior reconvergência em uma cadeia alternativa. Com poder suficiente, um atacante pode invalidar seis ou mais blocos em sequência, invalidando transações que antes eram consideradas imutáveis (com seis confirmações). Note que o gasto duplo só pode ser feito nas transações do próprio atacante, para as quais o atacante pode produzir uma assinatura válida. Fazer um gasto duplo da própria transação só é rentável se, ao invalidar uma transação, o atacante puder receber um pagamento em outra moeda de forma irreversível ou receber um produto sem ter que pagar por ele.</p>
</div>
<div class="paragraph data-line-925">
<p>Vamos examinar um exemplo prático de um ataque de 51%. No primeiro capítulo, analisamos uma transação entre a Alice e o Bob por uma xícara de café. O Bob, o dono da cafeteria, está disposto a aceitar pagamentos pelas suas xícaras de café sem esperar por uma confirmação (a inclusão da transação em um bloco minerado), pois o risco de um gasto duplo com uma xícara de café é baixo se comparado com a conveniência de se oferecer um serviço rápido ao consumidor. Isso é semelhante à prática das cafeterias que aceitam pagamentos de cartão de crédito sem uma assinatura do cliente em valores menores que 25 dólares, pois o risco de um reembolso de um pagamento com cartão de crédito é baixo, enquanto o custo em ter que esperar o cliente assinar é comparativamente maior. Em contraste, vender um item mais caro por bitcoins aumenta o risco de um ataque de gasto duplo, no qual o comprador transmite uma outra transação concorrente que gasta as mesmas entradas (as mesmas UTXOs) e cancela o pagamento do comerciante. Um ataque de gasto duplo pode ocorrer de duas formas: ou antes de uma transação ser confirmada, ou se o atacante gerar uma bifurcação da blockchain com o objetivo de desfazer vários blocos já minerados anteriormente. Um ataque de 51% permite que os atacantes façam gastos duplos de suas próprias transações em uma nova cadeia, e, com isso, desfazendo a transação correspondente na cadeia antiga.</p>
</div>
<div class="paragraph data-line-927">
<p>Em nosso exemplo, o Mallory, um atacante mal-intencionado, vai até a galeria da Carol e compra um belo tríptico com três pinturas retratando o Satoshi Nakatomo como Prometeus. Ela vende as pinturas "O Grande Fogo" para o Mallory por 250.000 dólares em bitcoin. Ao invés de esperar que a transação receba seis ou mais confirmações, ela embala e entrega as pinturas para o Mallory após uma única confirmação ter ocorrido. O Mallory tem um cúmplice, Paul, que opera uma grande pool de mineração. O seu cúmplice faz um ataque de 51% assim que a transação do Mallory é incluída em um bloco. Ele direciona a pool de mineração para reminerar a mesma altura de bloco em que está o bloco contendo a transação do Mallory, substituindo o pagamento do Mallory para a Carol por uma transação que faz um gasto duplo da mesma entrada do pagamento do Mallory. A transação de gasto duplo consome a mesma UTXO e a paga de volta para a carteira do Mallory, ao invés de pagá-la para a Carol, essencialmente permitindo que o Mallory permaneça com os seus bitcoins. Em seguida, Paul direciona a pool de mineração para minerar um bloco adicional, para tornar a cadeia contendo a transação de gasto duplo maior do que a cadeia original (causando uma bifurcação abaixo do bloco contendo a transação do Mallory). Quando a bifurcação da blockchain resolver-se em favor da nova cadeia (mais longa), a transação de gasto duplo substituirá o pagamento original à Carol. Agora a Carol está sem as suas três pinturas e também não tem mais nenhum pagamento em bitcoin. Durante todo esse período, os participantes da pool de mineração do Paul permanecem sem estar cientes da tentativa de gasto duplo, pois a mineração que eles fazem é automatizada e eles não conseguem monitorar todas as transações ou blocos.</p>
</div>
<div class="paragraph data-line-929">
<p>Para se proteger contra um ataque desse tipo, um comerciante vendendo itens de valor elevado deve esperar pelo menos seis confirmações antes de entregar o produto ao comprador. Outra opção seria o comerciante usar uma conta de garantia (conta-caução) multiassinatura (em inglês, <em>multisig escrow account</em>), novamente esperando por várias confirmações até que a conta de garantia receba os fundos. Quanto maior for o número de confirmações, mais difícil se torna invalidar uma transação com um ataque de 51%. Para itens de valor elevado, o pagamento usando bitcoin ainda será conveniente e eficiente, mesmo que o comprador tenha que esperar 24 horas pela entrega, o que seria equivalente a aproximadamente 144 confirmações.</p>
</div>
<div class="paragraph data-line-931">
<p>In addition to a double-spend attack, the other scenario for a consensus attack is to deny service to specific bitcoin participants (specific Bitcoin addresses). An attacker with a majority of the mining power can simply ignore specific transactions. If they are included in a block mined by another miner, the attacker can deliberately fork and remine that block, again excluding the specific transactions. This type of attack can result in a sustained denial-of-service against a specific address or set of addresses for as long as the attacker controls the majority of the mining power.</p>
</div>
<div class="paragraph data-line-933">
<p>Apesar do nome, o cenário de um ataque de 51% não exige um poder de <em>hashing</em> de 51%. De fato, esse ataque pode ser tentado com uma pequena porcentagem de poder de <em>hashing</em>. O valor mínimo de 51% é simplesmente o nível em que esse tipo de ataque tem sucesso quase garantido. Um ataque de consenso é basicamente um cabo de guerra para o próximo bloco e o grupo "mais forte" tem maior probabilidade de vencer. Com menos poder de <em>hashing</em>, a probabilidade de sucesso é reduzida, pois outros mineradores controlam a geração de alguns blocos com o seu poder de mineração "honesto". Podemos olhar isso da seguinte maneira: quanto mais poder de <em>hashing</em> um atacante tiver, mais longa será a bifurcação que ele poderá criar deliberadamente, mais blocos no passado recente ele poderá invalidar ou mais blocos no futuro ele poderá controlar. Grupos de pesquisa de segurança usaram modelos estatísticos para alegar que vários tipos de ataques de consenso já são possíveis com um poder de <em>hashing</em> de apenas 30%.</p>
</div>
<div class="paragraph data-line-935">
<p>O aumento maciço no poder de <em>hashing</em> total tornou o bitcoin impermeável a ataques feitos por um minerador isolado. Não há mais como um minerador solo controlar mais do que uma pequena percentagem do poder total de mineração. Entretanto, a centralização do controle causada pelas pools de mineração introduziu o risco de ataques em busca de lucro realizados por um operador de pool de mineração. O operador de uma pool gerenciada controla a construção dos blocos candidatos, assim como as transações que são incluídas nos blocos. Isso dá ao operador da pool o poder de excluir transações ou acrescentar transações de gasto duplo. Se esse abuso de poder for feito de uma maneira limitada e sutil, um operador de pool teoricamente seria capaz de lucrar com um ataque de consenso, sem ser descoberto.</p>
</div>
<div class="paragraph data-line-937">
<p>Not all attackers will be motivated by profit, however. One potential attack scenario is where an attacker intends to disrupt the Bitcoin network without the possibility of profiting from such disruption. A malicious attack aimed at crippling bitcoin would require enormous investment and covert planning, but could conceivably be launched by a well-funded, most likely state-sponsored, attacker. Alternatively, a well-funded attacker could attack bitcoin&#8217;s consensus by simultaneously amassing mining hardware, compromising pool operators, and attacking other pools with denial-of-service. All of these scenarios are theoretically possible, but increasingly impractical as the Bitcoin network&#8217;s overall hashing power continues to grow exponentially.</p>
</div>
<div class="paragraph data-line-939">
<p>Undoubtedly, a serious consensus attack would erode confidence in bitcoin in the short term, possibly causing a significant price decline. However, the Bitcoin network and software are constantly evolving, so consensus attacks would be met with immediate countermeasures by the bitcoin community, making bitcoin more robust.</p>
</div>
<div id="consensus_changes" class="paragraph data-line-942">
<p>=== Alterando as Regras de Consenso</p>
</div>
<div class="paragraph data-line-944">
<p>The rules of consensus determine the validity of transactions and blocks. These rules are the basis for collaboration between all Bitcoin nodes and are responsible for the convergence of all local perspectives into a single consistent blockchain across the entire network.</p>
</div>
<div class="paragraph data-line-946">
<p>While the consensus rules are invariable in the short term and must be consistent across all nodes, they are not invariable in the long term. In order to evolve and develop the Bitcoin system, the rules have to change from time to time to accommodate new features, improvements, or bug fixes. Unlike traditional software development, however, upgrades to a consensus system are much more difficult and require coordination between all the participants.</p>
</div>
<div id="hard_forks" class="paragraph data-line-950">
<p>==== Hard Forks
In <a href="#forks">[forks]</a> we looked at how the Bitcoin network may briefly diverge, with two parts of the network following two different branches of the blockchain for a short time. We saw how this process occurs naturally, as part of the normal operation of the network and how the network reconverges on a common blockchain after one or more blocks are mined.</p>
</div>
<div class="paragraph data-line-953">
<p>Há um outro cenário no qual a rede pode divergir para seguir duas cadeias: uma mudança nas regras de consenso. Esse tipo de bifurcação é chamado de <em>hard fork</em> (bifurcação rígida), pois, depois da bifurcação, a rede não se reconverte em uma única cadeia. Em vez disso, as duas cadeias evoluem independentemente. Os hard forks ocorrem quando uma parte da rede está operando sob um conjunto de regras de consenso que é diferente do resto da rede. Isso pode ocorrer devido a um bug ou por uma alteração deliberada na implementação das regras de consenso.</p>
</div>
<div class="paragraph data-line-955">
<p>Os hard forks podem ser usados para alterar as regras de consenso, mas, para isso, eles exigem coordenação entre todos os participantes do sistema. Quaisquer nós que não forem atualizados para as novas regras de consenso serão incapazes de participar do mecanismo de consenso, e, em função disso, serão forçados a usar uma cadeia separada no momento do hard fork. Portanto, uma mudança introduzida por um hard fork pode ser considerada como não "compatível adiante", caso os sistemas que não foram atualizados não consigam processar as novas regras de consenso após o evento do hard fork.</p>
</div>
<div class="paragraph data-line-957">
<p>Vamos examinar a mecânica de um hard fork com um exemplo específico.</p>
</div>
<div class="paragraph data-line-959">
<p>A <a href="#blockchainwithforks">Uma blockchain com bifurcações</a> demonstra uma blockchain com dois forks. Na altura do bloco 4, ocorreu um fork de um único bloco. Esse é o tipo de fork espontâneo que vimos em <a href="#forks">[forks]</a>. Ao ser minerado o bloco 5, a rede reconvergiu em uma única cadeia, e com isso o fork foi resolvido.</p>
</div>
<div id="blockchainwithforks" class="imageblock data-line-963">
<div class="content">
<img src="images/mbc2_1009.png" alt="A blockchain with forks">
</div>
<div class="title">Figure 71. Uma blockchain com bifurcações</div>
</div>
<div class="paragraph data-line-965">
<p>Mais tarde, no entanto, na altura do bloco 6, ocorreu um hard fork. Vamos supor que uma nova implementação do cliente tenha sido lançada com uma mudança nas regras de consenso. A partir da altura do bloco 7, os mineradores que estiverem executando essa nova implementação aceitarão um novo tipo de assinatura digital, vamos chamá-la de assinatura "Smores", que não é baseada em ECDSA. Imediatamente depois, um nó executando a nova implementação cria uma transação que contém uma assinatura Smores, e, a seguir, um minerador com o software atualizado minera o bloco 7b, que contém esta transação.</p>
</div>
<div class="paragraph data-line-967">
<p>Qualquer nó ou minerador que não tiver atualizado o software para validar as assinaturas Smores agora é incapaz de processar o bloco 7b. Do ponto de vista deles, eles consideram inválidos tanto a transação que continha uma assinatura Smores quanto o bloco 7b que continha essa transação, pois eles estão avaliando as transações e os blocos de acordo com as antigas regras de consenso. Esses nós rejeitarão a transação e o bloco, e não os propagarão. Os mineradores que ainda estiverem usando as regras antigas não aceitarão o bloco 7b e continuarão a minerar um bloco candidato cujo pai é o bloco 6. Na verdade, os mineradores que usam as regras antigas podem nem mesmo receber o bloco 7b, se todos os nós aos quais eles estão conectados também estiverem obedecendo as regras antigas e, portanto, não estiverem propagando o bloco. Por fim, eles minerarão o bloco 7a, que é válido sob as regras antigas e não contém nenhuma transação com assinaturas Smores.</p>
</div>
<div class="paragraph data-line-969">
<p>As duas cadeias continuam divergindo a partir deste ponto. Os mineradores na cadeia "b" continuarão a aceitar e minerar transações contendo assinaturas Smores, enquanto os mineradores na cadeia "a" continuarão a ignorar essas transações. Mesmo se o bloco 8b não contiver nenhuma transação com assinatura Smores, os mineradores na cadeia "a" não serão capazes de processá-la. Para eles, o bloco 8b parece ser um bloco órfão, pois seu bloco pai 7b não é reconhecido como um bloco válido.</p>
</div>
<div class="paragraph data-line-971">
<p>==== Hard Forks: Software, Rede, Mineração e Cadeia</p>
</div>
<div class="paragraph data-line-973">
<p>Para desenvolvedores de software, o termo "fork" tem outro significado, o que acaba gerando ainda mais confusão para o significado do termo "hard fork". No software de código aberto, um <em>fork</em> ocorre quando um grupo de desenvolvedores resolve seguir um objetivo diferente e inicia uma implementação concorrente de um projeto de código aberto. Já discutimos duas circunstâncias que levarão a um hard fork no bitcoin: um bug nas regras de consenso e uma modificação deliberada das regras de consenso. No caso de uma modificação deliberada nas regras de consenso, um fork do software precede o hard fork. No entanto, para que esse tipo de hard fork ocorra, uma nova implementação de software das regras de consenso deve ser desenvolvida, adotada e lançada.</p>
</div>
<div class="paragraph data-line-975">
<p>Alguns exemplos de forks de software que tentaram alterar as regras de consenso incluem o Bitcoin XT, o Bitcoin Classic e, mais recentemente, o Bitcoin Unlimited. No entanto, nenhum desses forks de software resultou em um hard fork. Embora um fork de software seja uma pré-condição necessária, ele não é suficiente por si só para que um hard fork ocorra. Para que um hard fork ocorra, a implementação concorrente deve ser adotada e as novas regras devem ser ativadas por mineradores, carteiras e nós intermediários. Por outro lado, existem várias implementações alternativas do Bitcoin Core, e até mesmo forks de software, que não alteram as regras de consenso e, contanto que não tenham um bug, podem coexistir na rede e interoperar sem causar um hard fork.</p>
</div>
<div class="paragraph data-line-977">
<p>As regras de consenso podem diferir de maneiras óbvias e explícitas na validação de transações ou blocos. As regras também podem diferir de maneiras mais sutis, na implementação das regras de consenso, quando elas se aplicam a scripts do bitcoin ou primitivos criptográficos, como assinaturas digitais. Finalmente, as regras de consenso podem diferir de maneiras imprevistas devido a restrições de consenso implícitas impostas por limitações do sistema ou detalhes de implementação. Um exemplo deste último tipo de hard fork foi visto no hard fork inesperado que ocorreu durante a atualização do Bitcoin Core da versão 0.7 para a 0.8, que foi causado por uma limitação na implementação da Berkeley DB, usada para armazenar os blocos.</p>
</div>
<div class="paragraph data-line-979">
<p>Conceitualmente, podemos imaginar que um hard fork se desenvolve em quatro estágios: uma bifurcação do software, uma bifurcação da rede, uma bifurcação da mineração e uma bifurcação da cadeia.</p>
</div>
<div class="paragraph data-line-981">
<p>O processo começa quando uma implementação alternativa do cliente, com regras de consenso modificadas, é criada pelos desenvolvedores.</p>
</div>
<div class="paragraph data-line-983">
<p>Quando essa implementação concorrente é empregada na rede, uma certa porcentagem de mineradores, usuários de carteira e nós intermediários podem adotar e executar essa implementação. Dependendo se as novas regras de consenso aplicam-se a blocos, transações ou algum outro aspecto do sistema, uma nova bifurcação poderá surgir. Se as novas regras de consenso forem aplicadas a transações, uma carteira que cria uma transação sob as novas regras pode precipitar uma bifurcação de rede, seguida por um hard fork quando a transação for minerada em um bloco. Se as novas regras forem aplicadas a blocos, o processo de hard fork começará quando um bloco for minerado de acordo com as novas regras.</p>
</div>
<div class="paragraph data-line-985">
<p>Primeiro, a rede bifurcará. Os nós baseados na implementação original das regras de consenso rejeitarão todas as transações e blocos criados de acordo com as novas regras. Além disso, os nós que seguem as regras de consenso originais irão temporariamente banir e desconectar-se de quaisquer nós que estejam lhes enviando essas transações e blocos inválidos. Como resultado, a rede será dividida em duas: os nós antigos permanecerão conectados apenas aos nós antigos e os novos nós serão conectados apenas aos novos nós. Assim que uma única transação ou bloco usando as novas regras propagar-se pela rede, a rede se dividirá em duas.</p>
</div>
<div class="paragraph data-line-987">
<p>Quando um minerador usando as novas regras minerar um bloco, o poder de mineração e a cadeia também se bifurcarão. Os novos mineradores minerarão em cima do novo bloco, enquanto os antigos mineradores minerarão uma cadeia separada que é baseada nas regras antigas. A rede dividida fará com que os mineradores operando em regras de consenso separadas provavelmente não recebam os blocos uns dos outros, pois eles estão conectados a duas redes separadas.</p>
</div>
<div class="paragraph data-line-989">
<p>==== Mineradores Divergentes e Dificuldade</p>
</div>
<div class="paragraph data-line-991">
<p>À medida que os mineradores divergem na mineração em duas cadeias diferentes, o poder de <em>hashing</em> é dividido entre as cadeias. O poder de mineração pode ser dividido em qualquer proporção entre as duas cadeias. As novas regras podem ser seguidas tanto por uma pequena minoria, quanto por uma grande maioria do poder de mineração.</p>
</div>
<div class="paragraph data-line-993">
<p>Vamos supor, por exemplo, uma divisão de 80%&#x2013;20%, com a maioria do poder de mineração usando as novas regras de consenso. Suponhamos também que a bifurcação ocorra imediatamente após um período de reajuste do alvo.</p>
</div>
<div class="paragraph data-line-995">
<p>Cada uma das duas cadeias herdaria a dificuldade do período de reajuste de alvo. As novas regras de consenso teriam comprometido com elas 80% do poder de mineração anteriormente disponível. Do ponto de vista dessa cadeia, o poder de mineração diminuiu repentinamente 20% em relação ao período anterior. Os blocos serão encontrados em média a cada 12,5 minutos, o que representa a queda de 20% no poder de mineração disponível para estender essa cadeia. Esse ritmo de emissão de blocos permanecerá (não havendo qualquer mudança no poder de <em>hashing</em>) até que os 2.016 blocos sejam minerados, o que levará aproximadamente 25.200 minutos (a 12,5 minutos por bloco), ou 17,5 dias. Após 17,5 dias, um reajuste do alvo ocorrerá e a dificuldade será ajustada (reduzida em 20%) para que novamente sejam produzidos blocos a cada 10 minutos, levando em consideração a quantidade reduzida de poder de <em>hashing</em> nesta cadeia.</p>
</div>
<div class="paragraph data-line-997">
<p>A cadeia minoritária, minerando sob as regras antigas e com apenas 20% do poder de <em>hashing</em>, enfrentará uma tarefa muito mais difícil. Nessa cadeia, os blocos agora serão minerados a cada 50 minutos, em média. A dificuldade não será ajustada durante os próximos 2.016 blocos, que levarão 100.800 minutos, ou cerca de 10 semanas, para serem minerados. Assumindo uma capacidade fixa por bloco, isso também resultará em uma redução em cinco vezes na capacidade de transações, pois há menos blocos disponíveis a cada hora para registrar as transações.</p>
</div>
<div class="paragraph data-line-999">
<p>==== Hard Forks Contenciosos</p>
</div>
<div class="paragraph data-line-1001">
<p>O desenvolvimento de software de consenso está apenas dando os seus primeiros passos. Assim como o surgimento do desenvolvimento de código aberto mudou os métodos e os produtos de software e criou novas metodologias, novas ferramentas e novas comunidades, o desenvolvimento de software de consenso também representa uma nova fronteira na ciência da computação. De todos os debates, experimentos e conflitos no <em>roadmap</em> do desenvolvimento do bitcoin, veremos o surgimento de novas ferramentas, práticas, metodologias e comunidades de desenvolvimento.</p>
</div>
<div class="paragraph data-line-1003">
<p>Os hard forks são vistos como arriscados porque eles forçam uma minoria a ou atualizar o software, ou permanecer em uma cadeia minoritária. O risco de dividir todo o sistema em dois sistemas concorrentes é visto por muitos como um risco inaceitável. Como resultado, muitos desenvolvedores relutam em usar o mecanismo de hard fork para implementar atualizações nas regras de consenso, a menos que haja suporte quase unânime de toda a rede. Quaisquer propostas hard fork que não tenham apoio quase unânime são consideradas muito "contenciosas" para serem tentadas, sob o risco de ocorrer uma divisão do sistema.</p>
</div>
<div class="paragraph data-line-1005">
<p>A questão dos hard forks é altamente controversa na comunidade de desenvolvimento do bitcoin, especialmente no que se refere a quaisquer alterações propostas às regras de consenso que controlam o limite máximo do tamanho do bloco. Alguns desenvolvedores se opõem a qualquer tipo de hard fork, pois consideram isso muito arriscado. Outros enxergam o mecanismo do hard fork como uma ferramenta essencial para atualizar as regras de consenso de uma forma que evite "dívidas técnicas" e forneça uma ruptura nítida com o passado. E, por último, alguns desenvolvedores enxergam os hard forks como um mecanismo que deve ser usado raramente, com muito planejamento prévio e apenas sob consenso quase unânime.</p>
</div>
<div class="paragraph data-line-1007">
<p>Algumas novas metodologias já foram desenvolvidas para lidar com os riscos dos hard forks. Na próxima seção, veremos os soft forks e os métodos BIP-34 e BIP-9 para sinalização e ativação de modificações de consenso.</p>
</div>
<div class="paragraph data-line-1009">
<p>==== Soft Forks</p>
</div>
<div class="paragraph data-line-1011">
<p>Nem todas as alterações de regras de consenso geram hard forks. As únicas alterações de consenso que geram bifurcações são aquelas que são incompatíveis "daqui para a frente". Se a alteração for implementada de forma que um cliente não atualizado ainda veja a transação ou o bloco como válido de acordo com as regras anteriores, a alteração pode ocorrer sem uma bifurcação.</p>
</div>
<div class="paragraph data-line-1013">
<p>O termo <em>soft fork</em> foi introduzido para distinguir este método de atualização de um "hard fork". Na prática, um soft fork não é sequer uma bifurcação. Um soft fork é uma mudança das regras de consenso compatível com clientes que não foram atualizados, pois permite que os clientes não atualizados continuem a operar em consenso com as novas regras.</p>
</div>
<div class="paragraph data-line-1015">
<p>Um aspecto dos soft forks que não é imediatamente óbvio é que as atualizações de soft fork só podem ser usadas para restringir as regras de consenso, e não para expandi-las. Para serem compatíveis com todos os clientes daqui para a frente (os atualizados e os não atualizados), as transações e os blocos criados sob as novas regras devem ser válidos também sob as regras antigas, mas não vice-versa. As novas regras podem apenas limitar o que é válido; caso contrário, elas gerarão um hard fork quando forem rejeitadas pelos clientes que não foram atualizados e ainda seguem as regras antigas.</p>
</div>
<div class="paragraph data-line-1017">
<p>Os soft forks podem ser implementados de várias maneiras&#x2014;o termo não especifica um método em particular, mas sim um conjunto de métodos que têm uma característica em comum: eles não exigem que todos os nós atualizem, nem forçam os nós não atualizados para fora do consenso.</p>
</div>
<div class="paragraph data-line-1019">
<p>===== Soft forks redefinindo códigos operacionais NOP</p>
</div>
<div class="paragraph data-line-1021">
<p>Vários soft forks foram implementados no bitcoin com base na reinterpretação de códigos operacionais NOP. O Script do bitcoin tinha dez códigos operacionais reservados para uso futuro, do NOP1 ao NOP10. De acordo com as regras de consenso, a presença desses códigos operacionais em um script é interpretada como um operador nulo-potente, o que significa que eles não têm efeito. A execução continua após o código operacional NOP, como se ele não existisse.</p>
</div>
<div class="paragraph data-line-1023">
<p>Um soft fork, portanto, pode modificar a semântica de um código NOP para dar a ele um novo significado. Por exemplo, a BIP-65 (CHECKLOCKTIMEVERIFY) reinterpretou o código operacional NOP2. Os clientes que implementam a BIP-65 interpretam o NOP2 como OP_CHECKLOCKTIMEVERIFY e impõem uma regra de consenso de <em>locktime</em> absoluto em UTXOs que contêm este código operacional em seus scripts de travamento. Essa alteração é um soft fork, pois uma transação que é válida sob a BIP-65 também é válida em qualquer cliente que não tenha implementado a BIP-65. Para os clientes antigos, o script contém um código NOP, que é ignorado.</p>
</div>
<div class="paragraph data-line-1025">
<p>===== Outras maneiras de se atualizar com soft fork</p>
</div>
<div class="paragraph data-line-1027">
<p>A reinterpretação dos códigos operacionais NOP foi planejada para ser um mecanismo óbvio para atualizações de consenso. Recentemente, no entanto, foi introduzido outro mecanismo de soft fork que não depende dos códigos operacionais NOP para um tipo muito específico de mudança de consenso. Esse mecanismo é examinado com mais detalhes em <a href="#segwit">[segwit]</a>. A segwit é uma mudança arquitetural na estrutura de uma transação, que move o script de destravamento (a testemunha) de dentro da transação para uma estrutura de dados externa (segregando-a). A segwit foi inicialmente concebida para ser uma atualização introduzida através de um hard fork, pois ela modificava uma estrutura fundamental (a transação). Em novembro de 2015, um desenvolvedor trabalhando no Bitcoin Core propôs um mecanismo por meio do qual a segwit poderia ser introduzida através de um soft fork. O mecanismo usado para isso foi uma modificação do script de travamento da UTXO criado sob regras da segwit, de maneira que os clientes não atualizados vissem o script de travamento como resgatável por qualquer script de destravamento. Como resultado, foi possível introduzir a segwit com um soft fork, não sendo mais necessário exigir que cada nó fosse atualizado ou que se separasse da cadeia principal.</p>
</div>
<div class="paragraph data-line-1029">
<p>É provável que ainda sejam descobertos novos mecanismos pelos quais as atualizações possam ser feitas de uma maneira que seja compatível "daqui para a frente", assim como acontece em um soft fork.</p>
</div>
<div class="paragraph data-line-1031">
<p>==== Críticas aos Soft Forks</p>
</div>
<div class="paragraph data-line-1033">
<p>Os soft forks baseados nos códigos operacionais NOP geralmente não são controversos. Os códigos operacionais NOP foram implementados no Bitcoin Script com o objetivo explícito de permitir atualizações não disruptivas.</p>
</div>
<div class="paragraph data-line-1035">
<p>No entanto, muitos desenvolvedores consideram que outros métodos de atualização com soft fork tem desvantagens inaceitáveis. As críticas mais comuns às alterações com soft fork incluem:</p>
</div>
<div class="dlist data-line-1037">
<dl>
<dt class="hdlist1">Dívida técnica</dt>
<dd>
<p>Como os soft forks são tecnicamente mais complexos do que uma atualização de hard fork, eles introduzem uma <em>dívida técnica</em>, um termo que se refere ao aumento do custo futuro de manutenção do código devido às limitações dos designs escolhidos no passado. A complexidade do código, por sua vez, aumenta a probabilidade da ocorrência de bugs e vulnerabilidades de segurança.</p>
</dd>
<dt class="hdlist1">Relaxamento da validação</dt>
<dd>
<p>Os clientes não atualizados enxergam transações como válidas, sem avaliar as regras de consenso modificadas. Na prática, os clientes não atualizados não estão validando usando toda a gama das regras de consenso, pois eles não conhecem as novas regras. Isso se aplica a atualizações baseadas em NOP, bem como a outras atualizações de soft fork.</p>
</dd>
<dt class="hdlist1">Atualizações irreversíveis</dt>
<dd>
<p>Como os soft forks criam transações com restrições de consenso adicionais, na prática, eles acabam tornando-se atualizações irreversíveis. Se um upgrade de soft fork fosse revertido após a ativação, qualquer transação criada sob as novas regras poderia resultar em uma perda de fundos sob as regras antigas. Por exemplo, se uma transação CLTV for avaliada sob as regras antigas, não há restrição de <em>timelock</em> e ela pode ser gasta a qualquer momento. Portanto, os críticos afirmam que se um soft fork problemático tivesse que ser revertido por causa de um bug, isso quase certamente levaria a uma perda de fundos.</p>
</dd>
</dl>
</div>
<div id="softforksignaling" class="paragraph data-line-1044">
<p>=== Sinalização de Soft Fork com Versão de Bloco</p>
</div>
<div class="paragraph data-line-1046">
<p>Como os soft forks permitem que os clientes não atualizados continuem a operar dentro do consenso, o mecanismo para "ativar" um soft fork ocorre através dos mineradores sinalizando prontidão: a maioria dos mineradores deve concordar que está pronta e disposta a fazer cumprir as novas regras de consenso. Para coordenar suas ações, existe um mecanismo de sinalização que lhes permite mostrar seu apoio a uma mudança de regra de consenso. Este mecanismo foi introduzido com a ativação da BIP-34 em março de 2013 e depois foi substituído pela ativação da BIP-9 em julho de 2016.</p>
</div>
<div class="paragraph data-line-1048">
<p>==== Sinalização e Ativação da BIP-34</p>
</div>
<div class="paragraph data-line-1050">
<p>A primeira implementação, na BIP-34, usou o campo da versão do bloco para permitir que os mineradores sinalizassem a prontidão para uma mudança específica de regra de consenso. Antes da BIP-34, a versão do bloco era definida como "1" por <em>convenção</em>, e não imposta por <em>consenso</em>.</p>
</div>
<div class="paragraph data-line-1052">
<p>A BIP-34 definiu uma mudança de regra de consenso que exigia que o campo dos dados coinbase na entrada de uma transação coinbase contivesse a altura do bloco. Antes da BIP-34, os dados coinbase podiam conter quaisquer dados arbitrários que os mineradores decidissem incluir. Após a ativação da BIP-34, os blocos válidos deveriam conter uma altura de bloco específica no início dos dados coinbase e ser identificados com um número de versão maior ou igual a "2".</p>
</div>
<div class="paragraph data-line-1054">
<p>Para sinalizar a mudança e a ativação da BIP-34, os mineradores definiram a versão do bloco para "2", ao invés de "1". Isso não invalidou imediatamente os blocos da versão "1". Uma vez ativada, os blocos da versão "1" se tornariam inválidos e todos os blocos da versão "2" seriam obrigados a conter a altura do bloco na coinbase para serem válidos.</p>
</div>
<div class="paragraph data-line-1056">
<p>A BIP-34 definiu um mecanismo de ativação em duas etapas, com base em uma janela temporal de 1.000 blocos. Um minerador sinalizaria a sua prontidão individual para a BIP-34 construindo blocos com o número de versão "2". A rigor, esses blocos ainda não precisavam obedecer à nova regra de consenso de incluir a altura do bloco na transação coinbase, pois a regra de consenso ainda não havia sido ativada. As regras de consenso foram ativadas em duas etapas:</p>
</div>
<div class="ulist data-line-1058">
<ul>
<li class="data-line-1058">
<p>Se 75% (750 dos 1.000 blocos mais recentes) estiverem marcados com a versão "2", então os blocos da versão "2" devem conter a altura do bloco na transação coinbase ou eles serão rejeitados como inválidos. Os blocos da versão "1" ainda são aceitos pela rede e não precisam conter a altura do bloco. As regras de consenso antigas e novas coexistem durante este período.</p>
</li>
<li class="data-line-1060">
<p>Quando 95% (950 dos 1.000 blocos mais recentes) forem da versão "2", os blocos da versão "1" não mais serão considerados válidos. Os blocos da versão "2" só serão válidos se eles contiverem a altura do bloco na coinbase (assim como na etapa anterior). Depois disso, todos os blocos devem estar de acordo com as novas regras de consenso, e todos os blocos válidos devem conter a altura do bloco na transação coinbase.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1062">
<p>Após a sinalização e ativação bem-sucedidas de acordo com as regras da BIP-34, este mecanismo foi usado mais duas vezes para ativar soft forks:</p>
</div>
<div class="ulist data-line-1064">
<ul>
<li class="data-line-1064">
<p>A codificação DER estrita de assinaturas da <a href="https://github.com/bitcoin/bips/blob/master/bip-0066.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0066.mediawiki">BIP-66</a> foi ativada pela sinalização de estilo BIP-34 com uma versão de bloco "3" e invalidando os blocos da versão "2".</p>
</li>
<li class="data-line-1066">
<p>O CHECKLOCKTIMEVERIFY da <a href="https://github.com/bitcoin/bips/blob/master/bip-0065.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0065.mediawiki">BIP-65</a> foi ativado pela sinalização do estilo BIP-34 com uma versão de bloco "4" e invalidando os blocos da versão "3".</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1068">
<p>Após a ativação da BIP-65, o mecanismo de sinalização e ativação da BIP-34 foi aposentado e substituído pelo mecanismo de sinalização da BIP-9, descrito a seguir.</p>
</div>
<div class="paragraph data-line-1070">
<p>O padrão é definido na <a href="https://github.com/bitcoin/bips/blob/master/bip-0034.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0034.mediawiki">BIP-34 (Bloco v2, Altura na Coinbase)</a>.</p>
</div>
<div class="paragraph data-line-1072">
<p>==== Sinalização e Ativação da BIP-9</p>
</div>
<div class="paragraph data-line-1074">
<p>O mecanismo usado pela BIP-34, BIP-66 e BIP-65 foi bem-sucedido na ativação de três soft forks. No entanto, ele acabou sendo substituído, pois tinha várias limitações:</p>
</div>
<div class="ulist data-line-1076">
<ul>
<li class="data-line-1076">
<p>Como o valor inteiro da versão do bloco era utilizado, apenas um soft fork poderia ser ativado por vez, portanto, era necessária uma coordenação entre as propostas do soft fork e um acordo sobre sua priorização e ordem de ativação.</p>
</li>
<li class="data-line-1078">
<p>Além disso, como a versão do bloco foi incrementada, o mecanismo não oferecia uma maneira direta de se rejeitar uma alteração e então propor uma diferente. Se os clientes antigos ainda estivessem em execução, eles poderiam confundir a sinalização de uma nova alteração como se fosse uma sinalização da alteração rejeitada anteriormente.</p>
</li>
<li class="data-line-1080">
<p>Cada nova alteração reduzia de maneira irreversível as versões de bloco disponíveis para alterações futuras.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1082">
<p>A BIP-9 foi proposta para superar esses desafios e melhorar o ritmo e a facilidade de implementação de alterações futuras.</p>
</div>
<div class="paragraph data-line-1084">
<p>A BIP-9 interpreta a versão do bloco como um campo de bits ao invés de um número inteiro. Como a versão do bloco foi originalmente usada como um número inteiro, as versões 1 a 4, apenas 29 bits permanecem disponíveis para serem usados como um campo de bits. Isso deixa 29 bits para poderem ser usados para sinalizar prontidão, de forma independente e simultânea, a 29 propostas diferentes.</p>
</div>
<div class="paragraph data-line-1086">
<p>A BIP-9 também define um tempo máximo para sinalização e ativação. Dessa forma, os mineradores não precisam sinalizar para sempre. Se uma proposta não for ativada dentro do período TIMEOUT (definido na proposta), a proposta é considerada rejeitada. A proposta pode ser enviada novamente para sinalização com um bit diferente, renovando o período de ativação.</p>
</div>
<div class="paragraph data-line-1088">
<p>Além disso, após o TIMEOUT ter expirado e um recurso ter sido ativado ou rejeitado, o bit de sinalização pode ser reutilizado para outra funcionalidade, sem causar confusão. Portanto, até 29 alterações podem ser sinalizadas em paralelo e após o TIMEOUT os bits podem ser "reciclados" para propor novas alterações.</p>
</div>
<div class="admonitionblock note data-line-1091">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-1092">
<p>Embora os bits de sinalização possam ser reutilizados ou reciclados, desde que o período de votação não se sobreponha, os autores da BIP-9 recomendam que os bits sejam reutilizados apenas quando necessário, visto que um comportamento inesperado pode ocorrer devido a bugs em softwares mais antigos. Em suma, provavelmente não veremos reutilizações até que todos os 29 bits tenham sido usados pelo menos uma vez.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1095">
<p>As alterações propostas são identificadas por uma estrutura de dados que contém os seguintes campos:</p>
</div>
<div class="dlist data-line-1097">
<dl>
<dt class="hdlist1">name</dt>
<dd>
<p>Uma breve descrição usada para distinguir entre as propostas. Na maioria das vezes, a BIP descrevendo a proposta, como "bipN", onde N é o número da BIP.</p>
</dd>
<dt class="hdlist1">bit</dt>
<dd>
<p>0 a 28, o bit na versão de bloco que os mineradores usam para sinalizar aprovação para esta proposta.</p>
</dd>
<dt class="hdlist1">starttime</dt>
<dd>
<p>O momento (baseado no <em>Median Time Past</em>, ou MTP) em que a sinalização começa, após o qual o valor do bit é interpretado como sinalização de prontidão para a proposta.</p>
</dd>
<dt class="hdlist1">endtime</dt>
<dd>
<p>O momento (baseado no MTP) após o qual a alteração é considerada rejeitada, caso ela não tenha atingido o limiar de ativação.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-1105">
<p>Ao contrário da BIP-34, a BIP-9 conta a sinalização de ativação em intervalos inteiros com base no período de reajuste do alvo de dificuldade, que é de 2.016 blocos. Para cada período de reajuste do alvo, se a soma dos blocos sinalizando para uma proposta exceder 95% (1.916 de 2.016), a proposta será ativada um período de reajuste do alvo depois.</p>
</div>
<div class="paragraph data-line-1107">
<p>A BIP-9 oferece um diagrama de estado da proposta para ilustrar os vários estágios e transições de uma proposta, conforme demonstrado na <a href="#bip9states">Diagrama de transição de estado da BIP-9</a>.</p>
</div>
<div class="paragraph data-line-1109">
<p>As propostas começam no estado DEFINED (definida), uma vez que seus parâmetros são conhecidos (definidos) no software do bitcoin. Para blocos com MTP após o <em>starttime</em> (o momento em que a sinalização começa), o estado da proposta muda para STARTED (iniciada). Se o limiar (valor mínimo) de votação for excedido em um período de reajuste do alvo e o <em>timeout</em> (tempo limite) não tiver sido excedido, o estado da proposta muda para LOCKED_IN (travada). Um período de reajuste do alvo depois, a proposta se torna ACTIVE (ativa). Uma vez atingido o estado ACTIVE, as propostas permanecem nesse estado perpetuamente. Se o <em>timeout</em> (tempo limite) expirar antes de o limiar (valor mínimo) de votação ser atingido, o estado da proposta muda para FAILED, indicando uma proposta rejeitada. As propostas rejeitadas permanecem no estado FAILED perpetuamente.</p>
</div>
<div id="bip9states" class="imageblock data-line-1113">
<div class="content">
<img src="images/mbc2_1010.png" alt="BIP-9 Proposal State Transition Diagram">
</div>
<div class="title">Figure 72. Diagrama de transição de estado da BIP-9</div>
</div>
<div class="paragraph data-line-1115">
<p>A BIP-9 foi implementada pela primeira vez para a ativação do CHECKSEQUENCEVERIFY e das BIPs associadas (68, 112, 113). A proposta chamada "csv" foi ativada com sucesso em julho de 2016.</p>
</div>
<div class="paragraph data-line-1117">
<p>O padrão é definido na <a href="https://github.com/bitcoin/bips/blob/master/bip-0009.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0009.mediawiki">BIP-9 (Bits de versão com tempo limite e atraso)</a>.</p>
</div>
<div class="paragraph data-line-1119">
<p>=== Desenvolvimento de Software de Consenso</p>
</div>
<div class="paragraph data-line-1121">
<p>O software de consenso continua a evoluir e há muitas discussões sobre os vários mecanismos que são usados para alterar as regras de consenso. Por sua própria natureza, o bitcoin estabelece um nível de exigência muito alto na coordenação e no consenso para mudanças. Por ser um sistema descentralizado, ele não possui uma "autoridade" que possa impor sua vontade aos participantes da rede. O poder é difundido entre vários constituintes, como mineradores, desenvolvedores core, desenvolvedores de carteira, corretoras, comerciantes e usuários finais. As decisões não podem ser tomadas unilateralmente por nenhum desses constituintes. Por exemplo, embora os mineradores possam teoricamente mudar as regras por maioria simples (51%), eles são limitados pelo consentimento dos outros constituintes. Se eles atuarem unilateralmente, os demais participantes podem simplesmente recusar-se a segui-los, mantendo a atividade econômica em uma cadeia minoritária. Sem atividade econômica (transações, comerciantes, carteiras, corretoras), os mineradores estarão minerando uma moeda sem valor, com blocos vazios. Esta distribuição de poder significa que todos os participantes devem agir de maneira coordenada, ou nenhuma mudança pode ser feita. O <em>status quo</em> é o estado estável desse sistema, com a possibilidade de apenas algumas mudanças, caso haja um forte consenso por parte de uma ampla maioria. A exigência de uma votação mínima de 95% para os soft forks reflete essa realidade.</p>
</div>
<div class="paragraph data-line-1123">
<p>É importante reconhecer que não existe uma solução perfeita para o desenvolvimento de consenso. Tanto os hard forks quanto os soft forks possuem limitações. Para alguns tipos de alterações, os soft forks podem ser uma escolha melhor; para outros tipos, os hard forks podem ser uma escolha melhor. Não existe uma escolha perfeita; os dois tipos de forks carregam riscos. A única característica constante do desenvolvimento de software de consenso é que a mudança é difícil e o consenso força um acordo.</p>
</div>
<div class="paragraph data-line-1125">
<p>Alguns enxergam isso como sendo uma fraqueza dos sistemas de consenso. Com o tempo, você poderá enxergar isso da mesma maneira que eu enxergo, como sendo a maior força do sistema.</p>
</div>
<div class="paragraph data-line-1127">
<p>Unresolved directive in &lt;stdin&gt; - include::for_use_mastering-bitcoin_chapter-11_pt_BR.adoc[]</p>
</div>
<div class="paragraph data-line-1129">
<p>Unresolved directive in &lt;stdin&gt; - include::for_use_mastering-bitcoin_chapter-12_pt_BR.adoc[]</p>
</div>
<div id="satoshi_whitepaper" class="paragraph data-line-1133">
<p>== O Whitepaper do Bitcoin por Satoshi Nakamoto</p>
</div>
<div class="admonitionblock note data-line-1136">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-1137">
<p>Esta é a tradução para o português do Brasil do <em>whitepaper</em> original do bitcoin, reproduzido em sua íntegra como foi publicado por Satoshi Nakamoto em outubro de 2008.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1140">
<p>=== Bitcoin - Um Sistema de Dinheiro em Espécie Eletrônico Par-a-Par</p>
</div>
<div class="paragraph data-line-1142">
<p>Satoshi Nakamoto</p>
</div>
<div class="paragraph data-line-1144">
<p><em>satoshin@gmx.com</em></p>
</div>
<div class="paragraph data-line-1146">
<p><a href="https://bitcoin.org/en/" class="orm:hideurl"><em>www.bitcoin.org</em></a></p>
</div>
<div class="paragraph data-line-1148">
<p><strong>Resumo.</strong> Uma versão puramente par-a-par de dinheiro em espécie eletrônico permitiria que pagamentos on-line fossem enviados diretamente de uma parte para outra, sem passar por uma instituição financeira. As assinaturas digitais fornecem parte da solução, mas os principais benefícios são perdidos se um terceiro de confiança ainda é necessário para evitar o gasto duplo. Propomos uma solução para o problema do gasto duplo usando uma rede par-a-par (<em>peer-to-peer</em>). A rede registra a data e a hora (<em>timestamp</em>) das transações ao transformá-las em hashes que são adicionados em uma cadeia contínua de prova-de-trabalho baseada em hashes, formando um registro que não pode ser alterado sem que a prova-de-trabalho seja refeita. A cadeia mais longa não apenas serve como prova da sequência de eventos testemunhados, mas também serve como prova de que ela veio da maior pool de poder computacional. Contanto que a maior parte do poder computacional seja controlada por nós que não estão cooperando para atacar a rede, estes nós gerarão a cadeia mais longa e superarão os atacantes. A rede em si requer uma estrutura mínima. As mensagens são transmitidas em regime de melhor esforço, e os nós podem sair e regressar à rede à vontade, aceitando a cadeia mais longa de prova-de-trabalho como prova do que aconteceu enquanto eles estiveram fora.</p>
</div>
<div class="paragraph data-line-1150">
<p>=== Introdução
O comércio na Internet tem dependido quase que exclusivamente de instituições financeiras servindo como terceiros de confiança para processar pagamentos eletrônicos. Enquanto o sistema funciona bem o suficiente para a maioria das operações, ele ainda sofre com as deficiências inerentes ao modelo baseado em confiança. Transações completamente não reversíveis não são realmente possíveis, pois as instituições financeiras não podem evitar a mediação de conflitos. O custo da mediação aumenta os custos de transação, o que limita o tamanho mínimo prático da transação e elimina a possibilidade de pequenas transações ocasionais, e há um custo mais amplo na perda da capacidade de fazer pagamentos não reversíveis para serviços não reversíveis. Com a possibilidade de reversão, a necessidade de confiança se espalha. Os comerciantes precisam ser cautelosos com os seus clientes, incomodando-os para obter mais informações do que seriam de outra forma necessárias. Uma certa percentagem de fraude é aceita como inevitável. Estes custos e incertezas de pagamento podem ser evitados em uma transação presencial através do uso de dinheiro espécie, no entanto, não há nenhum mecanismo que permita a realização de pagamentos através de um canal de comunicação sem o envolvimento de um participante de confiança.</p>
</div>
<div class="paragraph data-line-1153">
<p>O que é necessário é um sistema de pagamento eletrônico que seja baseado em prova criptográfica em vez de confiança, permitindo que quaisquer duas partes dispostas possam transacionar diretamente uma com a outra sem a necessidade de um terceiro de confiança. Transações que são computacionalmente impraticáveis de serem revertidas protegeriam os vendedores de fraudes e mecanismos rotineiros de custódia poderiam ser facilmente implementados para proteger os compradores. Neste artigo, propomos uma solução para o problema do gasto duplo usando um servidor de carimbo de data e hora (<em>timestamp</em>) distribuído par-a-par (<em>peer-to-peer</em>) para gerar prova computacional da ordem cronológica das transações. O sistema é seguro desde que nós honestos controlem coletivamente mais poder computacional do que qualquer grupo cooperante de nós atacantes.</p>
</div>
<div class="paragraph data-line-1155">
<p>==== Transações
Definimos uma moeda eletrônica como uma cadeia de assinaturas digitais. Cada dono transfere a moeda para o próximo ao assinar digitalmente um hash da transação anterior e a chave pública do próximo dono e adicionando-os ao final da moeda. Quem recebe a moeda pode verificar as assinaturas para verificar a cadeia de posse.</p>
</div>
<div class="imageblock data-line-1158">
<div class="content">
<img src="images/mbc2_abin01.png" alt="Transactions">
</div>
</div>
<div class="paragraph data-line-1160">
<p>O problema, obviamente, é que o beneficiário não consegue verificar se um dos donos não fez um gasto duplo da moeda. Uma solução comum é introduzir uma autoridade central de confiança, ou casa da moeda, que verifique cada transação para ver se houve um gasto duplo. Depois de cada transação, a moeda deve ser devolvida à casa da moeda para a emissão de uma nova moeda, e apenas as moedas emitidas diretamente pela casa da moeda possuem a garantia de não terem sido usadas em um gasto duplo. O problema desta solução é que o destino de todo o sistema monetário depende da empresa que gerencia a casa da moeda, com todas as transações tendo que passar por ela, como se fosse um banco.</p>
</div>
<div class="paragraph data-line-1162">
<p>Precisamos de uma maneira de fazer com que o beneficiário possa saber se os donos anteriores não assinaram quaisquer transações anteriores. Para nossos propósitos, a transação mais antiga é a que conta, por isso, não nos preocupamos com tentativas posteriores de gasto duplo. A única maneira de se confirmar a ausência de uma transação é estar ciente de todas as transações. No modelo baseado em casa da moeda, a mesma estava ciente de todas as transações e decidia qual tinha chegado primeiro. Para alcançar este objetivo sem um participante de confiança, as transações devem ser anunciadas publicamente [1], e precisamos de um sistema para que os participantes concordem com um único histórico contendo a ordem em que as transações foram recebidas. O beneficiário precisa ter uma prova de que, no momento de cada transação, a maioria dos nós concordava que ela tinha sido a primeira a ser recebida.</p>
</div>
<div class="paragraph data-line-1164">
<p>==== Servidor de Carimbo de Data e Hora (<em>Timestamp</em>)
A solução que propomos começa com um servidor de carimbo de data e hora (<em>timestamp</em>). Um servidor de carimbo de data e hora funciona gerando um hash de um bloco de itens e publicando amplamente o hash em lugares como um jornal ou um post na Usenet [2-5]. O carimbo de data e hora comprova que os dados existiam naquela época, obviamente, pois eles precisavam existir para serem usados na geração do hash. Cada carimbo de data e hora inclui o carimbo anterior em seu hash, formando uma cadeia, com cada carimbo adicional reforçando os que vieram antes dele.</p>
</div>
<div class="imageblock data-line-1167">
<div class="content">
<img src="images/mbc2_abin02.png" alt="timestamp server">
</div>
</div>
<div class="paragraph data-line-1169">
<p>==== Prova-de-Trabalho
Para implementar um servidor de carimbos de data e hora distribuído em uma base par-a-par (<em>peer-to-peer</em>), teremos de usar um sistema de prova-de-trabalho semelhante ao Hashcash de Adam Back [6], ao invés de jornais ou posts na Usenet. A prova-de-trabalho envolve a procura por um valor que, quando transformado em hash, através de um algoritmo como o SHA-256, o hash comece com um determinado número de bits zero. O trabalho médio exigido é exponencial ao número de bits zero requeridos e pode ser verificada por meio da execução de um único hash. Para nossa rede de carimbos de data e hora, implementamos a prova-de-trabalho ao incrementar um nonce no bloco até que seja encontrado um valor que dê ao hash do bloco a quantidade exigida de bits zero. Uma vez que o esforço computacional tenha sido gasto para satisfazer a prova-de-trabalho, o bloco não pode ser modificado sem que o trabalho seja refeito. À medida que outros blocos são encadeados mais tarde, o trabalho para modificar o bloco incluiria refazer todos os blocos que foram encadeados posteriormente.</p>
</div>
<div class="imageblock data-line-1172">
<div class="content">
<img src="images/mbc2_abin03.png" alt="pow">
</div>
</div>
<div class="paragraph data-line-1174">
<p>A prova-de-trabalho também resolve o problema que existe em se determinar a representação na tomada de decisão através de uma maioria. Se a maioria fosse baseada em um-endereço-IP-um-voto, isso poderia ser subvertido por qualquer pessoa capaz de alocar muitos IPs. A prova-de-trabalho é, essencialmente, uma-CPU-um-voto. A decisão da maioria é representada pela cadeia mais longa, que tem o maior esforço de prova-de-trabalho investido nela. Se a maioria do poder computacional (poder de CPU) for controlada por nós honestos, a cadeia honesta crescerá mais rápido e superará quaisquer cadeias concorrentes. Para modificar um bloco anterior, um atacante teria que refazer a prova-de-trabalho do bloco e de todos os blocos posteriores e, em seguida, alcançar e superar o trabalho dos nós honestos. Mais tarde mostraremos que a probabilidade de um atacante mais lento ter sucesso em alcançar os nós honestos diminui exponencialmente à medida que blocos subsequentes são adicionados.</p>
</div>
<div class="paragraph data-line-1176">
<p>Para compensar o aumento da velocidade do hardware e o interesse variado em se executar nós ao longo do tempo, a dificuldade da prova-de-trabalho é determinada por uma média móvel visando um número médio de blocos por hora. Se eles forem gerados rápido demais, a dificuldade aumenta.</p>
</div>
<div class="paragraph data-line-1178">
<p>==== Rede</p>
</div>
<div class="paragraph data-line-1180">
<p>Os passos para executar a rede são os seguintes:</p>
</div>
<div class="olist arabic data-line-1182">
<ol class="arabic">
<li class="data-line-1182">
<p>As transações novas são transmitidas para todos os nós.</p>
</li>
<li class="data-line-1183">
<p>Cada nó coleta as transações novas em um bloco.</p>
</li>
<li class="data-line-1184">
<p>Cada nó trabalha para encontrar uma prova-de-trabalho difícil para o seu bloco.</p>
</li>
<li class="data-line-1185">
<p>Quando um nó encontra uma prova-de-trabalho, ele transmite o bloco para todos os nós.</p>
</li>
<li class="data-line-1186">
<p>Os nós aceitam o bloco somente se todas as suas transações são válidas e ainda não foram gastas.</p>
</li>
<li class="data-line-1187">
<p>Os nós expressam sua aceitação do bloco ao trabalhar na criação do próximo bloco na cadeia, usando o hash do bloco aceito como o hash anterior.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-1189">
<p>Os nós sempre consideram a cadeia mais longa como sendo a correta e continuarão trabalhando para estendê-la. Se dois nós transmitirem simultaneamente diferentes versões do próximo bloco, alguns nós podem receber um ou o outro primeiro. Nesse caso, eles trabalham com o primeiro bloco que eles receberam, mas salvam o outro ramo, para caso ele venha a se tornar mais longo. O empate será quebrado quando a próxima prova-de-trabalho for encontrada e um ramo se tornar mais longo; os nós que estavam trabalhando no outro ramo, então, mudarão para o mais longo.</p>
</div>
<div class="paragraph data-line-1191">
<p>As transmissões das novas transações não precisam necessariamente alcançar todos os nós. Contanto que elas atinjam muitos nós, elas brevemente entrarão em um bloco. As transmissões de bloco também são tolerantes com mensagens perdidas. Se um nó não recebe um bloco, ele irá solicitá-lo quando receber o próximo bloco e perceber que está com um bloco em falta.</p>
</div>
<div class="paragraph data-line-1193">
<p>==== Incentivo
Por convenção, a primeira transação de um bloco é uma transação especial que inicia uma nova moeda que pertence ao criador do bloco. Isso gera um incentivo para que os nós apoiem a rede, e serve como uma maneira para colocar as moedas em circulação, uma vez que não existe uma autoridade central para emiti-las. A adição estável de uma quantidade constante de novas moedas é análoga a garimpeiros consumindo recursos para colocar mais ouro em circulação. No nosso caso, o que está sendo consumido é tempo de processamento computacional e eletricidade.</p>
</div>
<div class="paragraph data-line-1196">
<p>O incentivo também pode ser financiado com taxas de transação. Se o valor de saída de uma transação for menor do que o valor de entrada da transação, a diferença é uma taxa de transação que é adicionada ao valor do incentivo do bloco que contém a transação. Assim que um número predeterminado de moedas já tiver entrado em circulação, o incentivo pode gradualmente passar a ser composto apenas pelas taxas de transação, sendo completamente livre de inflação.</p>
</div>
<div class="paragraph data-line-1198">
<p>O incentivo deve ajudar a encorajar os nós a se manterem honestos. Se um atacante ganancioso for capaz de reunir mais poder computacional do que todos os nós honestos, ele teria que escolher entre usá-lo para defraudar as pessoas ao roubar seus pagamentos de volta, ou usá-lo para gerar novas moedas. Ele deveria achar que é mais lucrativo jogar de acordo com as regras, que lhe favorecem ao obter um número maior de novas moedas do que todos os outros participantes combinados obtêm, do que prejudicar o sistema e a validade de sua própria riqueza.</p>
</div>
<div class="paragraph data-line-1200">
<p>==== Recuperação do Espaço em Disco</p>
</div>
<p>Assim que a transação mais recente em uma moeda estiver enterrada sob blocos suficientes, as transações gastas anteriormente podem ser descartadas para economizar espaço em disco. Para facilitar isso sem quebrar o hash do bloco, as transações são transformadas em hashes que formam uma Árvore de Merkle <a href="#ref_seven">[7]</a> <a href="#ref_two">[2]</a> <a href="#ref_five">[5]</a>, da qual apenas a raiz é incluída no hash do bloco. Blocos antigos podem então ser compactados ao se remover ramos da árvore. Os hashes internos não precisam ser armazenados.</p>
<div class="imageblock data-line-1206">
<div class="content">
<img src="images/mbc2_abin04.png" alt="disk">
</div>
</div>
<div class="paragraph data-line-1208">
<p>Um cabeçalho de bloco sem nenhuma transação tem cerca de 80 bytes. Se supormos que os blocos são gerados a cada 10 minutos, 80 bytes * 6 * 24 * 365 = 4,2 MB por ano. Com computadores geralmente sendo vendidos com 2 GB de RAM em 2008, e a Lei de Moore prevendo um crescimento de 1,2 GB por ano, o armazenamento não deve ser um problema, mesmo que os cabeçalhos de bloco tenham que ser mantidos em memória.</p>
</div>
<div class="paragraph data-line-1210">
<p>==== Verificação de Pagamento Simplificada
É possível verificar os pagamentos sem executar um nó de rede completo. Um usuário precisa apenas manter uma cópia dos cabeçalhos de bloco da cadeia com a prova-de-trabalho mais longa, que ele pode recuperar consultando os nós da rede até que ele esteja convencido de que tem a cadeia mais longa, e obter o ramo de Merkle ligando a transação ao bloco em que ela está registrada. Ele não consegue verificar a transação por conta própria, mas, ligando-a a um lugar na cadeia, ele consegue ver que um nó da rede a aceitou, e os blocos adicionados depois dela são uma confirmação adicional de que a rede a aceitou.</p>
</div>
<div class="imageblock data-line-1213">
<div class="content">
<img src="images/mbc2_abin05.png" alt="spv">
</div>
</div>
<div class="paragraph data-line-1215">
<p>Como tal, a verificação é confiável contanto que os nós honestos controlem a rede, mas é mais vulnerável se a rede for subjugada por um atacante com maior poder. Embora os nós da rede consigam verificar as transações por si mesmos, o método simplificado pode ser enganado por transações fabricadas de um atacante durante o tempo que o atacante com maior poder conseguir dominar a rede. Uma estratégia para se proteger disso seria aceitar alertas dos nós da rede quando eles detectam um bloco inválido, levando o software do usuário a baixar o bloco completo e as transações alarmadas para confirmar a inconsistência. As empresas que recebem pagamentos frequentes provavelmente desejarão executar seus próprios nós para uma segurança mais independente e uma verificação mais rápida.</p>
</div>
<div class="paragraph data-line-1217">
<p>==== Combinando e Dividindo Valor
Embora poderia ser possível lidar com as moedas individualmente, seria complicado fazer uma transação separada para cada centavo em uma transferência. Para permitir que o valor seja dividido e combinado, as transações contêm múltiplas entradas e saídas. Normalmente haverá ou uma única entrada de uma transação prévia com uma quantia maior, ou várias entradas combinando quantias menores, e no máximo duas saídas: uma para o pagamento e, se houver, uma retornando o troco ao remetente.</p>
</div>
<div class="imageblock data-line-1220">
<div class="content">
<img src="images/mbc2_abin06.png" alt="combining-splitting">
</div>
</div>
<div class="paragraph data-line-1222">
<p>Deve-se notar que a dispersão, quando uma transação depende de várias transações, e essas transações dependem de muitas outras, não representa um problema. Nunca há a necessidade de se extrair uma cópia independente completa do histórico de uma transação.</p>
</div>
<div class="paragraph data-line-1224">
<p>==== Privacidade
O modelo bancário tradicional atinge um nível de privacidade ao limitar o acesso às informaçoes da transação para as partes envolvidas e o terceiro de confiança. A necessidade de se anunciar todas as transações publicamente impossibilita a utilização deste método, mas a privacidade ainda pode ser mantida ao quebrar-se o fluxo de informações em outro ponto: ao manter-se as chaves públicas em anonimato. O público pode ver que alguém está enviando uma quantia para alguma outra pessoa, mas sem informações que vinculam a transação a qualquer indivíduo. Isto é semelhante ao nível de informações divulgadas pelas bolsas de valores, onde o horário e o valor das negociações individuais, a "fita", é tornada pública, mas sem dizer quem foram os participantes das negociações.</p>
</div>
<div class="imageblock data-line-1227">
<div class="content">
<img src="images/mbc2_abin07.png" alt="privacy">
</div>
</div>
<div class="paragraph data-line-1229">
<p>Como uma proteção adicional, um novo par de chaves deve ser utilizado a cada transação, a fim de evitar que elas sejam vinculadas a um dono comum. Algum grau de vinculação ainda é inevitável em transações com múltiplas entradas, que necessariamente revelam que as entradas eram propriedade de um mesmo dono. Existe o risco de que, se o dono de uma chave for revelado, a vinculação poderia revelar outras transações que pertenceram ao mesmo dono.</p>
</div>
<div class="paragraph data-line-1231">
<p>==== Cálculos
Consideramos o cenário de um atacante tentando gerar uma cadeia alternativa mais rápido do que a cadeia honesta. Mesmo que isso seja feito, isso não deixa o sistema aberto a mudanças arbitrárias, como a criação de valor a partir do nada ou a tomada de dinheiro que nunca pertenceu ao atacante. Os nós não aceitarão uma transação inválida como forma de pagamento, e os nós honestos jamais aceitarão um bloco contendo transações inválidas. A única coisa que um atacante pode fazer é tentar alterar uma de suas próprias transações para tomar de volta o dinheiro que ele gastou recentemente.</p>
</div>
<div class="paragraph data-line-1234">
<p>A corrida entre a cadeia honesta e a cadeia de um atacante pode ser caracterizada como uma Caminhada Aleatória Binomial. O evento de sucesso é a cadeia honesta sendo estendida em mais um bloco, aumentando a sua liderança em +1, e o evento de falha é a cadeia do atacante sendo estendida em mais um bloco, reduzindo a diferença entre as cadeias em -1.</p>
</div>
<p>A probabilidade de um atacante recuperar-se de um dado déficit é análogo ao problema da Ruína do Jogador. Suponha que um jogador com crédito ilimitado comece em um déficit (prejuízo) e jogue potencialmente um número infinito de tentativas para tentar atingir o ponto de equilíbrio. Podemos calcular a probabilidade de ele atingir o ponto de equilíbrio, ou de um atacante alcançar a cadeia honesta, da seguinte maneira <a href="#ref_eight">[8]</a>:</p>
<div class="paragraph data-line-1240">
<p>p = probabilidade de um nó honesto encontrar o próximo bloco</p>
</div>
<div class="paragraph data-line-1242">
<p>q = probabilidade de o atacante encontrar o próximo bloco</p>
</div>
<div class="paragraph data-line-1244">
<p>q<sub>z</sub> = probabilidade de o atacante conseguir alcançar a cadeia honesta estando z blocos atrás</p>
</div>
<div class="imageblock data-line-1246">
<div class="content">
<img src="images/mbc2_abin08.png" alt="eq1">
</div>
</div>
<div class="paragraph data-line-1248">
<p>Dada a nossa suposição que p &gt; q, a probabilidade cai exponencialmente à medida que aumenta o número de blocos que o atacante tem que minerar para alcançar a cadeia honesta. Com as probabilidades contra ele, se ele não fizer uma arrancada de sorte logo no início, suas chances se tornam muito pequenas à medida que ele fica mais para trás.</p>
</div>
<div class="paragraph data-line-1250">
<p>Vamos agora considerar quanto tempo o destinatário de uma nova transação precisa esperar antes de ficar suficientemente certo que o remetente não pode mudar a transação. Assumimos que o remetente é um atacante que quer fazer o destinatário acreditar que ele lhe pagou por um determinado momento, e que depois altera a transação para pagar de volta para si mesmo após decorrido um certo período de tempo. O destinatário será alertado quando isso acontecer, mas o remetente espera que o alerta aconteça tarde demais.</p>
</div>
<div class="paragraph data-line-1252">
<p>O destinatário gera um novo par de chaves e dá a chave pública para o remetente, pouco antes de assinar. Isso previne que o remetente prepare uma cadeia de blocos antes do tempo, ao trabalhar de forma contínua até que tenha a sorte de chegar à frente suficientemente, e depois executando a transação naquele momento. Uma vez que a transação é enviada, o remetente desonesto começa a trabalhar em segredo em uma cadeia paralela contendo uma versão alternativa de sua transação.</p>
</div>
<div class="paragraph data-line-1254">
<p>O destinatário espera até que a transação tenha sido adicionada a um bloco e z blocos sejam ligados depois desse bloco. Ele não sabe a quantidade exata de progresso do atacante, mas assumindo que os blocos honestos levaram o tempo médio esperado por bloco, o progresso potencial do atacante será uma distribuição de Poisson com valor esperado:</p>
</div>
<div class="imageblock data-line-1256">
<div class="content">
<img src="images/mbc2_abin09.png" alt="eq2">
</div>
</div>
<div class="paragraph data-line-1258">
<p>Para obter a probabilidade atual de o atacante ainda poder alcançar a cadeia honesta, multiplicamos a densidade de Poisson para cada quantidade de progresso que ele poderia ter feito pela probabilidade de ele alcançar a cadeia honesta a partir daquele ponto:</p>
</div>
<div class="imageblock data-line-1260">
<div class="content">
<img src="images/mbc2_abin10.png" alt="eq3">
</div>
</div>
<div class="paragraph data-line-1262">
<p>Rearranjando para evitar a soma da cauda infinita da distribuição&#8230;&#8203;</p>
</div>
<div class="imageblock data-line-1264">
<div class="content">
<img src="images/mbc2_abin11.png" alt="eq4">
</div>
</div>
<div class="paragraph data-line-1266">
<p>Convertendo para código C&#8230;&#8203;</p>
</div>
<div class="listingblock data-line-1269">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">#include &lt;math.h&gt;
double ProbabilidadeDeSucessoDoAtacante(double q, int z)
{
    double p = 1.0 - q;
    double lambda = z * (q / p);
    double sum = 1.0;
    int i, k;
    for (k = 0; k &lt;= z; k++)
    {
        double poisson = exp(-lambda);
        for (i = 1; i &lt;= k; i++)
            poisson *= lambda / i;
        sum -= poisson * (1 - pow(q / p, z - k));
    }
    return sum;
}</code></pre>
</div>
</div>
<div class="paragraph data-line-1288">
<p>Rodando alguns resultados, podemos ver a probabilidade cair exponencialmente conforme o z aumenta.</p>
</div>
<div class="listingblock data-line-1289">
<div class="content">
<pre>q=0.1
z=0  P=1.0000000
z=1  P=0.2045873
z=2  P=0.0509779
z=3  P=0.0131722
z=4  P=0.0034552
z=5  P=0.0009137
z=6  P=0.0002428
z=7  P=0.0000647
z=8  P=0.0000173
z=9  P=0.0000046
z=10 P=0.0000012</pre>
</div>
</div>
<div class="listingblock data-line-1303">
<div class="content">
<pre>q=0.3
z=0  P=1.0000000
z=5  P=0.1773523
z=10 P=0.0416605
z=15 P=0.0101008
z=20 P=0.0024804
z=25 P=0.0006132
z=30 P=0.0001522
z=35 P=0.0000379
z=40 P=0.0000095
z=45 P=0.0000024
z=50 P=0.0000006</pre>
</div>
</div>
<div class="paragraph data-line-1317">
<p>Resolvendo para P menor que 0,1%&#8230;&#8203;</p>
</div>
<div class="listingblock data-line-1318">
<div class="content">
<pre>P &lt; 0.001
q=0.10 z=5
q=0.15 z=8
q=0.20 z=11
q=0.25 z=15
q=0.30 z=24
q=0.35 z=41
q=0.40 z=89
q=0.45 z=340</pre>
</div>
</div>
<div class="paragraph data-line-1330">
<p>==== Conclusão
Propusemos um sistema para transações eletrônicas que não depende de confiança. Começamos com o framework habitual de moedas feitas a partir de assinaturas digitais, que fornece um forte controle de posse, mas é incompleto sem que haja uma maneira de evitar o gasto duplo. Para resolver isso, propusemos uma rede par-a-par (<em>peer-to-peer</em>) usando prova-de-trabalho para registrar um histórico público de transações que rapidamente se torna computacionalmente impraticável de ser alterado por um atacante, caso os nós honestos controlem a maior parte do poder computacional. A rede é robusta em sua simplicidade não estruturada. Os nós trabalham todos de uma vez, com pouca coordenação. Eles não precisam ser identificados, uma vez que as mensagens não são roteadas para nenhum lugar em particular e só precisam ser entregues em regime de melhor esforço. Os nós podem sair e voltar à rede à vontade, aceitando a cadeia de prova-de-trabalho como prova do que aconteceu enquanto eles estiveram fora. Eles votam com seu poder computacional, expressando a sua aceitação dos blocos válidos ao trabalharem para estendê-los e rejeitando os blocos inválidos ao recusarem-se a trabalhar com eles. Quaisquer regras e incentivos necessários podem ser aplicados com este mecanismo de consenso.</p>
</div>
<div class="paragraph data-line-1333">
<p>==== Referências</p>
</div>
<p>
<span id="ref_one">[1]</span> W. Dai, "b-money," <a href="http://www.weidai.com/bmoney.txt"><em>http://www.weidai.com/bmoney.txt</em></a>, 1998.
</p>
<p>
<span id="ref_two">[2]</span> H. Massias, X.S. Avila, and J.-J. Quisquater, "Design of a secure timestamping service with minimal trust requirements," no 20th Symposium on Information Theory in the Benelux, maio de 1999.
</p>
<p>
<span id="ref_three">[3]</span> S. Haber, W.S. Stornetta, "How to time-stamp a digital document," em Journal of Cryptology, vol. 3, nº2, páginas 99-111, 1991.
</p>

<p>
<span id="ref_four">[4]</span> D. Bayer, S. Haber, W.S. Stornetta, "Improving the efficiency and reliability of digital time-stamping," em Sequences II: Methods in Communication, Security and Computer Science, páginas 329-334, 1993.
</p>

<p>
<span id="ref_five">[5]</span> S. Haber, W.S. Stornetta, "Secure names for bit-strings," em Proceedings of the 4th ACM Conference on Computer and Communications Security, páginas 28-35, abril de 1997.
</p>

<p>
<span id="ref_six">[6]</span> A. Back, "Hashcash - a denial of service counter-measure," <a href="http://www.hashcash.org/papers/hashcash.pdf"><em>http://www.hashcash.org/papers/hashcash.pdf</em></a>, 2002.
</p>

<p>
<span id="ref_seven">[7]</span> R.C. Merkle, "Protocols for public key cryptosystems," em Proc. 1980 Symposium on Security and Privacy, IEEE Computer Society, páginas 122-133, abril de 1980.
</p>

<p>
<span id="ref_eight">[8]</span> W. Feller, "An introduction to probability theory and its applications," 1957.
</p>
<div class="paragraph data-line-1366">
<p>=== Licença</p>
</div>
<div class="paragraph data-line-1368">
<p>Este whitepaper foi publicado em outubro de 2008 por Satoshi Nakamoto. Mais tarde (em 2009) ele foi adicionado como um documento de suporte no software do bitcoin, que carrega a mesma licença MIT. Ele foi reproduzido nesse livro, sem modificações além de formatações, sob os termos da licença MIT:</p>
</div>
<div class="paragraph data-line-1370">
<p>A Licença MIT (MIT)
Copyright (c) 2008 Satoshi Nakamoto</p>
</div>
<div class="paragraph data-line-1373">
<p>É concedida permissão gratuita a qualquer pessoa que adquira uma cópia desse software e dos arquivos de documentação associados (o "Software"), para utilizar o Software sem restrição, incluindo, entre outros, o direito de utilizar, copiar, modificar, mesclar, publicar, distribuir, sublicenciar e/ou vender cópias do Software, e de permitir que as pessoas às quais o Software é fornecido o façam, de acordo com as seguintes condições:</p>
</div>
<div class="paragraph data-line-1375">
<p>O aviso de direitos autorais acima e este aviso de permissão deverá ser incluído em todas as cópias e partes materiais do Software.</p>
</div>
<div class="paragraph data-line-1377">
<p>O SOFTWARE É FORNECIDO "NO ESTADO EM QUE SE ENCONTRA", SEM NENHUMA GARANTIA, EXPLÍCITA OU IMPLÍCITA, INCLUINDO, ENTRE OUTRAS, GARANTIAS DE COMERCIALIZAÇÃO, NÃO VIOLAÇÃO E ADEQUAÇÃO A UMA FINALIDADE ESPECÍFICA. EM NENHUMA HIPÓTESE, OS AUTORES OU DETENTORES DOS DIREITOS AUTORAIS SERÃO LEGALMENTE RESPONSÁVEIS POR QUALQUER REIVINDICAÇÃO, INDENIZAÇÃO OU OBRIGAÇÕES, EM UMA AÇÃO DE CONTRATO, RESPONSABILIDADE CIVIL OU DE OUTRO MODO, ORIUNDA, DECORRENTE DE OU RELACIONADA AO SOFTWARE, AO USO OU A OUTRAS OPERAÇÕES COM O SOFTWARE.</p>
</div>
<div id="tx_script_ops" class="paragraph data-line-1381">
<p>== Operadores de Linguagem, Constantes e Símbolos de Script de Transação</p>
</div>
<div class="admonitionblock note data-line-1384">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-1385">
<p>Tabelas e descrições provenientes de <a href="https://en.bitcoin.it/wiki/Script" class="undefined" data-href="https://en.bitcoin.it/wiki/Script">https://en.bitcoin.it/wiki/Script</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1388">
<p>A <a href="#tx_script_ops_table_pushdata">Operadores que adicionam valores no stack</a> mostra os operadores usados para adicionar valores no stack.</p>
</div>
<table id="tx_script_ops_table_pushdata" class="tableblock frame-all grid-all stretch data-line-1393">
<caption class="title">Table 30. Operadores que adicionam valores no stack</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Símbolo</th>
<th class="tableblock halign-left valign-top">Valor (hex)</th>
<th class="tableblock halign-left valign-top">Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_0 ou OP_FALSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Um array vazio é adicionado no stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 a 75</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01 a 0x4b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adiciona os próximos N bytes no stack, onde N tem de 1 a 75 bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_PUSHDATA1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x4c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O próximo byte do script contém N, adiciona os próximos N bytes no stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_PUSHDATA2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x4d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Os próximos dois bytes do script contêm N, adiciona os próximos N bytes no stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_PUSHDATA4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x4e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Os próximos quatro bytes do script contêm N, adiciona os próximos N bytes no stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_1NEGATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x4f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adiciona o valor "–1" no stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_RESERVED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x50</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suspende&#x2014;Transação inválida, a menos que seja encontrado em uma cláusula OP_IF não executada</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_1 ou OP_TRUE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x51</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adiciona o valor "1" no stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_2 a OP_16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x52 a 0x60</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Para OP_N, adiciona o valor "N" no stack, por exemplo, OP_2 adiciona "2" no stack</p></td>
</tr>
</tbody>
</table>
<div class="paragraph pagebreak-before data-line-1407">
<p>A <a href="#tx_script_ops_table_control">Operadores de controle de fluxo condicional</a> mostra os operadores de controle de fluxo condicional.</p>
</div>
<table id="tx_script_ops_table_control" class="tableblock frame-all grid-all stretch data-line-1412">
<caption class="title">Table 31. Operadores de controle de fluxo condicional</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Símbolo</th>
<th class="tableblock halign-left valign-top">Valor (hex)</th>
<th class="tableblock halign-left valign-top">Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_NOP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x61</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Não faz nada</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_VER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x62</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suspende&#x2014;Transação inválida, a menos que seja encontrado em uma cláusula OP_IF não executada</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_IF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x63</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executa as declarações a seguir se o topo do stack não for 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_NOTIF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executa as declarações a seguir se o topo do stack for 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_VERIF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x65</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suspende&#x2014;Transação inválida</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_VERNOTIF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x66</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suspende&#x2014;Transação inválida</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_ELSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x67</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executa apenas se as declarações anteriores não foram executadas</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_ENDIF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x68</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Termina o bloco OP_IF, OP_NOTIF, OP_ELSE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_VERIFY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x69</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verifica o topo do stack, suspende e invalida a transação se não for TRUE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_RETURN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x6a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suspende e invalida a transação</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-1426">
<p>A <a href="#tx_script_ops_table_timelock">Operações de timelock</a> mostra os operadores usados para timelocks.</p>
</div>
<table id="tx_script_ops_table_timelock" class="tableblock frame-all grid-all stretch data-line-1431">
<caption class="title">Table 32. Operações de timelock</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Símbolo</th>
<th class="tableblock halign-left valign-top">Valor (hex)</th>
<th class="tableblock halign-left valign-top">Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_CHECKLOCKTIMEVERIFY (antigamente OP_NOP2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marca uma transação como inválida se o item do topo do stack for maior do que o campo nLockTime da transação, caso contrário, a avaliação do script continua como se um OP_NOP tivesse sido executado. A transação é também inválida se 1. o stack estiver vazio; ou 2. o item no topo do stack for negativo; ou 3. o item no topo do stack for maior ou igual a 500000000 enquanto o campo nLockTime da transação for menor do que 500000000, ou vice-versa; ou 4. o campo nSequence da entrada for igual a 0xffffffff. A semântica precisa é descrita na BIP-65</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_CHECKSEQUENCEVERIFY (antigamente OP_NOP3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marca a transação como inválida se o tempo de travamento relativo da entrada (imposto pela BIP-68 através do nSequence) não for igual ou maior do que o valor do item no topo do stack. A semântica precisa é descrita na BIP-112</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-1437">
<p>A <a href="#tx_script_ops_table_stack">Operações de stack</a> mostra os operadores usados para manipular o stack.</p>
</div>
<table id="tx_script_ops_table_stack" class="tableblock frame-all grid-all stretch data-line-1442">
<caption class="title">Table 33. Operações de stack</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Símbolo</th>
<th class="tableblock halign-left valign-top">Valor (hex)</th>
<th class="tableblock halign-left valign-top">Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_TOALTSTACK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x6b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove o item do topo do stack e o adiciona no stack alternativo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_FROMALTSTACK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x6c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove o item do topo do stack alternativo e o adiciona no stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_2DROP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x6d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove os dois itens do topo do stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_2DUP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x6e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplica os dois itens no topo do stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_3DUP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x6f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplica os três itens no topo do stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_2OVER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x70</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copia o terceiro e o quarto itens do stack para o topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_2ROT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x71</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Move o quinto e o sexto itens do stack para o topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_2SWAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x72</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permuta os dois pares de itens no topo do stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_IFDUP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x73</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplica o item no topo do stack se ele não for 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_DEPTH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x74</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conta os itens no stack e adiciona o resultado da contagem</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_DROP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x75</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove o item do topo do stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_DUP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x76</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplica o item no topo do stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_NIP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x77</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove o segundo item do stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_OVER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x78</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copia o segundo item do stack para o topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_PICK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x79</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove o valor N do topo, e depois copia o enésimo (Nº) item para o topo do stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_ROLL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove o valor N do topo, e depois move o enésimo (Nº) item para o topo do stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_ROT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inverte os três itens do topo do stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_SWAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permuta os dois itens do topo do stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_TUCK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copia o item do topo do stack e o insere entre o item do topo e o segundo item</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-1465">
<p>A <a href="#tx_script_ops_table_splice">Operações com pedaços de string</a> mostra os operadores de <em>string</em>.</p>
</div>
<table id="tx_script_ops_table_splice" class="tableblock frame-all grid-all stretch data-line-1470">
<caption class="title">Table 34. Operações com pedaços de string</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Símbolo</th>
<th class="tableblock halign-left valign-top">Valor (hex)</th>
<th class="tableblock halign-left valign-top">Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_CAT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desativado (concatena os dois itens do topo)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_SUBSTR</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desativado (retorna a <em>substring</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_LEFT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desativado (retorna a <em>substring</em> à esquerda)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_RIGHT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x81</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desativado (retorna a <em>substring</em> à direita)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_SIZE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x82</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Calcula o comprimento da <em>string</em> do item do topo do stack e adiciona o resultado no stack</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-1479">
<p>A <a href="#tx_script_ops_table_binmath">Operadores de aritmética binária e condicionais</a> mostra os operadores de aritmética binária e de lógica booleana.</p>
</div>
<table id="tx_script_ops_table_binmath" class="tableblock frame-all grid-all stretch data-line-1484">
<caption class="title">Table 35. Operadores de aritmética binária e condicionais</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Símbolo</th>
<th class="tableblock halign-left valign-top">Valor (hex)</th>
<th class="tableblock halign-left valign-top">Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_INVERT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x83</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desativado (inverte os bits do item do topo)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_AND</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x84</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desativado (booleano AND dos dois itens do topo)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_OR</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x85</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desativado (booleano OR dos dois itens do topo)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_XOR</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x86</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desativado (booleano XOR dos dois itens do topo)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_EQUAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x87</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adiciona TRUE (1) se os dois itens do topo forem exatamente iguais, caso contrário adiciona FALSE (0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_EQUALVERIFY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x88</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O mesmo que o OP_EQUAL, mas depois executa o OP_VERIFY após para suspender se não for TRUE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_RESERVED1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x89</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suspende&#x2014;Transação inválida, a menos que seja encontrado em uma cláusula OP_IF não executada</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_RESERVED2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x8a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suspende&#x2014;Transação inválida, a menos que seja encontrado em uma cláusula OP_IF não executada</p></td>
</tr>
</tbody>
</table>
<div class="paragraph pagebreak-before data-line-1497">
<p>A <a href="#tx_script_ops_table_numbers">Operadores numéricos</a> mostra os operadores numéricos (aritméticos).</p>
</div>
<table id="tx_script_ops_table_numbers" class="tableblock frame-all grid-all stretch data-line-1502">
<caption class="title">Table 36. Operadores numéricos</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Símbolo</th>
<th class="tableblock halign-left valign-top">Valor (hex)</th>
<th class="tableblock halign-left valign-top">Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_1ADD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x8b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Soma 1 ao item do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_1SUB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x8c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subtrai 1 do item do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_2MUL</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x8d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desativado (multiplica o item do topo por 2)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_2DIV</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x8e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desativado (divide o item do topo por 2)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_NEGATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x8f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inverte o sinal do item do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_ABS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x90</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Muda o sinal do item do topo para positivo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_NOT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x91</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Se o item do topo for 0 ou 1 Booleano, inverte-o, caso contrário retorna 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_0NOTEQUAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x92</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Se o item do topo for 0, retorna 0, caso contrário retorna 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_ADD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x93</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove os dois itens do topo, soma-os e adiciona o resultado</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_SUB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x94</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove os dois itens do topo, subtrai o primeiro do segundo e adiciona o resultado</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_MUL</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x95</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desativado (multiplica os dois itens do topo)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_DIV</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desativado (divide o segundo item pelo primeiro item)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_MOD</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x97</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desativado (restante divide o segundo item pelo primeiro item)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_LSHIFT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x98</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desativado (desloca o segundo item à esquerda pelo número de bits do primeiro item)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OP_RSHIFT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x99</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desativado (desloca o segundo item à direita pelo número de bits do primeiro item)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_BOOLAND</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x9a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Booleano AND dos dois itens do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_BOOLOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x9b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Booleano OR dos dois itens do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_NUMEQUAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x9c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retorna TRUE se os dois itens do topo forem números iguais</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_NUMEQUALVERIFY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x9d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O mesmo que o NUMEQUAL, mas depois executa o OP_VERIFY para suspender se não for TRUE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_NUMNOTEQUAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x9e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retorna TRUE se os dois itens do topo não forem números iguais</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_LESSTHAN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x9f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retorna TRUE se o segundo item for menor que o item do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_GREATERTHAN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retorna TRUE se o segundo item for maior do que o item do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_LESSTHANOREQUAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retorna TRUE se o segundo item for menor ou igual ao item do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_GREATERTHANOREQUAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retorna TRUE se o segundo item for maior ou igual ao item do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_MIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retorna o menor dos dois itens do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retorna o maior dos dois itens do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_WITHIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retorna TRUE se o terceiro item estiver entre o segundo item (ou for igual) e o primeiro item</p></td>
</tr>
</tbody>
</table>
<div class="paragraph pagebreak-before data-line-1534">
<p>A <a href="#tx_script_ops_table_crypto">Operações criptográficas e de hashing</a> mostra os operadores de funções criptográficas.</p>
</div>
<table id="tx_script_ops_table_crypto" class="tableblock frame-all grid-all stretch data-line-1539">
<caption class="title">Table 37. Operações criptográficas e de hashing</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Símbolo</th>
<th class="tableblock halign-left valign-top">Valor (hex)</th>
<th class="tableblock halign-left valign-top">Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_RIPEMD160</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retorna o hash RIPEMD160 do item do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_SHA1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retorna o hash SHA1 do item do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_SHA256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retorna o hash SHA256 do item do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_HASH160</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xa9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retorna o hash RIPEMD160(SHA256(x)) do item do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_HASH256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xaa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retorna o hash SHA256(SHA256(x)) do item do topo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_CODESEPARATOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xab</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marca o início dos dados verificados pela assinatura</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_CHECKSIG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xac</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove uma chave pública e a assinatura, valida a assinatura para os dados da transação transformados em hash, retorna TRUE se corresponde</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_CHECKSIGVERIFY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xad</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O mesmo que o CHECKSIG, mas depois executa o OP_VERIFY para suspender se não for TRUE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_CHECKMULTISIG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xae</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executa o CHECKSIG para cada par de assinatura e chave pública fornecido. Todos devem corresponder. Um bug na implementação remove um valor extra, para contorná-lo, usa-se prefixo com OP_0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_CHECKMULTISIGVERIFY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xaf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O mesmo que o CHECKMULTISIG, mas depois executa o OP_VERIFY para suspender se não for TRUE</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-1553">
<p>A <a href="#tx_script_ops_table_nop">Não operadores</a> mostra os símbolos não operadores.</p>
</div>
<table id="tx_script_ops_table_nop" class="tableblock frame-all grid-all stretch data-line-1558">
<caption class="title">Table 38. Não operadores</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Símbolo</th>
<th class="tableblock halign-left valign-top">Valor (hex)</th>
<th class="tableblock halign-left valign-top">Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_NOP1 a OP_NOP10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb0 a 0xb9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Não faz nada, é ignorado</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-1564">
<p>A <a href="#tx_script_ops_table_internal">Códigos OP reservados para uso interno pelo analisador sintático</a> mostra os códigos de operador reservados para serem usados pelo analisador sintático interno de script.</p>
</div>
<table id="tx_script_ops_table_internal" class="tableblock frame-all grid-all stretch data-line-1569">
<caption class="title">Table 39. Códigos OP reservados para uso interno pelo analisador sintático</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Símbolo</th>
<th class="tableblock halign-left valign-top">Valor (hex)</th>
<th class="tableblock halign-left valign-top">Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_SMALLDATA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Representa um campo de dados pequeno</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_SMALLINTEGER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xfa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Representa um campo de dados numéricos pequeno</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_PUBKEYS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xfb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Representa os campos de chave pública</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_PUBKEYHASH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xfd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Representa um campo de hash da chave pública</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_PUBKEY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xfe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Representa um campo de chave pública</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_INVALIDOPCODE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xff</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Representa qualquer código OP que não está atualmente designado</p></td>
</tr>
</tbody>
</table>
<div id="appdxbitcoinimpproposals" class="paragraph data-line-1581">
<p>== Propostas de Melhoria ao Bitcoin</p>
</div>
<div class="paragraph data-line-1583">
<p>As Propostas de Melhoria ao Bitcoin (em inglês, <em>Bitcoin Improvement Proposals</em> ou BIPs) são documentos de design que fornecem informações para a comunidade do bitcoin, ou que são usados para descrever um novo recurso para o bitcoin, ou para descrever seus processos ou ambiente.</p>
</div>
<div class="paragraph data-line-1585">
<p>De acordo com a BIP-01 <em>Propósito e Diretrizes das BIPs</em>, existem três tipos de BIPs:</p>
</div>
<div class="dlist data-line-1587">
<dl>
<dt class="hdlist1">BIP <em>Padrão</em> (Standard)</dt>
<dd>
<p>Descreve qualquer mudança que afete a maioria ou a totalidade das implementações do bitcoin, tais como uma mudança no protocolo da rede, uma mudança nas regras de validação de transações e blocos ou qualquer mudança ou adição que afete a interoperabilidade de aplicativos usando bitcoin.</p>
</dd>
<dt class="hdlist1">BIP <em>Informativa</em></dt>
<dd>
<p>Descreve uma questão relacionada ao design do bitcoin ou fornece orientações gerais/informações para a comunidade do bitcoin, mas não propõe uma nova funcionalidade. As BIPs informativas não necessariamente representam um consenso ou uma recomendação da comunidade do bitcoin, de forma que usuários e implementadores podem ignorar ou seguir as orientações dessas BIPs.</p>
</dd>
<dt class="hdlist1"><em>Process</em> BIP</dt>
<dd>
<p>Describes a bitcoin process, or proposes a change to (or an event in) a process. Process BIPs are like standard BIPs but apply to areas other than the Bitcoin protocol itself. They might propose an implementation, but not to bitcoin&#8217;s codebase; they often require community consensus; and unlike informational BIPs, they are more than recommendations, and users are typically not free to ignore them. Examples include procedures, guidelines, changes to the decision-making process, and changes to the tools or environment used in bitcoin development. Any meta-BIP is also considered a process BIP.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-1591">
<p>As BIPs são registradas em um repositório versionado do GitHub: <a href="https://github.com/bitcoin/bips" data-href="https://github.com/bitcoin/bips">https://github.com/bitcoin/bips</a> . A <a href="#table_d-1">Lista das BIPs</a> mostra uma listagem do estado das BIPs em abril de 2017. Consulte o repositório oficial para obter informações atualizadas sobre as BIPs existentes e seus conteúdos.</p>
</div>
<table id="table_d-1" class="tableblock frame-all grid-all stretch data-line-1596">
<caption class="title">Table 40. Lista das BIPs</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Número</th>
<th class="tableblock halign-left valign-top">Título</th>
<th class="tableblock halign-left valign-top">Autor</th>
<th class="tableblock halign-left valign-top">Tipo</th>
<th class="tableblock halign-left valign-top">Status</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-1"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0001.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0001.mediawiki">BIP-1</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BIP Purpose and Guidelines</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amir Taaki</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Substituída</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-2"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0002.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0002.mediawiki">BIP-2</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BIP process, revised</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Luke Dashjr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ativa</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-8"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0008.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0008.mediawiki">BIP-8</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version bits with guaranteed lock-in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shaolin Fry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informativa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-9"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0009.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0009.mediawiki">BIP-9</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version bits with timeout and delay</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pieter Wuille, Peter Todd, Greg Maxwell, Rusty Russell</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informativa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concluída</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-10"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0010.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0010.mediawiki">BIP-10</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multi-Sig Transaction Distribution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alan Reiner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informativa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removida</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-11"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0011.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0011.mediawiki">BIP-11</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">M-of-N Standard Transactions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concluída</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-12"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0012.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0012.mediawiki">BIP-12</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_EVAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removida</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-13"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0013.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0013.mediawiki">BIP-13</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address Format for pay-to-script-hash</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concluída</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-14"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0014.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0014.mediawiki">BIP-14</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Protocol Version and User Agent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amir Taaki, Patrick Strateman</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concluída</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-15"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0015.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0015.mediawiki">BIP-15</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aliases</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amir Taaki</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adiada</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-16"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0016.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0016.mediawiki">BIP-16</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pay to Script Hash</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concluída</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-17"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0017.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0017.mediawiki">BIP-17</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_CHECKHASHVERIFY (CHV)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Luke Dashjr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removida</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-18"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0018.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0018.mediawiki">BIP-18</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hashScriptCheck</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Luke Dashjr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proposta</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-19"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0019.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0019.mediawiki">BIP-19</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">M-of-N Standard Transactions (Low SigOp)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Luke Dashjr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-20"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0020.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0020.mediawiki">BIP-20</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URI Scheme</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Luke Dashjr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Substituída</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-21"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0021.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0021.mediawiki">BIP-21</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URI Scheme</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nils Schneider, Matt Corallo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concluída</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-22"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0022.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0022.mediawiki">BIP-22</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">getblocktemplate - Fundamentals</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Luke Dashjr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concluída</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-23"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0023.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0023.mediawiki">BIP-23</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">getblocktemplate - Pooled Mining</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Luke Dashjr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concluída</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-30"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0030.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0030.mediawiki">BIP-30</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate transactions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pieter Wuille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concluída</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-31"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0031.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0031.mediawiki">BIP-31</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pong message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mike Hearn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concluída</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-32"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki">BIP-32</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hierarchical Deterministic Wallets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pieter Wuille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informativa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concluída</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-33"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0033.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0033.mediawiki">BIP-33</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stratized Nodes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amir Taaki</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-34"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0034.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0034.mediawiki">BIP-34</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block v2, Height in Coinbase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concluída</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-35"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0035.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0035.mediawiki">BIP-35</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mempool message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jeff Garzik</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concluída</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-36"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0036.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0036.mediawiki">BIP-36</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom Services</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stefan Thomas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-37"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0037.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0037.mediawiki">BIP-37</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection Bloom filtering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mike Hearn, Matt Corallo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concluída</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-39"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki">BIP-39</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mnemonic code for generating deterministic keys</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marek Palatinus, Pavol Rusnak, Aaron Voisine, Sean Bowe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proposta</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-40"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0040.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0040.mediawiki">BIP-40</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stratum wire protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marek Palatinus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nº BIP alocado</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-41"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0041.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0041.mediawiki">BIP-41</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stratum mining protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marek Palatinus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nº BIP alocado</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-42"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0042.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0042.mediawiki">BIP-42</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A finite monetary supply for Bitcoin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pieter Wuille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-43"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0043.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0043.mediawiki">BIP-43</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Purpose Field for Deterministic Wallets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marek Palatinus, Pavol Rusnak</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informativa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-44"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki">BIP-44</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multi-Account Hierarchy for Deterministic Wallets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marek Palatinus, Pavol Rusnak</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proposta</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-45"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0045.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0045.mediawiki">BIP-45</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Structure for Deterministic P2SH Multisignature Wallets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manuel Araoz, Ryan X. Charles, Matias Alejo Garcia</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proposta</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-47"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0047.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0047.mediawiki">BIP-47</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reusable Payment Codes for Hierarchical Deterministic Wallets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Justus Ranvier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informativa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-49"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0049.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0049.mediawiki">BIP-49</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Derivation scheme for P2WPKH-nested-in-P2SH based accounts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Daniel Weigl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informativa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-50"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0050.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0050.mediawiki">BIP-50</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">March 2013 Chain Fork Post-Mortem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informativa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concluída</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-60"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0060.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0060.mediawiki">BIP-60</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fixed Length "version" Message (Relay-Transactions Field)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amir Taaki</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-61"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0061.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0061.mediawiki">BIP-61</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reject P2P message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concluída</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-62"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0062.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0062.mediawiki">BIP-62</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dealing with malleability</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pieter Wuille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removida</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-63"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0063.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0063.mediawiki">BIP-63</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stealth Addresses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Peter Todd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nº BIP alocado</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-64"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0064.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0064.mediawiki">BIP-64</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">getutxo message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mike Hearn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-65"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0065.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0065.mediawiki">BIP-65</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OP_CHECKLOCKTIMEVERIFY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Peter Todd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concluída</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-66"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0066.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0066.mediawiki">BIP-66</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strict DER signatures</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pieter Wuille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concluída</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-67"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0067.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0067.mediawiki">BIP-67</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deterministic Pay-to-script-hash multi-signature addresses through public key sorting</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Thomas Kerin, Jean-Pierre Rupp, Ruben de Vries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proposta</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-68"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0068.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0068.mediawiki">BIP-68</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Relative lock-time using consensus-enforced sequence numbers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark Friedenbach, BtcDrak, Nicolas Dorier, kinoshitajona</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concluída</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-69"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0069.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0069.mediawiki">BIP-69</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lexicographical Indexing of Transaction Inputs and Outputs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kristov Atlas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informativa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proposta</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-70"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0070.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0070.mediawiki">BIP-70</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Payment Protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen, Mike Hearn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concluída</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-71"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0071.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0071.mediawiki">BIP-71</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Payment Protocol MIME types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concluída</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-72"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0072.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0072.mediawiki">BIP-72</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bitcoin: uri extensions for Payment Protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concluída</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-73"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0073.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0073.mediawiki">BIP-73</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use "Accept" header for response type negotiation with Payment Request URLs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stephen Pair</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concluída</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-74"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0074.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0074.mediawiki">BIP-74</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow zero value OP_RETURN in Payment Protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Toby Padilla</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-75"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0075.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0075.mediawiki">BIP-75</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Out of Band Address Exchange using Payment Protocol Encryption</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Justin Newton, Matt David, Aaron Voisine, James MacWhyte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-80"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0080.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0080.mediawiki">BIP-80</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hierarchy for Non-Colored Voting Pool Deterministic Multisig Wallets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Justus Ranvier, Jimmy Song</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informativa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adiada</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-81"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0081.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0081.mediawiki">BIP-81</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hierarchy for Colored Voting Pool Deterministic Multisig Wallets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Justus Ranvier, Jimmy Song</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informativa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adiada</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-83"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0083.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0083.mediawiki">BIP-83</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dynamic Hierarchical Deterministic Key Trees</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eric Lombrozo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-90"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0090.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0090.mediawiki">BIP-90</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Buried Deployments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suhas Daftuar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informativa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-99"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0099.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0099.mediawiki">BIP-99</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Motivation and deployment of consensus rule changes ([soft/hard]forks)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jorge Timón</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informativa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-101"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0101.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0101.mediawiki">BIP-101</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Increase maximum block size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removida</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-102"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0102.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0102.mediawiki">BIP-102</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block size increase to 2MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jeff Garzik</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-103"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0103.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0103.mediawiki">BIP-103</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block size following technological growth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pieter Wuille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-104"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0104.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0104.mediawiki">BIP-104</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Block75' - Max block size like difficulty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">t.khan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-105"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0105.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0105.mediawiki">BIP-105</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Consensus based block size retargeting algorithm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BtcDrak</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-106"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0106.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0106.mediawiki">BIP-106</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dynamically Controlled Bitcoin Block Size Max Cap</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Upal Chakraborty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-107"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0107.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0107.mediawiki">BIP-107</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dynamic limit on the block size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Washington Y. Sanchez</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-109"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0109.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0109.mediawiki">BIP-109</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Two million byte size limit with sigop and sighash limits</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gavin Andresen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rejeitada</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-111"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0111.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0111.mediawiki">BIP-111</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NODE_BLOOM service bit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matt Corallo, Peter Todd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proposta</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-112"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0112.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0112.mediawiki">BIP-112</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CHECKSEQUENCEVERIFY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BtcDrak, Mark Friedenbach, Eric Lombrozo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concluída</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-113"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0113.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0113.mediawiki">BIP-113</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Median time-past as endpoint for lock-time calculations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Thomas Kerin, Mark Friedenbach</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concluída</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-114"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0114.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0114.mediawiki">BIP-114</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Merkelized Abstract Syntax Tree</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Johnson Lau</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-120"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0120.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0120.mediawiki">BIP-120</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proof of Payment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kalle Rosenbaum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-121"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0121.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0121.mediawiki">BIP-121</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proof of Payment URI scheme</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kalle Rosenbaum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-122"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0122.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0122.mediawiki">BIP-122</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URI scheme for Blockchain references / exploration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marco Pontello</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-123"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0123.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0123.mediawiki">BIP-123</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BIP Classification</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eric Lombrozo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ativa</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-124"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0124.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0124.mediawiki">BIP-124</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hierarchical Deterministic Script Templates</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eric Lombrozo, William Swanson</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informativa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-125"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0125.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0125.mediawiki">BIP-125</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Opt-in Full Replace-by-Fee Signaling</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">David A. Harding, Peter Todd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proposta</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-126"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0126.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0126.mediawiki">BIP-126</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Best Practices for Heterogeneous Input Script Transactions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kristov Atlas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informativa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-130"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0130.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0130.mediawiki">BIP-130</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sendheaders message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suhas Daftuar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proposta</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-131"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0131.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0131.mediawiki">BIP-131</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Coalescing Transaction" Specification (wildcard inputs)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Chris Priest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-132"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0132.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0132.mediawiki">BIP-132</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Committee-based BIP Acceptance Process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Andy Chase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removida</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-133"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0133.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0133.mediawiki">BIP-133</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feefilter message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alex Morcos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-134"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0134.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0134.mediawiki">BIP-134</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flexible Transactions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tom Zander</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-140"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0140.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0140.mediawiki">BIP-140</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Normalized TXID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Christian Decker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-141"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki">BIP-141</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Segregated Witness (Consensus layer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eric Lombrozo, Johnson Lau, Pieter Wuille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-142"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0142.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0142.mediawiki">BIP-142</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address Format for Segregated Witness</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Johnson Lau</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adiada</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-143"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0143.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0143.mediawiki">BIP-143</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction Signature Verification for Version 0 Witness Program</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Johnson Lau, Pieter Wuille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-144"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0144.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0144.mediawiki">BIP-144</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Segregated Witness (Peer Services)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eric Lombrozo, Pieter Wuille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-145"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0145.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0145.mediawiki">BIP-145</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">getblocktemplate Updates for Segregated Witness</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Luke Dashjr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-146"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0146.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0146.mediawiki">BIP-146</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dealing with signature encoding malleability</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Johnson Lau, Pieter Wuille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-147"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0147.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0147.mediawiki">BIP-147</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dealing with dummy stack element malleability</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Johnson Lau</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-148"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0148.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0148.mediawiki">BIP-148</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mandatory activation of segwit deployment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shaolin Fry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-150"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0150.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0150.mediawiki">BIP-150</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Peer Authentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jonas Schnelli</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-151"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0151.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0151.mediawiki">BIP-151</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Peer-to-Peer Communication Encryption</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jonas Schnelli</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-152"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0152.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0152.mediawiki">BIP-152</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compact Block Relay</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matt Corallo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-171"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0171.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0171.mediawiki">BIP-171</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Currency/exchange rate information API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Luke Dashjr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-180"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0180.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0180.mediawiki">BIP-180</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block size/weight fraud proof</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Luke Dashjr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="bip-199"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0199.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0199.mediawiki">BIP-199</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hashed Time-Locked Contract transactions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sean Bowe, Daira Hopwood</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rascunho</p></td>
</tr>
</tbody>
</table>
<div id="appdx_bitcore" class="paragraph data-line-1699">
<p>== Bitcore</p>
</div>
<div class="paragraph data-line-1702">
<p>O Bitcore é um conjunto de ferramentas fornecido pela BitPay. Seu objetivo é fornecer ferramentas fáceis de usar para os desenvolvedores do Bitcoin. Quase todo o código do Bitcore é escrito em JavaScript. Existem alguns módulos escritos especificamente para o NodeJS. Além disso, o módulo "bitcore-node" do Bitcore inclui o código C++ do Bitcoin Core. Para maiores informações, visite o site <a href="https://bitcore.io" class="undefined" data-href="https://bitcore.io">https://bitcore.io</a>.</p>
</div>
<div class="paragraph data-line-1704">
<p>=== Lista de Recursos do Bitcore</p>
</div>
<div class="ulist data-line-1706">
<ul>
<li class="data-line-1706">
<p>Nó completo de bitcoin (bitcore-node)</p>
</li>
<li class="data-line-1707">
<p>Explorador de blocos (insight)</p>
</li>
<li class="data-line-1708">
<p>Utilitários de bloco, transação e carteira (bitcore-lib)</p>
</li>
<li class="data-line-1709">
<p>Comunicação direta com a rede P2P do bitcoin (bitcore-p2p)</p>
</li>
<li class="data-line-1710">
<p>Geração de semente mnemônica (bitcore-mnemonic)</p>
</li>
<li class="data-line-1711">
<p>Protocolo de pagamento (bitcore-payment-protocol)</p>
</li>
<li class="data-line-1712">
<p>Verificação e assinatura de mensagens (bitcore-message)</p>
</li>
<li class="data-line-1713">
<p>Esquema Integrado de Criptografia de Curva Elíptica (ECIES) (bitcore-ecies)</p>
</li>
<li class="data-line-1714">
<p>Serviço de carteira (bitcore-wallet-service)</p>
</li>
<li class="data-line-1715">
<p>Cliente de carteira (bitcore-wallet-client)</p>
</li>
<li class="data-line-1716">
<p>Integração de serviços diretamente com o Bitcoin Core (bitcore-node)</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1718">
<p>=== Exemplos de Bibliotecas do Bitcore</p>
</div>
<div class="paragraph data-line-1720">
<p>==== Pré-requisitos</p>
</div>
<div class="ulist data-line-1722">
<ul>
<li class="data-line-1722">
<p>NodeJS &gt;= 4.x</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1724">
<p>Se estiver usando o NodeJS e o nó REPL:</p>
</div>
<div class="listingblock data-line-1727">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ npm install -g bitcore-lib bitcore-p2p</code></pre>
</div>
</div>
<div class="paragraph data-line-1731">
<p>==== Exemplos de Carteiras usando a bitcore-lib</p>
</div>
<div class="paragraph data-line-1733">
<p>Criando um novo endereço Bitcoin com uma chave privada associada:</p>
</div>
<div class="listingblock data-line-1735">
<div class="content">
<pre>&gt; bitcore = require('bitcore-lib')
&gt; privateKey = new bitcore.PrivateKey()
&gt; address = privateKey.toAddress().toString()</pre>
</div>
</div>
<div class="paragraph data-line-1741">
<p>Criando uma chave privada e um endereço determinístico hierárquico:</p>
</div>
<div class="listingblock data-line-1743">
<div class="content">
<pre>&gt; hdPrivateKey = bitcore.HDPrivateKey()
&gt; hdPublicKey = bitcore.HDPublicKey(hdPrivateKey)
&gt; hdAddress = new bitcore.Address(hdPublicKey.publicKey).toString()</pre>
</div>
</div>
<div class="paragraph data-line-1749">
<p>Criando e assinando uma transação a partir de uma UTXO:</p>
</div>
<div class="listingblock data-line-1751">
<div class="content">
<pre>&gt; utxo = {
txId: txId, // ID da transação que contém uma saída não gasta
outputIndex: outputIndex, // índice da saída (ex: 0)
  address: addressOfUtxo, // endereço da UTXO
  script: bitcore.Script.buildPublicKeyHashOut(addressOfUtxo).toString(),
satoshis: satoshis // quantia enviada para o endereço
}
&gt; fee = 3000 // taxa definida adequadamente para as condições na rede
&gt; tx = new bitcore.Transaction()
        .from(utxo)
        .to(address, 35000)
        .fee(fee)
        .enableRBF()
        .sign(privateKeyOfUtxo)</pre>
</div>
</div>
<div class="paragraph data-line-1768">
<p>Substituindo a última transação na mempool (<em>replace-by-fee</em>):</p>
</div>
<div class="listingblock data-line-1770">
<div class="content">
<pre>&gt; rbfTx = new Transaction()
           .from(utxo)
           .to(address, 35000)
           .fee(fee*2)
           .enableRBF()
           .sign(privateKeyOfUtxo);
&gt; tx.serialize();
&gt; rbfTx.serialize();</pre>
</div>
</div>
<div class="paragraph data-line-1781">
<p>Transmitindo uma transação para a rede bitcoin
(nota: transmite apenas transações válidas; consulte <a href="https://bitnodes.21.co/nodes" class="undefined" data-href="https://bitnodes.21.co/nodes">https://bitnodes.21.co/nodes</a> para hosts pares):</p>
</div>
<div class="olist arabic data-line-1784">
<ol class="arabic">
<li class="data-line-1784">
<p>Copie o código abaixo em um arquivo chamado <em>broadcast.js</em>.</p>
</li>
<li class="data-line-1785">
<p>As variáveis tx e rbfTx são o output das funções tx.serialize() e rbfTx.serialize(), respectivamente.</p>
</li>
<li class="data-line-1786">
<p>Para substituir por taxa (<em>replace-by-fee</em>), o par deve suportar a opção mempoolreplace do bitcoind e deve ter ela definida como 1.</p>
</li>
<li class="data-line-1787">
<p>Execute o nó do arquivo <em>broadcast.js</em>:</p>
</li>
</ol>
</div>
<div class="listingblock data-line-1789">
<div class="content">
<pre>var p2p = require('bitcore-p2p');
var bitcore = require('bitcore-lib');
var tx = new bitcore.Transaction('output da função serialize');
var rbfTx = new bitcore.Transaction('output da função serialize');
var host = 'endereço ip'; // usar nó par válido escutando na porta tcp 8333
var peer = new p2p.Peer({host: host});
var messages = new p2p.Messages();
peer.on('ready', function() {
  var txs = [messages.Transaction(tx), messages.Transaction(rbfTx)];
  var index = 0;
  var interval = setInterval(function() {
    peer.sendMessage(txs[index++]);
    console.log('transação: ' + index + ' enviada');
    if (index === txs.length) {
      clearInterval(interval);
      console.log('desconectando do peer: ' + host);
      peer.disconnect();
    }
  }, 2000);
});
peer.connect();</pre>
</div>
</div>
<div id="appdx-pycoin" class="paragraph data-line-1815">
<p>== pycoin, ku e tx</p>
</div>
<div class="paragraph data-line-1818">
<p>A biblioteca Python <a href="https://github.com/richardkiss/pycoin" data-href="https://github.com/richardkiss/pycoin">pycoin</a>, originalmente escrita e mantida por Richard Kiss, é uma biblioteca baseada em Python que suporta a manipulação de chaves e transações bitcoin, suportando até mesmo a linguagem de script, o suficiente para lidar com transações fora do padrão.</p>
</div>
<div class="paragraph data-line-1820">
<p>A biblioteca pycoin suporta tanto o Python 2 (2.7.x) quanto o Python 3 (3.3 e posteirores), e vem com alguns utilitários de linha de comando úteis, o ku e o tx.</p>
</div>
<div class="paragraph data-line-1822">
<p>=== Utilitário de Chave (Key Utility, KU)</p>
</div>
<div class="paragraph data-line-1824">
<p>O utilitário de linha de comando ku ("key utility, utilitário de chave") é um canivete suíço para a manipulação de chaves. Ele suporta chaves BIP-32, WIF e endereços (bitcoin e alt coins). A seguir, alguns exemplos.</p>
</div>
<div class="paragraph data-line-1826">
<p>Criar uma chave privada BIP-32 usando fontes de entropia padrão GPG e <em>/dev/random</em>:</p>
</div>
<div class="listingblock data-line-1829">
<div class="content">
<pre>$ ku create

input           : create
network         : Bitcoin
wallet key      : xprv9s21ZrQH143K3LU5ctPZTBnb9kTjA5Su9DcWHvXJemiJBsY7VqXUG7hipgdWaU
                    m2nhnzdvxJf5KJo9vjP2nABX65c5sFsWsV8oXcbpehtJi
public version  : xpub661MyMwAqRbcFpYYiuvZpKjKhnJDZYAkWSY76JvvD7FH4fsG3Nqiov2CfxzxY8
                    DGcpfT56AMFeo8M8KPkFMfLUtvwjwb6WPv8rY65L2q8Hz
tree depth      : 0
fingerprint     : 9d9c6092
parent f'print  : 00000000
child index     : 0
chain code      : 80574fb260edaa4905bc86c9a47d30c697c50047ed466c0d4a5167f6821e8f3c
private key     : yes
secret exponent : 112471538590155650688604752840386134637231974546906847202389294096567806844862
 hex            : f8a8a28b28a916e1043cc0aca52033a18a13cab1638d544006469bc171fddfbe
wif             : L5Z54xi6qJusQT42JHA44mfPVZGjyb4XBRWfxAzUWwRiGx1kV4sP
 uncompressed   : 5KhoEavGNNH4GHKoy2Ptu4KfdNp4r56L5B5un8FP6RZnbsz5Nmb
public pair x   : 76460638240546478364843397478278468101877117767873462127021560368290114016034
public pair y   : 59807879657469774102040120298272207730921291736633247737077406753676825777701
 x as hex       : a90b3008792432060fa04365941e09a8e4adf928bdbdb9dad41131274e379322
 y as hex       : 843a0f6ed9c0eb1962c74533795406914fe3f1957c5238951f4fe245a4fcd625
y parity        : odd
key pair as sec : 03a90b3008792432060fa04365941e09a8e4adf928bdbdb9dad41131274e379322
 uncompressed   : 04a90b3008792432060fa04365941e09a8e4adf928bdbdb9dad41131274e379322
                    843a0f6ed9c0eb1962c74533795406914fe3f1957c5238951f4fe245a4fcd625
hash160         : 9d9c609247174ae323acfc96c852753fe3c8819d
 uncompressed   : 8870d869800c9b91ce1eb460f4c60540f87c15d7
Bitcoin address : 1FNNRQ5fSv1wBi5gyfVBs2rkNheMGt86sp
 uncompressed   : 1DSS5isnH4FsVaLVjeVXewVSpfqktdiQAM</pre>
</div>
</div>
<div class="paragraph data-line-1862">
<p>Criar uma chave BIP-32 a partir de uma frase de senha (<em>passphrase</em>):</p>
</div>
<div class="admonitionblock warning data-line-1865">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-1866">
<p>A frase de senha usada nesse exemplo é fácil demais de ser descoberta.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock data-line-1869">
<div class="content">
<pre>$ ku P:foo

input           : P:foo
network         : Bitcoin
wallet key      : xprv9s21ZrQH143K31AgNK5pyVvW23gHnkBq2wh5aEk6g1s496M8ZMjxncCKZKgb5j
                    ZoY5eSJMJ2Vbyvi2hbmQnCuHBujZ2WXGTux1X2k9Krdtq
public version  : xpub661MyMwAqRbcFVF9ULcqLdsEa5WnCCugQAcgNd9iEMQ31tgH6u4DLQWoQayvtS
                    VYFvXz2vPPpbXE1qpjoUFidhjFj82pVShWu9curWmb2zy
tree depth      : 0
fingerprint     : 5d353a2e
parent f'print  : 00000000
child index     : 0
chain code      : 5eeb1023fd6dd1ae52a005ce0e73420821e1d90e08be980a85e9111fd7646bbc
private key     : yes
secret exponent : 65825730547097305716057160437970790220123864299761908948746835886007793998275
 hex            : 91880b0e3017ba586b735fe7d04f1790f3c46b818a2151fb2def5f14dd2fd9c3
wif             : L26c3H6jEPVSqAr1usXUp9qtQJw6NHgApq6Ls4ncyqtsvcq2MwKH
 uncompressed   : 5JvNzA5vXDoKYJdw8SwwLHxUxaWvn9mDea6k1vRPCX7KLUVWa7W
public pair x   : 81821982719381104061777349269130419024493616650993589394553404347774393168191
public pair y   : 58994218069605424278320703250689780154785099509277691723126325051200459038290
 x as hex       : b4e599dfa44555a4ed38bcfff0071d5af676a86abf123c5b4b4e8e67a0b0b13f
 y as hex       : 826d8b4d3010aea16ff4c1c1d3ae68541d9a04df54a2c48cc241c2983544de52
y parity        : even
key pair as sec : 02b4e599dfa44555a4ed38bcfff0071d5af676a86abf123c5b4b4e8e67a0b0b13f
 uncompressed   : 04b4e599dfa44555a4ed38bcfff0071d5af676a86abf123c5b4b4e8e67a0b0b13f
                    826d8b4d3010aea16ff4c1c1d3ae68541d9a04df54a2c48cc241c2983544de52
hash160         : 5d353a2ecdb262477172852d57a3f11de0c19286
 uncompressed   : e5bd3a7e6cb62b4c820e51200fb1c148d79e67da
Bitcoin address : 19Vqc8uLTfUonmxUEZac7fz1M5c5ZZbAii
 uncompressed   : 1MwkRkogzBRMehBntgcq2aJhXCXStJTXHT</pre>
</div>
</div>
<div class="paragraph data-line-1903">
<p>Adquirir informações como JSON:</p>
</div>
<div class="listingblock data-line-1906">
<div class="content">
<pre>$ ku P:foo -P -j</pre>
</div>
</div>
<div class="listingblock data-line-1910">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "y_parity": "even",
   "public_pair_y_hex": "826d8b4d3010aea16ff4c1c1d3ae68541d9a04df54a2c48cc241c2983544de52",
   "private_key": "no",
   "parent_fingerprint": "00000000",
   "tree_depth": "0",
   "network": "Bitcoin",
   "btc_address_uncompressed": "1MwkRkogzBRMehBntgcq2aJhXCXStJTXHT",
   "key_pair_as_sec_uncompressed": "04b4e599dfa44555a4ed38bcfff0071d5af676a86abf123c5b4b4e8e67a0b0b13f826d8b4d3010aea16ff4c1c1d3ae68541d9a04df54a2c48cc241c2983544de52",
   "public_pair_x_hex": "b4e599dfa44555a4ed38bcfff0071d5af676a86abf123c5b4b4e8e67a0b0b13f",
   "wallet_key": "xpub661MyMwAqRbcFVF9ULcqLdsEa5WnCCugQAcgNd9iEMQ31tgH6u4DLQWoQayvtSVYFvXz2vPPpbXE1qpjoUFidhjFj82pVShWu9curWmb2zy",
   "chain_code": "5eeb1023fd6dd1ae52a005ce0e73420821e1d90e08be980a85e9111fd7646bbc",
   "child_index": "0",
   "hash160_uncompressed": "e5bd3a7e6cb62b4c820e51200fb1c148d79e67da",
   "btc_address": "19Vqc8uLTfUonmxUEZac7fz1M5c5ZZbAii",
   "fingerprint": "5d353a2e",
   "hash160": "5d353a2ecdb262477172852d57a3f11de0c19286",
   "input": "P:foo",
   "public_pair_x": "81821982719381104061777349269130419024493616650993589394553404347774393168191",
   "public_pair_y": "58994218069605424278320703250689780154785099509277691723126325051200459038290",
   "key_pair_as_sec": "02b4e599dfa44555a4ed38bcfff0071d5af676a86abf123c5b4b4e8e67a0b0b13f"
}</code></pre>
</div>
</div>
<div class="paragraph data-line-1935">
<p>Chave pública BIP-32:</p>
</div>
<div class="listingblock data-line-1937">
<div class="content">
<pre>$ ku -w -P P:foo
xpub661MyMwAqRbcFVF9ULcqLdsEa5WnCCugQAcgNd9iEMQ31tgH6u4DLQWoQayvtSVYFvXz2vPPpbXE1qpjoUFidhjFj82pVShWu9curWmb2zy</pre>
</div>
</div>
<div class="paragraph data-line-1942">
<p>Gerar uma subchave:</p>
</div>
<div class="listingblock data-line-1944">
<div class="content">
<pre>$ ku -w -s3/2 P:foo
xprv9wTErTSkjVyJa1v4cUTFMFkWMe5eu8ErbQcs9xajnsUzCBT7ykHAwdrxvG3g3f6BFk7ms5hHBvmbdutNmyg6iogWKxx6mefEw4M8EroLgKj</pre>
</div>
</div>
<div class="paragraph data-line-1949">
<p>Gerar uma subchave endurecida:</p>
</div>
<div class="listingblock data-line-1951">
<div class="content">
<pre>$ ku -w -s3/2H P:foo
xprv9wTErTSu5AWGkDeUPmqBcbZWX1xq85ZNX9iQRQW9DXwygFp7iRGJo79dsVctcsCHsnZ3XU3DhsuaGZbDh8iDkBN45k67UKsJUXM1JfRCdn1</pre>
</div>
</div>
<div class="paragraph data-line-1956">
<p>Gerar uma chave privada WIF:</p>
</div>
<div class="listingblock data-line-1958">
<div class="content">
<pre>$ ku -W P:foo
L26c3H6jEPVSqAr1usXUp9qtQJw6NHgApq6Ls4ncyqtsvcq2MwKH</pre>
</div>
</div>
<div class="paragraph data-line-1963">
<p>Gerar um endereço:</p>
</div>
<div class="listingblock data-line-1966">
<div class="content">
<pre>$ ku -a P:foo
19Vqc8uLTfUonmxUEZac7fz1M5c5ZZbAii</pre>
</div>
</div>
<div class="paragraph data-line-1973">
<p>Gerar várias subchaves:</p>
</div>
<div class="listingblock data-line-1976">
<div class="content">
<pre>$ ku P:foo -s 0/0-5 -w
xprv9xWkBDfyBXmZjBG9EiXBpy67KK72fphUp9utJokEBFtjsjiuKUUDF5V3TU8U8cDzytqYnSekc8bYuJS8G3bhXxKWB89Ggn2dzLcoJsuEdRK
xprv9xWkBDfyBXmZnzKf3bAGifK593gT7WJZPnYAmvc77gUQVej5QHckc5Adtwxa28ACmANi9XhCrRvtFqQcUxt8rUgFz3souMiDdWxJDZnQxzx
xprv9xWkBDfyBXmZqdXA8y4SWqfBdy71gSW9sjx9JpCiJEiBwSMQyRxan6srXUPBtj3PTxQFkZJAiwoUpmvtrxKZu4zfsnr3pqyy2vthpkwuoVq
xprv9xWkBDfyBXmZsA85GyWj9uYPyoQv826YAadKWMaaEosNrFBKgj2TqWuiWY3zuqxYGpHfv9cnGj5P7e8EskpzKL1Y8Gk9aX6QbryA5raK73p
xprv9xWkBDfyBXmZv2q3N66hhZ8DAcEnQDnXML1J62krJAcf7Xb1HJwuW2VMJQrCofY2jtFXdiEY8UsRNJfqK6DAdyZXoMvtaLHyWQx3FS4A9zw
xprv9xWkBDfyBXmZw4jEYXUHYc9fT25k9irP87n2RqfJ5bqbjKdT84Mm7Wtc2xmzFuKg7iYf7XFHKkSsaYKWKJbR54bnyAD9GzjUYbAYTtN4ruo</pre>
</div>
</div>
<div class="paragraph pagebreak-before data-line-1987">
<p>Gerar os endereços correspondentes:</p>
</div>
<div class="listingblock data-line-1990">
<div class="content">
<pre>$ ku P:foo -s 0/0-5 -a
1MrjE78H1R1rqdFrmkjdHnPUdLCJALbv3x
1AnYyVEcuqeoVzH96zj1eYKwoWfwte2pxu
1GXr1kZfxE1FcK6ZRD5sqqqs5YfvuzA1Lb
116AXZc4bDVQrqmcinzu4aaPdrYqvuiBEK
1Cz2rTLjRM6pMnxPNrRKp9ZSvRtj5dDUML
1WstdwPnU6HEUPme1DQayN9nm6j7nDVEM</pre>
</div>
</div>
<div class="paragraph data-line-2001">
<p>Gerar os WIFs correspondentes:</p>
</div>
<div class="listingblock data-line-2004">
<div class="content">
<pre>$ ku P:foo -s 0/0-5 -W
L5a4iE5k9gcJKGqX3FWmxzBYQc29PvZ6pgBaePLVqT5YByEnBomx
Kyjgne6GZwPGB6G6kJEhoPbmyjMP7D5d3zRbHVjwcq4iQXD9QqKQ
L4B3ygQxK6zH2NQGxLDee2H9v4Lvwg14cLJW7QwWPzCtKHdWMaQz
L2L2PZdorybUqkPjrmhem4Ax5EJvP7ijmxbNoQKnmTDMrqemY8UF
L2oD6vA4TUyqPF8QG4vhUFSgwCyuuvFZ3v8SKHYFDwkbM765Nrfd
KzChTbc3kZFxUSJ3Kt54cxsogeFAD9CCM4zGB22si8nfKcThQn8C</pre>
</div>
</div>
<div class="paragraph data-line-2016">
<p>Verificar se isso funciona ao escolher uma <em>string</em> BIP-32 (a que corresponde à subchave 0/3):</p>
</div>
<div class="listingblock data-line-2020">
<div class="content">
<pre>$ ku -W xprv9xWkBDfyBXmZsA85GyWj9uYPyoQv826YAadKWMaaEosNrFBKgj2TqWuiWY3zuqxYGpHfv9cnGj5P7e8EskpzKL1Y8Gk9aX6QbryA5raK73p
L2L2PZdorybUqkPjrmhem4Ax5EJvP7ijmxbNoQKnmTDMrqemY8UF
$ ku -a xprv9xWkBDfyBXmZsA85GyWj9uYPyoQv826YAadKWMaaEosNrFBKgj2TqWuiWY3zuqxYGpHfv9cnGj5P7e8EskpzKL1Y8Gk9aX6QbryA5raK73p
116AXZc4bDVQrqmcinzu4aaPdrYqvuiBEK</pre>
</div>
</div>
<div class="paragraph data-line-2028">
<p>Sim, isso parece familiar.</p>
</div>
<div class="paragraph data-line-2030">
<p>A partir de um expoente secreto:</p>
</div>
<div class="listingblock data-line-2033">
<div class="content">
<pre>$ ku 1

input           : 1
network         : Bitcoin
secret exponent : 1
 hex            : 1
wif             : KwDiBf89QgGbjEhKnhXJuH7LrciVrZi3qYjgd9M7rFU73sVHnoWn
 uncompressed   : 5HpHagT65TZzG1PH3CSu63k8DbpvD8s5ip4nEB3kEsreAnchuDf
public pair x   : 55066263022277343669578718895168534326250603453777594175500187360389116729240
public pair y   : 32670510020758816978083085130507043184471273380659243275938904335757337482424
 x as hex       : 79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798
 y as hex       : 483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8
y parity        : even
key pair as sec : 0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798
 uncompressed   : 0479be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798
                    483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8
hash160         : 751e76e8199196d454941c45d1b3a323f1433bd6
 uncompressed   : 91b24bf9f5288532960ac687abb035127b1d28a5
Bitcoin address : 1BgGZ9tcN4rm9KBzDn7KprQz87SZ26SAMH
 uncompressed   : 1EHNa6Q4Jz2uvNExL497mE43ikXhwF6kZm</pre>
</div>
</div>
<div class="paragraph data-line-2057">
<p>Versão Litecoin:</p>
</div>
<div class="listingblock data-line-2060">
<div class="content">
<pre>$ ku -nL 1

input            : 1
network          : Litecoin
secret exponent  : 1
 hex             : 1
wif              : T33ydQRKp4FCW5LCLLUB7deioUMoveiwekdwUwyfRDeGZm76aUjV
 uncompressed    : 6u823ozcyt2rjPH8Z2ErsSXJB5PPQwK7VVTwwN4mxLBFrao69XQ
public pair x    : 55066263022277343669578718895168534326250603453777594175500187360389116729240
public pair y    : 32670510020758816978083085130507043184471273380659243275938904335757337482424
 x as hex        : 79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798
 y as hex        : 483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8
y parity         : even
key pair as sec  : 0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798
 uncompressed    : 0479be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798
                     483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8
hash160          : 751e76e8199196d454941c45d1b3a323f1433bd6
 uncompressed    : 91b24bf9f5288532960ac687abb035127b1d28a5
Litecoin address : LVuDpNCSSj6pQ7t9Pv6d6sUkLKoqDEVUnJ
 uncompressed    : LYWKqJhtPeGyBAw7WC8R3F7ovxtzAiubdM</pre>
</div>
</div>
<div class="paragraph data-line-2084">
<p>WIF Dogecoin:</p>
</div>
<div class="listingblock data-line-2087">
<div class="content">
<pre>$ ku -nD -W 1
QNcdLVw8fHkixm6NNyN6nVwxKek4u7qrioRbQmjxac5TVoTtZuot</pre>
</div>
</div>
<div class="paragraph data-line-2093">
<p>A partir de um par público (na Testnet):</p>
</div>
<div class="listingblock data-line-2096">
<div class="content">
<pre>$ ku -nT 55066263022277343669578718895168534326250603453777594175500187360389116729240,even

input                   : 550662630222773436695787188951685343262506034537775941755001873603
                            89116729240,even
network                 : Bitcoin testnet
public pair x           : 55066263022277343669578718895168534326250603453777594175500187360389116729240
public pair y           : 32670510020758816978083085130507043184471273380659243275938904335757337482424
 x as hex               : 79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798
 y as hex               : 483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8
y parity                : even
key pair as sec         : 0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798
 uncompressed           : 0479be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798
                            483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8
hash160                 : 751e76e8199196d454941c45d1b3a323f1433bd6
 uncompressed           : 91b24bf9f5288532960ac687abb035127b1d28a5
Bitcoin testnet address : mrCDrCybB6J1vRfbwM5hemdJz73FwDBC8r
 uncompressed           : mtoKs9V381UAhUia3d7Vb9GNak8Qvmcsme</pre>
</div>
</div>
<div class="paragraph data-line-2117">
<p>A partir de hash160:</p>
</div>
<div class="listingblock data-line-2120">
<div class="content">
<pre>$ ku 751e76e8199196d454941c45d1b3a323f1433bd6

input           : 751e76e8199196d454941c45d1b3a323f1433bd6
network         : Bitcoin
hash160         : 751e76e8199196d454941c45d1b3a323f1433bd6
Bitcoin address : 1BgGZ9tcN4rm9KBzDn7KprQz87SZ26SAMH</pre>
</div>
</div>
<div class="paragraph data-line-2130">
<p>Como um endereço Dogecoin:</p>
</div>
<div class="listingblock data-line-2133">
<div class="content">
<pre>$ ku -nD 751e76e8199196d454941c45d1b3a323f1433bd6

input            : 751e76e8199196d454941c45d1b3a323f1433bd6
network          : Dogecoin
hash160          : 751e76e8199196d454941c45d1b3a323f1433bd6
Dogecoin address : DFpN6QqFfUm3gKNaxN6tNcab1FArL9cZLE</pre>
</div>
</div>
<div class="paragraph data-line-2142">
<p>==== Utilitário de Transação (Transacion Utility, TX)</p>
</div>
<div class="paragraph data-line-2144">
<p>
O utilitário de linha de comando tx irá exibir transações em formato legível por humanos, buscar transações básicas do cache de transações da pycoin ou de serviços da web (blockchain.info, blockcypher.com, blockr.io e chain.so são atualmente suportados), mesclar transações , adicionar ou remover entradas ou saídas e assinar transações.</p>
</div>
<div class="paragraph data-line-2147">
<p>A seguir temos alguns exemplos.</p>
</div>
<div class="paragraph data-line-2150">
<p>Veja a famosa transação "pizza":</p>
</div>
<div class="listingblock data-line-2153">
<div class="content">
<pre>$ tx 49d2adb6e476fa46d8357babf78b1b501fd39e177ac7833124b3f67b17c40c2a
aviso: considere definir a variável de ambiente PYCOIN_CACHE_DIR=~/.pycoin_cache para fazer o cache das transações adquiridas através de serviços web
aviso: não foram encontrados provedores de serviço para get_tx; considere definir a variável de ambiente PYCOIN_BTC_PROVIDERS
uso: tx [-h] [-t TRANSACTION_VERSION] [-l LOCK_TIME] [-n NETWORK] [-a]
          [-i endereço] [-f caminho-para-chaves-privadas] [-g ARGUMENTO_GPG]
          [--remove-tx-in tx_in_index_to_delete]
          [--remove-tx-out tx_out_index_to_delete] [-F transaction-fee] [-u]
          [-b URL_DO_BITCOIND] [-o caminho-para-o-arquivo-output]
          argumento [argumento ...]
tx: erro: não foi possível encontrar o Tx com o id 49d2adb6e476fa46d8357babf78b1b501fd39e177ac7833124b3f67b17c40c2a</pre>
</div>
</div>
<div class="paragraph data-line-2167">
<p>Opa! Não definimos os serviços web. Vamos fazer isso agora:</p>
</div>
<div class="listingblock data-line-2171">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ PYCOIN_CACHE_DIR=~/.pycoin_cache
$ PYCOIN_BTC_PROVIDERS="block.io blockchain.info blockexplorer.com"
$ export PYCOIN_CACHE_DIR PYCOIN_BTC_PROVIDERS</code></pre>
</div>
</div>
<div class="paragraph data-line-2178">
<p>Isso não é feito automaticamente, portanto uma ferramenta de linha de comando não vazará para um website de terceiros informações potencialmente privadas sobre as transações que você está interessado. Se você não se importar com isso, você pode inserir essas linhas em seu <em>.profile</em>.</p>
</div>
<div class="paragraph data-line-2180">
<p>Vamos tentar novamente:</p>
</div>
<div class="listingblock data-line-2182">
<div class="content">
<pre>$ tx 49d2adb6e476fa46d8357babf78b1b501fd39e177ac7833124b3f67b17c40c2a
Version:  1  tx hash 49d2adb6e476fa46d8357babf78b1b501fd39e177ac7833124b3f67b17c40c2a  159 bytes
TxIn count: 1; TxOut count: 1
Lock time: 0 (válido a qualquer momento)
Input:
  0:                          (desconhecido) de 1e133f7de73ac7d074e2746a3d6717dfc99ecaa8e9f9fade2cb8b0b20a5e0441:0
Output:
  0: 1CZDM6oTttND6WPdt3D6bydo7DYKzd9Qik recebe 10000000,00000 mBTC
Total em saídas 10000000,00000 mBTC
incluindo as não gastas no dump hexadecimal, já que a transação não está completamente assinada
010000000141045e0ab2b0b82cdefaf9e9a8ca9ec9df17673d6a74e274d0c73ae77d3f131e000000004a493046022100a7f26eda874931999c90f87f01ff1ffc76bcd058fe16137e0e63fdb6a35c2d78022100a61e9199238eb73f07c8f209504c84b80f03e30ed8169edd44f80ed17ddf451901ffffffff010010a5d4e80000001976a9147ec1003336542cae8bded8909cdd6b5e48ba0ab688ac00000000

** não foi possível validar a transação, pois estão faltando as transações-fonte</pre>
</div>
</div>
<div class="paragraph data-line-2198">
<p>A última linha aparece porque para validar as assinaturas das transações, você tecnicamente precisa das transações-fonte. Então vamos adicionar -a para acrescentar às transações uma informação de fonte:</p>
</div>
<div class="listingblock data-line-2200">
<div class="content">
<pre>$ tx -a 49d2adb6e476fa46d8357babf78b1b501fd39e177ac7833124b3f67b17c40c2a
aviso: as recomendações de taxas de transação calculadas casualmente e as estimativas podem estar incorretas
aviso: taxa de transação menor que o valor esperado (calculado casualmente) de 0,1 mBTC, a transação pode não se propagar
Version:  1  tx hash 49d2adb6e476fa46d8357babf78b1b501fd39e177ac7833124b3f67b17c40c2a  159 bytes
TxIn count: 1; TxOut count: 1
Lock time: 0 (válido a qualquer momento)
Input:
  0: 17WFx2GQZUmh6Up2NDNCEDk3deYomdNCfk de 1e133f7de73ac7d074e2746a3d6717dfc99ecaa8e9f9fade2cb8b0b20a5e0441:0 10000000.00000 mBTC  sig ok
Output:
  0: 1CZDM6oTttND6WPdt3D6bydo7DYKzd9Qik recebe 10000000,00000 mBTC
Total em entradas  10000000,00000 mBTC
Total em saídas 10000000,00000 mBTC
Total em taxas        0,00000 mBTC

010000000141045e0ab2b0b82cdefaf9e9a8ca9ec9df17673d6a74e274d0c73ae77d3f131e000000004a493046022100a7f26eda874931999c90f87f01ff1ffc76bcd058fe16137e0e63fdb6a35c2d78022100a61e9199238eb73f07c8f209504c84b80f03e30ed8169edd44f80ed17ddf451901ffffffff010010a5d4e80000001976a9147ec1003336542cae8bded8909cdd6b5e48ba0ab688ac00000000

todos os valores da transação de recebimento foram validados</pre>
</div>
</div>
<div class="paragraph data-line-2220">
<p>Agora, vamos ver as saídas não gastas (UTXOs) para um endereço específico. No bloco nº1, vemos uma transação coinbase para 12c6DSiU4Rq3P4ZxziKxzrL5LmMBrzjrJX. Vamos usar fetch_unspent para encontrar todas as moedas nesse endereço:</p>
</div>
<div class="listingblock data-line-2222">
<div class="content">
<pre>$ fetch_unspent 12c6DSiU4Rq3P4ZxziKxzrL5LmMBrzjrJX
a3a6f902a51a2cbebede144e48a88c05e608c2cce28024041a5b9874013a1e2a/0/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/333000
cea36d008badf5c7866894b191d3239de9582d89b6b452b596f1f1b76347f8cb/31/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/10000
065ef6b1463f552f675622a5d1fd2c08d6324b4402049f68e767a719e2049e8d/86/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/10000
a66dddd42f9f2491d3c336ce5527d45cc5c2163aaed3158f81dc054447f447a2/0/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/10000
ffd901679de65d4398de90cefe68d2c3ef073c41f7e8dbec2fb5cd75fe71dfe7/0/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/100
d658ab87cc053b8dbcfd4aa2717fd23cc3edfe90ec75351fadd6a0f7993b461d/5/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/911
36ebe0ca3237002acb12e1474a3859bde0ac84b419ec4ae373e63363ebef731c/1/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/100000
fd87f9adebb17f4ebb1673da76ff48ad29e64b7afa02fda0f2c14e43d220fe24/0/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/1
dfdf0b375a987f17056e5e919ee6eadd87dad36c09c4016d4a03cea15e5c05e3/1/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/1337
cb2679bfd0a557b2dc0d8a6116822f3fcbe281ca3f3e18d3855aa7ea378fa373/0/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/1337
d6be34ccf6edddc3cf69842dce99fe503bf632ba2c2adb0f95c63f6706ae0c52/1/76a914119b098e2e980a229e139a9ed01a469e518e6f2688ac/2000000
    0e3e2357e806b6cdb1f70b54c3a3a17b6714ee1f0e68bebb44a74b1efd512098/0/410496b538e853519c726a2c91e61ec11600ae1390813a627c66fb8be7947be63c52da7589379515d4e0a604f8141781e62294721166bf621e73a82cbf2342c858eeac/5000000000</pre>
</div>
</div>
<div id="appdx_bx" class="paragraph data-line-2241">
<p>== Comandos do Bitcoin Explorer (bx)</p>
</div>
<div class="paragraph data-line-2243">
<p>O Bitcoin Explorer (bx) é uma ferramenta de linha de comando que oferece uma variedade de comandos para gerenciamento de chaves e construção de transação. É parte da biblioteca libbitcoin.</p>
</div>
<div class="listingblock data-line-2245">
<div class="content">
<pre>Uso: bx COMANDO [--help]

Info: Os comandos bx são:

address-decode
address-embed
address-encode
address-validate
base16-decode
base16-encode
base58-decode
base58-encode
base58check-decode
base58check-encode
base64-decode
base64-encode
bitcoin160
bitcoin256
btc-to-satoshi
ec-add
ec-add-secrets
ec-multiply
ec-multiply-secrets
ec-new
ec-to-address
ec-to-public
ec-to-wif
fetch-balance
fetch-header
fetch-height
fetch-history
fetch-stealth
fetch-tx
fetch-tx-index
hd-new
hd-private
hd-public
hd-to-address
hd-to-ec
hd-to-public
hd-to-wif
help
input-set
input-sign
input-validate
message-sign
message-validate
mnemonic-decode
mnemonic-encode
ripemd160
satoshi-to-btc
script-decode
script-encode
script-to-address
seed
send-tx
send-tx-node
send-tx-p2p
settings
sha160
sha256
sha512
stealth-decode
stealth-encode
stealth-public
stealth-secret
stealth-shared
tx-decode
tx-encode
uri-decode
uri-encode
validate-tx
watch-address
wif-to-ec
wif-to-public
wrap-decode
wrap-encode</pre>
</div>
</div>
<div class="paragraph data-line-2325">
<p>Para maiores informações, veja a <a href="https://github.com/libbitcoin/libbitcoin-explorer" data-href="https://github.com/libbitcoin/libbitcoin-explorer">página do Bitcoin Explorer</a> e a <a href="https://github.com/libbitcoin/libbitcoin-explorer/wiki" data-href="https://github.com/libbitcoin/libbitcoin-explorer/wiki">documentação do usuário do Bitcoin Explorer</a>.</p>
</div>
<div class="paragraph data-line-2327">
<p>=== Exemplos de Uso do Comando bx</p>
</div>
<div class="paragraph data-line-2329">
<p>Vamos dar uma olhada em alguns exemplos usando comandos do Bitcoin Explorer para trabalharmos com chaves e endereços:</p>
</div>
<div class="paragraph data-line-2331">
<p>Gera um valor "semente" aleatório usando o comando seed, que usa o gerador de números aleatórios do sistema operacional. Passe a semente para o comando ec-new para gerar uma nova chave privada. Salvamos o output padrão no arquivo <em>private_key</em>:</p>
</div>
<div class="listingblock data-line-2333">
<div class="content">
<pre>$ bx seed | bx ec-new &gt; private_key
$ cat private_key
73096ed11ab9f1db6135857958ece7d73ea7c30862145bcc4bbc7649075de474</pre>
</div>
</div>
<div class="paragraph data-line-2339">
<p>Agora, gere a chave pública a partir da chave privada usando o comando ec-to-public. Passamos o arquivo <em>private_key</em> no input padrão e salvamos o output padrão do comando em um novo arquivo <em>public_key</em>:</p>
</div>
<div class="listingblock data-line-2341">
<div class="content">
<pre>$ bx ec-to-public &lt; private_key &gt; public_key
$ cat public_key
02fca46a6006a62dfdd2dbb2149359d0d97a04f430f12a7626dd409256c12be500</pre>
</div>
</div>
<div class="paragraph data-line-2347">
<p>Podemos reformatar a public_key como um endereço usando o comando ec-to-address. Passamos a <em>public_key</em> no input padrão:</p>
</div>
<div class="listingblock data-line-2349">
<div class="content">
<pre>$ bx ec-to-address &lt; public_key
17re1S4Q8ZHyCP8Kw7xQad1Lr6XUzWUnkG</pre>
</div>
</div>
<div class="paragraph data-line-2354">
<p>Chaves geradas dessa maneira produzem uma carteira não determinística tipo-0. Isso significa que cada chave é gerada a partir de uma semente independente. Os comandos do Bitcoin Explorer também podem gerar chaves deterministicamente, de acordo com a BIP-32. Nesse caso, uma chave "mestre" é criada a partir da semente e então é estendida deterministicamente para produzir uma árvore de subchaves, resultando em uma carteira determinística tipo-2.</p>
</div>
<div class="paragraph data-line-2356">
<p>Primeiro, usaremos os comandos seed e hd-new para gerar uma chave mestre que será usada como a base para derivar uma hierarquia de chaves.</p>
</div>
<div class="listingblock data-line-2358">
<div class="content">
<pre>$ bx seed &gt; seed
$ cat seed
eb68ee9f3df6bd4441a9feadec179ff1

$ bx hd-new &lt; seed &gt; master
$ cat master
xprv9s21ZrQH143K2BEhMYpNQoUvAgiEjArAVaZaCTgsaGe6LsAnwubeiTcDzd23mAoyizm9cApe51gNfLMkBqkYoWWMCRwzfuJk8RwF1SVEpAQ</pre>
</div>
</div>
<div class="paragraph data-line-2368">
<p>Agora usaremos o comando hd-private para gerar uma chave de "conta" dificultada e uma sequência de duas chaves privadas no interior da conta:</p>
</div>
<div class="listingblock data-line-2370">
<div class="content">
<pre>$ bx hd-private --hard &lt; master &gt; account
$ cat account
xprv9vkDLt81dTKjwHB8fsVB5QK8cGnzveChzSrtCfvu3aMWvQaThp59ueufuyQ8Qi3qpjk4aKsbmbfxwcgS8PYbgoR2NWHeLyvg4DhoEE68A1n

$ bx hd-private --index 0 &lt; account
xprv9xHfb6w1vX9xgZyPNXVgAhPxSsEkeRcPHEUV5iJcVEsuUEACvR3NRY3fpGhcnBiDbvG4LgndirDsia1e9F3DWPkX7Tp1V1u97HKG1FJwUpU

$ bx hd-private --index 1 &lt; account
xprv9xHfb6w1vX9xjc8XbN4GN86jzNAZ6xHEqYxzbLB4fzHFd6VqCLPGRZFsdjsuMVERadbgDbziCRJru9n6tzEWrASVpEdrZrFidt1RDfn4yA3</pre>
</div>
</div>
<div class="paragraph data-line-2382">
<p>A seguir usaremos o comando hd-public para gerar a sequência correspondente de duas chaves públicas.</p>
</div>
<div class="listingblock data-line-2384">
<div class="content">
<pre>$ bx hd-public --index 0 &lt; account
xpub6BH1zcTuktiFu43rUZ2gXqLgzu5F3tLEeTQ5t6iE3aQtM2VMTxMcyLN9fYHiGhGpQe9QQYmqL2eYPFJ3vezHz5wzaSW4FiGrseNDR4LKqTy

$ bx hd-public --index 1 &lt; account
xpub6BH1zcTuktiFx6CzhPbGjG3UYQ13WR16CmtbPiagEKpEVtpyjshWyMaMV1cn7nUPUkgQHPVXJVqsrA8xWbGQDhohEcDFTEYMvYzwRD7Juf8</pre>
</div>
</div>
<div class="paragraph data-line-2392">
<p>As chaves públicas também podem ser derivadas a partir de suas chaves privadas correspondentes ao utilizar-se ocomando hd-to-public:</p>
</div>
<div class="listingblock data-line-2394">
<div class="content">
<pre>$ bx hd-private --index 0 &lt; account | bx hd-to-public
xpub6BH1zcTuktiFu43rUZ2gXqLgzu5F3tLEeTQ5t6iE3aQtM2VMTxMcyLN9fYHiGhGpQe9QQYmqL2eYPFJ3vezHz5wzaSW4FiGrseNDR4LKqTy

$ bx hd-private --index 1 &lt; account | bx hd-to-public
xpub6BH1zcTuktiFx6CzhPbGjG3UYQ13WR16CmtbPiagEKpEVtpyjshWyMaMV1cn7nUPUkgQHPVXJVqsrA8xWbGQDhohEcDFTEYMvYzwRD7Juf8</pre>
</div>
</div>
<div class="paragraph data-line-2402">
<p>Podemos gerar um número praticamente ilimitado de chaves em uma cadeia determinística, todas derivadas de uma única semente. Essa técnica é usada em muitas aplicações de carteira para gerar chaves que podem ser usadas em back ups e restauradas com um valor único de semente. Isso é mais fácil do que ter que fazer back up de toda a carteira com todas suas chaves geradas aleatoriamente cada vez que uma nova chave for criada.</p>
</div>
<div class="paragraph data-line-2404">
<p>A semente pode ser codificada usando o comando mnemonic-encode:</p>
</div>
<div class="listingblock data-line-2406">
<div class="content">
<pre>$ bx hd-mnemonic &lt; seed &gt; words
adore repeat vision worst especially veil inch woman cast recall dwell appreciate</pre>
</div>
</div>
<div class="paragraph data-line-2411">
<p>A semente pode ser decodificada usando o comando mnemonic-decode:</p>
</div>
<div class="listingblock data-line-2413">
<div class="content">
<pre>$ bx mnemonic-decode &lt; words
eb68ee9f3df6bd4441a9feadec179ff1</pre>
</div>
</div>
<div class="paragraph data-line-2418">
<p>A codificação do mnemônico pode facilitar a gravação da semente e até mesmo lembrar dela.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. "Bitcoin: A Peer-to-Peer Electronic Cash System," Satoshi Nakamoto (<a href="https://bitcoin.org/bitcoin.pdf" class="undefined" data-href="https://bitcoin.org/bitcoin.pdf">https://bitcoin.org/bitcoin.pdf</a>).
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-07-10 05:56:35 -0400
</div>
</div>
</body>
</html>