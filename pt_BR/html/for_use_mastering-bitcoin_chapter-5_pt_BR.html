<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>Carteiras</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article data-line-1">
<div id="header">
</div>
<div id="content">
<div class="sect1 data-line-2">
<h2 id="ch05_wallets">Carteiras</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>A palavra "carteira" é usada para descrever diferentes coisas no bitcoin.</p>
</div>
<div class="paragraph data-line-6">
<p>De maneira geral, uma carteira é um aplicativo que serve como a interface de usuário principal. A carteira controla o acesso ao dinheiro do usuário ao gerenciar chaves e endereços, controlar o saldo, criar transações e assinar transações.</p>
</div>
<div class="paragraph data-line-8">
<p>Mais precisamente, do ponto de vista de um programador, a palavra "carteira" refere-se à estrutura de dados usada para armazenar e gerenciar as chaves de um usuário.</p>
</div>
<div class="paragraph data-line-10">
<p>Neste capítulo, veremos o segundo significado, em que as carteiras são lugares para armazenar chaves privadas, geralmente implementados como arquivos estruturados ou bancos de dados simples.</p>
</div>
<div class="sect2 data-line-12">
<h3 id="_visão_geral_da_tecnologia_de_carteira">Visão Geral da Tecnologia de Carteira</h3>
<div class="paragraph data-line-14">
<p>Nesta seção, resumimos as várias tecnologias usadas para construir carteiras de bitcoin fáceis de usar, seguras e versáteis.</p>
</div>
<div class="paragraph data-line-16">
<p>A common misconception about bitcoin is that bitcoin wallets contain bitcoin. In fact, the wallet contains only keys. The "coins" are recorded in the blockchain on the Bitcoin network. Users control the coins on the network by signing transactions with the keys in their wallets. In a sense, a bitcoin wallet is a <em>keychain</em>.</p>
</div>
<div class="admonitionblock tip data-line-19">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-20">
<p>As carteiras de bitcoin contêm chaves, e não moedas. Cada usuário tem uma carteira que contém chaves. As carteiras, na verdade, são chaveiros que contêm pares de chaves privadas/públicas (veja <a href="#private_public_keys">[private_public_keys]</a>). Os usuários assinam transações com as suas chaves, provando que possuem as saídas de transação (provando que são donos de suas moedas). As moedas são armazenadas na blockchain na forma de saídas de transação (frequentemente denominadas como vout ou txout).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-23">
<p>Existem dois tipos principais de carteiras, que são distinguidas pelo fato de suas chaves estarem relacionadas entre si ou não.</p>
</div>
<div class="paragraph data-line-25">
<p>O primeiro tipo é uma <em>carteira não determinística</em>, em que cada chave é gerada independentemente a partir de um número aleatório. As chaves não estão relacionadas entre si. Este tipo de carteira também é conhecido como uma carteira JBOK, da frase em inglês "<em>Just a Bunch of Keys</em>" ("Apenas um Monte de Chaves").</p>
</div>
<div class="paragraph data-line-27">
<p>O segundo tipo de carteira é uma <em>carteira determinística</em>, em que todas as chaves são derivadas de uma única chave mestra, conhecida como a <em>semente</em>. Todas as chaves neste tipo de carteira estão relacionadas umas com as outras e podem ser geradas novamente por alguém que tiver a semente original. Existem vários métodos diferentes de <em>derivação de chaves</em> usados ​​em carteiras determinísticas. O método de derivação mais comumente usado utiliza uma estrutura semelhante a uma árvore e é conhecido como <em>carteira determinística hierárquica</em> ou carteira <em>HD</em>.</p>
</div>
<div class="paragraph data-line-29">
<p>As carteiras determinísticas são inicializadas a partir de uma sequência aleatória (uma entropia). Para facilitar o uso, as sequências aleatórias são codificadas como palavras em inglês, também conhecidas como <em>palavras de código mnemônico</em>.</p>
</div>
<div class="paragraph data-line-31">
<p>As próximas seções apresentarão uma visão geral de cada uma dessas tecnologias.</p>
</div>
<div class="sect3 data-line-34">
<h4 id="random_wallet">Carteiras Não Determinísticas (Aleatórias)</h4>
<div class="paragraph data-line-36">
<p>In the first bitcoin wallet (now called Bitcoin Core), wallets were collections of randomly generated private keys. For example, the original Bitcoin Core client pregenerates 100 random private keys when first started and generates more keys as needed, using each key only once.  Such wallets are being replaced with deterministic wallets because they are cumbersome to manage, back up, and import. The disadvantage of random keys is that if you generate many of them you must keep copies of all of them, meaning that the wallet must be backed up frequently. Each key must be backed up, or the funds it controls are irrevocably lost if the wallet becomes inaccessible. This conflicts directly with the principle of avoiding address reuse, by using each Bitcoin address for only one transaction. Address reuse reduces privacy by associating multiple transactions and addresses with each other. A Type-0 nondeterministic wallet is a poor choice of wallet, especially if you want to avoid address reuse because it means managing many keys, which creates the need for frequent backups. Although the Bitcoin Core client includes a Type-0 wallet, using this wallet is discouraged by developers of Bitcoin Core. <a href="#Type0_wallet">Carteira não determinística (aleatória) do tipo 0: uma coleção de chaves geradas aleatoriamente</a> shows a nondeterministic wallet, containing a loose collection of random keys.</p>
</div>
<div class="admonitionblock tip data-line-39">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-40">
<p>O uso de carteiras não determinísticas é desencorajado para qualquer uso que não seja para se fazer testes simples. Elas são simplesmente incômodas demais para fazer backup e para serem usadas. Em vez disso, use uma <em>carteira HD</em> baseada no padrão da indústria com uma sequência aleatória <em>mnemônica</em> (uma entropia ou "semente inicial") para backup.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="Type0_wallet" class="imageblock smallersixty data-line-46">
<div class="content">
<img src="images/mbc2_0501.png" alt="Non-Deterministic Wallet">
</div>
<div class="title">Figure 1. Carteira não determinística (aleatória) do tipo 0: uma coleção de chaves geradas aleatoriamente</div>
</div>
</div>
<div class="sect3 data-line-48">
<h4 id="_carteiras_determinísticas_com_semente">Carteiras Determinísticas (com Semente)</h4>
<div class="paragraph data-line-50">
<p>As carteiras determinísticas, ou "carteiras com semente", são carteiras que contêm chaves privadas que são todas derivadas de uma semente comum, através do uso de uma função de hash de sentido único. A semente é um número gerado aleatoriamente que é combinado com outros dados, como um número índice ou "código de cadeia" (veja <a href="#hd_wallets">Carteiras HD (BIP-32/BIP-44)</a>), para derivar as chaves privadas. Em uma carteira determinística, a semente é a única informação necessária para se recuperar todas as chaves derivadas e, portanto, um único backup no momento da criação da carteira é suficiente. A semente também é a única informação necessária para se exportar ou importar a carteira, permitindo a fácil migração de todas as chaves do usuário entre diferentes implementações de carteira. A <a href="#Type1_wallet">Carteira determinística tipo 1 (com semente): uma sequência determinística de chaves derivadas a partir de uma semente</a> mostra um diagrama lógico de uma carteira determinística.</p>
</div>
<div id="Type1_wallet" class="imageblock smallersixty data-line-55">
<div class="content">
<img src="images/mbc2_0502.png" alt="Deterministic Wallet">
</div>
<div class="title">Figure 2. Carteira determinística tipo 1 (com semente): uma sequência determinística de chaves derivadas a partir de uma semente</div>
</div>
</div>
<div class="sect3 data-line-58">
<h4 id="hd_wallets">Carteiras HD (BIP-32/BIP-44)</h4>
<div class="paragraph data-line-60">
<p>As carteiras determinísticas foram desenvolvidas para facilitar a derivação de várias chaves a partir de uma única "semente". A forma mais avançada de carteira determinística é a carteira HD definida pelo padrão BIP-32. As carteiras HD contêm chaves derivadas em uma estrutura em forma de árvore, de tal forma que uma chave pai pode derivar uma sequência de chaves filhas, e cada uma das quais pode derivar uma sequência de chaves netas, e assim por diante, até uma profundidade infinita. Essa estrutura em forma de árvore é ilustrada na <a href="#Type2_wallet">Carteira HD tipo 2: uma árvore de chaves geradas a partir de uma única semente</a>.</p>
</div>
<div id="Type2_wallet" class="imageblock data-line-64">
<div class="content">
<img src="images/mbc2_0503.png" alt="HD wallet">
</div>
<div class="title">Figure 3. Carteira HD tipo 2: uma árvore de chaves geradas a partir de uma única semente</div>
</div>
<div class="paragraph data-line-66">
<p>As carteiras HD oferecem duas grandes vantagens em relação às chaves aleatórias (não determinísticas). Primeiro, a estrutura em forma de árvore pode ser usada para expressar significado organizacional adicional, por exemplo, quando um ramo específico de subchaves é usado para receber pagamentos e um ramo diferente é usado para receber trocos de pagamentos efetuados. Os ramos de chaves também podem ser usados em cenários corporativos, alocando diferentes ramos a diferentes departamentos, subsidiárias, funções específicas ou categorias contábeis.</p>
</div>
<div class="paragraph data-line-68">
<p>A segunda vantagem das carteiras HD é que os usuários podem criar uma sequência de chaves públicas sem precisar ter acesso às chaves privadas correspondentes. Isso permite que carteiras HD sejam utilizadas em um servidor inseguro, ou em uma aplicação que somente recebe pagamentos, emitindo uma chave pública diferente para cada transação. As chaves públicas não precisam ser previamente carregadas ou derivadas, apesar de o servidor não deter as chaves privadas que podem gastar os fundos.</p>
</div>
</div>
<div class="sect3 data-line-70">
<h4 id="_sementes_e_códigos_mnemônicos_bip_39">Sementes e Códigos Mnemônicos (BIP-39)</h4>
<div class="paragraph data-line-72">
<p>As carteiras HD são um mecanismo muito poderoso para gerenciar várias chaves e endereços. Elas são ainda mais úteis se forem combinadas com uma maneira padronizada de se criar sementes a partir de uma sequência de palavras em inglês que sejam fáceis de transcrever, exportar e importar entre carteiras. Essa sequência de palavras é conhecida como <em>mnemônico</em>, e o padrão é definido pela BIP-39. Hoje, a maioria das carteiras de bitcoin (e das carteiras de outras criptomoedas) usa esse padrão, que permite a importação e a exportação de sementes para backup e recuperação usando mnemônicos interoperáveis.</p>
</div>
<div class="paragraph data-line-74">
<p>Vamos analisar isso sob um ponto de vista prático. Qual das seguintes sementes é mais fácil de ser transcrita, anotada em um papel, lida sem erros, exportada e importada para uma outra carteira?</p>
</div>
<div class="listingblock data-line-77">
<div class="title">Uma semente para uma carteira determinística, exibida no formato hexadecimal</div>
<div class="content">
<pre>0C1E24E5917779D297E14D45F14E1A1A</pre>
</div>
</div>
<div class="listingblock data-line-82">
<div class="title">Uma semente para uma carteira determinística, codificada em um mnemônico de 12 palavras</div>
<div class="content">
<pre>army van defense carry jealous true
garbage claim echo media make crunch</pre>
</div>
</div>
</div>
<div class="sect3 data-line-87">
<h4 id="_melhores_práticas_de_carteira">Melhores Práticas de Carteira</h4>
<div class="paragraph data-line-89">
<p>Conforme a tecnologia das carteiras de bitcoin amadureceu, alguns padrões comuns da indústria foram surgindo, tornando as carteiras de bitcoin amplamente interoperáveis, fáceis de usar, seguras e flexíveis. Esses padrões comuns são:</p>
</div>
<div class="ulist data-line-91">
<ul>
<li class="data-line-91">
<p>Palavras de código mnemônico, com base na BIP-39</p>
</li>
<li class="data-line-92">
<p>Carteiras HD, com base na BIP-32</p>
</li>
<li class="data-line-93">
<p>Estrutura de carteira HD multifuncional, com base na BIP-43</p>
</li>
<li class="data-line-94">
<p>Carteiras multimoedas e multicontas, com base na BIP-44</p>
</li>
</ul>
</div>
<div class="paragraph data-line-96">
<p>Esses padrões podem mudar ou tornarem-se obsoletos por desenvolvimentos futuros, mas, por enquanto, eles formam um conjunto de tecnologias interligadas que se tornaram o padrão amplamente reconhecido de carteira para bitcoin.</p>
</div>
<div class="paragraph data-line-98">
<p>Os padrões foram adotados por uma ampla variedade de carteiras de bitcoin de software e hardware, tornando todas essas carteiras interoperáveis. Um usuário pode exportar um mnemônico gerado em uma dessas carteiras e importá-lo em outra carteira, recuperando todas as transações, chaves e endereços.</p>
</div>
<div class="paragraph data-line-100">
<p>Alguns exemplos de carteiras de software que suportam esses padrões incluem (listadas em ordem alfabética) a Breadwallet, a Copay e a Multibit HD. Exemplos de carteiras de hardware que suportam esses padrões incluem (listadas em ordem alfabética) a KeepKey, a Ledger e a Trezor.</p>
</div>
<div class="paragraph data-line-102">
<p>Nas seções a seguir examinaremos cada uma dessas tecnologias em maiores detalhes.</p>
</div>
<div class="admonitionblock tip data-line-105">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-106">
<p>Se você estiver implementando uma carteira de bitcoin, ela deve ser construída como uma carteira HD, com uma semente derivada de, e codificada como, um código mnemônico para backup, seguindo os padrões BIP-32, BIP-39, BIP-43 e BIP-44, conforme descrito nas próximas seções.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-109">
<h4 id="_usando_uma_carteira_de_bitcoin">Usando uma Carteira de Bitcoin</h4>
<div class="paragraph data-line-111">
<p>Em <a href="#user-stories">[user-stories]</a> apresentamos o Gabriel, um adolescente empreendedor do Rio de Janeiro, que gerencia uma pequena loja virtual que vende camisetas, canecas e adesivos com a marca bitcoin.</p>
</div>
<div class="paragraph data-line-113">
<p>Gabriel usa uma carteira de hardware da marca Trezor (<a href="#a_trezor_device">Um dispositivo Trezor: uma carteira HD de bitcoin em hardware</a>)  para gerenciar seus bitcoins com segurança. A Trezor é um dispositivo USB simples com dois botões que armazena chaves (na forma de uma carteira HD) e assina transações. As carteiras Trezor implementam todos os padrões da indústria discutidos neste capítulo, então o Gabriel não depende de nenhuma tecnologia proprietária ou solução de um único fornecedor.</p>
</div>
<div id="a_trezor_device" class="imageblock data-line-117">
<div class="content">
<img src="images/mbc2_0504.png" alt="alt">
</div>
<div class="title">Figure 4. Um dispositivo Trezor: uma carteira HD de bitcoin em hardware</div>
</div>
<div class="paragraph data-line-119">
<p>Quando o Gabriel usou a Trezor pela primeira vez, o dispositivo gerou uma sequência aleatória (uma entropia), o mnemônico associado e derivou uma semente a partir de um gerador de número aleatório embutido no próprio hardware. Durante esta fase de inicialização, a carteira exibiu na tela uma sequência de palavras numeradas, uma de cada vez (ver a <a href="#trezor_mnemonic_display">Trezor exibindo uma das palavras mnemônicas</a>).</p>
</div>
<div id="trezor_mnemonic_display" class="imageblock data-line-123">
<div class="content">
<img src="images/mbc2_0505.png" alt="Trezor wallet display of mnemonic word">
</div>
<div class="title">Figure 5. Trezor exibindo uma das palavras mnemônicas</div>
</div>
<div class="paragraph data-line-125">
<p>Ao anotar este mnemônico em um papel, Gabriel criou um backup (ver a <a href="#mnemonic_paper_backup">O backup em papel do mnemônico de Gabriel</a>) que pode ser usado para recuperação em caso de perda ou dano ao dispositivo Trezor. Este mnemônico pode ser usado para recuperação em uma nova Trezor ou em qualquer uma entre várias carteiras de software ou hardware compatíveis. Note que a ordem das palavras é importante, e por causa disso os papéis para backup de mnemônico têm lacunas numeradas que são reservadas para cada palavra. Gabriel teve que anotar cuidadosamente cada palavra na lacuna numerada, a fim de preservar a ordem correta das palavras.</p>
</div>
<table id="mnemonic_paper_backup" class="tableblock frame-all grid-all data-line-130" style="width: 80%;">
<caption class="title">Table 1. O backup em papel do mnemônico de Gabriel</caption>
<colgroup>
<col style="width: 0.9803%;">
<col style="width: 49.0196%;">
<col style="width: 0.9803%;">
<col style="width: 49.0198%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>1.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>army</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>7.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>garbage</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>2.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>van</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>8.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>claim</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>3.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>defense</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>9.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>echo</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>4.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>carry</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>10.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>media</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>5.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>jealous</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>11.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>make</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>6.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>true</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>12.</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>crunch</em></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note data-line-140">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-141">
<p>Um mnemônico de 12 palavras é mostrado na <a href="#mnemonic_paper_backup">O backup em papel do mnemônico de Gabriel</a>, para simplificar. Na verdade, a maioria das carteiras de hardware gera um mnemônico de 24 palavras, que é mais seguro. O mnemônico é usado exatamente da mesma maneira, independentemente da quantidade de palavras que ele possui.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-144">
<p>For the first implementation of his web store, Gabriel uses a single Bitcoin address, generated on his Trezor device. This single address is used by all customers for all orders. As we will see, this approach has some drawbacks and can be improved upon with an HD wallet.</p>
</div>
</div>
</div>
<div class="sect2 data-line-146">
<h3 id="_detalhes_da_tecnologia_de_carteira">Detalhes da Tecnologia de Carteira</h3>
<div class="paragraph data-line-148">
<p>Vamos agora examinar detalhadamente cada um dos importantes padrões da indústria usados por muitas carteiras de bitcoin.</p>
</div>
<div class="sect3 data-line-151">
<h4 id="mnemonic_code_words">Palavras de Código Mnemônico (BIP-39)</h4>
<div class="paragraph data-line-153">
<p>As palavras de código mnemônico são sequências de palavras que representam (codificam) um número aleatório que é usado como uma semente para se derivar uma carteira determinística. A sequência de palavras é a única informação necessária para se recriar a semente e, a partir dela, recriar a carteira e todas as suas chaves derivadas. Um aplicativo de carteira que usa carteiras determinísticas com palavras mnemônicas exibirá ao usuário uma sequência de 12 a 24 palavras quando a carteira for criada pela primeira vez. Essa sequência de palavras é o backup da carteira e pode ser usada para recuperar e recriar todas as chaves no mesmo aplicativo ou em qualquer aplicativo de carteira compatível. As palavras mnemônicas facilitam a criação de backups de carteiras pelos usuários, pois elas são fáceis de serem lidas e de serem corretamente transcritas, quando comparadas a uma sequência de números aleatórios.</p>
</div>
<div class="admonitionblock tip data-line-156">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-157">
<p>As palavras mnemônicas costumam ser confundidas com as "carteiras cerebrais" (em inglês, <em>brainwallets</em>). Elas não são a mesma coisa. A principal diferença é que uma carteira cerebral consiste em palavras que são escolhidas pelo próprio usuário, enquanto as palavras mnemônicas são criadas aleatoriamente pela carteira e depois são apresentadas ao usuário. Essa importante diferença torna as palavras mnemônicas muito mais seguras, pois os humanos são fontes muito pobres de aleatoriedade.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-160">
<p>Os códigos mnemônicos são definidos na BIP-39 (consulte o <a href="#appdxbitcoinimpproposals">[appdxbitcoinimpproposals]</a>). Observe que a BIP-39 é uma implementação de um padrão de código mnemônico. Existe também um padrão diferente, com um conjunto diferente de palavras, usado pela carteira Electrum, mais antigo do que a BIP-39. O padrão BIP-39 foi proposto pela empresa responsável pela carteira de hardware Trezor e não é compatível com a implementação da Electrum. No entanto, o padrão BIP-39 já obteve amplo suporte da indústria em dezenas de implementações interoperáveis e, atualmente, deve ser considerado o padrão "oficial" da indústria.</p>
</div>
<div class="paragraph data-line-162">
<p>A BIP-39 define a criação de um código mnemônico e de uma semente, que descrevemos aqui em nove etapas. Para maior clareza, o processo é dividido em duas partes: as etapas de 1 a 6 são mostradas em <a href="#generating_mnemonic_words">Gerando palavras mnemônicas</a> e as etapas de 7 a 9 são mostradas em <a href="#mnemonic_to_seed">Do mnemônico à semente</a>.</p>
</div>
<div class="sect4 data-line-165">
<h5 id="generating_mnemonic_words">Gerando palavras mnemônicas</h5>
<div class="paragraph data-line-167">
<p>As palavras mnemônicas são geradas automaticamente pela carteira usando o processo padronizado definido na BIP-39. A carteira começa a partir de uma fonte de entropia, adiciona uma soma de verificação (um <em>checksum</em>) e então mapeia a entropia para uma lista de palavras:</p>
</div>
<div class="olist arabic data-line-169">
<ol class="arabic">
<li class="data-line-169">
<p>Cria uma sequência aleatória (entropia) de 128 a 256 bits.</p>
</li>
<li class="data-line-170">
<p>Cria uma soma de verificação (<em>checksum</em>) da sequência aleatória tomando os primeiros (comprimento da entropia/32) bits de seu hash SHA256.</p>
</li>
<li class="data-line-171">
<p>Adiciona a soma de verificação (<em>checksum</em>) no final da sequência aleatória.</p>
</li>
<li class="data-line-172">
<p>Divide o resultado em segmentos com 11 bits de comprimento.</p>
</li>
<li class="data-line-173">
<p>Mapeia cada valor de 11 bits para uma palavra do dicionário predefinido de 2.048 palavras.</p>
</li>
<li class="data-line-174">
<p>O código mnemônico é a sequência de palavras.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-176">
<p>A <a href="#generating_entropy_and_encoding">Gerando entropia e codificando como palavras mnemônicas</a> mostra como a entropia é usada para gerar palavras mnemônicas.</p>
</div>
<div id="generating_entropy_and_encoding" class="imageblock smallerseventy data-line-181">
<div class="content">
<img src="images/mbc2_0506.png" alt="Generating entropy and encoding as mnemonic words">
</div>
<div class="title">Figure 6. Gerando entropia e codificando como palavras mnemônicas</div>
</div>
<div class="paragraph data-line-183">
<p>A <a href="#table_4-5">Códigos mnemônicos: entropia e comprimento da palavra</a> mostra a relação entre o tamanho dos dados de entropia e o comprimento em palavras dos códigos mnemônicos.</p>
</div>
<table id="table_4-5" class="tableblock frame-all grid-all stretch data-line-188">
<caption class="title">Table 2. Códigos mnemônicos: entropia e comprimento da palavra</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Entropia (bits)</th>
<th class="tableblock halign-left valign-top"><em>Checksum</em> (bits)</th>
<th class="tableblock halign-left valign-top">Entropia <strong>+</strong> <em>checksum</em> (bits)</th>
<th class="tableblock halign-left valign-top">Comprimento do mnemônico (palavras)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">132</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">160</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">165</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">192</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">198</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">18</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">224</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">231</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">21</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">264</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4 data-line-198">
<h5 id="mnemonic_to_seed">Do mnemônico à semente</h5>
<div class="paragraph data-line-200">
<p>As palavras mnemônicas representam uma entropia com um comprimento de 128 a 256 bits. A entropia é então usada para derivar uma semente mais longa (de 512 bits) através do uso da função de alongamento de chaves PBKDF2. A semente produzida é então usada para construir uma carteira determinística e derivar suas chaves.</p>
</div>
<div class="paragraph data-line-202">
<p>A função de alongamento de chaves usa dois parâmetros: o mnemônico e um <em>sal</em> (em inglês, <em>salt</em>). O propósito de um sal em uma função de alongamento de chaves é dificultar a construção de uma tabela de pesquisa (em inglês, <em>lookup table</em>) que permita um ataque de força bruta. No padrão BIP-39, o sal tem outra finalidade&#x2014;ele permite a utilização de uma frase de senha (em inglês, <em>passphrase</em>) que serve como um fator de segurança adicional protegendo a semente, como descreveremos em mais detalhes em <a href="#mnemonic_passphrase">Frase de senha (<em>passphrase</em>) opcional no padrão BIP-39</a>.</p>
</div>
<div class="paragraph data-line-204">
<p>O processo descrito nas etapas 7 a 9 é a continuação do processo descrito anteriormente em <a href="#generating_mnemonic_words">Gerando palavras mnemônicas</a>:</p>
</div>
<ol start="7">
	<li>O primeiro parâmetro para a função de alongamento de chaves PBKDF2 é o <em>mnemônico</em> produzido na etapa 6.</li>
	<li>O segundo parâmetro para a função de alongamento de chaves PBKDF2 é um <em>sal</em>. O sal é composto pela _string_ constante "<code>mnemonic</code>" concatenada com uma _string_ opcional da frase de senha fornecida pelo usuário.</li>
	<li>A PBKDF2 estende os parâmetros mnemônico e sal usando 2.048 rodadas de hash com o algoritmo HMAC-SHA512, produzindo um valor de 512 bits como sua saída final. Esse valor de 512 bits é a semente.</li>
</ol>
<div class="paragraph data-line-214">
<p>A <a href="#fig_5_7">Do mnemônico à semente</a> mostra como um mnemônico é usado para gerar uma semente.</p>
</div>
<div id="fig_5_7" class="imageblock data-line-218">
<div class="content">
<img src="images/mbc2_0507.png" alt="From mnemonic to seed">
</div>
<div class="title">Figure 7. Do mnemônico à semente</div>
</div>
<div class="admonitionblock tip data-line-221">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-222">
<p>A função de alongamento de chaves, com suas 2.048 rodadas de <em>hashing</em>, é uma proteção muito eficaz contra ataques de força bruta contra o mnemônico ou a frase de senha. Torna-se extremamente custoso (em termos de esforço computacional) tentar mais do que algumas milhares de frases de senha e combinações mnemônicas, visto que o número possível de sementes derivadas é imenso (2<sup>512</sup>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-225">
<p>As Tabelas <a data-type="xref" href="#mnemonic_128_no_pass" data-xrefstyle="select: labelnumber">#mnemonic_128_no_pass</a>, <a data-type="xref" href="#mnemonic_128_w_pass" data-xrefstyle="select: labelnumber">#mnemonic_128_w_pass</a> e <a data-type="xref" href="#mnemonic_256_no_pass" data-xrefstyle="select: labelnumber">#mnemonic_256_no_pass</a> demonstram alguns exemplos de códigos mnemônicos e as sementes que eles produzem (com ou sem uma frase de senha).</p>
</div>
<table id="mnemonic_128_no_pass" class="tableblock frame-all grid-all stretch data-line-230">
<caption class="title">Table 3. Código mnemônico com entropia de 128 bits, sem frase de senha, e a semente resultante</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Input de entropia (128 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">0c1e24e5917779d297e14d45f14e1a1a</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Mnemônico (12 palavras)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">army van defense carry jealous true garbage claim echo media make crunch</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Frase de senha</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">(nenhuma)</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Semente (512 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">5b56c417303faa3fcba7e57400e120a0ca83ec5a4fc9ffba757fbe63fbd77a89a1a3be4c67196f57c39
a88b76373733891bfaba16ed27a813ceed498804c0570</p></td>
</tr>
</tbody>
</table>
<table id="mnemonic_128_w_pass" class="tableblock frame-all grid-all stretch data-line-241">
<caption class="title">Table 4. Código mnemônico com entropia de 128 bits, com frase de senha, e a semente resultante</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Input de entropia (128 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">0c1e24e5917779d297e14d45f14e1a1a</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Mnemônico (12 palavras)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">army van defense carry jealous true garbage claim echo media make crunch</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Frase de senha</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">SuperDuperSecret</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Semente (512 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">3b5df16df2157104cfdd22830162a5e170c0161653e3afe6c88defeefb0818c793dbb28ab3ab091897d0
715861dc8a18358f80b79d49acf64142ae57037d1d54</p></td>
</tr>
</tbody>
</table>
<table id="mnemonic_256_no_pass" class="tableblock frame-all grid-all stretch data-line-253">
<caption class="title">Table 5. Código mnemônico com entropia de 256 bits, sem frase de senha, e a semente resultante</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Input de entropia (256 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">2041546864449caff939d32d574753fe684d3c947c3346713dd8423e74abcf8c</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Mnemônico (24 palavras)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">cake apple borrow silk endorse fitness top denial coil riot stay wolf
luggage oxygen faint major edit measure invite love trap field dilemma oblige</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Frase de senha</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">(nenhuma)</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><strong>Semente (512 bits)</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">3269bce2674acbd188d4f120072b13b088a0ecf87c6e4cae41657a0bb78f5315b33b3a04356e53d062e5
5f1e0deaa082df8d487381379df848a6ad7e98798404</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip data-line-263">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-264">
<p>Many wallets do not allow for the creation of wallets with more than a 12 word mnemonic phrase. You will notice from the tables above that despite the unique lengths of entropy input, the seed size remains the same (512 bits). From a security perspective, the amount of entropy actually used for the production of HD wallets is roughly 128 bits, which equals 12 words.  Providing more than 12 words produces additional entropy which is unnecessary, and this <em>unused</em> entropy is not used for the derivation of the seed in the way that one might initially suspect. From a usability perspective, 12 words is also easier to write down, back up, and store.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4 data-line-268">
<h5 id="mnemonic_passphrase">Frase de senha (<em>passphrase</em>) opcional no padrão BIP-39</h5>
<div class="paragraph data-line-270">
<p>O padrão BIP-39 permite o uso de uma frase de senha (<em>passphrase</em>) opcional na derivação da semente. Se nenhuma frase de senha for usada, o mnemônico é alongado com um sal que consiste na <em>string</em> constante "mnemonic", produzindo uma semente específica de 512 bits a partir de qualquer mnemônico fornecido. Se uma frase de senha for usada, a função de alongamento produz uma semente <em>diferente</em> a partir desse mesmo mnemônico. Ou seja, dado um único mnemônico, cada frase de senha possível gera uma semente diferente. Em outras palavras, não existe uma frase de senha "errada". Todas as frases de senha são válidas e todas elas geram sementes diferentes, formando um imenso conjunto de possíveis carteiras não inicializadas. O número de carteiras possíveis é tão grande (2<sup>512</sup>) que não há a possibilidade prática de se utilizar força bruta ou de se adivinhar acidentalmente alguma semente que já esteja em uso.</p>
</div>
<div class="admonitionblock tip data-line-273">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-274">
<p>Não há frases de senha "erradas" no padrão BIP-39. Cada frase de senha gera uma carteira, que, a menos que ela já tenha sido usada anteriormente, estará vazia.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-277">
<p>A frase de senha opcional cria dois recursos importantes:</p>
</div>
<div class="ulist data-line-279">
<ul>
<li class="data-line-279">
<p>Um segundo fator (algo memorizado) que torna um mnemônico inútil quando obtido isoladamente, protegendo os backups de mnemônicos de serem comprometidos por um ladrão.</p>
</li>
<li class="data-line-281">
<p>Uma forma de negação plausível ou "carteira de coação", quando se usa uma frase de senha para abrir uma carteira com uma pequena quantidade de fundos, a qual é usada para distrair um criminoso da carteira "verdadeira", que contém a maioria dos fundos.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-283">
<p>No entanto, é importante observar que o uso de uma frase de senha também introduz o risco de perda:</p>
</div>
<div class="ulist data-line-285">
<ul>
<li class="data-line-285">
<p>Se o dono da carteira ficar incapacitado ou vier a óbito e ninguém mais souber a frase de senha, o código mnemônico será inútil, e todos os fundos armazenados na carteira serão perdidos para sempre.</p>
</li>
<li class="data-line-287">
<p>Além disso, se o proprietário fizer o backup da frase de senha no mesmo lugar que o backup do código mnemônico, isso anulará o propósito de servir como um segundo fator.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-289">
<p>Embora as frases de senha sejam muito úteis, elas só devem ser usadas em combinação com um processo cuidadosamente planejado para backup e recuperação, que leve em consideração a possibilidade de que o proprietário venha a óbito no futuro, permitindo que sua família recupere as criptomoedas de herança.</p>
</div>
</div>
<div class="sect4 data-line-291">
<h5 id="_trabalhando_com_códigos_mnemônicos">Trabalhando com códigos mnemônicos</h5>
<div class="paragraph data-line-293">
<p>O padrão BIP-39 é implementado como uma biblioteca em muitas linguagens de programação diferentes:</p>
</div>
<div class="dlist data-line-295">
<dl>
<dt class="hdlist1"><a href="https://github.com/trezor/python-mnemonic" data-href="https://github.com/trezor/python-mnemonic">python-mnemonic</a></dt>
<dd>
<p>A implementação de referência do padrão feita pela equipe da SatoshiLabs, que propôs o padrão BIP-39, em Python</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/bitcoinjs/bip39" data-href="https://github.com/bitcoinjs/bip39">bitcoinjs/bip39</a></dt>
<dd>
<p>Uma implementação do padrão BIP-39, como parte do popular framework bitcoinJS, em JavaScript</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/libbitcoin/libbitcoin/blob/master/src/wallet/mnemonic.cpp" data-href="https://github.com/libbitcoin/libbitcoin/blob/master/src/wallet/mnemonic.cpp">libbitcoin/mnemonic</a></dt>
<dd>
<p>Uma implementação do padrão BIP-39, como parte do popular framework Libbitcoin, em <span class="keep-together">C++</span></p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3 data-line-301">
<h4 id="_criando_uma_carteira_hd_a_partir_da_semente">Criando uma Carteira HD a partir da Semente</h4>
<div class="paragraph data-line-303">
<p>As carteiras HD são criadas a partir de uma única <em>semente raiz</em>, que é um número aleatório de 128, 256 ou 512 bits. Mais comumente, essa semente é gerada a partir de um <em>mnemônico</em>, conforme detalhado na seção anterior.</p>
</div>
<div class="paragraph data-line-305">
<p>Cada chave na carteira HD é derivada deterministicamente a partir dessa semente raiz, o que torna possível recriar toda a carteira HD a partir dessa semente em qualquer carteira HD compatível. Isso torna mais fácil fazer backup, restaurar, exportar e importar carteiras HD contendo milhares ou até mesmo milhões de chaves, simplesmente transferindo apenas o mnemônico a partir do qual a semente raiz é derivada.</p>
</div>
<div class="paragraph data-line-307">
<p>O processo de criação das chaves mestras e do código de cadeia mestre para uma carteira HD é demonstrado na <a href="#HDWalletFromSeed">Criando as chaves mestras e o código de cadeia mestre a partir da semente raiz</a>.</p>
</div>
<div id="HDWalletFromSeed" class="imageblock data-line-311">
<div class="content">
<img src="images/mbc2_0509.png" alt="HDWalletFromRootSeed">
</div>
<div class="title">Figure 8. Criando as chaves mestras e o código de cadeia mestre a partir da semente raiz</div>
</div>
<div class="paragraph data-line-313">
<p>A semente raiz é usada como <em>input</em> no algoritmo HMAC-SHA512 e o hash resultante é usado para criar uma <em>chave privada mestra</em> (m) e um <em>código de cadeia mestre</em> (c).</p>
</div>
<div class="paragraph data-line-315">
<p>A chave privada mestra (m) então gera uma chave pública mestra (M) correspondente usando o processo normal de multiplicação de curva elíptica m * G que vimos em <a href="#pubkey">[pubkey]</a>.</p>
</div>
<div class="paragraph data-line-317">
<p>O código de cadeia (c) é usado para introduzir entropia na função que cria chaves filhas a partir de chaves pais, como veremos na próxima seção.</p>
</div>
<div class="sect4 data-line-319">
<h5 id="_derivação_de_chave_privada_filha">Derivação de chave privada filha</h5>
<div class="paragraph data-line-321">
<p>As carteiras HD usam uma função de <em>derivação de chaves filhas</em> (em inglês, <em>child key derivation</em> ou CKD) para derivar as chaves filhas a partir das chaves pais.</p>
</div>
<div class="paragraph data-line-323">
<p>As funções de derivação de chaves filhas são baseadas em uma função de hash de sentido único, que combina:</p>
</div>
<div class="ulist data-line-325">
<ul>
<li class="data-line-325">
<p>Uma chave pai privada ou pública (chave ECDSA comprimida)</p>
</li>
<li class="data-line-326">
<p>Uma semente chamada de código de cadeia (256 bits)</p>
</li>
<li class="data-line-327">
<p>Um número índice (32 bits)</p>
</li>
</ul>
</div>
<div class="paragraph data-line-329">
<p>O código de cadeia é usado para introduzir dados aleatórios determinísticos ao processo, de forma que saber o índice e uma chave filha não é suficiente para se derivar outras chaves filhas. Saber uma chave filha não torna alguém capaz de descobrir suas chaves irmãs, a menos que a pessoa também tenha o código de cadeia. A semente inicial do código de cadeia (na raiz da árvore) é feita a partir da semente, enquanto os códigos de cadeia filhos subsequentes são derivados de cada código de cadeia pai.</p>
</div>
<div class="paragraph data-line-331">
<p>Esses três itens (a chave pai, o código de cadeia e o índice) são combinados e depois submetidos a uma função de hash para gerar as chaves filhas, conforme abaixo descrito.</p>
</div>
<div class="paragraph data-line-333">
<p>A chave pública pai, o código de cadeia pai e o número índice são combinados e são submetidos a uma função de hash com o algoritmo HMAC-SHA512 para produzir um hash de 512 bits. Esse hash de 512 bits é dividido em duas metades de 256 bits. Os 256 bits da metade direita do hash resultante tornam-se o código de cadeia filho. Os 256 bits da metade esquerda do hash são adicionados à chave pai para produzir a chave privada filha. Na <a href="#CKDpriv">Estendendo uma chave privada pai para criar uma chave privada filha</a>, vemos isso ilustrado com o índice definido como 0 para produzir a chave privada filha "zero" (a primeira chave privada filha) da chave privada pai.</p>
</div>
<div id="CKDpriv" class="imageblock data-line-337">
<div class="content">
<img src="images/mbc2_0510.png" alt="ChildPrivateDerivation">
</div>
<div class="title">Figure 9. Estendendo uma chave privada pai para criar uma chave privada filha</div>
</div>
<div class="paragraph data-line-339">
<p>Mudar o índice nos permite estender a chave pai e criar as outras chaves filhas na sequência, por exemplo, Filha 0, Filha 1, Filha 2, etc. Cada chave pai pode ter 2.147.483.647 (2<sup>31</sup>) chaves filhas (2<sup>31</sup> é metade de todo o intervalo de 2<sup>32</sup> chaves que está disponível, pois a outra metade é reservada para um tipo especial de derivação, sobre a qual falaremos mais adiante neste capítulo).</p>
</div>
<div class="paragraph data-line-341">
<p>Repetindo o processo em um nível abaixo da árvore, cada chave filha pode virar uma chave pai e criar suas próprias filhas, em um número infinito de gerações.</p>
</div>
</div>
<div class="sect4 data-line-343">
<h5 id="_usando_as_chaves_filhas_derivadas">Usando as chaves filhas derivadas</h5>
<div class="paragraph data-line-345">
<p>As chaves privadas filhas são indistinguíveis das chaves não determinísticas (aleatórias). Como a função de derivação é uma função de sentido único, a chave filha não pode ser usada para se encontrar a chave pai. A chave filha também não pode ser usada para se encontrar chaves irmãs. Se você tiver a nª (enésima) filha, você não será capaz de encontrar as suas irmãs, como a filha n&#x2013;1 ou a filha n + 1, ou quaisquer outras filhas que façam parte da sequência. Apenas a chave pai e o código de cadeia são capazes de derivar todas as chaves filhas. Sem o código de cadeia filho, a chave filha também não pode ser usada para derivar nenhuma chave neta. Você precisa ter ambos, tanto a chave privada filha quanto o código de cadeia filho, para poder iniciar um novo ramo e derivar as chaves netas.</p>
</div>
<div class="paragraph data-line-347">
<p>So what can the child private key be used for on its own? It can be used to make a public key and a Bitcoin address. Then, it can be used to sign transactions to spend anything paid to that address.</p>
</div>
<div class="admonitionblock tip data-line-350">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-351">
<p>A child private key, the corresponding public key, and the Bitcoin address are all indistinguishable from keys and addresses created randomly. The fact that they are part of a sequence is not visible outside of the HD wallet function that created them. Once created, they operate exactly as "normal" keys.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4 data-line-354">
<h5 id="_chaves_estendidas">Chaves estendidas</h5>
<div class="paragraph data-line-356">
<p>Conforme vimos anteriormente, a função de derivação de chaves pode ser usada para criar chaves filhas em qualquer nível da árvore, baseando-se em três entradas (inputs): uma chave, um código de cadeia e o índice da filha desejada. Os dois ingredientes essenciais são a chave e o código de cadeia, que combinados são chamados de <em>chave estendida</em>. O termo "chave estendida" também poderia ser considerado como "chave extensível", pois esse tipo de chave pode ser usado para derivar chaves filhas.</p>
</div>
<div class="paragraph data-line-358">
<p>As chaves estendidas são armazenadas e representadas como uma simples concatenação da chave de 256 bits e do código de cadeia de 256 bits em uma sequência de 512 bits. Existem dois tipos de chaves estendidas. Uma chave privada estendida é a combinação de uma chave privada com um código de cadeia, e pode ser usada para derivar chaves privadas filhas (e, a partir delas, chaves públicas filhas). Uma chave pública estendida é a combinação de uma chave pública com um código de cadeia, e pode ser usada para criar chaves públicas filhas (<em>somente chaves públicas</em>), conforme descrito em <a href="#public_key_derivation">[public_key_derivation]</a>.</p>
</div>
<div class="paragraph data-line-360">
<p>Imagine uma chave estendida como se fosse a raiz de um ramo na estrutura em forma de árvore da carteira HD. Tendo a raiz do ramo, você pode derivar o resto do ramo. A chave privada estendida pode criar um ramo completo, ao passo que a chave pública estendida pode criar um ramo que tenha <em>apenas</em> chaves públicas.</p>
</div>
<div class="admonitionblock tip data-line-363">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-364">
<p>Uma chave estendida consiste em uma chave privada ou pública e um código de cadeia. Uma chave estendida pode criar chaves filhas, gerando o seu próprio ramo na estrutura em forma de árvore. Compartilhar uma chave estendida dá acesso a todo o ramo.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-367">
<p>As chaves estendidas são codificadas usando Base58Check, para facilitar a exportação e a importação entre diferentes carteiras compatíveis com a BIP-32. A codificação Base58Check para as chaves estendidas usa um número de versão especial que resulta nos prefixos "xprv" e "xpub" quando codificado em caracteres Base58, fazendo com que as chaves sejam mais facilmente reconhecíveis. Como a chave estendida tem 512 ou 513 bits, ela é muito mais longa do que qualquer uma das <em>strings</em> codificadas em Base58Check que vimos anteriormente.</p>
</div>
<div class="paragraph data-line-369">
<p>Esse é um exemplo de uma chave <em>privada</em> estendida, codificada em Base58Check:</p>
</div>
<div class="listingblock data-line-371">
<div class="content">
<pre>xprv9tyUQV64JT5qs3RSTJkXCWKMyUgoQp7F3hA1xzG6ZGu6u6Q9VMNjGr67Lctvy5P8oyaYAL9CAWrUE9i6GoNMKUga5biW6Hx4tws2six3b9c</pre>
</div>
</div>
<div class="paragraph data-line-375">
<p>Essa é a chave <em>pública</em> estendida correspondente, codificada em Base58Check:</p>
</div>
<div class="listingblock data-line-377">
<div class="content">
<pre>xpub67xpozcx8pe95XVuZLHXZeG6XWXHpGq6Qv5cmNfi7cS5mtjJ2tgypeQbBs2UAR6KECeeMVKZBPLrtJunSDMstweyLXhRgPxdp14sk9tJPW9</pre>
</div>
</div>
</div>
<div class="sect4 data-line-382">
<h5 id="public__child_key_derivation">Derivação de chave pública filha</h5>
<div class="paragraph data-line-384">
<p>Como mencionado anteriormente, uma característica muito útil das carteiras HD é a capacidade de derivar chaves públicas filhas a partir de chaves públicas pais, <em>sem</em> a necessidade das chaves privadas. Isso nos fornece duas maneiras de derivar uma chave pública filha: a partir da chave privada filha, ou diretamente a partir da chave pública pai.</p>
</div>
<div class="paragraph data-line-386">
<p>Portanto, uma chave pública estendida pode ser usada para derivar todas as chaves <em>públicas</em> (e somente as chaves públicas) naquele ramo da estrutura da carteira HD.</p>
</div>
<div class="paragraph data-line-388">
<p>This shortcut can be used to create very secure public key&#x2013;only deployments where a server or application has a copy of an extended public key and no private keys whatsoever. That kind of deployment can produce an infinite number of public keys and Bitcoin addresses, but cannot spend any of the money sent to those addresses. Meanwhile, on another, more secure server, the extended private key can derive all the corresponding private keys to sign transactions and spend the money.</p>
</div>
<div class="paragraph data-line-390">
<p>One common application of this solution is to install an extended public key on a web server that serves an ecommerce application. The web server can use the public key derivation function to create a new Bitcoin address for every transaction (e.g., for a customer shopping cart). The web server will not have any private keys that would be vulnerable to theft. Without HD wallets, the only way to do this is to generate thousands of Bitcoin addresses on a separate secure server and then preload them on the ecommerce server. That approach is cumbersome and requires constant maintenance to ensure that the ecommerce server doesn&#8217;t "run out" of addresses.</p>
</div>
<div class="paragraph data-line-392">
<p>Another common application of this solution is for cold-storage or hardware wallets. In that scenario, the extended private key can be stored on a paper wallet or hardware device (such as a Trezor hardware wallet), while the extended public key can be kept online. The user can create "receive" addresses at will, while the private keys are safely stored offline. To spend the funds, the user can use the extended private key on an offline signing Bitcoin client or sign transactions on the hardware wallet device (e.g., Trezor). <a href="#CKDpub">Estendendo uma chave pública pai para criar uma chave pública filha</a> illustrates the mechanism for extending a parent public key to derive child public keys.</p>
</div>
<div id="CKDpub" class="imageblock data-line-396">
<div class="content">
<img src="images/mbc2_0511.png" alt="ChildPublicDerivation">
</div>
<div class="title">Figure 10. Estendendo uma chave pública pai para criar uma chave pública filha</div>
</div>
</div>
<div class="sect4 data-line-398">
<h5 id="_derivação_endurecida_da_chave_filha">Derivação endurecida da chave filha</h5>
<div class="paragraph data-line-400">
<p>A habilidade de derivar um ramo de chaves públicas a partir de uma xpub é muito útil, mas isso traz um risco em potencial. Ter acesso a uma xpub não dá acesso às chaves privadas filhas. No entanto, como a xpub contém o código de cadeia, se uma chave privada filha for descoberta ou vazar de alguma maneira, ela pode ser usada com o código de cadeia para derivar todas as outras chaves privadas filhas. Ou seja, basta que uma única chave privada filha vaze junto com um código de cadeia pai, para que todas chaves privadas de todas as chaves filhas sejam reveladas. Ou, pior ainda, a chave privada filha pode ser usada junto com um código de cadeia pai para deduzir a chave privada pai.</p>
</div>
<div class="paragraph data-line-402">
<p>Para evitar esse risco, as carteiras HD usam uma função de derivação alternativa chamada <em>derivação endurecida</em> (em inglês, <em>hardened derivation</em>), que "desfaz" a relação entre a chave pública pai e o código de cadeia filho. A função de derivação endurecida usa a chave privada pai para derivar o código de cadeia filho, em vez de usar a chave pública pai. Isso cria um "firewall" na sequência pai/filho, com um código de cadeia que não pode ser usado para comprometer uma chave privada pai ou irmã. A função de derivação endurecida parece quase idêntica à derivação normal de chave privada filha, com a exceção de que a chave privada pai é usada como input da função de hash, ao invés da chave pública pai, como demonstrado no diagrama da <a href="#CKDprime">Derivação endurecida de uma chave filha; a chave pública pai é omitida</a>.</p>
</div>
<div id="CKDprime" class="imageblock data-line-406">
<div class="content">
<img src="images/mbc2_0513.png" alt="ChildHardPrivateDerivation">
</div>
<div class="title">Figure 11. Derivação endurecida de uma chave filha; a chave pública pai é omitida</div>
</div>
<div class="paragraph pagebreak-before data-line-409">
<p>Quando a função de derivação endurecida é utilizada, a chave privada filha e o código de cadeia filho resultantes são completamente diferentes do que resultariam a partir de uma função de derivação normal. O "ramo" de chaves resultante pode ser usado para produzir chaves públicas estendidas que não são vulneráveis, pois o código de cadeia que elas contêm, mesmo se for descoberto, não será capaz de revelar nenhuma das chaves privadas. A derivação endurecida é portanto usada para criar uma lacuna na árvore, localizada acima do nível onde as chaves públicas estendidas são usadas.</p>
</div>
<div class="paragraph data-line-411">
<p>Em termos simples, se você quer usar a conveniência de uma xpub para derivar ramos de chaves públicas, sem se expor ao risco de vazar um código de cadeia, você deveria derivar o ramo a partir de uma chave pai endurecida, ao invés de uma chave pai normal (não endurecida). Como prática recomendada, as chaves filhas do nível 1 das chaves mestras são sempre derivadas por meio da derivação endurecida, para evitar o comprometimento das chaves mestras.</p>
</div>
</div>
<div class="sect4 data-line-413">
<h5 id="_números_índice_para_a_derivação_normal_e_a_endurecida">Números índice para a derivação normal e a endurecida</h5>
<div class="paragraph data-line-415">
<p>O número índice usado na função de derivação é um número inteiro de 32 bits. Para facilitar a diferenciação entre as chaves derivadas pela função de derivação normal e as chaves derivadas pela função de derivação endurecida, esse número índice é dividido em dois intervalos. Os números índice entre 0 e 2<sup>31</sup>&#x2013;1 (0x0 a 0x7FFFFFFF) são usados <em>apenas</em> para a derivação normal. Os números índice entre 2<sup>31</sup> e 2<sup>32</sup>&#x2013;1 (0x80000000 a 0xFFFFFFFF) são usados <em>apenas</em> para a derivação endurecida. Portanto, se o número índice for menor do que 2<sup>31</sup>, isso significa que a chave filha é normal, enquanto se o número índice for maior ou igual a 2<sup>31</sup>, isso significa que a chave filha é endurecida.</p>
</div>
<div class="paragraph data-line-417">
<p>Para tornar o número índice mais fácil de ser lido e exibido, o número índice para as chaves filhas endurecidas é exibido iniciando do zero, mas com um apóstrofo. A primeira chave filha normal é portanto exibida como 0, enquanto a primeira chave filha endurecida (índice 0x80000000) é exibida como 0&amp;#x27;. Na sequência, a segunda chave endurecida teria o índice 0x80000001 e seria exibida como 1&amp;#x27;, e assim por diante. Quando você se deparar com um índice de carteira HD i&amp;#x27;, isso significa 2<sup>31</sup>+i.</p>
</div>
</div>
<div class="sect4 data-line-419">
<h5 id="_identificador_caminho_de_chave_de_carteira_hd">Identificador (caminho) de chave de carteira HD</h5>
<div class="paragraph data-line-421">
<p>As chaves em uma carteira HD são identificadas a partir de uma convenção de nomenclatura de "caminho", com cada nível da árvore sendo separado por uma barra (/) (ver a <a href="#table_4-8">Exemplos de caminhos de carteira HD</a>). As chaves privadas derivadas a partir da chave privada mestra iniciam com "m". As chaves públicas derivadas a partir da chave pública mestra iniciam com "M". Portanto, a primeira chave privada filha da chave privada mestra é m/0. A primeira chave pública filha é M/0. A segunda neta da primeira filha é m/0/1, e assim por diante.</p>
</div>
<div class="paragraph data-line-423">
<p>Os "antepassados" de uma chave são lidos da direita para a esquerda, até você chegar na chave mestra a partir da qual eles foram derivados. Por exemplo, o identificador m/x/y/z descreve a chave privada que é a zª filha da chave privada pai m/x/y, que é a yª filha da chave privada pai m/x, que é a xª filha da chave privada pai mestra m.</p>
</div>
<table id="table_4-8" class="tableblock frame-all grid-all stretch data-line-428">
<caption class="title">Table 6. Exemplos de caminhos de carteira HD</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Caminho HD</th>
<th class="tableblock halign-left valign-top">Chave descrita</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A primeira (0) chave privada filha da chave privada mestra (m)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m/0/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A primeira (0) chave privada filha da primeira filha (m/0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m/0'/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A primeira (0) filha normal da primeira filha <em>endurecida</em> (m/0')</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m/1/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A primeira (0) chave privada filha da segunda filha (m/1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M/23/17/0/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A primeira (0) chave pública filha da primeira filha (M/23/17/0) da 18ª filha (M/23/17) da 24ª filha (M/23)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4 data-line-437">
<h5 id="_navegando_a_estrutura_em_forma_de_árvore_da_carteira_hd">Navegando a estrutura em forma de árvore da carteira HD</h5>
<div class="paragraph data-line-439">
<p>A estrutura em forma de árvore da carteira HD oferece uma enorme flexibilidade. Cada chave estendida pai pode ter quatro bilhões de chaves filhas: dois bilhões de chaves filhas normais e dois bilhões de chaves filhas endurecidas. Cada uma dessas chaves filhas pode ter outras quatro bilhões de chaves filhas, e assim por diante. A árvore pode ter a profundidade que for necessária, com um número infinito de gerações. No entanto, com toda essa flexibilidade, torna-se bastante difícil navegar nessa árvore infinita. É especialmente difícil transferir carteiras HD entre diferentes implementações, pois as possibilidades de organização interna em ramos e subramos são infinitas.</p>
</div>
<div class="paragraph data-line-441">
<p>Duas BIPs oferecem uma solução para essa complexidade, ao criar alguns padrões propostos para a estrutura das árvores das carteiras HD. A BIP-43 propõe o uso do índice da primeira filha endurecida como um identificador especial que representa o "propósito" da estrutura em forma de árvore. Baseando-se na BIP-43, uma carteira HD deveria usar apenas um ramo de nível 1 da árvore, com o número índice identificando a estrutura e o espaço de nomes do resto da árvore ao definir o seu propósito. Por exemplo, uma carteira HD usando apenas o ramo m/i&amp;#x27;/ se destina a um propósito específico, e esse propósito é identificado pelo número índice "i".</p>
</div>
<div class="paragraph data-line-443">
<p>Estendendo essa especificação, a BIP-44 propõe uma estrutura multiconta como número de "propósito" 44' sob a BIP-43. Todas as carteiras HD que seguem a estrutura BIP-44 são identificadas pelo fato de usarem apenas um ramo da árvore: m/44'/.</p>
</div>
<div class="paragraph data-line-445">
<p>A BIP-44 especifica a estrutura como consistindo em cinco níveis de árvore predefinidos:</p>
</div>
<div class="listingblock data-line-447">
<div class="content">
<pre>m / purpose' / coin_type' / account' / change / address_index</pre>
</div>
</div>
<div class="paragraph data-line-451">
<p>O primeiro nível, "purpose" (propósito) é sempre definido como 44'. O segundo nível, "coin_type" especifica o tipo da criptomoeda, permitindo a existência de carteiras HD com suporte a múltiplas moedas, onde cada moeda possui a sua própria subárvore sob o segundo nível. Existem três moedas definidas até o momento: o Bitcoin é m/44'/0', a Testnet do Bitcoin é m/44&amp;#x27;/1&amp;#x27; e a Litecoin é m/44&amp;#x27;/2&amp;#x27;.</p>
</div>
<div class="paragraph data-line-453">
<p>O terceiro nível da árvore é o "account" (conta), que permite que os usuários subdividam suas carteiras em subcontas separadas de maneira lógica, para fins de contabilidade e organização. Por exemplo, uma carteira HD pode conter duas "contas" de bitcoin: m/44&amp;#x27;/0&amp;#x27;/0&amp;#x27; e m/44&amp;#x27;/0&amp;#x27;/1&amp;#x27;. Cada conta é a raiz de sua própria subárvore.</p>
</div>
<div class="paragraph data-line-455">
<p>No quarto nível, "change" (troco), uma carteira HD tem duas subárvores, uma para criar endereços de recebimento e outra para criar endereços de troco. Note que enquanto os níveis anteriores usavam derivação endurecida, este nível usa derivação normal. Isso permite que este nível da árvore exporte chaves públicas estendidas para uso em um ambiente não seguro. Os endereços utilizáveis são derivados pela carteira HD como filhos do quarto nível, e o quinto nível da árvore, o "address_index", é usado para o índice do endereço. Por exemplo, o terceiro endereço de recebimento para pagamentos de bitcoin na conta principal seria M/44&amp;#x27;/0&amp;#x27;/0&amp;#x27;/0/2. A <a href="#table_4-9">Exemplos de estrutura de carteira HD da BIP-44</a> mostra mais alguns exemplos.</p>
</div>
<table id="table_4-9" class="tableblock frame-all grid-all stretch data-line-460">
<caption class="title">Table 7. Exemplos de estrutura de carteira HD da BIP-44</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Caminho HD</th>
<th class="tableblock halign-left valign-top">Chave descrita</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M/44&amp;#x27;/0&amp;#x27;/0&amp;#x27;/0/2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A terceira chave pública para endereço de recebimento da primeira conta de bitcoin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M/44&amp;#x27;/0&amp;#x27;/3&amp;#x27;/1/14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A décima quinta chave pública para endereço de troco da quarta conta de bitcoin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m/44&amp;#x27;/2&amp;#x27;/0&amp;#x27;/0/1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A segunda chave privada na conta principal de Litecoin, usada para assinar transações</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3 data-line-467">
<h4 id="_usando_uma_chave_pública_estendida_em_uma_loja_virtual">Usando uma Chave Pública Estendida em uma Loja Virtual</h4>
<div class="paragraph data-line-469">
<p>Para vermos como as carteiras HD são usadas, vamos continuar a nossa história da loja virtual do Gabriel.</p>
</div>
<div class="paragraph data-line-471">
<p>Gabriel first set up his web store as a hobby, based on a simple hosted Wordpress page. His store was quite basic with only a few pages and an order form with a single Bitcoin address.</p>
</div>
<div class="paragraph data-line-473">
<p>Gabriel used the first Bitcoin address generated by his Trezor device as the main Bitcoin address for his store. This way, all incoming payments would be paid to an address controlled by his Trezor hardware wallet.</p>
</div>
<div class="paragraph data-line-475">
<p>Customers would submit an order using the form and send payment to Gabriel&#8217;s published Bitcoin address, triggering an email with the order details for Gabriel to process. With just a few orders each week, this system worked well enough.</p>
</div>
<div class="paragraph data-line-477">
<p>No entanto, a pequena loja virtual fez muito sucesso e acabou recebendo muitos pedidos da comunidade local. Em pouco tempo, Gabriel ficou sobrecarregado. Com todos os pedidos pagando no mesmo endereço, tornou-se difícil combinar corretamente os pedidos e as transações, especialmente quando vários pedidos de mesmo valor eram realizados em um curto intervalo de tempo.</p>
</div>
<div class="paragraph data-line-479">
<p>A carteira HD do Gabriel oferece uma solução muito melhor, pois ela é capaz de derivar chaves públicas filhas sem conhecer as chaves privadas. Gabriel pode colocar uma chave pública estendida (xpub) em seu site, que pode ser usada para derivar um endereço único para cada pedido de cliente. Gabriel pode gastar o dinheiro de sua Trezor, mas a xpub carregada no site só é capaz de gerar endereços e receber fundos. Este recurso das carteiras HD é um ótimo recurso de segurança. Por não conter nenhuma chave privada, o site do Gabriel não precisa de altos níveis de segurança.</p>
</div>
<div class="paragraph data-line-481">
<p>To export the xpub, Gabriel uses the Trezor Suite desktop app in conjunction with the Trezor hardware wallet. The Trezor device must be plugged in for the public keys to be exported. Note that hardware wallets will never export private keys&#x2014;those always remain on the device. <a href="#export_xpub">Exportando uma xpub de uma carteira de hardware Trezor</a> shows what Gabriel sees in Trezor Suite when exporting the xpub.</p>
</div>
<div id="export_xpub" class="imageblock data-line-485">
<div class="content">
<img src="images/mbc2_0512.png" alt="Exporting the xpub from the Trezor">
</div>
<div class="title">Figure 12. Exportando uma xpub de uma carteira de hardware Trezor</div>
</div>
<div class="paragraph data-line-487">
<p>Gabriel copia a xpub para o software de pagamento de bitcoin de sua loja online. Ele usa o <em>BTCPay Server</em>, que é uma plataforma de loja virtual de código aberto disponível para vários tipos de hospedagem e plataformas de conteúdo. O <em>BTCPay Server</em> usa a xpub para gerar um endereço único para cada compra. </p>
</div>
<div class="sect4 data-line-489">
<h5 id="_importação_e_gerenciamento_de_contas">Importação e Gerenciamento de Contas</h5>
<div class="paragraph data-line-491">
<p>Gabriel&#8217;s business is flourishing. He has provided his extended public key (xpub) to <em>BTCPay Server</em>, which is generating unique addresses for customers to his website. Every time a customer to Gabriel&#8217;s website clicks on the "Checkout" button with a specified payment modality (in this case, bitcoin), <em>BTCPay Server</em> generates a new address for that customer.  More specifically, <em>BTCPay Server</em> iterates on the <em>address_index</em> tree to create a new address to display to the customer, as defined by BIP-44. If the customer decides to switch payment methods or abandon the transaction entirely, this Bitcoin address goes unused and will not be used for another customer right away.</p>
</div>
<div class="paragraph data-line-493">
<p>Em um determinado momento, o site de Gabriel pode ter um grande volume de endereços pendentes para clientes que estejam fazendo compras, alguns dos quais podem ficar inutilizados e, eventualmente, expirar. Assim que esses endereços expirarem, o <em>BTCPay Server</em> voltará a reutilizar esses endereços para preencher a lacuna na <em>address_index</em>, mas nosso exemplo demonstra como podem surgir lacunas entre as folhas da árvore determinística hierárquica, que é onde o dinheiro realmente está localizado.</p>
</div>
<div class="paragraph data-line-495">
<p>Digamos que o Gabriel esteja interessado em ver a sua quantia total de bitcoins recebidos em uma carteira somente-leitura (uma carteira que permite que você visualize o histórico de transações, mas não permite que você gaste os fundos) separada do servidor <em>BTCPay</em>, mas que também está em conformidade com o padrão BIP-44. Como essa carteira separada deve proceder para procurar fundos nesta vasta árvore hierárquica, e quando ela deve parar de procurar? A maioria das carteiras seguirá um processo iterativo que utiliza um limite predefinido, o <em>limite de lacuna</em> (em inglês, <em>gap limit</em>). Se, enquanto estiver procurando por endereços usados, a carteira não encontrar endereços usados consecutivamente além desse número limite, ela parará de pesquisar a cadeia de endereços. O limite de lacuna padrão é normalmente definido como 20. Esse processo é detalhado na <a id="bip-44"></a><a href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki">BIP-44</a>.</p>
</div>
<div class="admonitionblock tip data-line-498">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-499">
<p>Os limites de gap explicam o fenômeno pelo qual a importação de uma carteira pode apresentar um saldo incorreto ou zero. Os fundos não são perdidos, mas, a função de importação de carteira, neste caso, não percorreu o suficiente para detectar totalmente os fundos. Muitas carteiras permitem que esse limite de lacuna padrão seja alterado, e Gabriel pode precisar aumentar esse limite para permitir que sua carteira importe totalmente seu histórico de transações.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-07-10 05:52:32 -0400
</div>
</div>
</body>
</html>